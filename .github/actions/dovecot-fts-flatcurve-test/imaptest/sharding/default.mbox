From cras@irccrew.org  Tue Jul 23 19:39:23 2002
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 23 Jul 2002 19:39:23 +0300 (EEST)
Return-Path: <cras@irccrew.org>
Delivered-To: dovecot@procontrol.fi
Received: from shodan.irccrew.org (shodan.irccrew.org [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id 434B423848
	for <dovecot@procontrol.fi>; Tue, 23 Jul 2002 19:39:23 +0300 (EEST)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id 175FA4C0A0; Tue, 23 Jul 2002 19:39:23 +0300 (EEST)
Date: Tue, 23 Jul 2002 19:39:23 +0300
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Subject: [dovecot] first test mail
Message-ID: <20020723193923.J22431@irccrew.org>
Mime-Version: 1.0
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
Content-Type: text/plain; charset=us-ascii
X-archive-position: 1
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-IMAPbase: 1096038620 0000010517
X-UID: 1                                                  
Status: O

lets see if it works


From cras@irccrew.org  Mon Jul 29 02:17:12 2002
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 29 Jul 2002 02:17:12 +0300 (EEST)
Return-Path: <cras@irccrew.org>
Delivered-To: dovecot@procontrol.fi
Received: from shodan.irccrew.org (shodan.irccrew.org [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id 8D21723848
	for <dovecot@procontrol.fi>; Mon, 29 Jul 2002 02:17:12 +0300 (EEST)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id 8BAD24C0A0; Mon, 29 Jul 2002 02:17:11 +0300 (EEST)
Date: Mon, 29 Jul 2002 02:17:11 +0300
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Subject: [dovecot] Dovecot 0.93 released
Message-ID: <20020729021711.W22431@irccrew.org>
Mime-Version: 1.0
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
Content-Type: text/plain; charset=us-ascii
X-archive-position: 2
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 2                                                  
Status: O

First alpha quality release, everything critical is now implemented. From
now on it's mostly stabilization and optimization. Features that can't break
existing code could still be added, especially SSL and authentication stuff.


From cras@irccrew.org  Wed Jul 31 22:48:41 2002
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 31 Jul 2002 22:48:41 +0300 (EEST)
Return-Path: <cras@irccrew.org>
Delivered-To: dovecot@procontrol.fi
Received: from shodan.irccrew.org (shodan.irccrew.org [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id F141123829
	for <dovecot@procontrol.fi>; Wed, 31 Jul 2002 22:48:40 +0300 (EEST)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id 42ED44C0A0; Wed, 31 Jul 2002 22:48:40 +0300 (EEST)
Date: Wed, 31 Jul 2002 22:48:39 +0300
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Subject: [dovecot] v0.95 released
Message-ID: <20020731224839.H22431@irccrew.org>
Mime-Version: 1.0
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
Content-Type: text/plain; charset=us-ascii
X-archive-position: 3
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 3                                                  
Status: O

v0.95 2002-07-31  Timo Sirainen <tss@iki.fi>

	+ Initial SSL support using GNU TLS, tested with v0.5.1.
	  TLS support is still missing.
	+ Digest-MD5 authentication method
	+ passwd-file authentication backend
	+ Code cleanups
	- Found several bugs from mempool and ioloop code, now we should
	  be stable? :)
	- A few corrections for long header field handling


From return@trafficmagnet.com  Mon Aug  5 19:26:52 2002
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 05 Aug 2002 19:26:52 +0300 (EEST)
Return-Path: <return@trafficmagnet.com>
Delivered-To: dovecot@procontrol.fi
Received: from ns5.trafficmagnet.net (unknown [211.157.101.52])
	by danu.procontrol.fi (Postfix) with ESMTP id 48C2C23831
	for <dovecot@procontrol.fi>; Mon,  5 Aug 2002 19:26:51 +0300 (EEST)
Received: from 181-Dispatcher ([211.101.236.181])
	by ns5.trafficmagnet.net (8.11.6/8.11.6) with SMTP id g765MXt31378
	for <dovecot@procontrol.fi>; Tue, 6 Aug 2002 00:22:34 -0500
Message-Id: <200208060522.g765MXt31378@ns5.trafficmagnet.net>
From: Sarah Williams <return@trafficmagnet.com>
To: "dovecot@procontrol.fi" <dovecot@procontrol.fi>
Subject: [dovecot] DOVECOT.PROCONTROL.FI
Date: Tue, 6 Aug 2002 0:29:18 +0800
X-Mailer: CSMTPConnection v2.17
MIME-Version: 1.0
Content-Type: multipart/related; boundary="956bff02-8aec-485e-a58c-40fda617ecbe"
Content-Transfer-Encoding: quoted-printable
Reply-To: Sarah Williams <Sarah_williams@trafficmagnet.com>
X-archive-position: 4
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: return@trafficmagnet.com
Precedence: bulk
X-list: dovecot
X-UID: 4                                                  
Status: O
Content-Length: 2421

This is a multi-part message in MIME format
--956bff02-8aec-485e-a58c-40fda617ecbe
Content-Type: text/html; charset=iso-8859-1
Content-Transfer-Encoding: quoted-printable

<HTML>
<HEAD>
<!-- Ap --> 
<TITLE></TITLE>
<STYLE TYPE=3D"text/css">
<!--
TD { font-family: verdana, arial, helvetica; font-size: 11px; color: #000000 =
}
-->
</STYLE>
</HEAD>
<BODY BGCOLOR=3D"#FFFFFF">
<TABLE WIDTH=3D"600" BORDER=3D"0" CELLSPACING=3D"0" CELLPADDING=3D"0">
<TR>
	<TD>Hi<BR>
	<BR>
	I visited <A HREF=3D=
"http://www.trafficmagnet.com/signup/index.html">DOVECOT.PROCONTROL.FI</A>, =
and 
	noticed that you're not listed on some search engines! I think we can offer =

	you a service which can help you increase traffic and the number of visitors =

	to your website.<BR>
	<BR>
	I would like to introduce you to <A HREF=3D=
"http://www.trafficmagnet.com/signup/index.html">TrafficMagnet.com</A>. We =
offer a unique technology 
	that will submit your website to over 300,000 search engines and directories =

	every month.<BR>
	<BR> 
	<TABLE WIDTH=3D"398" BORDER=3D"0" CELLSPACING=3D"0" CELLPADDING=3D"0" =
ALIGN=3D"center">
	<TR>
		<TD><A HREF=3D"http://www.trafficmagnet.com/signup/index.html"><IMG SRC=3D=
"http://www.trafficmagnet.com/img/img_tm.gif" WIDTH=3D"137" HEIGHT=3D"136" =
BORDER=3D"0"></A>&nbsp;</TD>
		<TD><A HREF=3D"http://www.trafficmagnet.com/signup/index.html"><IMG SRC=3D=
"http://image10.trafficmagnet.net/imagenew/SMART173/002/337/aso.jpg" WIDTH=3D=
"197" HEIGHT=3D"141" BORDER=3D"1"></A></TD>
		<TD VALIGN=3D"bottom"><A HREF=3D=
"http://www.trafficmagnet.com/signup/index.html"><IMG SRC=3D=
"http://www.trafficmagnet.com/img/img_signup.gif" WIDTH=3D"62" HEIGHT=3D"136" =
BORDER=3D"0"></A></TD>
	</TR>
	</TABLE>
	<BR>
	You'll be surprised by the low cost, and by how effective this website =
promotion 
	method can be. <BR>
	<BR>
	To find out more about TrafficMagnet and the cost for submitting your =
website 
	to over 300,000 search engines and directories, visit <A HREF=3D=
"http://www.trafficmagnet.com/signup/index.html">www.TrafficMagnet.com</A>. 
	<BR>
	<BR>
	I would love to hear from you. <BR>
	<BR><BR>
	Best Regards,<BR><BR>
	Sarah Williams <BR>
	Sales and Marketing <BR>
	E-mail: sarah_williams@trafficmagnet.com <BR>
	<A HREF=3D=
"http://www.trafficmagnet.com/signup/index.html">http://www.TrafficMagnet.com=
</A> 
    </TD>
</TR>
</TABLE>
</BODY>
</HTML>
--956bff02-8aec-485e-a58c-40fda617ecbe--

From reply@seekercenter.net  Tue Aug  6 13:01:17 2002
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 06 Aug 2002 13:01:17 +0300 (EEST)
Return-Path: <reply@seekercenter.net>
Delivered-To: dovecot@procontrol.fi
Received: from XXXXXX (unknown [211.101.236.162])
	by danu.procontrol.fi (Postfix) with ESMTP id C6D0823832
	for <dovecot@procontrol.fi>; Tue,  6 Aug 2002 13:01:15 +0300 (EEST)
From: "Vanessa Lintner" <reply@seekercenter.net>
Subject: [dovecot] I have visited DOVECOT.PROCONTROL.FI and noticed that ...
To: dovecot@procontrol.fi
Content-Type: text/html;
Reply-To: "Vanessa Lintner" <vanessa@seekercenter.net>
Date: Tue, 6 Aug 2002 18:05:01 +0800
X-Priority: 3
X-Library: Business Promotion
Message-Id: <20020806100115.C6D0823832@danu.procontrol.fi>
X-archive-position: 5
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: reply@seekercenter.net
Precedence: bulk
X-list: dovecot
X-UID: 5                                                  
Status: O
Content-Length: 5137

<html>
<head>
<title></title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<style type="text/css">
.stbtm {
	BACKGROUND-COLOR:#cecbde; BORDER-BOTTOM: #665b8e 1px solid; BORDER-LEFT: #ffffff 1px solid; BORDER-RIGHT: #665b8e 1px solid; BORDER-TOP: #ffffff 1px solid; COLOR: #000000; FONT-SIZE: 12pt; HEIGHT: 26px; WIDTH: 120px; clip:        rect(   )}
.stedit {
	 background-color:#484C68; white-space: nowrap; border: #000000; BORDER-BOTTOM: #ffffff 1px solid; BORDER-LEFT: #ffffff 1px solid; BORDER-RIGHT: #ffffff 1px solid; BORDER-TOP: #ffffff 1px solid; FONT-SIZE: 10pt; color: #CCCCCC; font-weight: bold}

</style>
</head>
<BODY leftMargin=0 onload="" topMargin=0 marginheight="0" marginwidth="0" bgcolor="#FFFFFF">
  
<table width="778" border="0" cellspacing="0" cellpadding="0">
  <tr>
      
    <td height="233" width="21">&nbsp;</td>
      
    <td height="233" colspan="3" width="757"> 
      <table width="621" border="0" cellspacing="0" cellpadding="0" align="left">
        <tr> 
            
          <td width="373" height="64"> 
            <table width="373" border="0" cellspacing="0" cellpadding="0" background="http://image.seekercenter.net/letter_bg.jpg" height="327">
                <tr> 
                  
                <td><p> 
                  <font face=Arial size=2>
                  </font> <font face=Arial size=2><font face="Verdana, Arial, Helvetica, sans-serif" color="#000000">Hello,<br>
                  <br>
                  I have visited <a href='http://dovecot.procontrol.fi'>dovecot.procontrol.fi</a> and noticed that your website is not listed on some search engines.
                  I am sure that through our service the number of people who visit your website will definitely increase. <a target=_blank href="http://www.seekercenter.net/index.php">SeekerCenter</a> 
                  is a unique technology that instantly submits your website 
                  to over 500,000 search engines and directories  
                  -- a really low-cost and effective way to advertise your site. 
                  For more details please go to <a target=_blank href="http://www.seekercenter.net/index.php">SeekerCenter.net</a>.<br>
                  <br>
                  Give your website maximum exposure today!<BR>
                  Looking forward to hearing from you.<br>
                  <BR>
                  <table border=0 width=100%><TR><TD width=50%>
                  <font face="Verdana, Arial, Helvetica, sans-serif" size=2 color="#000000">Best 
                  Regards,<br>
                  Vanessa Lintner<br>
                  Sales &amp; Marketing <br>
                  <a target=_blank href="http://www.seekercenter.net/index.php">www.SeekerCenter.net</a></font></font></font>
                  <TD><td width=50%>
                   <div align="center" valign=middle>
                   <form target=_blank action=http://www.seekercenter.net method=POST>
                          <input type="submit" name="Submit" value="Signup Now!!!" class="stbtm">
                   </form>
                        </div>
                  </TD>
                  </TR>
                  </table>
                  </td>
                </tr>
              </table>
            </td>
            
          <td width="242" height="64" valign="bottom"> 
            <table width="257" border="0" cellspacing="0" cellpadding="0">
              
                <tr>
                  <td colspan="3" height="2"></td>
                </tr>
                <tr> 
                  <td colspan="3" height="3"> 
                    
                  <p><img src="http://image.seekercenter.net/letter_top01.jpg" width="326" height="15"></p>
                    </td>
                </tr>
                <tr> 
                  <td colspan="3"><img src="http://image.seekercenter.net/letter_right01.jpg" width="31" height="185"><A target=_blank Href ="http://dovecot.procontrol.fi"><IMG Src =http://image4.seekercenter.net/image1622/6/37/img228.jpg Border=0 width="256" height="184"></A><img src="http://image.seekercenter.net/letter_left01.jpg" width="14" height="185"></td>
                </tr>
                
              <tr> 
                <td colspan="3" height="80" background="http://image.seekercenter.net/letter_bottom01.jpg"> 
                  <table width="326" border="0" cellspacing="0" cellpadding="0" height="80">
                    <tr>
                      <td width="36" height="43">&nbsp;</td>
                      <td width="157" height="43">&nbsp;</td>
                      <td width="134" height="43">&nbsp;</td>
                    </tr>
                    <tr>
                      <td width="36" height="2">&nbsp;</td>
                      <td width="157" height="2">&nbsp;</td>
                      <td width="134" height="2">&nbsp;</td>
                    </tr>
                  </table>
                  
                </td>
                </tr>
                <tr> </tr>
              </table>
            </td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
  </body>
</html>

From cras@irccrew.org  Tue Aug  6 13:34:34 2002
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 06 Aug 2002 13:34:34 +0300 (EEST)
Return-Path: <cras@irccrew.org>
Delivered-To: dovecot@procontrol.fi
Received: from shodan.irccrew.org (shodan.irccrew.org [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id 1EC3C23831
	for <dovecot@procontrol.fi>; Tue,  6 Aug 2002 13:34:34 +0300 (EEST)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id E37C74C0A0; Tue,  6 Aug 2002 13:34:33 +0300 (EEST)
Date: Tue, 6 Aug 2002 13:34:33 +0300
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Subject: [dovecot] spam / updates
Message-ID: <20020806133433.T22431@irccrew.org>
Mime-Version: 1.0
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
Content-Type: text/plain; charset=us-ascii
X-archive-position: 6
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 6                                                  
Status: O

I guess I underestimated the spammers :) This list is subscribers-only now.

As for dovecot, I've been cleaning the code and probably will continue with
that some time. I was also thinking about moving the authentication code
into separate (SASL) library which could then be plugged into other
software, such as postfix.


From darix@linux.taugt.net  Tue Aug  6 20:54:39 2002
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 06 Aug 2002 20:54:39 +0300 (EEST)
Return-Path: <darix@linux.taugt.net>
Delivered-To: dovecot@procontrol.fi
Received: from linux.taugt.net (wh5035.stw.uni-rostock.de [139.30.105.35])
	by danu.procontrol.fi (Postfix) with ESMTP id 99FC923829
	for <dovecot@procontrol.fi>; Tue,  6 Aug 2002 20:54:39 +0300 (EEST)
Received: by linux.taugt.net (none of your biz, from userid 500)
	id 28A8D29F49; Tue,  6 Aug 2002 19:54:41 +0200 (CEST)
Date: Tue, 6 Aug 2002 19:54:41 +0200
From: Marcus Rueckert <rueckert@informatik.uni-rostock.de>
To: dovecot mailing list <dovecot@procontrol.fi>
Subject: [dovecot] mbox support
Message-ID: <20020806175441.GA7148@linux.taugt.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
User-Agent: Mutt/1.4i
X-archive-position: 7
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: rueckert@informatik.uni-rostock.de
Precedence: bulk
X-list: dovecot
X-UID: 7                                                  
Status: O

hi

could you explain the following sentence from the readme.txt:
"mbox support is available but currently it relies a little bit on good
luck, ..."

what kind of luck do i need?
why do you think the mbox support isnt this reliable?

Marcus Rückert

-- 
irssi - the client of the smart and beautiful people

From marcelo@carpa.ciagri.usp.br  Wed Aug  7 02:39:26 2002
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 07 Aug 2002 02:39:26 +0300 (EEST)
Return-Path: <marcelo@carpa.ciagri.usp.br>
Delivered-To: dovecot@procontrol.fi
Received: from carpa.ciagri.usp.br (carpa.ciagri.usp.br [143.107.209.25])
	by danu.procontrol.fi (Postfix) with SMTP id 42D5323829
	for <dovecot@procontrol.fi>; Wed,  7 Aug 2002 02:39:25 +0300 (EEST)
Received: (qmail 32442 invoked by uid 1000); 6 Aug 2002 23:40:54 -0000
From: marcelo@carpa.ciagri.usp.br
Date: Tue, 6 Aug 2002 20:40:54 -0300
To: dovecot@procontrol.fi
Subject: [dovecot] starting
Message-ID: <20020806234054.GA30820@carpa.ciagri.usp.br>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.3.28i
X-archive-position: 8
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: marcelo@carpa.ciagri.usp.br
Precedence: bulk
X-list: dovecot
X-UID: 8                                                  
Status: O


Hi. Sorry for the basic question but... how do I
start the server?  From inetd or in standalone mode
(which binary)?

Thanks

From cras@irccrew.org  Wed Aug  7 06:54:12 2002
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 07 Aug 2002 06:54:12 +0300 (EEST)
Return-Path: <cras@irccrew.org>
Delivered-To: dovecot@procontrol.fi
Received: from shodan.irccrew.org (shodan.irccrew.org [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id EA9D623829
	for <dovecot@procontrol.fi>; Wed,  7 Aug 2002 06:54:11 +0300 (EEST)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id D125E4C0A0; Wed,  7 Aug 2002 06:54:11 +0300 (EEST)
Date: Wed, 7 Aug 2002 06:54:11 +0300
From: Timo Sirainen <tss@iki.fi>
To: dovecot mailing list <dovecot@procontrol.fi>
Subject: [dovecot] Re: mbox support
Message-ID: <20020807065411.A16470@irccrew.org>
References: <20020806175441.GA7148@linux.taugt.net>
Mime-Version: 1.0
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
In-Reply-To: <20020806175441.GA7148@linux.taugt.net>; from rueckert@informatik.uni-rostock.de on Tue, Aug 06, 2002 at 07:54:41PM +0200
Content-Type: text/plain; charset=us-ascii
X-archive-position: 9
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 9                                                  
Status: O

On Tue, Aug 06, 2002 at 07:54:41PM +0200, Marcus Rueckert wrote:
> could you explain the following sentence from the readme.txt:
> "mbox support is available but currently it relies a little bit on good
> luck, ..."
> 
> what kind of luck do i need?
> why do you think the mbox support isnt this reliable?

mbox files are locked only while they're being modified. If only dovecot was
accessing the mailbox I guess there wouldn't be any problem since it
properly locks the index files as well. But if any other MUA was just
modifying the mbox file (deleting messages) while dovecot was reading it,
it's possible that you end up having data from some random message. Storing
MD5 sum of all messages and making sure they match would fix this.


From cras@irccrew.org  Wed Aug  7 06:58:27 2002
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 07 Aug 2002 06:58:27 +0300 (EEST)
Return-Path: <cras@irccrew.org>
Delivered-To: dovecot@procontrol.fi
Received: from shodan.irccrew.org (shodan.irccrew.org [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id B90D723829
	for <dovecot@procontrol.fi>; Wed,  7 Aug 2002 06:58:27 +0300 (EEST)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id 443C64C0A0; Wed,  7 Aug 2002 06:58:24 +0300 (EEST)
Date: Wed, 7 Aug 2002 06:58:24 +0300
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: starting
Message-ID: <20020807065824.C16470@irccrew.org>
References: <20020806234054.GA30820@carpa.ciagri.usp.br>
Mime-Version: 1.0
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
In-Reply-To: <20020806234054.GA30820@carpa.ciagri.usp.br>; from marcelo@carpa.ciagri.usp.br on Tue, Aug 06, 2002 at 08:40:54PM -0300
Content-Type: text/plain; charset=us-ascii
X-archive-position: 10
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 10                                                  
Status: O

On Tue, Aug 06, 2002 at 08:40:54PM -0300, marcelo@carpa.ciagri.usp.br wrote:

> Hi. Sorry for the basic question but... how do I
> start the server?  From inetd or in standalone mode
> (which binary)?

Run imap-master


From cras@irccrew.org  Wed Aug  7 06:59:01 2002
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 07 Aug 2002 06:59:01 +0300 (EEST)
Return-Path: <cras@irccrew.org>
Delivered-To: dovecot@procontrol.fi
Received: from shodan.irccrew.org (shodan.irccrew.org [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id 05B9423829
	for <dovecot@procontrol.fi>; Wed,  7 Aug 2002 06:59:01 +0300 (EEST)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id E84874C0A0; Wed,  7 Aug 2002 06:59:00 +0300 (EEST)
Date: Wed, 7 Aug 2002 06:59:00 +0300
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: starting
Message-ID: <20020807065900.D16470@irccrew.org>
References: <20020806234054.GA30820@carpa.ciagri.usp.br>
Mime-Version: 1.0
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
In-Reply-To: <20020806234054.GA30820@carpa.ciagri.usp.br>; from marcelo@carpa.ciagri.usp.br on Tue, Aug 06, 2002 at 08:40:54PM -0300
Content-Type: text/plain; charset=us-ascii
X-archive-position: 11
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 11                                                  
Status: O

On Tue, Aug 06, 2002 at 08:40:54PM -0300, marcelo@carpa.ciagri.usp.br wrote:

> Hi. Sorry for the basic question but... how do I
> start the server?  From inetd or in standalone mode
> (which binary)?

Oh, and standalone :) Maybe I should support inetd too later.


From marcelo@carpa.ciagri.usp.br  Thu Aug  8 02:18:19 2002
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 08 Aug 2002 02:18:19 +0300 (EEST)
Return-Path: <marcelo@carpa.ciagri.usp.br>
Delivered-To: dovecot@procontrol.fi
Received: from carpa.ciagri.usp.br (carpa.ciagri.usp.br [143.107.209.25])
	by danu.procontrol.fi (Postfix) with SMTP id 348EE23829
	for <dovecot@procontrol.fi>; Thu,  8 Aug 2002 02:18:18 +0300 (EEST)
Received: (qmail 18910 invoked by uid 1000); 7 Aug 2002 23:19:56 -0000
From: marcelo@carpa.ciagri.usp.br
Date: Wed, 7 Aug 2002 20:19:56 -0300
To: dovecot@procontrol.fi
Subject: [dovecot] SELECT
Message-ID: <20020807231956.GA11240@carpa.ciagri.usp.br>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.3.28i
X-archive-position: 12
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: marcelo@carpa.ciagri.usp.br
Precedence: bulk
X-list: dovecot
X-UID: 12                                                  
Status: O
Content-Length: 1024



Hi, all.

Thanks Timo for answering my previous post. It's starting
fine now :)

I must be doing something wrong again but I can't connect from
any imap client. If I telnet to the server I get:

$ telnet carpa 11143
Trying 143.107.209.25...
Connected to carpa.ciagri.usp.br.
Escape character is '^]'.
* OK dovecot ready.
a001 login marcelo #####
a001 OK Logged in.
a002 select INBOX
a002 NO Broken INBOX: Permission denied
a003 select ""
* FLAGS (\Answered \Flagged \Deleted \Seen \Draft \Recent)
* OK [PERMANENTFLAGS (\Answered \Flagged \Deleted \Seen \Draft)] Flags
permitted.
* 246 EXISTS
* 246 RECENT
* OK [UNSEEN 1] First unseen.
* OK [UIDVALIDITY 1028760751] UIDs valid
a003 OK [READ-WRITE] Select completed.
a004 close
a004 OK Close completed.
a005 logout
* BYE Logging out
a005 OK Logout completed.
Connection closed by foreign host.

"INBOX" seems not be a valid mailbox name to Dovecot but
it works with others servers (courier, at least).

The server uses Maildirs and runs qmail and courier (by now).

Thanks.

From cras@irccrew.org  Thu Aug  8 07:13:04 2002
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 08 Aug 2002 07:13:04 +0300 (EEST)
Return-Path: <cras@irccrew.org>
Delivered-To: dovecot@procontrol.fi
Received: from shodan.irccrew.org (shodan.irccrew.org [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id 65BF823831
	for <dovecot@procontrol.fi>; Thu,  8 Aug 2002 07:13:04 +0300 (EEST)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id 3BB134C0A0; Thu,  8 Aug 2002 07:13:03 +0300 (EEST)
Date: Thu, 8 Aug 2002 07:13:03 +0300
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: SELECT
Message-ID: <20020808071303.F16470@irccrew.org>
References: <20020807231956.GA11240@carpa.ciagri.usp.br>
Mime-Version: 1.0
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
In-Reply-To: <20020807231956.GA11240@carpa.ciagri.usp.br>; from marcelo@carpa.ciagri.usp.br on Wed, Aug 07, 2002 at 08:19:56PM -0300
Content-Type: text/plain; charset=us-ascii
X-archive-position: 13
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 13                                                  
Status: O

On Wed, Aug 07, 2002 at 08:19:56PM -0300, marcelo@carpa.ciagri.usp.br wrote:

> a002 NO Broken INBOX: Permission denied

You use normal passwd/shadow/pam authentication? Where does the home
directory point to, to your real home dir under which Maildir/ is? Anyway,
one of the following failed (under Maildir/):

 mkdir .INBOX
 ln -s ../cur .INBOX/cur
 ln -s ../new .INBOX/new
 ln -s ../tmp .INBOX/tmp

Next release will tell exactly which of them failed :)

> a003 select ""

I don't think this should be allowed :)


From marcelo@carpa.ciagri.usp.br  Thu Aug  8 16:11:45 2002
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 08 Aug 2002 16:11:45 +0300 (EEST)
Return-Path: <marcelo@carpa.ciagri.usp.br>
Delivered-To: dovecot@procontrol.fi
Received: from carpa.ciagri.usp.br (carpa.ciagri.usp.br [143.107.209.25])
	by danu.procontrol.fi (Postfix) with SMTP id 88CF423831
	for <dovecot@procontrol.fi>; Thu,  8 Aug 2002 16:11:44 +0300 (EEST)
Received: (qmail 9606 invoked by uid 1000); 8 Aug 2002 13:13:30 -0000
From: marcelo@carpa.ciagri.usp.br
Date: Thu, 8 Aug 2002 10:13:30 -0300
To: dovecot@procontrol.fi
Subject: [dovecot] Re: SELECT
Message-ID: <20020808131329.GA30775@carpa.ciagri.usp.br>
References: <20020807231956.GA11240@carpa.ciagri.usp.br> <20020808071303.F16470@irccrew.org>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20020808071303.F16470@irccrew.org>
User-Agent: Mutt/1.3.28i
X-archive-position: 14
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: marcelo@carpa.ciagri.usp.br
Precedence: bulk
X-list: dovecot
X-UID: 14                                                  
Status: O

On Thu, Aug 08, 2002 at 07:13:03AM +0300, Timo Sirainen wrote:
> On Wed, Aug 07, 2002 at 08:19:56PM -0300, marcelo@carpa.ciagri.usp.br wrote:
> 
> > a002 NO Broken INBOX: Permission denied
> 
> You use normal passwd/shadow/pam authentication?

Well, in dovecot.conf I have:

auth = default
auth_methods = plain
auth_userinfo = shadow
auth_user = root

> Where does the home
> directory point to, to your real home dir under which Maildir/ is?

Maildir is in the real users' home (/home/user/Maildir)

> Anyway,
> one of the following failed (under Maildir/):
> 
>  mkdir .INBOX
>  ln -s ../cur .INBOX/cur
>  ln -s ../new .INBOX/new
>  ln -s ../tmp .INBOX/tmp
> 
> Next release will tell exactly which of them failed :)
> 

Shouldn't it be:

mkdir .INBOX
ln -s cur .INBOX/
ln -s new .INBOX/
ln -s tmp .INBOX/
?

Anyway, "mkdir .INBOX" succeeds but it is created with
perms 070 and trying to create the links inside it
causes the permission errors.


From cras@irccrew.org  Thu Aug  8 18:04:54 2002
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 08 Aug 2002 18:04:54 +0300 (EEST)
Return-Path: <cras@irccrew.org>
Delivered-To: dovecot@procontrol.fi
Received: from shodan.irccrew.org (shodan.irccrew.org [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id C053623831
	for <dovecot@procontrol.fi>; Thu,  8 Aug 2002 18:04:54 +0300 (EEST)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id 6E2674C0A0; Thu,  8 Aug 2002 18:04:53 +0300 (EEST)
Date: Thu, 8 Aug 2002 18:04:53 +0300
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: SELECT
Message-ID: <20020808180453.J16470@irccrew.org>
References: <20020807231956.GA11240@carpa.ciagri.usp.br> <20020808071303.F16470@irccrew.org> <20020808131329.GA30775@carpa.ciagri.usp.br>
Mime-Version: 1.0
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
In-Reply-To: <20020808131329.GA30775@carpa.ciagri.usp.br>; from marcelo@carpa.ciagri.usp.br on Thu, Aug 08, 2002 at 10:13:30AM -0300
Content-Type: text/plain; charset=us-ascii
X-archive-position: 15
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 15                                                  
Status: O

On Thu, Aug 08, 2002 at 10:13:30AM -0300, marcelo@carpa.ciagri.usp.br wrote:

> Shouldn't it be:
> 
> mkdir .INBOX
> ln -s cur .INBOX/
> ln -s new .INBOX/
> ln -s tmp .INBOX/
> ?

No, if that was done the symlinks would point to themselves. ln -s behaviour
looks a bit weird if you're not doing it from the destination directory :)

> Anyway, "mkdir .INBOX" succeeds but it is created with
> perms 070 and trying to create the links inside it
> causes the permission errors.

Ah, and this was because I was stupid and set the default umask to 0700
instead of 0077 :) You could fix this by uncommenting the umask-line in
dovecot.conf.

btw. 0.95 also has problems with bad network connections or large mailboxes,
I'll probably release 0.96 soon which fixes it.


From cras@irccrew.org  Thu Aug  8 19:00:00 2002
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 08 Aug 2002 19:00:00 +0300 (EEST)
Return-Path: <cras@irccrew.org>
Delivered-To: dovecot@procontrol.fi
Received: from shodan.irccrew.org (shodan.irccrew.org [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id 5A8E723829
	for <dovecot@procontrol.fi>; Thu,  8 Aug 2002 19:00:00 +0300 (EEST)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id 36C274C0A0; Thu,  8 Aug 2002 19:00:00 +0300 (EEST)
Date: Thu, 8 Aug 2002 19:00:00 +0300
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Subject: [dovecot] v0.96 released
Message-ID: <20020808190000.K16470@irccrew.org>
Mime-Version: 1.0
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
Content-Type: text/plain; charset=us-ascii
X-archive-position: 16
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 16                                                  
Status: O
Content-Length: 1072

This release was actually tested with reading my inbox (500+ messages, mbox,
Solaris 8) using Outlook and Evolution

v0.96 2002-08-08  Timo Sirainen <tss@iki.fi>

	* Changed to LGPL v2.1 license

	+ STARTTLS support and optional disabling of plaintext authentication
	  (LOGINDISABLED capability)
	+ Support for custom message flags, each folder can have 26 different.
	+ New configuration file options: imap_listen, max_logging_users,
	  max_imap_processes
	+ You can specify config file location to imap-master with -c <path>
	+ All IMAP processes can now write to specified log file instead of
	  syslog. Either do this by setting IMAP_LOGFILE environment, or
	  give -l <path> parameter to imap-master.
	+ Some cleanups to remove warnings with BSDs
	+ Changed all %s .. strerror(errno) -> %m
	+ Rewritten memory pool code
	- imap-master didn't close all the fds for executed processes
	- iobuffer code was buggy and caused the connection to terminate
	  sometimes
	- make install overwrote the existing dovecot.conf file, so it's now
	  named as dovecot-example.conf


From marcelo@carpa.ciagri.usp.br  Thu Aug  8 22:33:47 2002
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 08 Aug 2002 22:33:47 +0300 (EEST)
Return-Path: <marcelo@carpa.ciagri.usp.br>
Delivered-To: dovecot@procontrol.fi
Received: from carpa.ciagri.usp.br (carpa.ciagri.usp.br [143.107.209.25])
	by danu.procontrol.fi (Postfix) with SMTP id 18B9C23829
	for <dovecot@procontrol.fi>; Thu,  8 Aug 2002 22:33:45 +0300 (EEST)
Received: (qmail 23496 invoked by uid 1000); 8 Aug 2002 19:35:33 -0000
From: marcelo@carpa.ciagri.usp.br
Date: Thu, 8 Aug 2002 16:35:33 -0300
To: dovecot@procontrol.fi
Subject: [dovecot] Disk quotas (was: SELECT)
Message-ID: <20020808193533.GA28619@carpa.ciagri.usp.br>
References: <20020807231956.GA11240@carpa.ciagri.usp.br> <20020808071303.F16470@irccrew.org> <20020808131329.GA30775@carpa.ciagri.usp.br> <20020808180453.J16470@irccrew.org>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20020808180453.J16470@irccrew.org>
User-Agent: Mutt/1.3.28i
X-archive-position: 17
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: marcelo@carpa.ciagri.usp.br
Precedence: bulk
X-list: dovecot
X-UID: 17                                                  
Status: O
Content-Length: 1136

On Thu, Aug 08, 2002 at 06:04:53PM +0300, Timo Sirainen wrote:

> > Anyway, "mkdir .INBOX" succeeds but it is created with
> > perms 070 and trying to create the links inside it
> > causes the permission errors.
> 
> Ah, and this was because I was stupid and set the default umask to 0700
> instead of 0077 :) You could fix this by uncommenting the umask-line in
> dovecot.conf.

Hey, it works! :)

> 
> btw. 0.95 also has problems with bad network connections or large mailboxes,
> I'll probably release 0.96 soon which fixes it.
> 

Yes, confirmed. Using 0.96 my inbox shows up with all my ~200 messages now.

Now, one last question (for a while):  would be possible/desirable make
Dovecot work when an user is with her disk quota completely full (hard
quota)?  The main reason I'm looking for an alternative imap server is that
neither WU-Imapd nor Courier work "properly" (from an user point of view) in
that situation (the user can not login or delete her messages to clean up
the mailbox). If Dovecot could handle this problem (creating its scratch
files in /tmp, perhaps) it'd be big plus, IMHO.

Thanks for the great support :)

From cras@irccrew.org  Fri Aug  9 07:03:02 2002
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 09 Aug 2002 07:03:02 +0300 (EEST)
Return-Path: <cras@irccrew.org>
Delivered-To: dovecot@procontrol.fi
Received: from shodan.irccrew.org (shodan.irccrew.org [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id A2CE123829
	for <dovecot@procontrol.fi>; Fri,  9 Aug 2002 07:03:02 +0300 (EEST)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id 30A774C0A0; Fri,  9 Aug 2002 07:03:01 +0300 (EEST)
Date: Fri, 9 Aug 2002 07:03:01 +0300
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Disk quotas (was: SELECT)
Message-ID: <20020809070301.L16470@irccrew.org>
References: <20020807231956.GA11240@carpa.ciagri.usp.br> <20020808071303.F16470@irccrew.org> <20020808131329.GA30775@carpa.ciagri.usp.br> <20020808180453.J16470@irccrew.org> <20020808193533.GA28619@carpa.ciagri.usp.br>
Mime-Version: 1.0
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
In-Reply-To: <20020808193533.GA28619@carpa.ciagri.usp.br>; from marcelo@carpa.ciagri.usp.br on Thu, Aug 08, 2002 at 04:35:33PM -0300
Content-Type: text/plain; charset=us-ascii
X-archive-position: 18
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 18                                                  
Status: O
Content-Length: 1031

On Thu, Aug 08, 2002 at 04:35:33PM -0300, marcelo@carpa.ciagri.usp.br wrote:

> Now, one last question (for a while):  would be possible/desirable make
> Dovecot work when an user is with her disk quota completely full (hard
> quota)?  The main reason I'm looking for an alternative imap server is that
> neither WU-Imapd nor Courier work "properly" (from an user point of view) in
> that situation (the user can not login or delete her messages to clean up
> the mailbox). If Dovecot could handle this problem (creating its scratch
> files in /tmp, perhaps) it'd be big plus, IMHO.

Well, that is a bit difficult to handle.. It's mostly the index files that
dovecot has to create/grow. I think I should support keeping them only in
memory when disk quota is exceeded.

But what about clients, I think some of them just copy the mail to trash
folder instead of deleting the mail? But maybe with
maildir_copy_with_hardlinks=yes that'd be possible even with quota full.

I guess I'll have to install quota support and start fixing.


From marcelo@carpa.ciagri.usp.br  Fri Aug  9 22:05:26 2002
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 09 Aug 2002 22:05:26 +0300 (EEST)
Return-Path: <marcelo@carpa.ciagri.usp.br>
Delivered-To: dovecot@procontrol.fi
Received: from carpa.ciagri.usp.br (carpa.ciagri.usp.br [143.107.209.25])
	by danu.procontrol.fi (Postfix) with SMTP id 41E5B23831
	for <dovecot@procontrol.fi>; Fri,  9 Aug 2002 22:03:46 +0300 (EEST)
Received: (qmail 27100 invoked by uid 1000); 9 Aug 2002 19:03:39 -0000
From: marcelo@carpa.ciagri.usp.br
Date: Fri, 9 Aug 2002 16:03:39 -0300
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Disk quotas
Message-ID: <20020809190339.GA2063@carpa.ciagri.usp.br>
References: <20020807231956.GA11240@carpa.ciagri.usp.br> <20020808071303.F16470@irccrew.org> <20020808131329.GA30775@carpa.ciagri.usp.br> <20020808180453.J16470@irccrew.org> <20020808193533.GA28619@carpa.ciagri.usp.br> <20020809070301.L16470@irccrew.org>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20020809070301.L16470@irccrew.org>
User-Agent: Mutt/1.3.28i
X-archive-position: 19
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: marcelo@carpa.ciagri.usp.br
Precedence: bulk
X-list: dovecot
X-UID: 19                                                  
Status: O

On Fri, Aug 09, 2002 at 07:03:01AM +0300, Timo Sirainen wrote:

> 
> Well, that is a bit difficult to handle.. It's mostly the index files that
> dovecot has to create/grow. I think I should support keeping them only in
> memory when disk quota is exceeded.
> 

I see...

> But what about clients, I think some of them just copy the mail to trash
> folder instead of deleting the mail? But maybe with
> maildir_copy_with_hardlinks=yes that'd be possible even with quota full.
> 

When a user or his imap client asks for a "write" operation (like saving in
Trash) I think it's fair for an imap server just fail the operation and
return an error (he's overquota :).

But using "good" clients that offer the option to just delete the messages
(not copy/move them) it would be nice if they could have the chance to at
least login and delete the spam.

> I guess I'll have to install quota support and start fixing.
> 

I'm by no means a decent C programmer but if I could help somehow, just ask.

Thanks,
Marcelo.

From ev@kernel.ping-viini.org  Mon Aug 12 01:09:37 2002
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 12 Aug 2002 01:09:37 +0300 (EEST)
Return-Path: <ev@kernel.ping-viini.org>
Delivered-To: dovecot@procontrol.fi
Received: from ping-viini.at.home.telekarelia.fi (ping-viini.at.home.telekarelia.fi [195.197.199.46])
	by danu.procontrol.fi (Postfix) with SMTP id C8B3423833
	for <dovecot@procontrol.fi>; Mon, 12 Aug 2002 01:09:37 +0300 (EEST)
Received: (qmail 17429 invoked from network); 11 Aug 2002 21:32:33 -0000
Received: from unknown (HELO eero) (192.168.0.2)
  by 0 with SMTP; 11 Aug 2002 21:32:33 -0000
Message-ID: <006701c24183$c7f10d60$0200a8c0@eero>
From: "Eero Volotinen" <ev@kernel.ping-viini.org>
To: <dovecot@procontrol.fi>
Subject: [dovecot] vpopmail authentication support
Date: Mon, 12 Aug 2002 01:09:37 +0300
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: 7bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2600.0000
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2600.0000
X-archive-position: 20
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: ev@kernel.ping-viini.org
Precedence: bulk
X-list: dovecot
X-UID: 20                                                  
Status: O

is nice feature to get soon if possible?


--
Eero


From cras@irccrew.org  Thu Aug 22 16:25:52 2002
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 22 Aug 2002 16:25:52 +0300 (EEST)
Return-Path: <cras@irccrew.org>
Delivered-To: dovecot@procontrol.fi
Received: from shodan.irccrew.org (shodan.irccrew.org [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id 926902386D
	for <dovecot@procontrol.fi>; Thu, 22 Aug 2002 16:25:52 +0300 (EEST)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id C96234C0A0; Thu, 22 Aug 2002 16:25:51 +0300 (EEST)
Date: Thu, 22 Aug 2002 16:25:51 +0300
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Subject: [dovecot] status update / cvs repository
Message-ID: <20020822132551.GD12341@irccrew.org>
Mime-Version: 1.0
Content-Disposition: inline
User-Agent: Mutt/1.4i
Content-Type: text/plain; charset=us-ascii
X-archive-position: 21
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 21                                                  
Status: O

Past few weeks went mostly while rewriting small part of code. It really
wouldn't have needed to take that long, but I always got really tired after
just looking at that code for a few seconds :)

Anyway, now messages are parsed in 256kB blocks (maybe I should make it
configurable), so large messages don't eat all memory anymore. Maildir
support seems to work with the new code, though I haven't tested it too well
yet. mbox is currently broken.

If you want to test it, dovecot's CVS is available with rsync. I don't think
I'll bother setting up pserver since that CVS has also other sources that
aren't public.

With rsync you'd do it something like:

# initialize new cvs repository (do it just once)
cvs -d ~/cvs init

# update cvs repository
rsync -avz --delete dovecot.procontrol.fi::dovecotcvs ~/cvs/dovecot

# checkout the sources from your cvs repository
cd ~/src
cvs -d ~/cvs checkout dovecot


From cras@irccrew.org  Mon Aug 26 18:23:16 2002
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 26 Aug 2002 18:23:16 +0300 (EEST)
Return-Path: <cras@irccrew.org>
Delivered-To: dovecot@procontrol.fi
Received: from shodan.irccrew.org (shodan.irccrew.org [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id AB6572386D
	for <dovecot@procontrol.fi>; Mon, 26 Aug 2002 18:23:16 +0300 (EEST)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id ADE354C0A0; Mon, 26 Aug 2002 18:23:12 +0300 (EEST)
Date: Mon, 26 Aug 2002 18:23:12 +0300
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: vpopmail authentication support
Message-ID: <20020826152312.GI7103@irccrew.org>
References: <006701c24183$c7f10d60$0200a8c0@eero>
Mime-Version: 1.0
Content-Disposition: inline
In-Reply-To: <006701c24183$c7f10d60$0200a8c0@eero>
User-Agent: Mutt/1.4i
Content-Type: text/plain; charset=us-ascii
X-archive-position: 22
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 22                                                  
Status: O

On Mon, Aug 12, 2002 at 01:09:37AM +0300, Eero Volotinen wrote:
> is nice feature to get soon if possible?

OK, I finally remembered to put this in TODO :) I also looked at vpopmail
before but it had at least one very weird thing which I thought about asking
about it's authors (gid field actually contains just flags).


From cras@irccrew.org  Thu Aug 29 03:17:57 2002
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 29 Aug 2002 03:17:57 +0300 (EEST)
Return-Path: <cras@irccrew.org>
Delivered-To: dovecot@procontrol.fi
Received: from shodan.irccrew.org (shodan.irccrew.org [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id 56E0223831
	for <dovecot@procontrol.fi>; Thu, 29 Aug 2002 03:17:57 +0300 (EEST)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id A9A3B4C0A0; Thu, 29 Aug 2002 03:17:56 +0300 (EEST)
Date: Thu, 29 Aug 2002 03:17:56 +0300
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Subject: [dovecot] v0.97 released
Message-ID: <20020829001756.GU7103@irccrew.org>
Mime-Version: 1.0
Content-Disposition: inline
User-Agent: Mutt/1.4i
Content-Type: text/plain; charset=us-ascii
X-archive-position: 23
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 23                                                  
Status: O
Content-Length: 2242

This is a major cleanup release. My near future goal is to make it
impossible to crash Dovecot no matter what you did. This release also adds
support for files larger than 2GB with Linux and Solaris. Also mbox support
seems to work quite well now, except EXPUNGE and STORE are still not
implemented.

The "impossible to crash" should already be quite true, at least when it
comes to index files. You can try to corrupt indexes in any way you want,
and Dovecot should not crash. There's one exception to this: modifying the
files while dovecot is reading them may crash it, this is too difficult to
fix as long as shared memory maps are used, and I don't see much point in it
anyway. I mostly want dovecot to survive corrupted files, not intentional
crashing :)

This release is the first I'd almost like to call beta-quality. But not
quite. It still lacks testing and several features, but it's very close :)

Changelog:

v0.97 2002-08-29  Timo Sirainen <tss@iki.fi>

	+ Large mails are handled in 256kB blocks, so mail size no longer
	  has hardly any effect on memory usage
	+ 64bit file offsets are used if supported by system. This means
	  Dovecot is fully capable of handling >2G mails in those systems.
	  With 32bit offsets >2G mails may not behave too well, but should
	  not crash either.
	+ I fixed lots of potential integer overflows. This should make us
	  fully crash-free no matter what happens (index file corruption
	  mostly). I didn't verify everything too carefully yet, so more
	  auditing is still needed before we fully reach that goal.
	+ Implemented several missing tasks / optimizations to index handling.
	  It should now stay fast after longer usage periods.
	+ New configuration file options: log_path, log_timestamp, imaps_listen
	+ "Critical errors" are now hidden from users, ie. any error message
	  that is not a direct reply to user error is written into log file
	  and user gets only "Internal error [timestamp]".
	+ Nonblocking SSL handshaking
	+ Lots of code cleanups
	- Lots of mbox fixes, it seems to be somewhat reliable now
	- Year in Date-field was parsed wrong
	- Appending mail to mbox didn't work right
	- Always verify that mailbox names are valid (especially they shouldn't
	  contain "../")


From svrmarty@gmx.net  Sat Sep 14 23:50:41 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 14 Sep 2002 23:50:41 +0300 (EEST)
Return-Path: <svrmarty@gmx.net>
Delivered-To: dovecot@procontrol.fi
Received: from svrmarty.gnome.at (unknown [213.225.45.83])
	by danu.procontrol.fi (Postfix) with ESMTP id 0964B23831
	for <dovecot@procontrol.fi>; Sat, 14 Sep 2002 23:50:40 +0300 (EEST)
Received: from silent (silent.svrmarty.gnome.at [192.168.1.8])
	by svrmarty.gnome.at (8.12.3/8.12.3/Debian -4) with SMTP id g8EM00he027169
	for <dovecot@procontrol.fi>; Sun, 15 Sep 2002 00:00:01 +0200
Message-ID: <059101c25c30$da8c2b40$0801a8c0@svrmarty.gnome.at>
From: "SvR Marty" <svrmarty@gmx.net>
To: <dovecot@procontrol.fi>
Subject: [dovecot] Problems with it
Date: Sat, 14 Sep 2002 22:54:00 +0200
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: 7bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 5.50.4807.1700
X-MimeOLE: Produced By Microsoft MimeOLE V5.50.4807.1700
X-archive-position: 24
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: svrmarty@gmx.net
Precedence: bulk
X-list: dovecot
X-UID: 24                                                  
Status: O

i've install it, used the example config and started

tryed to access my mailbox via Outlook Express

here's the syslog:

Sep 14 22:42:17 p133 imap-login: Logged in. [192.168.1.8]
Sep 15 00:42:17 p133 imap(svrmarty): MAIL environment missing and
autodetection failed (home /home/svrmarty)
Sep 15 00:42:17 p133 imap-master: child 20960 (imap) returned error 98
Sep 14 22:42:19 p133 imap-login: Logged in. [192.168.1.8]
Sep 15 00:42:19 p133 imap(svrmarty): MAIL environment missing and
autodetection failed (home /home/svrmarty)
Sep 15 00:42:19 p133 imap-master: child 20961 (imap) returned error 98

it fails and i don't see any message


From cras@irccrew.org  Sun Sep 15 00:50:10 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 15 Sep 2002 00:50:10 +0300 (EEST)
Return-Path: <cras@irccrew.org>
Delivered-To: dovecot@procontrol.fi
Received: from shodan.irccrew.org (shodan.irccrew.org [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id 75F9423837
	for <dovecot@procontrol.fi>; Sun, 15 Sep 2002 00:50:10 +0300 (EEST)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id 4AA2C4C0A5; Sun, 15 Sep 2002 00:50:09 +0300 (EEST)
Date: Sun, 15 Sep 2002 00:50:08 +0300
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Problems with it
Message-ID: <20020914215008.GU9842@irccrew.org>
References: <059101c25c30$da8c2b40$0801a8c0@svrmarty.gnome.at>
Mime-Version: 1.0
Content-Disposition: inline
In-Reply-To: <059101c25c30$da8c2b40$0801a8c0@svrmarty.gnome.at>
User-Agent: Mutt/1.4i
Content-Type: text/plain; charset=us-ascii
X-archive-position: 25
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 25                                                  
Status: O

On Sat, Sep 14, 2002 at 10:54:00PM +0200, SvR Marty wrote:

> Sep 15 00:42:17 p133 imap(svrmarty): MAIL environment missing and
> autodetection failed (home /home/svrmarty)

Are you using mbox or maildir? It looks only for ~/Maildir with maildir.
With mbox it looks for ~/Mail and ~/mail directories, and they must contain
either "inbox" or "mbox" file.

If your mail is in /var/mail, that's not supported yet, and I'm not sure if
it will be. You could create symlink from it to ~/mail though.


From svrmarty@gmx.net  Sun Sep 15 15:46:31 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 15 Sep 2002 15:46:31 +0300 (EEST)
Return-Path: <svrmarty@gmx.net>
Delivered-To: dovecot@procontrol.fi
Received: from svrmarty.gnome.at (unknown [213.225.45.83])
	by danu.procontrol.fi (Postfix) with ESMTP id B6BA023831
	for <dovecot@procontrol.fi>; Sun, 15 Sep 2002 15:46:28 +0300 (EEST)
Received: from silent (silent.svrmarty.gnome.at [192.168.1.8])
	by svrmarty.gnome.at (8.12.3/8.12.3/Debian -4) with SMTP id g8FDuEhe013158
	for <dovecot@procontrol.fi>; Sun, 15 Sep 2002 15:56:15 +0200
Message-ID: <009601c25cb6$b1e567c0$0801a8c0@svrmarty.gnome.at>
From: "SvR Marty" <svrmarty@gmx.net>
To: <dovecot@procontrol.fi>
References: <059101c25c30$da8c2b40$0801a8c0@svrmarty.gnome.at> <20020914215008.GU9842@irccrew.org>
Subject: [dovecot] Re: Problems with it
Date: Sun, 15 Sep 2002 14:52:03 +0200
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: 7bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 5.50.4807.1700
X-MimeOLE: Produced By Microsoft MimeOLE V5.50.4807.1700
X-archive-position: 26
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: svrmarty@gmx.net
Precedence: bulk
X-list: dovecot
X-UID: 26                                                  
Status: O
Content-Length: 1045

i can't find a good howto doc.

can you put ls -laR of the special folders into a mail an send it ?

i don't know how this should work

seems i'm using maildir
Internal error [2002-09-15 16:42:35]
Sep 15 16:42:35 p133 imap(svrmarty): Can't open index data
/home/svrmarty/Maildir/.INBOX/.imap.index.data: No such file or directory

dunno what to do

----- Original Message -----
From: "Timo Sirainen" <tss@iki.fi>
To: <dovecot@procontrol.fi>
Sent: Saturday, September 14, 2002 11:50 PM
Subject: [dovecot] Re: Problems with it


> On Sat, Sep 14, 2002 at 10:54:00PM +0200, SvR Marty wrote:
>
> > Sep 15 00:42:17 p133 imap(svrmarty): MAIL environment missing and
> > autodetection failed (home /home/svrmarty)
>
> Are you using mbox or maildir? It looks only for ~/Maildir with maildir.
> With mbox it looks for ~/Mail and ~/mail directories, and they must
contain
> either "inbox" or "mbox" file.
>
> If your mail is in /var/mail, that's not supported yet, and I'm not sure
if
> it will be. You could create symlink from it to ~/mail though.
>
>


From cras@irccrew.org  Mon Sep 16 07:41:59 2002
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 16 Sep 2002 07:41:59 +0300 (EEST)
Return-Path: <cras@irccrew.org>
Delivered-To: dovecot@procontrol.fi
Received: from shodan.irccrew.org (shodan.irccrew.org [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id A05B423831
	for <dovecot@procontrol.fi>; Mon, 16 Sep 2002 07:41:59 +0300 (EEST)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id 4D5EF4C0A5; Mon, 16 Sep 2002 07:41:56 +0300 (EEST)
Date: Mon, 16 Sep 2002 07:41:56 +0300
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Problems with it
Message-ID: <20020916044155.GY9842@irccrew.org>
References: <059101c25c30$da8c2b40$0801a8c0@svrmarty.gnome.at> <20020914215008.GU9842@irccrew.org> <009601c25cb6$b1e567c0$0801a8c0@svrmarty.gnome.at>
Mime-Version: 1.0
Content-Disposition: inline
In-Reply-To: <009601c25cb6$b1e567c0$0801a8c0@svrmarty.gnome.at>
User-Agent: Mutt/1.4i
Content-Type: text/plain; charset=us-ascii
X-archive-position: 27
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 27                                                  
Status: O

On Sun, Sep 15, 2002 at 02:52:03PM +0200, SvR Marty wrote:
> seems i'm using maildir
> Internal error [2002-09-15 16:42:35]
> Sep 15 16:42:35 p133 imap(svrmarty): Can't open index data
> /home/svrmarty/Maildir/.INBOX/.imap.index.data: No such file or directory

Looks like some bug .. rm -f /home/svrmarty/Maildir/.INBOX/.imap.index*
might help.

Anyway, the 0.97 version isn't very usable. I think I'll release new version
today or tomorrow, which has had quite a lot of testing. I'll just have to
see if all those changes I did last weekend broke everything or fixed the
last few problems :)


From cras@irccrew.org  Fri Sep 20 14:30:45 2002
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 20 Sep 2002 14:30:45 +0300 (EEST)
Return-Path: <cras@irccrew.org>
Delivered-To: dovecot@procontrol.fi
Received: from shodan.irccrew.org (shodan.irccrew.org [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id 8FDD82383F
	for <dovecot@procontrol.fi>; Fri, 20 Sep 2002 14:30:45 +0300 (EEST)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id 63BF44C0A5; Fri, 20 Sep 2002 14:30:45 +0300 (EEST)
Date: Fri, 20 Sep 2002 14:30:45 +0300
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Subject: [dovecot] vpopmail authentication
Message-ID: <20020920113045.GC8225@irccrew.org>
Mime-Version: 1.0
Content-Disposition: inline
User-Agent: Mutt/1.4i
Content-Type: text/plain; charset=us-ascii
X-archive-position: 28
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 28                                                  
Status: O

CVS has now support for vpopmail authentication. .c file compiles, but I'm
not sure if I did the other checks properly and if it actually works :)

If someone here is using it, could you test it? At least to see if configure
detects it and if it compiles/links.

BTW. I think maildir support is now working quite well, 0.98 isn't far away.


From cras@irccrew.org  Fri Sep 20 15:19:11 2002
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 20 Sep 2002 15:19:11 +0300 (EEST)
Return-Path: <cras@irccrew.org>
Delivered-To: dovecot@procontrol.fi
Received: from shodan.irccrew.org (shodan.irccrew.org [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id 202B223831
	for <dovecot@procontrol.fi>; Fri, 20 Sep 2002 15:19:11 +0300 (EEST)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id F03784C0A5; Fri, 20 Sep 2002 15:19:10 +0300 (EEST)
Date: Fri, 20 Sep 2002 15:19:10 +0300
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: vpopmail authentication
Message-ID: <20020920121910.GA27866@irccrew.org>
References: <20020920113045.GC8225@irccrew.org>
Mime-Version: 1.0
Content-Disposition: inline
In-Reply-To: <20020920113045.GC8225@irccrew.org>
User-Agent: Mutt/1.4i
Content-Type: text/plain; charset=us-ascii
X-archive-position: 29
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 29                                                  
Status: O

On Fri, Sep 20, 2002 at 02:30:45PM +0300, Timo Sirainen wrote:
> CVS has now support for vpopmail authentication. .c file compiles, but I'm
> not sure if I did the other checks properly and if it actually works :)

Yes, it works.


From tss@iki.fi  Mon Sep 23 20:42:43 2002
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 23 Sep 2002 20:42:44 +0300 (EEST)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id D7B9D2383F
	for <dovecot@procontrol.fi>; Mon, 23 Sep 2002 20:42:43 +0300 (EEST)
Received: by hurina (Postfix, from userid 1000)
	id 9D32C5E01F4F; Mon, 23 Sep 2002 20:42:43 +0300 (EEST)
Subject: [dovecot] 0.98 released
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
X-Mailer: Ximian Evolution 1.0.8 
Date: 23 Sep 2002 20:42:43 +0300
Message-Id: <1032802963.15743.2.camel@hurina>
Mime-Version: 1.0
X-archive-position: 30
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 30                                                  
Status: O
Content-Length: 1061

0.98 released. This release includes LOTS of bugfixes after almost 4
weeks of actual use. We've mostly tested with Outlook 2000, Outlook
Express 6 and Evolution 1.0.8. I haven't heard of a single bug in
maildir for several days, and mbox worked quite well first time today :)

New features include vpopmail authentication, ability to run properly
when there's no disk space left to allow user to delete mail, and full
support for mbox.

v0.98 2002-09-23  Timo Sirainen <tss@iki.fi>

+ mbox support is finally working. There's still some reliability
  fixes left but overall it should be quite usable.
+ vpopmail authentication support
+ We should be able to deal with "out of diskspace/quota" conditions
  properly, by keeping the indexes in memory and allowing user to
  delete mails to get more space.
+ Several speed enhancements
+ New configuration file option: overwrite_incompatible_index to force
  using ".imap.index" file, overwriting it if it isn't compatible
- Handle invalid message headers reliably
- Tons of bugfixes and code cleanups everywhere


From tss@iki.fi  Tue Sep 24 20:04:30 2002
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 24 Sep 2002 20:04:30 +0300 (EEST)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 6B45C23831
	for <dovecot@procontrol.fi>; Tue, 24 Sep 2002 20:04:30 +0300 (EEST)
Received: by hurina (Postfix, from userid 1000)
	id 2AD7C5E01F42; Tue, 24 Sep 2002 20:04:30 +0300 (EEST)
Subject: [dovecot] 0.98.1 released
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
X-Mailer: Ximian Evolution 1.0.8 
Date: 24 Sep 2002 20:04:30 +0300
Message-Id: <1032887070.27868.0.camel@hurina>
Mime-Version: 1.0
X-archive-position: 31
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 31                                                  
Status: O

Guess I should have waited one more day before releasing 0.98 :) This
fixes a few mbox problems and should finally make it safe to use. Also
fixes a bug of not allowing to save mail larger than 8kB.


From tss@iki.fi  Mon Sep 30 23:53:10 2002
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 30 Sep 2002 23:53:10 +0300 (EEST)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 6FE262383F
	for <dovecot@procontrol.fi>; Mon, 30 Sep 2002 23:53:10 +0300 (EEST)
Received: by hurina (Postfix, from userid 1000)
	id 69C545E03E5C; Mon, 30 Sep 2002 23:53:09 +0300 (EEST)
Subject: [dovecot] 0.98.2 released
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1033419189.14835.2.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.1.1.99 (Preview Release)
Date: 30 Sep 2002 23:53:09 +0300
X-archive-position: 32
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 32                                                  
Status: O
Content-Length: 1080

Lets see if I fixed all the nasty bugs now.

v0.98.2 2002-09-30  Timo Sirainen <tss@iki.fi>

	+ --with-file-offset-size=32 can now be used to select 32bit file
	  offsets. Using them should be a bit faster and take a bit less
	  disk and memory (also needed to compile Dovecot successfully with
	  TinyCC).
	+ maildir_copy_with_hardlinks option works now
	+ Check new mail and notify about it to client also after
	  commands which don't allow full syncing (FETCH, STORE, SEARCH).
	  Also always send RECENT after EXISTS notify.
	+ If we're out of disk space while opening mailbox, notify about it
	  with ALERT.
	- STORE and SEARCH didn't handle properly message sequence numbers
	  when some in the middle were externally deleted
	- SEARCH: Only first search condition was checked.
	- mbox: Message flags given to APPEND were ignored.
	- mbox: index was corrupted when changing flags for multipart MIME
	  messages
	- Out of disk space-handling wasn't working properly with .customflags
	  file
	- if auth processes were killed, login processes weren't reconnecting
	  to them


From tss@iki.fi  Tue Oct  1 00:28:31 2002
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 01 Oct 2002 00:28:31 +0300 (EEST)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 3D1E123831
	for <dovecot@procontrol.fi>; Tue,  1 Oct 2002 00:28:31 +0300 (EEST)
Received: by hurina (Postfix, from userid 1000)
	id D03AB5E03E5C; Tue,  1 Oct 2002 00:28:30 +0300 (EEST)
Subject: [dovecot] 0.98.3 released.
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1033421310.19032.0.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.1.1.99 (Preview Release)
Date: 01 Oct 2002 00:28:30 +0300
X-archive-position: 33
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 33                                                  
Status: O

v0.98.3 2002-10-01  Timo Sirainen <tss@iki.fi>

	* Sorry, just noticed a very stupid bug which caused evolution 1.2
	  beta to crash. I always thought it was just evolution's fault :)
	- Several fields in BODY / BODYSTRUCTURE replies weren't quoted


From tss@iki.fi  Sun Oct  6 00:39:51 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 06 Oct 2002 00:39:51 +0300 (EEST)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 14CF32382D
	for <dovecot@procontrol.fi>; Sun,  6 Oct 2002 00:39:51 +0300 (EEST)
Received: by hurina (Postfix, from userid 1000)
	id BDD015E03E5C; Sun,  6 Oct 2002 00:39:50 +0300 (EEST)
Subject: [dovecot] 0.98.4 released
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1033853990.9860.17.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.1.1.99 (Preview Release)
Date: 06 Oct 2002 00:39:50 +0300
X-archive-position: 34
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 34                                                  
Status: O

v0.99 will be next, having the new great binary tree code which should
make huge mailboxes possible. With smaller mailboxes I think it still
makes it better than the old code, even while it is slower in some cases
(hash lookups are faster than btree search in optimal cases).

v0.98.4 2002-10-06  Timo Sirainen <tss@iki.fi>

	* Just a final release before replacing hash file with a binary tree.

	- When fetching messages larger than 256k, sometimes Dovecot missed
	  to send CR causing corrupted data at end of message and possibly
	  complete failure depending on IMAP client.
	- Fetching BODY or BODYSTRUCTURE for message having content-type of
	  message/rfc822 didn't correctly add () around the envelope data.
	- Several fixes to make it compile with HP/UX ANSI C compiler.
	  Also fixed several warnings it showed up.


From tss@iki.fi  Tue Oct  8 00:43:16 2002
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 08 Oct 2002 00:43:16 +0300 (EEST)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 786252382B
	for <dovecot@procontrol.fi>; Tue,  8 Oct 2002 00:43:16 +0300 (EEST)
Received: by hurina (Postfix, from userid 1000)
	id E5EDA5E015A0; Tue,  8 Oct 2002 00:43:15 +0300 (EEST)
Subject: [dovecot] Benchmarks
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1034026995.782.15.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.1.1.99 (Preview Release)
Date: 08 Oct 2002 00:43:15 +0300
X-archive-position: 35
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 35                                                  
Status: O

Just tried Dovecot with 85k mails from Linux kernel mailing list, total
of 357MB. I mostly wanted to see if the new binary tree file works well.
And it does :) Nothing gets slowed down after deleting messages all
around the mailbox.

I tried several things with Dovecot, UW-IMAPd and Courier. You'll see
that Dovecot is faster in everything else except raw I/O which is a bit
strange, have to look why.

I think the most important thing anyway is the time spent opening
mailbox. Clients are doing "STATUS mailbox (UNSEEN)" very often and that
has to be fast. With Dovecot it's so small that I didn't even bother
adding it to the benchmarks, with UW-IMAPd it's 16 seconds, with courier
2 seconds.

Full results can be found at
http://dovecot.procontrol.fi/dovecot-benchmark.txt


From tss@iki.fi  Tue Oct  8 03:33:27 2002
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 08 Oct 2002 03:33:27 +0300 (EEST)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 1C9832382D
	for <dovecot@procontrol.fi>; Tue,  8 Oct 2002 03:33:27 +0300 (EEST)
Received: by hurina (Postfix, from userid 1000)
	id 469EE5E015A0; Tue,  8 Oct 2002 03:33:26 +0300 (EEST)
Subject: [dovecot] Re: Benchmarks - updated for Cyrus
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <1034026995.782.15.camel@hurina>
References: <1034026995.782.15.camel@hurina>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1034037205.770.6.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.1.1.99 (Preview Release)
Date: 08 Oct 2002 03:33:26 +0300
X-archive-position: 36
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 36                                                  
Status: O

On Tue, 2002-10-08 at 00:43, Timo Sirainen wrote:
> Full results can be found at
> http://dovecot.procontrol.fi/dovecot-benchmark.txt

Updated to contain Cyrus benchmarks as well. Cyrus' BODY and ENVELOPE
fetches are equilevant to Dovecot's "BODY and ENVELOPE cached"
benchmarks.

So, we slightly beat Cyrus in many things, EXPUNGE most notably. BODY[]
fetching is slower probably because of our I/O problems, and possibly
also because we didn't store messages with CR+LFs (in which case we
would use sendfile(), and that should be _fast_).

We're also slow with message flag changes because maildir requires
rename()ing the mail files, we could later add optimization not to do it
but rely on flags specified in index file.


From tss@iki.fi  Tue Oct  8 06:23:31 2002
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 08 Oct 2002 06:23:31 +0300 (EEST)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 6DFF12382B
	for <dovecot@procontrol.fi>; Tue,  8 Oct 2002 06:23:31 +0300 (EEST)
Received: by hurina (Postfix, from userid 1000)
	id 466A25E015A0; Tue,  8 Oct 2002 06:23:31 +0300 (EEST)
Subject: [dovecot] Re: Benchmarks - updated for Cyrus
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <1034037205.770.6.camel@hurina>
References: <1034026995.782.15.camel@hurina> <1034037205.770.6.camel@hurina>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1034047411.780.5.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.1.1.99 (Preview Release)
Date: 08 Oct 2002 06:23:31 +0300
X-archive-position: 37
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 37                                                  
Status: O

On Tue, 2002-10-08 at 03:33, Timo Sirainen wrote:

> So, we slightly beat Cyrus in many things, EXPUNGE most notably. BODY[]
> fetching is slower probably because of our I/O problems, and possibly
> also because we didn't store messages with CR+LFs (in which case we
> would use sendfile(), and that should be _fast_).

Actually, after trying again a few more times (rebooting between),
Cyrus' BODY[] got much slower. Updated the benchmark once more, now
added Dovecot with CR+LF and Dovecot with 32bit file offsets (default is
64bit).



From tss@iki.fi  Thu Oct 10 04:40:09 2002
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 10 Oct 2002 04:40:09 +0300 (EEST)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 745FB2382B
	for <dovecot@procontrol.fi>; Thu, 10 Oct 2002 04:40:09 +0300 (EEST)
Received: by hurina (Postfix, from userid 1000)
	id F269E5E03E5C; Thu, 10 Oct 2002 04:40:08 +0300 (EEST)
Subject: [dovecot] Re: Benchmarks - updated for Cyrus
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <1034047411.780.5.camel@hurina>
References: <1034026995.782.15.camel@hurina> <1034037205.770.6.camel@hurina>
	 <1034047411.780.5.camel@hurina>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1034214008.770.7.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.1.1.99 (Preview Release)
Date: 10 Oct 2002 04:40:08 +0300
X-archive-position: 38
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 38                                                  
Status: O

On Tue, 2002-10-08 at 06:23, Timo Sirainen wrote:
> Actually, after trying again a few more times (rebooting between),
> Cyrus' BODY[] got much slower. Updated the benchmark once more, now
> added Dovecot with CR+LF and Dovecot with 32bit file offsets (default is
> 64bit).

After 3 hours of tweaking which didn't make much difference, I finally
tried if filesystem had any effect on the speed. It had. A lot. Using
the same mail files as Cyrus, I got the time going from 2:32 down to
1:41. Cyrus used 2:25 to do the same, meaning we easily beat Cyrus.

Now, uw-imapd is still faster with mbox handling..


From faulerhund@faulerhund.net  Sat Oct 12 18:26:54 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 12 Oct 2002 18:26:55 +0300 (EEST)
Return-Path: <faulerhund@faulerhund.net>
Delivered-To: dovecot@procontrol.fi
Received: from moutvdom.kundenserver.de (moutvdom.kundenserver.de [195.20.224.200])
	by danu.procontrol.fi (Postfix) with ESMTP id D6D972382D
	for <dovecot@procontrol.fi>; Sat, 12 Oct 2002 18:26:54 +0300 (EEST)
Received: from [195.20.224.206] (helo=mrvdomng.kundenserver.de)
	by moutvdom.kundenserver.de with esmtp (Exim 3.35 #1)
	id 180OAI-0001FX-00
	for dovecot@procontrol.fi; Sat, 12 Oct 2002 17:26:54 +0200
Received: from [217.84.28.114] (helo=mobilo)
	by mrvdomng.kundenserver.de with smtp (Exim 3.35 #1)
	id 180OAH-0002wH-00
	for dovecot@procontrol.fi; Sat, 12 Oct 2002 17:26:53 +0200
Message-ID: <000e01c27203$e947a450$1964a8c0@mobilo>
From: "Korbinian Riedhammer" <faulerhund@faulerhund.net>
To: <dovecot@procontrol.fi>
Subject: [dovecot] auth problem
Date: Sat, 12 Oct 2002 17:27:43 +0200
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: 7bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2600.0000
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2600.0000
X-archive-position: 39
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: faulerhund@faulerhund.net
Precedence: bulk
X-list: dovecot
X-UID: 39                                                  
Status: O

hi, im facing this problem:
Fatal: can't listen in UNIX socket /var/rin/dovecot/login/
/usr/lib/dovecot/imap-login: No such file or directory
Errror: child xxxxx (auth) returned error 98

any idea?

- bini


From sean@tcob1.net  Sat Oct 12 19:18:50 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 12 Oct 2002 19:18:50 +0300 (EEST)
Return-Path: <sean@tcob1.net>
Delivered-To: dovecot@procontrol.fi
Received: from s2.uklinux.net (smtp2.uklinux.net [80.84.64.30])
	by danu.procontrol.fi (Postfix) with ESMTP id 17E9D2382B
	for <dovecot@procontrol.fi>; Sat, 12 Oct 2002 19:18:50 +0300 (EEST)
Received: from tcob1.net (y-airlock008.esatclear.ie [213.202.165.8])
	(authenticated)
	by s2.uklinux.net (8.11.6/8.11.6) with ESMTP id g9CGIm916110
	for <dovecot@procontrol.fi>; Sat, 12 Oct 2002 17:18:48 +0100
Envelope-To: <dovecot@procontrol.fi>
Received: from [192.168.0.1] (helo=tcob1.net.tcob1.net ident=sean)
	by tcob1.net with asmtp (Exim 4.10)
	id 180OyZ-00020q-00
	for dovecot@procontrol.fi; Sat, 12 Oct 2002 17:18:51 +0100
Date: Sat, 12 Oct 2002 17:18:38 +0100
Message-ID: <m365w73a1t.wl@tcob1.net>
From: Sean Rima <sean@tcob1.net>
To: dovecot@procontrol.fi
Subject: [dovecot] replacing Courier imapd
User-Agent: Wanderlust/2.9.15 (Unchained Melody) SEMI/1.14.3 (Ushinoya)
 FLIM/1.14.3 (=?ISO-8859-4?Q?Unebigory=F2mae?=) APEL/10.3 Emacs/21.2
 (i586-pc-linux-gnu) MULE/5.0 (SAKAKI)
Organization: There Can Only Be 1
X-Home-Page: http://www.tcob1.net
X-GPG-Key-FingerPrint: AB0A 3748 9565 1BFD 4E77  D9D5 1CC9 D25A 7DA7 0294
X-GPG-Key: http://pgp.mit.edu:11371/pks/lookup?op=get&search=0x7DA70294
X-OS: Linux 2.4.19
MIME-Version: 1.0 (generated by SEMI 1.14.3 - "Ushinoya")
Content-Type: text/plain; charset=US-ASCII
X-archive-position: 40
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: sean@tcob1.net
Precedence: bulk
X-list: dovecot
X-UID: 40                                                  
Status: O

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi folks,

I currently use courier imapd, exim and ldap on my mail box. There are
no users on this box, all info is taken from the ldap server. I note
that dovecot does not use ldap as a backend, but curious if this in on
the cards, or even mysql backend.

Sean
- -- 
  Sean Rima                                http://www.tcob1.net
  Linux User:      231986          Jabber:   tcobone@jabber.org
  THE VIEWS EXPRESSED HERE ARE NOT NECESSARILY THOSE OF MY WIFE.
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.0 (GNU/Linux)
Comment: Use GPG for Secure Mail

iD8DBQE9qEs4HMnSWn2nApQRAn22AJ4xdGWfpxAuY8dLDuHM/XUAXms0mwCfZJzk
ZD8cTK98j7f7CGcu1OENJXI=
=BS5M
-----END PGP SIGNATURE-----

From tss@iki.fi  Sat Oct 12 20:42:41 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 12 Oct 2002 20:42:41 +0300 (EEST)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id B9BC12382D
	for <dovecot@procontrol.fi>; Sat, 12 Oct 2002 20:42:41 +0300 (EEST)
Received: by hurina (Postfix, from userid 1000)
	id 7E8C95E03E5C; Sat, 12 Oct 2002 20:42:41 +0300 (EEST)
Subject: [dovecot] Re: auth problem
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <000e01c27203$e947a450$1964a8c0@mobilo>
References: <000e01c27203$e947a450$1964a8c0@mobilo>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1034444559.30856.52.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.1.1.99 (Preview Release)
Date: 12 Oct 2002 20:42:41 +0300
X-archive-position: 41
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 41                                                  
Status: O

On Sat, 2002-10-12 at 18:27, Korbinian Riedhammer wrote:
> hi, im facing this problem:
> Fatal: can't listen in UNIX socket /var/rin/dovecot/login/
> /usr/lib/dovecot/imap-login: No such file or directory
> Errror: child xxxxx (auth) returned error 98

Well, that error message at least looks a bit strange. Is that one or
two error messages? The first one should continue but it instead shows
two paths .. plus typo in /var/rin.

Anyway, probably something wrong in your config file, maybe you've tried
to add some path to "auth = xxx"? If not, send the whole file to me and
I'll see what's wrong.

Does /var/run/dovecot/login exist? And /usr/lib/dovecot/imap-login?
You did do make install, right?


From tss@iki.fi  Sat Oct 12 20:46:54 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 12 Oct 2002 20:46:54 +0300 (EEST)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 770472382D
	for <dovecot@procontrol.fi>; Sat, 12 Oct 2002 20:46:54 +0300 (EEST)
Received: by hurina (Postfix, from userid 1000)
	id 42A2D5E03E5C; Sat, 12 Oct 2002 20:46:54 +0300 (EEST)
Subject: [dovecot] Re: replacing Courier imapd
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <m365w73a1t.wl@tcob1.net>
References: <m365w73a1t.wl@tcob1.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1034444814.30856.58.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.1.1.99 (Preview Release)
Date: 12 Oct 2002 20:46:54 +0300
X-archive-position: 42
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 42                                                  
Status: O

On Sat, 2002-10-12 at 19:18, Sean Rima wrote:

> I currently use courier imapd, exim and ldap on my mail box. There are
> no users on this box, all info is taken from the ldap server. I note
> that dovecot does not use ldap as a backend, but curious if this in on
> the cards, or even mysql backend.

It wouldn't be hard to implement them, but they're not high on my
TODO-list yet. If anyone else doesn't write them, I eventually will. 

They would be possible through vpopmail though, since it supports them
and Dovecot supports vpopmail. I wouldn't really encourage using
vpopmail though, doesn't look very secure.


From tss@iki.fi  Tue Oct 15 04:16:57 2002
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 15 Oct 2002 04:16:57 +0300 (EEST)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 13D9A2382D
	for <dovecot@procontrol.fi>; Tue, 15 Oct 2002 04:16:57 +0300 (EEST)
Received: by hurina (Postfix, from userid 1000)
	id D9E845E015A0; Tue, 15 Oct 2002 04:16:56 +0300 (EEST)
Subject: [dovecot] More documentation
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1034644616.24679.4.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.1.1.99 (Preview Release)
Date: 15 Oct 2002 04:16:56 +0300
X-archive-position: 43
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 43                                                  
Status: O

I just wrote a bit of documentation. Probably not very well organized,
improvement suggestions welcome :)

http://dovecot.procontrol.fi/doc/INSTALL
http://dovecot.procontrol.fi/doc/configuration.txt
http://dovecot.procontrol.fi/doc/mail-storages.txt

Those are also in the main dovecot.procontrol.fi web page. They also
talk about a few features not yet in CVS..


From faulerhund@faulerhund.net  Tue Oct 15 22:47:16 2002
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 15 Oct 2002 22:47:16 +0300 (EEST)
Return-Path: <faulerhund@faulerhund.net>
Delivered-To: dovecot@procontrol.fi
Received: from moutvdom.kundenserver.de (moutvdom.kundenserver.de [195.20.224.131])
	by danu.procontrol.fi (Postfix) with ESMTP id 76DA02382D
	for <dovecot@procontrol.fi>; Tue, 15 Oct 2002 22:47:16 +0300 (EEST)
Received: from [195.20.224.206] (helo=mrvdomng.kundenserver.de)
	by moutvdom.kundenserver.de with esmtp (Exim 3.35 #1)
	id 181Xes-0007dC-00
	for dovecot@procontrol.fi; Tue, 15 Oct 2002 21:47:14 +0200
Received: from [217.235.92.239] (helo=Bini)
	by mrvdomng.kundenserver.de with smtp (Exim 3.35 #1)
	id 181Xer-0001oK-00
	for dovecot@procontrol.fi; Tue, 15 Oct 2002 21:47:13 +0200
Message-ID: <000b01c27484$608af620$0164a8c0@Bini>
From: "Korbinian Riedhammer" <faulerhund@faulerhund.net>
To: <dovecot@procontrol.fi>
Subject: [dovecot] still problems getting it to work
Date: Tue, 15 Oct 2002 21:52:21 +0200
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: 7bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2600.0000
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2600.0000
X-archive-position: 44
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: faulerhund@faulerhund.net
Precedence: bulk
X-list: dovecot
X-UID: 44                                                  
Status: O
Content-Length: 1645

hi all,
after havong some other trouble with my server i finally managed to
recompile and install dovecot. installed it in /usr/local (the dafault).
below u see a dump of my config file. i want to use "normal" shadow
passwords for authentification. i adjustet the pathes from /usr/ to
/usr/local/. when i login with outlook express 4 example i get the error:
unsupported authentification method. (my system isn't configured for shadow
md5). in the error log i get the the /dev/urandom is needed but not found,
well but i have it :)
maybe a chroot setting?

thx bini

imap_port = 143
#imaps_port = 993
imap_listen =
#imaps_listen =
#ssl_cert_file = /etc/ssl/certs/imapd.pem
#ssl_key_file = /etc/ssl/private/imapd.pem
disable_plaintext_auth = no
log_path = /var/log/imapd.log
log_timestamp = %d %H:%M:%S
login_executable = /usr/local/lib/dovecot/imap-login
login_user = imapd
login_dir = /var/run/dovecot/login
login_chroot = yes
login_processes_count = 1
max_logging_users = 256
imap_executable = /usr/local/lib/dovecot/imap
max_imap_processes = 1024
first_valid_uid = 1000
#last_valid_uid = 0
first_valid_gid = 101
last_valid_gid = 101
valid_chroot_dirs = /var/run/dovecot
maildir_copy_with_hardlinks = no
maildir_check_content_changes = no
overwrite_incompatible_index = yes
umask = 0077
auth = default
auth_methods = plain
#auth_realms =
auth_userinfo = shadow
auth_executable = /usr/local/lib/dovecot/imap-auth
auth_user = root
auth_chroot = /var/run/dovecot
auth_count = 1
#auth = digest_md5
#auth_methods = digest-md5
#auth_realms =
#auth_userinfo = passwd-file /etc/passwd.imap
#auth_user = imapauth
#auth_chroot = /var/run/dovecot/auth



From tss@iki.fi  Tue Oct 15 23:38:37 2002
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 15 Oct 2002 23:38:37 +0300 (EEST)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id D3448238A3
	for <dovecot@procontrol.fi>; Tue, 15 Oct 2002 23:38:37 +0300 (EEST)
Received: by hurina (Postfix, from userid 1000)
	id 4EC045E107F9; Tue, 15 Oct 2002 23:38:34 +0300 (EEST)
Subject: [dovecot] Re: still problems getting it to work
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <000b01c27484$608af620$0164a8c0@Bini>
References: <000b01c27484$608af620$0164a8c0@Bini>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1034714314.24679.17.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.1.1.99 (Preview Release)
Date: 15 Oct 2002 23:38:34 +0300
X-archive-position: 45
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 45                                                  
Status: O

On Tue, 2002-10-15 at 22:52, Korbinian Riedhammer wrote:
> hi all,
> after havong some other trouble with my server i finally managed to
> recompile and install dovecot. installed it in /usr/local (the dafault).
> below u see a dump of my config file. i want to use "normal" shadow
> passwords for authentification. i adjustet the pathes from /usr/ to
> /usr/local/. when i login with outlook express 4 example i get the error:
> unsupported authentification method. (my system isn't configured for shadow
> md5). in the error log i get the the /dev/urandom is needed but not found,
> well but i have it :)
> maybe a chroot setting?

You're right, it's the auth_chroot which breaks it. I fixed it in CVS
now.  But your auth process is still running as root, which makes
chrooting pretty useless, so just disable it.


From tss@iki.fi  Tue Oct 15 23:57:35 2002
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 15 Oct 2002 23:57:35 +0300 (EEST)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id BD343238A3
	for <dovecot@procontrol.fi>; Tue, 15 Oct 2002 23:57:35 +0300 (EEST)
Received: by hurina (Postfix, from userid 1000)
	id 801965E107F9; Tue, 15 Oct 2002 23:57:35 +0300 (EEST)
Subject: [dovecot] Re: still problems getting it to work
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <000b01c27484$608af620$0164a8c0@Bini>
References: <000b01c27484$608af620$0164a8c0@Bini>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1034715455.24679.22.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.1.1.99 (Preview Release)
Date: 15 Oct 2002 23:57:35 +0300
X-archive-position: 46
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 46                                                  
Status: O

On Tue, 2002-10-15 at 22:52, Korbinian Riedhammer wrote:
> hi all,
> after havong some other trouble with my server i finally managed to
> recompile and install dovecot. installed it in /usr/local (the dafault).
> below u see a dump of my config file. i want to use "normal" shadow
> passwords for authentification. i adjustet the pathes from /usr/ to
> /usr/local/.

Path changing isn't needed btw. Dovecot uses automatically the paths
given with --prefix if they're not set in config file.

>  when i login with outlook express 4 example i get the error:
> unsupported authentification method. (my system isn't configured for shadow
> md5). in the error log i get the the /dev/urandom is needed but not found,
> well but i have it :)
> maybe a chroot setting?

Also chrooting wouldn't work anyway with shadow authentication since it
can't open /etc/shadow. I also just tried to see if opening shadow
database before chrooting would work, but it doesn't, probably because
it wants to reopen the file if it has changed.


From thomas@xs4all.net  Sat Oct 19 15:39:57 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 19 Oct 2002 15:39:57 +0300 (EEST)
Return-Path: <thomas@xs4all.net>
Delivered-To: dovecot@procontrol.fi
Received: from smtpzilla3.xs4all.nl (smtpzilla3.xs4all.nl [194.109.127.139])
	by danu.procontrol.fi (Postfix) with ESMTP id 163C1238A7
	for <dovecot@procontrol.fi>; Sat, 19 Oct 2002 15:39:57 +0300 (EEST)
Received: from centurion.xs4all.nl (centurion.xs4all.nl [194.109.0.100])
	by smtpzilla3.xs4all.nl (8.12.0/8.12.0) with ESMTP id g9JCdus7052057
	for <dovecot@procontrol.fi>; Sat, 19 Oct 2002 14:39:56 +0200 (CEST)
Received: by centurion.xs4all.nl (Postfix, from userid 1000)
	id D6EDC2268; Sat, 19 Oct 2002 14:38:46 +0200 (CEST)
Date: Sat, 19 Oct 2002 14:38:46 +0200
From: Thomas Wouters <thomas@xs4all.net>
To: dovecot@procontrol.fi
Subject: [dovecot] Architectural questions
Message-ID: <20021019123846.GK543@xs4all.nl>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.4i
X-message-flag: Danger Will Robinson!
X-archive-position: 47
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: thomas@xs4all.net
Precedence: bulk
X-list: dovecot
X-UID: 47                                                  
Status: O
Content-Length: 8111


Greetings,

I have some architectural questions regarding dovecot, and though I've half
answered them by looking at the source, I'm also interested in hearing
whether my (our) wishes and suggestions are already being considered (or can
be considered, once built) for inclusion in dovecot itself.

Let me first explain why I'm doing this. I work for XS4ALL, a fairly large
ISP in the Netherlands. We provide a wide variety of services, including
shell access, pop3, webmail, et cetera. We use Sendmail on several clusters
of FreeBSD machines (loadbalanced using layer-4 ethernet switches) and
several NetApp Filers (dedicated NFS servers with fail-safe disk-arrays and
such) for backend. Several years ago (when we were a lot smaller) we noticed
the typical use of the mailboxes included leaving much old email on the
server, at least for a while, and that this is a bothersome thing when using
mbox mailboxes. (The mboxes basically have to be copied over whenever the
status of an email changes, leading to a lot of I/O.)

We briefly played with modifying sendmail and the pop server to avoid the
full copy in the common case (only status changes) by doing in-place edits
of a pre-generated Status line, as well as avoid full scanning of the mbox
file by creating special headers to mark the 'real' length of an email. It
worked, for a while, but it wasn't going to scale very well. So we switched
to maildir mailboxes for the mail spool. A modified mail.local (which we
need for other reasons as well) delivers in /var/spool/mail/u/s/username,
and mutt, uqwk, a modified pine and qmail's pop3 daemon read it from there.
Until last week our clients could choose to have mbox inboxes, to use with
'elm' or 'mail', but we decided to discontinue that support. Our new shell
servers, which are in test, don't have elm installed anymore anyway.

We still have support for mbox mailboxes in a user's homedirectory though,
by using procmail and such. So when we needed an IMAP server for use with
our webmail (based on SquirrelMail), we were forced to go with the UW-IMAP
server, with the maildir patch that's been scattered around the 'net. This
worked, for a while; we also use the maildir patch with pine after all.
However, the maildir patch is not very good. Not at all, even, and it only
seems to work by pure chance. Pine works for the average user who does not
get a lot of new mail while his pine is open or does not use procmail, and
fortunately a lot of the people that do get a lot of email use mutt, which
does work properly. The UW-IMAP server worked fine because SquirrelMail only
uses (used) a small subset of the available functionality. But that's
changing, as SquirrelMail gets actively developed, and we're also
considering other IMAP-based services. But we can't switch to Courier or
Cyrus because we need mbox support. And while looking for mbox patches for
either of those two, I ran across dovecot. Yay! :)

Dovecot is not everything we'd want, but it comes very close, and contrary
to UW-IMAP both the design and the actual source code are clean, readable
and logical, which means we can add the features we need and support them.
What we need and want to add is fairly simple, but I've only been looking at
dovecot since yesterday so I'd be happy to hear if any of it is possible,
feasible, unwise or unacceptable.

 - First off, we need the maildir support to be 'correct' in that it does
   not rely on the naming of the files in the mailbox, other than the very
   loose specification DJB gives (doesn't contain a colon or slash and
   doesn't start with a dot.) The pine/UW-imap patch breaks here because it
   depends on the first part of the filename being time() or something else
   that, when sorted alphanumerically, puts new mail at the end. Our
   LDA does this, but procmail does not, and it shouldn't have to.

 - Second, we need the maildir support to be 'correct' in that it does not
   rely on the directory order being persistant. The NetApp Filers use
   btree-indexed directories, so the order of readdir() can change
   completely whenever a file is added or removed. The pine/uw-imap patch
   relies on the '.uidvalidity' file being modified whenever the maildir sort
   order changed, and this isn't happening.

I *think*, from reading the sources, both of those are correct already. If
they aren't, I'd strongly urge you to fix it, as #1 is a problem for anyone
using procmail and #2 is a problem for anyone with 'indexed' directories
(including such new filesystems as reiserfs, and I assume FreeBSD's new
hashed directories.)

 - We need to avoid using fcntl(). The Netapps support it, but file-locking
   over NFS is very, very poorly designed and we've had too much problems of
   various kinds before, with fcntl. We also don't like the idea of having
   thousands of fcntl locks at the same time ;P Instead, we've switched to
   the locking method described in the Linux open(2) manpage under O_EXCL.
   (We call it 'dot-locking', I'm not sure where the name came from.)

   The actual implementation of that method is pretty simple, and I have a C
   version and a Python version hanging around here somewhere (the Python
   version is being used by GNU Mailman, last I looked.) If we're going to
   use dovecot, we will replace most, if not all, fcntl()s with dot-locking,
   the question is whether you want it contributed to dovecot :)

 - Every user's incoming mailbox is /var/spool/u/s/username. Other mailboxes
   are in /home/u/username/mail or /home/u/username/Mail (the second if the
   first does not exist.) We are not yet certain whether we want the inbox
   to be able to have subdir-mailboxes, as /var/spool and /home have
   different quotas and we urge people not to store their mail on
   /var/spool. (for one thing, it doesn't get backed-up.) We want these
   things to work without magical symlinks or empty files, because people
   _will_ delete them and cause unnecessary helpdesk calls :) Again, the
   question is mostly whether this is desirable in dovecot (or something
   enough like it to reduce local changes.)

 - We have over 300k mailboxes at the moment. We expect that number to keep
   growing. The indexer process (as described by design.txt) does not sound
   as a good idea in our case :) How necessary is it, really ? Especially
   since we do not expect more than 10% of those mailboxes to be actually
   used by IMAP, not even once. If disabling the indexer completely just
   means longer startup times for IMAP sessions, we can live with that.

 - The UW-IMAP maildir patch stores UID's in the indiviual filenames, using
   a 'U' flag. Will this interfere with dovecot ? We don't really need
   dovecot and UW-IMAP to share UIDs, but we would like to have an as
   painless transition as possible, without having to rename millions of
   files to remove the U flag and other flags :P It would also be nice to
   keep pine using the existing maildir patch, even though very few
   IMAP-users would use pine.

 - Would dovecot scale, architecturally speaking, to 500k+ active mailboxes ?
   The amount of hardware is not really an issue, we can add a lot of
   machines (off-the-shelve intel hadware) to each cluster, but if each
   dovecot process has to load in an index of all possible mailboxes... that
   would be a problem. Doing an inordinate number of file-accesses over NFS
   would also be a problem, but I haven't seen any indication of that in the
   source, yet.

In case it wasn't clear yet, I'm very happy to have found dovecot. The lack
of a decent mbox IMAP server has always dismayed me, let alone an
mbox+maildir one :) I should also point out that even though XS4ALL is a
commercial company, we would contribute our changes even if the licence
didn't require it, and we want to contribute them back the way you want
them, not necessarily the way it's easiest for us. We have a lot of
experience with opensource software, as a simple google on my name should
indicate ;P

Regards,
-- 
Thomas Wouters <thomas@xs4all.net>

Hi! I'm a .signature virus! copy me into your .signature file to help me spread!

From tss@iki.fi  Sat Oct 19 17:01:56 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 19 Oct 2002 17:01:56 +0300 (EEST)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id B8F982382D
	for <dovecot@procontrol.fi>; Sat, 19 Oct 2002 17:01:55 +0300 (EEST)
Received: by hurina (Postfix, from userid 1000)
	id 822415E03E5C; Sat, 19 Oct 2002 17:01:55 +0300 (EEST)
Subject: [dovecot] Re: Architectural questions
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20021019123846.GK543@xs4all.nl>
References: <20021019123846.GK543@xs4all.nl>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1035036115.1674.81.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.1.1.99 (Preview Release)
Date: 19 Oct 2002 17:01:55 +0300
X-archive-position: 48
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 48                                                  
Status: O
Content-Length: 8886

On Sat, 2002-10-19 at 15:38, Thomas Wouters wrote:

> We briefly played with modifying sendmail and the pop server to avoid the
> full copy in the common case (only status changes) by doing in-place edits
> of a pre-generated Status line,

UW-imapd does this as well, creating "X-Keywords:          " line for
each mail. I had thought about this first with dovecot too, but since
mutt rewrote the whole mailbox always I figured I might as well. But
with larger mailboxes this is really slow, so I think I'll support the
X-keywords trick myself too.

>  as well as avoid full scanning of the mbox
> file by creating special headers to mark the 'real' length of an email.

For each mail? Content-Length? With my tests that didn't seem to help
much, rather made it just slower.. Could be that I just did something
badly, have to look into it more when I begin optimizing mbox handling
more. Have to get it at least as fast as UW-imapd :)

> We still have support for mbox mailboxes in a user's homedirectory though,
> by using procmail and such. So when we needed an IMAP server for use with
> our webmail (based on SquirrelMail), we were forced to go with the UW-IMAP
> server, with the maildir patch that's been scattered around the 'net. This

Hm. Squirrelmail requires SORT extension which Dovecot doesn't support
yet. Notes about SORT from CVS's TODO:

 - sort (draft-ietf-imapext-sort)
    - basically sorted SEARCH, requiring CHARSET support for
      UTF-8 and ASCII
    - we could create alternative binary tree file(s) for different sort
      conditions, ".tree-sort" or something. or if we decide to just
      keep it in memory, btree could still be best choice.
    - required by squirrelmail (webmail)

>  - First off, we need the maildir support to be 'correct' in that it does
>    not rely on the naming of the files in the mailbox, other than the very
>    loose specification DJB gives (doesn't contain a colon or slash and
>    doesn't start with a dot.) The pine/UW-imap patch breaks here because it
>    depends on the first part of the filename being time() or something else
>    that, when sorted alphanumerically, puts new mail at the end. Our
>    LDA does this, but procmail does not, and it shouldn't have to.

Dovecot doesn't care as long as the file name stays same before the ':'
character.

>  - Second, we need the maildir support to be 'correct' in that it does not
>    rely on the directory order being persistant. The NetApp Filers use
>    btree-indexed directories, so the order of readdir() can change
>    completely whenever a file is added or removed. The pine/uw-imap patch
>    relies on the '.uidvalidity' file being modified whenever the maildir sort
>    order changed, and this isn't happening.

Dovecot reads them into hash so it doesn't depend on readdir()
behaviour.

>  - We need to avoid using fcntl(). The Netapps support it, but file-locking
>    over NFS is very, very poorly designed and we've had too much problems of
>    various kinds before, with fcntl. We also don't like the idea of having
>    thousands of fcntl locks at the same time ;P Instead, we've switched to
>    the locking method described in the Linux open(2) manpage under O_EXCL.
>    (We call it 'dot-locking', I'm not sure where the name came from.)

Hmm. The dot-lock means the "mbox.lock" file which gets created when
someone wants it exclusively locked. Dovecot supports it, and maildir
itself doesn't need locking at all. Dovecot's index files currently use
fcntl()-locking, but it would be possible to replace them with lock
files.

Then there's modify log file. Dovecot uses fcntl() locking for it as a
way to figure out if it's the only one using the log file. Like make
everyone read-lock the file, then if someone wants to know if it's the
only one using it it tries to set write-lock on, if it fails it knows
someone else it using it as well. I'm not sure if there's any good way
to replace that by using files, I had pretty complicated (desperate)
plans before figuring out fcntl() could be used to do it easily.

It would be possible to just assume that there's always someone else
using the modify log, but each flag change or expunge would always write
a few bytes to it then, and when log file is switched (there's .log and
.log.2) it wouldn't be truncated after last process is finished with it
which is not too bad since after the next switch it will be truncated.

Also it would be possible not to use index files at all but just keep
them in memory. I've been fixing code to make this possible and somewhat
fast.

> If we're going to
>    use dovecot, we will replace most, if not all, fcntl()s with dot-locking,
>    the question is whether you want it contributed to dovecot :)

All locking goes through file_*_lock() or mbox_lock_*() functions. mbox
locking supports it already, and file_*_lock() could be made to support
it. It doesn't get currently file name but that could be done.

>  - Every user's incoming mailbox is /var/spool/u/s/username. Other mailboxes
>    are in /home/u/username/mail or /home/u/username/Mail (the second if the
>    first does not exist.) We are not yet certain whether we want the inbox
>    to be able to have subdir-mailboxes, as /var/spool and /home have
>    different quotas and we urge people not to store their mail on
>    /var/spool. (for one thing, it doesn't get backed-up.) We want these
>    things to work without magical symlinks or empty files, because people
>    _will_ delete them and cause unnecessary helpdesk calls :) Again, the
>    question is mostly whether this is desirable in dovecot (or something
>    enough like it to reduce local changes.)

Are maildir inboxes also in /var/spool? With mbox sub-inboxes wouldn't
be even possible because dir structure == mailbox structure, and since
inbox file exists there can't be inbox-dir (except maybe with different
case but that's kludgy).

I've also thought I might as well make it possible to read the mbox
inbox from /var/mail or whereever it is. Pretty easy to do, but .lock
file is problematic if new files can't be added to the /var/mail
directory.

>  - We have over 300k mailboxes at the moment. We expect that number to keep
>    growing. The indexer process (as described by design.txt) does not sound
>    as a good idea in our case :) How necessary is it, really ? Especially
>    since we do not expect more than 10% of those mailboxes to be actually
>    used by IMAP, not even once. If disabling the indexer completely just
>    means longer startup times for IMAP sessions, we can live with that.

Indexer doesn't exist yet, and wouldn't be really needed even. I still
think it could be somewhat nice idea, the system load is probably less
during night so we could use the extra time to make mailboxes perform
faster next day.

It'd be difficult to know when exactly there is "extra time" which is
why I haven't yet done the indexer. Probably needs some external program
(script) which tells it by maybe looking at some I/O statistics from
/proc or doing a few file operations and checking the latency.

Am I right in that CPU usage still isn't any problem but rather the I/O?

>  - The UW-IMAP maildir patch stores UID's in the indiviual filenames, using
>    a 'U' flag. Will this interfere with dovecot ? We don't really need
>    dovecot and UW-IMAP to share UIDs, but we would like to have an as
>    painless transition as possible, without having to rename millions of
>    files to remove the U flag and other flags :P It would also be nice to
>    keep pine using the existing maildir patch, even though very few
>    IMAP-users would use pine.

How exactly does the U flag work? I hope it's before the ':' character
like Courier's S=filesize? Otherwise U=1234 would be thought of as 6
different flags which isn't very good since Dovecot reorders them as
1234=U.

>  - Would dovecot scale, architecturally speaking, to 500k+ active mailboxes ?
>    The amount of hardware is not really an issue, we can add a lot of
>    machines (off-the-shelve intel hadware) to each cluster, but if each
>    dovecot process has to load in an index of all possible mailboxes... that
>    would be a problem. Doing an inordinate number of file-accesses over NFS
>    would also be a problem, but I haven't seen any indication of that in the
>    source, yet.

Dovecot opens the index when opening mailbox. It doesn't open other
mailboxes indexes. Also the indexes should make the file accesses less
than otherwise, especially with mbox since it wouldn't need to read and
parse the whole mbox file. In general I've tried to keep the file I/O as
little as possible.

If your clusters access the files through NFS, there should be no
problem. Except I've never tried Dovecot through NFS, and I'm not sure
how well mmap()ing works through NFS. I know there's been problems
before but hopefully they've been fixed already.



From thomas@xs4all.net  Sat Oct 19 18:11:38 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 19 Oct 2002 18:11:38 +0300 (EEST)
Return-Path: <thomas@xs4all.net>
Delivered-To: dovecot@procontrol.fi
Received: from smtpzilla3.xs4all.nl (smtpzilla3.xs4all.nl [194.109.127.139])
	by danu.procontrol.fi (Postfix) with ESMTP id F2204238A7
	for <dovecot@procontrol.fi>; Sat, 19 Oct 2002 18:11:37 +0300 (EEST)
Received: from centurion.xs4all.nl (centurion.xs4all.nl [194.109.0.100])
	by smtpzilla3.xs4all.nl (8.12.0/8.12.0) with ESMTP id g9JFBbW0074539;
	Sat, 19 Oct 2002 17:11:37 +0200 (CEST)
Received: by centurion.xs4all.nl (Postfix, from userid 1000)
	id 9191F2268; Sat, 19 Oct 2002 17:10:26 +0200 (CEST)
Date: Sat, 19 Oct 2002 17:10:26 +0200
From: Thomas Wouters <thomas@xs4all.net>
To: Timo Sirainen <tss@iki.fi>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: Architectural questions
Message-ID: <20021019151026.GM543@xs4all.nl>
References: <20021019123846.GK543@xs4all.nl> <1035036115.1674.81.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1035036115.1674.81.camel@hurina>
User-Agent: Mutt/1.4i
X-message-flag: Danger Will Robinson!
X-archive-position: 49
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: thomas@xs4all.net
Precedence: bulk
X-list: dovecot
X-UID: 49                                                  
Status: O
Content-Length: 7406

On Sat, Oct 19, 2002 at 05:01:55PM +0300, Timo Sirainen wrote:
> On Sat, 2002-10-19 at 15:38, Thomas Wouters wrote:

> > We briefly played with modifying sendmail and the pop server to avoid the
> > full copy in the common case (only status changes) by doing in-place edits
> > of a pre-generated Status line,

> UW-imapd does this as well, creating "X-Keywords:          " line for
> each mail. I had thought about this first with dovecot too, but since
> mutt rewrote the whole mailbox always I figured I might as well. But
> with larger mailboxes this is really slow, so I think I'll support the
> X-keywords trick myself too.

Well, for POP3 servers the story is a bit different than IMAP. The typical
use we were seeing was "user", "pass", "list", "retr <new mail>", "quit".
Sometimes (for some users) every few minutes. In that case, having to write
a 'RO' at a specific location in a large mbox is oodles more efficient than
copying the whole thing to local disk and back again (which is what the
popserver would do.) I'm not sure if it matters much with typical IMAP
usage.

> > as well as avoid full scanning of the mbox file by creating special
> > headers to mark the 'real' length of an email.

> For each mail? Content-Length? With my tests that didn't seem to help
> much, rather made it just slower.. Could be that I just did something
> badly, have to look into it more when I begin optimizing mbox handling
> more. Have to get it at least as fast as UW-imapd :)

Well, if I recall correctly, we added an 'X-Offset' header which pointed to
the exact (relative) byte offset for the next 'From ' line. It made our
pop3d (a modified qpopper 2.3 by the way) a much happier puppy. I'm not sure
what the difference with Content-Length was. I could find the sources, I
suppose; since we disabled mbox-inbox support we aren't using that code
anymore.

> > We still have support for mbox mailboxes in a user's homedirectory though,
> > by using procmail and such. So when we needed an IMAP server for use with
> > our webmail (based on SquirrelMail), we were forced to go with the UW-IMAP
> > server, with the maildir patch that's been scattered around the 'net. This

> Hm. Squirrelmail requires SORT extension which Dovecot doesn't support
> yet.

Ah, that's a shame. It means we can't use dovecot for our internal
SquirrelMail+IMAP testing yet :) We likely wouldn't start using dovecot for
production SquirrelMail anytime soon anyway, so it's not a big issue right
now... We'll have to see if our other uses of IMAP require it or not.

> Dovecot doesn't care [about maildir-message filenames] as long as the file
> name stays same before the ':' character.

They do.

> It would be possible to just assume that there's always someone else
> using the modify log, but each flag change or expunge would always write
> a few bytes to it then, and when log file is switched (there's .log and
> .log.2) it wouldn't be truncated after last process is finished with it
> which is not too bad since after the next switch it will be truncated.

> Also it would be possible not to use index files at all but just keep
> them in memory. I've been fixing code to make this possible and somewhat
> fast.

Hmm. I'd have to look at the code to say for sure, but I think we could live
with keeping them in memory. Accessing the same mailbox from two different
clients at the same time is not something we're too worried about, at the
moment.

> >  - Every user's incoming mailbox is /var/spool/u/s/username.

> Are maildir inboxes also in /var/spool? 

Yes. We don't use the ~/Maildir structure at all. We've always simply used
maildir mailboxes as a directly replacement of mbox mailboxes; a directory
instead of a file, and no sub-boxes :) I guess it's a philosphical
difference. To me, and to my colleagues, everything can be a mailbox, not
just something stored in an arbitrary directory somewhere. I guess we could
change that position, if necessary, but so far it hasn't proven to be.

> With mbox sub-inboxes wouldn't be even possible because dir structure ==
> mailbox structure, and since inbox file exists there can't be inbox-dir
> (except maybe with different case but that's kludgy).

Yes... don't worry, we don't even want to consider mbox-subboxes :)

> I've also thought I might as well make it possible to read the mbox
> inbox from /var/mail or whereever it is. Pretty easy to do, but .lock
> file is problematic if new files can't be added to the /var/mail
> directory.

Our /var/spool/mail subdirectories are mode 01733 (drwx-wx-wt) owned by
root, so creating files and removing them is not an issue, but reading the
directory is. You can of course still check for existance of specific
filenames.

> Am I right in that CPU usage still isn't any problem but rather the I/O?

Yes. As I said, we use several netapp filers (currently two for /home and
two for /var/spool/mail, with several hundred gigabytes filespace each) and
though they're great boxes, their performance does tend to drop off when it
gets flooded with I/O requests :) And they're used by a lot of machines, so
if they are slow to respond, a lot of our services do too.

> >  - The UW-IMAP maildir patch stores UID's in the indiviual filenames, using
> >    a 'U' flag. Will this interfere with dovecot ? We don't really need
> >    dovecot and UW-IMAP to share UIDs, but we would like to have an as
> >    painless transition as possible, without having to rename millions of
> >    files to remove the U flag and other flags :P It would also be nice to
> >    keep pine using the existing maildir patch, even though very few
> >    IMAP-users would use pine.

> How exactly does the U flag work? I hope it's before the ':' character
> like Courier's S=filesize? Otherwise U=1234 would be thought of as 6
> different flags which isn't very good since Dovecot reorders them as
> 1234=U.

No, it can't be before the :, because the UID is generated by UW-IMAP, and
the maildir spec says you can't change the uniqe part of the name, just the
info :) Here are some examples. The ',U*' is the UID.

_k2,6NtZ9.maildrop4.xs4all.nl:2,S,U1030712092
_fmT,O63l8.maildrop8.xs4all.nl:2,RS,U1026644784
990612135.16312.000000002.maildrop2.xs4all.nl:2,S,U991994304
993058841.maildrop7.49267:2,S,U993058888

(In case you're wondering, the first two files were created by standard
procmail, the third by our modified procmail which tries to allow for the
pine/uw-imap maildir patch, and the last is our mail.local's format.)

As long as dovecot doesn't read a different meaning into those flags
(ignoring them is just fine) we should be fine. I don't think we'll have
many customers switching back and forth between dovecot and UW-IMAP, just
people switching from UW-IMAP to dovecot.

> If your clusters access the files through NFS, there should be no
> problem. Except I've never tried Dovecot through NFS, and I'm not sure
> how well mmap()ing works through NFS. I know there's been problems
> before but hopefully they've been fixed already.

I'm not too worried about bugs. I've yet to see a piece of software that we
don't find oodles of small and large bugs in just by installing and trying
to run on our clientbase. That's what testing is for :) But I wouldn't mind
being happily suprised by dovecot, we'll see :)

-- 
Thomas Wouters <thomas@xs4all.net>

Hi! I'm a .signature virus! copy me into your .signature file to help me spread!

From tss@iki.fi  Sat Oct 19 18:53:44 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 19 Oct 2002 18:53:44 +0300 (EEST)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id C511F2382D
	for <dovecot@procontrol.fi>; Sat, 19 Oct 2002 18:53:43 +0300 (EEST)
Received: by hurina (Postfix, from userid 1000)
	id 941B65E03E5C; Sat, 19 Oct 2002 18:53:43 +0300 (EEST)
Subject: [dovecot] Re: Architectural questions
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20021019151026.GM543@xs4all.nl>
References: <20021019123846.GK543@xs4all.nl>
	 <1035036115.1674.81.camel@hurina>  <20021019151026.GM543@xs4all.nl>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1035042823.1679.127.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.1.1.99 (Preview Release)
Date: 19 Oct 2002 18:53:43 +0300
X-archive-position: 50
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 50                                                  
Status: O
Content-Length: 4750

On Sat, 2002-10-19 at 18:10, Thomas Wouters wrote:
> Well, if I recall correctly, we added an 'X-Offset' header which pointed to
> the exact (relative) byte offset for the next 'From ' line. It made our
> pop3d (a modified qpopper 2.3 by the way) a much happier puppy. I'm not sure
> what the difference with Content-Length was. I could find the sources, I
> suppose; since we disabled mbox-inbox support we aren't using that code
> anymore.

Content-Length saves just the size of mail body, so it can be skipped
over. I implemented it mostly because mutt doesn't escape the "From "
lines when saving mails so it was a bit difficult sometimes to figure
out if the From-line means a new mail or if it was just written into the
mail body.

I'm not sure what I should do with Dovecot, both From-line escaping and
Content-Length writing makes it annoyingly slower then now with more 
code..

> > Also it would be possible not to use index files at all but just keep
> > them in memory. I've been fixing code to make this possible and somewhat
> > fast.
> 
> Hmm. I'd have to look at the code to say for sure, but I think we could live
> with keeping them in memory. Accessing the same mailbox from two different
> clients at the same time is not something we're too worried about, at the
> moment.

Well, Outlook (and OE I think) opens two simultaneous connections
sometimes to fetch mails.

Not having index files doesn't affect the possibility to have multiple
connections, but it affects the overall performance because it needs to
do more I/O, especially with mbox.

> > I've also thought I might as well make it possible to read the mbox
> > inbox from /var/mail or whereever it is. Pretty easy to do, but .lock
> > file is problematic if new files can't be added to the /var/mail
> > directory.
> 
> Our /var/spool/mail subdirectories are mode 01733 (drwx-wx-wt) owned by
> root, so creating files and removing them is not an issue, but reading the
> directory is. You can of course still check for existance of specific
> filenames.

OK, no problem then.

> > How exactly does the U flag work? I hope it's before the ':' character
> > like Courier's S=filesize? Otherwise U=1234 would be thought of as 6
> > different flags which isn't very good since Dovecot reorders them as
> > 1234=U.
> 
> No, it can't be before the :, because the UID is generated by UW-IMAP, and
> the maildir spec says you can't change the uniqe part of the name, just the
> info :) Here are some examples. The ',U*' is the UID.
> 
> _k2,6NtZ9.maildrop4.xs4all.nl:2,S,U1030712092
> _fmT,O63l8.maildrop8.xs4all.nl:2,RS,U1026644784
> 990612135.16312.000000002.maildrop2.xs4all.nl:2,S,U991994304
> 993058841.maildrop7.49267:2,S,U993058888

Well, maildir spec also doesn't say you can add flags with parameters
using comma separators :) But I think that's good enough extension that
Dovecot could support as well.

Programs supporting Courier's Maildir++ quota writes the mails
immediately like "something,S=size". Something like that could have been
done by UID-capable mailers too, since UID won't change.

> As long as dovecot doesn't read a different meaning into those flags
> (ignoring them is just fine) we should be fine. I don't think we'll have
> many customers switching back and forth between dovecot and UW-IMAP, just
> people switching from UW-IMAP to dovecot.

Keeping the UIDs untouched when changing could be important to some
people whose mail clients can save some extra information related to
specific messages and use UID to identify the mails. I think Evolution
does this with it's labels and Follow-Up marks, but I'm not sure.

Dovecot currently doesn't try to keep the UIDs too heavily itself
either, if it notices some corruption it just recreates the index files
with new UIDs. Supporting in-memory indexes requires still saving the
UIDs somewhere in disk so this should get fixed while doing it.

> I'm not too worried about bugs. I've yet to see a piece of software that we
> don't find oodles of small and large bugs in just by installing and trying
> to run on our clientbase. That's what testing is for :) But I wouldn't mind
> being happily suprised by dovecot, we'll see :)

We've had 3 people using it for a few months now, one of them still gets
sometimes "message not found" error from Outlook Express, I've yet to
figure out when exactly that happens. The mail isn't lost and restarting
OE helps, so it's probably something to do with having those two
simultaneous connections (and I'm just now making bigger changes there).
Other than that it's worked quite fine :)

Then of course CVS has a lot large changes which haven't been tested
much yet. Hopefully I'll get them fixed well enough this weekend to be
able to start using it myself.


From tss@iki.fi  Sat Oct 19 19:11:49 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 19 Oct 2002 19:11:49 +0300 (EEST)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id D02AC2382D
	for <dovecot@procontrol.fi>; Sat, 19 Oct 2002 19:11:49 +0300 (EEST)
Received: by hurina (Postfix, from userid 1000)
	id 9813D5E03E5C; Sat, 19 Oct 2002 19:11:49 +0300 (EEST)
Subject: [dovecot] Re: Architectural questions
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20021019151026.GM543@xs4all.nl>
References: <20021019123846.GK543@xs4all.nl>
	 <1035036115.1674.81.camel@hurina>  <20021019151026.GM543@xs4all.nl>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1035043909.31051.140.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.1.1.99 (Preview Release)
Date: 19 Oct 2002 19:11:49 +0300
X-archive-position: 51
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 51                                                  
Status: O
Content-Length: 1060

On Sat, 2002-10-19 at 18:10, Thomas Wouters wrote:
> > Am I right in that CPU usage still isn't any problem but rather the I/O?
> 
> Yes. As I said, we use several netapp filers (currently two for /home and
> two for /var/spool/mail, with several hundred gigabytes filespace each) and
> though they're great boxes, their performance does tend to drop off when it
> gets flooded with I/O requests :) And they're used by a lot of machines, so
> if they are slow to respond, a lot of our services do too.

I was mostly wondering with this if the reason to add more computers to
cluster is because the imap processes are taking too much memory, too
much CPU or if neither of them is any problem and the cluster is just
for redundancy or because of other running programs.

I'd be interested to know how many dovecot processes could actually run
in a single computer especially with fast NFS file access :) I'd guess
it could run a lot, but when memory gets low the I/O usage raises since
it needs to read again the parts of indexes which got dropped from
memory.


From faulerhund@faulerhund.net  Sat Oct 19 19:24:01 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 19 Oct 2002 19:24:02 +0300 (EEST)
Return-Path: <faulerhund@faulerhund.net>
Delivered-To: dovecot@procontrol.fi
Received: from moutvdom.kundenserver.de (moutvdom.kundenserver.de [195.20.224.130])
	by danu.procontrol.fi (Postfix) with ESMTP id D51E6238A7
	for <dovecot@procontrol.fi>; Sat, 19 Oct 2002 19:24:01 +0300 (EEST)
Received: from [212.227.126.220] (helo=mrvdomng.kundenserver.de)
	by moutvdom.kundenserver.de with esmtp (Exim 3.35 #1)
	id 182wON-00080b-00
	for dovecot@procontrol.fi; Sat, 19 Oct 2002 18:23:59 +0200
Received: from [217.229.166.89] (helo=Bini)
	by mrvdomng.kundenserver.de with smtp (Exim 3.35 #1)
	id 182wON-0001BG-00
	for dovecot@procontrol.fi; Sat, 19 Oct 2002 18:23:59 +0200
Message-ID: <003b01c2778c$a6884370$0164a8c0@Bini>
From: "Korbinian Riedhammer" <faulerhund@faulerhund.net>
To: "Dovecot Mailinglist" <dovecot@procontrol.fi>
Subject: [dovecot] still problems gettin it to work
Date: Sat, 19 Oct 2002 18:29:08 +0200
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: 7bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2600.0000
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2600.0000
X-archive-position: 52
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: faulerhund@faulerhund.net
Precedence: bulk
X-list: dovecot
X-UID: 52                                                  
Status: O

i checked all my options again. could it be, that it is a problem with my
compiler? does dovecot support gcc3.2 with glibc 2.2.5?

korbinian


From tss@iki.fi  Sat Oct 19 19:27:45 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 19 Oct 2002 19:27:45 +0300 (EEST)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 4F2F5238A7
	for <dovecot@procontrol.fi>; Sat, 19 Oct 2002 19:27:45 +0300 (EEST)
Received: by hurina (Postfix, from userid 1000)
	id 0ECE55E03E5C; Sat, 19 Oct 2002 19:27:45 +0300 (EEST)
Subject: [dovecot] Re: still problems gettin it to work
From: Timo Sirainen <tss@iki.fi>
To: Korbinian Riedhammer <faulerhund@faulerhund.net>
Cc: Dovecot Mailinglist <dovecot@procontrol.fi>
In-Reply-To: <003b01c2778c$a6884370$0164a8c0@Bini>
References: <003b01c2778c$a6884370$0164a8c0@Bini>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1035044864.1674.143.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.1.1.99 (Preview Release)
Date: 19 Oct 2002 19:27:44 +0300
X-archive-position: 53
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 53                                                  
Status: O

On Sat, 2002-10-19 at 19:29, Korbinian Riedhammer wrote:
> i checked all my options again. could it be, that it is a problem with my
> compiler? does dovecot support gcc3.2 with glibc 2.2.5?

Well, what's the problem with it now? Didn't that /dev/urandom problem
go away with unsetting auth_chroot setting?


From faulerhund@faulerhund.net  Sat Oct 19 19:56:55 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 19 Oct 2002 19:56:55 +0300 (EEST)
Return-Path: <faulerhund@faulerhund.net>
Delivered-To: dovecot@procontrol.fi
Received: from moutvdom.kundenserver.de (moutvdom.kundenserver.de [195.20.224.149])
	by danu.procontrol.fi (Postfix) with ESMTP id 699AF238A7
	for <dovecot@procontrol.fi>; Sat, 19 Oct 2002 19:56:55 +0300 (EEST)
Received: from [212.227.126.220] (helo=mrvdomng.kundenserver.de)
	by moutvdom.kundenserver.de with esmtp (Exim 3.35 #1)
	id 182wuE-0005AD-00
	for dovecot@procontrol.fi; Sat, 19 Oct 2002 18:56:54 +0200
Received: from [217.229.166.89] (helo=Bini)
	by mrvdomng.kundenserver.de with smtp (Exim 3.35 #1)
	id 182wuE-0002u1-00
	for dovecot@procontrol.fi; Sat, 19 Oct 2002 18:56:54 +0200
Message-ID: <005d01c27791$4011d930$0164a8c0@Bini>
From: "Korbinian Riedhammer" <faulerhund@faulerhund.net>
To: "Dovecot Mailinglist" <dovecot@procontrol.fi>
Subject: [dovecot] Re: still problems gettin it to work
Date: Sat, 19 Oct 2002 19:02:03 +0200
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: 7bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2600.0000
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2600.0000
X-archive-position: 54
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: faulerhund@faulerhund.net
Precedence: bulk
X-list: dovecot
X-UID: 54                                                  
Status: O

well i didn't know what to change, cause u wrote that this change u did is
pretty useless rinning the prog as root, what i do. next thing that i dont
have any idea about cvs (beside knowing its meaning) and dont hav it
installed yet.


From tss@iki.fi  Sat Oct 19 19:59:22 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 19 Oct 2002 19:59:22 +0300 (EEST)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id C7B16238A7
	for <dovecot@procontrol.fi>; Sat, 19 Oct 2002 19:59:22 +0300 (EEST)
Received: by hurina (Postfix, from userid 1000)
	id 99EA15E03E5C; Sat, 19 Oct 2002 19:59:22 +0300 (EEST)
Subject: [dovecot] Re: still problems gettin it to work
From: Timo Sirainen <tss@iki.fi>
To: Korbinian Riedhammer <faulerhund@faulerhund.net>
Cc: Dovecot Mailinglist <dovecot@procontrol.fi>
In-Reply-To: <005d01c27791$4011d930$0164a8c0@Bini>
References: <005d01c27791$4011d930$0164a8c0@Bini>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1035046762.1674.148.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.1.1.99 (Preview Release)
Date: 19 Oct 2002 19:59:22 +0300
X-archive-position: 55
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 55                                                  
Status: O

On Sat, 2002-10-19 at 20:02, Korbinian Riedhammer wrote:
> well i didn't know what to change, cause u wrote that this change u did is
> pretty useless rinning the prog as root, what i do. next thing that i dont
> have any idea about cvs (beside knowing its meaning) and dont hav it
> installed yet.

Well, just don't set the auth_chroot and ignores the rest of what I
said. That should get it working.

From faulerhund@faulerhund.net  Sat Oct 19 20:04:30 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 19 Oct 2002 20:04:30 +0300 (EEST)
Return-Path: <faulerhund@faulerhund.net>
Delivered-To: dovecot@procontrol.fi
Received: from moutvdom.kundenserver.de (moutvdom.kundenserver.de [195.20.224.200])
	by danu.procontrol.fi (Postfix) with ESMTP id 969F2238A7
	for <dovecot@procontrol.fi>; Sat, 19 Oct 2002 20:04:30 +0300 (EEST)
Received: from [195.20.224.206] (helo=mrvdomng.kundenserver.de)
	by moutvdom.kundenserver.de with esmtp (Exim 3.35 #1)
	id 182x1a-0002pK-00
	for dovecot@procontrol.fi; Sat, 19 Oct 2002 19:04:30 +0200
Received: from [217.229.166.89] (helo=Bini)
	by mrvdomng.kundenserver.de with smtp (Exim 3.35 #1)
	id 182x1Z-0003C1-00
	for dovecot@procontrol.fi; Sat, 19 Oct 2002 19:04:30 +0200
Message-ID: <006701c27792$4f863040$0164a8c0@Bini>
From: "Korbinian Riedhammer" <faulerhund@faulerhund.net>
To: "Dovecot Mailinglist" <dovecot@procontrol.fi>
Subject: [dovecot] Re: still problems gettin it to work
Date: Sat, 19 Oct 2002 19:09:39 +0200
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: 7bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2600.0000
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2600.0000
X-archive-position: 56
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: faulerhund@faulerhund.net
Precedence: bulk
X-list: dovecot
X-UID: 56                                                  
Status: O

yeah, the nasty error msgs are gone :)
well next question. where looks the dovcot imapd for the mail dir? /var/mail
or the homedir? 'cause i saved my Maildir in /home/user


From tss@iki.fi  Sat Oct 19 20:08:34 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 19 Oct 2002 20:08:34 +0300 (EEST)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 4C086238A7
	for <dovecot@procontrol.fi>; Sat, 19 Oct 2002 20:08:34 +0300 (EEST)
Received: by hurina (Postfix, from userid 1000)
	id 0FC605E03E5C; Sat, 19 Oct 2002 20:08:31 +0300 (EEST)
Subject: [dovecot] Re: still problems gettin it to work
From: Timo Sirainen <tss@iki.fi>
To: Dovecot Mailinglist <dovecot@procontrol.fi>
In-Reply-To: <006701c27792$4f863040$0164a8c0@Bini>
References: <006701c27792$4f863040$0164a8c0@Bini>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1035047310.1674.152.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.1.1.99 (Preview Release)
Date: 19 Oct 2002 20:08:30 +0300
X-archive-position: 57
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 57                                                  
Status: O

On Sat, 2002-10-19 at 20:09, Korbinian Riedhammer wrote:
> yeah, the nasty error msgs are gone :)
> well next question. where looks the dovcot imapd for the mail dir? /var/mail
> or the homedir? 'cause i saved my Maildir in /home/user

It uses ~/Maildir always.


From faulerhund@faulerhund.net  Sat Oct 19 20:17:48 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 19 Oct 2002 20:17:48 +0300 (EEST)
Return-Path: <faulerhund@faulerhund.net>
Delivered-To: dovecot@procontrol.fi
Received: from moutvdom.kundenserver.de (moutvdom.kundenserver.de [195.20.224.131])
	by danu.procontrol.fi (Postfix) with ESMTP id 555172382D
	for <dovecot@procontrol.fi>; Sat, 19 Oct 2002 20:17:48 +0300 (EEST)
Received: from [212.227.126.220] (helo=mrvdomng.kundenserver.de)
	by moutvdom.kundenserver.de with esmtp (Exim 3.35 #1)
	id 182xES-0000X5-00
	for dovecot@procontrol.fi; Sat, 19 Oct 2002 19:17:48 +0200
Received: from [217.229.166.89] (helo=Bini)
	by mrvdomng.kundenserver.de with smtp (Exim 3.35 #1)
	id 182xER-0003ij-00
	for dovecot@procontrol.fi; Sat, 19 Oct 2002 19:17:47 +0200
Message-ID: <008901c27794$2b0de030$0164a8c0@Bini>
From: "Korbinian Riedhammer" <faulerhund@faulerhund.net>
To: "Dovecot Mailinglist" <dovecot@procontrol.fi>
Subject: [dovecot] Re: still problems gettin it to work
Date: Sat, 19 Oct 2002 19:22:57 +0200
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: 7bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2600.0000
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2600.0000
X-archive-position: 58
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: faulerhund@faulerhund.net
Precedence: bulk
X-list: dovecot
X-UID: 58                                                  
Status: O

well finally it was my own stupidness!
i just forgot to set some correct permissions, now everythings fine!

thx anyway
korbinian


From ianj@ian-justman.com  Sun Oct 20 09:38:35 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 20 Oct 2002 09:38:35 +0300 (EEST)
Return-Path: <ianj@ian-justman.com>
Delivered-To: dovecot@procontrol.fi
Received: from narshe.chocobo.org (dsl-207-126-72-242.dsl.netasset.net [207.126.72.242])
	by danu.procontrol.fi (Postfix) with ESMTP id C321D238A7
	for <dovecot@procontrol.fi>; Sun, 20 Oct 2002 09:38:34 +0300 (EEST)
Received: from zozo.intrn.chocobo.org (zozo.chocobo.org [207.126.72.244])
	by narshe.chocobo.org (Postfix) with ESMTP id 18975311609
	for <dovecot@procontrol.fi>; Sat, 19 Oct 2002 23:38:31 -0700 (PDT)
Received: by zozo.intrn.chocobo.org (Postfix, from userid 501)
	id 5C94C870704; Sat, 19 Oct 2002 23:38:30 -0700 (PDT)
Received: from localhost (localhost [127.0.0.1])
	by zozo.intrn.chocobo.org (Postfix) with ESMTP id 10A40449AD4
	for <dovecot@procontrol.fi>; Sat, 19 Oct 2002 23:38:29 -0700 (PDT)
Date: Sat, 19 Oct 2002 23:38:29 -0700 (PDT)
From: "Ian R. Justman" <ianj@ian-justman.com>
X-X-Sender: ianj@zozo.chocobo.org
To: Dovecot Mailinglist <dovecot@procontrol.fi>
Subject: [dovecot] observations/qestions of mbox concurrency ability (Yay!) on current
 CVS
Message-ID: <Pine.LNX.4.44.0210192329040.24843-100000@zozo.chocobo.org>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 59
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: ianj@ian-justman.com
Precedence: bulk
X-list: dovecot
X-UID: 59                                                  
Status: O


Hi, all.

Just been testing out the latest "CVS" (in quotes because  I'm rsyncing
the source
tree) versions of Dovecot lately.

Tested having Pine on the machine on which Dovecot was running, talking
IMAP, as well as another Pine instance, this time from my Windows machine
over the wire.  Things seem to be working wonderfully.  Deleted a message
using one instance, then refreshed the list on the other.  *poof*  Gone.

Though I'm seeing periodic "IMAP protocol error" messages in Pine, but
they don't seem to be affecting the software's operation that I can see.

Anything in particular I should be on the lookout for?

Otherwise, you just made my day.  Correction; week.  :D

--Ian.


From tss@iki.fi  Sun Oct 20 16:47:50 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 20 Oct 2002 16:47:50 +0300 (EEST)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 84B752382D
	for <dovecot@procontrol.fi>; Sun, 20 Oct 2002 16:47:50 +0300 (EEST)
Received: by hurina (Postfix, from userid 1000)
	id 6AC945E03E5C; Sun, 20 Oct 2002 16:47:49 +0300 (EEST)
Subject: [dovecot] Re: observations/qestions of mbox concurrency ability
	(Yay!) on current CVS
From: Timo Sirainen <tss@iki.fi>
To: "Ian R. Justman" <ianj@ian-justman.com>
Cc: Dovecot Mailinglist <dovecot@procontrol.fi>
In-Reply-To: <Pine.LNX.4.44.0210192329040.24843-100000@zozo.chocobo.org>
References: <Pine.LNX.4.44.0210192329040.24843-100000@zozo.chocobo.org>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1035121669.24867.8.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.1.1.99 (Preview Release)
Date: 20 Oct 2002 16:47:49 +0300
X-archive-position: 60
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 60                                                  
Status: O
Content-Length: 1458

On Sun, 2002-10-20 at 09:38, Ian R. Justman wrote:
> Tested having Pine on the machine on which Dovecot was running, talking
> IMAP, as well as another Pine instance, this time from my Windows machine
> over the wire.  Things seem to be working wonderfully.  Deleted a message
> using one instance, then refreshed the list on the other.  *poof*  Gone.
> 
> Though I'm seeing periodic "IMAP protocol error" messages in Pine, but
> they don't seem to be affecting the software's operation that I can see.
> 
> Anything in particular I should be on the lookout for?

By default Dovecot uses .lock file and flock() locking. Some programs
may use fcntl() which doesn't work with flock(), but most use .lock file
as well so it doesn't really matter. I'm going to make the locking style
configurable later.

Anyway, I don't know of any reasons for mailbox corruption, but we don't
lock the mailbox when reading from it, so it is possible that someone
else might modify (expunge) the mailbox while Dovecot is reading it and
the IMAP client gets corrupted message.

I was thinking about fixing this using read-locking fcntl() / flock().
Maybe it could optionally create the .lock file as well, but that'd slow
down simultaneous reads.

Oh, and the mbox parsing code could use better checking, if there's any
bugs it will corrupt the mailbox at expunge/flag rewrite. I haven't seen
those though for the month or two that I've been using Dovecot+mbox to
read my mail.


From thomas@xs4all.net  Mon Oct 21 14:53:07 2002
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 21 Oct 2002 14:53:07 +0300 (EEST)
Return-Path: <thomas@xs4all.net>
Delivered-To: dovecot@procontrol.fi
Received: from smtpzilla1.xs4all.nl (smtpzilla1.xs4all.nl [194.109.127.137])
	by danu.procontrol.fi (Postfix) with ESMTP id 4333B2382D
	for <dovecot@procontrol.fi>; Mon, 21 Oct 2002 14:53:07 +0300 (EEST)
Received: from centurion.xs4all.nl (centurion.xs4all.nl [194.109.0.100])
	by smtpzilla1.xs4all.nl (8.12.0/8.12.0) with ESMTP id g9LBr6ni040943
	for <dovecot@procontrol.fi>; Mon, 21 Oct 2002 13:53:06 +0200 (CEST)
Received: by centurion.xs4all.nl (Postfix, from userid 1000)
	id DC6BB224C; Mon, 21 Oct 2002 13:51:43 +0200 (CEST)
Date: Mon, 21 Oct 2002 13:51:43 +0200
From: Thomas Wouters <thomas@xs4all.net>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Architectural questions
Message-ID: <20021021115143.GS543@xs4all.nl>
References: <20021019123846.GK543@xs4all.nl> <1035036115.1674.81.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1035036115.1674.81.camel@hurina>
User-Agent: Mutt/1.4i
X-message-flag: Danger Will Robinson!
X-archive-position: 61
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: thomas@xs4all.net
Precedence: bulk
X-list: dovecot
X-UID: 61                                                  
Status: O
Content-Length: 1279

On Sat, Oct 19, 2002 at 05:01:55PM +0300, Timo Sirainen wrote:

> If your clusters access the files through NFS, there should be no
> problem. Except I've never tried Dovecot through NFS, and I'm not sure
> how well mmap()ing works through NFS. I know there's been problems
> before but hopefully they've been fixed already.

Hmm. I'm not sure what kind of behaviour you're looking for, but here's what
I see, using a little Python script on our FreeBSD servers with a
netapp-mounted filesystem. Mapping MAP_SHARED and PROT_READ|PROT_WRITE, two
different machines mounting the same directory, two processes on each
machine mmap()ing the same file.

When one process alters the data, the other process on the same machine sees
it instantly. The processes on the other machine do not see it at all, not
even when re-opening the mmap or being restarted. After doing an msync() in
the process that altered the data, the processes on the other machine still
don't see the change; they have to re-open the mmap or be restarted before
they see the change -- but when one of the processes re-opens or restarts,
the other does see the change without doing anything.

-- 
Thomas Wouters <thomas@xs4all.net>

Hi! I'm a .signature virus! copy me into your .signature file to help me spread!

From thomas@xs4all.net  Mon Oct 21 15:40:02 2002
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 21 Oct 2002 15:40:02 +0300 (EEST)
Return-Path: <thomas@xs4all.net>
Delivered-To: dovecot@procontrol.fi
Received: from smtpzilla3.xs4all.nl (smtpzilla3.xs4all.nl [194.109.127.139])
	by danu.procontrol.fi (Postfix) with ESMTP id 868CD23837
	for <dovecot@procontrol.fi>; Mon, 21 Oct 2002 15:40:02 +0300 (EEST)
Received: from centurion.xs4all.nl (centurion.xs4all.nl [194.109.0.100])
	by smtpzilla3.xs4all.nl (8.12.0/8.12.0) with ESMTP id g9LCe2wC017139
	for <dovecot@procontrol.fi>; Mon, 21 Oct 2002 14:40:02 +0200 (CEST)
Received: by centurion.xs4all.nl (Postfix, from userid 1000)
	id 19E90224C; Mon, 21 Oct 2002 14:38:39 +0200 (CEST)
Date: Mon, 21 Oct 2002 14:38:39 +0200
From: Thomas Wouters <thomas@xs4all.net>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Architectural questions
Message-ID: <20021021123839.GW543@xs4all.nl>
References: <20021019123846.GK543@xs4all.nl> <1035036115.1674.81.camel@hurina> <20021019151026.GM543@xs4all.nl> <1035042823.1679.127.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1035042823.1679.127.camel@hurina>
User-Agent: Mutt/1.4i
X-message-flag: Danger Will Robinson!
X-archive-position: 62
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: thomas@xs4all.net
Precedence: bulk
X-list: dovecot
X-UID: 62                                                  
Status: O

On Sat, Oct 19, 2002 at 06:53:43PM +0300, Timo Sirainen wrote:

> > As long as dovecot doesn't read a different meaning into those flags
> > (ignoring them is just fine) we should be fine. I don't think we'll have
> > many customers switching back and forth between dovecot and UW-IMAP, just
> > people switching from UW-IMAP to dovecot.

> Keeping the UIDs untouched when changing could be important to some
> people whose mail clients can save some extra information related to
> specific messages and use UID to identify the mails. I think Evolution
> does this with it's labels and Follow-Up marks, but I'm not sure.

Well, what I meant was that currently, IMAP is being used only by
SquirrelMail, and I'm fairly sure SquirrelMail doesn't store UIDs anywhere.
Other IMAP clients would be an issue only if we allowed other IMAP clients
to connect, which we don't (except in internal tests :).

-- 
Thomas Wouters <thomas@xs4all.net>

Hi! I'm a .signature virus! copy me into your .signature file to help me spread!

From thomas@xs4all.net  Mon Oct 21 16:04:50 2002
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 21 Oct 2002 16:04:50 +0300 (EEST)
Return-Path: <thomas@xs4all.net>
Delivered-To: dovecot@procontrol.fi
Received: from smtpzilla5.xs4all.nl (smtpzilla5.xs4all.nl [194.109.127.141])
	by danu.procontrol.fi (Postfix) with ESMTP id 3F98523837
	for <dovecot@procontrol.fi>; Mon, 21 Oct 2002 16:04:50 +0300 (EEST)
Received: from centurion.xs4all.nl (centurion.xs4all.nl [194.109.0.100])
	by smtpzilla5.xs4all.nl (8.12.0/8.12.0) with ESMTP id g9LD4gEH017726;
	Mon, 21 Oct 2002 15:04:47 +0200 (CEST)
Received: by centurion.xs4all.nl (Postfix, from userid 1000)
	id 4840D224C; Mon, 21 Oct 2002 15:03:19 +0200 (CEST)
Date: Mon, 21 Oct 2002 15:03:19 +0200
From: Thomas Wouters <thomas@xs4all.net>
To: Charlie Brady <charlieb@e-smith.com>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: Architectural questions
Message-ID: <20021021130319.GX543@xs4all.nl>
References: <20021019123846.GK543@xs4all.nl> <Pine.LNX.4.44.0210191229360.24121-100000@allspice.nssg.mitel.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <Pine.LNX.4.44.0210191229360.24121-100000@allspice.nssg.mitel.com>
User-Agent: Mutt/1.4i
X-message-flag: Danger Will Robinson!
X-archive-position: 63
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: thomas@xs4all.net
Precedence: bulk
X-list: dovecot
X-UID: 63                                                  
Status: O
Content-Length: 2995

On Sat, Oct 19, 2002 at 12:42:25PM -0400, Charlie Brady wrote:

> > So when we needed an IMAP server for use with our webmail (based on
> > SquirrelMail), we were forced to go with the UW-IMAP server, with the
> > maildir patch that's been scattered around the 'net. This worked, for a
> > while; we also use the maildir patch with pine after all. However, the
> > maildir patch is not very good. Not at all, even, and it only seems to
> > work by pure chance.

> The best one I've found is the patch last modified AFAICT by Miquel van 
> Smoorenburg, which has maildir filenames like:
> time.pid.host,U=xxx,W=yyy:2,flags

We use two different patches, both of which have a bit of Mike in them. One
is for the IMAP server, which is an old version ('uw-imap-2000' or something
like that comes to mind, but it came from the pine 4.10 source) from before
the mailbox->append prototype changed (but with Mike's bilennium-patch.) A
big problem with later patches was that the append method changed in the
pine source, but not in the maildir patch. We considered using a newer
uw-imap but decided that the current one works good enough ;P

For pine we currently use the patch that comes with Debian's 'pine-tracker'
package (which is an installer for pine with patches, since you aren't
allowed to distributed modified binaries.) This patch also has some Mike in
it, but I'm not sure howmuch, as at least parts of it seem to be backed out
later. This patch works okay except for the two problems I noted in my
original mail: it depends on directory order not to change except when
'.uidvalidity' gets touched, and it depends on alphanumerical sort order of
files matching chronological (or at least uid-based, which should be the
same) sort order. The latter breaks with (standard) procmail, the former
occasionally with btree and (presumably) hashed directory indices.

> The storage of RFC822.SIZE, aka the on-the-wire size, in the filename 
> makes a very big difference to performance.

That's interesting. I'll keep that in mind for when we begin to see
performance issues with UW-IMAP. (I'm hoping I never have to look at the
pine source again, though.)

> But even this patch (from, e.g. 
> http://www.star.le.ac.uk/~tjg/misc/uw_imap-2001a_maildir-02.patch) has a
> number of bugs. I've fixed a few of them. You can find a source RPM at
> ftp://ftp.e-smith.org/pub/e-smith/dev/5.6dev/SRPMS/. The fixes are:

<snip fixes>

I couldn't find the source RPM for pine or (uw-)imap in that directory, but
it doesn't sound like your changes solve our fundamental problems. It's not
that big a deal, I think we've decided internally (I know _I_ have :) that
we can't offer real IMAP services based on UW-IMAP; we'd sooner go for Cyrus
or Courier, even if it does mean disallowing mboxes with IMAP. But dovecot
is an even better alternative, once it has all the features we need :)

-- 
Thomas Wouters <thomas@xs4all.net>

Hi! I'm a .signature virus! copy me into your .signature file to help me spread!

From tss@iki.fi  Mon Oct 21 16:15:30 2002
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 21 Oct 2002 16:15:30 +0300 (EEST)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 6091723837
	for <dovecot@procontrol.fi>; Mon, 21 Oct 2002 16:15:30 +0300 (EEST)
Received: by hurina (Postfix, from userid 1000)
	id B84CA5E03E5C; Mon, 21 Oct 2002 16:15:28 +0300 (EEST)
Subject: [dovecot] Re: Architectural questions
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20021021115143.GS543@xs4all.nl>
References: <20021019123846.GK543@xs4all.nl>
	 <1035036115.1674.81.camel@hurina>  <20021021115143.GS543@xs4all.nl>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1035206128.613.8.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.1.1.99 (Preview Release)
Date: 21 Oct 2002 16:15:28 +0300
X-archive-position: 64
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 64                                                  
Status: O
Content-Length: 1114

On Mon, 2002-10-21 at 14:51, Thomas Wouters wrote:
> Hmm. I'm not sure what kind of behaviour you're looking for, but here's what
> I see, using a little Python script on our FreeBSD servers with a
> netapp-mounted filesystem. Mapping MAP_SHARED and PROT_READ|PROT_WRITE, two
> different machines mounting the same directory, two processes on each
> machine mmap()ing the same file.
> 
> When one process alters the data, the other process on the same machine sees
> it instantly. The processes on the other machine do not see it at all, not
> even when re-opening the mmap or being restarted. After doing an msync() in
> the process that altered the data, the processes on the other machine still
> don't see the change; they have to re-open the mmap or be restarted before
> they see the change -- but when one of the processes re-opens or restarts,
> the other does see the change without doing anything.

Requiring msync() is fine, that's done after each change, but there
should be better solution than re-mmap()ing to notice the changes. I
think FreeBSD checked the changes after fcntl() locking changes :)


From thomas@xs4all.net  Mon Oct 21 17:20:52 2002
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 21 Oct 2002 17:20:52 +0300 (EEST)
Return-Path: <thomas@xs4all.net>
Delivered-To: dovecot@procontrol.fi
Received: from smtpzilla3.xs4all.nl (smtpzilla3.xs4all.nl [194.109.127.139])
	by danu.procontrol.fi (Postfix) with ESMTP id BA14223837
	for <dovecot@procontrol.fi>; Mon, 21 Oct 2002 17:20:52 +0300 (EEST)
Received: from centurion.xs4all.nl (centurion.xs4all.nl [194.109.0.100])
	by smtpzilla3.xs4all.nl (8.12.0/8.12.0) with ESMTP id g9LEKqkc068326
	for <dovecot@procontrol.fi>; Mon, 21 Oct 2002 16:20:52 +0200 (CEST)
Received: by centurion.xs4all.nl (Postfix, from userid 1000)
	id 1D65A4ACB; Mon, 21 Oct 2002 16:19:29 +0200 (CEST)
Date: Mon, 21 Oct 2002 16:19:29 +0200
From: Thomas Wouters <thomas@xs4all.net>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Architectural questions
Message-ID: <20021021141929.GY543@xs4all.nl>
References: <20021019123846.GK543@xs4all.nl> <1035036115.1674.81.camel@hurina> <20021021115143.GS543@xs4all.nl> <1035206128.613.8.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1035206128.613.8.camel@hurina>
User-Agent: Mutt/1.4i
X-message-flag: Danger Will Robinson!
X-archive-position: 65
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: thomas@xs4all.net
Precedence: bulk
X-list: dovecot
X-UID: 65                                                  
Status: O
Content-Length: 1435

On Mon, Oct 21, 2002 at 04:15:28PM +0300, Timo Sirainen wrote:

> Requiring msync() is fine, that's done after each change, but there
> should be better solution than re-mmap()ing to notice the changes. I
> think FreeBSD checked the changes after fcntl() locking changes :)

Hmm. More bad news; flock() doesn't work over NFS. That is, local processes
see and honor the lock even on NFS filesystems, but other machines don't see
the lock at all. fcntl() doesn't work at all (but that's probably because
we're not running lockd.)

I've tried various ways of forcing other machines to update their filesystem
cache without doing something on those machines (so you can optionally do
that after the msync()) by changing atime, mtime, nlinks, but so far,
nothing. I should point out that the file-metadata (mtime/ctime/nlinks)
returned by fstat() sometimes do get updated, and sometimes they don't. Same
for stat().

That aside, this issue isn't that big an issue for us. The
same-client-connecting-twice case we can solve by configuring the layer-4
ethernet switch to connect the same ipaddress to the same real server, so
that mmaps() are properly shared and all. We might want
per-mailbox locks so that only one real server can open a specific mailbox
(but do so multiple times) but I'll figure that one out later.

-- 
Thomas Wouters <thomas@xs4all.net>

Hi! I'm a .signature virus! copy me into your .signature file to help me spread!

From tss@iki.fi  Mon Oct 21 17:49:30 2002
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 21 Oct 2002 17:49:30 +0300 (EEST)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 4035223837
	for <dovecot@procontrol.fi>; Mon, 21 Oct 2002 17:49:30 +0300 (EEST)
Received: by hurina (Postfix, from userid 1000)
	id 115105E03E5C; Mon, 21 Oct 2002 17:49:30 +0300 (EEST)
Subject: [dovecot] Re: Architectural questions
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20021021141929.GY543@xs4all.nl>
References: <20021019123846.GK543@xs4all.nl>
	 <1035036115.1674.81.camel@hurina> <20021021115143.GS543@xs4all.nl>
	 <1035206128.613.8.camel@hurina>  <20021021141929.GY543@xs4all.nl>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1035211769.613.48.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.1.1.99 (Preview Release)
Date: 21 Oct 2002 17:49:29 +0300
X-archive-position: 66
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 66                                                  
Status: O
Content-Length: 1820

On Mon, 2002-10-21 at 17:19, Thomas Wouters wrote:
> > Requiring msync() is fine, that's done after each change, but there
> > should be better solution than re-mmap()ing to notice the changes. I
> > think FreeBSD checked the changes after fcntl() locking changes :)
> 
> Hmm. More bad news; flock() doesn't work over NFS. That is, local processes
> see and honor the lock even on NFS filesystems, but other machines don't see
> the lock at all. fcntl() doesn't work at all (but that's probably because
> we're not running lockd.)

flock() doesn't matter, it's used only for mbox locking where .lock file
would work instead just as well. 

> That aside, this issue isn't that big an issue for us. The
> same-client-connecting-twice case we can solve by configuring the layer-4
> ethernet switch to connect the same ipaddress to the same real server, so
> that mmaps() are properly shared and all. We might want
> per-mailbox locks so that only one real server can open a specific mailbox
> (but do so multiple times) but I'll figure that one out later.

OK. I think this could be fixed internally too. Or this is mostly a
problem with index files, mbox/maildir files are currently re-mmap()ed
every time they're accessed (but I'll change mbox not to do that later).

Indexes currently have "sync_id" in their header, it's changed whenever
the file size is changed so other processes then know to re-mmap() it.
This could be optionally changed to be updated every time the file
itself has changed to force others to mmap() again. The sync_id change
itself could be checked using lseek() + read().

If fstat() or stat() doesn't show mtime changes, that could be a bit
worse problem. I think I'm relying on that with some things.. At least
new mail is checked by seeing if Maildir/cur's mtime matches
.imap.index's mtime.


From tss@iki.fi  Tue Oct 22 04:24:54 2002
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 22 Oct 2002 04:24:55 +0300 (EEST)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id D2C9F2382D
	for <dovecot@procontrol.fi>; Tue, 22 Oct 2002 04:24:54 +0300 (EEST)
Received: by hurina (Postfix, from userid 1000)
	id 8C06D5E03E5C; Tue, 22 Oct 2002 04:24:54 +0300 (EEST)
Subject: [dovecot] Re: Architectural questions
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20021021141929.GY543@xs4all.nl>
References: <20021019123846.GK543@xs4all.nl>
	 <1035036115.1674.81.camel@hurina> <20021021115143.GS543@xs4all.nl>
	 <1035206128.613.8.camel@hurina>  <20021021141929.GY543@xs4all.nl>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1035249894.5044.28.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.1.1.99 (Preview Release)
Date: 22 Oct 2002 04:24:54 +0300
X-archive-position: 67
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 67                                                  
Status: O
Content-Length: 1572

On Mon, 2002-10-21 at 17:19, Thomas Wouters wrote:
> That aside, this issue isn't that big an issue for us. The
> same-client-connecting-twice case we can solve by configuring the layer-4
> ethernet switch to connect the same ipaddress to the same real server, so
> that mmaps() are properly shared and all. We might want
> per-mailbox locks so that only one real server can open a specific mailbox
> (but do so multiple times) but I'll figure that one out later.

Just had a thought. Would it be feasible to _try_ to permanently assign
users to one or few specific servers (via ip or maybe login proxy)? If
those servers were down, it could fallback to any random one.

I was thinking Dovecot's indexes could just as well be stored in local
hard disk - they're not required to exist and they're not required to be
in sync when opening, so it's possible to keep multiple indexes lying
around in different servers.

That would take care of most of the mmap() and locking problems and
should make it perform a _lot_ better than through NFS. I don't know how
NFS works internally, but I doubt it has any way for remote OS to
determine what parts of file has changed, so re-mmap()ing would most
likely always reread the whole file (or the parts that it accesses)
which is quite inefficient.

I really like this idea, keeping indexes in local disk where they may be
considered as fast non-permanent data and then reading the actual mail
data via backed up NFS server. This gets me thinking of a lot more
possible optimizations to reduce NFS I/O at the cost of more local.. :)


From tss@iki.fi  Tue Oct 22 05:31:22 2002
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 22 Oct 2002 05:31:22 +0300 (EEST)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id A8EB723837
	for <dovecot@procontrol.fi>; Tue, 22 Oct 2002 05:31:22 +0300 (EEST)
Received: by hurina (Postfix, from userid 1000)
	id 6BF085E03E5C; Tue, 22 Oct 2002 05:31:22 +0300 (EEST)
Subject: [dovecot] Re: Architectural questions
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <1035249894.5044.28.camel@hurina>
References: <20021019123846.GK543@xs4all.nl>
	 <1035036115.1674.81.camel@hurina> <20021021115143.GS543@xs4all.nl>
	 <1035206128.613.8.camel@hurina>  <20021021141929.GY543@xs4all.nl>
	 <1035249894.5044.28.camel@hurina>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1035253882.5041.34.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.1.1.99 (Preview Release)
Date: 22 Oct 2002 05:31:22 +0300
X-archive-position: 68
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 68                                                  
Status: O

On Tue, 2002-10-22 at 04:24, Timo Sirainen wrote:
> Just had a thought. Would it be feasible to _try_ to permanently assign
> users to one or few specific servers (via ip or maybe login proxy)? If
> those servers were down, it could fallback to any random one.

Dovecot could actually do that itself too, authenticate user and then
either locally handle it or transfer it to another node based on some
configuration.

> I really like this idea, keeping indexes in local disk where they may be
> considered as fast non-permanent data and then reading the actual mail
> data via backed up NFS server. This gets me thinking of a lot more
> possible optimizations to reduce NFS I/O at the cost of more local.. :)

This again makes the indexer process possible and useful, since it would
be accessing only local disks. It could also delete some of the older
indexes if disk space is getting full.


From thomas@xs4all.net  Tue Oct 22 14:50:52 2002
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 22 Oct 2002 14:50:52 +0300 (EEST)
Return-Path: <thomas@xs4all.net>
Delivered-To: dovecot@procontrol.fi
Received: from smtpzilla1.xs4all.nl (smtpzilla1.xs4all.nl [194.109.127.137])
	by danu.procontrol.fi (Postfix) with ESMTP id 631112382D
	for <dovecot@procontrol.fi>; Tue, 22 Oct 2002 14:50:52 +0300 (EEST)
Received: from centurion.xs4all.nl (centurion.xs4all.nl [194.109.0.100])
	by smtpzilla1.xs4all.nl (8.12.0/8.12.0) with ESMTP id g9MBoqol023592
	for <dovecot@procontrol.fi>; Tue, 22 Oct 2002 13:50:52 +0200 (CEST)
Received: by centurion.xs4all.nl (Postfix, from userid 1000)
	id 939694BC7; Tue, 22 Oct 2002 13:49:22 +0200 (CEST)
Date: Tue, 22 Oct 2002 13:49:22 +0200
From: Thomas Wouters <thomas@xs4all.net>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Architectural questions
Message-ID: <20021022114922.GF543@xs4all.nl>
References: <20021019123846.GK543@xs4all.nl> <1035036115.1674.81.camel@hurina> <20021021115143.GS543@xs4all.nl> <1035206128.613.8.camel@hurina> <20021021141929.GY543@xs4all.nl> <1035249894.5044.28.camel@hurina> <1035253882.5041.34.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1035253882.5041.34.camel@hurina>
User-Agent: Mutt/1.4i
X-message-flag: Danger Will Robinson!
X-archive-position: 69
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: thomas@xs4all.net
Precedence: bulk
X-list: dovecot
X-UID: 69                                                  
Status: O
Content-Length: 2956

On Tue, Oct 22, 2002 at 05:31:22AM +0300, Timo Sirainen wrote:
> On Tue, 2002-10-22 at 04:24, Timo Sirainen wrote:
> > Just had a thought. Would it be feasible to _try_ to permanently assign
> > users to one or few specific servers (via ip or maybe login proxy)? If
> > those servers were down, it could fallback to any random one.

Yes, the Alteons we use can be configured quite flexibly. We can easily
configure, e.g., two servers as 'primary' and two fallback servers, or do
load-balancing based on the output of a script, or any number of things. We
only use the general load-balancing (actually just
active-connection-balancing) while keeping sessions on the same server
(based on remote IP) but we could look into the more intricate methods. A
single IMAP server with a backup is a good start though.

> Dovecot could actually do that itself too, authenticate user and then
> either locally handle it or transfer it to another node based on some
> configuration.

You mean if you have a frontend with several backends, and the frontend
proxies for the backends (with several frontends possible, for redundancy,)
hmm, that might work. Diablo (the news server software) works like this,
somewhat, too, and we also use it behind Alteon switches :)

> > I really like this idea, keeping indexes in local disk where they may be
> > considered as fast non-permanent data and then reading the actual mail
> > data via backed up NFS server. This gets me thinking of a lot more
> > possible optimizations to reduce NFS I/O at the cost of more local.. :)

> This again makes the indexer process possible and useful, since it would
> be accessing only local disks. It could also delete some of the older
> indexes if disk space is getting full.

Yes. Keeping things on local disk sounds good. As long as opening the same
mailbox on another server doesn't break anything (or breaks 'cleanly',
doesn't delete the wrong mails etc) we can definately live with much worse
performance for those cases. My professional estimate is that they will be
very, very rare ;P

But for the time being we're more concerned with the SORT extention :) I've
read the spec, and besides the natural "ugh" at having to parse the subject
that way, it seems doable... except that charset support for UTF-8, as well
as US-ASCII, is mandatory. I don't know any libraries that convert to/from
UTF-8 (though ASCII<->UTF-8 is obviously simple :) and though it's probably
easy to roll your own for iso8859-1 I'm not sure if you had a solution in
mind yet. Also, supporting the other character sets (like UW-IMAP does) is
probably a lot trickier.

Other than the charset issues I could probably whip up a working SORT
implementation given enough time... but it probably wouldn't be
super-efficient, as quicksort is so much easier to start with than, say,
a mergesort ;P

-- 
Thomas Wouters <thomas@xs4all.net>

Hi! I'm a .signature virus! copy me into your .signature file to help me spread!

From rueckert@informatik.uni-rostock.de  Tue Oct 22 15:47:21 2002
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 22 Oct 2002 15:47:21 +0300 (EEST)
Return-Path: <rueckert@informatik.uni-rostock.de>
Delivered-To: dovecot@procontrol.fi
Received: from linux.taugt.net (wh5035.stw.uni-rostock.de [139.30.105.35])
	by danu.procontrol.fi (Postfix) with ESMTP id D3C8D23837
	for <dovecot@procontrol.fi>; Tue, 22 Oct 2002 15:47:21 +0300 (EEST)
Received: by linux.taugt.net (postwixer on board, from userid 500)
	id 827F82A150; Tue, 22 Oct 2002 14:47:22 +0200 (CEST)
Date: Tue, 22 Oct 2002 14:47:22 +0200
From: Marcus Rueckert <rueckert@informatik.uni-rostock.de>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Architectural questions
Message-ID: <20021022124722.GA942@linux.taugt.net>
References: <20021019123846.GK543@xs4all.nl> <1035036115.1674.81.camel@hurina> <20021021115143.GS543@xs4all.nl> <1035206128.613.8.camel@hurina> <20021021141929.GY543@xs4all.nl> <1035249894.5044.28.camel@hurina> <1035253882.5041.34.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1035253882.5041.34.camel@hurina>
User-Agent: Mutt/1.4i
X-archive-position: 70
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: rueckert@informatik.uni-rostock.de
Precedence: bulk
X-list: dovecot
X-UID: 70                                                  
Status: O

On 2002-10-22 05:31:22 +0000, Timo Sirainen wrote:
> Subject: [dovecot] Re: Architectural questions
> From: Timo Sirainen <tss@iki.fi>
> To: dovecot@procontrol.fi
> X-Mailer: Ximian Evolution 1.1.1.99 (Preview Release)
> Date: 22 Oct 2002 05:31:22 +0300
> 
> On Tue, 2002-10-22 at 04:24, Timo Sirainen wrote:
> > Just had a thought. Would it be feasible to _try_ to permanently assign
> > users to one or few specific servers (via ip or maybe login proxy)? If
> > those servers were down, it could fallback to any random one.
> 
> Dovecot could actually do that itself too, authenticate user and then
> either locally handle it or transfer it to another node based on some
> configuration.
 
hmm

i just wanted to suggest http://www.vergenet.net/linux/perdition/
for proxying. but if dovecot could do something similar by it self this
is not needed :)

bow before god aehm cras ^^

marcus

-- 
irssi - the client of the smart and beautiful people

              http://www.irssi.de/


From cras@irccrew.org  Tue Oct 22 16:01:46 2002
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 22 Oct 2002 16:01:46 +0300 (EEST)
Return-Path: <cras@irccrew.org>
Delivered-To: dovecot@procontrol.fi
Received: from shodan.irccrew.org (shodan.irccrew.org [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id B564623837
	for <dovecot@procontrol.fi>; Tue, 22 Oct 2002 16:01:46 +0300 (EEST)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id 172F74C0A0; Tue, 22 Oct 2002 16:01:46 +0300 (EEST)
Date: Tue, 22 Oct 2002 16:01:46 +0300
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Architectural questions
Message-ID: <20021022130146.GB8122@irccrew.org>
References: <20021019123846.GK543@xs4all.nl> <1035036115.1674.81.camel@hurina> <20021021115143.GS543@xs4all.nl> <1035206128.613.8.camel@hurina> <20021021141929.GY543@xs4all.nl> <1035249894.5044.28.camel@hurina> <1035253882.5041.34.camel@hurina> <20021022114922.GF543@xs4all.nl>
Mime-Version: 1.0
Content-Disposition: inline
In-Reply-To: <20021022114922.GF543@xs4all.nl>
User-Agent: Mutt/1.4i
Content-Type: text/plain; charset=us-ascii
X-archive-position: 71
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 71                                                  
Status: O
Content-Length: 3419

On Tue, Oct 22, 2002 at 01:49:22PM +0200, Thomas Wouters wrote:
> Yes, the Alteons we use can be configured quite flexibly. We can easily
> configure, e.g., two servers as 'primary' and two fallback servers, or do
> load-balancing based on the output of a script, or any number of things. We
> only use the general load-balancing (actually just
> active-connection-balancing) while keeping sessions on the same server
> (based on remote IP) but we could look into the more intricate methods. A
> single IMAP server with a backup is a good start though.

OK, they'd probably be better than any Dovecot proxies I think.

> > Dovecot could actually do that itself too, authenticate user and then
> > either locally handle it or transfer it to another node based on some
> > configuration.
> 
> You mean if you have a frontend with several backends, and the frontend
> proxies for the backends (with several frontends possible, for redundancy,)
> hmm, that might work. Diablo (the news server software) works like this,
> somewhat, too, and we also use it behind Alteon switches :)

Not necessarily split to frontend/backend.. Well, that's possible too but I
was thinking that every running dovecot could handle authentication and
transferring connection elsewhere (via another TCP connection, login using
some internal password, maybe use TLS too).

> Yes. Keeping things on local disk sounds good. As long as opening the same
> mailbox on another server doesn't break anything (or breaks 'cleanly',
> doesn't delete the wrong mails etc) we can definately live with much worse
> performance for those cases. My professional estimate is that they will be
> very, very rare ;P

Nothing breaks if same mailbox is opened from different computers with
different indexes (or no indexes).

> But for the time being we're more concerned with the SORT extention :) I've
> read the spec, and besides the natural "ugh" at having to parse the subject
> that way, it seems doable...

The subject sorting looked very "ugh" to me too :)

> except that charset support for UTF-8, as well
> as US-ASCII, is mandatory. I don't know any libraries that convert to/from
> UTF-8 (though ASCII<->UTF-8 is obviously simple :) and though it's probably
> easy to roll your own for iso8859-1 I'm not sure if you had a solution in
> mind yet. Also, supporting the other character sets (like UW-IMAP does) is
> probably a lot trickier.

iconv() does it all, comes with glibc. Only bigger thing to do is to parse
the headers and convert the =?xxx?yyy?= things. I think everything should
go either through UTF8 or without any conversion if both header and search
charsets are same.

> Other than the charset issues I could probably whip up a working SORT
> implementation given enough time... but it probably wouldn't be
> super-efficient, as quicksort is so much easier to start with than, say,
> a mergesort ;P

I can think of two ways to do it:

1) save search results to array, sort the array, send it to clients, delete
the array.

2) sort all mails writing results into btree file, keep the file updated
whenever new mails are added or deleted. then do the search in that order so
we can just write out the results without any sorting.

I like the 2) more, but that works only if the sort condition isn't changed.
Or if it is changed, then we'd need to have multiple btree files.. And in
general it slows down things if sorting isn't done often.


From cras@irccrew.org  Tue Oct 22 16:06:50 2002
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 22 Oct 2002 16:06:50 +0300 (EEST)
Return-Path: <cras@irccrew.org>
Delivered-To: dovecot@procontrol.fi
Received: from shodan.irccrew.org (shodan.irccrew.org [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id D7F1023837
	for <dovecot@procontrol.fi>; Tue, 22 Oct 2002 16:06:50 +0300 (EEST)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id A49264C0A0; Tue, 22 Oct 2002 16:06:50 +0300 (EEST)
Date: Tue, 22 Oct 2002 16:06:50 +0300
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Architectural questions
Message-ID: <20021022130650.GC8122@irccrew.org>
References: <20021019123846.GK543@xs4all.nl> <1035036115.1674.81.camel@hurina> <20021021115143.GS543@xs4all.nl> <1035206128.613.8.camel@hurina> <20021021141929.GY543@xs4all.nl> <1035249894.5044.28.camel@hurina> <1035253882.5041.34.camel@hurina> <20021022114922.GF543@xs4all.nl> <20021022130146.GB8122@irccrew.org>
Mime-Version: 1.0
Content-Disposition: inline
In-Reply-To: <20021022130146.GB8122@irccrew.org>
User-Agent: Mutt/1.4i
Content-Type: text/plain; charset=us-ascii
X-archive-position: 72
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 72                                                  
Status: O

On Tue, Oct 22, 2002 at 04:01:46PM +0300, Timo Sirainen wrote:
> > except that charset support for UTF-8, as well
> > as US-ASCII, is mandatory. I don't know any libraries that convert to/from
> > UTF-8 (though ASCII<->UTF-8 is obviously simple :) and though it's probably
> > easy to roll your own for iso8859-1 I'm not sure if you had a solution in
> > mind yet. Also, supporting the other character sets (like UW-IMAP does) is
> > probably a lot trickier.
> 
> iconv() does it all, comes with glibc.

Um. Of course FreeBSD didn't have glibc, but iconv() is anyway pretty
standard, man page says "Conforming to UNIX98". It comes as a separate
library as well.

BTW. does SquirrelMail also require THREAD extension? It's not much more
different from SORT luckily.


From thomas@xs4all.net  Tue Oct 22 16:23:59 2002
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 22 Oct 2002 16:23:59 +0300 (EEST)
Return-Path: <thomas@xs4all.net>
Delivered-To: dovecot@procontrol.fi
Received: from smtpzilla2.xs4all.nl (smtpzilla2.xs4all.nl [194.109.127.138])
	by danu.procontrol.fi (Postfix) with ESMTP id E953E2382D
	for <dovecot@procontrol.fi>; Tue, 22 Oct 2002 16:23:58 +0300 (EEST)
Received: from centurion.xs4all.nl (centurion.xs4all.nl [194.109.0.100])
	by smtpzilla2.xs4all.nl (8.12.0/8.12.0) with ESMTP id g9MDNwHg059572
	for <dovecot@procontrol.fi>; Tue, 22 Oct 2002 15:23:58 +0200 (CEST)
Received: by centurion.xs4all.nl (Postfix, from userid 1000)
	id A25BF2D43; Tue, 22 Oct 2002 15:22:28 +0200 (CEST)
Date: Tue, 22 Oct 2002 15:22:28 +0200
From: Thomas Wouters <thomas@xs4all.net>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Architectural questions
Message-ID: <20021022132228.GG543@xs4all.nl>
References: <20021019123846.GK543@xs4all.nl> <1035036115.1674.81.camel@hurina> <20021021115143.GS543@xs4all.nl> <1035206128.613.8.camel@hurina> <20021021141929.GY543@xs4all.nl> <1035249894.5044.28.camel@hurina> <1035253882.5041.34.camel@hurina> <20021022114922.GF543@xs4all.nl> <20021022130146.GB8122@irccrew.org> <20021022130650.GC8122@irccrew.org>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20021022130650.GC8122@irccrew.org>
User-Agent: Mutt/1.4i
X-message-flag: Danger Will Robinson!
X-archive-position: 73
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: thomas@xs4all.net
Precedence: bulk
X-list: dovecot
X-UID: 73                                                  
Status: O
Content-Length: 1288

On Tue, Oct 22, 2002 at 04:06:50PM +0300, Timo Sirainen wrote:
> On Tue, Oct 22, 2002 at 04:01:46PM +0300, Timo Sirainen wrote:
> > > except that charset support for UTF-8, as well
> > > as US-ASCII, is mandatory. I don't know any libraries that convert to/from
> > > UTF-8 (though ASCII<->UTF-8 is obviously simple :) and though it's probably
> > > easy to roll your own for iso8859-1 I'm not sure if you had a solution in
> > > mind yet. Also, supporting the other character sets (like UW-IMAP does) is
> > > probably a lot trickier.

> > iconv() does it all, comes with glibc.

> Um. Of course FreeBSD didn't have glibc, but iconv() is anyway pretty
> standard, man page says "Conforming to UNIX98". It comes as a separate
> library as well.

Yeah, I noticed the same thing :) But it still has to be a concious
decision, as not all platforms come with libiconv and I wasn't sure what
your target audience is, and might become.

> BTW. does SquirrelMail also require THREAD extension? It's not much more
> different from SORT luckily.

It looks like it's optional. As a matter of fact, so is SORT :) But both
would be very nice to have, not just for SquirrelMail.

-- 
Thomas Wouters <thomas@xs4all.net>

Hi! I'm a .signature virus! copy me into your .signature file to help me spread!

From thomas@xs4all.net  Tue Oct 22 16:41:38 2002
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 22 Oct 2002 16:41:38 +0300 (EEST)
Return-Path: <thomas@xs4all.net>
Delivered-To: dovecot@procontrol.fi
Received: from smtpzilla3.xs4all.nl (smtpzilla3.xs4all.nl [194.109.127.139])
	by danu.procontrol.fi (Postfix) with ESMTP id 5975F2382D
	for <dovecot@procontrol.fi>; Tue, 22 Oct 2002 16:41:38 +0300 (EEST)
Received: from centurion.xs4all.nl (centurion.xs4all.nl [194.109.0.100])
	by smtpzilla3.xs4all.nl (8.12.0/8.12.0) with ESMTP id g9MDfbcj029432
	for <dovecot@procontrol.fi>; Tue, 22 Oct 2002 15:41:38 +0200 (CEST)
Received: by centurion.xs4all.nl (Postfix, from userid 1000)
	id DF54A2D43; Tue, 22 Oct 2002 15:40:07 +0200 (CEST)
Date: Tue, 22 Oct 2002 15:40:07 +0200
From: Thomas Wouters <thomas@xs4all.net>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Architectural questions
Message-ID: <20021022134007.GH543@xs4all.nl>
References: <20021019123846.GK543@xs4all.nl> <1035036115.1674.81.camel@hurina> <20021021115143.GS543@xs4all.nl> <1035206128.613.8.camel@hurina> <20021021141929.GY543@xs4all.nl> <1035249894.5044.28.camel@hurina> <1035253882.5041.34.camel@hurina> <20021022114922.GF543@xs4all.nl> <20021022130146.GB8122@irccrew.org>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20021022130146.GB8122@irccrew.org>
User-Agent: Mutt/1.4i
X-message-flag: Danger Will Robinson!
X-archive-position: 74
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: thomas@xs4all.net
Precedence: bulk
X-list: dovecot
X-UID: 74                                                  
Status: O
Content-Length: 1983

On Tue, Oct 22, 2002 at 04:01:46PM +0300, Timo Sirainen wrote:

> Only bigger thing to do is to parse the headers and convert the
> =?xxx?yyy?= things. I think everything should go either through UTF8 or
> without any conversion if both header and search charsets are same.

I assume you only want to convert to UTF-8 or the other character sets when
it's really necessary, not store all data internally as UTF-8 or wchar_t ?

> I can think of two ways to do it:

> 1) save search results to array, sort the array, send it to clients, delete
> the array.

> 2) sort all mails writing results into btree file, keep the file updated
> whenever new mails are added or deleted. then do the search in that order so
> we can just write out the results without any sorting.

> I like the 2) more, but that works only if the sort condition isn't changed.
> Or if it is changed, then we'd need to have multiple btree files.. And in
> general it slows down things if sorting isn't done often.

I think 2) might be an option if you're dealing with very specific SORTs.
SquirrelMail, for instance, allows sorting on date, from, subject, arrival
and to (but the last one only in 'sent-mail' mailbox, oddly enough) and all
reverses, and in various order as well, by little buttony things on the
mailbox-index page... easy to play with. (Don't forget, you can 

. SORT (SUBJECT REVERSE FROM REVERSE TO REVERSE DATE ARRIVAL) UTF-8 ALL

and which btrees would you use how, in that case ? :) Anyway, in
SquirrelMail at least, I don't think there is a system-wide 'default' for
the criterium that's most often SORTed on. Simply storing the last SORT
might be the optimal solution, as I think (after the initial toying with the
mailbox sort order, and the occasional switch to search faster) most people
won't touch their sort order once they like or are used with what they have.

-- 
Thomas Wouters <thomas@xs4all.net>

Hi! I'm a .signature virus! copy me into your .signature file to help me spread!

From cras@irccrew.org  Tue Oct 22 17:00:13 2002
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 22 Oct 2002 17:00:13 +0300 (EEST)
Return-Path: <cras@irccrew.org>
Delivered-To: dovecot@procontrol.fi
Received: from shodan.irccrew.org (shodan.irccrew.org [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id C9D3B2382D
	for <dovecot@procontrol.fi>; Tue, 22 Oct 2002 17:00:13 +0300 (EEST)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id 93B514C0A0; Tue, 22 Oct 2002 17:00:13 +0300 (EEST)
Date: Tue, 22 Oct 2002 17:00:13 +0300
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Architectural questions
Message-ID: <20021022140013.GD8122@irccrew.org>
References: <1035036115.1674.81.camel@hurina> <20021021115143.GS543@xs4all.nl> <1035206128.613.8.camel@hurina> <20021021141929.GY543@xs4all.nl> <1035249894.5044.28.camel@hurina> <1035253882.5041.34.camel@hurina> <20021022114922.GF543@xs4all.nl> <20021022130146.GB8122@irccrew.org> <20021022130650.GC8122@irccrew.org> <20021022132228.GG543@xs4all.nl>
Mime-Version: 1.0
Content-Disposition: inline
In-Reply-To: <20021022132228.GG543@xs4all.nl>
User-Agent: Mutt/1.4i
Content-Type: text/plain; charset=us-ascii
X-archive-position: 75
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 75                                                  
Status: O
Content-Length: 1066

On Tue, Oct 22, 2002 at 03:22:28PM +0200, Thomas Wouters wrote:
> > Um. Of course FreeBSD didn't have glibc, but iconv() is anyway pretty
> > standard, man page says "Conforming to UNIX98". It comes as a separate
> > library as well.
> 
> Yeah, I noticed the same thing :) But it still has to be a concious
> decision, as not all platforms come with libiconv and I wasn't sure what
> your target audience is, and might become.

Well, target audience should be as large as possible :) But I think it'd be
good enough to make iconv() required for charset-support, without iconv() it
would support only charsets which don't need any conversion (ascii and
"search charset foo" with "=?foo?..?=")

> > BTW. does SquirrelMail also require THREAD extension? It's not much more
> > different from SORT luckily.
> 
> It looks like it's optional. As a matter of fact, so is SORT :) But both
> would be very nice to have, not just for SquirrelMail.

Yeah. I'll add support for both later, currently there's a bit more
important things to do which you'll want fixed as well :)


From cras@irccrew.org  Tue Oct 22 17:12:23 2002
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 22 Oct 2002 17:12:23 +0300 (EEST)
Return-Path: <cras@irccrew.org>
Delivered-To: dovecot@procontrol.fi
Received: from shodan.irccrew.org (shodan.irccrew.org [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id 1E2272382D
	for <dovecot@procontrol.fi>; Tue, 22 Oct 2002 17:12:23 +0300 (EEST)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id 2C1CE4C0A0; Tue, 22 Oct 2002 17:12:20 +0300 (EEST)
Date: Tue, 22 Oct 2002 17:12:20 +0300
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Architectural questions
Message-ID: <20021022141220.GE8122@irccrew.org>
References: <20021019123846.GK543@xs4all.nl> <1035036115.1674.81.camel@hurina> <20021021115143.GS543@xs4all.nl> <1035206128.613.8.camel@hurina> <20021021141929.GY543@xs4all.nl> <1035249894.5044.28.camel@hurina> <1035253882.5041.34.camel@hurina> <20021022114922.GF543@xs4all.nl> <20021022130146.GB8122@irccrew.org> <20021022134007.GH543@xs4all.nl>
Mime-Version: 1.0
Content-Disposition: inline
In-Reply-To: <20021022134007.GH543@xs4all.nl>
User-Agent: Mutt/1.4i
Content-Type: text/plain; charset=us-ascii
X-archive-position: 76
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 76                                                  
Status: O
Content-Length: 1875

On Tue, Oct 22, 2002 at 03:40:07PM +0200, Thomas Wouters wrote:
> > Only bigger thing to do is to parse the headers and convert the
> > =?xxx?yyy?= things. I think everything should go either through UTF8 or
> > without any conversion if both header and search charsets are same.
> 
> I assume you only want to convert to UTF-8 or the other character sets when
> it's really necessary, not store all data internally as UTF-8 or wchar_t ?

Well, there's not much stored in memory, and index files store mostly just
FETCH ENVELOPE. The envelope is better to be in format where it's suitable
for directly sending to IMAP client and those few things that are stored in
memory aren't used by search at all. I think it'll be easier if everything
was just converted when needed and it's just more CPU (and maybe memory)
usage - there should be plenty of that left :)

> I think 2) might be an option if you're dealing with very specific SORTs.
> SquirrelMail, for instance, allows sorting on date, from, subject, arrival
> and to (but the last one only in 'sent-mail' mailbox, oddly enough) and all
> reverses, and in various order as well, by little buttony things on the
> mailbox-index page... easy to play with. (Don't forget, you can 
> 
> . SORT (SUBJECT REVERSE FROM REVERSE TO REVERSE DATE ARRIVAL) UTF-8 ALL
> 
> and which btrees would you use how, in that case ? :) Anyway, in

Primary condition could be enough to store in the btree, the other
conditions are used only when primary compares equal between mails, so we
can just read those into memory and then apply the rest of the sorting.
Still faster and takes less memory than reading everything into memory and
then sorting.

Or the btree could be fully sorted with some condition, but if it's not
exactly the same we want we could just use the primary condition.

(uh, a bit badly said, hope it makes some sense :)


From thomas@xs4all.net  Tue Oct 22 21:19:54 2002
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 22 Oct 2002 21:19:54 +0300 (EEST)
Return-Path: <thomas@xs4all.net>
Delivered-To: dovecot@procontrol.fi
Received: from smtpzilla1.xs4all.nl (smtpzilla1.xs4all.nl [194.109.127.137])
	by danu.procontrol.fi (Postfix) with ESMTP id 08BA423837
	for <dovecot@procontrol.fi>; Tue, 22 Oct 2002 21:19:54 +0300 (EEST)
Received: from centurion.xs4all.nl (centurion.xs4all.nl [194.109.0.100])
	by smtpzilla1.xs4all.nl (8.12.0/8.12.0) with ESMTP id g9MIJoWS075157
	for <dovecot@procontrol.fi>; Tue, 22 Oct 2002 20:19:50 +0200 (CEST)
Received: by centurion.xs4all.nl (Postfix, from userid 1000)
	id 761CB2D43; Tue, 22 Oct 2002 20:18:19 +0200 (CEST)
Date: Tue, 22 Oct 2002 20:18:19 +0200
From: Thomas Wouters <thomas@xs4all.net>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Architectural questions
Message-ID: <20021022181819.GI543@xs4all.nl>
References: <20021021115143.GS543@xs4all.nl> <1035206128.613.8.camel@hurina> <20021021141929.GY543@xs4all.nl> <1035249894.5044.28.camel@hurina> <1035253882.5041.34.camel@hurina> <20021022114922.GF543@xs4all.nl> <20021022130146.GB8122@irccrew.org> <20021022130650.GC8122@irccrew.org> <20021022132228.GG543@xs4all.nl> <20021022140013.GD8122@irccrew.org>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20021022140013.GD8122@irccrew.org>
User-Agent: Mutt/1.4i
X-message-flag: Danger Will Robinson!
X-archive-position: 77
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: thomas@xs4all.net
Precedence: bulk
X-list: dovecot
X-UID: 77                                                  
Status: O

On Tue, Oct 22, 2002 at 05:00:13PM +0300, Timo Sirainen wrote:

> Yeah. I'll add support for both later, currently there's a bit more
> important things to do which you'll want fixed as well :)

Heh. That reminds me... Have you considered using, for instance, SourceForge
to host dovecot ? Or at least use something like syncmail, which mails out
CVS diffs on each checkin ? I use syncmail on every CVS project, both
internal and external, and I find I've grown very attached to it, and am too
used to seeing what goes on in an project just by looking at the checkins :)

(Not that I'm actively pushing you to use SourceForge or anything... it
definately has its downsides too, if you're capable of running your own CVS
server anyway.)

-- 
Thomas Wouters <thomas@xs4all.net>

Hi! I'm a .signature virus! copy me into your .signature file to help me spread!

From thomas@xs4all.net  Tue Oct 22 21:51:09 2002
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 22 Oct 2002 21:51:09 +0300 (EEST)
Return-Path: <thomas@xs4all.net>
Delivered-To: dovecot@procontrol.fi
Received: from smtpzilla5.xs4all.nl (smtpzilla5.xs4all.nl [194.109.127.141])
	by danu.procontrol.fi (Postfix) with ESMTP id DA74523837
	for <dovecot@procontrol.fi>; Tue, 22 Oct 2002 21:51:08 +0300 (EEST)
Received: from centurion.xs4all.nl (centurion.xs4all.nl [194.109.0.100])
	by smtpzilla5.xs4all.nl (8.12.0/8.12.0) with ESMTP id g9MIp8pE020363
	for <dovecot@procontrol.fi>; Tue, 22 Oct 2002 20:51:08 +0200 (CEST)
Received: by centurion.xs4all.nl (Postfix, from userid 1000)
	id 1F1D22D43; Tue, 22 Oct 2002 20:49:37 +0200 (CEST)
Date: Tue, 22 Oct 2002 20:49:37 +0200
From: Thomas Wouters <thomas@xs4all.net>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Architectural questions
Message-ID: <20021022184937.GJ543@xs4all.nl>
References: <1035206128.613.8.camel@hurina> <20021021141929.GY543@xs4all.nl> <1035249894.5044.28.camel@hurina> <1035253882.5041.34.camel@hurina> <20021022114922.GF543@xs4all.nl> <20021022130146.GB8122@irccrew.org> <20021022130650.GC8122@irccrew.org> <20021022132228.GG543@xs4all.nl> <20021022140013.GD8122@irccrew.org> <20021022181819.GI543@xs4all.nl>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20021022181819.GI543@xs4all.nl>
User-Agent: Mutt/1.4i
X-message-flag: Danger Will Robinson!
X-archive-position: 78
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: thomas@xs4all.net
Precedence: bulk
X-list: dovecot
X-UID: 78                                                  
Status: O
Content-Length: 1919

On Tue, Oct 22, 2002 at 08:18:19PM +0200, Thomas Wouters wrote:

> Heh. That reminds me... Have you considered using, for instance,
> SourceForge to host dovecot ?

And while on *that* subject, the current CVS tree needs a patch like this to
compile. (And the usual Makefile rebuilds.) But I'm sure you already noticed
:-)

Index: src/login/Makefile.am
===================================================================
RCS file: /home/thomas/cvs-root/dovecot/src/login/Makefile.am,v
retrieving revision 1.1.1.1
diff -c -r1.1.1.1 Makefile.am
*** src/login/Makefile.am	9 Aug 2002 09:15:53 -0000	1.1.1.1
--- src/login/Makefile.am	22 Oct 2002 18:48:32 -0000
***************
*** 1,7 ****
  pkglib_PROGRAMS = imap-login
  
  INCLUDES = \
! 	-I$(top_srcdir)/src/lib
  
  imap_login_LDADD = \
  	../lib/liblib.a \
--- 1,8 ----
  pkglib_PROGRAMS = imap-login
  
  INCLUDES = \
! 	-I$(top_srcdir)/src/lib \
! 	-DPACKAGE=\""$(PACKAGE)"\"
  
  imap_login_LDADD = \
  	../lib/liblib.a \
Index: src/master/Makefile.am
===================================================================
RCS file: /home/thomas/cvs-root/dovecot/src/master/Makefile.am,v
retrieving revision 1.1.1.1
diff -c -r1.1.1.1 Makefile.am
*** src/master/Makefile.am	9 Aug 2002 09:15:55 -0000	1.1.1.1
--- src/master/Makefile.am	22 Oct 2002 18:48:12 -0000
***************
*** 4,10 ****
  	-I$(top_srcdir)/src/lib \
  	-DSYSCONFDIR=\""$(sysconfdir)"\" \
  	-DPKG_RUNDIR=\""$(localstatedir)/run/$(PACKAGE)"\" \
! 	-DPKG_LIBDIR=\""$(pkglibdir)"\"
  
  imap_master_LDADD = \
  	../lib/liblib.a
--- 4,11 ----
  	-I$(top_srcdir)/src/lib \
  	-DSYSCONFDIR=\""$(sysconfdir)"\" \
  	-DPKG_RUNDIR=\""$(localstatedir)/run/$(PACKAGE)"\" \
! 	-DPKG_LIBDIR=\""$(pkglibdir)"\" \
! 	-DPACKAGE=\""$(PACKAGE)"\"
  
  imap_master_LDADD = \
  	../lib/liblib.a


-- 
Thomas Wouters <thomas@xs4all.net>

Hi! I'm a .signature virus! copy me into your .signature file to help me spread!

From tss@iki.fi  Tue Oct 22 23:50:41 2002
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 22 Oct 2002 23:50:41 +0300 (EEST)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id BF23A23837
	for <dovecot@procontrol.fi>; Tue, 22 Oct 2002 23:50:41 +0300 (EEST)
Received: by hurina (Postfix, from userid 1000)
	id 408425E01F42; Tue, 22 Oct 2002 23:50:40 +0300 (EEST)
Subject: [dovecot] Re: Architectural questions
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20021022184937.GJ543@xs4all.nl>
References: <1035206128.613.8.camel@hurina> <20021021141929.GY543@xs4all.nl>
	 <1035249894.5044.28.camel@hurina> <1035253882.5041.34.camel@hurina>
	 <20021022114922.GF543@xs4all.nl> <20021022130146.GB8122@irccrew.org>
	 <20021022130650.GC8122@irccrew.org> <20021022132228.GG543@xs4all.nl>
	 <20021022140013.GD8122@irccrew.org> <20021022181819.GI543@xs4all.nl>
	 <20021022184937.GJ543@xs4all.nl>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1035319840.1665.6.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.1.1.99 (Preview Release)
Date: 22 Oct 2002 23:50:40 +0300
X-archive-position: 79
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 79                                                  
Status: O

On Tue, 2002-10-22 at 21:49, Thomas Wouters wrote:
> And while on *that* subject, the current CVS tree needs a patch like this to
> compile. (And the usual Makefile rebuilds.) But I'm sure you already noticed
> :-)

config.h should define the PACKAGE, and it does for me with both
autoconf 2.13 and 2.5. Did you use GNU make? automake doesn't work very
well without.

> Index: src/login/Makefile.am
> ===================================================================
> RCS file: /home/thomas/cvs-root/dovecot/src/login/Makefile.am,v
> retrieving revision 1.1.1.1
> diff -c -r1.1.1.1 Makefile.am

and diff -u in future please :)


From thomas@xs4all.net  Wed Oct 23 00:21:33 2002
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 23 Oct 2002 00:21:33 +0300 (EEST)
Return-Path: <thomas@xs4all.net>
Delivered-To: dovecot@procontrol.fi
Received: from smtpzilla5.xs4all.nl (smtpzilla5.xs4all.nl [194.109.127.141])
	by danu.procontrol.fi (Postfix) with ESMTP id 151F02382D
	for <dovecot@procontrol.fi>; Wed, 23 Oct 2002 00:21:33 +0300 (EEST)
Received: from centurion.xs4all.nl (centurion.xs4all.nl [194.109.0.100])
	by smtpzilla5.xs4all.nl (8.12.0/8.12.0) with ESMTP id g9MLLWBC050470
	for <dovecot@procontrol.fi>; Tue, 22 Oct 2002 23:21:32 +0200 (CEST)
Received: by centurion.xs4all.nl (Postfix, from userid 1000)
	id D36752D43; Tue, 22 Oct 2002 23:20:00 +0200 (CEST)
Date: Tue, 22 Oct 2002 23:20:00 +0200
From: Thomas Wouters <thomas@xs4all.net>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Architectural questions
Message-ID: <20021022212000.GK543@xs4all.nl>
References: <1035249894.5044.28.camel@hurina> <1035253882.5041.34.camel@hurina> <20021022114922.GF543@xs4all.nl> <20021022130146.GB8122@irccrew.org> <20021022130650.GC8122@irccrew.org> <20021022132228.GG543@xs4all.nl> <20021022140013.GD8122@irccrew.org> <20021022181819.GI543@xs4all.nl> <20021022184937.GJ543@xs4all.nl> <1035319840.1665.6.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1035319840.1665.6.camel@hurina>
User-Agent: Mutt/1.4i
X-message-flag: Danger Will Robinson!
X-archive-position: 80
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: thomas@xs4all.net
Precedence: bulk
X-list: dovecot
X-UID: 80                                                  
Status: O

On Tue, Oct 22, 2002 at 11:50:40PM +0300, Timo Sirainen wrote:
> On Tue, 2002-10-22 at 21:49, Thomas Wouters wrote:

> > And while on *that* subject, the current CVS tree needs a patch like this to
> > compile. (And the usual Makefile rebuilds.) But I'm sure you already noticed
> > :-)

> config.h should define the PACKAGE, and it does for me with both
> autoconf 2.13 and 2.5. Did you use GNU make? automake doesn't work very
> well without.

Ah, hm, I must have done something wrong with the
aclocal/autoheader/automake/autoconf dance. It wasn't in my config.h or
config.h.in, but I reran aclocal and now it's in config.h.in. I'm not used
to using automake, just autoconf/autoheader :)

> > diff -c -r1.1.1.1 Makefile.am

> and diff -u in future please :)

But, but, diff -c is so much more readable! :P Sigh :)

-- 
Thomas Wouters <thomas@xs4all.net>

Hi! I'm a .signature virus! copy me into your .signature file to help me spread!

From tss@iki.fi  Wed Oct 23 00:46:21 2002
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 23 Oct 2002 00:46:21 +0300 (EEST)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 17B3F2382D
	for <dovecot@procontrol.fi>; Wed, 23 Oct 2002 00:46:21 +0300 (EEST)
Received: by hurina (Postfix, from userid 1000)
	id ADF1E5E01F42; Wed, 23 Oct 2002 00:46:15 +0300 (EEST)
Subject: [dovecot] Re: Architectural questions
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20021022124722.GA942@linux.taugt.net>
References: <20021019123846.GK543@xs4all.nl>
	 <1035036115.1674.81.camel@hurina> <20021021115143.GS543@xs4all.nl>
	 <1035206128.613.8.camel@hurina> <20021021141929.GY543@xs4all.nl>
	 <1035249894.5044.28.camel@hurina> <1035253882.5041.34.camel@hurina>
	 <20021022124722.GA942@linux.taugt.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1035323175.1665.31.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.1.1.99 (Preview Release)
Date: 23 Oct 2002 00:46:15 +0300
X-archive-position: 81
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 81                                                  
Status: O

On Tue, 2002-10-22 at 15:47, Marcus Rueckert wrote:
> i just wanted to suggest http://www.vergenet.net/linux/perdition/
> for proxying. but if dovecot could do something similar by it self this
> is not needed :)

It wouldn't be difficult to add proxying for dovecot, since it already
does authentication and can SSL connections are pretty much proxied
already through separate process.

Anyway I looked at Perdition. It doesn't support AUTHENTICATE, plus I
just found buffer overflow from it without even trying much.


From tss@iki.fi  Wed Oct 23 02:52:25 2002
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 23 Oct 2002 02:52:25 +0300 (EEST)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id CBF5A2382D
	for <dovecot@procontrol.fi>; Wed, 23 Oct 2002 02:52:25 +0300 (EEST)
Received: by hurina (Postfix, from userid 1000)
	id 4A2335E01F42; Wed, 23 Oct 2002 02:52:25 +0300 (EEST)
Subject: [dovecot] New mailing list: dovecot-cvs
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1035330745.1664.71.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.1.1.99 (Preview Release)
Date: 23 Oct 2002 02:52:25 +0300
X-archive-position: 82
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 82                                                  
Status: O

Installed syncmail program what Thomas was wanting. It sends a mail of
each cvs commit, including the actual changes in source. Otherwise the
mailing list is read-only. Subscribing happens the same way as to
dovecot list, ie. dovecot-cvs-request@procontrol.fi with subscribe in
subject.

Hmm. I think I should also separate the private/public cvs repositories
running in that computer and provide anonymous pserver access..


From tss@iki.fi  Wed Oct 23 04:20:15 2002
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 23 Oct 2002 04:20:15 +0300 (EEST)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 7FDEB2382C
	for <dovecot@procontrol.fi>; Wed, 23 Oct 2002 04:20:15 +0300 (EEST)
Received: by hurina (Postfix, from userid 1000)
	id E1A4A5E01F42; Wed, 23 Oct 2002 04:20:14 +0300 (EEST)
Subject: [dovecot] anonymous CVS access
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1035336014.21702.41.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.1.1.99 (Preview Release)
Date: 23 Oct 2002 04:20:14 +0300
X-archive-position: 83
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 83                                                  
Status: O

OK, added anon-pserver:

cvs -d :pserver:anonymous@dovecot.procontrol.fi:/home/cvs co dovecot


From thomas@xs4all.net  Wed Oct 23 14:20:20 2002
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 23 Oct 2002 14:20:20 +0300 (EEST)
Return-Path: <thomas@xs4all.net>
Delivered-To: dovecot@procontrol.fi
Received: from smtpzilla3.xs4all.nl (smtpzilla3.xs4all.nl [194.109.127.139])
	by danu.procontrol.fi (Postfix) with ESMTP id 06A182382C
	for <dovecot@procontrol.fi>; Wed, 23 Oct 2002 14:20:20 +0300 (EEST)
Received: from centurion.xs4all.nl (centurion.xs4all.nl [194.109.0.100])
	by smtpzilla3.xs4all.nl (8.12.0/8.12.0) with ESMTP id g9NBKJFY030421
	for <dovecot@procontrol.fi>; Wed, 23 Oct 2002 13:20:19 +0200 (CEST)
Received: by centurion.xs4all.nl (Postfix, from userid 1000)
	id BA1222E31; Wed, 23 Oct 2002 13:18:43 +0200 (CEST)
Date: Wed, 23 Oct 2002 13:18:43 +0200
From: Thomas Wouters <thomas@xs4all.net>
To: dovecot@procontrol.fi
Subject: [dovecot] vsnprintf()
Message-ID: <20021023111843.GA3563@xs4all.nl>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.4i
X-message-flag: Danger Will Robinson!
X-archive-position: 84
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: thomas@xs4all.net
Precedence: bulk
X-list: dovecot
X-UID: 84                                                  
Status: O


I think I stumbled upon a bug in the i_snprintf() function. In the case of
vnsprintf() being available, it depends on vnsprintf() returning -1 when the
string was longer than the passed-in limit (or it won't terminate the
string.). But this isn't the C99-standardized behaviour, and newer glibc's
don't do that anymore either, so you can end up with a non-terminated
string. This patch should fix it, I think.

Index: strfuncs.c
===================================================================
RCS file: /home/cvs/dovecot/src/lib/strfuncs.c,v
retrieving revision 1.14
diff -c -u -r1.14 strfuncs.c
--- strfuncs.c	20 Oct 2002 03:19:10 -0000	1.14
+++ strfuncs.c	23 Oct 2002 11:19:39 -0000
@@ -401,7 +401,7 @@
 	va_end(args);
 	t_pop();
 
-	if (ret < 0) {
+	if (ret < 0 || ret >= max_chars) {
 		str[max_chars-1] = '\0';
 		ret = strlen(str);
 	}


-- 
Thomas Wouters <thomas@xs4all.net>

Hi! I'm a .signature virus! copy me into your .signature file to help me spread!

From tss@iki.fi  Wed Oct 23 16:16:37 2002
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 23 Oct 2002 16:16:37 +0300 (EEST)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 2E1882382C
	for <dovecot@procontrol.fi>; Wed, 23 Oct 2002 16:16:37 +0300 (EEST)
Received: by hurina (Postfix, from userid 1000)
	id 934505E01F42; Wed, 23 Oct 2002 16:16:36 +0300 (EEST)
Subject: [dovecot] Re: vsnprintf()
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20021023111843.GA3563@xs4all.nl>
References: <20021023111843.GA3563@xs4all.nl>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1035378996.28683.11.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.1.1.99 (Preview Release)
Date: 23 Oct 2002 16:16:36 +0300
X-archive-position: 85
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 85                                                  
Status: O

On Wed, 2002-10-23 at 14:18, Thomas Wouters wrote:
> I think I stumbled upon a bug in the i_snprintf() function. In the case of
> vnsprintf() being available, it depends on vnsprintf() returning -1 when the
> string was longer than the passed-in limit (or it won't terminate the
> string.). But this isn't the C99-standardized behaviour, and newer glibc's
> don't do that anymore either, so you can end up with a non-terminated
> string. This patch should fix it, I think.

Hm. vsnprintf() does terminate the string with \0 always, unless it
returns -1. But I'll apply the patch anyway just to be sure :) Also
my_vsyslog() didn't check the vsnprintf() return value at all. Have to
go through that lib code more carefully some day..


From thomas@xs4all.net  Wed Oct 23 16:38:07 2002
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 23 Oct 2002 16:38:07 +0300 (EEST)
Return-Path: <thomas@xs4all.net>
Delivered-To: dovecot@procontrol.fi
Received: from smtpzilla1.xs4all.nl (smtpzilla1.xs4all.nl [194.109.127.137])
	by danu.procontrol.fi (Postfix) with ESMTP id 07B272382C
	for <dovecot@procontrol.fi>; Wed, 23 Oct 2002 16:38:07 +0300 (EEST)
Received: from centurion.xs4all.nl (centurion.xs4all.nl [194.109.0.100])
	by smtpzilla1.xs4all.nl (8.12.0/8.12.0) with ESMTP id g9NDc6YL048557
	for <dovecot@procontrol.fi>; Wed, 23 Oct 2002 15:38:06 +0200 (CEST)
Received: by centurion.xs4all.nl (Postfix, from userid 1000)
	id E44094CF0; Wed, 23 Oct 2002 15:36:29 +0200 (CEST)
Date: Wed, 23 Oct 2002 15:36:29 +0200
From: Thomas Wouters <thomas@xs4all.net>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: vsnprintf()
Message-ID: <20021023133629.GM543@xs4all.nl>
References: <20021023111843.GA3563@xs4all.nl> <1035378996.28683.11.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1035378996.28683.11.camel@hurina>
User-Agent: Mutt/1.4i
X-message-flag: Danger Will Robinson!
X-archive-position: 86
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: thomas@xs4all.net
Precedence: bulk
X-list: dovecot
X-UID: 86                                                  
Status: O
Content-Length: 1204

On Wed, Oct 23, 2002 at 04:16:36PM +0300, Timo Sirainen wrote:
> On Wed, 2002-10-23 at 14:18, Thomas Wouters wrote:
> > I think I stumbled upon a bug in the i_snprintf() function. In the case of
> > vnsprintf() being available, it depends on vnsprintf() returning -1 when the
> > string was longer than the passed-in limit (or it won't terminate the
> > string.). But this isn't the C99-standardized behaviour, and newer glibc's
> > don't do that anymore either, so you can end up with a non-terminated
> > string. This patch should fix it, I think.

> Hm. vsnprintf() does terminate the string with \0 always, unless it
> returns -1. But I'll apply the patch anyway just to be sure :)

Hmm. Yeah, testing confirms you are right, I was just confused by the Linux
manpage on the printf-functions. The FreeBSD manpage states it
unambigiously:

     Snprintf() and vsnprintf() will write at most size-1 of the characters
     printed into the output string (the size'th character then gets the
     terminating `\0')

Hey, that means I can go back and clean up some of my old code :-P

-- 
Thomas Wouters <thomas@xs4all.net>

Hi! I'm a .signature virus! copy me into your .signature file to help me spread!

From dgc@uchicago.edu  Wed Oct 23 20:13:44 2002
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 23 Oct 2002 20:13:45 +0300 (EEST)
Return-Path: <dgc@uchicago.edu>
Delivered-To: dovecot@procontrol.fi
Received: from dust.uchicago.edu (dust.uchicago.edu [128.135.0.35])
	by danu.procontrol.fi (Postfix) with ESMTP id 4AEA12382D
	for <dovecot@procontrol.fi>; Wed, 23 Oct 2002 20:13:44 +0300 (EEST)
Received: (from dgc@localhost)
	by dust.uchicago.edu (8.11.6/8.11.6) id g9NHDd720129;
	Wed, 23 Oct 2002 12:13:39 -0500 (CDT)
X-Authentication-Warning: dust.uchicago.edu: dgc set sender to dgc@uchicago.edu using -f
Date: Wed, 23 Oct 2002 12:13:39 -0500
From: David Champion <dgc@uchicago.edu>
To: Thomas Wouters <thomas@xs4all.net>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: vsnprintf()
Message-ID: <20021023171339.GO4662@dust.uchicago.edu>
References: <20021023111843.GA3563@xs4all.nl>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20021023111843.GA3563@xs4all.nl>
User-Agent: Mutt/1.5.1i
X-archive-position: 87
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: dgc@uchicago.edu
Precedence: bulk
X-list: dovecot
X-UID: 87                                                  
Status: O
Content-Length: 2444

* On 2002.10.23, in <20021023111843.GA3563@xs4all.nl>,
*	"Thomas Wouters" <thomas@xs4all.net> wrote:
> 
> I think I stumbled upon a bug in the i_snprintf() function. In the case of
> vnsprintf() being available, it depends on vnsprintf() returning -1 when the
> string was longer than the passed-in limit (or it won't terminate the
> string.). But this isn't the C99-standardized behaviour, and newer glibc's
> don't do that anymore either, so you can end up with a non-terminated
> string. This patch should fix it, I think.

Ah, I'm glad glibc has fixed this. (Have they fixed snprintf(), too?)
This patch looks correct for Solaris, as well.

There's an alternative approach that depends on the newer vsnprintf()
behavior. You can use
 
{
	char c, *buf;
	length = vsnprintf(&c, 1, fmt, vp);
	buf = malloc(length+1);
	vsnprintf(buf, length, fmt, vp);
}

to dynamically size the buffer as large as it needs to be. For general
formatting routines, I sometimes use this idiom (not totally valid C,
and no error-checking):

format(...)
{
	static char *buf = NULL;	/* workspace */
	static int buf_len = 0;		/* usable area in buf (size - '\0') */
	int fmt_len;			/* length of formatted string */
	...

	if (buf == NULL) {
		/* init to minimum size */
		buf = malloc(128+1);
		buf_len = 128;
	}

	/* Format once, and find out how long the formatted data was */
	fmt_len = vsnprintf(buf, buf_len+1, fmt, vp);

	/* If longer than buf, resize buf amnd try again */
	if (fmt_len > buf_len) {
		realloc(buf, (buf_len = fmt_len) + 1);
		vsnprintf(buf, buf_len+1, fmt, vp);
	}
	...
}

This makes sure I always have a big-enough buffer, without lots of
unneeded mallocing and freeing. The down-side is that it only works on
modern systems, because of the issue with [v]snprintf()'s return value.
And it sometimes formats the string twice, which is perhaps not good,
but perhaps alright. And I guess it's not re-entrant, which could be a
problem, though it could be made re-entrant with some work. :)


Anyway, this is perhaps a little much for a first post to a list from
someone who hasn't found time to look at or compile the code yet, but
off it goes....

-- 
 -D.                    We establised a fine coffee. What everybody can say
 Sun Project, APC/UCCO  TASTY! It's fresh, so-mild, with some special coffee's
 University of Chicago  bitter and sourtaste. "LET'S HAVE SUCH A COFFEE! NOW!"
 dgc@uchicago.edu       Please love CAFE MIAMI. Many thanks.

From tss@iki.fi  Wed Oct 23 20:21:57 2002
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 23 Oct 2002 20:21:57 +0300 (EEST)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id A6D332382C
	for <dovecot@procontrol.fi>; Wed, 23 Oct 2002 20:21:56 +0300 (EEST)
Received: by hurina (Postfix, from userid 1000)
	id C67185E01F42; Wed, 23 Oct 2002 20:21:55 +0300 (EEST)
Subject: [dovecot] Re: vsnprintf()
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20021023171339.GO4662@dust.uchicago.edu>
References: <20021023111843.GA3563@xs4all.nl>
	 <20021023171339.GO4662@dust.uchicago.edu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1035393715.29469.5.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.1.1.99 (Preview Release)
Date: 23 Oct 2002 20:21:55 +0300
X-archive-position: 88
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 88                                                  
Status: O

On Wed, 2002-10-23 at 20:13, David Champion wrote:
> There's an alternative approach that depends on the newer vsnprintf()
> behavior. You can use
>  
> {
> 	char c, *buf;
> 	length = vsnprintf(&c, 1, fmt, vp);
> 	buf = malloc(length+1);
> 	vsnprintf(buf, length, fmt, vp);
> }
> 
> to dynamically size the buffer as large as it needs to be. For general
> formatting routines, I sometimes use this idiom (not totally valid C,
> and no error-checking):

Not too bad idea :) Dovecot currently uses a bit modified GLIB's
g_printf_string_upper_bound() and then allocates enough memory based on
it. Maybe using vsnprintf() could be optional (detected by configure if
it works), if it's better/faster than my upper_bound() function.


From tss@iki.fi  Tue Oct 29 05:26:31 2002
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 29 Oct 2002 05:26:31 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 6C4712382C
	for <dovecot@procontrol.fi>; Tue, 29 Oct 2002 05:26:31 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id CB8525E01F42; Tue, 29 Oct 2002 05:26:30 +0200 (EET)
Subject: [dovecot] Re: pam + radius
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20021028190110.D22448@misato.nikojet.com>
References: <20021028190110.D22448@misato.nikojet.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1035861990.781.23.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.1.1.99 (Preview Release)
Date: 29 Oct 2002 05:26:30 +0200
X-archive-position: 89
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 89                                                  
Status: O

On Tue, 2002-10-29 at 05:01, Hielke Christian Braun wrote:
> i am trying to use dovecot with pam and radius. My users have names
> in the format joe@somedomain.com. When i have pam configured to use
> the normal passwd/shadow files it works fine. With radius it does not.
> I see at the radius server that the domain part of my usernames
> is always replaced with the same domain @nikojet.com. I don't think
> it is a problem with the pam radius, as the same library works fine
> with the solid state pop3 server. Is this a fundamental problem and
> dovecot/imap does not work with usernames which have a domain part or
> is it a bug? 

You probably don't have the users in /etc/passwd file too, right?
Dovecot currently wants the users to exist there too to get their UID,
GID and home directory. I'll change this later so that you could give
"gid=123 uid=456 homeroot=/var/mail" options to pam auth and it'd use
them for all users.

Or did PAM also support getting that information in some way? I'm not
sure exactly..


From tss@iki.fi  Tue Oct 29 07:01:47 2002
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 29 Oct 2002 07:01:47 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 49C7F2382D
	for <dovecot@procontrol.fi>; Tue, 29 Oct 2002 07:01:47 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 14E5B5E01F42; Tue, 29 Oct 2002 07:01:47 +0200 (EET)
Subject: [dovecot] Re: pam + radius
From: Timo Sirainen <tss@iki.fi>
To: Hielke Christian Braun <hcb@nikotel.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <20021028200037.A27315@misato.nikojet.com>
References: <20021028190110.D22448@misato.nikojet.com>
	 <1035861990.781.23.camel@hurina> <20021028200037.A27315@misato.nikojet.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1035867706.779.38.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.1.1.99 (Preview Release)
Date: 29 Oct 2002 07:01:46 +0200
X-archive-position: 90
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 90                                                  
Status: O
Content-Length: 1099

On Tue, 2002-10-29 at 06:00, Hielke Christian Braun wrote:
> > You probably don't have the users in /etc/passwd file too, right?
> 
> I have the users in the passwd and shadow files as i need that for quotas
> to work. Though in the shadow file i don't have the password and only a x.
> The problem must be something else.

Well .. I don't know then really. Since you did get it to work by
changing PAM to use shadow auth, Dovecot is doing it at least partly
right. Maybe the radius PAM module requires something that Dovecot
didn't do..

Looking at Courier's PAM handling, it does pam_setcred() which dovecot
doesn't. You could try if doing that helps:

src/auth/userinfo-pam.c, around line 169, insert between
pam_authenticate() and pam_acct_mgmt():

	if ((status = pam_setcred(pamh, PAM_ESTABLISH_CRED)) != PAM_SUCCESS) {
		if (status == PAM_ABORT)
			i_fatal("pam_setcred_mgmt() requested abort");
		return FALSE;
	}

> Maybe it dovecot sets a realm, which is then mistakenly used by
> the pam radius module, but not by the passwd/shadow module?

PAM doesn't have any support for realms AFAIK.


From tss@iki.fi  Sun Nov  3 02:11:15 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 03 Nov 2002 02:11:15 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id A5E602382D
	for <dovecot@procontrol.fi>; Sun,  3 Nov 2002 02:11:15 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 5B5EF5E01F55; Sun,  3 Nov 2002 02:11:15 +0200 (EET)
Subject: [dovecot] Re: pam + radius
From: Timo Sirainen <tss@iki.fi>
To: Hielke Christian Braun <hcb@nikotel.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <20021031113245.W22448@misato.nikojet.com>
References: <20021028190110.D22448@misato.nikojet.com>
	 <1035861990.781.23.camel@hurina> <20021028200037.A27315@misato.nikojet.com>
	 <1035867706.779.38.camel@hurina> <20021031113245.W22448@misato.nikojet.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1036282275.263.1.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.1.1.99 (Preview Release)
Date: 03 Nov 2002 02:11:15 +0200
X-archive-position: 91
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 91                                                  
Status: O

On Thu, 2002-10-31 at 21:32, Hielke Christian Braun wrote:
> It helped a bit. Now the first login to dovecot works fine. The domainpart
> of my username is not changed. But after the first login, dovecot 
> always sents the username from the first login to the radius server even when
> i login from a different client with a complete different username.

OK, fixed now in CVS. I implemented PAM support pretty wrong.


From simon@lindgren.no  Tue Nov 12 15:27:35 2002
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 12 Nov 2002 15:27:35 +0200 (EET)
Return-Path: <simon@lindgren.no>
Delivered-To: dovecot@procontrol.fi
Received: from mail46.fg.online.no (mail46-s.fg.online.no [148.122.161.46])
	by danu.procontrol.fi (Postfix) with ESMTP id 5629F2382D
	for <dovecot@procontrol.fi>; Tue, 12 Nov 2002 15:27:35 +0200 (EET)
Received: from ti211310a080-1828.bb.online.no (ti211310a080-1828.bb.online.no [80.212.71.36])
	by mail46.fg.online.no (8.9.3/8.9.3) with ESMTP id OAA04851
	for <dovecot@procontrol.fi>; Tue, 12 Nov 2002 14:27:34 +0100 (MET)
From: Simon Lindgren <simon@lindgren.no>
To: dovecot@procontrol.fi
Subject: [dovecot] Seen bug?
Date: Tue, 12 Nov 2002 14:27:33 +0100
User-Agent: KMail/1.5
MIME-Version: 1.0
Content-Type: text/plain;
  charset="us-ascii"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline
Message-Id: <200211121427.33943.simon@lindgren.no>
X-archive-position: 92
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: simon@lindgren.no
Precedence: bulk
X-list: dovecot
X-UID: 92                                                  
Status: O
Content-Length: 3096

Hi,

I'm using Kmail and dovecot for my IMAP pleasure, and have had some problems, 
which are evident from the following exchange with some kmail developers.

My patch to the imap protocol in KDE fixed my problem, but should dovecot be 
changed instead?

Thank you for any insight!

I've included the discussion on kmail-devel so far:

[ I wrote: ]
--
I've recently switched to IMAP for email (using dovecot as the server, 
http://dovecot.procontrol.fi/) and have a small problem:

Clicking a message brings it up, but doesn't seem to mark it read on the 
server. I need to select 'Message -> Mark Message -> Mark Message as Read' in 
order for it to "stay read" when I check for new mails on the server. 

Is anyone else seeing this behaviour? Is this a bug, or a feature?

I've assigned a shortcut key for 'Mark Message as Read' so I get by, but with 
a large number of messages and folders, it quickly becomes annoying.
--


[ Carsten Burghardt <burghardt@kde.org> wrote in reply: ]
--
As your imap-server is not really common you should check with ethereal the 
communication between kmail and your server.
--


[ I wrote in reply: ]
--
Thanks for the replies... snooping with ethereal, I get the following:
(quoting only the data sent from kmail)

When viewing a mail in kmail:
UID FETCH 203 (UID RFC822)

When specifically flagging it as 'read' in kmail: 
UID STORE 203 -FLAGS.SILENT (\SEEN \ANSWERED \FLAGGED \DRAFT)
UID STORE 203 +FLAGS.SILENT (\SEEN)

It would seem that my problem would be solved if kmail also sent the +FLAGS 
stuff when viewing a message... but I don't know if this would be according 
to the IMAP specification - or if the server should flag the message as 
'seen' when the client does the 'fetch' ?

I do have 'Mark selected message as read after 0 sec' checked - and the 
message is flagged in kmail as read, but without specifically marking it as 
read in kmail, it's still 'unread' after the next 'check mail' run. I hope 
I'm being clear.

If you still think this is a bug with my (non standard, I agree!) IMAP server 
I'll try another one.
--

[ I wrote another reply: ]
--
I made a change to imap4.cc, and it magically works for me - I've not tested 
this one very much, but it seems to do the trick so far.

I would be very interested if someone knowledgeable would tell me just how 
wrong this piece of code is, as I'm working on learning these things.

--- imap4.cc    Tue Oct 15 21:52:43 2002
+++ imap4.cc    Tue Nov 12 01:36:05 2002
@@ -289,6 +289,11 @@
       }
 
       completeQueue.removeRef (cmd);
+
+         if (aSection.find ("ENVELOPE", 0, false) == -1) {
+               doCommand (imapCommand::
+                                  clientStore (aSequence, "+FLAGS.SILENT", 
"\\SEEN"));
+         }
     }
   }
--

[ Carsten Burghardt <burghardt@kde.org> wrote: ]
--
No, everything is alright here, you should check a different server.
--

[ Bo Thorsen <bo@sonofthor.dk> wrote: ]
--
It is definately a bug in the server. The IMAP RFC specifies that a server 
must only once serve a file flagged as new. So your server violates this 
principle.



From tss@iki.fi  Wed Nov 13 02:10:37 2002
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 13 Nov 2002 02:10:37 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 0CFC82382C
	for <dovecot@procontrol.fi>; Wed, 13 Nov 2002 02:10:37 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 881095E01F42; Wed, 13 Nov 2002 02:10:36 +0200 (EET)
Subject: [dovecot] Re: Seen bug?
From: Timo Sirainen <tss@iki.fi>
To: Simon Lindgren <simon@lindgren.no>
Cc: dovecot@procontrol.fi
In-Reply-To: <200211121427.33943.simon@lindgren.no>
References: <200211121427.33943.simon@lindgren.no>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1037146236.32041.102.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.1.1.99 (Preview Release)
Date: 13 Nov 2002 02:10:36 +0200
X-archive-position: 93
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 93                                                  
Status: O

On Tue, 2002-11-12 at 15:27, Simon Lindgren wrote:
> My patch to the imap protocol in KDE fixed my problem, but should dovecot be 
> changed instead?

Yes, it's a bug in Dovecot.

> When viewing a mail in kmail:
> UID FETCH 203 (UID RFC822)

Fetching BODY[] always marks the message read, but I didn't before think
of RFC822 and RFC822.TEXT which should do that too. Fixing..


From tss@iki.fi  Sun Nov 24 21:01:37 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 24 Nov 2002 21:01:37 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 71F052382F
	for <dovecot@procontrol.fi>; Sun, 24 Nov 2002 21:01:37 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id ACC765E01F27; Sun, 24 Nov 2002 21:01:36 +0200 (EET)
Subject: [dovecot] 0.99.0 released
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1038164496.787.6.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.0 
Date: 24 Nov 2002 21:01:36 +0200
X-archive-position: 94
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 94                                                  
Status: O
Content-Length: 1571

I figured now would be a good time for new release. All the major
changes are pretty much done now.

v0.99.0 2002-11-24  Timo Sirainen <tss@iki.fi>

	+ Replaced hash file with binary tree file which makes Dovecot stay
	  fast with large mailboxes after expunging multiple mails.
	+ Several speed improvements with SEARCH
	+ SEARCH CHARSET support using iconv(), although case-insensitive
	  searching is currently supported only for ASCII characters.
	+ OpenSSL support.
	+ Support for regenerating Diffie Hellman and RSA parameters with
	  specified intervals. NOTE: currently doesn't work with OpenSSL.
	+ Support for each login connection being handled in it's own process.
	  This is the default as it's more safe especially with SSL.
	+ mbox locking is now safe, other processes can't modify the mbox file
	  while we're reading it.
	+ Notify clients with "EXISTS" almost immediately after new mail is
	  received.
	+ Rawlog: Support for saving user connections into files - useful for
	  debugging.
	+ Content-Language is finally parsed correctly
	+ Lots of smaller speed optimizations
	- Partial BODY[] fetches weren't working properly
	- BODY[section] was buggy with message/rfc822 MIME parts
	- STARTTLS wasn't working
	- \* flag was missing from PERMANENTFLAGS.
	- Comments inside <> mail addresses crashed.
	- imap-login printed UTC timestamps to logfiles
	- passwd-file wasn't reread the the file changed
	- PAM authentication was implemented wrong, which caused it to break
	  with some PAM plugins.
	- Lots of smaller fixes, mostly to do with reliability



From me@squeakyweasel.net  Sun Nov 24 22:25:42 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 24 Nov 2002 22:25:42 +0200 (EET)
Return-Path: <me@squeakyweasel.net>
Delivered-To: dovecot@procontrol.fi
Received: from mail.stratius.com (unknown [207.44.131.172])
	by danu.procontrol.fi (Postfix) with SMTP id 6F03B2382C
	for <dovecot@procontrol.fi>; Sun, 24 Nov 2002 22:25:41 +0200 (EET)
Received: (qmail 26597 invoked from network); 24 Nov 2002 20:25:36 -0000
Received: from unknown (HELO cobalt) (4.47.73.34)
  by 207.44.131.176 with SMTP; 24 Nov 2002 20:25:36 -0000
Date: Sun, 24 Nov 2002 12:25:45 -0800
From: "Kyle Symonds" <me@squeakyweasel.net>
Reply-To: me@squeakyweasel.net
To: dovecot@procontrol.fi <dovecot@procontrol.fi>
Subject: [dovecot] vpopmail support?
X-mailer: Foxmail 4.1 [eg]
Mime-Version: 1.0
Content-Type: text/plain;
      charset="us-ascii"
Content-Transfer-Encoding: 7bit
Message-Id: <20021124202541.6F03B2382C@danu.procontrol.fi>
X-archive-position: 95
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: me@squeakyweasel.net
Precedence: bulk
X-list: dovecot
X-UID: 95                                                  
Status: O

Well, I read that back in 0.98 or so vpopmail support should work so I assumed it would be enabled in 0.99 but here's what I get.

gcc -DHAVE_CONFIG_H -I. -I. -I../.. -I../../src/lib     -I/usr/local/vpopmail/include -g -O2 -Wall -W    -g -O2 -Wall -W -c userinfo-vpopmail.c
In file included from userinfo-vpopmail.c:12:
/usr/local/vpopmail/include/vpopmail.h:133: syntax error before `*'
*** Error code 1

Stop in /root/dovecot/src/auth.
*** Error code 1

Stop in /root/dovecot/src.
*** Error code 1

Stop in /root/dovecot.
*** Error code 1

Stop in /root/dovecot.

Someone want to throw a bone?  =)

--Weasel
weasel@squeakyweasel.net
http://squeakyweasel.net



From me@squeakyweasel.net  Sun Nov 24 22:32:44 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 24 Nov 2002 22:32:44 +0200 (EET)
Return-Path: <me@squeakyweasel.net>
Delivered-To: dovecot@procontrol.fi
Received: from mail.stratius.com (unknown [207.44.131.172])
	by danu.procontrol.fi (Postfix) with SMTP id C3A332382C
	for <dovecot@procontrol.fi>; Sun, 24 Nov 2002 22:32:43 +0200 (EET)
Received: (qmail 26623 invoked from network); 24 Nov 2002 20:32:42 -0000
Received: from unknown (HELO cobalt) (4.47.73.34)
  by 207.44.131.176 with SMTP; 24 Nov 2002 20:32:42 -0000
Date: Sun, 24 Nov 2002 12:32:51 -0800
From: "Kyle Symonds" <me@squeakyweasel.net>
Reply-To: me@squeakyweasel.net
To: dovecot@procontrol.fi <dovecot@procontrol.fi>
Subject: [dovecot] Re: vpopmail support?
X-mailer: Foxmail 4.1 [eg]
Mime-Version: 1.0
Content-Type: text/plain;
      charset="us-ascii"
Content-Transfer-Encoding: 7bit
Message-Id: <20021124203243.C3A332382C@danu.procontrol.fi>
X-archive-position: 96
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: me@squeakyweasel.net
Precedence: bulk
X-list: dovecot
X-UID: 96                                                  
Status: O

Oh yeah, the system's FreeBSD 4.7-RELEASE.  Trying to do a qmail+vpopmail+pop3+imap setup.

--Weasel
weasel@squeakyweasel.net
http://squeakyweasel.net

======= At 2002-11-24, 12:25:00 you wrote: =======

>Well, I read that back in 0.98 or so vpopmail support should work so I assumed it would be enabled in 0.99 but here's what I get.
>
>gcc -DHAVE_CONFIG_H -I. -I. -I../.. -I../../src/lib     -I/usr/local/vpopmail/include -g -O2 -Wall -W    -g -O2 -Wall -W -c userinfo-vpopmail.c
>In file included from userinfo-vpopmail.c:12:
>/usr/local/vpopmail/include/vpopmail.h:133: syntax error before `*'
>*** Error code 1
>
>Stop in /root/dovecot/src/auth.
>*** Error code 1
>
>Stop in /root/dovecot/src.
>*** Error code 1
>
>Stop in /root/dovecot.
>*** Error code 1
>
>Stop in /root/dovecot.
>
>Someone want to throw a bone?  =)
>
>--Weasel
>weasel@squeakyweasel.net
>http://squeakyweasel.net





From tss@iki.fi  Mon Nov 25 00:24:40 2002
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 25 Nov 2002 00:24:40 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 156622382C
	for <dovecot@procontrol.fi>; Mon, 25 Nov 2002 00:24:40 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 6FDA15E01F27; Mon, 25 Nov 2002 00:24:39 +0200 (EET)
Subject: [dovecot] Re: vpopmail support?
From: Timo Sirainen <tss@iki.fi>
To: me@squeakyweasel.net
Cc: "dovecot@procontrol.fi" <dovecot@procontrol.fi>
In-Reply-To: <20021124202541.6F03B2382C@danu.procontrol.fi>
References: <20021124202541.6F03B2382C@danu.procontrol.fi>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1038176679.789.14.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.0 
Date: 25 Nov 2002 00:24:39 +0200
X-archive-position: 97
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 97                                                  
Status: O

On Sun, 2002-11-24 at 22:25, Kyle Symonds wrote:
> Well, I read that back in 0.98 or so vpopmail support should work so I assumed it would be enabled in 0.99 but here's what I get.
> 
> gcc -DHAVE_CONFIG_H -I. -I. -I../.. -I../../src/lib     -I/usr/local/vpopmail/include -g -O2 -Wall -W    -g -O2 -Wall -W -c userinfo-vpopmail.c
> In file included from userinfo-vpopmail.c:12:
> /usr/local/vpopmail/include/vpopmail.h:133: syntax error before `*'
> *** Error code 1

Well, I hadn't tested it for some time, so it missed one include file.
Add #include <stdio.h> to userinfo-vpopmail.c before the
vpopmail-include and it should work.

Maybe it's time for 0.99.1 soon, there's quite a few build fixes/changes
now in CVS :)


From tss@iki.fi  Mon Nov 25 12:59:34 2002
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 25 Nov 2002 12:59:34 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 0483A2382F
	for <dovecot@procontrol.fi>; Mon, 25 Nov 2002 12:59:34 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 516875E01F27; Mon, 25 Nov 2002 12:59:33 +0200 (EET)
Subject: [dovecot] 0.99.1 released
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1038221973.787.18.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.0 
Date: 25 Nov 2002 12:59:33 +0200
X-archive-position: 98
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 98                                                  
Status: O

Nothing new, just a few compiling/configuration issues fixed.

Dovecot should also be in NetBSD pkgsrc soon. Now who would want to get
it into Debian? :)

v0.99.1 2002-11-25  Timo Sirainen <tss@iki.fi>

	+ Added doc/mkcert.sh script to easily generate yourself a self-signed
	  certificate. Modify doc/dovecot-openssl.cnf before running it.
	+ --with-ssldir configure option to specify default path for /etc/ssl
	+ Added ssl_disable setting to config file
	- OpenSSL wasn't checked properly by configure
	- vpopmail authentication module didn't compile
	- We should install the binaries into libexec dir, not lib
	- doc/configuration.txt and doc/mail-storages.txt were missing


From tss@iki.fi  Tue Nov 26 23:16:04 2002
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 26 Nov 2002 23:16:04 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id CADA92382F
	for <dovecot@procontrol.fi>; Tue, 26 Nov 2002 23:16:04 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 670385E01F27; Tue, 26 Nov 2002 23:16:02 +0200 (EET)
Subject: [dovecot] 0.99.2 released
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1038345362.2676.31.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.0 
Date: 26 Nov 2002 23:16:02 +0200
X-archive-position: 99
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 99                                                  
Status: O

Mostly compiling cleanups but also one bugfix when index wasn't
exclusively locked while it was being fsck'ed - that doesn't normally
happen without crashing/whatever.

v0.99.2 2002-11-26  Timo Sirainen <tss@iki.fi>

	+ If we have to wait for a lock longer, the client is now notified
	  about it every 30 seconds.
	- Default settings still pointed to lib directory instead of the
	  libexec directory where the binaries were actually installed
	- vpopmail support had to be kludged to fix a bug in vpopmail library
	  which sometimes left extra character after the user name.
	- Login process crashed if master process didn't let some user login.
	  Normally this couldn't happen without error in configuration.
	- select() based I/O loop wasn't working so Dovecot didn't work in
	  eg. OSX. Also PAM authentication wasn't detected with OSX.
	- Didn't compile with NetBSD-current


From tss@iki.fi  Tue Nov 26 23:52:42 2002
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 26 Nov 2002 23:52:42 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id B3BBB2382F
	for <dovecot@procontrol.fi>; Tue, 26 Nov 2002 23:52:42 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 6F4C65E01F27; Tue, 26 Nov 2002 23:52:37 +0200 (EET)
Subject: [dovecot] mbox problems
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1038347557.6700.3.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.0 
Date: 26 Nov 2002 23:52:37 +0200
X-archive-position: 100
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 100                                                  
Status: O

Strange .. I didn't think I had done anything that could break things
too badly. Anyway, at least with Solaris EXPUNGE may corrupt part of the
mbox file, so don't do that for now.


From email@pbryan.net  Wed Nov 27 00:03:25 2002
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 27 Nov 2002 00:03:25 +0200 (EET)
Return-Path: <email@pbryan.net>
Delivered-To: dovecot@procontrol.fi
Received: from mail.creatia.net (fozzie.creatia.net [64.180.101.199])
	by danu.procontrol.fi (Postfix) with ESMTP id 1EDB92382C
	for <dovecot@procontrol.fi>; Wed, 27 Nov 2002 00:03:25 +0200 (EET)
Received: from pbryan.net (grover.creatia.net [64.180.101.78])
	by mail.creatia.net (Postfix) with ESMTP id 75DCA88C002
	for <dovecot@procontrol.fi>; Tue, 26 Nov 2002 14:03:18 -0800 (PST)
Message-ID: <3DE3EEBD.1040700@pbryan.net>
Date: Tue, 26 Nov 2002 13:59:25 -0800
From: "Paul C. Bryan" <email@pbryan.net>
User-Agent: Mozilla/5.5 (X11; U; Linux i686; en-US; rv 0.9.2) Gecko/20010726
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: dovecot@procontrol.fi
Subject: [dovecot] dovecot and pop3
X-Enigmail-Version: 0.71.0.0
X-Enigmail-Supports: pgp-inline, pgp-mime
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 101
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: email@pbryan.net
Precedence: bulk
X-list: dovecot
X-UID: 101                                                  
Status: O

Dear dovecotters:

I'm becoming interested in dovecot as a replacement for UW-IMAPD. Any 
project that claims it's the "postfix of ____ servers" deserves a looksee.

If indeed I were to going to switch at some point, I'd need to replace 
the UW POP3 server (which is a part of the UW package). I would prefer 
one that actually used the dovecot IMAP server instead of going to the 
filesystem directly.

Question 1: Anyone know of such a POP3 daemon that connects to the IMAP 
server.

Question 2: If the answer to Q1 is "no", would anyone be interested in 
such a package?

Yours truly,

Paul C. Bryan
email@pbryan.net


From tss@iki.fi  Wed Nov 27 00:11:30 2002
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 27 Nov 2002 00:11:30 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 13CC22382C
	for <dovecot@procontrol.fi>; Wed, 27 Nov 2002 00:11:30 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id DECD85E01F27; Wed, 27 Nov 2002 00:11:26 +0200 (EET)
Subject: [dovecot] 0.99.3 released
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1038348686.9437.3.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.0 
Date: 27 Nov 2002 00:11:26 +0200
X-archive-position: 102
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 102                                                  
Status: O

OK, this one will be the final release for a while, I promise (or hope).
Fixes mbox corruption when expunging mails from the middle of mailbox
with mail_read_mmaped=no which is the default. This bug was already in
0.99.0 release.

I had been using Dovecot like that for 5 days or so without noticing the
bug.. Wonder if I lost any mails.


From skvidal@phy.duke.edu  Wed Nov 27 00:14:00 2002
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 27 Nov 2002 00:14:00 +0200 (EET)
Return-Path: <skvidal@phy.duke.edu>
Delivered-To: dovecot@procontrol.fi
Received: from mail.phy.duke.edu (mail.phy.duke.edu [152.3.182.2])
	by danu.procontrol.fi (Postfix) with ESMTP id ABC782382C
	for <dovecot@procontrol.fi>; Wed, 27 Nov 2002 00:14:00 +0200 (EET)
Received: from opus.phy.duke.edu (opus.phy.duke.edu [152.3.182.42])
	by mail.phy.duke.edu (Postfix) with ESMTP id 86EF0301C4
	for <dovecot@procontrol.fi>; Tue, 26 Nov 2002 17:13:59 -0500 (EST)
Subject: [dovecot] rpm and srpm for dovecot
From: seth vidal <skvidal@phy.duke.edu>
To: dovecot@procontrol.fi
Content-Type: multipart/signed; micalg=pgp-sha1; protocol="application/pgp-signature";
	boundary="=-J1qXPoyGtE2XNN5N6Z6j"
X-Mailer: Ximian Evolution 1.0.3 (1.0.3-6) 
Date: 26 Nov 2002 17:13:58 -0500
Message-Id: <1038348839.7478.78.camel@opus>
Mime-Version: 1.0
X-archive-position: 103
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: skvidal@phy.duke.edu
Precedence: bulk
X-list: dovecot
X-UID: 103                                                  
Status: O


--=-J1qXPoyGtE2XNN5N6Z6j
Content-Type: text/plain
Content-Transfer-Encoding: quoted-printable

hi,
 I put an rpm and srpm for dovecot on:

http://www.dulug.duke.edu/~skvidal/RPMS/

They are made under rhl 7.3 - should build on 8.x I'd bet.

I added an init script to start up imap-master

I've done exactly ZERO testing on these and I'd welcome some feedback,
thanks.

-sv




--=-J1qXPoyGtE2XNN5N6Z6j
Content-Type: application/pgp-signature; name=signature.asc
Content-Description: This is a digitally signed message part

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.0.7 (GNU/Linux)

iD8DBQA94/Im1Aj3x2mIbMcRAsVNAJsHS5eeEEoVxiIlSJIjEEajoIzv2wCbBt8Y
N+5gsWClWJw24n05hC3PuDI=
=AzFn
-----END PGP SIGNATURE-----

--=-J1qXPoyGtE2XNN5N6Z6j--


From skvidal@phy.duke.edu  Wed Nov 27 00:17:10 2002
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 27 Nov 2002 00:17:10 +0200 (EET)
Return-Path: <skvidal@phy.duke.edu>
Delivered-To: dovecot@procontrol.fi
Received: from mail.phy.duke.edu (mail.phy.duke.edu [152.3.182.2])
	by danu.procontrol.fi (Postfix) with ESMTP id B92DC2382C
	for <dovecot@procontrol.fi>; Wed, 27 Nov 2002 00:17:10 +0200 (EET)
Received: from opus.phy.duke.edu (opus.phy.duke.edu [152.3.182.42])
	by mail.phy.duke.edu (Postfix) with ESMTP
	id CA9D430374; Tue, 26 Nov 2002 17:17:09 -0500 (EST)
Subject: [dovecot] Re: dovecot and pop3
From: seth vidal <skvidal@phy.duke.edu>
To: "Paul C. Bryan" <email@pbryan.net>
Cc: dovecot@procontrol.fi
In-Reply-To: <3DE3EEBD.1040700@pbryan.net>
References: <3DE3EEBD.1040700@pbryan.net>
Content-Type: multipart/signed; micalg=pgp-sha1; protocol="application/pgp-signature";
	boundary="=-TMdi3/Oz0IXxsiNNlMkO"
X-Mailer: Ximian Evolution 1.0.3 (1.0.3-6) 
Date: 26 Nov 2002 17:17:08 -0500
Message-Id: <1038349029.7480.80.camel@opus>
Mime-Version: 1.0
X-archive-position: 104
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: skvidal@phy.duke.edu
Precedence: bulk
X-list: dovecot
X-UID: 104                                                  
Status: O
Content-Length: 1314


--=-TMdi3/Oz0IXxsiNNlMkO
Content-Type: text/plain
Content-Transfer-Encoding: quoted-printable

On Tue, 2002-11-26 at 16:59, Paul C. Bryan wrote:
> Dear dovecotters:
>=20
> I'm becoming interested in dovecot as a replacement for UW-IMAPD. Any=20
> project that claims it's the "postfix of ____ servers" deserves a looksee=
.
>=20
> If indeed I were to going to switch at some point, I'd need to replace=20
> the UW POP3 server (which is a part of the UW package). I would prefer=20
> one that actually used the dovecot IMAP server instead of going to the=20
> filesystem directly.
>=20
> Question 1: Anyone know of such a POP3 daemon that connects to the IMAP=20
> server.

not aware of one, no.

>=20
> Question 2: If the answer to Q1 is "no", would anyone be interested in=20
> such a package?

I think it would be a good idea to duplicate the functionality of uw-'s
imap - though my general view is pop3 should be beaten profusely :)

-sv

=20


--=-TMdi3/Oz0IXxsiNNlMkO
Content-Type: application/pgp-signature; name=signature.asc
Content-Description: This is a digitally signed message part

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.0.7 (GNU/Linux)

iD8DBQA94/Lk1Aj3x2mIbMcRAgWtAJ9IuTYEVnFLgwovHBo3K/8dHlmTsACfbchd
OAQUSmRqqv+1HHSerKpjd9U=
=2lbE
-----END PGP SIGNATURE-----

--=-TMdi3/Oz0IXxsiNNlMkO--


From tss@iki.fi  Wed Nov 27 00:21:49 2002
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 27 Nov 2002 00:21:49 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id B637A2382C
	for <dovecot@procontrol.fi>; Wed, 27 Nov 2002 00:21:48 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 790205E01F27; Wed, 27 Nov 2002 00:21:48 +0200 (EET)
Subject: [dovecot] Re: dovecot and pop3
From: Timo Sirainen <tss@iki.fi>
To: "Paul C. Bryan" <email@pbryan.net>
Cc: dovecot@procontrol.fi
In-Reply-To: <3DE3EEBD.1040700@pbryan.net>
References: <3DE3EEBD.1040700@pbryan.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1038349308.9437.14.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.0 
Date: 27 Nov 2002 00:21:48 +0200
X-archive-position: 105
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 105                                                  
Status: O

On Tue, 2002-11-26 at 23:59, Paul C. Bryan wrote:
> If indeed I were to going to switch at some point, I'd need to replace 
> the UW POP3 server (which is a part of the UW package). I would prefer 
> one that actually used the dovecot IMAP server instead of going to the 
> filesystem directly.

Why? Smaller chance of screwups if they don't have compatible file
locking, or making authentication configuration easier? I don't think
either is much of a problem though.

I've been thinking of making a Dovecot POP3 daemon as well. POP3
protocol is so simple that it doesn't take many hours to implement it,
especially because I've tried to keep the IMAP protocol isolated from
the actual functionality (I didn't fully succeed in it, but well
enough). Anyway, this probably won't come that soon, IMAP part still
needs much to do.

If you really need mbox POP3 server, I'd suggest popa3d.


From cloos@jhcloos.com  Wed Nov 27 00:53:27 2002
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 27 Nov 2002 00:53:27 +0200 (EET)
Return-Path: <cloos@jhcloos.com>
Delivered-To: dovecot@procontrol.fi
Received: from ore.jhcloos.com (ore.jhcloos.com [64.240.156.239])
	by danu.procontrol.fi (Postfix) with ESMTP id 616852382C
	for <dovecot@procontrol.fi>; Wed, 27 Nov 2002 00:53:27 +0200 (EET)
Received: from lugabout.jhcloos.org (ppp25.pm3-7.buf-ch.ny.localnet.com [207.251.196.89])
	(using TLSv1 with cipher EDH-RSA-DES-CBC3-SHA (168/168 bits))
	(Client CN "lugabout.jhcloos.org", Issuer "ca.jhcloos.com" (verified OK))
	by ore.jhcloos.com (Postfix) with ESMTP
	id 3BC861D02B; Tue, 26 Nov 2002 16:51:41 -0600 (CST)
Received: from lugabout.jhcloos.org (localhost [127.0.0.1])
	by lugabout.jhcloos.org (Postfix on SuSE Linux 7.3 (i386)) with ESMTP
	id 6C49AB146; Tue, 26 Nov 2002 22:47:22 +0000 (GMT)
To: "Paul C. Bryan" <email@pbryan.net>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: dovecot and pop3
References: <3DE3EEBD.1040700@pbryan.net>
From: "James H. Cloos Jr." <cloos@jhcloos.com>
In-Reply-To: <3DE3EEBD.1040700@pbryan.net>
Date: 26 Nov 2002 17:47:22 -0500
Message-ID: <m3d6osc5j9.fsf@lugabout.jhcloos.org>
Lines: 15
User-Agent: Gnus/5.09 (Gnus v5.9.0) Emacs/21.1
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-archive-position: 106
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: cloos@jhcloos.com
Precedence: bulk
X-list: dovecot
X-UID: 106                                                  
Status: O

>>>>> "Paul" == Paul C Bryan <email@pbryan.net> writes:

Paul> I'd need to replace the UW POP3 server ... 
Paul> I would prefer one that actually used the dovecot IMAP server ...

Paul> Anyone know of such a POP3 daemon that connects to the IMAP server.

Doesn't the UW pops3 server do that?  I believe it at least used to
use the imap server as a backend.  (Though it may have done so by
evec(2)ing imapd(8) rather than via tcp; does dovecot support that
method of imap access?)

Other that that, I'd suggest a search on freshmeat....

-JimC


From me@squeakyweasel.net  Wed Nov 27 00:57:42 2002
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 27 Nov 2002 00:57:42 +0200 (EET)
Return-Path: <me@squeakyweasel.net>
Delivered-To: dovecot@procontrol.fi
Received: from mail.stratius.com (unknown [207.44.131.172])
	by danu.procontrol.fi (Postfix) with SMTP id 873E62382F
	for <dovecot@procontrol.fi>; Wed, 27 Nov 2002 00:57:41 +0200 (EET)
Received: (qmail 3203 invoked from network); 26 Nov 2002 22:57:29 -0000
Received: from unknown (HELO cobalt) (4.47.73.34)
  by 207.44.131.176 with SMTP; 26 Nov 2002 22:57:29 -0000
Date: Tue, 26 Nov 2002 14:57:39 -0800
From: "Kyle Symonds" <me@squeakyweasel.net>
Reply-To: me@squeakyweasel.net
To: dovecot@procontrol.fi <dovecot@procontrol.fi>
Subject: [dovecot] vpopmail - again
X-mailer: Foxmail 4.1 [eg]
Mime-Version: 1.0
Content-Type: text/plain;
      charset="us-ascii"
Content-Transfer-Encoding: 7bit
Message-Id: <20021126225741.873E62382F@danu.procontrol.fi>
X-archive-position: 107
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: me@squeakyweasel.net
Precedence: bulk
X-list: dovecot
X-UID: 107                                                  
Status: O

OK, dovecot compiles fine and starts up.  I changed the auth_userinfo var to vpopmail, fired up imap-master and tried to login via webmail and my log spits out the following:

imap-login: Nov 26 14:50:50 Error: Can't connect to imap-auth at auth: Connection Refused
imap-login: Nov 26 14:50:51 Error: Can't connect to imap-auth at vpopmail: Connection Refused

Any ideas?

--Weasel
weasel@squeakyweasel.net
http://squeakyweasel.net



From tss@iki.fi  Wed Nov 27 01:12:04 2002
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 27 Nov 2002 01:12:04 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 5D4D62382F
	for <dovecot@procontrol.fi>; Wed, 27 Nov 2002 01:12:04 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id CA3EC5E01F27; Wed, 27 Nov 2002 01:12:03 +0200 (EET)
Subject: [dovecot] Re: vpopmail - again
From: Timo Sirainen <tss@iki.fi>
To: me@squeakyweasel.net
Cc: "dovecot@procontrol.fi" <dovecot@procontrol.fi>
In-Reply-To: <20021126225741.873E62382F@danu.procontrol.fi>
References: <20021126225741.873E62382F@danu.procontrol.fi>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1038352323.9437.27.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.0 
Date: 27 Nov 2002 01:12:03 +0200
X-archive-position: 108
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 108                                                  
Status: O

On Wed, 2002-11-27 at 00:57, Kyle Symonds wrote:
> OK, dovecot compiles fine and starts up.  I changed the auth_userinfo var to vpopmail, fired up imap-master and tried to login via webmail and my log spits out the following:
> 
> imap-login: Nov 26 14:50:50 Error: Can't connect to imap-auth at auth: Connection Refused
> imap-login: Nov 26 14:50:51 Error: Can't connect to imap-auth at vpopmail: Connection Refused

Well, do you see any imap-auth processes running? Also try deleting
everything from login processes directory
(/usr/local/var/run/dovecot/login/ by default), you probably have some
stale socket files in there.

And what does your "auth" variable contain? At least you've changed it
to both "auth" and "vpopmail" before :)


From tss@iki.fi  Wed Nov 27 01:16:47 2002
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 27 Nov 2002 01:16:47 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id F23652382F
	for <dovecot@procontrol.fi>; Wed, 27 Nov 2002 01:16:46 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id A8D775E01F27; Wed, 27 Nov 2002 01:16:46 +0200 (EET)
Subject: [dovecot] Re: dovecot and pop3
From: Timo Sirainen <tss@iki.fi>
To: "James H. Cloos Jr." <cloos@jhcloos.com>
Cc: "Paul C. Bryan" <email@pbryan.net>, dovecot@procontrol.fi
In-Reply-To: <m3d6osc5j9.fsf@lugabout.jhcloos.org>
References: <3DE3EEBD.1040700@pbryan.net>
	 <m3d6osc5j9.fsf@lugabout.jhcloos.org>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1038352606.9438.33.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.0 
Date: 27 Nov 2002 01:16:46 +0200
X-archive-position: 109
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 109                                                  
Status: O

On Wed, 2002-11-27 at 00:47, James H. Cloos Jr. wrote:
> Paul> Anyone know of such a POP3 daemon that connects to the IMAP server.
> 
> Doesn't the UW pops3 server do that?  I believe it at least used to
> use the imap server as a backend.  (Though it may have done so by
> evec(2)ing imapd(8) rather than via tcp; does dovecot support that
> method of imap access?)

Yes, Dovecot's imap process talks to stdin/stdout. All configuration is
read from environment variables, mostly it needs just USER and maybe
MAIL if it can't figure that out itself.


From email@pbryan.net  Wed Nov 27 01:26:39 2002
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 27 Nov 2002 01:26:39 +0200 (EET)
Return-Path: <email@pbryan.net>
Delivered-To: dovecot@procontrol.fi
Received: from mail.creatia.net (fozzie.creatia.net [64.180.101.199])
	by danu.procontrol.fi (Postfix) with ESMTP id EBB812382F
	for <dovecot@procontrol.fi>; Wed, 27 Nov 2002 01:26:38 +0200 (EET)
Received: from pbryan.net (grover.creatia.net [64.180.101.78])
	by mail.creatia.net (Postfix) with ESMTP id 5303488C002
	for <dovecot@procontrol.fi>; Tue, 26 Nov 2002 15:26:35 -0800 (PST)
Message-ID: <3DE40241.5060002@pbryan.net>
Date: Tue, 26 Nov 2002 15:22:41 -0800
From: "Paul C. Bryan" <email@pbryan.net>
User-Agent: Mozilla/5.5 (X11; U; Linux i686; en-US; rv 0.9.2) Gecko/20010726
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: dovecot@procontrol.fi
Subject: [dovecot] Re: dovecot and pop3
References: <3DE3EEBD.1040700@pbryan.net> <1038349308.9437.14.camel@hurina>
In-Reply-To: <3DE3EEBD.1040700@pbryan.net>
X-Enigmail-Version: 0.71.0.0
X-Enigmail-Supports: pgp-inline, pgp-mime
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 110
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: email@pbryan.net
Precedence: bulk
X-list: dovecot
X-UID: 110                                                  
Status: O

Timo Sirainen wrote:

> Why? Smaller chance of screwups if they don't have compatible file
> locking, or making authentication configuration easier? I don't think
> either is much of a problem though.

It makes sense to leave authentication, authorization, mailbox handling 
to one reliable program. Hopefully, that can be the IMAP daemon.

A POP3 gateway would need only pass along the user's credentials to the 
IMAP server, and have no concern about mailbox format or locations, and 
not worry about file locking or implementing any concurrency mechanisms.

Thoughts?

Paul C. Bryan
email@pbryan.net



From tss@iki.fi  Sun Dec  1 18:44:43 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 01 Dec 2002 18:44:43 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id C26202382C
	for <dovecot@procontrol.fi>; Sun,  1 Dec 2002 18:44:42 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 88E035E01F27; Sun,  1 Dec 2002 18:44:42 +0200 (EET)
Subject: [dovecot] 0.99.4 released
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1038761082.24501.2.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.0 
Date: 01 Dec 2002 18:44:42 +0200
X-archive-position: 111
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 111                                                  
Status: O

This fixes the last weird bugs that I know of. Now just a few more
missing features and 1.0 should be there :)

v0.99.4 2002-12-01  Timo Sirainen <tss@iki.fi>

	- Command parser had several bugs when it didn't have enough data to
	  parse the full command in one call, ie. network lags etc. triggered
	  those bugs sometimes. This was the last "weird bug" I know of.
	- Mbox indexes got broken when updating cached fields
	- Fixed a few memory leaks and unneededly high memory usage while
	  caching envelopes
	- Fixes to searching from message body and header
	- --with-ssldir didn't do anything and the default was empty


From skvidal@phy.duke.edu  Sun Dec  1 19:52:33 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 01 Dec 2002 19:52:33 +0200 (EET)
Return-Path: <skvidal@phy.duke.edu>
Delivered-To: dovecot@procontrol.fi
Received: from mail.phy.duke.edu (mail.phy.duke.edu [152.3.182.2])
	by danu.procontrol.fi (Postfix) with ESMTP id 12F4B2382F
	for <dovecot@procontrol.fi>; Sun,  1 Dec 2002 19:52:33 +0200 (EET)
Received: from user-152-16-65-11.adsl.duke.edu (user-152-16-65-11.adsl.duke.edu [152.16.65.11])
	by mail.phy.duke.edu (Postfix) with ESMTP
	id 477B130399; Sun,  1 Dec 2002 12:52:31 -0500 (EST)
Subject: [dovecot] Re: 0.99.4 released
From: seth vidal <skvidal@phy.duke.edu>
To: Timo Sirainen <tss@iki.fi>
Cc: dovecot@procontrol.fi
In-Reply-To: <1038761082.24501.2.camel@hurina>
References: <1038761082.24501.2.camel@hurina>
Content-Type: text/plain
Organization: 
Message-Id: <1038764851.1454.29.camel@binkley>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.0 (1.2.0-1) 
Date: 01 Dec 2002 12:47:31 -0500
Content-Transfer-Encoding: 7bit
X-archive-position: 112
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: skvidal@phy.duke.edu
Precedence: bulk
X-list: dovecot
X-UID: 112                                                  
Status: O

On Sun, 2002-12-01 at 11:44, Timo Sirainen wrote:
> This fixes the last weird bugs that I know of. Now just a few more
> missing features and 1.0 should be there :)
> 
> v0.99.4 2002-12-01  Timo Sirainen <tss@iki.fi>
> 
> 	- Command parser had several bugs when it didn't have enough data to
> 	  parse the full command in one call, ie. network lags etc. triggered
> 	  those bugs sometimes. This was the last "weird bug" I know of.
> 	- Mbox indexes got broken when updating cached fields
> 	- Fixed a few memory leaks and unneededly high memory usage while
> 	  caching envelopes
> 	- Fixes to searching from message body and header
> 	- --with-ssldir didn't do anything and the default was empty

rpms for 0.99.4 are up at: http://www.dulug.duke.edu/~skvidal/RPMS/

These should actually start dovecot and not vsftpd :) - a poor cut and
paste job on my part.

-sv



From hellhound@geek.be  Sun Dec  1 22:43:46 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 01 Dec 2002 22:43:46 +0200 (EET)
Return-Path: <hellhound@geek.be>
Delivered-To: dovecot@procontrol.fi
Received: from fry.linugen.com (geek.be [213.193.156.242])
	by danu.procontrol.fi (Postfix) with SMTP id 01E022382C
	for <dovecot@procontrol.fi>; Sun,  1 Dec 2002 22:43:45 +0200 (EET)
Received: (qmail 131 invoked by uid 1001); 1 Dec 2002 20:42:42 -0000
Date: Sun, 1 Dec 2002 21:42:42 +0100
From: hellhound@geek.be
To: dovecot@procontrol.fi
Subject: [dovecot] Sieve
Message-ID: <20021201204242.GB6027@destructance>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.4i
X-archive-position: 113
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: hellhound@geek.be
Precedence: bulk
X-list: dovecot
X-UID: 113                                                  
Status: O

Hi all,

  I'm using Dovecot for some months now, and I love it!
  I also saw that there are 'plans' to integrate Sieve support.
  Well, some days ago I saw the following on freshmeat:
    libSieve - http://libsieve.sourceforge.net/
       libSieve is a standalone library pulled from CMU's implementation 
       of their Sieve mail sorting library in the Cyrus mail server. 
       Either shared or statically linked, libSieve will help to bring 
       mail sorting functionality into your mail server application 
       without the need to reinvent the wheel. As a library, it is
       not intended for end users expecting a ready-to-run program.
  Maybe this could ease the Sieve integration ?

  If I got some spare time I'm going to contribute some code for it
  myself.

greets


From tss@iki.fi  Sun Dec  1 23:07:08 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 01 Dec 2002 23:07:08 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id ACB552382F
	for <dovecot@procontrol.fi>; Sun,  1 Dec 2002 23:07:08 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 0F6A45E01F27; Sun,  1 Dec 2002 23:07:08 +0200 (EET)
Subject: [dovecot] Re: compiling
From: Timo Sirainen <tss@iki.fi>
To: weasel@squeakyweasel.net
Cc: "dovecot@procontrol.fi" <dovecot@procontrol.fi>
In-Reply-To: <20021201205407.UKKG4558.pop018.verizon.net@cobalt>
References: <20021201205407.UKKG4558.pop018.verizon.net@cobalt>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1038776827.1181.6.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.0 
Date: 01 Dec 2002 23:07:07 +0200
X-archive-position: 114
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 114                                                  
Status: O

On Sun, 2002-12-01 at 22:54, Kyle Symonds wrote:
> Just thought I'd pass this along.  While trying to compile 0.99.4 the following happens:
> 
> restrict-process-size.c: In function `restrict_process_size':
> restrict-process-size.c:41: `RLIMIT_AS' undeclared (first use in this function)
> restrict-process-size.c:41: (Each undeclared identifier is reported only once
> restrict-process-size.c:41: for each function it appears in.)

Thanks. I thought that would have been portable since it was in UNIX98.
You could change that to RLIMIT_DATA and it should be somewhat
equilevant. I'll change it in CVS so that it does both DATA and AS if it
exists.


From tss@iki.fi  Mon Dec  2 00:29:10 2002
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 02 Dec 2002 00:29:10 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 5CC602382C
	for <dovecot@procontrol.fi>; Mon,  2 Dec 2002 00:29:10 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id DB3275E01F27; Mon,  2 Dec 2002 00:29:09 +0200 (EET)
Subject: [dovecot] Re: Sieve
From: Timo Sirainen <tss@iki.fi>
To: hellhound@geek.be
Cc: dovecot@procontrol.fi
In-Reply-To: <20021201204242.GB6027@destructance>
References: <20021201204242.GB6027@destructance>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1038781749.1173.44.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.0 
Date: 02 Dec 2002 00:29:09 +0200
X-archive-position: 115
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 115                                                  
Status: O

On Sun, 2002-12-01 at 22:42, hellhound@geek.be wrote:
>   I'm using Dovecot for some months now, and I love it!
>   I also saw that there are 'plans' to integrate Sieve support.
>   Well, some days ago I saw the following on freshmeat:
>     libSieve - http://libsieve.sourceforge.net/

I'm not sure actually what kind of sieve support Dovecot should/could
have. It's more of a job of SMTP server than IMAP server I think.

Unless I want to create some dovecot-deliver binary (like cyrdeliver
with Cyrus) which can be used to store messages into specified folders.
Advantages with that would be that SMTP server wouldn't need to know
where exactly the messages are stored and how. Possibly a good idea if I
begin using some of those extensions to mbox and Maildir.

Well. The sources don't look too bad, although I think I found a couple
of buffer overflows already, but once I get those fixed I guess the
library should be just fine :)


From tss@iki.fi  Mon Dec  2 13:50:56 2002
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 02 Dec 2002 13:50:56 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id B3BA32382F
	for <dovecot@procontrol.fi>; Mon,  2 Dec 2002 13:50:56 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 6B5195E01F27; Mon,  2 Dec 2002 13:50:56 +0200 (EET)
Subject: [dovecot] Re: sick of me yet?
From: Timo Sirainen <tss@iki.fi>
To: weasel@squeakyweasel.net
Cc: dovecot@procontrol.fi
In-Reply-To: <20021201233733.PZCP9711.out003.verizon.net@cobalt>
References: <20021201233733.PZCP9711.out003.verizon.net@cobalt>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1038829856.6544.3.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.0 
Date: 02 Dec 2002 13:50:56 +0200
X-archive-position: 116
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 116                                                  
Status: O

On Mon, 2002-12-02 at 01:37, Kyle Symonds wrote:
> x login weasel@squeakyweasel.net ********
> x NO Authentication failed: Authentication process died

Well, you should definitely see something about this in log files. Like:

imap-auth: Dec 01 17:59:32 Warning: Killed with signal 11

And if it was killed with signal 11 or 6 you should also find core file
in the directory where you started imap-master?


From lfarkas@bnap.hu  Thu Dec  5 17:56:45 2002
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 05 Dec 2002 17:56:45 +0200 (EET)
Return-Path: <lfarkas@bnap.hu>
Delivered-To: dovecot@procontrol.fi
Received: from portal.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by danu.procontrol.fi (Postfix) with ESMTP id 77FC02382F
	for <dovecot@procontrol.fi>; Thu,  5 Dec 2002 17:56:43 +0200 (EET)
Received: from localhost (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with ESMTP id 96BB53F19
	for <dovecot@procontrol.fi>; Thu,  5 Dec 2002 16:56:39 +0100 (CET)
Received: from portal.bppiac.hu ([127.0.0.1]) by localhost (portal.bppiac.hu [127.0.0.1]) (amavisd-new) with ESMTP id 01529-08 for <dovecot@procontrol.fi>; cs,  5 dec 2002 16:56:39 -0000 (CET)
Received: from garfield.int.bppiac.hu (garfield.int.bppiac.hu [192.168.0.50])
	by portal.bppiac.hu (Postfix) with ESMTP id 6FE0A3F16
	for <dovecot@procontrol.fi>; Thu,  5 Dec 2002 16:56:39 +0100 (CET)
Subject: [dovecot] questions
From: Farkas Levente <lfarkas@bnap.hu>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
X-Mailer: Ximian Evolution 1.0.8 (1.0.8-10) 
Date: 05 Dec 2002 16:56:41 +0100
Message-Id: <1039103801.4482.18.camel@garfield.int.bppiac.hu>
Mime-Version: 1.0
X-Virus-Scanned: on portal.bnap.hu by AMaViS
X-archive-position: 117
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 117                                                  
Status: O
Content-Length: 1113

hi,
I'm look around to find a usable imap server and find dovecot.
I read all the docs, but I've got a few questions:
- currently we use courier (since we find and install it quickly). 
  can we switch from it to dovecot smoothly?
  or we have to convert the maildirs somehow?
- I've got a few plan in my mind it it possible to do it with dovecot
  now or in the near future (if yes what is the estimated time)?:
  - authenticate from LDAP, the best would be trough PAM?
  - use the same user with different domain. eg: lfarkas@bnap.hu,
    lfarkas@bppiac.hu with the same imap server? handle more domains.
  - use imaps and use Digest-MD5 and/or CRAM-MD5?
  - put a database backend under imap and store the mails in a database.
  - use WITHOUT local users? it's very important! most case a user never
    ever log into the local system and I would not like to put them into
    /etc/password.
  - do it all the above at the same time!?
thanks.

-- 
Levente                                  http://petition.eurolinux.org/
 "The only thing worse than not knowing the truth is
  ruining the bliss of ignorance."



From tss@iki.fi  Thu Dec  5 19:46:16 2002
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 05 Dec 2002 19:46:16 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 803C42382F
	for <dovecot@procontrol.fi>; Thu,  5 Dec 2002 19:46:16 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 4EB1C5E01F4F; Thu,  5 Dec 2002 19:46:16 +0200 (EET)
Subject: [dovecot] Re: questions
From: Timo Sirainen <tss@iki.fi>
To: Farkas Levente <lfarkas@bnap.hu>
Cc: dovecot@procontrol.fi
In-Reply-To: <1039103801.4482.18.camel@garfield.int.bppiac.hu>
References: <1039103801.4482.18.camel@garfield.int.bppiac.hu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1039110376.28873.138.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.0 
Date: 05 Dec 2002 19:46:16 +0200
X-archive-position: 118
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 118                                                  
Status: O
Content-Length: 2073

On Thu, 2002-12-05 at 17:56, Farkas Levente wrote:
> hi,
> I'm look around to find a usable imap server and find dovecot.
> I read all the docs, but I've got a few questions:
> - currently we use courier (since we find and install it quickly). 
>   can we switch from it to dovecot smoothly?
>   or we have to convert the maildirs somehow?

Dovecot works fine with Courier. We were using both simultaneously for
months. Message UIDs aren't shared though.

> - I've got a few plan in my mind it it possible to do it with dovecot
>   now or in the near future (if yes what is the estimated time)?:
>   - authenticate from LDAP, the best would be trough PAM?

I don't have much LDAP plans right now .. PAM would likely already have
existing LDAP plugins, but you'd also have to keep the users in
/etc/passwd then (without passwords).

>   - use the same user with different domain. eg: lfarkas@bnap.hu,
>     lfarkas@bppiac.hu with the same imap server? handle more domains.

Authentication issue mostly, with plain authentication Dovecot would
just treat the whole user@domain as a username. Some other mechanisms do
support realms, and Dovecot's Digest-MD5 and passwd-file support realms
already.

>   - use imaps and use Digest-MD5 and/or CRAM-MD5?

imaps and Digest-MD5 are already there. Digest-MD5 can't work (and can't
be made to work) with PAM authentication though.

>   - put a database backend under imap and store the mails in a database.

I've been thinking about SQL database support from the beginning.
However it'd probably be slower and require a bit more memory than with
the current indexes.

>   - use WITHOUT local users? it's very important! most case a user never
>     ever log into the local system and I would not like to put them into
>     /etc/password.

Currently Dovecot supports passwd-like file where you could store the
users. For example /etc/imap.passwd.

Oh, and there's also vpopmail support which should handle virtual
domains and LDAP and everything. Maybe you should try that. Although it
again only support plaintext authentication.


From tss@iki.fi  Fri Dec  6 13:24:37 2002
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 06 Dec 2002 13:24:37 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id CA15A2382F
	for <dovecot@procontrol.fi>; Fri,  6 Dec 2002 13:24:37 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 6F80F5E01F50; Fri,  6 Dec 2002 13:24:37 +0200 (EET)
Subject: [dovecot] Re: questions
From: Timo Sirainen <tss@iki.fi>
To: Farkas Levente <lfarkas@bnap.hu>
Cc: dovecot@procontrol.fi
In-Reply-To: <1039172976.2172.17.camel@garfield.int.bppiac.hu>
References: <1039103801.4482.18.camel@garfield.int.bppiac.hu>
	 <1039110376.28873.138.camel@hurina>
	 <1039172976.2172.17.camel@garfield.int.bppiac.hu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1039173877.1050.26.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.0 
Date: 06 Dec 2002 13:24:37 +0200
X-archive-position: 119
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 119                                                  
Status: O
Content-Length: 1196

On Fri, 2002-12-06 at 13:09, Farkas Levente wrote:
> > I don't have much LDAP plans right now .. PAM would likely already have
> > existing LDAP plugins, but you'd also have to keep the users in
> > /etc/passwd then (without passwords).
> why??? that's what I realy would like to avoid!!! is there any reason? 

PAM can only be used for checking if user/password matches, so it's
missing the passwd information that Dovecot needs, at least home dir and
uid. Although I had been thinking of making those some global settings
in config file, so you could say homedir=/var/user/$USER$ uid=imapusers.

> > I've been thinking about SQL database support from the beginning.
> > However it'd probably be slower and require a bit more memory than with
> > the current indexes.
> 
> ohh? I assume a database should have to be faster, but this is just an
> assumption...

That's mostly because of a few tricks that Dovecot does with it's index
files that aren't really possible with SQL databases. Multiuser
mailboxes which are modified a lot are one thing where they could be
faster than Dovecot's index files because of better locking.

Besides, Dovecot's indexes could be called as a simple database..


From jpeterson275@attbi.com  Thu Dec 12 05:14:16 2002
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 12 Dec 2002 05:14:16 +0200 (EET)
Return-Path: <jpeterson275@attbi.com>
Delivered-To: dovecot@procontrol.fi
Received: from rwcrmhc51.attbi.com (rwcrmhc51.attbi.com [204.127.198.38])
	by danu.procontrol.fi (Postfix) with ESMTP id 989E923840
	for <dovecot@procontrol.fi>; Thu, 12 Dec 2002 05:14:15 +0200 (EET)
Received: from attbi.com (12-228-39-116.client.attbi.com[12.228.39.116])
          by rwcrmhc51.attbi.com (rwcrmhc51) with SMTP
          id <2002121203141005100ja0rie>; Thu, 12 Dec 2002 03:14:11 +0000
Message-ID: <3DF7FF12.7040506@attbi.com>
Date: Wed, 11 Dec 2002 19:14:26 -0800
From: Jesse Peterson <jpeterson275@attbi.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Maildir detection..
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 120
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jpeterson275@attbi.com
Precedence: bulk
X-list: dovecot
X-UID: 120                                                  
Status: O

It would seem that dovecot cannot detect my maildir.  The system DO NOT 
use "~/Maildir".  It is arbitrary across a few systems, actualy, and am 
curious if there is a way to "force" in the config file where the 
maildir explicitly resides, much like Postfix's "home_mailbox" 
configuration parameter.

On a side note, I compiled dovecot 0.99.4 on a NetBSD 1.6-release i386 
machine, it when imap_listen is not set in the config file, it only 
binds to the tcp6 ::1 address.  Any clues?

-- 
Jesse Peterson
erage@softhome.net


From tss@iki.fi  Thu Dec 12 08:25:10 2002
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 12 Dec 2002 08:25:10 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 2572C2382C
	for <dovecot@procontrol.fi>; Thu, 12 Dec 2002 08:25:10 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 616785E01F68; Thu, 12 Dec 2002 08:25:09 +0200 (EET)
Subject: [dovecot] Re: Maildir detection..
From: Timo Sirainen <tss@iki.fi>
To: Jesse Peterson <jpeterson275@attbi.com>
Cc: Dovecot Mail List <dovecot@procontrol.fi>
In-Reply-To: <3DF7FF12.7040506@attbi.com>
References: <3DF7FF12.7040506@attbi.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1039674309.28950.20.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.0 
Date: 12 Dec 2002 08:25:09 +0200
X-archive-position: 121
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 121                                                  
Status: O

On Thu, 2002-12-12 at 05:14, Jesse Peterson wrote:
> It would seem that dovecot cannot detect my maildir.  The system DO NOT 
> use "~/Maildir".  It is arbitrary across a few systems, actualy, and am 
> curious if there is a way to "force" in the config file where the 
> maildir explicitly resides, much like Postfix's "home_mailbox" 
> configuration parameter.

OK, I added "default_mail_env" setting to config file. You can get it
from CVS, or maybe I should release 0.99.5. There's still a few nasty
problems with .4 anyway..

> On a side note, I compiled dovecot 0.99.4 on a NetBSD 1.6-release i386 
> machine, it when imap_listen is not set in the config file, it only 
> binds to the tcp6 ::1 address.  Any clues?

Hmm. Looks like NetBSD doesn't listen in IPv4 addresses when I bind to
"in6addr_any". Wonder how others have solved this.. Configuring Dovecot
with --disable-ipv6 fixes this anyway.


From jpeterson275@attbi.com  Mon Dec 16 09:52:38 2002
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 16 Dec 2002 09:52:38 +0200 (EET)
Return-Path: <jpeterson275@attbi.com>
Delivered-To: dovecot@procontrol.fi
Received: from sccrmhc02.attbi.com (sccrmhc02.attbi.com [204.127.202.62])
	by danu.procontrol.fi (Postfix) with ESMTP id 446E723840
	for <dovecot@procontrol.fi>; Mon, 16 Dec 2002 09:52:38 +0200 (EET)
Received: from attbi.com (12-228-39-116.client.attbi.com[12.228.39.116])
          by sccrmhc02.attbi.com (sccrmhc02) with SMTP
          id <2002121607523500200eell5e>; Mon, 16 Dec 2002 07:52:35 +0000
Message-ID: <3DFD8655.7000504@attbi.com>
Date: Sun, 15 Dec 2002 23:52:53 -0800
From: Jesse Peterson <jpeterson275@attbi.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Maildir problem..
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 122
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jpeterson275@attbi.com
Precedence: bulk
X-list: dovecot
X-UID: 122                                                  
Status: O

I have the most interesting problem...

I've compiled dovecot from CVS with a checkout on 2002-12-15 around 
23:00 PST.

When I select a message in my MUA I can view it and stuff, however, if I 
select another message, or folder, the message disappears.  It appears 
that dovecot shortens the Maildir message name to ":2,S" and then you 
can't access the message from the MUA again.  The same happens if you 
try and move a message from a foler to another folder..  Any ideas?


-- 
Jesse Peterson
erage@softhome.net


From tss@iki.fi  Mon Dec 16 10:07:36 2002
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 16 Dec 2002 10:07:36 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id AE98B2382C
	for <dovecot@procontrol.fi>; Mon, 16 Dec 2002 10:07:36 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 77DD15E01F68; Mon, 16 Dec 2002 10:07:36 +0200 (EET)
Subject: [dovecot] Re: Maildir problem..
From: Timo Sirainen <tss@iki.fi>
To: Jesse Peterson <jpeterson275@attbi.com>
Cc: Dovecot Mail List <dovecot@procontrol.fi>
In-Reply-To: <3DFD8655.7000504@attbi.com>
References: <3DFD8655.7000504@attbi.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1040026056.5724.237.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.0 
Date: 16 Dec 2002 10:07:36 +0200
X-archive-position: 123
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 123                                                  
Status: O

On Mon, 2002-12-16 at 09:52, Jesse Peterson wrote:
> I have the most interesting problem...
> 
> I've compiled dovecot from CVS with a checkout on 2002-12-15 around 
> 23:00 PST.
> 
> When I select a message in my MUA I can view it and stuff, however, if I 
> select another message, or folder, the message disappears.  It appears 
> that dovecot shortens the Maildir message name to ":2,S" and then you 
> can't access the message from the MUA again.  The same happens if you 
> try and move a message from a foler to another folder..  Any ideas?

Thanks for noticing. Buffer changes broke it some days ago, fixed now.


From jpeterson275@attbi.com  Mon Dec 16 10:24:45 2002
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 16 Dec 2002 10:24:45 +0200 (EET)
Return-Path: <jpeterson275@attbi.com>
Delivered-To: dovecot@procontrol.fi
Received: from rwcrmhc52.attbi.com (rwcrmhc52.attbi.com [216.148.227.88])
	by danu.procontrol.fi (Postfix) with ESMTP id C4DF52382C
	for <dovecot@procontrol.fi>; Mon, 16 Dec 2002 10:24:44 +0200 (EET)
Received: from attbi.com (12-228-39-116.client.attbi.com[12.228.39.116])
          by rwcrmhc52.attbi.com (rwcrmhc52) with SMTP
          id <2002121608244205200qodm0e>; Mon, 16 Dec 2002 08:24:43 +0000
Message-ID: <3DFD8DDD.5080302@attbi.com>
Date: Mon, 16 Dec 2002 00:25:01 -0800
From: Jesse Peterson <jpeterson275@attbi.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] SSL + default_mail_env
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 124
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jpeterson275@attbi.com
Precedence: bulk
X-list: dovecot
X-UID: 124                                                  
Status: O

in the config file i have "ssl_disable = yes", however, i get this in my 
   LOG_MAIL syslog: "Dec 17 00:21:07 host imap-master: Can't create 
temporary SSL parameters file 
/default/configured/directory/ssl-parameters.dat.tmp: No such file or 
directory"
I know what the error is, and how to fix it, but it's an SSL thing which 
should have been disable according the config file, correct?


It would seem that if you surround the value given to default_mail_env 
in quotes (as listed in the sample config file) you get errors like:
Dec 17 00:21:13 host imap(testuser): Failed to create storage with data: 
"maildir:/home/testuser/mail/"


-- 
Jesse Peterson
erage@softhome.net


From jpeterson275@attbi.com  Mon Dec 16 10:28:13 2002
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 16 Dec 2002 10:28:13 +0200 (EET)
Return-Path: <jpeterson275@attbi.com>
Delivered-To: dovecot@procontrol.fi
Received: from rwcrmhc53.attbi.com (rwcrmhc53.attbi.com [204.127.198.39])
	by danu.procontrol.fi (Postfix) with ESMTP id AACA22382C
	for <dovecot@procontrol.fi>; Mon, 16 Dec 2002 10:28:12 +0200 (EET)
Received: from attbi.com (12-228-39-116.client.attbi.com[12.228.39.116])
          by rwcrmhc53.attbi.com (rwcrmhc53) with SMTP
          id <2002121608281105300n5o3fe>; Mon, 16 Dec 2002 08:28:11 +0000
Message-ID: <3DFD8EAE.3020304@attbi.com>
Date: Mon, 16 Dec 2002 00:28:30 -0800
From: Jesse Peterson <jpeterson275@attbi.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Re: Maildir problem..
References: <3DFD8655.7000504@attbi.com>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 125
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jpeterson275@attbi.com
Precedence: bulk
X-list: dovecot
X-UID: 125                                                  
Status: O

In my maildir, I can rename the ":2,S" to something like 
"101010101.host:2,S" and i can see the file again, and can read it, 
however if I move it out of it's directory, it gets corrupted to ":2,S" 
again, this time in the directory i moved it to /cur.

Jesse Peterson wrote:
> I have the most interesting problem...
> 
> I've compiled dovecot from CVS with a checkout on 2002-12-15 around 
> 23:00 PST.
> 
> When I select a message in my MUA I can view it and stuff, however, if I 
> select another message, or folder, the message disappears.  It appears 
> that dovecot shortens the Maildir message name to ":2,S" and then you 
> can't access the message from the MUA again.  The same happens if you 
> try and move a message from a foler to another folder..  Any ideas?
> 
> 

-- 
Jesse Peterson
erage@softhome.net


From tss@iki.fi  Mon Dec 16 10:35:12 2002
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 16 Dec 2002 10:35:12 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 25C022382C
	for <dovecot@procontrol.fi>; Mon, 16 Dec 2002 10:35:12 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id E1FE85E01F68; Mon, 16 Dec 2002 10:35:11 +0200 (EET)
Subject: [dovecot] Re: SSL + default_mail_env
From: Timo Sirainen <tss@iki.fi>
To: Dovecot Mail List <dovecot@procontrol.fi>
In-Reply-To: <3DFD8DDD.5080302@attbi.com>
References: <3DFD8DDD.5080302@attbi.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1040027711.5724.253.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.0 
Date: 16 Dec 2002 10:35:11 +0200
X-archive-position: 126
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 126                                                  
Status: O

On Mon, 2002-12-16 at 10:25, Jesse Peterson wrote:
> in the config file i have "ssl_disable = yes", however, i get this in my 
>    LOG_MAIL syslog: "Dec 17 00:21:07 host imap-master: Can't create 
> temporary SSL parameters file 
> /default/configured/directory/ssl-parameters.dat.tmp: No such file or 
> directory"
> I know what the error is, and how to fix it, but it's an SSL thing which 
> should have been disable according the config file, correct?

Right. Fixed.

> It would seem that if you surround the value given to default_mail_env 
> in quotes (as listed in the sample config file) you get errors like:
> Dec 17 00:21:13 host imap(testuser): Failed to create storage with data: 
> "maildir:/home/testuser/mail/"

They're not supposed to be put into quotes :) I guess I should change
the comment somehow. Ideas?

# Some examples: maildir:/var/mail/$U/Maildir, mbox:~/mail/

or just

# Some examples (use without quotes): "maildir:/var/mail/$U/Maildir",
# "mbox:~/mail/"


From jpeterson275@attbi.com  Mon Dec 16 10:40:44 2002
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 16 Dec 2002 10:40:44 +0200 (EET)
Return-Path: <jpeterson275@attbi.com>
Delivered-To: dovecot@procontrol.fi
Received: from rwcrmhc52.attbi.com (rwcrmhc52.attbi.com [216.148.227.88])
	by danu.procontrol.fi (Postfix) with ESMTP id 576F82382C
	for <dovecot@procontrol.fi>; Mon, 16 Dec 2002 10:40:44 +0200 (EET)
Received: from attbi.com (12-228-39-116.client.attbi.com[12.228.39.116])
          by rwcrmhc52.attbi.com (rwcrmhc52) with SMTP
          id <2002121608404305200l4oi3e>; Mon, 16 Dec 2002 08:40:43 +0000
Message-ID: <3DFD919D.7080300@attbi.com>
Date: Mon, 16 Dec 2002 00:41:01 -0800
From: Jesse Peterson <jpeterson275@attbi.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Re: SSL + default_mail_env
References: <3DFD8DDD.5080302@attbi.com> <1040027711.5724.253.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 127
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jpeterson275@attbi.com
Precedence: bulk
X-list: dovecot
X-UID: 127                                                  
Status: O
Content-Length: 1145

I like the (without quotes) "(without quotes)" =).

Timo Sirainen wrote:
> On Mon, 2002-12-16 at 10:25, Jesse Peterson wrote:
> 
>>in the config file i have "ssl_disable = yes", however, i get this in my 
>>   LOG_MAIL syslog: "Dec 17 00:21:07 host imap-master: Can't create 
>>temporary SSL parameters file 
>>/default/configured/directory/ssl-parameters.dat.tmp: No such file or 
>>directory"
>>I know what the error is, and how to fix it, but it's an SSL thing which 
>>should have been disable according the config file, correct?
> 
> 
> Right. Fixed.
> 
> 
>>It would seem that if you surround the value given to default_mail_env 
>>in quotes (as listed in the sample config file) you get errors like:
>>Dec 17 00:21:13 host imap(testuser): Failed to create storage with data: 
>>"maildir:/home/testuser/mail/"
> 
> 
> They're not supposed to be put into quotes :) I guess I should change
> the comment somehow. Ideas?
> 
> # Some examples: maildir:/var/mail/$U/Maildir, mbox:~/mail/
> 
> or just
> 
> # Some examples (use without quotes): "maildir:/var/mail/$U/Maildir",
> # "mbox:~/mail/"
> 
> 
> 

-- 
Jesse Peterson
erage@softhome.net


From jpeterson275@attbi.com  Mon Dec 16 11:02:39 2002
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 16 Dec 2002 11:02:39 +0200 (EET)
Return-Path: <jpeterson275@attbi.com>
Delivered-To: dovecot@procontrol.fi
Received: from sccrmhc01.attbi.com (sccrmhc01.attbi.com [204.127.202.61])
	by danu.procontrol.fi (Postfix) with ESMTP id 6ED1423840
	for <dovecot@procontrol.fi>; Mon, 16 Dec 2002 11:02:39 +0200 (EET)
Received: from attbi.com (12-228-39-116.client.attbi.com[12.228.39.116])
          by sccrmhc01.attbi.com (sccrmhc01) with SMTP
          id <2002121609023500100q0nnde>; Mon, 16 Dec 2002 09:02:35 +0000
Message-ID: <3DFD96BE.6050207@attbi.com>
Date: Mon, 16 Dec 2002 01:02:54 -0800
From: Jesse Peterson <jpeterson275@attbi.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Dovecot Pronunciation/Meaning
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 128
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jpeterson275@attbi.com
Precedence: bulk
X-list: dovecot
X-UID: 128                                                  
Status: O

Timo,

What is the "official" way to pronounce Dovecot?  Is there a meaning to 
the word?  A background on why you chose it?


-- 
Jesse Peterson
erage@softhome.net


From tss@iki.fi  Mon Dec 16 11:23:09 2002
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 16 Dec 2002 11:23:09 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id AC78223840
	for <dovecot@procontrol.fi>; Mon, 16 Dec 2002 11:23:09 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 790325E01F68; Mon, 16 Dec 2002 11:23:09 +0200 (EET)
Subject: [dovecot] Re: Dovecot Pronunciation/Meaning
From: Timo Sirainen <tss@iki.fi>
To: Dovecot Mail List <dovecot@procontrol.fi>
In-Reply-To: <3DFD96BE.6050207@attbi.com>
References: <3DFD96BE.6050207@attbi.com>
Content-Type: text/plain; charset=ISO-8859-15
Content-Transfer-Encoding: quoted-printable
Organization: 
Message-Id: <1040030589.5727.260.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.0 
Date: 16 Dec 2002 11:23:09 +0200
X-archive-position: 129
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 129                                                  
Status: O

On Mon, 2002-12-16 at 11:02, Jesse Peterson wrote:
> What is the "official" way to pronounce Dovecot?  Is there a meaning to=20
> the word?  A background on why you chose it?

It's a real english word, pronounced as such.

  Dovecot \Dove"cot`\, Dovecote \Dove"cote`\, n.
     A small house or box, raised to a considerable height above
     the ground, and having compartments, in which domestic
     pigeons breed; a dove house.

It was suggested by Bostik (Mika Bostr=F6m) in IRC when I was still
calling it just "imapd" and asking for naming ideas.


From jpeterson275@attbi.com  Tue Dec 17 03:50:31 2002
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 17 Dec 2002 03:50:31 +0200 (EET)
Return-Path: <jpeterson275@attbi.com>
Delivered-To: dovecot@procontrol.fi
Received: from sccrmhc03.attbi.com (sccrmhc03.attbi.com [204.127.202.63])
	by danu.procontrol.fi (Postfix) with ESMTP id 57B9223840
	for <dovecot@procontrol.fi>; Tue, 17 Dec 2002 03:50:31 +0200 (EET)
Received: from attbi.com (12-228-39-116.client.attbi.com[12.228.39.116])
          by sccrmhc03.attbi.com (sccrmhc03) with SMTP
          id <20021217015030003006jh0ce>; Tue, 17 Dec 2002 01:50:30 +0000
Message-ID: <3DFE82FF.4090007@attbi.com>
Date: Mon, 16 Dec 2002 17:50:55 -0800
From: Jesse Peterson <jpeterson275@attbi.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] passwd-file access
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 130
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jpeterson275@attbi.com
Precedence: bulk
X-list: dovecot
X-UID: 130                                                  
Status: O

Using passwd-file authentication I run into some problems..
This is my passwd file:

user:0cc175b9c0f1b6a831c399e269772661[34]:6660:6660:0:/some/mail/directory/user:0:::

My MUA tells me after enter my user/pass that the server disconnected, 
OK.  So I netcat into the imap server, and issue an "C: LOGIN user a" in 
which case I get the error "Fatal: USER environment missing".  So I 
search for this in the src and find in 'src/imap/main.c' on line 30 it 
checks for the environment variable USER.. which I assume it can't find 
because it's not an actual system user, it's a ficticious user in a 
passwd-file.

Any ideas?

-- 
Jesse Peterson
erage@softhome.net


From tss@iki.fi  Tue Dec 17 05:02:01 2002
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 17 Dec 2002 05:02:01 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 4EF5B23840
	for <dovecot@procontrol.fi>; Tue, 17 Dec 2002 05:02:01 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 594EA5E01F68; Tue, 17 Dec 2002 05:02:00 +0200 (EET)
Subject: [dovecot] Re: passwd-file access
From: Timo Sirainen <tss@iki.fi>
To: Dovecot Mail List <dovecot@procontrol.fi>
In-Reply-To: <3DFE82FF.4090007@attbi.com>
References: <3DFE82FF.4090007@attbi.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1040094120.5727.320.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.0 
Date: 17 Dec 2002 05:02:00 +0200
X-archive-position: 131
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 131                                                  
Status: O

On Tue, 2002-12-17 at 03:50, Jesse Peterson wrote:
> Using passwd-file authentication I run into some problems..
> This is my passwd file:
> 
> user:0cc175b9c0f1b6a831c399e269772661[34]:6660:6660:0:/some/mail/directory/user:0:::
> 
> My MUA tells me after enter my user/pass that the server disconnected, 
> OK.  So I netcat into the imap server, and issue an "C: LOGIN user a" in 
> which case I get the error "Fatal: USER environment missing".  So I 
> search for this in the src and find in 'src/imap/main.c' on line 30 it 
> checks for the environment variable USER.. which I assume it can't find 
> because it's not an actual system user, it's a ficticious user in a 
> passwd-file.

So it seems, fixed.


From jaldhar@debian.org  Wed Dec 18 17:47:44 2002
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 18 Dec 2002 17:47:44 +0200 (EET)
Return-Path: <jaldhar@debian.org>
Delivered-To: dovecot@procontrol.fi
Received: from mail.braincells.com (samadhi.braincells.com [216.162.42.100])
	by danu.procontrol.fi (Postfix) with ESMTP id D7EAA23840
	for <dovecot@procontrol.fi>; Wed, 18 Dec 2002 17:47:43 +0200 (EET)
Received: from jyoti.intranet.braincells.com (bgp384497bgs.jersyc01.nj.comcast.net [68.36.31.111])
	by mail.braincells.com (Postfix) with ESMTP id 362B28010
	for <dovecot@procontrol.fi>; Wed, 18 Dec 2002 10:47:41 -0500 (EST)
Date: Wed, 18 Dec 2002 10:47:53 -0500 (EST)
From: "Jaldhar H. Vyas" <jaldhar@debian.org>
X-X-Sender: jaldhar@jyoti.intranet.braincells.com
Reply-To: "Jaldhar H. Vyas" <jaldhar@debian.org>
To: dovecot@procontrol.fi
Subject: [dovecot] 0.99.4 uploaded to Debian
Message-ID: <Pine.LNX.4.51.0212181031240.13442@jyoti.intranet.braincells.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 132
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jaldhar@debian.org
Precedence: bulk
X-list: dovecot
X-UID: 132                                                  
Status: O

Hi,

I'm the Debian maintainer of UW-Imap.  Like many I'm somewhat frustrated
with the limitations of it so I am very pleased to see that Dovecot is
becoming a strong alternative.  I have uploaded packages of 0.99.4 to the
Debian unstable distribution (sid).  Because this is a new package it has
to be added by hand so it may be a while before it shows up in sid.  In
the mean time, I have made the packages (also for stable or woody)
available from http://www.braincells.com/open/  Debian users, please take
a look and give me some feedback.

Unfortunately much to my embarrasment I can't currently use dovecot on my
own account.  I get a meesage like this in /var/log/syslog:

  Dec 18 09:01:31 samadhi imap(jaldhar): Error indexing mbox file
  /home/jaldhar/mail/inbox: LF not found where expected

The mbox in question is about 17MB and opens fine in uw-imapd.  Any clues?

-- 
Jaldhar H. Vyas <jaldhar@debian.org>
It's a girl! See the pictures - http://www.braincells.com/shailaja/

From tss@iki.fi  Thu Dec 19 00:28:03 2002
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 19 Dec 2002 00:28:03 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 7D14D2382C
	for <dovecot@procontrol.fi>; Thu, 19 Dec 2002 00:28:03 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 3B8C35E01F68; Thu, 19 Dec 2002 00:28:03 +0200 (EET)
Subject: [dovecot] Re: 0.99.4 uploaded to Debian
From: Timo Sirainen <tss@iki.fi>
To: "Jaldhar H. Vyas" <jaldhar@debian.org>
Cc: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.51.0212181031240.13442@jyoti.intranet.braincells.com>
References:
	 <Pine.LNX.4.51.0212181031240.13442@jyoti.intranet.braincells.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1040250482.5724.432.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.0 
Date: 19 Dec 2002 00:28:03 +0200
X-archive-position: 133
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 133                                                  
Status: O
Content-Length: 1039

On Wed, 2002-12-18 at 17:47, Jaldhar H. Vyas wrote:
> I'm the Debian maintainer of UW-Imap.  Like many I'm somewhat frustrated
> with the limitations of it so I am very pleased to see that Dovecot is
> becoming a strong alternative.  I have uploaded packages of 0.99.4 to the
> Debian unstable distribution (sid). 

Great, I've been waiting for that a few months now :) 0.99.5 should
probably come soon too, if I only figured why Dovecot's indexes
sometimes break when deleting mails with mutt.

>   Dec 18 09:01:31 samadhi imap(jaldhar): Error indexing mbox file
>   /home/jaldhar/mail/inbox: LF not found where expected
> 
> The mbox in question is about 17MB and opens fine in uw-imapd.  Any clues?

Do you happen to have two From lines next to each others there? Like:

>From a@b ...
>From b@c ...

I think that's the only case Dovecot doesn't currently handle. I tried
to fix it for that a few times but the code just gets uglier and I
figured it's not worth the trouble since only time I've had it happen is
with some Dovecot bugs.


From skvidal@phy.duke.edu  Thu Dec 19 17:29:26 2002
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 19 Dec 2002 17:29:26 +0200 (EET)
Return-Path: <skvidal@phy.duke.edu>
Delivered-To: dovecot@procontrol.fi
Received: from mail.phy.duke.edu (mail.phy.duke.edu [152.3.182.2])
	by danu.procontrol.fi (Postfix) with ESMTP id D341523840
	for <dovecot@procontrol.fi>; Thu, 19 Dec 2002 17:29:25 +0200 (EET)
Received: from opus.phy.duke.edu (opus.phy.duke.edu [152.3.182.42])
	by mail.phy.duke.edu (Postfix) with ESMTP id 1EBD030444
	for <dovecot@procontrol.fi>; Thu, 19 Dec 2002 10:29:25 -0500 (EST)
Subject: [dovecot] dovecot replacing uw-imap
From: seth vidal <skvidal@phy.duke.edu>
To: dovecot@procontrol.fi
Content-Type: multipart/signed; micalg=pgp-sha1; protocol="application/pgp-signature";
	boundary="=-F3zn4PSpbkDxMChtw2Hc"
X-Mailer: Ximian Evolution 1.0.3 (1.0.3-6) 
Date: 19 Dec 2002 10:29:24 -0500
Message-Id: <1040311765.17838.12.camel@opus>
Mime-Version: 1.0
X-archive-position: 134
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: skvidal@phy.duke.edu
Precedence: bulk
X-list: dovecot
X-UID: 134                                                  
Status: O
Content-Length: 1158


--=-F3zn4PSpbkDxMChtw2Hc
Content-Type: text/plain
Content-Transfer-Encoding: quoted-printable

Hey,
 I'm trying to sort out how to make dovecot replace uw-imap cleanly. But
I have the following problems/questions:

1. Why is mbox support limited to user-owned directories?
2. Would it be possible to have dovecot target a different place than
~user/mail by default, specfically some place like
/var/path/to/maildirs/userdir/

I'd like to move all my mail storage out of user homedirs and to central
space on my mail server, increasing reliability and helping me manage
disk space usage for readily.=20

In order to use dovecot I need a migration path and that path looks like
it will need mbox outside of the users homedirs and pottentially outside
of solely user-owned directories.

-sv




--=-F3zn4PSpbkDxMChtw2Hc
Content-Type: application/pgp-signature; name=signature.asc
Content-Description: This is a digitally signed message part

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.0.7 (GNU/Linux)

iD8DBQA+AeXU1Aj3x2mIbMcRAkoZAJ93nMV5AQX6zEvP3q8/quJk35HE2QCgnudz
UMDJ6LSjY99I6ZjpeB+yd+8=
=KQ6/
-----END PGP SIGNATURE-----

--=-F3zn4PSpbkDxMChtw2Hc--


From dgc@uchicago.edu  Fri Dec 20 03:31:26 2002
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 20 Dec 2002 03:31:26 +0200 (EET)
Return-Path: <dgc@uchicago.edu>
Delivered-To: dovecot@procontrol.fi
Received: from dust.uchicago.edu (dust.uchicago.edu [128.135.0.35])
	by danu.procontrol.fi (Postfix) with ESMTP id 3D31623840
	for <dovecot@procontrol.fi>; Fri, 20 Dec 2002 03:31:26 +0200 (EET)
Received: (from dgc@localhost)
	by dust.uchicago.edu (8.11.6/8.11.6) id gBK1Sau26739;
	Thu, 19 Dec 2002 19:28:36 -0600 (CST)
X-Authentication-Warning: dust.uchicago.edu: dgc set sender to dgc@uchicago.edu using -f
Date: Thu, 19 Dec 2002 19:28:36 -0600
From: David Champion <dgc@uchicago.edu>
To: seth vidal <skvidal@phy.duke.edu>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: dovecot replacing uw-imap
Message-ID: <20021220012836.GV4526@dust.uchicago.edu>
References: <1040311765.17838.12.camel@opus>
Mime-Version: 1.0
Content-Type: multipart/signed; micalg=pgp-sha1;
	protocol="application/pgp-signature"; boundary="x4pBfXISqBoDm8sr"
Content-Disposition: inline
In-Reply-To: <1040311765.17838.12.camel@opus>
User-Agent: Mutt/1.5.2i
X-archive-position: 135
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: dgc@uchicago.edu
Precedence: bulk
X-list: dovecot
X-UID: 135                                                  
Status: O
Content-Length: 1868


--x4pBfXISqBoDm8sr
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable

* On 2002.12.19, in <1040311765.17838.12.camel@opus>,
*	"seth vidal" <skvidal@phy.duke.edu> wrote:
>
> 2. Would it be possible to have dovecot target a different place than
> ~user/mail by default, specfically some place like
> /var/path/to/maildirs/userdir/
> ...
> In order to use dovecot I need a migration path and that path looks like
> it will need mbox outside of the users homedirs and pottentially outside
> of solely user-owned directories.

We had a similar need with uw-imap -- we had 25,000 users in /var/mail,
and wanted to split them out across multiple subdirectories. The route
we chose for this is actually pretty flexible, and configurable from
outside of the imap server process. It should be usable in dovecot, too,
if anyone wants to investigate. It's just a link library, and using it
inside any arbitrary application can be as simple as 1 or 2 lines of C.

There's a readme at
    http://home.uchicago.edu/~dgc/sw/mailpath/README
and the package itself is at
    http://home.uchicago.edu/~dgc/sw/mailpath/mailpath-1.0.tar.gz
    http://home.uchicago.edu/~dgc/sw/mailpath/mailpath-1.0.tar.gz.sig

This isn't a product in any formal sense, and it's not supported by
anyone in particular; it's just what I wrote for internal use at our
site. But if it seems useful, I'd be glad to answer questions once you
read the README. :)

--=20
 -D.	dgc@uchicago.edu	NSIT	University of Chicago
 We're the colon in ://

--x4pBfXISqBoDm8sr
Content-Type: application/pgp-signature
Content-Disposition: inline

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.0.7 (SunOS)

iEYEARECAAYFAj4CckQACgkQv9e3s61/wOWRMACeJ44zrwjcpIhpDzQsAtd/ZbyU
1SUAniFNWuCCJswJAkjt1zxcK6xggLKV
=niXE
-----END PGP SIGNATURE-----

--x4pBfXISqBoDm8sr--

From cras@irccrew.org  Fri Dec 20 04:10:22 2002
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 20 Dec 2002 04:10:22 +0200 (EET)
Return-Path: <cras@irccrew.org>
Delivered-To: dovecot@procontrol.fi
Received: from shodan.irccrew.org (shodan.irccrew.org [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id 24A662382C
	for <dovecot@procontrol.fi>; Fri, 20 Dec 2002 04:10:22 +0200 (EET)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id 182254C0CD; Fri, 20 Dec 2002 04:10:17 +0200 (EET)
Date: Fri, 20 Dec 2002 04:10:17 +0200
From: Timo Sirainen <tss@iki.fi>
To: David Champion <dgc@uchicago.edu>
Cc: seth vidal <skvidal@phy.duke.edu>, dovecot@procontrol.fi
Subject: [dovecot] Re: dovecot replacing uw-imap
Message-ID: <20021220021017.GA26615@irccrew.org>
References: <1040311765.17838.12.camel@opus> <20021220012836.GV4526@dust.uchicago.edu>
Mime-Version: 1.0
Content-Disposition: inline
In-Reply-To: <20021220012836.GV4526@dust.uchicago.edu>
User-Agent: Mutt/1.4i
Content-Type: text/plain; charset=us-ascii
X-archive-position: 136
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 136                                                  
Status: O

On Thu, Dec 19, 2002 at 07:28:36PM -0600, David Champion wrote:
> We had a similar need with uw-imap -- we had 25,000 users in /var/mail,
> and wanted to split them out across multiple subdirectories. The route
> we chose for this is actually pretty flexible, and configurable from
> outside of the imap server process. It should be usable in dovecot, too,
> if anyone wants to investigate. It's just a link library, and using it
> inside any arbitrary application can be as simple as 1 or 2 lines of C.

'"Overkill" is my middle name.'

Yeah. :) CVS Dovecot has already default_mail_path which supports $U as
username. Using your idea of supporting $1U $2U etc. to limit it to first 1
or 2 chars could be good enough idea to implement by default. Other than
that, I don't see much use for the rest of the variables. Hmm. Except maybe
separating "user@domain" username so that you could use path like
/var/mail/domain/user/.


From cras@irccrew.org  Fri Dec 20 04:19:30 2002
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 20 Dec 2002 04:19:30 +0200 (EET)
Return-Path: <cras@irccrew.org>
Delivered-To: dovecot@procontrol.fi
Received: from shodan.irccrew.org (shodan.irccrew.org [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id DE3152382C
	for <dovecot@procontrol.fi>; Fri, 20 Dec 2002 04:19:30 +0200 (EET)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id AC5F04C0CD; Fri, 20 Dec 2002 04:19:30 +0200 (EET)
Date: Fri, 20 Dec 2002 04:19:30 +0200
From: Timo Sirainen <tss@iki.fi>
To: seth vidal <skvidal@phy.duke.edu>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: dovecot replacing uw-imap
Message-ID: <20021220021930.GB26615@irccrew.org>
References: <1040311765.17838.12.camel@opus>
Mime-Version: 1.0
Content-Disposition: inline
In-Reply-To: <1040311765.17838.12.camel@opus>
User-Agent: Mutt/1.4i
Content-Type: text/plain; charset=us-ascii
X-archive-position: 137
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 137                                                  
Status: O
Content-Length: 1403

On Thu, Dec 19, 2002 at 10:29:24AM -0500, seth vidal wrote:
>  I'm trying to sort out how to make dovecot replace uw-imap cleanly. But
> I have the following problems/questions:
> 
> 1. Why is mbox support limited to user-owned directories?

Dovecot currently only supports keeping all IMAP folders in under one
drectory. You'd want keep INBOX elsewhere than rest of the IMAP folders?
Symlinks would allow that currently. Maybe I should allow inbox elsewhere
too .. only problem is that I'm not sure how that should be configured.
Maybe the MAIL environment would have multiple parts with mbox, like:

mbox:/home/$U/mail:INBOX=/var/mail/$U:Trash=/tmp/$U

First being the default IMAP folder path, rest being named mailboxes or
folders elsewhere.

> 2. Would it be possible to have dovecot target a different place than
> ~user/mail by default, specfically some place like
> /var/path/to/maildirs/userdir/

default_mail_env = /var/path/to/maildirs/$U/

Works in CVS.

> In order to use dovecot I need a migration path and that path looks like
> it will need mbox outside of the users homedirs and pottentially outside
> of solely user-owned directories.

Hm. Or did I understand it right above, what do you mean with "outside
user-owned directories"? Single mailboxes in non-owned dir or folders just
outsde home dir? Latter shouldn't matter where they are, as long as Dovecot
has write access to them.


From dgc@uchicago.edu  Fri Dec 20 04:53:28 2002
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 20 Dec 2002 04:53:28 +0200 (EET)
Return-Path: <dgc@uchicago.edu>
Delivered-To: dovecot@procontrol.fi
Received: from dust.uchicago.edu (dust.uchicago.edu [128.135.0.35])
	by danu.procontrol.fi (Postfix) with ESMTP id E4C872382C
	for <dovecot@procontrol.fi>; Fri, 20 Dec 2002 04:53:27 +0200 (EET)
Received: (from dgc@localhost)
	by dust.uchicago.edu (8.11.6/8.11.6) id gBK2rKW27565;
	Thu, 19 Dec 2002 20:53:20 -0600 (CST)
X-Authentication-Warning: dust.uchicago.edu: dgc set sender to dgc@uchicago.edu using -f
Date: Thu, 19 Dec 2002 20:53:20 -0600
From: David Champion <dgc@uchicago.edu>
To: Timo Sirainen <tss@iki.fi>
Cc: seth vidal <skvidal@phy.duke.edu>, dovecot@procontrol.fi
Subject: [dovecot] Re: dovecot replacing uw-imap
Message-ID: <20021220025320.GA27540@dust.uchicago.edu>
Mail-Followup-To: Timo Sirainen <tss@iki.fi>,
	seth vidal <skvidal@phy.duke.edu>, dovecot@procontrol.fi
References: <1040311765.17838.12.camel@opus> <20021220012836.GV4526@dust.uchicago.edu> <20021220021017.GA26615@irccrew.org>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20021220021017.GA26615@irccrew.org>
User-Agent: Mutt/1.5.2i
X-archive-position: 138
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: dgc@uchicago.edu
Precedence: bulk
X-list: dovecot
X-UID: 138                                                  
Status: O
Content-Length: 1899

* On 2002.12.19, in <20021220021017.GA26615@irccrew.org>,
*	"Timo Sirainen" <tss@iki.fi> wrote:
> 
> Yeah. :) CVS Dovecot has already default_mail_path which supports $U as
> username. Using your idea of supporting $1U $2U etc. to limit it to first 1
> or 2 chars could be good enough idea to implement by default. Other than
> that, I don't see much use for the rest of the variables. Hmm. Except maybe

No, there's not a lot of use in most cases, but most of them were
possibilities we had pondered at one point or another. The real value
of the library, to me, is just the flexiblity it affords -- because
a site might have many products that need to interoperate, tying the
admins to a particular arrangement of folder paths can be frustrating.
Especially when making transitions from one product to another.

Using home directories embedded in the path to folders is something we
might yet switch to -- with so many users on a single system, it's all
about balancing users across multiple filesystems. Because our users
exist on the mail server and, separately, on a login server, the home
directory path is a useful way of tracking that for multiple systems.

The modulus operator was useful at one point, too... but I'm not sure
how much use it is for me to go defending each thing mailpath can do,
when the real point is that it can satisfy lots of needs without binding
particular software to particular disk configurations.

Everything gets weird when you support many thousands of users in one
place....

Anyway, just an offering -- if anyone does need this, it's out there.
We've gotten to where we don't particularly expect our applications to
fit our environment without some patching. :)


> separating "user@domain" username so that you could use path like
> /var/mail/domain/user/.

That would be handy.

-- 
 -D.	dgc@uchicago.edu	NSIT	University of Chicago
 We're the colon in ://

From tss@iki.fi  Sun Dec 22 20:28:34 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 22 Dec 2002 20:28:34 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id C965823840
	for <dovecot@procontrol.fi>; Sun, 22 Dec 2002 20:28:34 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 9BC925E01F68; Sun, 22 Dec 2002 20:28:30 +0200 (EET)
Subject: [dovecot] 0.99.5rc1
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1040581710.29604.35.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.0 
Date: 22 Dec 2002 20:28:30 +0200
X-archive-position: 139
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 139                                                  
Status: O

Current CVS contains a lot of code cleanups which aren't too well
tested. Seems to be working with me, but I'm still a bit worried I left
some very nasty bug lying around somewhere. There's anyway been many
nasty fixes since 0.99.4, most importantly with mbox handling and SEARCH
command.

I've also added support for SORT extension. It's not very fast
currently, but it should work. I tested with squirrelmail and it looked
fine. So, those people wanting to use Dovecot with webmail might try it
now. :) THREAD extension is still missing though.

So, here's a 0.99.5 release candidate 1. I wouldn't recommend it for
production usage yet, but I'd hope some people to test it before I'll
put out a real release. Just so that I won't be (again) releasing n+3
versions in a few days :) You can get the sources from
http://dovecot.procontrol.fi/rc/

I'm going away for christmas tomorrow, once I get back I'll do some more
testing and auditing and get the final release out. Next weekend
probably.


From jpeterson275@attbi.com  Sun Dec 22 21:55:56 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 22 Dec 2002 21:55:56 +0200 (EET)
Return-Path: <jpeterson275@attbi.com>
Delivered-To: dovecot@procontrol.fi
Received: from sccrmhc01.attbi.com (sccrmhc01.attbi.com [204.127.202.61])
	by danu.procontrol.fi (Postfix) with ESMTP id D104B2382C
	for <dovecot@procontrol.fi>; Sun, 22 Dec 2002 21:55:55 +0200 (EET)
Received: from attbi.com (12-228-39-116.client.attbi.com[12.228.39.116])
          by sccrmhc01.attbi.com (sccrmhc01) with SMTP
          id <20021222195553001003mesie>; Sun, 22 Dec 2002 19:55:53 +0000
Message-ID: <3E0618ED.9060108@attbi.com>
Date: Sun, 22 Dec 2002 11:56:29 -0800
From: Jesse Peterson <jpeterson275@attbi.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] [Fwd: ./configure options..]
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 140
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jpeterson275@attbi.com
Precedence: bulk
X-list: dovecot
X-UID: 140                                                  
Status: O
Content-Length: 1343

Oops, wrong address..

-------- Original Message --------
Message-ID: <3E0618CB.1060106@is.a.fakepope.com>
Date: Sun, 22 Dec 2002 11:55:55 -0800
From: Jesse Peterson <erage@is.a.fakepope.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: ./configure options..
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit

[CVS from ~ 10:30am PST]

It would seem that --without-passwd produces

gcc -g -O2 -Wall -W -Wmissing-prototypes -Wmissing-declarations
-Wpointer-arith -Wchar-subscripts -Wformat=2 -Wbad-function-cast -o
imap-auth auth.o auth-plain.o auth-digest-md5.o cookie.o
login-connection.o main.o master.o mycrypt.o userinfo.o
userinfo-passwd.o userinfo-shadow.o userinfo-pam.o
userinfo-passwd-file.o userinfo-vpopmail.o  ../lib/liblib.a -lcrypt
userinfo-passwd-file.o: In function `get_reply_data':
dovecot/cvs/dovecot/src/auth/userinfo-passwd-file.c:72: undefined
reference to `passwd_fill_cookie_reply'

grep of the source tree says:

src/auth/userinfo-passwd.c:16:void passwd_fill_cookie_reply(struct
passwd *pw, AuthCookieReplyData *reply)

Also pam, shadow, and passwd-file all seem to call this function in them.

Ideas?


-- 
Jesse Peterson
erage@softhome.net


From tss@iki.fi  Sun Dec 22 22:34:36 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 22 Dec 2002 22:34:36 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 0C32723840
	for <dovecot@procontrol.fi>; Sun, 22 Dec 2002 22:34:36 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 664605E01F68; Sun, 22 Dec 2002 22:34:35 +0200 (EET)
Subject: [dovecot] Re: [Fwd: ./configure options..]
From: Timo Sirainen <tss@iki.fi>
To: Jesse Peterson <jpeterson275@attbi.com>
Cc: Dovecot Mail List <dovecot@procontrol.fi>
In-Reply-To: <3E0618ED.9060108@attbi.com>
References: <3E0618ED.9060108@attbi.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1040589275.29609.53.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.0 
Date: 22 Dec 2002 22:34:35 +0200
X-archive-position: 141
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 141                                                  
Status: O

On Sun, 2002-12-22 at 21:56, Jesse Peterson wrote:
> It would seem that --without-passwd produces
..
> dovecot/cvs/dovecot/src/auth/userinfo-passwd-file.c:72: undefined
> reference to `passwd_fill_cookie_reply'

Never occured to me before someone might actually want to disable passwd
support :)

> Ideas?

Fixed, that function is now always compiled in.


From hon@1b6.net  Thu Dec 26 16:17:01 2002
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 26 Dec 2002 16:17:01 +0200 (EET)
Return-Path: <hon@1b6.net>
Delivered-To: dovecot@procontrol.fi
Received: from bagic.net (nshosting.net [202.181.240.106])
	by danu.procontrol.fi (Postfix) with SMTP id 91F5323840
	for <dovecot@procontrol.fi>; Thu, 26 Dec 2002 16:17:00 +0200 (EET)
Received: (qmail 20561 invoked from network); 26 Dec 2002 14:16:59 -0000
Received: from unknown (HELO 1b6.net) (218.252.199.60)
  by 0 with SMTP; 26 Dec 2002 14:16:59 -0000
Message-ID: <3E0B0F5A.6020000@1b6.net>
Date: Thu, 26 Dec 2002 22:16:58 +0800
From: Hon <hon@1b6.net>
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.0; en-US; rv:1.3b) Gecko/20021225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: dovecot@procontrol.fi
Subject: [dovecot] Dovecot splited fetch problem
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 142
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: hon@1b6.net
Precedence: bulk
X-list: dovecot
X-UID: 142                                                  
Status: O
Content-Length: 1078

Hello,

When I was trying out the IMAP server (using Mozilla as client), I have 
no success of receving mail with attachments.  Looking it down further 
I've found that Mozilla fetches the message in 10k blocks, and the 
server seems missed a couple of bytes at where the split occurs...

Mozilla start the fetch by saying:
* 413 FETCH (UID 827 RFC822.SIZE 106371 BODY[]<0> {10240}
-- snip to place of split --
zmmAWdUxYA6Aobczv4BguxSZGqdYs6ELNIpgjiPUdYLxsHy)
7 OK Fetch completed.
8 UID fetch 827 (UID RFC822.SIZE BODY[]<10240.10240>)
* 413 FETCH (UID 827 RFC822.SIZE 106371 BODY[]<10240> {10240}
6BilWYuUJGA4YeNYFJbI1gL

The resulting line (saved from Mozilla view source) is:
zmmAWdUxYA6Aobczv4BguxSZGqdYs6ELNIpgjiPUdYLxsHy6BilWYuUJGA4YeNYFJbI1gL
                                                ^^ Two bytes missing
Where the original is:
zmmAWdUxYA6Aobczv4BguxSZGqdYs6ELNIpgjiPUdYLxsHygZ6BilWYuUJGA4YeNYFJbI1gL
                                                ^^

I have tried this using Debian packaged (0.99.4-1) and self compiled 
0.99.5rc1.  Both exhibit this problem.



From tss@iki.fi  Fri Dec 27 15:09:46 2002
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 27 Dec 2002 15:09:46 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 7D56A2382C
	for <dovecot@procontrol.fi>; Fri, 27 Dec 2002 15:09:46 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 15F315E01F68; Fri, 27 Dec 2002 15:09:43 +0200 (EET)
Subject: [dovecot] Re: Dovecot splited fetch problem
From: Timo Sirainen <tss@iki.fi>
To: Hon <hon@1b6.net>
Cc: dovecot@procontrol.fi
In-Reply-To: <3E0B0F5A.6020000@1b6.net>
References: <3E0B0F5A.6020000@1b6.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1040994582.29611.121.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.0 
Date: 27 Dec 2002 15:09:42 +0200
X-archive-position: 143
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 143                                                  
Status: O

On Thu, 2002-12-26 at 16:16, Hon wrote:
> When I was trying out the IMAP server (using Mozilla as client), I have 
> no success of receving mail with attachments.  Looking it down further 
> I've found that Mozilla fetches the message in 10k blocks, and the 
> server seems missed a couple of bytes at where the split occurs...

Thanks, should be fixed in CVS now. I'll probably release 0.9.5rc2 soon
after a few more fixes.

Handling partial fetches is pretty annoying since IMAP protocol wants to
output only \r\n linefeeds, but in message data the \r is optional. So I
have to pass all around information to find out if \n is just \n or
\r\n..


From js@debian.org  Fri Dec 27 19:44:54 2002
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 27 Dec 2002 19:44:54 +0200 (EET)
Return-Path: <js@debian.org>
Delivered-To: dovecot@procontrol.fi
Received: from auryn.jones.dk (unknown [62.79.77.233])
	by danu.procontrol.fi (Postfix) with ESMTP id 176222382C
	for <dovecot@procontrol.fi>; Fri, 27 Dec 2002 19:44:54 +0200 (EET)
Received: from localhost (auryn.jones.dk [127.0.0.1])
	by auryn.jones.dk (Postfix) with ESMTP id BAB6E270A4
	for <dovecot@procontrol.fi>; Fri, 27 Dec 2002 18:44:55 +0100 (CET)
Date: Fri, 27 Dec 2002 18:44:55 +0100 (CET)
From: Jonas Smedegaard <js@debian.org>
X-X-Sender: jonas@auryn.jones.dk
Reply-To: Jonas Smedegaard <dr@jones.dk>
To: dovecot@procontrol.fi
Subject: [dovecot] o.99rc2 works on PowerPC - sort of...
Message-ID: <Pine.LNX.4.51.0212271841200.22640@auryn.jones.dk>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 144
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: js@debian.org
Precedence: bulk
X-list: dovecot
X-UID: 144                                                  
Status: O

Hi all,

The new release starts on PowerPC now.

On to the next problem... :-)

When accessing my folders through Pine (setup to always go through IMAP,
even local mboxes) I get "kicked out" it seems, pretty often. Here's what
shows in the logfile:

imap(jonas): file imap-bodystructure.c: line 342 (part_write_body): assertion failed: (part->children->next == NULL)

 - Jonas

-- 
Debian GNU/Linux developer     http://www.debian.org/
Jonas Smedegaard +45 40843136  http://dr.jones.dk/
Consulting for machines and humans:   Spiff ApS

From dom@moo.cus.org.uk  Fri Dec 27 20:28:23 2002
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 27 Dec 2002 20:28:23 +0200 (EET)
Return-Path: <dom@moo.cus.org.uk>
Delivered-To: dovecot@procontrol.fi
Received: from moo.cus.org.uk (host213-106-240-81.no-dns-yet.ntli.net [213.106.240.81])
	by danu.procontrol.fi (Postfix) with ESMTP id E118A23840
	for <dovecot@procontrol.fi>; Fri, 27 Dec 2002 20:28:22 +0200 (EET)
Received: from moo.cus.org.uk (localhost.cus.org.uk [127.0.0.1])
	by moo.cus.org.uk (8.12.5/8.11.3) with ESMTP id gBRIVMOS030899
	for <dovecot@procontrol.fi>; Fri, 27 Dec 2002 18:31:22 GMT
	(envelope-from dom@moo.cus.org.uk)
Received: (from dom@localhost)
	by moo.cus.org.uk (8.12.5/8.12.5/Submit) id gBRIVLTB030898
	for dovecot@procontrol.fi; Fri, 27 Dec 2002 18:31:21 GMT
Date: Fri, 27 Dec 2002 18:31:21 +0000
From: Dominic Marks <dom@cus.org.uk>
To: dovecot@procontrol.fi
Subject: [dovecot] RLIMIT_AS patch for FreeBSD
Message-ID: <20021227183121.B30698@cus.org.uk>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
X-archive-position: 145
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: dom@cus.org.uk
Precedence: bulk
X-list: dovecot
X-UID: 145                                                  
Status: O

Hey,

I've just updated the FreeBSD dovecot port to the 0.99.4 beta release,
the following patch was needed as FreeBSD has setrlimit(2) but does not
define RLIMIT_AS (I believe). I switched the code the require both,
alternatively find a parallel option in the FreeBSD setrlimit(2) manual
page. ( http://www.freebsd.org/cgi/man.cgi?setrlimit )

You may be interested in integrating this patch.

--- src/lib/restrict-process-size.c	Fri Dec 27 18:19:41 2002
+++ src/lib/restrict-process-size.c-new	Fri Dec 27 18:19:22 2002
@@ -32,7 +32,8 @@
 
 void restrict_process_size(unsigned int size __attr_unused__)
 {
-#ifdef HAVE_SETRLIMIT
+#if defined(HAVE_SETRLIMIT) && defined(RLIMIT_AS)
+/* FreeBSD has setrlimit(2) but does not define RLIMIT_AS */
 	struct rlimit rlim;
 
 	rlim.rlim_max = rlim.rlim_cur =

Thanks,
-- 
Dominic
 <dom at cus.org.uk> <d.marks at student.umist.ac.uk>

From tss@iki.fi  Fri Dec 27 20:38:39 2002
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 27 Dec 2002 20:38:39 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 3E2A723840
	for <dovecot@procontrol.fi>; Fri, 27 Dec 2002 20:38:39 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 061FE5E01F68; Fri, 27 Dec 2002 20:38:39 +0200 (EET)
Subject: [dovecot] Re: RLIMIT_AS patch for FreeBSD
From: Timo Sirainen <tss@iki.fi>
To: Dominic Marks <dom@cus.org.uk>
Cc: dovecot@procontrol.fi
In-Reply-To: <20021227183121.B30698@cus.org.uk>
References: <20021227183121.B30698@cus.org.uk>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1041014318.29611.145.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.0 
Date: 27 Dec 2002 20:38:38 +0200
X-archive-position: 146
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 146                                                  
Status: O

On Fri, 2002-12-27 at 20:31, Dominic Marks wrote:
> I've just updated the FreeBSD dovecot port to the 0.99.4 beta release,
> the following patch was needed as FreeBSD has setrlimit(2) but does not
> define RLIMIT_AS (I believe).

I fixed this some time ago by using RLIMIT_DATA which should be defined
everywhere. RLIMIT_AS is also used with systems that have it. It's
mostly useful with Linux/glibc2.3 where RLIMIT_DATA doesn't have much
effect since malloc() uses mmap() for larger allocations.

0.99.5 should be out soon I think :)


From cras@irccrew.org  Fri Dec 27 21:03:32 2002
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 27 Dec 2002 21:03:32 +0200 (EET)
Return-Path: <cras@irccrew.org>
Delivered-To: dovecot@procontrol.fi
Received: from shodan.irccrew.org (shodan.irccrew.org [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id 1AE0B2382C
	for <dovecot@procontrol.fi>; Fri, 27 Dec 2002 21:03:32 +0200 (EET)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id 74EFE4C0CF; Fri, 27 Dec 2002 21:03:31 +0200 (EET)
Date: Fri, 27 Dec 2002 21:03:31 +0200
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: o.99rc2 works on PowerPC - sort of...
Message-ID: <20021227190331.GA13985@irccrew.org>
References: <Pine.LNX.4.51.0212271841200.22640@auryn.jones.dk>
Mime-Version: 1.0
Content-Disposition: inline
In-Reply-To: <Pine.LNX.4.51.0212271841200.22640@auryn.jones.dk>
User-Agent: Mutt/1.4i
Content-Type: text/plain; charset=us-ascii
X-archive-position: 147
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 147                                                  
Status: O
Content-Length: 1049

(whops, Evolution's reply window really needs something to remind me that
I'm (accidentally) doing a private reply instead of mailing list reply..)

On Fri, 2002-12-27 at 19:44, Jonas Smedegaard wrote:
> When accessing my folders through Pine (setup to always go through IMAP,
> even local mboxes) I get "kicked out" it seems, pretty often. Here's what
> shows in the logfile:
> 
> imap(jonas): file imap-bodystructure.c: line 342 (part_write_body): assertion failed: (part->children->next == NULL)

Hmm. Usually that should happen only if index files are corrupted. But I
don't think you've had any time to corrupt them yet :) You could try
anyway rm -rf ~/mail/.imap/

I'll anyway look more closely how that could happen and maybe fix it
with index rebuilding rather than dying, but could you get the backtrace
of that? It probably doesn't core dump, but you could try it manually:

gdb /usr/lib/dovecot/imap
r

x select inbox
x fetch 1:* body

bt

Probably crashes with that.

Might also be some weird email message that Dovecot doesn't like.. 


From jpeterson275@attbi.com  Sat Dec 28 09:57:18 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 28 Dec 2002 09:57:18 +0200 (EET)
Return-Path: <jpeterson275@attbi.com>
Delivered-To: dovecot@procontrol.fi
Received: from sccrmhc03.attbi.com (sccrmhc03.attbi.com [204.127.202.63])
	by danu.procontrol.fi (Postfix) with ESMTP id C54E22382C
	for <dovecot@procontrol.fi>; Sat, 28 Dec 2002 09:57:17 +0200 (EET)
Received: from attbi.com (12-228-125-138.client.attbi.com[12.228.125.138])
          by sccrmhc03.attbi.com (sccrmhc03) with SMTP
          id <2002122807571000300logf2e>; Sat, 28 Dec 2002 07:57:11 +0000
Message-ID: <3E0D5959.7080300@attbi.com>
Date: Fri, 27 Dec 2002 23:57:13 -0800
From: Jesse Peterson <jpeterson275@attbi.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] passwd-file; configure args..
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 148
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jpeterson275@attbi.com
Precedence: bulk
X-list: dovecot
X-UID: 148                                                  
Status: O
Content-Length: 1134

I couldn't reproduce this again (because i can't get imap-master running 
due to problem below..) but.. When compiling without shadow, passwd, or 
pam, when logging in I get after a successful login (in my syslog):
Dec 28 22:39:38 badcase imap(username): MAIL environment missing and 
autodetection failed (home /some/home/directory)
Now I thought this was covered in a previous fix before (ChangeLog: 
"2002-12-17 03:00  Timo Sirainen <tss@iki.fi>")  but for some reason 
it's broken again..?


The configure args problem has to do with --localstatedir.  If i leave 
it default (PREFIX/var) it forces me (even with non-relative pathnames 
in the config file) for the socket-files (ssl_parameters_file, 
login_dir) that should go in /var/run to be put under PREFIX, 
(/usr/local for NetBSD 1.6).  Not too bad, if I could override it in the 
config file, which I can't.  So I ./configure'd with --localstatedir=/, 
and when I run imap-master I now get:
Fatal: Can't create directory //run/dovecot: No such file or directory
Somewhat odd.

Any clues on either of these would be helpful, thanks.


-- 
Jesse Peterson
erage@softhome.net


From tss@iki.fi  Sat Dec 28 10:32:33 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 28 Dec 2002 10:32:33 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 9481123840
	for <dovecot@procontrol.fi>; Sat, 28 Dec 2002 10:32:33 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 42D915E01F68; Sat, 28 Dec 2002 10:32:33 +0200 (EET)
Subject: [dovecot] Re: passwd-file; configure args..
From: Timo Sirainen <tss@iki.fi>
To: Jesse Peterson <jpeterson275@attbi.com>
Cc: Dovecot Mail List <dovecot@procontrol.fi>
In-Reply-To: <3E0D5959.7080300@attbi.com>
References: <3E0D5959.7080300@attbi.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1041064352.29611.164.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.0 
Date: 28 Dec 2002 10:32:33 +0200
X-archive-position: 149
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 149                                                  
Status: O
Content-Length: 1566

On Sat, 2002-12-28 at 09:57, Jesse Peterson wrote:
> I couldn't reproduce this again (because i can't get imap-master running 
> due to problem below..) but.. When compiling without shadow, passwd, or 
> pam, when logging in I get after a successful login (in my syslog):
> Dec 28 22:39:38 badcase imap(username): MAIL environment missing and 
> autodetection failed (home /some/home/directory)
> Now I thought this was covered in a previous fix before (ChangeLog: 
> "2002-12-17 03:00  Timo Sirainen <tss@iki.fi>")  but for some reason 
> it's broken again..?

This is different problem. The mailbox location detection isn't working
for some reason with you. Did it used to work, or is this just a
different user? ~/mail (mbox) or ~/Maildir has to exist to make Dovecot
know what to use.

> The configure args problem has to do with --localstatedir.  If i leave 
> it default (PREFIX/var) it forces me (even with non-relative pathnames 
> in the config file) for the socket-files (ssl_parameters_file, 
> login_dir) that should go in /var/run to be put under PREFIX, 
> (/usr/local for NetBSD 1.6).  Not too bad, if I could override it in the 
> config file, which I can't.  So I ./configure'd with --localstatedir=/, 
> and when I run imap-master I now get:
> Fatal: Can't create directory //run/dovecot: No such file or directory
> Somewhat odd.

Well, since the default is PREFIX/var, you'd just drop out the PREFIX.
ie. --localstatedir=/var. But I'm also a bit annoyed at this change,
have to do something about it so that it can be overridden in config
file.


From jpeterson275@attbi.com  Sat Dec 28 11:07:59 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 28 Dec 2002 11:07:59 +0200 (EET)
Return-Path: <jpeterson275@attbi.com>
Delivered-To: dovecot@procontrol.fi
Received: from sccrmhc02.attbi.com (sccrmhc02.attbi.com [204.127.202.62])
	by danu.procontrol.fi (Postfix) with ESMTP id 961932382C
	for <dovecot@procontrol.fi>; Sat, 28 Dec 2002 11:07:58 +0200 (EET)
Received: from attbi.com (12-228-125-138.client.attbi.com[12.228.125.138])
          by sccrmhc02.attbi.com (sccrmhc02) with SMTP
          id <20021228090756002000d0nle>; Sat, 28 Dec 2002 09:07:57 +0000
Message-ID: <3E0D69EF.7020306@attbi.com>
Date: Sat, 28 Dec 2002 01:07:59 -0800
From: Jesse Peterson <jpeterson275@attbi.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Re: passwd-file; configure args..
References: <3E0D5959.7080300@attbi.com> <1041064352.29611.164.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 150
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jpeterson275@attbi.com
Precedence: bulk
X-list: dovecot
X-UID: 150                                                  
Status: O
Content-Length: 2369

Timo Sirainen wrote:
> On Sat, 2002-12-28 at 09:57, Jesse Peterson wrote:
> 
>>I couldn't reproduce this again (because i can't get imap-master running 
>>due to problem below..) but.. When compiling without shadow, passwd, or 
>>pam, when logging in I get after a successful login (in my syslog):
>>Dec 28 22:39:38 badcase imap(username): MAIL environment missing and 
>>autodetection failed (home /some/home/directory)
>>Now I thought this was covered in a previous fix before (ChangeLog: 
>>"2002-12-17 03:00  Timo Sirainen <tss@iki.fi>")  but for some reason 
>>it's broken again..?
> 
> 
> This is different problem. The mailbox location detection isn't working
> for some reason with you. Did it used to work, or is this just a
> different user? ~/mail (mbox) or ~/Maildir has to exist to make Dovecot
> know what to use.
> 
> 
>>The configure args problem has to do with --localstatedir.  If i leave 
>>it default (PREFIX/var) it forces me (even with non-relative pathnames 
>>in the config file) for the socket-files (ssl_parameters_file, 
>>login_dir) that should go in /var/run to be put under PREFIX, 
>>(/usr/local for NetBSD 1.6).  Not too bad, if I could override it in the 
>>config file, which I can't.  So I ./configure'd with --localstatedir=/, 
>>and when I run imap-master I now get:
>>Fatal: Can't create directory //run/dovecot: No such file or directory
>>Somewhat odd.
> 
> 
> Well, since the default is PREFIX/var, you'd just drop out the PREFIX.
> ie. --localstatedir=/var. But I'm also a bit annoyed at this change,
> have to do something about it so that it can be overridden in config
> file.

I've tried that, and it starts, with a message about fixing permissions 
of /var/run/dovecot, and then all I get is:
Dec 29 01:05:48 badcase imap-master: child 9660 (auth) killed with signal 6
Dec 29 01:05:49 badcase imap-master: child 9662 (auth) killed with signal 6
Dec 29 01:05:51 badcase imap-master: child 9663 (auth) killed with signal 6
Dec 29 01:05:52 badcase imap-master: child 9664 (auth) killed with signal 6
Dec 29 01:05:53 badcase imap-master: child 9665 (auth) killed with signal 6
Dec 29 01:05:54 badcase imap-master: child 9666 (auth) killed with signal 6

If try to connect to the server, I get alternating (auth) and (login) 
"killed with signal 6" every second or so... weird.



> 
> 

-- 
Jesse Peterson
erage@softhome.net


From jpeterson275@attbi.com  Sat Dec 28 11:15:19 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 28 Dec 2002 11:15:19 +0200 (EET)
Return-Path: <jpeterson275@attbi.com>
Delivered-To: dovecot@procontrol.fi
Received: from sccrmhc03.attbi.com (sccrmhc03.attbi.com [204.127.202.63])
	by danu.procontrol.fi (Postfix) with ESMTP id B9BD92382C
	for <dovecot@procontrol.fi>; Sat, 28 Dec 2002 11:15:18 +0200 (EET)
Received: from attbi.com (12-228-125-138.client.attbi.com[12.228.125.138])
          by sccrmhc03.attbi.com (sccrmhc03) with SMTP
          id <2002122809151700300logn9e>; Sat, 28 Dec 2002 09:15:17 +0000
Message-ID: <3E0D6BA7.9040300@attbi.com>
Date: Sat, 28 Dec 2002 01:15:19 -0800
From: Jesse Peterson <jpeterson275@attbi.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Re: passwd-file; configure args..
References: <3E0D5959.7080300@attbi.com> <1041064352.29611.164.camel@hurina> <3E0D69EF.7020306@attbi.com>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 151
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jpeterson275@attbi.com
Precedence: bulk
X-list: dovecot
X-UID: 151                                                  
Status: O
Content-Length: 2567

Fixed...

Jesse Peterson wrote:
> Timo Sirainen wrote:
> 
>> On Sat, 2002-12-28 at 09:57, Jesse Peterson wrote:
>>
>>> I couldn't reproduce this again (because i can't get imap-master 
>>> running due to problem below..) but.. When compiling without shadow, 
>>> passwd, or pam, when logging in I get after a successful login (in my 
>>> syslog):
>>> Dec 28 22:39:38 badcase imap(username): MAIL environment missing and 
>>> autodetection failed (home /some/home/directory)
>>> Now I thought this was covered in a previous fix before (ChangeLog: 
>>> "2002-12-17 03:00  Timo Sirainen <tss@iki.fi>")  but for some reason 
>>> it's broken again..?
>>
>>
>>
>> This is different problem. The mailbox location detection isn't working
>> for some reason with you. Did it used to work, or is this just a
>> different user? ~/mail (mbox) or ~/Maildir has to exist to make Dovecot
>> know what to use.
>>
>>
>>> The configure args problem has to do with --localstatedir.  If i 
>>> leave it default (PREFIX/var) it forces me (even with non-relative 
>>> pathnames in the config file) for the socket-files 
>>> (ssl_parameters_file, login_dir) that should go in /var/run to be put 
>>> under PREFIX, (/usr/local for NetBSD 1.6).  Not too bad, if I could 
>>> override it in the config file, which I can't.  So I ./configure'd 
>>> with --localstatedir=/, and when I run imap-master I now get:
>>> Fatal: Can't create directory //run/dovecot: No such file or directory
>>> Somewhat odd.
>>
>>
>>
>> Well, since the default is PREFIX/var, you'd just drop out the PREFIX.
>> ie. --localstatedir=/var. But I'm also a bit annoyed at this change,
>> have to do something about it so that it can be overridden in config
>> file.
> 
> 
> I've tried that, and it starts, with a message about fixing permissions 
> of /var/run/dovecot, and then all I get is:
> Dec 29 01:05:48 badcase imap-master: child 9660 (auth) killed with signal 6
> Dec 29 01:05:49 badcase imap-master: child 9662 (auth) killed with signal 6
> Dec 29 01:05:51 badcase imap-master: child 9663 (auth) killed with signal 6
> Dec 29 01:05:52 badcase imap-master: child 9664 (auth) killed with signal 6
> Dec 29 01:05:53 badcase imap-master: child 9665 (auth) killed with signal 6
> Dec 29 01:05:54 badcase imap-master: child 9666 (auth) killed with signal 6
> 
> If try to connect to the server, I get alternating (auth) and (login) 
> "killed with signal 6" every second or so... weird.

For an odd reason, auth_user has to be root for it to not do this...

> 
> 
> 
>>
>>
> 

-- 
Jesse Peterson
erage@softhome.net


From tss@iki.fi  Sat Dec 28 11:19:08 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 28 Dec 2002 11:19:08 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 7AE632382C
	for <dovecot@procontrol.fi>; Sat, 28 Dec 2002 11:19:08 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 3E5A15E01F68; Sat, 28 Dec 2002 11:19:08 +0200 (EET)
Subject: [dovecot] Re: passwd-file; configure args..
From: Timo Sirainen <tss@iki.fi>
To: Dovecot Mail List <dovecot@procontrol.fi>
In-Reply-To: <3E0D6BA7.9040300@attbi.com>
References: <3E0D5959.7080300@attbi.com> <1041064352.29611.164.camel@hurina>
	 <3E0D69EF.7020306@attbi.com>  <3E0D6BA7.9040300@attbi.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1041067147.29611.168.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.0 
Date: 28 Dec 2002 11:19:07 +0200
X-archive-position: 152
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 152                                                  
Status: O
Content-Length: 1053

On Sat, 2002-12-28 at 11:15, Jesse Peterson wrote:
> > I've tried that, and it starts, with a message about fixing permissions 
> > of /var/run/dovecot, and then all I get is:
> > Dec 29 01:05:48 badcase imap-master: child 9660 (auth) killed with signal 6
> > Dec 29 01:05:49 badcase imap-master: child 9662 (auth) killed with signal 6
> > Dec 29 01:05:51 badcase imap-master: child 9663 (auth) killed with signal 6
> > Dec 29 01:05:52 badcase imap-master: child 9664 (auth) killed with signal 6
> > Dec 29 01:05:53 badcase imap-master: child 9665 (auth) killed with signal 6
> > Dec 29 01:05:54 badcase imap-master: child 9666 (auth) killed with signal 6

These are because of some bugs in syslog failure handler which I fixed a
few hours ago. It tried to print an error message but died instead.

> > If try to connect to the server, I get alternating (auth) and (login) 
> > "killed with signal 6" every second or so... weird.
> 
> For an odd reason, auth_user has to be root for it to not do this...

It didn't have read-access to the passwd file?


From jpeterson275@attbi.com  Sat Dec 28 11:32:03 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 28 Dec 2002 11:32:03 +0200 (EET)
Return-Path: <jpeterson275@attbi.com>
Delivered-To: dovecot@procontrol.fi
Received: from sccrmhc01.attbi.com (sccrmhc01.attbi.com [204.127.202.61])
	by danu.procontrol.fi (Postfix) with ESMTP id EEFA52382C
	for <dovecot@procontrol.fi>; Sat, 28 Dec 2002 11:32:02 +0200 (EET)
Received: from attbi.com (12-228-125-138.client.attbi.com[12.228.125.138])
          by sccrmhc01.attbi.com (sccrmhc01) with SMTP
          id <20021228093201001003l8t1e>; Sat, 28 Dec 2002 09:32:01 +0000
Message-ID: <3E0D6F93.7080700@attbi.com>
Date: Sat, 28 Dec 2002 01:32:03 -0800
From: Jesse Peterson <jpeterson275@attbi.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Re: passwd-file; configure args..
References: <3E0D5959.7080300@attbi.com> <1041064352.29611.164.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 153
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jpeterson275@attbi.com
Precedence: bulk
X-list: dovecot
X-UID: 153                                                  
Status: O
Content-Length: 2077



Timo Sirainen wrote:
> On Sat, 2002-12-28 at 09:57, Jesse Peterson wrote:
> 
>>I couldn't reproduce this again (because i can't get imap-master running 
>>due to problem below..) but.. When compiling without shadow, passwd, or 
>>pam, when logging in I get after a successful login (in my syslog):
>>Dec 28 22:39:38 badcase imap(username): MAIL environment missing and 
>>autodetection failed (home /some/home/directory)
>>Now I thought this was covered in a previous fix before (ChangeLog: 
>>"2002-12-17 03:00  Timo Sirainen <tss@iki.fi>")  but for some reason 
>>it's broken again..?
> 
> 
> This is different problem. The mailbox location detection isn't working
> for some reason with you. Did it used to work, or is this just a
> different user? ~/mail (mbox) or ~/Maildir has to exist to make Dovecot
> know what to use.
> 

More investigation brings some light into this.  If I create and move 
everything into a ~/Maildir, it seems to do okay, however, I want to set 
my default_mail_env to "maildir:%h" or "mbox:%h" and have that work, but 
so far, nothing.  Is there anything preventing this defualt_mail_env 
from working correctly?  It doesn't seem to work with these parameters 
as it is right now.

> 
>>The configure args problem has to do with --localstatedir.  If i leave 
>>it default (PREFIX/var) it forces me (even with non-relative pathnames 
>>in the config file) for the socket-files (ssl_parameters_file, 
>>login_dir) that should go in /var/run to be put under PREFIX, 
>>(/usr/local for NetBSD 1.6).  Not too bad, if I could override it in the 
>>config file, which I can't.  So I ./configure'd with --localstatedir=/, 
>>and when I run imap-master I now get:
>>Fatal: Can't create directory //run/dovecot: No such file or directory
>>Somewhat odd.
> 
> 
> Well, since the default is PREFIX/var, you'd just drop out the PREFIX.
> ie. --localstatedir=/var. But I'm also a bit annoyed at this change,
> have to do something about it so that it can be overridden in config
> file.

Right, this works.

> 
> 
> 

-- 
Jesse Peterson
erage@softhome.net


From jpeterson275@attbi.com  Sat Dec 28 11:34:40 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 28 Dec 2002 11:34:40 +0200 (EET)
Return-Path: <jpeterson275@attbi.com>
Delivered-To: dovecot@procontrol.fi
Received: from sccrmhc01.attbi.com (sccrmhc01.attbi.com [204.127.202.61])
	by danu.procontrol.fi (Postfix) with ESMTP id 832652382C
	for <dovecot@procontrol.fi>; Sat, 28 Dec 2002 11:34:40 +0200 (EET)
Received: from attbi.com (12-228-125-138.client.attbi.com[12.228.125.138])
          by sccrmhc01.attbi.com (sccrmhc01) with SMTP
          id <20021228093439001003kut9e>; Sat, 28 Dec 2002 09:34:39 +0000
Message-ID: <3E0D7031.9040306@attbi.com>
Date: Sat, 28 Dec 2002 01:34:41 -0800
From: Jesse Peterson <jpeterson275@attbi.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Re: passwd-file; configure args..
References: <3E0D5959.7080300@attbi.com> <1041064352.29611.164.camel@hurina>	 <3E0D69EF.7020306@attbi.com>  <3E0D6BA7.9040300@attbi.com> <1041067147.29611.168.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 154
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jpeterson275@attbi.com
Precedence: bulk
X-list: dovecot
X-UID: 154                                                  
Status: O



Timo Sirainen wrote:
> It didn't have read-access to the passwd file?

Actually, it didn't, I'll bet that was the problem.  Sorry for bugging 
you with my incompetence. =)

> 
> 
> 

-- 
Jesse Peterson
erage@softhome.net


From tss@iki.fi  Sat Dec 28 11:56:17 2002
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 28 Dec 2002 11:56:17 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 606E42382C
	for <dovecot@procontrol.fi>; Sat, 28 Dec 2002 11:56:17 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 32EE35E01F68; Sat, 28 Dec 2002 11:56:17 +0200 (EET)
Subject: [dovecot] Re: passwd-file; configure args..
From: Timo Sirainen <tss@iki.fi>
To: Dovecot Mail List <dovecot@procontrol.fi>
In-Reply-To: <3E0D6F93.7080700@attbi.com>
References: <3E0D5959.7080300@attbi.com> <1041064352.29611.164.camel@hurina>
	 <3E0D6F93.7080700@attbi.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1041069376.29609.170.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.0 
Date: 28 Dec 2002 11:56:16 +0200
X-archive-position: 155
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 155                                                  
Status: O

On Sat, 2002-12-28 at 11:32, Jesse Peterson wrote:
> More investigation brings some light into this.  If I create and move 
> everything into a ~/Maildir, it seems to do okay, however, I want to set 
> my default_mail_env to "maildir:%h" or "mbox:%h" and have that work, but 
> so far, nothing.  Is there anything preventing this defualt_mail_env 
> from working correctly?  It doesn't seem to work with these parameters 
> as it is right now.

Yes, a stupid bug that I fixed now :)


From gareth@wiked.org  Mon Dec 30 05:10:14 2002
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 30 Dec 2002 05:10:14 +0200 (EET)
Return-Path: <gareth@wiked.org>
Delivered-To: dovecot@procontrol.fi
Received: from mulder.wiked.org (3dlci148-2.icsfm.com [207.151.143.148])
	by danu.procontrol.fi (Postfix) with ESMTP id E39E82382C
	for <dovecot@procontrol.fi>; Mon, 30 Dec 2002 05:10:13 +0200 (EET)
Received: by mulder.wiked.org (Postfix, from userid 1000)
	id 2180210F20; Sun, 29 Dec 2002 19:10:07 -0800 (PST)
Date: Sun, 29 Dec 2002 19:10:06 -0800
To: dovecot@procontrol.fi
Subject: [dovecot] Maildir format
Message-ID: <20021230031006.GB23626@mulder.wiked.org>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.4i
From: gareth@wiked.org (Gareth J. Greenaway)
X-archive-position: 156
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: gareth@wiked.org
Precedence: bulk
X-list: dovecot
X-UID: 156                                                  
Status: O

Started using dovecot and I am very impressed by its speed.  I am
confused by what it is expecting the format of the Maildir directory
to be in.  I currently have ~/Maildir which contains new, cur, and tmp
all containing email that should be in my inbox and it pops up
correctly as such when I connect to dovecot using Mutt.  After the
connection a new .INBOX is created under ~/Maildir with sym links back
to new, cur, and tmp.  The problem arrises when I want to view email
from another folder, I have a folder called "test" which contains some
email also in Maildir format, however when I attempt to view this
email I only get an empty listing with the ".." to go one directory
up.  Thanks.



							Gareth
Greenaway
-- 
"My friends say I should act my age, What's my age again?"
Gareth J. Greenaway  | gareth@wiked.org    

From tss@iki.fi  Mon Dec 30 08:51:22 2002
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 30 Dec 2002 08:51:22 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 0EBCD23839
	for <dovecot@procontrol.fi>; Mon, 30 Dec 2002 08:51:22 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id BEF515E01F68; Mon, 30 Dec 2002 08:51:21 +0200 (EET)
Subject: [dovecot] Re: Maildir format
From: Timo Sirainen <tss@iki.fi>
To: "Gareth J. Greenaway" <gareth@wiked.org>
Cc: dovecot@procontrol.fi
In-Reply-To: <20021230031006.GB23626@mulder.wiked.org>
References: <20021230031006.GB23626@mulder.wiked.org>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1041231081.29604.226.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.0 
Date: 30 Dec 2002 08:51:21 +0200
X-archive-position: 157
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 157                                                  
Status: O

On Mon, 2002-12-30 at 05:10, Gareth J. Greenaway wrote:
> to new, cur, and tmp.  The problem arrises when I want to view email
> from another folder, I have a folder called "test" which contains some
> email also in Maildir format, however when I attempt to view this
> email I only get an empty listing with the ".." to go one directory
> up.  Thanks.

Dovecot wants the folders directory names to begin with a dot, so name
it ".test". Subfolders would be named as ".test.subfolder". This is
compatible with Courier's Maildir++ format.


From tss@iki.fi  Mon Dec 30 09:47:13 2002
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 30 Dec 2002 09:47:13 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id E810A2382C
	for <dovecot@procontrol.fi>; Mon, 30 Dec 2002 09:47:12 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 981315E01F68; Mon, 30 Dec 2002 09:47:12 +0200 (EET)
Subject: [dovecot] Re: Maildir format
From: Timo Sirainen <tss@iki.fi>
To: "Gareth J. Greenaway" <gareth@wiked.org>
Cc: dovecot@procontrol.fi
In-Reply-To: <20021230072514.GC23626@mulder.wiked.org>
References: <20021230031006.GB23626@mulder.wiked.org>
	 <1041231081.29604.226.camel@hurina>
	 <20021230072514.GC23626@mulder.wiked.org>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1041234432.29611.242.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.0 
Date: 30 Dec 2002 09:47:12 +0200
X-archive-position: 158
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 158                                                  
Status: O

On Mon, 2002-12-30 at 09:25, Gareth J. Greenaway wrote:
> On Mon, Dec 30, 2002 at 08:51:21AM +0200, Timo Sirainen wrote:
> > Dovecot wants the folders directory names to begin with a dot, so name
> > it ".test". Subfolders would be named as ".test.subfolder". This is
> > compatible with Courier's Maildir++ format.
> 
> Right. that is what I have as im using the Maildir folders from
> Courier but I still do not see mail showing up in them.  The folder
> itself shows up but no mail.

Oh, I think then you're just using mutt a bit wrong :) Enter-key goes
inside a subfolder, space-key selects the folder. A folder can itself
contain mail but it can also contain subfolders, so this is needed.

With Courier you probably got away with just enter-key because you
didn't have such subfolders and Courier gives mutt hints about if
folders have subfolders. Dovecot doesn't yet support that extension so
mutt always assumes they have subfolders.

From tss@iki.fi  Thu Jan  2 16:02:17 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 02 Jan 2003 16:02:17 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id A5EA323839
	for <dovecot@procontrol.fi>; Thu,  2 Jan 2003 16:02:16 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 5F85E5E01F96; Thu,  2 Jan 2003 16:02:16 +0200 (EET)
Subject: [dovecot] 0.99.5 released
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1041516136.29604.315.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.0 
Date: 02 Jan 2003 16:02:16 +0200
X-archive-position: 159
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 159                                                  
Status: O
Content-Length: 2613

v0.99.5 2003-01-02  Timo Sirainen <tss@iki.fi>

	* This release includes a lot of code cleanups, especially related to
	  security. Direct buffer modifying was replaced in several places
	  with a new buffer API, which provides a safe way to do it. Code that
	  looks unsafe contains @UNSAFE tag to make auditing easier.

	+ Support for SORT extension. Originally I thought about not
	  implementing any extensions before 1.0, but too many people want
	  webmails which want SORT. THREAD is another extension which they
	  want, but we don't support it yet.
	+ imap_listen and imaps_listen settings now accept "*" and "::" to
	  specify if we want to listen in IPv4 or IPv6 addresses. "::" may
	  also listen in all IPv4 addresses depending on the OS (Linux does,
	  BSD doesn't)
	+ New setting: default_mail_env can be used to specify where to find
	  users mailbox. Default is still to use autodetection.
	+ New setting: imap_log_path to log logins etc. informational messages
	  to different file.
	+ We support now separate mbox file for INBOX folder, no need for
	  symlink kludging anymore.
	+ Support for keeping index files in different location than actual
	  mailboxes.
	? Disabled mailbox_check_interval setting by default, it breaks
	  Evolution.
	- SEARCH was still somewhat buggy, especially with laggy networks.
	  Also body/header searches might have crashed or at least used
	  memory too much
	- Deleting messages in the middle of mbox caused dovecot to reindex
	  the following messages as new messages (ie. change UIDs and set
	  \Recent flag).
	- Digest-MD5 auth: Initial server challenge packet was missing a comma,
	  which might have made it incompatible with some implementations.
	- Some more fixes to unnecessarily high memory usage
	- SELECT and EXAMINE often printed UNSEEN reply or maybe complained
	  about corrupted indexes. Happened usually only with mbox.
	- FETCH BODYSTRUCTURE gave incorrect reply, breaking pine
	- LIST was pretty buggy with mbox subfolders
	- CHECK command returned just "missing parameters" error
	- DELETE didn't work with mbox folders
	- CREATE mailbox<hierarchy separator> failed always.
	- CREATE and RENAME didn't create required hierarchies with mbox
	- RFC822 date parser didn't handle single digit days correctly.
	- login_process_per_connection = yes didn't work with imaps port
	  connections which is exactly where it was mostly wanted.
	- ssl_disabled = yes didn't disable listening in imaps port
	- process limiting code didn't compile everywhere (eg. FreeBSD).
	- Linux sendfile() was never detected
	- We didn't work at all with gcc/PowerPC


From bradf@mailgate.tpi.com  Fri Jan  3 01:58:37 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 03 Jan 2003 01:58:37 +0200 (EET)
Return-Path: <bradf@mailgate.tpi.com>
Delivered-To: dovecot@procontrol.fi
Received: from mailgate.tpi.com (ftp.tpi.com [198.107.51.136])
	by danu.procontrol.fi (Postfix) with ESMTP id 9069C23839
	for <dovecot@procontrol.fi>; Fri,  3 Jan 2003 01:58:36 +0200 (EET)
Received: from norbert (norbert.tpi.com [198.107.51.144])
          by mailgate.tpi.com (Post.Office MTA v3.5.3 release 223
          ID# 0-60229U100L100S0V35) with ESMTP id com
          for <dovecot@procontrol.fi>; Thu, 2 Jan 2003 15:58:35 -0800
Content-Type: text/plain;
  charset="us-ascii"
From: Brad Figg <brad@tpi.com>
To: dovecot@procontrol.fi
Subject: [dovecot] Util for pop3 to dovecot?
Date: Thu, 2 Jan 2003 15:59:38 -0800
User-Agent: KMail/1.4.3
MIME-Version: 1.0
Content-Transfer-Encoding: quoted-printable
Message-Id: <200301021559.38857.brad@tpi.com>
X-archive-position: 160
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: brad@tpi.com
Precedence: bulk
X-list: dovecot
X-UID: 160                                                  
Status: O


What I want to do is pop my email off of a Pop3 server
and give it to dovecot for imap serving. Does anyone
know of a utility that will allow me to do this? I looked
at fetchmail but it seems to want to talk to an SMTP
server.

Thanks,
Brad

--=20
Brad Figg - brad@tpi.com 503.601.0235 ext. 105
TriplePoint, Inc. - http://www.tpi.com

From amyzing@talsever.com  Fri Jan  3 04:02:16 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 03 Jan 2003 04:02:16 +0200 (EET)
Return-Path: <amyzing@talsever.com>
Delivered-To: dovecot@procontrol.fi
Received: from granger.mail.mindspring.net (granger.mail.mindspring.net [207.69.200.148])
	by danu.procontrol.fi (Postfix) with ESMTP id 2531323839
	for <dovecot@procontrol.fi>; Fri,  3 Jan 2003 04:02:16 +0200 (EET)
Received: from user-2ivf46j.dialup.mindspring.com ([165.247.144.211] helo=marajen.talsever.com)
	by granger.mail.mindspring.net with esmtp (Exim 3.33 #1)
	id 18UHA4-0006K8-00
	for dovecot@procontrol.fi; Thu, 02 Jan 2003 21:02:12 -0500
Received: by marajen.talsever.com (Postfix, from userid 1000)
	id DAF0C817E; Thu,  2 Jan 2003 21:07:03 -0500 (EST)
Date: Thu, 2 Jan 2003 21:07:03 -0500
From: Amelia A.Lewis <amyzing@talsever.com>
To: dovecot@procontrol.fi
Subject: [dovecot] maildirmake, shared folders
Message-Id: <20030102210703.34a45879.amyzing@talsever.com>
Organization: The Mysthical World of Talsever!
X-Mailer: Sylpheed version 0.8.5 (GTK+ 1.2.10; alpha-debian-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-archive-position: 161
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: amyzing@talsever.com
Precedence: bulk
X-list: dovecot
X-UID: 161                                                  
Status: O
Content-Length: 2407

Does dovecot support shared folders, maildir style?

I've set it up, using the maildirmake from debian maildrop to create folders.  I have a number of as-yet unresolved issues, so I haven't been able to test with many clients.  It's interesting that dovecot manages to present folders as siblings (rather than children) of INBOX.  But mutt, at least, doesn't seem to see the shared maildir (created per instructions in the maildirmake man page).

I find in the debian archives that courier is unable to see messages delivered to new in a shared maildir.  This doesn't seem to be the same set of symptoms, though.  It appears, instead, that dovecot isn't recognizing (and then advertising) the shared-maildirs file (a text file that describes the name and the location).  Is that the case?  I don't think it's a high priority, mind, just wondering.

Another question: can the dovecot distribution include a maildirmake utility?  The documentation is pretty blunt about the significant advantages of maildirs, but one has to go to the courier distribution to find a utility to pre-create these (which dovecot seems to want, since it's recognizing the mail type by looking for the dir).  This is most significant when setting up new users, of course.  Possibly this is inappropriate, and I should instead ask the debian package maintainer to 'recommend' or 'suggest' the maildrop package in order to get the required utility.

Nice stuff, though.  I really like the ease of administration; dovecot looks to me like a sort of equivalent to postfix, for IMAP instead of SMTP.  A request for the website: perhaps developers could supply information on clients used with the server, and what oddities are encountered?  I know that IMAP client support is spotty, at best (for instance, I can't find a client that can do digest-md5; mutt is supposedly capable, but my installation doesn't even admit that that's a valid authenticator).  This is partly significant because setting up a system that uses options for which there is little or no client support is, perhaps, an exercise in futility.

Amy!
-- 
Amelia A. Lewis                    amyzing {at} talsever.com
Never imagine yourself not to be otherwise than what it might appear to
others that what you were or might have been was not otherwise than what
you had been would have appeared to them to be otherwise.
                -- The Duchess [Lewis Carroll]

From gareth@wiked.org  Fri Jan  3 04:48:52 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 03 Jan 2003 04:48:52 +0200 (EET)
Return-Path: <gareth@wiked.org>
Delivered-To: dovecot@procontrol.fi
Received: from mulder.wiked.org (3dlci148-2.icsfm.com [207.151.143.148])
	by danu.procontrol.fi (Postfix) with ESMTP id 59C4923839
	for <dovecot@procontrol.fi>; Fri,  3 Jan 2003 04:48:52 +0200 (EET)
Received: by mulder.wiked.org (Postfix, from userid 1000)
	id 07DC710F20; Thu,  2 Jan 2003 18:48:46 -0800 (PST)
Date: Thu, 2 Jan 2003 18:48:45 -0800
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Util for pop3 to dovecot?
Message-ID: <20030103024845.GA32431@mulder.wiked.org>
References: <200301021559.38857.brad@tpi.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <200301021559.38857.brad@tpi.com>
User-Agent: Mutt/1.4i
From: gareth@wiked.org (Gareth J. Greenaway)
X-archive-position: 162
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: gareth@wiked.org
Precedence: bulk
X-list: dovecot
X-UID: 162                                                  
Status: O

On Thu, Jan 02, 2003 at 03:59:38PM -0800, Brad Figg wrote:
> 
> What I want to do is pop my email off of a Pop3 server
> and give it to dovecot for imap serving. Does anyone
> know of a utility that will allow me to do this? I looked
> at fetchmail but it seems to want to talk to an SMTP
> server.
> 
> 
fetchmail talks to a pop3 server, smtp is for sending email.  You
could use fetchmail to bring the mail down from the pop3 server and
then use procmail to filter to filter out to the folders that imap
will serve from.


						Gareth

-- 
"My friends say I should act my age, What's my age again?"
Gareth J. Greenaway  | gareth@wiked.org    

From tss@iki.fi  Fri Jan  3 07:31:30 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 03 Jan 2003 07:31:31 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id CBBE12382C
	for <dovecot@procontrol.fi>; Fri,  3 Jan 2003 07:31:30 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 6A8325E01F96; Fri,  3 Jan 2003 07:31:30 +0200 (EET)
Subject: [dovecot] Re: maildirmake, shared folders
From: Timo Sirainen <tss@iki.fi>
To: "Amelia A.Lewis" <amyzing@talsever.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030102210703.34a45879.amyzing@talsever.com>
References: <20030102210703.34a45879.amyzing@talsever.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1041571890.29609.441.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.0 
Date: 03 Jan 2003 07:31:30 +0200
X-archive-position: 163
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 163                                                  
Status: O
Content-Length: 1976

On Fri, 2003-01-03 at 04:07, Amelia A.Lewis wrote:
> Does dovecot support shared folders, maildir style?

No shared folder support yet, sorry.

> It's interesting that dovecot manages to present folders as siblings
> (rather than children) of INBOX.

Yeah, I got annoyed at that with Courier. It was probably done so that
there would be a completely private namespace for the user, but I don't
think it's that bad to reserve a couple of folder names to specify
shared namespaces. Although I'll probably make it optional to specify a
separate namespace for private folders too.

> Another question: can the dovecot distribution include a maildirmake
> utility?

Well, maybe. It might confuse people though, since Dovecot doesn't yet
support shared folders and quota. Also Dovecot itself doesn't really
care about the contents of maildir, it's enough to simply create
~/Maildir and Dovecot creates the missing folders. qmail and others
might not do that though.

> Nice stuff, though.  I really like the ease of administration; dovecot
> looks to me like a sort of equivalent to postfix, for IMAP instead of
> SMTP.

I'm trying to make it fool proof :)

>   A request for the website: perhaps developers could supply
> information on clients used with the server, and what oddities are
> encountered?

Yes, I guess I could. I haven't found many oddities yet though.

>   I know that IMAP client support is spotty, at best (for instance, I
> can't find a client that can do digest-md5; mutt is supposedly
> capable, but my installation doesn't even admit that that's a valid
> authenticator).  This is partly significant because setting up a
> system that uses options for which there is little or no client
> support is, perhaps, an exercise in futility.

Evolution can do digest-md5 and I'm using it all the time. mutt uses
Cyrus SASL library, so you'll have to install libsasl-digestmd5-plain in
Debian. Except it doesn't seem to like Dovecot's implementation, have to
fix..


From jaldhar@debian.org  Fri Jan  3 07:46:29 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 03 Jan 2003 07:46:29 +0200 (EET)
Return-Path: <jaldhar@debian.org>
Delivered-To: dovecot@procontrol.fi
Received: from mail.braincells.com (samadhi.braincells.com [216.162.42.100])
	by danu.procontrol.fi (Postfix) with ESMTP id 3702A2382C
	for <dovecot@procontrol.fi>; Fri,  3 Jan 2003 07:46:29 +0200 (EET)
Received: from localhost (localhost [127.0.0.1])
	by mail.braincells.com (Postfix) with ESMTP
	id 1D0C68130; Fri,  3 Jan 2003 00:46:26 -0500 (EST)
Date: Fri, 3 Jan 2003 00:46:26 -0500 (EST)
From: "Jaldhar H. Vyas" <jaldhar@debian.org>
X-X-Sender: jaldhar@samadhi.braincells.com
Reply-To: "Jaldhar H. Vyas" <jaldhar@debian.org>
To: "Amelia A.Lewis" <amyzing@talsever.com>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: maildirmake, shared folders
In-Reply-To: <20030102210703.34a45879.amyzing@talsever.com>
Message-ID: <Pine.LNX.4.51.0301022226510.29663@samadhi.braincells.com>
References: <20030102210703.34a45879.amyzing@talsever.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 164
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jaldhar@debian.org
Precedence: bulk
X-list: dovecot
X-UID: 164                                                  
Status: O
Content-Length: 1380

On Thu, 2 Jan 2003, Amelia A.Lewis wrote:

> Another question: can the dovecot distribution include a maildirmake
> utility?  The documentation is pretty blunt about the significant
> advantages of maildirs, but one has to go to the courier distribution to
> find a utility to pre-create these (which dovecot seems to want, since
> it's recognizing the mail type by looking for the dir).  This is most
> significant when setting up new users, of course.  Possibly this is
> inappropriate, and I should instead ask the debian package maintainer to
> 'recommend' or 'suggest' the maildrop package in order to get the
> required utility.
>

Good thing I checked this list before I made the 0.99.5 packages.  rather
than depend on another package, i'm going to include the following script
as /usr/bin/maildirmake.dovecot (to avoid treading on the others.)

#!/bin/sh
#
# maildirmake.dovecot -- create maildirs
# Copyright (c) 2003, Jaldhar H. Vyas
# "Do what thou wilt" shall be the whole of the license.
#
dir=$1
if [ -z "$dir" ]; then
  echo "Must supply a directory path"
  exit 1
fi

if [ "$dir" = "-h" ]; then
  echo "usage: $0 directory"
  exit 0
fi

umask 077
mkdir -p $dir/{cur,new,tmp} || echo "$!" && exit 1
chmod u+rwxg-a- $dir $dir/{cur,new,tmp} || echo "$!" && exit 1

exit 0

If Timo wants to borrow this, he is welcome to it.

-- 
Jaldhar H. Vyas <jaldhar@debian.org>

From dgc@uchicago.edu  Sat Jan  4 01:41:29 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 04 Jan 2003 01:41:29 +0200 (EET)
Return-Path: <dgc@uchicago.edu>
Delivered-To: dovecot@procontrol.fi
Received: from dust.uchicago.edu (dust.uchicago.edu [128.135.0.35])
	by danu.procontrol.fi (Postfix) with ESMTP id 0560C2382C
	for <dovecot@procontrol.fi>; Sat,  4 Jan 2003 01:41:15 +0200 (EET)
Received: (from dgc@localhost)
	by dust.uchicago.edu (8.11.6/8.11.6) id h03Nf3p07313;
	Fri, 3 Jan 2003 17:41:03 -0600 (CST)
X-Authentication-Warning: dust.uchicago.edu: dgc set sender to dgc@uchicago.edu using -f
Date: Fri, 3 Jan 2003 17:41:03 -0600
From: David Champion <dgc@uchicago.edu>
To: "Gareth J. Greenaway" <gareth@wiked.org>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: Util for pop3 to dovecot?
Message-ID: <20030103234103.GM27418@dust.uchicago.edu>
Mail-Followup-To: "Gareth J. Greenaway" <gareth@wiked.org>,
	dovecot@procontrol.fi
References: <200301021559.38857.brad@tpi.com> <20030103024845.GA32431@mulder.wiked.org>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20030103024845.GA32431@mulder.wiked.org>
User-Agent: Mutt/1.5.2i
X-archive-position: 165
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: dgc@uchicago.edu
Precedence: bulk
X-list: dovecot
X-UID: 165                                                  
Status: O
Content-Length: 1241

* On 2003.01.02, in <20030103024845.GA32431@mulder.wiked.org>,
*	"Gareth J. Greenaway" <gareth@wiked.org> wrote:
> >
> > know of a utility that will allow me to do this? I looked
> > at fetchmail but it seems to want to talk to an SMTP
> > server.
>
> fetchmail talks to a pop3 server, smtp is for sending email.  You
> could use fetchmail to bring the mail down from the pop3 server and
> then use procmail to filter to filter out to the folders that imap
> will serve from.

There's a misunderstanding here.

In some configurations, fetchmail wants to relay mail that it pops
through a local MTA (SMTP server). This is what Brad was referring to:
it connects to the POP server, downloads mail, and connects to the local
SMTP service to relay the new messages. The ostensible reasons for this
are a certain kind of simplicity, and the ability to take advantage of
whatever filtering hooks you have plugged into your local MTA.

But for another kind of simplicity, fetchmail can be configured instead
to use a local MDA instead of a local MTA. Procmail works fine for this
purpose, as does any other program designed to deliver mail locally on
sendmail's behalf.

-- 
 -D.	dgc@uchicago.edu	NSIT	University of Chicago
 We're the colon in ://

From amyzing@talsever.com  Sun Jan  5 06:40:44 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 05 Jan 2003 06:40:44 +0200 (EET)
Return-Path: <amyzing@talsever.com>
Delivered-To: dovecot@procontrol.fi
Received: from granger.mail.mindspring.net (granger.mail.mindspring.net [207.69.200.148])
	by danu.procontrol.fi (Postfix) with ESMTP id E90A323839
	for <dovecot@procontrol.fi>; Sun,  5 Jan 2003 06:40:43 +0200 (EET)
Received: from user-2ivf46j.dialup.mindspring.com ([165.247.144.211] helo=marajen.talsever.com)
	by granger.mail.mindspring.net with esmtp (Exim 3.33 #1)
	id 18V2aV-0006Sv-00
	for dovecot@procontrol.fi; Sat, 04 Jan 2003 23:40:39 -0500
Received: by marajen.talsever.com (Postfix, from userid 1000)
	id 446A78051; Sat,  4 Jan 2003 23:46:01 -0500 (EST)
Date: Sat, 4 Jan 2003 23:46:01 -0500
From: Amelia A.Lewis <amyzing@talsever.com>
To: dovecot <dovecot@procontrol.fi>
Subject: [dovecot] Some experiences
Message-Id: <20030104234601.11360cfc.amyzing@talsever.com>
Organization: The Mysthical World of Talsever!
X-Mailer: Sylpheed version 0.8.5 (GTK+ 1.2.10; alpha-debian-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-archive-position: 166
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: amyzing@talsever.com
Precedence: bulk
X-list: dovecot
X-UID: 166                                                  
Status: O
Content-Length: 3190

Heyas ...

I'm trying to use dovecot to set up a 'closed server' (actually, mixed) sort of environment, for a box to be deployed co-located.  I wanted to talk about some of that, and see if some of my experience qualifies as 'bug'.

Note that I'm notoriously verbose, so if that bothers you, read no further ....

Since it's a more-or-less closed server, I didn't want to use pam (well, I wouldn't mind, for users with shell accounts, but I can't see a way to mix pam and passwd-file ... is there a way to do that?).

It turns out that digest-md5 support for clients is, well, not very widespread.  I expect this box to be used by various windoze clients, eventually, and while I'm willing to lay down the law a little, I can't find enough digest-md5 support to lay down that law.  So, regretfully, I abandoned that plan.  This kinda bothers me, since I think TLS/STARTTLS is absolutely the *wrong* solution for mailbox access (or for anything that deals with a store-and-forward transport).

I therefore tried md5 passwords in a passwd-file, with STARTTLS enabled.  Didn't work.  I turned off SSL, and reenabled plain-text, and watched the login go by.  Very sniffable, of course.  But correct username and password ... failed.  There are instructions for creating digest-md5 style secrets in auth.txt, but none for md5 passwords; I used openssl passwd -1 [password] (and cut and paste).  It seems odd to me that this didn't work; does that command use a different algorithm than dovecot?

Falling back ... since it *shouldn't* matter if the passwords are weak, as long as they're inside TLS (along with the entire rest of the transaction, ugh), I used mkpasswd to generate a standard unix passwd (and cut and paste).  This worked.  It worked with TLS, and it worked without (as long as I remembered to allow sniffable logins).

One more oddity: I originally had a realm in the passwd-file, which also established the mail location and 'home' directory (most of the users can't actually log in and don't have accounts in /etc/passwd, so it's not a real home directory).  There was an odd message in syslog, approximately like so (where 'user' represents the username, and 'domain.realm' represents both my domain name and the realm in the passwd-file):

imap(user:@omain.realm): Failed to create storage with data: domain.realm

Note the missing first letter after user:@  And I don't know what it was trying to do; the maildirs already exist.  /etc/dovecot.conf sets the default mail location to /home/users/%n/Maildir (non-shell users are all inside /home/users; shell users have mail there, with symlinks to ~/Maildir); the passwd-file establishes the location of the INBOX pretty definitively, I would think.  The solution was to remove the realm (which isn't useful except for digest md5, anway, right?).

Hey, it's working!  Wahoo!  *laugh*  Anyway, if someone can offer suggestions on what's up with the pieces that *aren't* working, I'd be interested to know.  It might give me a greater range of options.

Amy!
-- 
Amelia A. Lewis                    amyzing {at} talsever.com
The less I seek my source for some definitive, the closer I am to fine.
                -- Indigo Girls

From jpeterson275@attbi.com  Sun Jan  5 07:05:37 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 05 Jan 2003 07:05:37 +0200 (EET)
Return-Path: <jpeterson275@attbi.com>
Delivered-To: dovecot@procontrol.fi
Received: from sccrmhc01.attbi.com (sccrmhc01.attbi.com [204.127.202.61])
	by danu.procontrol.fi (Postfix) with ESMTP id CE7152382C
	for <dovecot@procontrol.fi>; Sun,  5 Jan 2003 07:05:36 +0200 (EET)
Received: from attbi.com (12-228-125-138.client.attbi.com[12.228.125.138])
          by sccrmhc01.attbi.com (sccrmhc01) with SMTP
          id <20030105050533001005gcn3e>; Sun, 5 Jan 2003 05:05:33 +0000
Message-ID: <3E17BD2C.9020906@attbi.com>
Date: Sat, 04 Jan 2003 21:05:48 -0800
From: Jesse Peterson <jpeterson275@attbi.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Re: Some experiences
References: <20030104234601.11360cfc.amyzing@talsever.com>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 167
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jpeterson275@attbi.com
Precedence: bulk
X-list: dovecot
X-UID: 167                                                  
Status: O
Content-Length: 3374

Amelia A.Lewis wrote:
> Heyas ...
> 
> I'm trying to use dovecot to set up a 'closed server' (actually, mixed) sort of environment, for a box to be deployed co-located.  I wanted to talk about some of that, and see if some of my experience qualifies as 'bug'.
> 
> Note that I'm notoriously verbose, so if that bothers you, read no further ....
> 
> Since it's a more-or-less closed server, I didn't want to use pam (well, I wouldn't mind, for users with shell accounts, but I can't see a way to mix pam and passwd-file ... is there a way to do that?).
> 
> It turns out that digest-md5 support for clients is, well, not very widespread.  I expect this box to be used by various windoze clients, eventually, and while I'm willing to lay down the law a little, I can't find enough digest-md5 support to lay down that law.  So, regretfully, I abandoned that plan.  This kinda bothers me, since I think TLS/STARTTLS is absolutely the *wrong* solution for mailbox access (or for anything that deals with a store-and-forward transport).
> 
> I therefore tried md5 passwords in a passwd-file, with STARTTLS enabled.  Didn't work.  I turned off SSL, and reenabled plain-text, and watched the login go by.  Very sniffable, of course.  But correct username and password ... failed.  There are instructions for creating digest-md5 style secrets in auth.txt, but none for md5 passwords; I used openssl passwd -1 [password] (and cut and paste).  It seems odd to me that this didn't work; does that command use a different algorithm than dovecot?
> 
> Falling back ... since it *shouldn't* matter if the passwords are weak, as long as they're inside TLS (along with the entire rest of the transaughction, ugh), I used mkpasswd to generate a standard unix passwd (and 
cut and paste).  This worked.  It worked with TLS, and it worked without 
(as long as I remembered to allow sniffable logins).

Not to be confrontational at all, but I'm very curious as to why you 
have such an aversion to SSL/TLS for IMAP access?  I think actualy an 
entirely encrypted transport for something as (possibly sensitive) email 
is a good thing.

> 
> One more oddity: I originally had a realm in the passwd-file, which also established the mail location and 'home' directory (most of the users can't actually log in and don't have accounts in /etc/passwd, so it's not a real home directory).  There was an odd message in syslog, approximately like so (where 'user' represents the username, and 'domain.realm' represents both my domain name and the realm in the passwd-file):
> 
> imap(user:@omain.realm): Failed to create storage with data: domain.realm
> 
> Note the missing first letter after user:@  And I don't know what it was trying to do; the maildirs already exist.  /etc/dovecot.conf sets the default mail location to /home/users/%n/Maildir (non-shell users are all inside /home/users; shell users have mail there, with symlinks to ~/Maildir); the passwd-file establishes the location of the INBOX pretty definitively, I would think.  The solution was to remove the realm (which isn't useful except for digest md5, anway, right?).
> 
> Hey, it's working!  Wahoo!  *laugh*  Anyway, if someone can offer suggestions on what's up with the pieces that *aren't* working, I'd be interested to know.  It might give me a greater range of options.
> 
> Amy!

-- 
Jesse Peterson  /  jesse@pixeltechs.com


From amyzing@talsever.com  Sun Jan  5 07:25:13 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 05 Jan 2003 07:25:13 +0200 (EET)
Return-Path: <amyzing@talsever.com>
Delivered-To: dovecot@procontrol.fi
Received: from barry.mail.mindspring.net (barry.mail.mindspring.net [207.69.200.25])
	by danu.procontrol.fi (Postfix) with ESMTP id C48362382C
	for <dovecot@procontrol.fi>; Sun,  5 Jan 2003 07:25:13 +0200 (EET)
Received: from user-2ivf46j.dialup.mindspring.com ([165.247.144.211] helo=marajen.talsever.com)
	by barry.mail.mindspring.net with esmtp (Exim 3.33 #1)
	id 18V3Ha-0004NP-00; Sun, 05 Jan 2003 00:25:10 -0500
Received: by marajen.talsever.com (Postfix, from userid 1000)
	id 941EE8051; Sun,  5 Jan 2003 00:30:32 -0500 (EST)
Date: Sun, 5 Jan 2003 00:30:32 -0500
From: Amelia A.Lewis <amyzing@talsever.com>
To: Jesse Peterson <jpeterson275@attbi.com>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: Some experiences
Message-Id: <20030105003032.475dc84b.amyzing@talsever.com>
In-Reply-To: <3E17BD2C.9020906@attbi.com>
References: <20030104234601.11360cfc.amyzing@talsever.com>
	<3E17BD2C.9020906@attbi.com>
Organization: The Mysthical World of Talsever!
X-Mailer: Sylpheed version 0.8.5 (GTK+ 1.2.10; alpha-debian-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-archive-position: 168
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: amyzing@talsever.com
Precedence: bulk
X-list: dovecot
X-UID: 168                                                  
Status: O
Content-Length: 2646

On Sat, 04 Jan 2003 21:05:48 -0800 Jesse Peterson
<jpeterson275@attbi.com> wrote:

> Amelia A.Lewis wrote:
> > It turns out that digest-md5 support for clients is, well, not very
> > widespread.  I expect this box to be used by various windoze
> > clients, eventually, and while I'm willing to lay down the law a
> > little, I can't find enough digest-md5 support to lay down that law.
> >  So, regretfully, I abandoned that plan.  This kinda bothers me,
> >  since I think TLS/STARTTLS is absolutely the *wrong* solution for
> >  mailbox access (or for anything that deals with a store-and-forward
> >  transport).
> 
> Not to be confrontational at all, but I'm very curious as to why you 
> have such an aversion to SSL/TLS for IMAP access?  I think actualy an 
> entirely encrypted transport for something as (possibly sensitive)
> email is a good thing.

That's exactly why.

TLS doesn't secure email.  It secures this particular transaction over
IMAP.  Worse, from my particular perspective, it's the preferred
solution to secure authentication, which means that lighter-weight
solutions that protect only the authentication secret are much less
available.

TLS also tends to be associated with ecommerce, and the famous (or
possibly notorious) lock icon.  It has a widespread connotation of
comfortable security which, of course, IMAP+TLS alone cannot by any
means actually guarantee.

My particular installation is supposed to protect the authentication
secret, only, because I don't want someone using the system to think "my
email is secure" because it runs over a TLS session.  It isn't.

Secure email means end-to-end, an agreement between the people who are
exchanging it and a willingness to encrypt (and usually to store
encrypted).  I dislike the impression given by TLS that it's a magical
solution to the problem of security (which one hears from programmers
that ought to know better, btw ... create an insecure system, and answer
questions about security with "anyone worried about it can use SSL!").

But we're off topic, I think, and I'm ranting, because I ended up
needing to use the heavyweight solution as client support for the
solutions I prefer doesn't seem to be out there.  Which is prolly why I
made the snide and unnecessary remarks in the first place.

Amy!
-- 
Amelia A. Lewis                    amyzing {at} talsever.com
  Light is the left hand of darkness
  and darkness the right hand of light.
    Two are one, life and death, lying
    together like lovers in kemmer,
      like hands joined together,
      like the end and the way.
        -- Tormer's Lay [Ursula K. Le Guin, "The Left Hand of Darkness"]

From tss@iki.fi  Sun Jan  5 11:32:26 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 05 Jan 2003 11:32:26 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 076B62382C
	for <dovecot@procontrol.fi>; Sun,  5 Jan 2003 11:32:26 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 5990E5E01F96; Sun,  5 Jan 2003 11:32:25 +0200 (EET)
Subject: [dovecot] Re: Some experiences
From: Timo Sirainen <tss@iki.fi>
To: "Amelia A.Lewis" <amyzing@talsever.com>
Cc: dovecot <dovecot@procontrol.fi>
In-Reply-To: <20030104234601.11360cfc.amyzing@talsever.com>
References: <20030104234601.11360cfc.amyzing@talsever.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1041759144.6219.26.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 05 Jan 2003 11:32:25 +0200
X-archive-position: 169
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 169                                                  
Status: O
Content-Length: 3033

On Sun, 2003-01-05 at 06:46, Amelia A.Lewis wrote:
> Since it's a more-or-less closed server, I didn't want to use pam
> (well, I wouldn't mind, for users with shell accounts, but I can't see
> a way to mix pam and passwd-file ... is there a way to do that?).

Not really. I don't think it'd be worth the trouble.

> It turns out that digest-md5 support for clients is, well, not very
> widespread.  I expect this box to be used by various windoze clients,
> eventually, and while I'm willing to lay down the law a little, I
> can't find enough digest-md5 support to lay down that law.  So,
> regretfully, I abandoned that plan.  This kinda bothers me, since I
> think TLS/STARTTLS is absolutely the *wrong* solution for mailbox
> access (or for anything that deals with a store-and-forward
> transport).

I think Outlook supported only NTLM besides the plaintext auth. There's
specs for it now so it would be possible to be supported too.

> I therefore tried md5 passwords in a passwd-file, with STARTTLS
> enabled.  Didn't work.  I turned off SSL, and reenabled plain-text,
> and watched the login go by.  Very sniffable, of course.  But correct
> username and password ... failed.  There are instructions for creating
> digest-md5 style secrets in auth.txt, but none for md5 passwords; I
> used openssl passwd -1 [password] (and cut and paste).  It seems odd
> to me that this didn't work; does that command use a different
> algorithm than dovecot?

It uses different algorithm, although Dovecot could be made to support
that too.. The Dovecot's algorithm is very simple and is compatible with
pwdfile PAM module, it's simply the MD5 sum of a given text, eg:

perl -MDigest::MD5 -e 'print Digest::MD5::md5_hex("pass")."[34]\n"'

Digest-MD5 passwords should probably rather be used so that could be
used also by people who can. The description was a bit broken it seems,
for plaintext authentication it works only if the realm is empty, so
this should work:

perl -MDigest::MD5 -e 'print Digest::MD5::md5_hex("user::pass")."[56]\n"'


> imap(user:@omain.realm): Failed to create storage with data:
> domain.realm

Guess I should have actually tested this :) It tried to replace the ':'
char with '@'. Fixed.

> Note the missing first letter after user:@  And I don't know what it
> was trying to do; the maildirs already exist.  /etc/dovecot.conf sets
> the default mail location to /home/users/%n/Maildir (non-shell users

%n was then "user:", so it didn't work.

> The solution was to remove the realm (which isn't useful except for
> digest md5, anway, right?).

It's not really useful for digest-md5 either. It's mostly to support
multiple realms running in same server. I'm not yet sure how I'd
actually even properly support those .. probably fallback to user@realm
style in plaintext passwords.

Maybe I should consider anyway using Cyrus SASL library, at least
optionally. Would make life so much easier :) Everyone keeps wanting
LDAP and MySQL and whatever support, but I'd rather concentrate on the
IMAP side for now.


From amyzing@talsever.com  Sun Jan  5 13:45:05 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 05 Jan 2003 13:45:05 +0200 (EET)
Return-Path: <amyzing@talsever.com>
Delivered-To: dovecot@procontrol.fi
Received: from hall.mail.mindspring.net (hall.mail.mindspring.net [207.69.200.60])
	by danu.procontrol.fi (Postfix) with ESMTP id 0CA692382C
	for <dovecot@procontrol.fi>; Sun,  5 Jan 2003 13:45:05 +0200 (EET)
Received: from user-2ivf46j.dialup.mindspring.com ([165.247.144.211] helo=marajen.talsever.com)
	by hall.mail.mindspring.net with esmtp (Exim 3.33 #1)
	id 18V9D9-0001TB-00; Sun, 05 Jan 2003 06:45:00 -0500
Received: by marajen.talsever.com (Postfix, from userid 1000)
	id D93DA8051; Sun,  5 Jan 2003 06:44:30 -0500 (EST)
Date: Sun, 5 Jan 2003 06:44:30 -0500
From: Amelia A.Lewis <amyzing@talsever.com>
To: Timo Sirainen <tss@iki.fi>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: Some experiences
Message-Id: <20030105064430.3af19f56.amyzing@talsever.com>
In-Reply-To: <1041759144.6219.26.camel@hurina>
References: <20030104234601.11360cfc.amyzing@talsever.com>
	<1041759144.6219.26.camel@hurina>
Organization: The Mysthical World of Talsever!
X-Mailer: Sylpheed version 0.8.5 (GTK+ 1.2.10; alpha-debian-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-archive-position: 170
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: amyzing@talsever.com
Precedence: bulk
X-list: dovecot
X-UID: 170                                                  
Status: O
Content-Length: 3565

Quick replies from the man who knows!  Thanks, Timo!

A request for clarification ...

On 05 Jan 2003 11:32:25 +0200 Timo Sirainen <tss@iki.fi> wrote:

> On Sun, 2003-01-05 at 06:46, Amelia A.Lewis wrote:
> I think Outlook supported only NTLM besides the plaintext auth. There's
> specs for it now so it would be possible to be supported too.

If I could think of a way to break outlook without breaking other
windows clients, I'd do it.  As a service to the community (reduction of
virus infections).  But prolly you want to be compatible.

> > I therefore tried md5 passwords in a passwd-file, with STARTTLS
> > enabled.  Didn't work.  I turned off SSL, and reenabled plain-text,
> > and watched the login go by.  Very sniffable, of course.  But correct
> > username and password ... failed.  There are instructions for creating
> > digest-md5 style secrets in auth.txt, but none for md5 passwords; I
> > used openssl passwd -1 [password] (and cut and paste).  It seems odd
> > to me that this didn't work; does that command use a different
> > algorithm than dovecot?
> 
> It uses different algorithm, although Dovecot could be made to support
> that too.. The Dovecot's algorithm is very simple and is compatible with
> pwdfile PAM module, it's simply the MD5 sum of a given text, eg:
> 
> perl -MDigest::MD5 -e 'print Digest::MD5::md5_hex("pass")."[34]\n"'
> 
> Digest-MD5 passwords should probably rather be used so that could be
> used also by people who can. The description was a bit broken it seems,
> for plaintext authentication it works only if the realm is empty, so
> this should work:
> 
> perl -MDigest::MD5 -e 'print Digest::MD5::md5_hex("user::pass")."[56]\n"'

Okay.  In other words, any of the three password styles will work with
plaintext auth and no realm?

And digest-md5 with no realm can be used both in plaintext, and in
digest-md5 (making sure that dovecot.conf has an empty realms list)?

If the latter is true, I think that that's what I want to do ....

I think some clarifications to auth.txt might be in order; perhaps I'll
write some bits and offer the diff?  Or the modified file?

> Maybe I should consider anyway using Cyrus SASL library, at least
> optionally. Would make life so much easier :) Everyone keeps wanting
> LDAP and MySQL and whatever support, but I'd rather concentrate on the
> IMAP side for now.

I *like* your focus.  I like dovecot and its ease of setup very much. 
If lots of features are addded, then complexity is likely to rise ... in
that case, perhaps the postfix pattern of config files would be worth
emulating?  Because basic postfix configuration remains simple; certain
sorts of more complex configuration (like virtual alias domains and
virtual mailbox domains) live in their own files, referenced from main,
but documented separately.

I'm unthrilled with the current state of SASL; it seems to be in flux
between version 1.5 and version 2.1, which are not mutually compatible
(I'm pretty sure that this is why mutt doesn't do digest-md5 on my
system).  That will eventually get straightened out, I'm sure.  But the
current state of auth in dovecot seems to allow most things that SASL
might offer, so perhaps it isn't yet worth the hassle of linking.

Amy!
-- 
Amelia A. Lewis                    amyzing {at} talsever.com      alicorn@mindspring.com
I stopped by the bar at 3 a.m. to seek solace in a bottle, or possibly
a friend.  I woke up with a headache like my head against a board, twice
as cloudy as I'd been the night before.  I went in seeking clarity.
                -- Indigo Girls

From email@pbryan.net  Sun Jan  5 21:45:33 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 05 Jan 2003 21:45:33 +0200 (EET)
Return-Path: <email@pbryan.net>
Delivered-To: dovecot@procontrol.fi
Received: from mail.creatia.net (fozzie.creatia.net [64.180.101.199])
	by danu.procontrol.fi (Postfix) with ESMTP id 670EA2382C
	for <dovecot@procontrol.fi>; Sun,  5 Jan 2003 21:45:33 +0200 (EET)
Received: from pbryan.net (grover.creatia.net [64.180.101.78])
	by mail.creatia.net (Postfix) with ESMTP
	id 32DFE88C065; Sun,  5 Jan 2003 11:45:27 -0800 (PST)
Message-ID: <3E18892F.1010700@pbryan.net>
Date: Sun, 05 Jan 2003 11:36:15 -0800
From: "Paul C. Bryan" <email@pbryan.net>
User-Agent: Mozilla/5.5 (X11; U; Linux i686; en-US; rv 0.9.2) Gecko/20010726
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Timo Sirainen <tss@iki.fi>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: Some experiences
References: <20030104234601.11360cfc.amyzing@talsever.com> <1041759144.6219.26.camel@hurina>
In-Reply-To: <1041759144.6219.26.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 171
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: email@pbryan.net
Precedence: bulk
X-list: dovecot
X-UID: 171                                                  
Status: O

Timo Sirainen wrote:

> Maybe I should consider anyway using Cyrus SASL library, at least
> optionally.

Please do! It works, it's flexible, it's secure, and allows central 
administration of authentication.

Yours truly,

Paul C. Bryan
email@pbryan.net


From tss@iki.fi  Sun Jan  5 22:33:05 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 05 Jan 2003 22:33:05 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 9C5F323839
	for <dovecot@procontrol.fi>; Sun,  5 Jan 2003 22:33:05 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 696ED5E01F96; Sun,  5 Jan 2003 22:33:05 +0200 (EET)
Subject: [dovecot] Re: Some experiences
From: Timo Sirainen <tss@iki.fi>
To: "Paul C. Bryan" <email@pbryan.net>
Cc: dovecot@procontrol.fi
In-Reply-To: <3E18892F.1010700@pbryan.net>
References: <20030104234601.11360cfc.amyzing@talsever.com>
	 <1041759144.6219.26.camel@hurina>  <3E18892F.1010700@pbryan.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1041798785.6218.36.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 05 Jan 2003 22:33:05 +0200
X-archive-position: 172
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 172                                                  
Status: O

On Sun, 2003-01-05 at 21:36, Paul C. Bryan wrote:
> > Maybe I should consider anyway using Cyrus SASL library, at least
> > optionally.
> 
> Please do! It works, it's flexible, it's secure, and allows central 
> administration of authentication.

Well, current CVS has some code for it, but it's still missing some
configuration. Actually I'm not really sure how I should do that, I
found one way but Postfix doesn't seem to doing that..

And secure? I doubt it, I did a quick audit to it a month ago and found
3 buffer overflows. I checked mostly just PLAIN mechanism which I use
with Postfix, so there may well be more left in other auth mechanisms.


From kiwi@oav.net  Sun Jan  5 23:25:58 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 05 Jan 2003 23:25:58 +0200 (EET)
Return-Path: <kiwi@oav.net>
Delivered-To: dovecot@procontrol.fi
Received: from kaneda.oav.net (kaneda.oav.net [195.154.210.144])
	by danu.procontrol.fi (Postfix) with ESMTP id 7A3F62382C
	for <dovecot@procontrol.fi>; Sun,  5 Jan 2003 23:25:58 +0200 (EET)
Received: from oav.net (kiwi.adsl.isdnet.net [195.154.177.33])
	(using TLSv1 with cipher DES-CBC3-SHA (168/168 bits))
	(No client certificate requested)
	by kaneda.oav.net (Postfix) with ESMTP
	id 688B815750; Sun,  5 Jan 2003 22:25:53 +0100 (CET)
	(envelope-from kiwi@oav.net)
Date: Sun, 5 Jan 2003 22:26:00 +0100
Subject: [dovecot] Re: Some experiences
Content-Type: text/plain; charset=US-ASCII; format=flowed
Mime-Version: 1.0 (Apple Message framework v551)
Cc: dovecot@procontrol.fi
To: Timo Sirainen <tss@iki.fi>
From: Xavier Beaudouin <kiwi@oav.net>
In-Reply-To: <1041798785.6218.36.camel@hurina>
Message-Id: <495397B0-20F4-11D7-9440-000393B64262@oav.net>
Content-Transfer-Encoding: 7bit
X-Mailer: Apple Mail (2.551)
X-archive-position: 173
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: kiwi@oav.net
Precedence: bulk
X-list: dovecot
X-UID: 173                                                  
Status: O
Content-Length: 1603

Hi ;-)

[...]

> Well, current CVS has some code for it, but it's still missing some
> configuration. Actually I'm not really sure how I should do that, I
> found one way but Postfix doesn't seem to doing that..
>
> And secure? I doubt it, I did a quick audit to it a month ago and found
> 3 buffer overflows. I checked mostly just PLAIN mechanism which I use
> with Postfix, so there may well be more left in other auth mechanisms.
>

Personaly I don't like too mutch Cyrus SASL for lots of reasons :

- I don't trust it a lot
- this yet another lib to add to the thousands of lib used for 
authentication eg :
   server code (here dovecot) -> sasl -> pam -> mod_someth -> something 
lib -> something server -> db ..

   Yes I know there is patch for sasl 1.x and there some other backend 
for sasl 2.x but I still don't like it.

Adding some lines of code into dovecot for authentication against MySQL 
(for example) or LDAP should not
too mutch and mutch easy to debug / audit than a big library like SASL.

For my point of view, I going, when time available a patch for dovecot 
to do mysql auth, since I want to move
from courier-imap (sorry) to a better solution that is dovecot.... 
(that I use at home using pam)... to get a 100%
virtual account solution without adding 3rd party code... ;-)

my 0.02c

/Xavier


--
Xavier Beaudouin - Unix System Administrator & Projects Leader.
For mail address, please check header of this mail. Spams are not 
accepted.
Caudium: http://caudium.net/
Making friends with FreeBSD:
  Just because the system has panicked doesn't mean that you should 
panic too


From email@pbryan.net  Mon Jan  6 01:15:18 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 06 Jan 2003 01:15:18 +0200 (EET)
Return-Path: <email@pbryan.net>
Delivered-To: dovecot@procontrol.fi
Received: from mail.creatia.net (fozzie.creatia.net [64.180.101.199])
	by danu.procontrol.fi (Postfix) with ESMTP id 0DA292382C
	for <dovecot@procontrol.fi>; Mon,  6 Jan 2003 01:15:18 +0200 (EET)
Received: from pbryan.net (grover.creatia.net [64.180.101.78])
	by mail.creatia.net (Postfix) with ESMTP
	id 86A4E88C065; Sun,  5 Jan 2003 15:15:15 -0800 (PST)
Message-ID: <3E18BC80.4050209@pbryan.net>
Date: Sun, 05 Jan 2003 15:15:12 -0800
From: "Paul C. Bryan" <email@pbryan.net>
User-Agent: Mozilla/5.5 (X11; U; Linux i686; en-US; rv 0.9.2) Gecko/20010726
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Timo Sirainen <tss@iki.fi>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: Some experiences
References: <20030104234601.11360cfc.amyzing@talsever.com>	 <1041759144.6219.26.camel@hurina>  <3E18892F.1010700@pbryan.net> <1041798785.6218.36.camel@hurina>
In-Reply-To: <1041798785.6218.36.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 174
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: email@pbryan.net
Precedence: bulk
X-list: dovecot
X-UID: 174                                                  
Status: O

Timo Sirainen wrote:

> And secure? I doubt it, I did a quick audit to it a month ago and found
> 3 buffer overflows. I checked mostly just PLAIN mechanism which I use
> with Postfix, so there may well be more left in other auth mechanisms.

Was this version 1 or version 2?

Paul


From dave@tamos.net  Mon Jan  6 01:48:04 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 06 Jan 2003 01:48:04 +0200 (EET)
Return-Path: <dave@tamos.net>
Delivered-To: dovecot@procontrol.fi
Received: from grue.tamos.net (dsl093-083-029.wdc1.dsl.speakeasy.net [66.93.83.29])
	by danu.procontrol.fi (Postfix) with SMTP id EC6AC2382C
	for <dovecot@procontrol.fi>; Mon,  6 Jan 2003 01:48:03 +0200 (EET)
Received: (qmail 4226 invoked from network); 5 Jan 2003 23:46:27 -0000
Received: from unknown (HELO ?192.168.1.100?) (dave@127.0.0.1)
  by localhost with SMTP; 5 Jan 2003 23:46:27 -0000
Subject: [dovecot] Re: Some experiences
From: "David E. Storey" <dave@tamos.net>
To: dovecot@procontrol.fi
In-Reply-To: <20030105003032.475dc84b.amyzing@talsever.com>
References: <20030104234601.11360cfc.amyzing@talsever.com>
	 <3E17BD2C.9020906@attbi.com> <20030105003032.475dc84b.amyzing@talsever.com>
Content-Type: multipart/signed; micalg=pgp-sha1; protocol="application/pgp-signature"; boundary="=-IcXBB1OTlJnpl7zpPDh6"
Organization: tamos
Message-Id: <1041810481.13155.116.camel@localhost>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 05 Jan 2003 18:48:01 -0500
X-archive-position: 175
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: dave@tamos.net
Precedence: bulk
X-list: dovecot
X-UID: 175                                                  
Status: O
Content-Length: 4308


--=-IcXBB1OTlJnpl7zpPDh6
Content-Type: text/plain
Content-Transfer-Encoding: quoted-printable

On Sun, 2003-01-05 at 00:30, Amelia A.Lewis wrote:
> > Not to be confrontational at all, but I'm very curious as to why you=20
> > have such an aversion to SSL/TLS for IMAP access?  I think actualy an=20
> > entirely encrypted transport for something as (possibly sensitive)
> > email is a good thing.
>=20
> That's exactly why.
>=20
> TLS doesn't secure email.

=3D)

if email was secure, I wouldn't be spending a truly significant amount
of time dealing with spam.  But you're right in saying that TLS/SSL does
not create a truly end-to-end secure email solution. Then again, neither
does dovecot by itself. Nor should it. It should do one thing and do it
well.

While digest-md5 is fairly secure from a transport perspective, it's a
nightmare on the server side. In order for it to work, you've got to
store account passwords in plain text on the server. In my opinion, this
is "plain" wrong. (pun intended) Passwords should be hashed: even for
closed systems. The fallacy lies with the wetware and people tend to
forget passwords. Therefore, a lot of people have only one (or a set of)
password(s) for everything they do. You can lobby against it, but people
can be a hard species to change. If an attacker (or administrator)
gained access to the database that a system relied upon for
authentication (in the context of md5-digest), not only is that system's
(or application's) security compromised for every other user, but so are
many, many other systems that that user accesses. With hashed passwords,
my users don't have to trust me to be honest enough not to look, but I
can still reset their password.

TLS/SSL is merely a mechanism to provide privacy. In my case, I want my
PLAIN password to remain private across a transport session. As a side
note, most SSL/TLS sessions tend to use rc4 for their cipher. WEP uses
rc4 too. I'm not that familiar with the details of SSL/TLS (and I just
skimmed over RFC2246), so I might be talking out of the wrong hole, but
as far as I know, it doesn't renegotiate keys during long sessions like
IPsec or OpenVPN do. Think about that next time you spend all day with
an IMAP-over-SSL connection open, transferring megabyte after megabyte
of email around.

Personally, I just use stunnel to manage all my SSL connections. It
beats having to manage every other application's unique method for
handling SSL/TLS. I use PAM with pam_ldap to manage my logins. It just
allows for much greater flexibility than what most application
developers can bloat with their apps. (but it can also screw you up if
you're not careful.) Using LDAP has complicated things a little, but
that extra complexity has saved me BIG-TIME. (that whole idea of
replication... yeah, decentralizing your data can be VERY handy when
your system drive fails catastrophicly.)

What really ticked me off about Courier-imap is that it over-wrote my
pam-configs for imap every time I did a "make install".  I emailed Sam
about it and his take was that I shouldn't be installing the imap server
from source on a production box anyway. Now, I'm a from-source kinda
guy. Daniel J. Bernstein is a from-source kinda guy. Package management
has a high up-front cost and doesn't allow for the kind of customization
that I do on everything box that I have.... and RPM won't even compile
for me. (dpkg will and while I like the format and the design, I have
some issues with a lot of the code that has been written for it.)

I have a few production systems that handle email. Half run uw imap and
the other half, courier. dovecot seemed like a perfect solution for
converting to. It still has a couple deployment issues that I'm trying
to resolve, but I'll probably bring them up soon enough. (some of which
have already been addressed since my last attempt)

so anyway... first time poster, had to make my comments. Am I speaking
to the choir?
d!

--=-IcXBB1OTlJnpl7zpPDh6
Content-Type: application/pgp-signature; name=signature.asc
Content-Description: This is a digitally signed message part

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.0 (GNU/Linux)

iD8DBQA+GMQx+5sC2muyxOMRAnnKAJ976Bhh5j6aV24Lq6tFncmIKoLPvgCfYYu5
Sb0H6MiWQlOQB6i77CzPHe4=
=qwLM
-----END PGP SIGNATURE-----

--=-IcXBB1OTlJnpl7zpPDh6--


From amyzing@talsever.com  Mon Jan  6 02:00:52 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 06 Jan 2003 02:00:52 +0200 (EET)
Return-Path: <amyzing@talsever.com>
Delivered-To: dovecot@procontrol.fi
Received: from hall.mail.mindspring.net (hall.mail.mindspring.net [207.69.200.60])
	by danu.procontrol.fi (Postfix) with ESMTP id BA90D23839
	for <dovecot@procontrol.fi>; Mon,  6 Jan 2003 02:00:52 +0200 (EET)
Received: from user-2ivf46j.dialup.mindspring.com ([165.247.144.211] helo=marajen.talsever.com)
	by hall.mail.mindspring.net with esmtp (Exim 3.33 #1)
	id 18VKhH-0000VL-00; Sun, 05 Jan 2003 19:00:51 -0500
Received: by marajen.talsever.com (Postfix, from userid 1000)
	id F24238051; Sun,  5 Jan 2003 19:00:29 -0500 (EST)
Date: Sun, 5 Jan 2003 19:00:29 -0500
From: Amelia A.Lewis <amyzing@talsever.com>
To: "David E. Storey" <dave@tamos.net>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: Some experiences
Message-Id: <20030105190029.0c2ae046.amyzing@talsever.com>
In-Reply-To: <1041810481.13155.116.camel@localhost>
References: <20030104234601.11360cfc.amyzing@talsever.com>
	<3E17BD2C.9020906@attbi.com>
	<20030105003032.475dc84b.amyzing@talsever.com>
	<1041810481.13155.116.camel@localhost>
Organization: The Mysthical World of Talsever!
X-Mailer: Sylpheed version 0.8.5 (GTK+ 1.2.10; alpha-debian-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-archive-position: 176
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: amyzing@talsever.com
Precedence: bulk
X-list: dovecot
X-UID: 176                                                  
Status: O
Content-Length: 1119

On 05 Jan 2003 18:48:01 -0500 "David E. Storey" <dave@tamos.net> wrote:

> While digest-md5 is fairly secure from a transport perspective, it's a
> nightmare on the server side. In order for it to work, you've got to
> store account passwords in plain text on the server. In my opinion, this
> is "plain" wrong. (pun intended) Passwords should be hashed: even for
> closed systems. The fallacy lies with the wetware and people tend to

Umm, forgive me, but as I understand DIGEST-MD5, it does store hashed. 
Are you thinking of CRAM-MD5?  As far as I know, that requires
plain-text storage on the server, and I agree with your criticisms.  I
happen to like DIGEST-MD5 because it looks like someone finally came
along and got the SASL auth mechanism right.

But perhaps I'm the one that's mistaken.

Amy!
-- 
Amelia A. Lewis                    amyzing {at} talsever.com
Never imagine yourself not to be otherwise than what it might appear to
others that what you were or might have been was not otherwise than what
you had been would have appeared to them to be otherwise.
                -- The Duchess [Lewis Carroll]

From dave@tamos.net  Mon Jan  6 02:37:30 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 06 Jan 2003 02:37:30 +0200 (EET)
Return-Path: <dave@tamos.net>
Delivered-To: dovecot@procontrol.fi
Received: from grue.tamos.net (dsl093-083-029.wdc1.dsl.speakeasy.net [66.93.83.29])
	by danu.procontrol.fi (Postfix) with SMTP id 095D323839
	for <dovecot@procontrol.fi>; Mon,  6 Jan 2003 02:37:30 +0200 (EET)
Received: (qmail 4605 invoked from network); 6 Jan 2003 00:35:55 -0000
Received: from unknown (HELO ?192.168.1.100?) (dave@127.0.0.1)
  by localhost with SMTP; 6 Jan 2003 00:35:55 -0000
Subject: [dovecot] Re: Some experiences
From: "David E. Storey" <dave@tamos.net>
To: dovecot@procontrol.fi
In-Reply-To: <20030105190029.0c2ae046.amyzing@talsever.com>
References: <20030104234601.11360cfc.amyzing@talsever.com>
	 <3E17BD2C.9020906@attbi.com> <20030105003032.475dc84b.amyzing@talsever.com>
	 <1041810481.13155.116.camel@localhost>
	 <20030105190029.0c2ae046.amyzing@talsever.com>
Content-Type: multipart/signed; micalg=pgp-sha1; protocol="application/pgp-signature"; boundary="=-+lWSc3ZPo/hz0IJENUct"
Organization: tamos
Message-Id: <1041813449.26054.136.camel@localhost>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 05 Jan 2003 19:37:29 -0500
X-archive-position: 177
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: dave@tamos.net
Precedence: bulk
X-list: dovecot
X-UID: 177                                                  
Status: O
Content-Length: 2379


--=-+lWSc3ZPo/hz0IJENUct
Content-Type: text/plain
Content-Transfer-Encoding: quoted-printable

On Sun, 2003-01-05 at 19:00, Amelia A.Lewis wrote:
> Umm, forgive me, but as I understand DIGEST-MD5, it does store hashed.=20
> Are you thinking of CRAM-MD5?  As far as I know, that requires
> plain-text storage on the server, and I agree with your criticisms.  I
> happen to like DIGEST-MD5 because it looks like someone finally came
> along and got the SASL auth mechanism right.
>=20
> But perhaps I'm the one that's mistaken.

=3D) no, you're right in that it's stored hashed. I was thinking of
CRAM-MD5 specifically, but after reviewing section 3.9 of RFC2831, I'm
still thinking that DIGEST-MD5 isn't really for me.

What's hashed is the username + ":" + realm + ":" + password. This is
used to compute a part of the protocol. (referenced as A1) To quote the
RFC:

   There are two important security consequences of this. First the
   password file must be protected as if it contained plaintext
   passwords, because for the purpose of accessing documents in its
   realm, it effectively does.

   A second consequence of this is that the realm string should be
   unique among all realms that any single user is likely to use. In
   particular a realm string should include the name of the host doing
   the authentication.

To me, this means a few things: 1. You can no longer simply change a user's
name. 2) you can no longer simply change a host's name if you follow the RF=
C
and finally 3) you can't efficiently use digest-md5 in a distributed
authentication environment. (just doesn't scale well)

Since I deal with system-level accounts across multiple systems with=20
occasional username changes (such as when someone marries) and system
migrations where users and mail get shifted over to systems with different
names or domains, then digest-md5 looks more and more like the wrong
tools for the job.

Your requirements may be different, however and digest-md5 may be the
perfect solution. =3D)

d!

--=-+lWSc3ZPo/hz0IJENUct
Content-Type: application/pgp-signature; name=signature.asc
Content-Description: This is a digitally signed message part

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.0 (GNU/Linux)

iD8DBQA+GM/J+5sC2muyxOMRAggqAJ9aUwz+qpimpiVy7/cg9cNMcpVCUACfUaIT
vdP9kOY6Ti5ftObmAE5v6Xc=
=sOeL
-----END PGP SIGNATURE-----

--=-+lWSc3ZPo/hz0IJENUct--


From dave@tamos.net  Mon Jan  6 03:35:42 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 06 Jan 2003 03:35:42 +0200 (EET)
Return-Path: <dave@tamos.net>
Delivered-To: dovecot@procontrol.fi
Received: from grue.tamos.net (dsl093-083-029.wdc1.dsl.speakeasy.net [66.93.83.29])
	by danu.procontrol.fi (Postfix) with SMTP id BF8682382C
	for <dovecot@procontrol.fi>; Mon,  6 Jan 2003 03:35:41 +0200 (EET)
Received: (qmail 5061 invoked from network); 6 Jan 2003 01:34:06 -0000
Received: from unknown (HELO ?192.168.1.100?) (dave@127.0.0.1)
  by localhost with SMTP; 6 Jan 2003 01:34:06 -0000
Subject: [dovecot] wierdness with mailboxes
From: "David E. Storey" <dave@tamos.net>
To: dovecot@procontrol.fi
Content-Type: multipart/signed; micalg=pgp-sha1; protocol="application/pgp-signature"; boundary="=-Qf4/UfqMr+s8XcyLG0/T"
Organization: tamos
Message-Id: <1041816940.21963.10.camel@localhost>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 05 Jan 2003 20:35:40 -0500
X-archive-position: 178
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: dave@tamos.net
Precedence: bulk
X-list: dovecot
X-UID: 178                                                  
Status: O
Content-Length: 1459


--=-Qf4/UfqMr+s8XcyLG0/T
Content-Type: text/plain
Content-Transfer-Encoding: quoted-printable

Mail has always been the bane of my sys-admin life. I've been looking
long and hard for a small, C-based, simple IMAP server that worked well
with maildirs *and* mboxes and nothing else. wu-imap is so bloated and
rife with decrepit, cross-platform, insecure code that I avoid it for
any new servers. Courier-imap only supports maildirs but has some
wierdnesses that I've come to live with. dovecot promises to be exactly
what I'm looking for with just the right footprint and feature-set.

=3D)

I was surprised when I tried creating subfolders of mbox's. woohoo! The
only problem is that dovecot manages to rename the parent, appending a
'.'. So when we have:

folder

we now have:

folder.
folder.subfolder

Evolution freaks out and thinks it can't store folders in 'folder.' and
ends up with two subfolders: null and subfolder, which can contain
messages. If I rename the parent folder without the trailing '.',
everything works as expected. I'm trying to test some other imap clients
now.

d!

--=-Qf4/UfqMr+s8XcyLG0/T
Content-Type: application/pgp-signature; name=signature.asc
Content-Description: This is a digitally signed message part

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.0 (GNU/Linux)

iD8DBQA+GN1s+5sC2muyxOMRArpiAJ4rv5ThtK272HPenzDRXcrwfCKIlgCeIdpb
SU9ELo0GzYN7kMnjhziik1M=
=CIc0
-----END PGP SIGNATURE-----

--=-Qf4/UfqMr+s8XcyLG0/T--


From amyzing@talsever.com  Mon Jan  6 04:59:56 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 06 Jan 2003 04:59:56 +0200 (EET)
Return-Path: <amyzing@talsever.com>
Delivered-To: dovecot@procontrol.fi
Received: from barry.mail.mindspring.net (barry.mail.mindspring.net [207.69.200.25])
	by danu.procontrol.fi (Postfix) with ESMTP id DE3DD2382C
	for <dovecot@procontrol.fi>; Mon,  6 Jan 2003 04:59:55 +0200 (EET)
Received: from user-2ivf46j.dialup.mindspring.com ([165.247.144.211] helo=marajen.talsever.com)
	by barry.mail.mindspring.net with esmtp (Exim 3.33 #1)
	id 18VNUX-0007RV-00
	for dovecot@procontrol.fi; Sun, 05 Jan 2003 21:59:54 -0500
Received: by marajen.talsever.com (Postfix, from userid 1000)
	id 5B2428051; Sun,  5 Jan 2003 21:59:34 -0500 (EST)
Date: Sun, 5 Jan 2003 21:59:34 -0500
From: Amelia A.Lewis <amyzing@talsever.com>
To: dovecot <dovecot@procontrol.fi>
Subject: [dovecot] Weird problem on Alpha
Message-Id: <20030105215934.4ae8fd70.amyzing@talsever.com>
Organization: The Mysthical World of Talsever!
X-Mailer: Sylpheed version 0.8.5 (GTK+ 1.2.10; alpha-debian-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-archive-position: 179
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: amyzing@talsever.com
Precedence: bulk
X-list: dovecot
X-UID: 179                                                  
Status: O
Content-Length: 3098

Heyas ...

Hope you aren't tired of me already ....

I have a very strange problem, I think.  Having become happy-happy with
dovecot, I decided to install it on another machine that runs on an
internal network and provides mailboxes for system monitoring.

The setup is, or should be, quite straightforward.  TLS is disabled,
plaintext is not (I'll change this later, probably; this way is in
theory easier to debug).  Maildir; the MAIL environment variable is
correctly set.  Authentication via pam, for real users on the system,
auth_user root.  Pretty much as-distributed, except for disabling TLS.

On attempted login, the client hangs.  The following two messages appear
in syslog:

Jan  5 21:42:43 talifane imap-master: login: received another "not listening" notification
Jan  5 21:43:43 talifane imap-login: Disconnected: Inactivity [127.0.0.1]

Watching on lo via tcpdump, interesting things happen.  If I login with
the wrong password, the disconnect is quick (the message in syslog is
different, just "Disconnected [127.0.0.1]" from imap-login).  The server
responds to the a0001 LOGIN command with a0001 NO Authentication failed.
 That's as expected.  If I give the correct password, though, the server
never responds.  Note that the 'not listening' message appears sixty
seconds before the disconnection for inactivity message.  In tcpdump,
it's clear that the client never gets anything that would give it reason
to try another command.

So ... have I managed to pull a total bimbo and misconfigure?  Or is
this a problem with the Alpha platform?  I wanted to check before
reporting a bug, but this is kinda strange, since it's about the
simplest configuration that I can think of.  Suggestions (for testing,
or for fixing) would be welcome.  Is there a way to start the daemon in
a particularly verbose mode?  In case it's useful, here's what the
debian reportbug system generates for dependencies and stuff (0.99.5-1):

-- System Information:
Debian Release: testing/unstable
Architecture: alpha
Kernel: Linux talifane 2.4.19 #1 Sat Aug 3 10:33:38 EDT 2002 alpha
Locale: LANG=en_US, LC_CTYPE=en_US

Versions of packages dovecot depends on:
ii  libc6.1                       2.3.1-9    GNU C Library: Shared libraries an
ii  libgcrypt1                    1.1.10-2   LGPL Crypto library - runtime libr
ii  libgnutls5                    0.6.0-2    GNU TLS library - runtime library
ii  libpam0g                      0.76-9     Pluggable Authentication Modules l
ii  libtasn1-0                    0.1.2-1    Manage ASN.1 structures (runtime)
ii  openssl                       0.9.6g-10  Secure Socket Layer (SSL) binary a
ii  zlib1g                        1:1.1.4-8  compression library - runtime

It's specifically a PC164LX/533, 512MB RAM.

Thanks for reading.

Amy!
-- 
Amelia A. Lewis                    amyzing {at} talsever.com
You like the taste of danger, it shines like sugar on your lips,
and you like to stand in the line of fire
just to show you can shoot straight from your hip.
There must be a 1000 things you would die for; 
I can hardly think of two.
		-- Emily Saliers

From tss@iki.fi  Mon Jan  6 12:54:09 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 06 Jan 2003 12:54:09 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 6107223839
	for <dovecot@procontrol.fi>; Mon,  6 Jan 2003 12:54:09 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 297335E01F96; Mon,  6 Jan 2003 12:54:04 +0200 (EET)
Subject: [dovecot] Re: Some experiences
From: Timo Sirainen <tss@iki.fi>
To: "Paul C. Bryan" <email@pbryan.net>
Cc: dovecot@procontrol.fi
In-Reply-To: <3E18BC80.4050209@pbryan.net>
References: <20030104234601.11360cfc.amyzing@talsever.com>
	 <1041759144.6219.26.camel@hurina>  <3E18892F.1010700@pbryan.net>
	 <1041798785.6218.36.camel@hurina>  <3E18BC80.4050209@pbryan.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1041850443.6217.42.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 06 Jan 2003 12:54:04 +0200
X-archive-position: 180
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 180                                                  
Status: O

On Mon, 2003-01-06 at 01:15, Paul C. Bryan wrote:
> > And secure? I doubt it, I did a quick audit to it a month ago and found
> > 3 buffer overflows. I checked mostly just PLAIN mechanism which I use
> > with Postfix, so there may well be more left in other auth mechanisms.
> 
> Was this version 1 or version 2?

2. 1.5.x didn't have the same problems, because it didn't even have
those features (or two of them).


From tss@iki.fi  Mon Jan  6 13:22:44 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 06 Jan 2003 13:22:44 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id DC8462382C
	for <dovecot@procontrol.fi>; Mon,  6 Jan 2003 13:22:44 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id B47B55E01F96; Mon,  6 Jan 2003 13:22:44 +0200 (EET)
Subject: [dovecot] Re: wierdness with mailboxes
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <1041816940.21963.10.camel@localhost>
References: <1041816940.21963.10.camel@localhost>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1041852164.16978.16.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 06 Jan 2003 13:22:44 +0200
X-archive-position: 181
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 181                                                  
Status: O

On Mon, 2003-01-06 at 03:35, David E. Storey wrote:
> I was surprised when I tried creating subfolders of mbox's. woohoo! The
> only problem is that dovecot manages to rename the parent, appending a
> '.'. So when we have:
> 
> folder
> 
> we now have:
> 
> folder.
> folder.subfolder

Huh? This doesn't really make any sense to me :) mboxes use '/' as
hierarchy separator, and I couldn't create subfolders to mboxes with
evolution in any way. With maildir I didn't see any problems.


From tss@iki.fi  Mon Jan  6 13:38:38 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 06 Jan 2003 13:38:38 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 5B6252382C
	for <dovecot@procontrol.fi>; Mon,  6 Jan 2003 13:38:38 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 80C6D5E01F96; Mon,  6 Jan 2003 13:38:37 +0200 (EET)
Subject: [dovecot] Re: Weird problem on Alpha
From: Timo Sirainen <tss@iki.fi>
To: "Amelia A.Lewis" <amyzing@talsever.com>
Cc: dovecot <dovecot@procontrol.fi>
In-Reply-To: <20030105215934.4ae8fd70.amyzing@talsever.com>
References: <20030105215934.4ae8fd70.amyzing@talsever.com>
Content-Type: multipart/mixed; boundary="=-fNn5MgtxeZhEmaeqR3VT"
Organization: 
Message-Id: <1041853117.18769.33.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 06 Jan 2003 13:38:37 +0200
X-archive-position: 182
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 182                                                  
Status: O
Content-Length: 4077


--=-fNn5MgtxeZhEmaeqR3VT
Content-Type: text/plain
Content-Transfer-Encoding: 7bit

On Mon, 2003-01-06 at 04:59, Amelia A.Lewis wrote:
> Jan  5 21:42:43 talifane imap-master: login: received another "not listening" notification

> So ... have I managed to pull a total bimbo and misconfigure?  Or is
> this a problem with the Alpha platform?

src/lib/fdpass.c is most likely the problem. Hmm. Try if the attached
version works?

> Is there a way to start the daemon in a particularly verbose mode?

I think I should do this some day :) At least with authentication it's
much easier to find out the problem if there was a reason in log why it
failed.


--=-fNn5MgtxeZhEmaeqR3VT
Content-Disposition: attachment; filename=fdpass.c
Content-Type: text/x-c; name=fdpass.c; charset=ISO-8859-15
Content-Transfer-Encoding: quoted-printable

/*
 fdpass.c - FD passing

    Copyright (c) 2002 Timo Sirainen

    Permission is hereby granted, free of charge, to any person obtaining
    a copy of this software and associated documentation files (the
    "Software"), to deal in the Software without restriction, including
    without limitation the rights to use, copy, modify, merge, publish,
    distribute, sublicense, and/or sell copies of the Software, and to
    permit persons to whom the Software is furnished to do so, subject to
    the following conditions:

    The above copyright notice and this permission notice shall be
    included in all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
    OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
    MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
    IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
    CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
    TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
    SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/

#define _XPG4_2

#include "lib.h"
#include "fdpass.h"

#include <sys/socket.h>
#include <sys/un.h>
#include <sys/uio.h>

#ifndef CMSG_SPACE
#  define CMSG_ALIGN(len) \
	(((len) + sizeof(size_t) - 1) & ~(sizeof(size_t) - 1))
#  define CMSG_SPACE(len) \
	(CMSG_ALIGN(len) + CMSG_ALIGN(sizeof(struct cmsghdr)))
#  define CMSG_LEN(len) \
	(CMSG_ALIGN(sizeof(struct cmsghdr)) + (len))
#endif

ssize_t fd_send(int handle, int send_fd, const void *data, size_t size)
{
        struct msghdr msg;
        struct iovec iov;
        struct cmsghdr *cmsg;
	char buf[CMSG_SPACE(sizeof(int))];

	/* at least one byte is required to be sent with fd passing */
	i_assert(size > 0 && size < SSIZE_T_MAX);

	memset(&msg, 0, sizeof (struct msghdr));

        iov.iov_base =3D (void *) data;
        iov.iov_len =3D size;

        msg.msg_iov =3D &iov;
	msg.msg_iovlen =3D 1;

	if (send_fd !=3D -1) {
		/* set the control and controllen before CMSG_FIRSTHDR() */
		msg.msg_control =3D buf;
		msg.msg_controllen =3D sizeof(buf);

		cmsg =3D CMSG_FIRSTHDR(&msg);
		cmsg->cmsg_level =3D SOL_SOCKET;
		cmsg->cmsg_type =3D SCM_RIGHTS;
		cmsg->cmsg_len =3D CMSG_LEN(sizeof(int));
		*((int *) CMSG_DATA(cmsg)) =3D send_fd;

		/* set the real length we want to use. it's different than
		   sizeof(buf) in 64bit systems. */
		msg.msg_controllen =3D cmsg->cmsg_len;
	}

	return sendmsg(handle, &msg, 0);
}

ssize_t fd_read(int handle, void *data, size_t size, int *fd)
{
	struct msghdr msg;
	struct iovec iov;
	struct cmsghdr *cmsg;
	ssize_t ret;
	char buf[CMSG_SPACE(sizeof(int))];

	i_assert(size > 0 && size < SSIZE_T_MAX);

	memset(&msg, 0, sizeof (struct msghdr));

	iov.iov_base =3D data;
	iov.iov_len =3D size;

	msg.msg_iov =3D &iov;
	msg.msg_iovlen =3D 1;

	msg.msg_control =3D buf;
	msg.msg_controllen =3D sizeof(buf);

	ret =3D recvmsg(handle, &msg, 0);
	if (ret <=3D 0)
		return ret;

	/* at least one byte transferred - we should have the fd now */
	cmsg =3D CMSG_FIRSTHDR(&msg);
	if (cmsg =3D=3D NULL)
		*fd =3D -1;
	else
		*fd =3D *((int *) CMSG_DATA(cmsg));
	return ret;
}

--=-fNn5MgtxeZhEmaeqR3VT--

From bradf@mailgate.tpi.com  Mon Jan  6 19:03:41 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 06 Jan 2003 19:03:41 +0200 (EET)
Return-Path: <bradf@mailgate.tpi.com>
Delivered-To: dovecot@procontrol.fi
Received: from mailgate.tpi.com (ftp.tpi.com [198.107.51.136])
	by danu.procontrol.fi (Postfix) with ESMTP id 7D9492382C
	for <dovecot@procontrol.fi>; Mon,  6 Jan 2003 19:03:40 +0200 (EET)
Received: from fire ([198.107.51.42]) by mailgate.tpi.com
          (Post.Office MTA v3.5.3 release 223 ID# 0-60229U100L100S0V35)
          with ESMTP id com for <dovecot@procontrol.fi>;
          Mon, 6 Jan 2003 09:03:36 -0800
Content-Type: text/plain;
  charset="us-ascii"
From: Brad Figg <brad@tpi.com>
Reply-To: brad@tpi.com
To: dovecot@procontrol.fi
Subject: [dovecot] Assert in imap-bodystructure.c
Date: Mon, 6 Jan 2003 09:03:32 -0800
User-Agent: KMail/1.4.3
MIME-Version: 1.0
Content-Transfer-Encoding: quoted-printable
Message-Id: <200301060903.32380.brad@tpi.com>
X-archive-position: 183
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: brad@tpi.com
Precedence: bulk
X-list: dovecot
X-UID: 183                                                  
Status: O
Content-Length: 1446


First let me thank you for my initial newby question about poping
from a pop3 server and delivering into my Dovecot maildir folders.

Now I'm getting an assertion in imap-bodystructure.c and one of=20
my imap folders is now inaccessable. I think the two are related.
Whenever I select the folder from my email client (kmail) I get
two log entries in the dovecot log of the format:
    "imap-master: <date>Error: child <pid> (imap) killed with signal 6"

Also in the log are several lines with an assertion failure. I've include=
d
a portion of the log below.

I am running dovecot 0.99.5.

Thanks,
Brad

-------------------------------------------------------------------------=
---------------------
imap-master: Jan 06 08:38:44Error: child 22222 (imap) killed with signal =
6
imap(brad): Jan 06 08:46:28Panic: file imap-bodystructure.c: line 346=20
(part_write_body): assertion failed: (part->children->next =3D=3D NULL)
imap-master: Jan 06 08:46:28Error: child 22262 (imap) killed with signal =
6
imap(brad): Jan 06 08:53:01Panic: file imap-bodystructure.c: line 346=20
(part_write_body): assertion failed: (part->children->next =3D=3D NULL)
imap(brad): Jan 06 08:53:01Panic: file imap-bodystructure.c: line 346=20
(part_write_body): assertion failed: (part->children->next =3D=3D NULL)
imap-master: Jan 06 08:53:01Error: child 22273 (imap) killed with signal =
6
imap-master: Jan 06 08:53:01Error: child 22270 (imap) killed with signal =
6


From tss@iki.fi  Mon Jan  6 19:40:24 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 06 Jan 2003 19:40:24 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 30D462382C
	for <dovecot@procontrol.fi>; Mon,  6 Jan 2003 19:40:24 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 89B9E5E01F96; Mon,  6 Jan 2003 19:40:23 +0200 (EET)
Subject: [dovecot] Re: Assert in imap-bodystructure.c
From: Timo Sirainen <tss@iki.fi>
To: brad@tpi.com
Cc: dovecot@procontrol.fi
In-Reply-To: <200301060903.32380.brad@tpi.com>
References: <200301060903.32380.brad@tpi.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1041874822.18760.49.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 06 Jan 2003 19:40:23 +0200
X-archive-position: 184
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 184                                                  
Status: O

On Mon, 2003-01-06 at 19:03, Brad Figg wrote:
> imap(brad): Jan 06 08:46:28Panic: file imap-bodystructure.c: line 346 
> (part_write_body): assertion failed: (part->children->next == NULL)

Annoying, you're the second person now who sees this. Is this Linux/x86
system? Maildir?

Would it be possible for you to send me that mail folder's indexes? They
contain some headers of the mails (from, to, subject, ..) and are
located in ~/Maildir/.folder/.imap.index* or
~/mail/.imap/folder/.imap.index*. I didn't find any obvious reason for
this problem last I looked, so getting those indexes would help to find
why they're corrupted.

Anyway, fixing this would most likely work by just deleting those index
files. If that didn't help either, it's some mail in there that Dovecot
doesn't like for some reason.


From tss@iki.fi  Mon Jan  6 21:46:16 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 06 Jan 2003 21:46:16 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 89ABE2382C
	for <dovecot@procontrol.fi>; Mon,  6 Jan 2003 21:46:16 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id E731C5E01F96; Mon,  6 Jan 2003 21:46:15 +0200 (EET)
Subject: [dovecot] Re: Assert in imap-bodystructure.c
From: Timo Sirainen <tss@iki.fi>
To: brad@tpi.com
Cc: dovecot@procontrol.fi
In-Reply-To: <1041874822.18760.49.camel@hurina>
References: <200301060903.32380.brad@tpi.com>
	 <1041874822.18760.49.camel@hurina>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1041882375.18760.77.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 06 Jan 2003 21:46:15 +0200
X-archive-position: 185
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 185                                                  
Status: O
Content-Length: 1055

On Mon, 2003-01-06 at 19:40, Timo Sirainen wrote:
> On Mon, 2003-01-06 at 19:03, Brad Figg wrote:
> > imap(brad): Jan 06 08:46:28Panic: file imap-bodystructure.c: line 346 
> > (part_write_body): assertion failed: (part->children->next == NULL)
> 
> Annoying, you're the second person now who sees this. Is this Linux/x86
> system? Maildir?

OK, I think I've fixed it now. Some data was saved incorrectly to index
files for messages with attachments. This showed up mostly with BODY and
BODYSTRUCTURE fetches giving incorrect replies or crashing with messages
that had multiple nested MIME parts.

I never saw this since Dovecot starts caching the BODY data to index
files after the client has issued BODY query a couple of times. After
that there was no problems with them, so this happened mostly with new
users.

Also I fixed this properly now, instead of crashing at such invalid data
in indexes we'll print a nice error message to log file and the indexes
will be rebuilt.

So, "strange bug" count again at zero. Maybe time for a new release
soon..


From bradf@mailgate.tpi.com  Mon Jan  6 22:19:54 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 06 Jan 2003 22:19:54 +0200 (EET)
Return-Path: <bradf@mailgate.tpi.com>
Delivered-To: dovecot@procontrol.fi
Received: from mailgate.tpi.com (ftp.tpi.com [198.107.51.136])
	by danu.procontrol.fi (Postfix) with ESMTP id 871DA23839
	for <dovecot@procontrol.fi>; Mon,  6 Jan 2003 22:19:53 +0200 (EET)
Received: from fire ([198.107.51.42]) by mailgate.tpi.com
          (Post.Office MTA v3.5.3 release 223 ID# 0-60229U100L100S0V35)
          with ESMTP id com; Mon, 6 Jan 2003 12:19:50 -0800
Content-Type: text/plain;
  charset="iso-8859-1"
From: Brad Figg <brad@tpi.com>
Reply-To: brad@tpi.com
To: Timo Sirainen <tss@iki.fi>
Subject: [dovecot] Re: Assert in imap-bodystructure.c
Date: Mon, 6 Jan 2003 12:19:32 -0800
User-Agent: KMail/1.4.3
References: <200301060903.32380.brad@tpi.com> <1041874822.18760.49.camel@hurina>
In-Reply-To: <1041874822.18760.49.camel@hurina>
Cc: dovecot@procontrol.fi
MIME-Version: 1.0
Content-Transfer-Encoding: quoted-printable
Message-Id: <200301061219.32732.brad@tpi.com>
X-archive-position: 186
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: brad@tpi.com
Precedence: bulk
X-list: dovecot
X-UID: 186                                                  
Status: O
Content-Length: 1414

On Monday 06 January 2003 09:40 am, you wrote:
> On Mon, 2003-01-06 at 19:03, Brad Figg wrote:
> > imap(brad): Jan 06 08:46:28Panic: file imap-bodystructure.c: line 346
> > (part_write_body): assertion failed: (part->children->next =3D=3D NUL=
L)
>
> Annoying, you're the second person now who sees this. Is this Linux/x86
> system? Maildir?
>
> Would it be possible for you to send me that mail folder's indexes? The=
y
> contain some headers of the mails (from, to, subject, ..) and are
> located in ~/Maildir/.folder/.imap.index* or
> ~/mail/.imap/folder/.imap.index*. I didn't find any obvious reason for
> this problem last I looked, so getting those indexes would help to find
> why they're corrupted.
>
> Anyway, fixing this would most likely work by just deleting those index
> files. If that didn't help either, it's some mail in there that Dovecot
> doesn't like for some reason.

I removed the .imap.index* files. I can now see most of the email in that=
 folder. The
email that I can see are messages that I moved via drag-n-drop from my em=
ail
client. The messages that I can't see are ones that procmail put in the f=
older. There
is a difference in the message name format between the two. Messages
that I can see are named like "1041543929.7991_300.norbert:2,S". The ones
I can not see are named like "1041620504.14350.norbert:2,S". Any ideas
why this is happening and how I fix it?

Thanks,
Brad

From bradf@mailgate.tpi.com  Mon Jan  6 22:25:33 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 06 Jan 2003 22:25:33 +0200 (EET)
Return-Path: <bradf@mailgate.tpi.com>
Delivered-To: dovecot@procontrol.fi
Received: from mailgate.tpi.com (ftp.tpi.com [198.107.51.136])
	by danu.procontrol.fi (Postfix) with ESMTP id E886423839
	for <dovecot@procontrol.fi>; Mon,  6 Jan 2003 22:25:30 +0200 (EET)
Received: from fire ([198.107.51.42]) by mailgate.tpi.com
          (Post.Office MTA v3.5.3 release 223 ID# 0-60229U100L100S0V35)
          with ESMTP id com; Mon, 6 Jan 2003 12:25:30 -0800
Content-Type: text/plain;
  charset="iso-8859-1"
From: Brad Figg <brad@tpi.com>
Reply-To: brad@tpi.com
To: Timo Sirainen <tss@iki.fi>
Subject: [dovecot] Re: Assert in imap-bodystructure.c
Date: Mon, 6 Jan 2003 12:25:12 -0800
User-Agent: KMail/1.4.3
Cc: dovecot@procontrol.fi
References: <200301060903.32380.brad@tpi.com> <1041874822.18760.49.camel@hurina> <200301061219.32732.brad@tpi.com>
In-Reply-To: <200301061219.32732.brad@tpi.com>
MIME-Version: 1.0
Content-Transfer-Encoding: quoted-printable
Message-Id: <200301061225.12293.brad@tpi.com>
X-archive-position: 187
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: brad@tpi.com
Precedence: bulk
X-list: dovecot
X-UID: 187                                                  
Status: O
Content-Length: 1910

On Monday 06 January 2003 12:19 pm, Brad Figg wrote:
> On Monday 06 January 2003 09:40 am, you wrote:
> > On Mon, 2003-01-06 at 19:03, Brad Figg wrote:
> > > imap(brad): Jan 06 08:46:28Panic: file imap-bodystructure.c: line 3=
46
> > > (part_write_body): assertion failed: (part->children->next =3D=3D N=
ULL)
> >
> > Annoying, you're the second person now who sees this. Is this Linux/x=
86
> > system? Maildir?
> >
> > Would it be possible for you to send me that mail folder's indexes? T=
hey
> > contain some headers of the mails (from, to, subject, ..) and are
> > located in ~/Maildir/.folder/.imap.index* or
> > ~/mail/.imap/folder/.imap.index*. I didn't find any obvious reason fo=
r
> > this problem last I looked, so getting those indexes would help to fi=
nd
> > why they're corrupted.
> >
> > Anyway, fixing this would most likely work by just deleting those ind=
ex
> > files. If that didn't help either, it's some mail in there that Dovec=
ot
> > doesn't like for some reason.
>
> I removed the .imap.index* files. I can now see most of the email in th=
at
> folder. The email that I can see are messages that I moved via drag-n-d=
rop
> from my email client. The messages that I can't see are ones that procm=
ail
> put in the folder. There is a difference in the message name format bet=
ween
> the two. Messages that I can see are named like
> "1041543929.7991_300.norbert:2,S". The ones I can not see are named lik=
e
> "1041620504.14350.norbert:2,S". Any ideas why this is happening and how=
 I
> fix it?
>

I should have pointed out that I have other folders that have messages
that were put in via drag-n-drop and via procmail and I can see all of th=
em.
And that before the folder just quit working I could see all of the email=
 in
the folder that I removed the index files from. It's like the indexes did=
n't=20
handle all of the messages in the folder correctly.

Thanks again,
Brad

From tss@iki.fi  Mon Jan  6 22:29:04 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 06 Jan 2003 22:29:04 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 1290023839
	for <dovecot@procontrol.fi>; Mon,  6 Jan 2003 22:29:04 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 73BC55E01F96; Mon,  6 Jan 2003 22:29:03 +0200 (EET)
Subject: [dovecot] Re: Assert in imap-bodystructure.c
From: Timo Sirainen <tss@iki.fi>
To: brad@tpi.com
Cc: dovecot@procontrol.fi
In-Reply-To: <200301061219.32732.brad@tpi.com>
References: <200301060903.32380.brad@tpi.com>
	 <1041874822.18760.49.camel@hurina>  <200301061219.32732.brad@tpi.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1041884943.28650.4.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 06 Jan 2003 22:29:03 +0200
X-archive-position: 188
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 188                                                  
Status: O

On Mon, 2003-01-06 at 22:19, Brad Figg wrote:
> I removed the .imap.index* files. I can now see most of the email in that folder. The
> email that I can see are messages that I moved via drag-n-drop from my email
> client. The messages that I can't see are ones that procmail put in the folder. There
> is a difference in the message name format between the two. Messages
> that I can see are named like "1041543929.7991_300.norbert:2,S". The ones
> I can not see are named like "1041620504.14350.norbert:2,S". Any ideas
> why this is happening and how I fix it?

File names don't matter to Dovecot at all, so it's not that. Are file
permissions correct? Do you see anything in log files? Maybe your email
client is caching the messages incorrectly and just doesn't want to see
the other mails? If there's nothing in logs, I'd blame the client then.
You could verify it by talking directly to dovecot:

x login user pass
x select inbox
x fetch 1:* envelope


From tss@iki.fi  Mon Jan  6 22:36:16 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 06 Jan 2003 22:36:16 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id A207B23837
	for <dovecot@procontrol.fi>; Mon,  6 Jan 2003 22:36:16 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 7120E5E01F96; Mon,  6 Jan 2003 22:36:16 +0200 (EET)
Subject: [dovecot] 0.99.6rc1 released
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1041885376.28651.13.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 06 Jan 2003 22:36:16 +0200
X-archive-position: 189
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 189                                                  
Status: O

Again rc, just in case I broke something. Or maybe I should just start
creating nightly CVS snapshots. Anyway, fixes the few bugs people have
reported lately:

	- Mails with nested MIME parts might have caused incorrect BODY and
	  BODYSTRUCTURE fetches and sometimes might have crashed dovecot
	  (assert at imap-bodystructure.c). If client had already successfully
	  done the BODY fetching a couple of times, the bug couldn't happen
	  anymore since Dovecot then began caching the BODY data. So, this
	  mostly happened with new users.
	- If authentication was aborted by client ("*" reply to AUTHENTICATE),
	  the login process crashed later.
	- Digest-MD5: We used "qop-options" instead of "qop", which was
	  incompatible with at least Cyrus SASL.
	- We didn't work with some 64bit systems
	- Realms in passwd-file were buggy
	* Some coding style changes (less typedefs)


From bradf@mailgate.tpi.com  Tue Jan  7 00:18:58 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 07 Jan 2003 00:18:58 +0200 (EET)
Return-Path: <bradf@mailgate.tpi.com>
Delivered-To: dovecot@procontrol.fi
Received: from mailgate.tpi.com (ftp.tpi.com [198.107.51.136])
	by danu.procontrol.fi (Postfix) with ESMTP id 1008423837
	for <dovecot@procontrol.fi>; Tue,  7 Jan 2003 00:18:58 +0200 (EET)
Received: from fire ([198.107.51.42]) by mailgate.tpi.com
          (Post.Office MTA v3.5.3 release 223 ID# 0-60229U100L100S0V35)
          with ESMTP id com; Mon, 6 Jan 2003 14:18:56 -0800
Content-Type: text/plain;
  charset="iso-8859-1"
From: Brad Figg <brad@tpi.com>
Reply-To: brad@tpi.com
To: Timo Sirainen <tss@iki.fi>, dovecot@procontrol.fi
Subject: [dovecot] Re: 0.99.6rc1 released
Date: Mon, 6 Jan 2003 14:18:31 -0800
User-Agent: KMail/1.4.3
References: <1041885376.28651.13.camel@hurina>
In-Reply-To: <1041885376.28651.13.camel@hurina>
MIME-Version: 1.0
Content-Transfer-Encoding: quoted-printable
Message-Id: <200301061418.31353.brad@tpi.com>
X-archive-position: 190
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: brad@tpi.com
Precedence: bulk
X-list: dovecot
X-UID: 190                                                  
Status: O
Content-Length: 1059

On Monday 06 January 2003 12:36 pm, Timo Sirainen wrote:
> Again rc, just in case I broke something. Or maybe I should just start
> creating nightly CVS snapshots. Anyway, fixes the few bugs people have
> reported lately:
>
> =09- Mails with nested MIME parts might have caused incorrect BODY and
> =09  BODYSTRUCTURE fetches and sometimes might have crashed dovecot
> =09  (assert at imap-bodystructure.c). If client had already successful=
ly
> =09  done the BODY fetching a couple of times, the bug couldn't happen
> =09  anymore since Dovecot then began caching the BODY data. So, this
> =09  mostly happened with new users.
> =09- If authentication was aborted by client ("*" reply to AUTHENTICATE=
),
> =09  the login process crashed later.
> =09- Digest-MD5: We used "qop-options" instead of "qop", which was
> =09  incompatible with at least Cyrus SASL.
> =09- We didn't work with some 64bit systems
> =09- Realms in passwd-file were buggy
> =09* Some coding style changes (less typedefs)

The file auth-mech-desc.h is missing from the release.

Brad

From tss@iki.fi  Tue Jan  7 01:32:34 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 07 Jan 2003 01:32:34 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 9632F2382C
	for <dovecot@procontrol.fi>; Tue,  7 Jan 2003 01:32:34 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id F13E75E01F96; Tue,  7 Jan 2003 01:32:33 +0200 (EET)
Subject: [dovecot] 0.99.6rc2 released
From: Timo Sirainen <tss@iki.fi>
To: brad@tpi.com
Cc: dovecot@procontrol.fi
In-Reply-To: <200301061418.31353.brad@tpi.com>
References: <1041885376.28651.13.camel@hurina>
	 <200301061418.31353.brad@tpi.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1041895953.28652.18.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 07 Jan 2003 01:32:33 +0200
X-archive-position: 191
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 191                                                  
Status: O

On Tue, 2003-01-07 at 00:18, Brad Figg wrote:
> The file auth-mech-desc.h is missing from the release.

Duh. rc2 out. This time I tested that it actually compiles :)


From tss@iki.fi  Wed Jan  8 12:47:52 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 08 Jan 2003 12:47:52 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 5AA4423837
	for <dovecot@procontrol.fi>; Wed,  8 Jan 2003 12:47:52 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id E33D85E01F60; Wed,  8 Jan 2003 12:47:51 +0200 (EET)
Subject: [dovecot] Logging suggestions?
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1042022871.28651.93.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 08 Jan 2003 12:47:51 +0200
X-archive-position: 192
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 192                                                  
Status: O

Any suggestions how user login/logouts should look like in log files? I
was thinking:

(connected to imaps port)
Login: username [IP 1.2.3.4, imaps, compressed]
Logout: username [IP 1.2.3.4, imaps, compressed] [1000/100000 bytes (50%), 00:00:12]

Bytes being upload/download and the 50% meaning compression ratio for
downloaded bytes, probably not worth it for upload. Or if uncompressed,
it'd show the extra space used by SSL/TLS protocol:

(using STARTTLS)
Login: username [IP 1.2.3.4, TLS]
Logout: username [IP 1.2.3.4, TLS] [2020/202000 bytes (101%), 00:00:12]

(no SSL)
Login: username [IP 1.2.3.4]
Logout: username [IP 1.2.3.4] [2000/200000 bytes, 00:00:12]

I think the only configuration needed would be if to log login, logout
or both.

From tss@iki.fi  Wed Jan  8 12:56:56 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 08 Jan 2003 12:56:56 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 7408023837
	for <dovecot@procontrol.fi>; Wed,  8 Jan 2003 12:56:56 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 214DA5E01F60; Wed,  8 Jan 2003 12:56:56 +0200 (EET)
Subject: [dovecot] Re: Logging suggestions?
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <1042022871.28651.93.camel@hurina>
References: <1042022871.28651.93.camel@hurina>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1042023415.28652.96.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 08 Jan 2003 12:56:56 +0200
X-archive-position: 193
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 193                                                  
Status: O

On Wed, 2003-01-08 at 12:47, Timo Sirainen wrote:
> Bytes being upload/download and the 50% meaning compression ratio for
> downloaded bytes, probably not worth it for upload. Or if uncompressed,
> it'd show the extra space used by SSL/TLS protocol:

Or not. I remembered the SSL code worked a bit differently, so I don't
think there is any simple way to find out the compression ratio or SSL
overhead.


From dgc@uchicago.edu  Wed Jan  8 19:50:20 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 08 Jan 2003 19:50:20 +0200 (EET)
Return-Path: <dgc@uchicago.edu>
Delivered-To: dovecot@procontrol.fi
Received: from dust.uchicago.edu (dust.uchicago.edu [128.135.0.35])
	by danu.procontrol.fi (Postfix) with ESMTP id 817032382C
	for <dovecot@procontrol.fi>; Wed,  8 Jan 2003 19:50:19 +0200 (EET)
Received: (from dgc@localhost)
	by dust.uchicago.edu (8.11.6/8.11.6) id h08Ho6u28505;
	Wed, 8 Jan 2003 11:50:06 -0600 (CST)
X-Authentication-Warning: dust.uchicago.edu: dgc set sender to dgc@uchicago.edu using -f
Date: Wed, 8 Jan 2003 11:50:06 -0600
From: David Champion <dgc@uchicago.edu>
To: Timo Sirainen <tss@iki.fi>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: Logging suggestions?
Message-ID: <20030108175006.GB27418@dust.uchicago.edu>
Mail-Followup-To: Timo Sirainen <tss@iki.fi>, dovecot@procontrol.fi
References: <1042022871.28651.93.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1042022871.28651.93.camel@hurina>
User-Agent: Mutt/1.5.2i
X-archive-position: 194
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: dgc@uchicago.edu
Precedence: bulk
X-list: dovecot
X-UID: 194                                                  
Status: O
Content-Length: 2361

* On 2003.01.08, in <1042022871.28651.93.camel@hurina>,
*	"Timo Sirainen" <tss@iki.fi> wrote:
> Any suggestions how user login/logouts should look like in log files? I
> was thinking:
> 
> (connected to imaps port)
> Login: username [IP 1.2.3.4, imaps, compressed]
> Logout: username [IP 1.2.3.4, imaps, compressed] [1000/100000 bytes (50%), 00:00:12]

I like things that are easy to parse with shell and awk scripts. E.g.:

Login: username 1.2.3.4:1025 5.6.7.8:143 imaps,compressed
Logout: username 1.2.3.4:1025 5.6.7.8:143 imaps,compressed in:1000 out:1000000 [whatever SSL summary data is available]

I like seeing both the source and destination sockaddrs. (Why not run
two instances on different interfaces?) In fact, I like seeing both
hostname and ip address, and an indicator if a reverse map doesn't
match, but that's probably just me.

In this example, flags occupy one space-delimited field, and are
separated by commas. It's useful for performance analysis to tally
bytes transferred; this is what "in:" and "out:" are for. It would also
be nice for perf. anal. to know how much I/O to storage (disk) was
performed by the imap process, but I don't imagine those figures are
presently available anyway.

That's just an illustration; it doesn't matter to me whether it's like
that particularly. I just want to show what I mean by ease of parsing
-- whitespace-separated fields, well-known field values, related flags
and such compounded within fields. The whole line structure should be
well-known and not require perl or sscanf()s or such; scripts should be
able to extract a lot of data from these quickly.

(We're watching dovecot for possible use on a system that supports about
300,000 logins per day, and we want to be able to produce stats on
that.)


> I think the only configuration needed would be if to log login, logout
> or both.

That's generous. :) I'd always want both, and can't imagine not wanting
both, but I suppose some might prefer less.

I actually wouldn't mind seeing more optional logs -- for example,
logout-like summaries for folder accesses (when users change folders).
This can help in balancing storage devices when folders can reside on
multiple devices.

In an ideal world, everything would be loggable, but not everything
would be logged.

-- 
 -D.	dgc@uchicago.edu	NSIT	University of Chicago
 We're the colon in ://

From amyzing@talsever.com  Wed Jan  8 20:12:03 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 08 Jan 2003 20:12:03 +0200 (EET)
Return-Path: <amyzing@talsever.com>
Delivered-To: dovecot@procontrol.fi
Received: from maynard.mail.mindspring.net (maynard.mail.mindspring.net [207.69.200.243])
	by danu.procontrol.fi (Postfix) with ESMTP id 6F80323837
	for <dovecot@procontrol.fi>; Wed,  8 Jan 2003 20:12:03 +0200 (EET)
Received: from user-2ivf46j.dialup.mindspring.com ([165.247.144.211] helo=marajen.talsever.com)
	by maynard.mail.mindspring.net with esmtp (Exim 3.33 #1)
	id 18WKgJ-0007i6-00; Wed, 08 Jan 2003 13:11:59 -0500
Received: by marajen.talsever.com (Postfix, from userid 1000)
	id 364978151; Wed,  8 Jan 2003 13:11:43 -0500 (EST)
Date: Wed, 8 Jan 2003 13:11:43 -0500
From: Amelia A Lewis <amyzing@talsever.com>
To: Timo Sirainen <tss@iki.fi>, dovecot@procontrol.fi
Subject: [dovecot] Re: Logging suggestions?
Message-ID: <20030108181142.GB12010@talsever.com>
References: <1042022871.28651.93.camel@hurina> <20030108175006.GB27418@dust.uchicago.edu>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20030108175006.GB27418@dust.uchicago.edu>
User-Agent: Mutt/1.4i
X-archive-position: 195
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: amyzing@talsever.com
Precedence: bulk
X-list: dovecot
X-UID: 195                                                  
Status: O
Content-Length: 1434

On Wed, Jan 08, 2003 at 11:50:06AM -0600, David Champion wrote:
>* On 2003.01.08, in <1042022871.28651.93.camel@hurina>,
>*	"Timo Sirainen" <tss@iki.fi> wrote:
>> Any suggestions how user login/logouts should look like in log files? I
>> was thinking:

[snip]

>> I think the only configuration needed would be if to log login, logout
>> or both.
>
>That's generous. :) I'd always want both, and can't imagine not wanting
>both, but I suppose some might prefer less.

I'd like to see at least the option of showing failed logins, for security
monitoring.  In some ways, I want to see this more than I want to see
successful logins.

>I actually wouldn't mind seeing more optional logs -- for example,
>logout-like summaries for folder accesses (when users change folders).
>This can help in balancing storage devices when folders can reside on
>multiple devices.

+1

Might think about what can be logged per-module.  That is, imap-login knows
about connection attempts; imap-auth about who and how (auth mechanism);
imap about folders accessed, bytes transferred.  Might think about a set of
keywords for each, then, like this:

imap_login_logging: connection login logout starttls
imap_auth_logging: user auth success failure
imap_logging: folders num_messages num_bytes per_folder

Amy!
-- 
Amelia A. Lewis                    amyzing {at} talsever.com
Better to have thirty minutes of wonderful than a lifetime of nothing
special.

From jaldhar@debian.org  Wed Jan  8 21:34:15 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 08 Jan 2003 21:34:15 +0200 (EET)
Return-Path: <jaldhar@debian.org>
Delivered-To: dovecot@procontrol.fi
Received: from mail.braincells.com (samadhi.braincells.com [216.162.42.100])
	by danu.procontrol.fi (Postfix) with ESMTP id 8B7DE2382C
	for <dovecot@procontrol.fi>; Wed,  8 Jan 2003 21:34:15 +0200 (EET)
Received: from localhost (localhost [127.0.0.1])
	by mail.braincells.com (Postfix) with ESMTP id 83F218138
	for <dovecot@procontrol.fi>; Wed,  8 Jan 2003 14:34:15 -0500 (EST)
Date: Wed, 8 Jan 2003 14:34:15 -0500 (EST)
From: "Jaldhar H. Vyas" <jaldhar@debian.org>
X-X-Sender: jaldhar@samadhi.braincells.com
Reply-To: "Jaldhar H. Vyas" <jaldhar@debian.org>
To: dovecot@procontrol.fi
Subject: [dovecot] Bug reports from Debian BTS
Message-ID: <Pine.LNX.4.51.0301081430250.28769@samadhi.braincells.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 196
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jaldhar@debian.org
Precedence: bulk
X-list: dovecot
X-UID: 196                                                  
Status: O

Timo,

Are you (or any other interested list readers for that matter) interested
in directly receiving bug reports about dovecot sent to Debian?  If you
are, you can go to http://packages.qa.debian.org/d/dovecot.html and sign
up to have notifications sent to you or the list or wherever.

Or I can screen them and only send you ones I think are relevant as I'm
doing now.


-- 
Jaldhar H. Vyas <jaldhar@debian.org>
It's a girl! See the pictures - http://www.braincells.com/shailaja/

From jaldhar@debian.org  Wed Jan  8 21:41:08 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 08 Jan 2003 21:41:08 +0200 (EET)
Return-Path: <jaldhar@debian.org>
Delivered-To: dovecot@procontrol.fi
Received: from mail.braincells.com (samadhi.braincells.com [216.162.42.100])
	by danu.procontrol.fi (Postfix) with ESMTP id 8DD2C2382C
	for <dovecot@procontrol.fi>; Wed,  8 Jan 2003 21:41:08 +0200 (EET)
Received: from localhost (localhost [127.0.0.1])
	by mail.braincells.com (Postfix) with ESMTP
	id 5828E8138; Wed,  8 Jan 2003 14:41:09 -0500 (EST)
Date: Wed, 8 Jan 2003 14:41:09 -0500 (EST)
From: "Jaldhar H. Vyas" <jaldhar@debian.org>
X-X-Sender: jaldhar@samadhi.braincells.com
Reply-To: "Jaldhar H. Vyas" <jaldhar@debian.org>
To: dovecot@procontrol.fi
Cc: 175509@bugs.debian.org, debian-bugs-dist@lists.debian.org,
	dovecot@packages.qa.debian.org
Subject: [dovecot] Bug#175509: dovecot: init.d script should add some syslog statements
 on startup/shutdown (fwd)
Message-ID: <Pine.LNX.4.51.0301081435310.28769@samadhi.braincells.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 197
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jaldhar@debian.org
Precedence: bulk
X-list: dovecot
X-UID: 197                                                  
Status: O

[Amelia and Timo.  As you are both on the dovecot list, I'm replying
there to avoid cluttering up your inboxes.]

This bug was reported to Debian but I feel it should be fixed upstream.
Adding logging in th init script itself would require adding additional
dependencies to the package and not be as convenient.

---------- Forwarded message ----------
From: Amelia A Lewis <amyzing@talsever.com>

It would be nice if the init.d script could add some statements in the
system log on startup and shutdown.  For postfix, postfix-script (called
from the init script) uses:
starting the Postfix mail system
stopping the Postfix mail system

These are useful; one can start the daemon and check that it's initialized
(netstat works as well, I suppose, but this is still useful docco).


-- 
Jaldhar H. Vyas <jaldhar@debian.org>



From jaldhar@debian.org  Wed Jan  8 21:50:33 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 08 Jan 2003 21:50:33 +0200 (EET)
Return-Path: <jaldhar@debian.org>
Delivered-To: dovecot@procontrol.fi
Received: from mail.braincells.com (samadhi.braincells.com [216.162.42.100])
	by danu.procontrol.fi (Postfix) with ESMTP id C28E82382C
	for <dovecot@procontrol.fi>; Wed,  8 Jan 2003 21:50:33 +0200 (EET)
Received: from localhost (localhost [127.0.0.1])
	by mail.braincells.com (Postfix) with ESMTP
	id 9482E8138; Wed,  8 Jan 2003 14:50:34 -0500 (EST)
Date: Wed, 8 Jan 2003 14:50:34 -0500 (EST)
From: "Jaldhar H. Vyas" <jaldhar@debian.org>
X-X-Sender: jaldhar@samadhi.braincells.com
Reply-To: "Jaldhar H. Vyas" <jaldhar@debian.org>
To: dovecot@procontrol.fi, 175507@bugs.debian.org
Cc: debian-bugs-dist@lists.debian.org, dovecot@packages.qa.debian.org
Subject: [dovecot] Re: Bug#175507: dovecot: Accidental denial of service via syslog
In-Reply-To: <20030105034215.23AE3FECE@ythgin.talsever.com>
Message-ID: <Pine.LNX.4.51.0301081441300.28769@samadhi.braincells.com>
References: <20030105034215.23AE3FECE@ythgin.talsever.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 198
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jaldhar@debian.org
Precedence: bulk
X-list: dovecot
X-UID: 198                                                  
Status: O
Content-Length: 1160

This bug was reported to Debian but I feel it is an upstream issue.

On Sat, 4 Jan 2003, Amelia A Lewis wrote:

> If dovecot is misconfigured, such that imap-auth cannot find passwd.imap
> (which probably needs to get copied; maybe need more docco in the config
> file?  This happens if the digest-md5 auth method is uncommented and the
> auth_userinfo is set to passwd-file /etc/passwd.imap), imap-auth dies once a
> second with error 89, which it reports to imap-master, and both log to
> syslog.
>
> I've got 30,000 line pairs from a ten hour run.  I would think that if it
> dies more than, say, a thousand times in a single hour, imap-master maybe
> ought to consider that there's a serious configuration problem preventing
> use, and exit instead of continuing to fill the log.
>
> Granted, it's a shoot-yourself sort of error.  But still ... after a certain
> point, the program ought to be able to die *gracefully* if the sysadmin has
> shot it, by accident or not.
>

Personally, I would be even stricter than Amelia is suggesting.  If there
is a serious configuration error, dovecot should die immediately.


-- 
Jaldhar H. Vyas <jaldhar@debian.org>

From tss@iki.fi  Wed Jan  8 23:16:21 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 08 Jan 2003 23:16:21 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id DE63D2382C
	for <dovecot@procontrol.fi>; Wed,  8 Jan 2003 23:16:20 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 672045E01F60; Wed,  8 Jan 2003 23:16:20 +0200 (EET)
Subject: [dovecot] Re: Bug#175507: dovecot: Accidental denial of
	service via syslog
From: Timo Sirainen <tss@iki.fi>
To: "Jaldhar H. Vyas" <jaldhar@debian.org>
Cc: dovecot@procontrol.fi, 175507@bugs.debian.org,
	debian-bugs-dist@lists.debian.org, dovecot@packages.qa.debian.org
In-Reply-To: <Pine.LNX.4.51.0301081441300.28769@samadhi.braincells.com>
References: <20030105034215.23AE3FECE@ythgin.talsever.com>
	 <Pine.LNX.4.51.0301081441300.28769@samadhi.braincells.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1042060580.28651.106.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 08 Jan 2003 23:16:20 +0200
X-archive-position: 199
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 199                                                  
Status: O

On Wed, 2003-01-08 at 21:50, Jaldhar H. Vyas wrote:
> > I've got 30,000 line pairs from a ten hour run.  I would think that if it
> > dies more than, say, a thousand times in a single hour, imap-master maybe
> > ought to consider that there's a serious configuration problem preventing
> > use, and exit instead of continuing to fill the log.
> Personally, I would be even stricter than Amelia is suggesting.  If there
> is a serious configuration error, dovecot should die immediately.

Agreed. CVS contains such code now. If login or auth process die before
master receives an "we're ok" notification from them, master shuts
itself down. Only problem with this could be some temporary failure (eg.
out of memory) which unneededly kills the whole Dovecot, but I think
these are quite rare.


From tss@iki.fi  Wed Jan  8 23:22:34 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 08 Jan 2003 23:22:34 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 9EAF92382C
	for <dovecot@procontrol.fi>; Wed,  8 Jan 2003 23:22:34 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 62B9F5E01F60; Wed,  8 Jan 2003 23:22:34 +0200 (EET)
Subject: [dovecot] Re: Bug#175509: dovecot: init.d script should add some
	syslog statements on startup/shutdown (fwd)
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Cc: 175509@bugs.debian.org, debian-bugs-dist@lists.debian.org,
	dovecot@packages.qa.debian.org
In-Reply-To: <Pine.LNX.4.51.0301081435310.28769@samadhi.braincells.com>
References: <Pine.LNX.4.51.0301081435310.28769@samadhi.braincells.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1042060953.28651.112.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 08 Jan 2003 23:22:34 +0200
X-archive-position: 200
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 200                                                  
Status: O

On Wed, 2003-01-08 at 21:41, Jaldhar H. Vyas wrote:
> It would be nice if the init.d script could add some statements in the
> system log on startup and shutdown.  For postfix, postfix-script (called
> from the init script) uses:
> starting the Postfix mail system
> stopping the Postfix mail system
> 
> These are useful; one can start the daemon and check that it's initialized
> (netstat works as well, I suppose, but this is still useful docco).

Yes, I've heard this request before but forgot to add it. I'll add
"Dovecot starting up" (or better suggestions?) but I don't think I'll
add any specific shutdown message, since either there will be some error
message or "Warning: Killed with signal x".


From jpeterson275@attbi.com  Wed Jan  8 23:45:04 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 08 Jan 2003 23:45:04 +0200 (EET)
Return-Path: <jpeterson275@attbi.com>
Delivered-To: dovecot@procontrol.fi
Received: from sccrmhc01.attbi.com (sccrmhc01.attbi.com [204.127.202.61])
	by danu.procontrol.fi (Postfix) with ESMTP id 412A82382C
	for <dovecot@procontrol.fi>; Wed,  8 Jan 2003 23:45:04 +0200 (EET)
Received: from attbi.com (12-228-125-138.client.attbi.com[12.228.125.138])
          by sccrmhc01.attbi.com (sccrmhc01) with SMTP
          id <20030108214502001004ij5ge>; Wed, 8 Jan 2003 21:45:02 +0000
Message-ID: <3E1C9BF6.9040908@attbi.com>
Date: Wed, 08 Jan 2003 13:45:26 -0800
From: Jesse Peterson <jpeterson275@attbi.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Re: Logging suggestions?
References: <1042022871.28651.93.camel@hurina> <20030108175006.GB27418@dust.uchicago.edu> <20030108181142.GB12010@talsever.com>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 201
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jpeterson275@attbi.com
Precedence: bulk
X-list: dovecot
X-UID: 201                                                  
Status: O



Amelia A Lewis wrote:
> Might think about what can be logged per-module.  That is, imap-login knows
> about connection attempts; imap-auth about who and how (auth mechanism);
> imap about folders accessed, bytes transferred.  Might think about a set of
> keywords for each, then, like this:
> 
> imap_login_logging: connection login logout starttls
> imap_auth_logging: user auth success failure
> imap_logging: folders num_messages num_bytes per_folder

I have to second this idea, as well.  I also like David Champion's idea 
of easily-parsable logs.


-- 
Jesse Peterson  /  jesse@pixeltechs.com


From tss@iki.fi  Thu Jan  9 00:54:50 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 09 Jan 2003 00:54:50 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id E18AC23837
	for <dovecot@procontrol.fi>; Thu,  9 Jan 2003 00:54:49 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 9DD445E01F60; Thu,  9 Jan 2003 00:54:49 +0200 (EET)
Subject: [dovecot] Re: Logging suggestions?
From: Timo Sirainen <tss@iki.fi>
To: David Champion <dgc@uchicago.edu>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030108175006.GB27418@dust.uchicago.edu>
References: <1042022871.28651.93.camel@hurina>
	 <20030108175006.GB27418@dust.uchicago.edu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1042066489.28650.138.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 09 Jan 2003 00:54:49 +0200
X-archive-position: 202
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 202                                                  
Status: O
Content-Length: 2843

On Wed, 2003-01-08 at 19:50, David Champion wrote:
> I like things that are easy to parse with shell and awk scripts. E.g.:
> 
> Login: username 1.2.3.4:1025 5.6.7.8:143 imaps,compressed
> Logout: username 1.2.3.4:1025 5.6.7.8:143 imaps,compressed in:1000 out:1000000 [whatever SSL summary data is available]
> 
> I like seeing both the source and destination sockaddrs. (Why not run
> two instances on different interfaces?) In fact, I like seeing both
> hostname and ip address, and an indicator if a reverse map doesn't
> match, but that's probably just me.

Hmm. I'm not sure about the destination address. Destination port would
be useful, but I don't personally care about seeing the address.
Probably not worth doing it optionally either. Guess I'd add it then.

DNS lookups then .. Not by default, and rather not with having to
distribute some DNS library. I don't see any simple way to do that. Also
only IPv6 capable async DNS library I know of is patched libadns.

> It would also
> be nice for perf. anal. to know how much I/O to storage (disk) was
> performed by the imap process, but I don't imagine those figures are
> presently available anyway.

Not very easily, especially about the indexes since they're just
mmap()ed and accessed randomly. Reading the mailbox files is more
possible, but probably not worth the trouble. Maybe that could be done
in OS-level by some existing patch?

> That's just an illustration; it doesn't matter to me whether it's like
> that particularly. I just want to show what I mean by ease of parsing
> -- whitespace-separated fields, well-known field values, related flags
> and such compounded within fields. The whole line structure should be
> well-known and not require perl or sscanf()s or such; scripts should be
> able to extract a lot of data from these quickly.

Yes, agreed. I just tend to forget this :)

> > I think the only configuration needed would be if to log login, logout
> > or both.
> 
> That's generous. :) I'd always want both, and can't imagine not wanting
> both, but I suppose some might prefer less.

I don't care about the I/O or time used in those small systems that I
use. Login might not be very useful to others who only wish to see the
stats, not who has most recently logged in. Of course disabling logins
could hide some of them if the process crashes.

> I actually wouldn't mind seeing more optional logs -- for example,
> logout-like summaries for folder accesses (when users change folders).
> This can help in balancing storage devices when folders can reside on
> multiple devices.
> 
> In an ideal world, everything would be loggable, but not everything
> would be logged.

Want to give a larger list that you'd think would be useful to log? I
can't think of many user actions that'd be worth logging. There's
already rawlog for logging _everything_ :)


From tss@iki.fi  Thu Jan  9 00:59:21 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 09 Jan 2003 00:59:21 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 58F922382C
	for <dovecot@procontrol.fi>; Thu,  9 Jan 2003 00:59:21 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 2A96E5E01F60; Thu,  9 Jan 2003 00:59:21 +0200 (EET)
Subject: [dovecot] Re: Logging suggestions?
From: Timo Sirainen <tss@iki.fi>
To: Amelia A Lewis <amyzing@talsever.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030108181142.GB12010@talsever.com>
References: <1042022871.28651.93.camel@hurina>
	 <20030108175006.GB27418@dust.uchicago.edu>
	 <20030108181142.GB12010@talsever.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1042066760.28651.144.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 09 Jan 2003 00:59:20 +0200
X-archive-position: 203
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 203                                                  
Status: O

On Wed, 2003-01-08 at 20:11, Amelia A Lewis wrote:
> I'd like to see at least the option of showing failed logins, for security
> monitoring.  In some ways, I want to see this more than I want to see
> successful logins.

Currently it just says "Aborted login". I was planning on adding "n
failed login attempts" before that or actual login.

> Might think about what can be logged per-module.  That is, imap-login knows
> about connection attempts; imap-auth about who and how (auth mechanism);
> imap about folders accessed, bytes transferred.  Might think about a set of
> keywords for each, then, like this:
> 
> imap_login_logging: connection login logout starttls
> imap_auth_logging: user auth success failure
> imap_logging: folders num_messages num_bytes per_folder

Something like that, yes. I'd like to avoid adding too many (mostly)
useless options though.


From jpeterson275@attbi.com  Thu Jan  9 01:29:16 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 09 Jan 2003 01:29:16 +0200 (EET)
Return-Path: <jpeterson275@attbi.com>
Delivered-To: dovecot@procontrol.fi
Received: from sccrmhc03.attbi.com (sccrmhc03.attbi.com [204.127.202.63])
	by danu.procontrol.fi (Postfix) with ESMTP id 49DF42382C
	for <dovecot@procontrol.fi>; Thu,  9 Jan 2003 01:29:16 +0200 (EET)
Received: from attbi.com (12-228-125-138.client.attbi.com[12.228.125.138])
          by sccrmhc03.attbi.com (sccrmhc03) with SMTP
          id <2003010823291400300latdke>; Wed, 8 Jan 2003 23:29:15 +0000
Message-ID: <3E1CB462.3040502@attbi.com>
Date: Wed, 08 Jan 2003 15:29:38 -0800
From: Jesse Peterson <jpeterson275@attbi.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Re: Logging suggestions?
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 204
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jpeterson275@attbi.com
Precedence: bulk
X-list: dovecot
X-UID: 204                                                  
Status: O
Content-Length: 1034



-------- Original Message --------
From: - Wed Jan 08 15:28:42 2003
X-Mozilla-Status: 0001
X-Mozilla-Status2: 00800000
Message-ID: <3E1CB429.3040704@attbi.com>
Date: Wed, 08 Jan 2003 15:28:41 -0800
From: Jesse Peterson <jpeterson275@attbi.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Timo Sirainen <tss@iki.fi>
Subject: Re: [dovecot] Re: Logging suggestions?
References: <1042022871.28651.93.camel@hurina>	 
<20030108175006.GB27418@dust.uchicago.edu>	 
<20030108181142.GB12010@talsever.com> <1042066760.28651.144.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit

Timo Sirainen wrote:
 >
 > Something like that, yes. I'd like to avoid adding too many (mostly)
 > useless options though.
 >

Make it customizable! =)
Maybe something similar to Apache LogFormat-style or similar?

Just a suggestion,

-- 
Jesse Peterson  /  jesse@pixeltechs.com


-- 
Jesse Peterson  /  jesse@pixeltechs.com


From tss@iki.fi  Fri Jan 10 03:24:28 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 10 Jan 2003 03:24:28 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id AAFFE2382C
	for <dovecot@procontrol.fi>; Fri, 10 Jan 2003 03:24:28 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 65D875E01F60; Fri, 10 Jan 2003 03:24:28 +0200 (EET)
Subject: [dovecot] Thread extension
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1042161868.32389.112.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 10 Jan 2003 03:24:28 +0200
X-archive-position: 205
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 205                                                  
Status: O
Content-Length: 1137

Just figured I'd mention that CVS supports now THREAD extension. I also
did a bit of benchmarking using a folder with 4685 mails (evolution
mailing list):

dovecot+mbox:
 - 0.59s user 0.01s system 98% cpu 0.608 total
 - malloc() memory usage 45072 -> 825685

dovecot+maildir:
 - 0.60s user 0.17s system 98% cpu 0.780 total
 - malloc() memory usage: 45003 -> 825480

Meaning it takes almost 800kbytes of memory and it's quite fast :)
Comparing to other servers then:

uw-imap:
 - 1.11s user 0.27s system 100% cpu 1.376 total
 - malloc() memory usage: 529408 -> ~4348k

courier:
 - 7.27s user 0.28s system 99% cpu 7.567 total
 - malloc() memory usage: 181689 -> ~850k

cyrus:
 - 1.403 total (through TCP connection, I couldn't figure out how to
start it separately)

Whoa, we beat everyone :) Courier uses a bit less memory though, but
that's most likely because we allocate it in larger chunks which is
faster. I ran the tests several times and picked the best values,
although the changes were minimal once they got the messages into OS's
cache.

Also it looks like I've found a couple of bugs in uw-imap and courier's
implementation..


From tss@iki.fi  Fri Jan 10 13:20:22 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 10 Jan 2003 13:20:22 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from hurina (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 596082382C
	for <dovecot@procontrol.fi>; Fri, 10 Jan 2003 13:20:22 +0200 (EET)
Received: by hurina (Postfix, from userid 1000)
	id 284F05E01F60; Fri, 10 Jan 2003 13:20:19 +0200 (EET)
Subject: [dovecot] Re: Thread extension
From: Timo Sirainen <tss@iki.fi>
To: Jonas Smedegaard <jonas@jones.dk>
Cc: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.50.0301100457420.2967-100000@auryn.jones.dk>
References: <1042161868.32389.112.camel@hurina>
	 <Pine.LNX.4.50.0301100457420.2967-100000@auryn.jones.dk>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1042197618.32389.154.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 10 Jan 2003 13:20:19 +0200
X-archive-position: 206
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 206                                                  
Status: O

On Fri, 2003-01-10 at 06:00, Jonas Smedegaard wrote:
> > Also it looks like I've found a couple of bugs in uw-imap and courier's
> > implementation..
> 
> Something you want to reveal?

Well, one was just my misunderstanding of the specs, but another still
exists:

These should be grouped together, but aren't:

Subject: =?iso-8859-1?Q?foo?=
Subject: =?iso-8859-1?Q?RE=3A_foo?=

UW doesn't seem to handle MIME encoded-words properly. I mentioned this
already to Mark Crispin who apparently has a lot to do with UW's code.

I didn't look too closely at Courier's output, except it was somewhat
different from Dovecot's. Also, Crispin said it was totally broken.


From martin.sillence@ntlworld.com  Fri Jan 10 22:52:34 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 10 Jan 2003 22:52:34 +0200 (EET)
Return-Path: <martin.sillence@ntlworld.com>
Delivered-To: dovecot@procontrol.fi
Received: from mta06-svc.ntlworld.com (mta06-svc.ntlworld.com [62.253.162.46])
	by danu.procontrol.fi (Postfix) with ESMTP id 13B8423837
	for <dovecot@procontrol.fi>; Fri, 10 Jan 2003 22:52:34 +0200 (EET)
Received: from wild ([62.253.45.219]) by mta06-svc.ntlworld.com
          (InterMail vM.4.01.03.27 201-229-121-127-20010626) with ESMTP
          id <20030110205230.GOMY20174.mta06-svc.ntlworld.com@wild>
          for <dovecot@procontrol.fi>; Fri, 10 Jan 2003 20:52:30 +0000
Received: from griffin.mad ([10.10.30.3] ident=martin)
	by wild with smtp (Exim 3.35 #1 (Debian))
	id 18Wt8A-0000UI-00
	for <dovecot@procontrol.fi>; Fri, 10 Jan 2003 06:59:03 +0000
Date: Fri, 10 Jan 2003 20:53:19 +0000
From: M <martin.sillence@ntlworld.com>
To: dovecot@procontrol.fi
Subject: [dovecot] Failed to create storage
Message-Id: <20030110205319.2d7a36a1.martin.sillence@ntlworld.com>
X-Mailer: Sylpheed version 0.8.8 (GTK+ 1.2.10; i386-debian-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-archive-position: 207
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: martin.sillence@ntlworld.com
Precedence: bulk
X-list: dovecot
X-UID: 207                                                  
Status: O

Hi,

I'm impressed so far, I tested this before trying to run it on a mail server and it worked find.
However on the mail server with the same config I get the following message when I try and authenticate, and it drops the connection.

Failed to create storage with data: mbox:/var/mail/martin

The test box is running debian unstable and the mail server is running debian stable so I had to recompile and install.
I'm failry sure that I got all the permissions right, I feel like I'm missing something obvious, can anyone advise?

The file and permissions on the mailbox look right:
-rw-rw----    1 martin   mail     14743740 Jan 10 06:29 /var/mail/martin

-- 
Thanks,
M

From tss@iki.fi  Fri Jan 10 23:02:45 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 10 Jan 2003 23:02:45 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 85E362382C
	for <dovecot@procontrol.fi>; Fri, 10 Jan 2003 23:02:45 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 48FA95E01F60; Fri, 10 Jan 2003 23:02:45 +0200 (EET)
Subject: [dovecot] Re: Failed to create storage
From: Timo Sirainen <tss@iki.fi>
To: M <martin.sillence@ntlworld.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030110205319.2d7a36a1.martin.sillence@ntlworld.com>
References: <20030110205319.2d7a36a1.martin.sillence@ntlworld.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1042232565.32394.188.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 10 Jan 2003 23:02:45 +0200
X-archive-position: 208
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 208                                                  
Status: O

On Fri, 2003-01-10 at 22:53, M wrote:
> Hi,
> 
> I'm impressed so far, I tested this before trying to run it on a mail server and it worked find.
> However on the mail server with the same config I get the following message when I try and authenticate, and it drops the connection.
> 
> Failed to create storage with data: mbox:/var/mail/martin

You most likely don't have ~/mail directory. Maybe Dovecot should create
it if it's missing..


From martin.sillence@ntlworld.com  Fri Jan 10 23:36:28 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 10 Jan 2003 23:36:28 +0200 (EET)
Return-Path: <martin.sillence@ntlworld.com>
Delivered-To: dovecot@procontrol.fi
Received: from mta05-svc.ntlworld.com (mta05-svc.ntlworld.com [62.253.162.45])
	by danu.procontrol.fi (Postfix) with ESMTP id 0EBA32382C
	for <dovecot@procontrol.fi>; Fri, 10 Jan 2003 23:36:28 +0200 (EET)
Received: from wild ([62.253.45.219]) by mta05-svc.ntlworld.com
          (InterMail vM.4.01.03.27 201-229-121-127-20010626) with ESMTP
          id <20030110213627.HMOH900.mta05-svc.ntlworld.com@wild>
          for <dovecot@procontrol.fi>; Fri, 10 Jan 2003 21:36:27 +0000
Received: from griffin.mad ([10.10.30.3] ident=martin)
	by wild with smtp (Exim 3.35 #1 (Debian))
	id 18Wtof-0000ZD-00
	for <dovecot@procontrol.fi>; Fri, 10 Jan 2003 07:42:57 +0000
Date: Fri, 10 Jan 2003 21:37:14 +0000
From: M <martin.sillence@ntlworld.com>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Failed to create storage
Message-Id: <20030110213714.4caecbe4.martin.sillence@ntlworld.com>
In-Reply-To: <1042232565.32394.188.camel@hurina>
References: <20030110205319.2d7a36a1.martin.sillence@ntlworld.com>
	<1042232565.32394.188.camel@hurina>
X-Mailer: Sylpheed version 0.8.8 (GTK+ 1.2.10; i386-debian-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-archive-position: 209
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: martin.sillence@ntlworld.com
Precedence: bulk
X-list: dovecot
X-UID: 209                                                  
Status: O

On 10 Jan 2003 23:02:45 +0200
Timo Sirainen <tss@iki.fi> wrote:
...
> > Failed to create storage with data: mbox:/var/mail/martin
> 
> You most likely don't have ~/mail directory. Maybe Dovecot should create
> it if it's missing..
> 

You star, that's the one.
I just installed the debian package and was still mystified at the same problem 
when I saw your reply.

I think creating it would be nice but a message that its /home/martin/mail thats
 missing might be better as it may fail to create it...

-- 
Many thanks,
M

PS If you get the bounced messages that have the wrong from address, I'm having a little trouble remembering to adjust my mail clients ;)


From tss@iki.fi  Sat Jan 11 22:22:32 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 11 Jan 2003 22:22:32 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 6FD8323837
	for <dovecot@procontrol.fi>; Sat, 11 Jan 2003 22:22:32 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id BD5365E01F60; Sat, 11 Jan 2003 22:22:31 +0200 (EET)
Subject: [dovecot] 0.99.6rc3
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1042316551.32394.199.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 11 Jan 2003 22:22:31 +0200
X-archive-position: 210
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 210                                                  
Status: O
Content-Length: 2020

Well, "release candidate" wasn't really right name for last two
versions. Maybe not for this one either, it has a few changes that could
potentially break things badly (new hash table code especially). Anyway,
seems to work with me. If I don't see any problems with it for a few
days it'll be the final.

The really great news is that we support threading. A lot of people have
not used Dovecot simply because it couldn't be used for webmails. Hmm.
What's the next most important feature? .. Better mbox support? Shared
folders? Quota? LDAP/MySQL/etc. authentication?

Here's the change summary:

v0.99.6 2003-01-xx  Timo Sirainen <tss@iki.fi>

	+ THREAD=REFERENCES extension support. ORDEREDSUBJECT would be easy to
	  add, but I think it's pretty useless.
	+ SORT is much faster now.
	+ mbox: If ~/mail directory isn't found, create it.
	+ Log login usernames
	* Some coding style changes (less typedefs)
	- Mails with nested MIME parts might have caused incorrect BODY and
	  BODYSTRUCTURE fetches and sometimes might have crashed dovecot
	  (assert at imap-bodystructure.c). If client had already successfully
	  done the BODY fetching a couple of times, the bug couldn't happen
	  anymore since Dovecot then began caching the BODY data. So, this
	  mostly happened with new users.
	- non-UID SEARCH might gave wrong replies in certain conditions.
	- SORT replied always with UIDs instead of sequences.
	- If authentication was aborted by client ("*" reply to AUTHENTICATE),
	  the login process crashed later.
	- STATUS command gave invalid reply for mailboxes with spaces in name
	- Timezones were parsed wrong with message dates
	- Digest-MD5: We used "qop-options" instead of "qop", which was
	  incompatible with at least Cyrus SASL.
	- Realms in passwd-file were buggy
	- Literals didn't work when logging in
	- Crashed if it had to wait for mbox lock
	- With invalid configuration auth and login processes were just dying
	  and master filling log files infinitely.
	- We didn't work with some 64bit systems


From skvidal@phy.duke.edu  Sat Jan 11 22:26:34 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 11 Jan 2003 22:26:34 +0200 (EET)
Return-Path: <skvidal@phy.duke.edu>
Delivered-To: dovecot@procontrol.fi
Received: from mail.phy.duke.edu (mail.phy.duke.edu [152.3.182.2])
	by danu.procontrol.fi (Postfix) with ESMTP id E428023837
	for <dovecot@procontrol.fi>; Sat, 11 Jan 2003 22:26:33 +0200 (EET)
Received: from opus.phy.duke.edu (opus.phy.duke.edu [152.3.182.42])
	by mail.phy.duke.edu (Postfix) with ESMTP
	id BC10B30191; Sat, 11 Jan 2003 15:26:30 -0500 (EST)
Subject: [dovecot] Re: 0.99.6rc3
From: seth vidal <skvidal@phy.duke.edu>
To: Timo Sirainen <tss@iki.fi>
Cc: dovecot@procontrol.fi
In-Reply-To: <1042316551.32394.199.camel@hurina>
References: <1042316551.32394.199.camel@hurina>
Content-Type: multipart/signed; micalg=pgp-sha1; protocol="application/pgp-signature";
	boundary="=-WfSqz3NYT5uCm0ZuT0iy"
X-Mailer: Ximian Evolution 1.0.3 (1.0.3-6) 
Date: 11 Jan 2003 15:26:29 -0500
Message-Id: <1042316791.19970.1.camel@opus>
Mime-Version: 1.0
X-archive-position: 211
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: skvidal@phy.duke.edu
Precedence: bulk
X-list: dovecot
X-UID: 211                                                  
Status: O
Content-Length: 1455


--=-WfSqz3NYT5uCm0ZuT0iy
Content-Type: text/plain
Content-Transfer-Encoding: quoted-printable

On Sat, 2003-01-11 at 15:22, Timo Sirainen wrote:
> Well, "release candidate" wasn't really right name for last two
> versions. Maybe not for this one either, it has a few changes that could
> potentially break things badly (new hash table code especially). Anyway,
> seems to work with me. If I don't see any problems with it for a few
> days it'll be the final.
>=20
> The really great news is that we support threading. A lot of people have
> not used Dovecot simply because it couldn't be used for webmails. Hmm.
> What's the next most important feature? .. Better mbox support? Shared
> folders? Quota? LDAP/MySQL/etc. authentication?
>=20

I know this has been asked before. But I know a fair number of people
would like dovecot to drop-in replace uw-imapd/ipopd

so two things - can you make it possible to drop in replace
uw-imapd/ipopd by having a pop3 daemon come along w/it and will dovecot
now handle a /var/mail/$user mbox as an inbox but allow ~/mail
maildir/mbox folders?

-sv


--=-WfSqz3NYT5uCm0ZuT0iy
Content-Type: application/pgp-signature; name=signature.asc
Content-Description: This is a digitally signed message part

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.0.7 (GNU/Linux)

iD8DBQA+IH311Aj3x2mIbMcRAviJAKCc/fmBh50Lgw7bxoKd78bnR+SJeQCfVmwu
ZK+O9lC7QkiPeDOt1sj+v5A=
=Gk0i
-----END PGP SIGNATURE-----

--=-WfSqz3NYT5uCm0ZuT0iy--


From tss@iki.fi  Sat Jan 11 22:34:53 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 11 Jan 2003 22:34:53 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 4800523837
	for <dovecot@procontrol.fi>; Sat, 11 Jan 2003 22:34:53 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 013C45E01F60; Sat, 11 Jan 2003 22:34:52 +0200 (EET)
Subject: [dovecot] Re: 0.99.6rc3
From: Timo Sirainen <tss@iki.fi>
To: seth vidal <skvidal@phy.duke.edu>
Cc: dovecot@procontrol.fi
In-Reply-To: <1042316791.19970.1.camel@opus>
References: <1042316551.32394.199.camel@hurina>
	 <1042316791.19970.1.camel@opus>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1042317292.32389.206.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 11 Jan 2003 22:34:52 +0200
X-archive-position: 212
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 212                                                  
Status: O

On Sat, 2003-01-11 at 22:26, seth vidal wrote:
> I know this has been asked before. But I know a fair number of people
> would like dovecot to drop-in replace uw-imapd/ipopd
> 
> so two things - can you make it possible to drop in replace
> uw-imapd/ipopd by having a pop3 daemon come along w/it 

Yes, I think. pop3 should so simple enough to write in a few hours,
unless I have to redesign some interfaces for accessing mail. I'll read
the pop3 spec and see then.

> and will dovecot
> now handle a /var/mail/$user mbox as an inbox but allow ~/mail
> maildir/mbox folders?

Yes. default_mail_env=mbox:/var/mail/$U to config file does that. Except
maildir and mboxes can't be mixed for now - wouldn't be too difficult to
support though.


From tss@iki.fi  Mon Jan 13 00:53:24 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 13 Jan 2003 00:53:24 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id EDA8123837
	for <dovecot@procontrol.fi>; Mon, 13 Jan 2003 00:53:23 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 2A5E15E01F60; Mon, 13 Jan 2003 00:53:23 +0200 (EET)
Subject: [dovecot] Re: 0.99.6rc3
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <1042317292.32389.206.camel@hurina>
References: <1042316551.32394.199.camel@hurina>
	 <1042316791.19970.1.camel@opus>  <1042317292.32389.206.camel@hurina>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1042412002.8610.14.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 13 Jan 2003 00:53:23 +0200
X-archive-position: 213
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 213                                                  
Status: O

On Sat, 2003-01-11 at 22:34, Timo Sirainen wrote:
> > so two things - can you make it possible to drop in replace
> > uw-imapd/ipopd by having a pop3 daemon come along w/it 
> 
> Yes, I think. pop3 should so simple enough to write in a few hours,
> unless I have to redesign some interfaces for accessing mail. I'll read
> the pop3 spec and see then.

Well, it requires a few changes it seems. Another related problem is
that with mbox we should hide some of the message headers, with current
code that'd messy and slow. I've also thought about supporting SQL
databases to store mails, but a bit too much of the logic is index
file-specific now.

So, time for a cleanup to fix all these at once. FETCH and SEARCH are
the only commands whose logic should be moved, after that the
lib-storage won't have hardly any IMAP specific features anymore. Any
other protocols that we could support? :)


From skvidal@phy.duke.edu  Mon Jan 13 21:00:17 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 13 Jan 2003 21:00:18 +0200 (EET)
Return-Path: <skvidal@phy.duke.edu>
Delivered-To: dovecot@procontrol.fi
Received: from mail.phy.duke.edu (mail.phy.duke.edu [152.3.182.2])
	by danu.procontrol.fi (Postfix) with ESMTP id AEF7F238C3
	for <dovecot@procontrol.fi>; Mon, 13 Jan 2003 21:00:17 +0200 (EET)
Received: from opus.phy.duke.edu (opus.phy.duke.edu [152.3.182.42])
	by mail.phy.duke.edu (Postfix) with ESMTP
	id 1507930358; Mon, 13 Jan 2003 14:00:16 -0500 (EST)
Subject: [dovecot] Re: 0.99.6rc3
From: seth vidal <skvidal@phy.duke.edu>
To: Timo Sirainen <tss@iki.fi>
Cc: dovecot@procontrol.fi
In-Reply-To: <1042412002.8610.14.camel@hurina>
References: <1042316551.32394.199.camel@hurina>
	<1042316791.19970.1.camel@opus>  <1042317292.32389.206.camel@hurina> 
	<1042412002.8610.14.camel@hurina>
Content-Type: multipart/signed; micalg=pgp-sha1; protocol="application/pgp-signature";
	boundary="=-vd0IzJ/NAm1j+ZKYHevp"
X-Mailer: Ximian Evolution 1.0.3 (1.0.3-6) 
Date: 13 Jan 2003 14:00:14 -0500
Message-Id: <1042484415.4224.33.camel@opus>
Mime-Version: 1.0
X-archive-position: 214
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: skvidal@phy.duke.edu
Precedence: bulk
X-list: dovecot
X-UID: 214                                                  
Status: O
Content-Length: 1556


--=-vd0IzJ/NAm1j+ZKYHevp
Content-Type: text/plain
Content-Transfer-Encoding: quoted-printable

On Sun, 2003-01-12 at 17:53, Timo Sirainen wrote:
> On Sat, 2003-01-11 at 22:34, Timo Sirainen wrote:
> > > so two things - can you make it possible to drop in replace
> > > uw-imapd/ipopd by having a pop3 daemon come along w/it=20
> >=20
> > Yes, I think. pop3 should so simple enough to write in a few hours,
> > unless I have to redesign some interfaces for accessing mail. I'll read
> > the pop3 spec and see then.
>=20
> Well, it requires a few changes it seems. Another related problem is
> that with mbox we should hide some of the message headers, with current
> code that'd messy and slow. I've also thought about supporting SQL
> databases to store mails, but a bit too much of the logic is index
> file-specific now.
>=20
> So, time for a cleanup to fix all these at once. FETCH and SEARCH are
> the only commands whose logic should be moved, after that the
> lib-storage won't have hardly any IMAP specific features anymore. Any
> other protocols that we could support? :)
>=20

well if you're bored and feel like working on an acap server I'm sure no
one would be pissed. ;)

-sv


--=-vd0IzJ/NAm1j+ZKYHevp
Content-Type: application/pgp-signature; name=signature.asc
Content-Description: This is a digitally signed message part

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.0.7 (GNU/Linux)

iD8DBQA+Iwy+1Aj3x2mIbMcRAgFxAJ4zXMOHkzzTlqaZJI58A3JEp6EmJQCfZ6S4
uGyO9Tu22SWQrrB1Biu7drk=
=KLbm
-----END PGP SIGNATURE-----

--=-vd0IzJ/NAm1j+ZKYHevp--


From griffin@legonet.org  Mon Jan 13 22:54:13 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 13 Jan 2003 22:54:13 +0200 (EET)
Return-Path: <griffin@legonet.org>
Delivered-To: dovecot@procontrol.fi
Received: from spelaroll.campus.luth.se (spelaroll.campus.luth.se [130.240.202.203])
	by danu.procontrol.fi (Postfix) with ESMTP id 7EC3E23837
	for <dovecot@procontrol.fi>; Mon, 13 Jan 2003 22:54:13 +0200 (EET)
Received: from spelaroll.campus.luth.se (griffin@localhost [127.0.0.1])
	by spelaroll.campus.luth.se (8.12.2/8.12.2) with ESMTP id h0DKsCnc015564
	(version=TLSv1/SSLv3 cipher=EDH-DSS-DES-CBC3-SHA bits=168 verify=NO)
	for <dovecot@procontrol.fi>; Mon, 13 Jan 2003 21:54:12 +0100 (CET)
Received: from localhost (griffin@localhost)
	by spelaroll.campus.luth.se (8.12.2/8.12.2/Submit) with ESMTP id h0DKsCLN025198
	for <dovecot@procontrol.fi>; Mon, 13 Jan 2003 21:54:12 +0100 (CET)
X-Authentication-Warning: spelaroll.campus.luth.se: griffin owned process doing -bs
Date: Mon, 13 Jan 2003 21:54:12 +0100 (CET)
From: Johan Fredin <griffin@legonet.org>
X-X-Sender: griffin@spelaroll.campus.luth.se
To: dovecot@procontrol.fi
Subject: [dovecot] dovecot-0.99.6rc3 compilation problems on (Open|Free)BSD
Message-ID: <Pine.BSO.4.44.0301132141400.7543-100000@spelaroll.campus.luth.se>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 215
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: griffin@legonet.org
Precedence: bulk
X-list: dovecot
X-UID: 215                                                  
Status: O
Content-Length: 1117

Hi there!

Dovecot-0.99.6rc3 barfs at me when I try to compile it on OpenBSD 3.2 or
FreeBSD 4.7, both with the same error:

[ ..snip.. ]
gcc -DHAVE_CONFIG_H -I. -I. -I../.. -I../../src/lib    -g -O2 -Wall -W
-Wmissing-prototypes -Wmissing-declarations -Wpointer-arith
-Wchar-subscripts -Wformat=2 -Wbad-function-cast -c charset-iconv.c
gcc -DHAVE_CONFIG_H -I. -I. -I../.. -I../../src/lib    -g -O2 -Wall -W
-Wmissing-prototypes -Wmissing-declarations -Wpointer-arith
-Wchar-subscripts -Wformat=2 -Wbad-function-cast -c charset-utf8.c
charset-utf8.c:42: storage size of `ascii_translation' isn't known
charset-utf8.c:42: storage size of `utf8_translation' isn't known
*** Error code 1

Stop in /usr/home/griffin/dovecot-0.99.6rc3/src/lib-charset.
*** Error code 1

Stop in /usr/home/griffin/dovecot-0.99.6rc3/src (line 134 of Makefile).
*** Error code 1

Stop in /usr/home/griffin/dovecot-0.99.6rc3 (line 202 of Makefile).
*** Error code 1

Stop in /usr/home/griffin/dovecot-0.99.6rc3 (line 330 of Makefile).

I didn't use any fancy parameters for ./configure. Any config.* files I
can post to help?

/Regards, Johan


From tss@iki.fi  Mon Jan 13 22:58:10 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 13 Jan 2003 22:58:10 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id A8887238C3
	for <dovecot@procontrol.fi>; Mon, 13 Jan 2003 22:58:10 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 7FC885E01F60; Mon, 13 Jan 2003 22:58:10 +0200 (EET)
Subject: [dovecot] Re: dovecot-0.99.6rc3 compilation problems on
	(Open|Free)BSD
From: Timo Sirainen <tss@iki.fi>
To: Johan Fredin <griffin@legonet.org>
Cc: dovecot@procontrol.fi
In-Reply-To: <Pine.BSO.4.44.0301132141400.7543-100000@spelaroll.campus.luth.se>
References:
	 <Pine.BSO.4.44.0301132141400.7543-100000@spelaroll.campus.luth.se>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1042491490.8609.77.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 13 Jan 2003 22:58:10 +0200
X-archive-position: 216
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 216                                                  
Status: O

On Mon, 2003-01-13 at 22:54, Johan Fredin wrote:
> Dovecot-0.99.6rc3 barfs at me when I try to compile it on OpenBSD 3.2 or
> FreeBSD 4.7, both with the same error:

Thanks, I was just about to release the final version. It compiled only
if iconv() existed in your system, otherwise it fallbacks to
ASCII+UTF8-only support which I had left broken.


From skvidal@phy.duke.edu  Mon Jan 13 23:30:48 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 13 Jan 2003 23:30:48 +0200 (EET)
Return-Path: <skvidal@phy.duke.edu>
Delivered-To: dovecot@procontrol.fi
Received: from mail.phy.duke.edu (mail.phy.duke.edu [152.3.182.2])
	by danu.procontrol.fi (Postfix) with ESMTP id C08AB238C3
	for <dovecot@procontrol.fi>; Mon, 13 Jan 2003 23:30:48 +0200 (EET)
Received: from opus.phy.duke.edu (opus.phy.duke.edu [152.3.182.42])
	by mail.phy.duke.edu (Postfix) with ESMTP id AD0FA3040D
	for <dovecot@procontrol.fi>; Mon, 13 Jan 2003 16:30:48 -0500 (EST)
Subject: [dovecot] security audit of the code
From: seth vidal <skvidal@phy.duke.edu>
To: dovecot@procontrol.fi
Content-Type: multipart/signed; micalg=pgp-sha1; protocol="application/pgp-signature";
	boundary="=-9gRgtShvlKHIoddZRra6"
X-Mailer: Ximian Evolution 1.0.3 (1.0.3-6) 
Date: 13 Jan 2003 16:30:32 -0500
Message-Id: <1042493447.7008.17.camel@opus>
Mime-Version: 1.0
X-archive-position: 217
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: skvidal@phy.duke.edu
Precedence: bulk
X-list: dovecot
X-UID: 217                                                  
Status: O


--=-9gRgtShvlKHIoddZRra6
Content-Type: text/plain
Content-Transfer-Encoding: quoted-printable

Timo,
 I know that you're taking an effort to make sure that dovecot is
written securely, but I was wondering if you've asked any third party to
audit the code yet. I don't have the skills necessary to do this but I
bet there is someone out there who does and might be willing to do so.

-sv


--=-9gRgtShvlKHIoddZRra6
Content-Type: application/pgp-signature; name=signature.asc
Content-Description: This is a digitally signed message part

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.0.7 (GNU/Linux)

iD8DBQA+Iy/41Aj3x2mIbMcRAl2mAKCI5nfE871P7CkFmTi39Y9disIAbwCfQ85R
w6bnBI37YNgHbKtf0EFQKwo=
=o+2B
-----END PGP SIGNATURE-----

--=-9gRgtShvlKHIoddZRra6--


From griffin@legonet.org  Mon Jan 13 23:42:39 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 13 Jan 2003 23:42:39 +0200 (EET)
Return-Path: <griffin@legonet.org>
Delivered-To: dovecot@procontrol.fi
Received: from spelaroll.campus.luth.se (spelaroll.campus.luth.se [130.240.202.203])
	by danu.procontrol.fi (Postfix) with ESMTP id 2E784238C3
	for <dovecot@procontrol.fi>; Mon, 13 Jan 2003 23:42:39 +0200 (EET)
Received: from spelaroll.campus.luth.se (griffin@localhost [127.0.0.1])
	by spelaroll.campus.luth.se (8.12.2/8.12.2) with ESMTP id h0DLgbnc004860
	(version=TLSv1/SSLv3 cipher=EDH-DSS-DES-CBC3-SHA bits=168 verify=NO);
	Mon, 13 Jan 2003 22:42:37 +0100 (CET)
Received: from localhost (griffin@localhost)
	by spelaroll.campus.luth.se (8.12.2/8.12.2/Submit) with ESMTP id h0DLgb1n031361;
	Mon, 13 Jan 2003 22:42:37 +0100 (CET)
X-Authentication-Warning: spelaroll.campus.luth.se: griffin owned process doing -bs
Date: Mon, 13 Jan 2003 22:42:37 +0100 (CET)
From: Johan Fredin <griffin@legonet.org>
X-X-Sender: griffin@spelaroll.campus.luth.se
To: Timo Sirainen <tss@iki.fi>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: dovecot-0.99.6rc3 compilation problems on
 (Open|Free)BSD
In-Reply-To: <1042491490.8609.77.camel@hurina>
Message-ID: <Pine.BSO.4.44.0301132224550.730-100000@spelaroll.campus.luth.se>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 218
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: griffin@legonet.org
Precedence: bulk
X-list: dovecot
X-UID: 218                                                  
Status: O
Content-Length: 1463

On 13 Jan 2003, Timo Sirainen wrote:
> Thanks, I was just about to release the final version. It compiled only
> if iconv() existed in your system, otherwise it fallbacks to
> ASCII+UTF8-only support which I had left broken.

But, I do have libiconv (GNU libiconv from ports) installed. Got iconv.h
in /usr/local/include/. If I make /usr/include/iconv.h a symlink to that
one it works through that error. But instead it barfs again further down
the road :/.

[ ..snip.. ]
gcc -DHAVE_CONFIG_H -I. -I. -I../.. -I../../src/lib
-I../../src/lib-imap    -g -O2 -Wall -W -Wmissing-prototypes
-Wmissing-declarations -Wpointer-arith -Wchar-subscripts -Wformat=2
-Wbad-function-cast -c ssl-proxy-openssl.c
ssl-proxy-openssl.c: In function `plain_block_input':
ssl-proxy-openssl.c:58: `IOFunc' undeclared (first use in this function)
ssl-proxy-openssl.c:58: (Each undeclared identifier is reported only once
ssl-proxy-openssl.c:58: for each function it appears in.)
ssl-proxy-openssl.c:58: syntax error before `plain_read'
ssl-proxy-openssl.c: In function `plain_write':
ssl-proxy-openssl.c:119: `IOFunc' undeclared (first use in this function)
ssl-proxy-openssl.c:119: syntax error before `plain_write'
ssl-proxy-openssl.c: At top level:
ssl-proxy-openssl.c:81: warning: `plain_read' defined but not used
*** Error code 1

Stop in /usr/home/griffin/dovecot-0.99.6rc3/src/login.
*** Error code 1

This is OpenBSD 3.2 with OpenSSL 0.9.7-beta3 30 Jul 2002.

/Regards, Johan



From tss@iki.fi  Mon Jan 13 23:56:17 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 13 Jan 2003 23:56:17 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 4D5CF238C3
	for <dovecot@procontrol.fi>; Mon, 13 Jan 2003 23:56:17 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 1E2565E01F60; Mon, 13 Jan 2003 23:56:17 +0200 (EET)
Subject: [dovecot] Re: dovecot-0.99.6rc3 compilation problems on
	(Open|Free)BSD
From: Timo Sirainen <tss@iki.fi>
To: Johan Fredin <griffin@legonet.org>
Cc: dovecot@procontrol.fi
In-Reply-To: <Pine.BSO.4.44.0301132224550.730-100000@spelaroll.campus.luth.se>
References:
	 <Pine.BSO.4.44.0301132224550.730-100000@spelaroll.campus.luth.se>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1042494976.8609.83.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 13 Jan 2003 23:56:16 +0200
X-archive-position: 219
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 219                                                  
Status: O

On Mon, 2003-01-13 at 23:42, Johan Fredin wrote:
> On 13 Jan 2003, Timo Sirainen wrote:
> > Thanks, I was just about to release the final version. It compiled only
> > if iconv() existed in your system, otherwise it fallbacks to
> > ASCII+UTF8-only support which I had left broken.
> 
> But, I do have libiconv (GNU libiconv from ports) installed. Got iconv.h
> in /usr/local/include/. If I make /usr/include/iconv.h a symlink to that
> one it works through that error.

CPPFLAGS='-I /usr/local/include' ./configure would be a bit more correct
way to fix it.

>  But instead it barfs again further down
> the road :/.

Thanks again, would have missed this one too :) Get 0.99.6 in a few
minutes.


From tss@iki.fi  Tue Jan 14 00:12:44 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 14 Jan 2003 00:12:44 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 8215C23837
	for <dovecot@procontrol.fi>; Tue, 14 Jan 2003 00:12:44 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 532BC5E01F60; Tue, 14 Jan 2003 00:12:44 +0200 (EET)
Subject: [dovecot] Re: security audit of the code
From: Timo Sirainen <tss@iki.fi>
To: seth vidal <skvidal@phy.duke.edu>
Cc: dovecot@procontrol.fi
In-Reply-To: <1042493447.7008.17.camel@opus>
References: <1042493447.7008.17.camel@opus>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1042495964.8610.91.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 14 Jan 2003 00:12:44 +0200
X-archive-position: 220
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 220                                                  
Status: O

On Mon, 2003-01-13 at 23:30, seth vidal wrote:
> Timo,
>  I know that you're taking an effort to make sure that dovecot is
> written securely, but I was wondering if you've asked any third party to
> audit the code yet. I don't have the skills necessary to do this but I
> bet there is someone out there who does and might be willing to do so.

I don't really know who or where to ask. I'd be interested of getting
people to audit Dovecot too.


From tss@iki.fi  Tue Jan 14 00:14:25 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 14 Jan 2003 00:14:25 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 9356E23837
	for <dovecot@procontrol.fi>; Tue, 14 Jan 2003 00:14:25 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 64C565E01F60; Tue, 14 Jan 2003 00:14:25 +0200 (EET)
Subject: [dovecot] 0.99.6 released
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1042496065.8609.94.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 14 Jan 2003 00:14:25 +0200
X-archive-position: 221
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 221                                                  
Status: O
Content-Length: 1504

Several bugfixes since 0.99.6rc3. Here's again the change summary since
0.99.5:

v0.99.6 2003-01-13  Timo Sirainen <tss@iki.fi>

	+ THREAD=REFERENCES extension support. ORDEREDSUBJECT would be easy to
	  add, but I think it's pretty useless.
	+ SORT is much faster now.
	+ mbox: If ~/mail directory isn't found, create it.
	+ Log login usernames
	* Some coding style changes (less typedefs)
	- Mails with nested MIME parts might have caused incorrect BODY and
	  BODYSTRUCTURE fetches and sometimes might have crashed dovecot
	  (assert at imap-bodystructure.c). If client had already successfully
	  done the BODY fetching a couple of times, the bug couldn't happen
	  anymore since Dovecot then began caching the BODY data. So, this
	  mostly happened with new users.
	- non-UID SEARCH might gave wrong replies in certain conditions.
	- SORT replied always with UIDs instead of sequences.
	- If authentication was aborted by client ("*" reply to AUTHENTICATE),
	  the login process crashed later.
	- STATUS command gave invalid reply for mailboxes with spaces in name
	- Timezones were parsed wrong with message dates
	- Digest-MD5: We used "qop-options" instead of "qop", which was
	  incompatible with at least Cyrus SASL.
	- Realms in passwd-file were buggy
	- Literals didn't work when logging in
	- Crashed if it had to wait for mbox lock
	- With invalid configuration auth and login processes were just dying
	  and master filling log files infinitely.
	- We didn't work with some 64bit systems


From skvidal@phy.duke.edu  Tue Jan 14 00:16:17 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 14 Jan 2003 00:16:17 +0200 (EET)
Return-Path: <skvidal@phy.duke.edu>
Delivered-To: dovecot@procontrol.fi
Received: from mail.phy.duke.edu (mail.phy.duke.edu [152.3.182.2])
	by danu.procontrol.fi (Postfix) with ESMTP id 4622523837
	for <dovecot@procontrol.fi>; Tue, 14 Jan 2003 00:16:17 +0200 (EET)
Received: from opus.phy.duke.edu (opus.phy.duke.edu [152.3.182.42])
	by mail.phy.duke.edu (Postfix) with ESMTP
	id CFC9530195; Mon, 13 Jan 2003 17:16:16 -0500 (EST)
Subject: [dovecot] Re: security audit of the code
From: seth vidal <skvidal@phy.duke.edu>
To: Timo Sirainen <tss@iki.fi>
Cc: dovecot@procontrol.fi
In-Reply-To: <1042495964.8610.91.camel@hurina>
References: <1042493447.7008.17.camel@opus> 
	<1042495964.8610.91.camel@hurina>
Content-Type: multipart/signed; micalg=pgp-sha1; protocol="application/pgp-signature";
	boundary="=-P98wT82RzHPspQTnUp3U"
X-Mailer: Ximian Evolution 1.0.3 (1.0.3-6) 
Date: 13 Jan 2003 17:16:16 -0500
Message-Id: <1042496176.7276.57.camel@opus>
Mime-Version: 1.0
X-archive-position: 222
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: skvidal@phy.duke.edu
Precedence: bulk
X-list: dovecot
X-UID: 222                                                  
Status: O
Content-Length: 1192


--=-P98wT82RzHPspQTnUp3U
Content-Type: text/plain
Content-Transfer-Encoding: quoted-printable

On Mon, 2003-01-13 at 17:12, Timo Sirainen wrote:
> On Mon, 2003-01-13 at 23:30, seth vidal wrote:
> > Timo,
> >  I know that you're taking an effort to make sure that dovecot is
> > written securely, but I was wondering if you've asked any third party t=
o
> > audit the code yet. I don't have the skills necessary to do this but I
> > bet there is someone out there who does and might be willing to do so.
>=20
> I don't really know who or where to ask. I'd be interested of getting
> people to audit Dovecot too.
>=20


Would it be reasonable to ask on bugtraq?

What about Chris Evans? - he wrote vsftpd and audited a bunch of Red
Hat's releases iirc.  Maybe worth bugging him to see if he'd be willing
to look it over?

-sv


--=-P98wT82RzHPspQTnUp3U
Content-Type: application/pgp-signature; name=signature.asc
Content-Description: This is a digitally signed message part

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.0.7 (GNU/Linux)

iD8DBQA+Izqw1Aj3x2mIbMcRAsWZAJ9/9TmFzIOc7zBVvLperLR8+BlSqQCcCTlz
dZ5SGk3ueyk6cwVxaRj6UoQ=
=B7NS
-----END PGP SIGNATURE-----

--=-P98wT82RzHPspQTnUp3U--


From skvidal@phy.duke.edu  Tue Jan 14 00:18:11 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 14 Jan 2003 00:18:11 +0200 (EET)
Return-Path: <skvidal@phy.duke.edu>
Delivered-To: dovecot@procontrol.fi
Received: from mail.phy.duke.edu (mail.phy.duke.edu [152.3.182.2])
	by danu.procontrol.fi (Postfix) with ESMTP id 3691623837
	for <dovecot@procontrol.fi>; Tue, 14 Jan 2003 00:18:11 +0200 (EET)
Received: from opus.phy.duke.edu (opus.phy.duke.edu [152.3.182.42])
	by mail.phy.duke.edu (Postfix) with ESMTP
	id C7ECE30195; Mon, 13 Jan 2003 17:18:10 -0500 (EST)
Subject: [dovecot] Re: security audit of the code
From: seth vidal <skvidal@phy.duke.edu>
To: seth vidal <skvidal@phy.duke.edu>
Cc: Timo Sirainen <tss@iki.fi>, dovecot@procontrol.fi
In-Reply-To: <1042496176.7276.57.camel@opus>
References: <1042493447.7008.17.camel@opus> 
	<1042495964.8610.91.camel@hurina>  <1042496176.7276.57.camel@opus>
Content-Type: multipart/signed; micalg=pgp-sha1; protocol="application/pgp-signature";
	boundary="=-viYehhu+8f0tHfzj8JVW"
X-Mailer: Ximian Evolution 1.0.3 (1.0.3-6) 
Date: 13 Jan 2003 17:18:10 -0500
Message-Id: <1042496290.6891.59.camel@opus>
Mime-Version: 1.0
X-archive-position: 223
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: skvidal@phy.duke.edu
Precedence: bulk
X-list: dovecot
X-UID: 223                                                  
Status: O
Content-Length: 1414


--=-viYehhu+8f0tHfzj8JVW
Content-Type: text/plain
Content-Transfer-Encoding: quoted-printable

On Mon, 2003-01-13 at 17:16, seth vidal wrote:
> On Mon, 2003-01-13 at 17:12, Timo Sirainen wrote:
> > On Mon, 2003-01-13 at 23:30, seth vidal wrote:
> > > Timo,
> > >  I know that you're taking an effort to make sure that dovecot is
> > > written securely, but I was wondering if you've asked any third party=
 to
> > > audit the code yet. I don't have the skills necessary to do this but =
I
> > > bet there is someone out there who does and might be willing to do so=
.
> >=20
> > I don't really know who or where to ask. I'd be interested of getting
> > people to audit Dovecot too.
> >=20
>=20
>=20
> Would it be reasonable to ask on bugtraq?
>=20
> What about Chris Evans? - he wrote vsftpd and audited a bunch of Red
> Hat's releases iirc.  Maybe worth bugging him to see if he'd be willing
> to look it over?
>=20


heh the above should read:

He wrote vsftpd and audited a variety of programs, and one of Red Hat's
releases iirc.

<sigh>
-sv


--=-viYehhu+8f0tHfzj8JVW
Content-Type: application/pgp-signature; name=signature.asc
Content-Description: This is a digitally signed message part

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.0.7 (GNU/Linux)

iD8DBQA+Izsi1Aj3x2mIbMcRAmjjAJ9rkllCa6XrcNdVA5MelLXlpe02pQCfe45U
f7WJYN+m5RuNVtRP+j3hLlk=
=fWJB
-----END PGP SIGNATURE-----

--=-viYehhu+8f0tHfzj8JVW--


From tss@iki.fi  Tue Jan 14 00:23:07 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 14 Jan 2003 00:23:07 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 5782923837
	for <dovecot@procontrol.fi>; Tue, 14 Jan 2003 00:23:07 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 2553E5E01F60; Tue, 14 Jan 2003 00:23:07 +0200 (EET)
Subject: [dovecot] Re: security audit of the code
From: Timo Sirainen <tss@iki.fi>
To: seth vidal <skvidal@phy.duke.edu>
Cc: dovecot@procontrol.fi
In-Reply-To: <1042496176.7276.57.camel@opus>
References: <1042493447.7008.17.camel@opus>
	 <1042495964.8610.91.camel@hurina>  <1042496176.7276.57.camel@opus>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1042496586.8610.102.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 14 Jan 2003 00:23:07 +0200
X-archive-position: 224
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 224                                                  
Status: O

On Tue, 2003-01-14 at 00:16, seth vidal wrote:
> > I don't really know who or where to ask. I'd be interested of getting
> > people to audit Dovecot too.

> Would it be reasonable to ask on bugtraq?
> 
> What about Chris Evans? - he wrote vsftpd and audited a bunch of Red
> Hat's releases iirc.  Maybe worth bugging him to see if he'd be willing
> to look it over?

I don't think it's a good idea to bug people with auditing requests,
unless they've stated they don't mind. I usually audit only software
that I use myself.

From skvidal@phy.duke.edu  Tue Jan 14 00:25:10 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 14 Jan 2003 00:25:10 +0200 (EET)
Return-Path: <skvidal@phy.duke.edu>
Delivered-To: dovecot@procontrol.fi
Received: from mail.phy.duke.edu (mail.phy.duke.edu [152.3.182.2])
	by danu.procontrol.fi (Postfix) with ESMTP id 222C423837
	for <dovecot@procontrol.fi>; Tue, 14 Jan 2003 00:25:10 +0200 (EET)
Received: from opus.phy.duke.edu (opus.phy.duke.edu [152.3.182.42])
	by mail.phy.duke.edu (Postfix) with ESMTP
	id CEA0930195; Mon, 13 Jan 2003 17:25:09 -0500 (EST)
Received: by opus.phy.duke.edu (Postfix, from userid 875)
	id 345F95F0F2; Mon, 13 Jan 2003 17:25:09 -0500 (EST)
Date: Mon, 13 Jan 2003 17:25:09 -0500 (EST)
From: Seth Vidal <skvidal@phy.duke.edu>
X-X-Sender: skvidal@localhost.localdomain
To: Timo Sirainen <tss@iki.fi>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: security audit of the code
In-Reply-To: <1042496586.8610.102.camel@hurina>
Message-ID: <Pine.LNX.4.44.0301131723310.7686-100000@localhost.localdomain>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 225
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: skvidal@phy.duke.edu
Precedence: bulk
X-list: dovecot
X-UID: 225                                                  
Status: O

> I don't think it's a good idea to bug people with auditing requests,
> unless they've stated they don't mind. I usually audit only software
> that I use myself.

makes sense.

I dunno who/where to ask.
I'm sorta surprised the securityfocus folks don't have a mailing list for 
this sort of request. It might not actually be a useful list but I'm 
surprised they don't have one :)

-sv



From lfarkas@bnap.hu  Tue Jan 14 00:59:56 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 14 Jan 2003 00:59:56 +0200 (EET)
Return-Path: <lfarkas@bnap.hu>
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 13386238C3
	for <dovecot@procontrol.fi>; Tue, 14 Jan 2003 00:59:56 +0200 (EET)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id 7CE25754021
	for <dovecot@procontrol.fi>; Tue, 14 Jan 2003 00:00:06 +0100 (CET)
Received: from localhost (localhost [127.0.0.1])
	by mail2.bppiac.hu (Postfix) with ESMTP id 099FA404F
	for <dovecot@procontrol.fi>; Mon, 13 Jan 2003 23:59:53 +0100 (CET)
Received: from mail2.bppiac.hu ([127.0.0.1]) by localhost (portal.bppiac.hu [127.0.0.1]) (amavisd-new) with ESMTP id 15148-08 for <dovecot@procontrol.fi>; Mon, 13 Jan 2003 23:59:52 -0000 (CET)
Message-ID: <3E2344E8.1020008@bnap.hu>
Date: Mon, 13 Jan 2003 23:59:52 +0100
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20021218
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: dovecot@procontrol.fi
Subject: [dovecot] Re: security audit of the code
References: <1042493447.7008.17.camel@opus> 	<1042495964.8610.91.camel@hurina> <1042496176.7276.57.camel@opus>
In-Reply-To: <1042496176.7276.57.camel@opus>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-Virus-Scanned: on portal.bnap.hu by AMaViS
X-archive-position: 226
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 226                                                  
Status: O

seth vidal wrote:
> On Mon, 2003-01-13 at 17:12, Timo Sirainen wrote:
> 
>>On Mon, 2003-01-13 at 23:30, seth vidal wrote:
>>
>>>Timo,
>>> I know that you're taking an effort to make sure that dovecot is
>>>written securely, but I was wondering if you've asked any third party to
>>>audit the code yet. I don't have the skills necessary to do this but I
>>>bet there is someone out there who does and might be willing to do so.
>>
>>I don't really know who or where to ask. I'd be interested of getting
>>people to audit Dovecot too.
>>
> 
> 
> 
> Would it be reasonable to ask on bugtraq?
> 
> What about Chris Evans? - he wrote vsftpd and audited a bunch of Red
> Hat's releases iirc.  Maybe worth bugging him to see if he'd be willing
> to look it over?

if he do that, than everybody accept it as "secure"..

-- 
  Levente                        http://petition.eurolinux.org/index_html
  "The only thing worse than not knowing the truth is
   ruining the bliss of ignorance."


From disco@pervert.ca  Tue Jan 14 03:35:36 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 14 Jan 2003 03:35:36 +0200 (EET)
Return-Path: <disco@pervert.ca>
Delivered-To: dovecot@procontrol.fi
Received: from iridium.pervert.ca (CPE0050bad0aa3e.cpe.net.cable.rogers.com [24.112.138.163])
	by danu.procontrol.fi (Postfix) with ESMTP id 548F9238C3
	for <dovecot@procontrol.fi>; Tue, 14 Jan 2003 03:35:36 +0200 (EET)
Received: from PHOTEK (photek.pervert.ca [192.168.1.100])
	by iridium.pervert.ca (8.12.5/8.12.5) with ESMTP id h0DLSGOw031678
	for <dovecot@procontrol.fi>; Mon, 13 Jan 2003 21:28:20 GMT
	(envelope-from disco@pervert.ca)
Reply-To: <disco@pervert.ca>
From: "Rick Stewart" <disco@pervert.ca>
To: <dovecot@procontrol.fi>
Subject: [dovecot] Re: security audit of the code
Date: Mon, 13 Jan 2003 20:37:15 -0500
Organization: Misc. Perversion
Message-ID: <000001c2bb6d$78264ac0$6401a8c0@PHOTEK>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Priority: 3 (Normal)
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook, Build 10.0.4024
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2800.1106
Importance: Normal
In-Reply-To: <3E2344E8.1020008@bnap.hu>
X-archive-position: 227
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: disco@pervert.ca
Precedence: bulk
X-list: dovecot
X-UID: 227                                                  
Status: O
Content-Length: 1439

I don't think that's the point.  The point is to have some fresh eyes go
over code that is thought to be secure.  Once audited, it doesn't mean 
Its any more secure, but at least were on the way to cover any if not
most angles.  Cheers,

./r

-----Original Message-----
From: dovecot-bounce@procontrol.fi [mailto:dovecot-bounce@procontrol.fi]
On Behalf Of Farkas Levente
Sent: January 13, 2003 6:00 PM
To: dovecot@procontrol.fi
Subject: [dovecot] Re: security audit of the code

seth vidal wrote:
> On Mon, 2003-01-13 at 17:12, Timo Sirainen wrote:
> 
>>On Mon, 2003-01-13 at 23:30, seth vidal wrote:
>>
>>>Timo,
>>> I know that you're taking an effort to make sure that dovecot is
>>>written securely, but I was wondering if you've asked any third party
to
>>>audit the code yet. I don't have the skills necessary to do this but
I
>>>bet there is someone out there who does and might be willing to do
so.
>>
>>I don't really know who or where to ask. I'd be interested of getting
>>people to audit Dovecot too.
>>
> 
> 
> 
> Would it be reasonable to ask on bugtraq?
> 
> What about Chris Evans? - he wrote vsftpd and audited a bunch of Red
> Hat's releases iirc.  Maybe worth bugging him to see if he'd be
willing
> to look it over?

if he do that, than everybody accept it as "secure"..

-- 
  Levente
http://petition.eurolinux.org/index_html
  "The only thing worse than not knowing the truth is
   ruining the bliss of ignorance."




From tss@iki.fi  Tue Jan 14 13:07:36 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 14 Jan 2003 13:07:36 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 2A4C7238C3
	for <dovecot@procontrol.fi>; Tue, 14 Jan 2003 13:07:36 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 027235E01F60; Tue, 14 Jan 2003 13:07:35 +0200 (EET)
Subject: [dovecot] 0.99.6 buggy
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1042542455.8610.117.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 14 Jan 2003 13:07:35 +0200
X-archive-position: 228
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 228                                                  
Status: O

Just a note, the hash table code in it was still buggy. Especially with
maildir it could leave the processes to infinite loop. Have to think a
bit more how to fix this properly..


From tss@iki.fi  Tue Jan 14 15:33:16 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 14 Jan 2003 15:33:16 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 28250238C3
	for <dovecot@procontrol.fi>; Tue, 14 Jan 2003 15:33:16 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 001A45E01F60; Tue, 14 Jan 2003 15:33:15 +0200 (EET)
Subject: [dovecot] 0.99.7 out
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1042551195.8610.160.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 14 Jan 2003 15:33:15 +0200
X-archive-position: 229
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 229                                                  
Status: O

This one seems to be actually working. Also rewrote doc/index.txt in
case someone is interested.


From pekka.jalonen@mediatraffic.fi  Wed Jan 15 09:49:44 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 15 Jan 2003 09:49:44 +0200 (EET)
Return-Path: <pekka.jalonen@mediatraffic.fi>
Delivered-To: dovecot@procontrol.fi
Received: from scan.mediatraffic.fi (scan.mediatraffic.fi [212.83.107.130])
	by danu.procontrol.fi (Postfix) with ESMTP id BBCAC238C3
	for <dovecot@procontrol.fi>; Wed, 15 Jan 2003 09:49:44 +0200 (EET)
Received: from localhost (localhost [127.0.0.1])
	by scan.mediatraffic.fi (Postfix) with ESMTP
	id C2C9C1FD16; Wed, 15 Jan 2003 09:41:08 +0200 (EET)
Received: from intra (intra.mediatraffic.fi [212.83.107.187])
	by scan.mediatraffic.fi (Postfix) with ESMTP
	id 6364B1FD15; Wed, 15 Jan 2003 09:41:08 +0200 (EET)
Received: from mediatraffic-1.mediatraffic.fi (unknown [192.168.0.5])
	by intra (Postfix) with ESMTP
	id 2D73240A7; Wed, 15 Jan 2003 09:50:21 +0200 (EET)
Message-Id: <5.2.0.9.0.20030115094314.02f263c8@beta.mediatraffic.fi>
X-Sender: peja@beta.mediatraffic.fi (Unverified)
X-Mailer: QUALCOMM Windows Eudora Version 5.2.0.9
Date: Wed, 15 Jan 2003 09:50:35 +0200
To: dovecot@procontrol.fi
From: Pekka Jalonen <pekka.jalonen@mediatraffic.fi>
Subject: [dovecot] Re: 0.99.7 out
Cc: Timo Sirainen <tss@iki.fi>
In-Reply-To: <1042551195.8610.160.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"; format=flowed
X-Virus-Scanned: on scan.mediatraffic.fi
X-archive-position: 230
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: pekka.jalonen@mediatraffic.fi
Precedence: bulk
X-list: dovecot
X-UID: 230                                                  
Status: O
Content-Length: 1922

At 15:33 14.1.2003 +0200, Timo Sirainen wrote:
>This one seems to be actually working.

Deb-build failed (woody-debian) at vpopmail.c like parse errors.
Source download from: deb-src http://src.braincells.com/debian woody/

Wchar-subscripts -Wformat=2 -Wbad-function-cast    -g -O2 -Wall -W 
-Wmissing-prototypes -Wmissing-declarations -Wpointer-arith 
-Wchar-subscripts -Wformat=2 -Wbad-function-cast  -c userinfo-passwd-file.c
gcc -DHAVE_CONFIG_H -I. -I. -I../.. 
-I../../src/lib     -I/home/vpopmail/include -g -O2 -Wall -W 
-Wmissing-prototypes -Wmissing-declarations -Wpointer-arith 
-Wchar-subscripts -Wformat=2 -Wbad-function-cast    -g -O2 -Wall -W 
-Wmissing-prototypes -Wmissing-declarations -Wpointer-arith 
-Wchar-subscripts -Wformat=2 -Wbad-function-cast  -c userinfo-vpopmail.c
userinfo-vpopmail.c:25: parse error before `AuthCookieReplyData'
userinfo-vpopmail.c: In function `vpopmail_verify_plain':
userinfo-vpopmail.c:37: `user' undeclared (first use in this function)
userinfo-vpopmail.c:37: (Each undeclared identifier is reported only once
userinfo-vpopmail.c:37: for each function it appears in.)
userinfo-vpopmail.c:46: `reply' undeclared (first use in this function)
userinfo-vpopmail.c:79: `password' undeclared (first use in this function)
make[4]: *** [userinfo-vpopmail.o] Error 1
make[4]: Leaving directory `/root/deb2/dovecot-0.99.7/src/auth'
make[3]: *** [all-recursive] Error 1
make[3]: Leaving directory `/root/deb2/dovecot-0.99.7/src'
make[2]: *** [all-recursive] Error 1
make[2]: Leaving directory `/root/deb2/dovecot-0.99.7'
make[1]: *** [all-recursive-am] Error 2
make[1]: Leaving directory `/root/deb2/dovecot-0.99.7'
make: *** [build-stamp] Error 2
Build command 'cd dovecot-0.99.7 && dpkg-buildpackage -b -uc' failed.
E: Child process failed


--
Pekka Jalonen
System Administrator
Mediatraffic Oy
Mobile: +358 400 519 905
Fax: +358 2 765 1195
Email: pekka.jalonen@mediatraffic.fi 


From jaldhar@debian.org  Wed Jan 15 16:40:37 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 15 Jan 2003 16:40:37 +0200 (EET)
Return-Path: <jaldhar@debian.org>
Delivered-To: dovecot@procontrol.fi
Received: from mail.braincells.com (samadhi.braincells.com [216.162.42.100])
	by danu.procontrol.fi (Postfix) with ESMTP id 8919D23837
	for <dovecot@procontrol.fi>; Wed, 15 Jan 2003 16:40:37 +0200 (EET)
Received: from localhost (localhost [127.0.0.1])
	by mail.braincells.com (Postfix) with ESMTP
	id 0E5D58138; Wed, 15 Jan 2003 09:40:36 -0500 (EST)
Date: Wed, 15 Jan 2003 09:40:35 -0500 (EST)
From: "Jaldhar H. Vyas" <jaldhar@debian.org>
X-X-Sender: jaldhar@samadhi.braincells.com
Reply-To: "Jaldhar H. Vyas" <jaldhar@debian.org>
To: Pekka Jalonen <pekka.jalonen@mediatraffic.fi>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: 0.99.7 out
In-Reply-To: <5.2.0.9.0.20030115094314.02f263c8@beta.mediatraffic.fi>
Message-ID: <Pine.LNX.4.51.0301150921570.9245@samadhi.braincells.com>
References: <5.2.0.9.0.20030115094314.02f263c8@beta.mediatraffic.fi>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 231
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jaldhar@debian.org
Precedence: bulk
X-list: dovecot
X-UID: 231                                                  
Status: O
Content-Length: 2165

On Wed, 15 Jan 2003, Pekka Jalonen wrote:

> At 15:33 14.1.2003 +0200, Timo Sirainen wrote:
> >This one seems to be actually working.
>
> Deb-build failed (woody-debian) at vpopmail.c like parse errors.
> Source download from: deb-src http://src.braincells.com/debian woody/
>
> Wchar-subscripts -Wformat=2 -Wbad-function-cast    -g -O2 -Wall -W
> -Wmissing-prototypes -Wmissing-declarations -Wpointer-arith
> -Wchar-subscripts -Wformat=2 -Wbad-function-cast  -c userinfo-passwd-file.c
> gcc -DHAVE_CONFIG_H -I. -I. -I../..
> -I../../src/lib     -I/home/vpopmail/include -g -O2 -Wall -W
> -Wmissing-prototypes -Wmissing-declarations -Wpointer-arith
> -Wchar-subscripts -Wformat=2 -Wbad-function-cast    -g -O2 -Wall -W
> -Wmissing-prototypes -Wmissing-declarations -Wpointer-arith
> -Wchar-subscripts -Wformat=2 -Wbad-function-cast  -c userinfo-vpopmail.c
> userinfo-vpopmail.c:25: parse error before `AuthCookieReplyData'
> userinfo-vpopmail.c: In function `vpopmail_verify_plain':
> userinfo-vpopmail.c:37: `user' undeclared (first use in this function)
> userinfo-vpopmail.c:37: (Each undeclared identifier is reported only once
> userinfo-vpopmail.c:37: for each function it appears in.)
> userinfo-vpopmail.c:46: `reply' undeclared (first use in this function)
> userinfo-vpopmail.c:79: `password' undeclared (first use in this function)
> make[4]: *** [userinfo-vpopmail.o] Error 1
> make[4]: Leaving directory `/root/deb2/dovecot-0.99.7/src/auth'
> make[3]: *** [all-recursive] Error 1
> make[3]: Leaving directory `/root/deb2/dovecot-0.99.7/src'
> make[2]: *** [all-recursive] Error 1
> make[2]: Leaving directory `/root/deb2/dovecot-0.99.7'
> make[1]: *** [all-recursive-am] Error 2
> make[1]: Leaving directory `/root/deb2/dovecot-0.99.7'
> make: *** [build-stamp] Error 2
> Build command 'cd dovecot-0.99.7 && dpkg-buildpackage -b -uc' failed.
> E: Child process failed
>
>

Hmm I just tried this and I can't reproduce the error.  So there must be
something in your local setup.  Are you running pure woody?  Nothing
backported from sid?  Did you make any changes to debian/rules?

We should take this off-list.

-- 
Jaldhar H. Vyas <jaldhar@debian.org>

From tss@iki.fi  Wed Jan 15 16:49:59 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 15 Jan 2003 16:49:59 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id E594E23837
	for <dovecot@procontrol.fi>; Wed, 15 Jan 2003 16:49:58 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id A97385E01F60; Wed, 15 Jan 2003 16:49:58 +0200 (EET)
Subject: [dovecot] Re: 0.99.7 out
From: Timo Sirainen <tss@iki.fi>
To: Pekka Jalonen <pekka.jalonen@mediatraffic.fi>
Cc: dovecot@procontrol.fi
In-Reply-To: <5.2.0.9.0.20030115094314.02f263c8@beta.mediatraffic.fi>
References: <5.2.0.9.0.20030115094314.02f263c8@beta.mediatraffic.fi>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1042642198.8610.173.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 15 Jan 2003 16:49:58 +0200
X-archive-position: 232
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 232                                                  
Status: O

On Wed, 2003-01-15 at 09:50, Pekka Jalonen wrote:
> At 15:33 14.1.2003 +0200, Timo Sirainen wrote:
> >This one seems to be actually working.
> 
> Deb-build failed (woody-debian) at vpopmail.c like parse errors.
> Source download from: deb-src http://src.braincells.com/debian woody/

Yes, so it seems. This patch fixes it:

Index: userinfo-vpopmail.c
===================================================================
RCS file: /home/cvs/dovecot/src/auth/userinfo-vpopmail.c,v
retrieving revision 1.12
diff -u -r1.12 userinfo-vpopmail.c
--- userinfo-vpopmail.c 5 Jan 2003 13:09:51 -0000       1.12
+++ userinfo-vpopmail.c 15 Jan 2003 14:48:48 -0000
@@ -22,7 +22,7 @@
 #define VPOPMAIL_LIMIT 81
 
 static int vpopmail_verify_plain(const char *user, const char *password,
-                                AuthCookieReplyData *reply)
+                                struct auth_cookie_reply_data *reply)
 {
        char vpop_user[VPOPMAIL_LIMIT], vpop_domain[VPOPMAIL_LIMIT];
        struct vqpasswd *vpw;


From jaldhar@debian.org  Fri Jan 17 05:11:33 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 17 Jan 2003 05:11:33 +0200 (EET)
Return-Path: <jaldhar@debian.org>
Delivered-To: dovecot@procontrol.fi
Received: from mail.braincells.com (samadhi.braincells.com [216.162.42.100])
	by danu.procontrol.fi (Postfix) with ESMTP id 3B7D1238C3
	for <dovecot@procontrol.fi>; Fri, 17 Jan 2003 05:11:33 +0200 (EET)
Received: from localhost (localhost [127.0.0.1])
	by mail.braincells.com (Postfix) with ESMTP id 031428010
	for <dovecot@procontrol.fi>; Thu, 16 Jan 2003 22:11:34 -0500 (EST)
Date: Thu, 16 Jan 2003 22:11:34 -0500 (EST)
From: "Jaldhar H. Vyas" <jaldhar@debian.org>
X-X-Sender: jaldhar@samadhi.braincells.com
Reply-To: "Jaldhar H. Vyas" <jaldhar@debian.org>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: 0.99.7 out
In-Reply-To: <1042642198.8610.173.camel@hurina>
Message-ID: <Pine.LNX.4.51.0301162208400.6460@samadhi.braincells.com>
References: <5.2.0.9.0.20030115094314.02f263c8@beta.mediatraffic.fi>
 <1042642198.8610.173.camel@hurina>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 233
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jaldhar@debian.org
Precedence: bulk
X-list: dovecot
X-UID: 233                                                  
Status: O

On Wed, 15 Jan 2003, Timo Sirainen wrote:

> > Deb-build failed (woody-debian) at vpopmail.c like parse errors.
> > Source download from: deb-src http://src.braincells.com/debian woody/
>
> Yes, so it seems. This patch fixes it:
>

So I imagined the .debs I put up on my site??????

Weird. Very weird.

Should I update the packages with the patch or will it be ok to wait for
the next stable release?

-- 
Jaldhar H. Vyas <jaldhar@debian.org>

From mw@lanfear.com  Fri Jan 17 07:56:49 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 17 Jan 2003 07:56:49 +0200 (EET)
Return-Path: <mw@lanfear.com>
Delivered-To: dovecot@procontrol.fi
Received: from akira.lanfear.com (akira.lanfear.com [216.168.61.84])
	by danu.procontrol.fi (Postfix) with SMTP id E0BDE238C3
	for <dovecot@procontrol.fi>; Fri, 17 Jan 2003 07:56:48 +0200 (EET)
Received: (qmail 94368 invoked from network); 17 Jan 2003 05:56:47 -0000
Received: from localhost.lanfear.com (HELO localhost) (127.0.0.1)
  by localhost.lanfear.com with SMTP; 17 Jan 2003 05:56:47 -0000
Subject: [dovecot] Unable to Log in on FreeBSD server?
From: Mark <mw@lanfear.com>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
X-Mailer: Ximian Evolution 1.0.8 
Date: 16 Jan 2003 21:56:57 -0800
Message-Id: <1042783017.5740.9.camel@donburi>
Mime-Version: 1.0
X-archive-position: 234
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mw@lanfear.com
Precedence: bulk
X-list: dovecot
X-UID: 234                                                  
Status: O
Content-Length: 1118



Hello!

I recently compiled dovecot 0.99.7 on a FreeBSD 4.3 server, and have
been having problems with logging in and password authentication.

a. I can't seem to get it to compile MD5 support -- it only seems to
support plain, plain-file, and pam.  

b. Whenever I try to log in, I always get something along the following
lines in /var/log/messages ....


Jan 16 17:52:15 akira imap-login: close(master) failed: Bad file
descriptor
Jan 16 17:55:33 akira imap-auth: Userinfo pam doesn't support DIGEST-MD5
method
Jan 16 18:08:28 akira imap-master: Login process died too early -
shutting down

(I also included one about MD5 in there too! :-))

Basically, the imap-login process is dying every time I try to do a
login from a remote machine (I've tried Evolution and Outlook Express
....)  I've tried telling it to use port 143 and port 993 (where it
correctly generates a warning about a certificate that it can't verify,
since i created that certificate with mkcert.sh )


Is there something I haven't configured correctly? The only things I've
changed in dovecot.conf are:


Any suggestions?

Thanks,

Marc.





From tss@iki.fi  Fri Jan 17 13:59:12 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 17 Jan 2003 13:59:12 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 177EE238C3
	for <dovecot@procontrol.fi>; Fri, 17 Jan 2003 13:59:12 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id DAEB05E01F60; Fri, 17 Jan 2003 13:59:11 +0200 (EET)
Subject: [dovecot] Re: 0.99.7 out
From: Timo Sirainen <tss@iki.fi>
To: "Jaldhar H. Vyas" <jaldhar@debian.org>
Cc: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.51.0301162208400.6460@samadhi.braincells.com>
References: <5.2.0.9.0.20030115094314.02f263c8@beta.mediatraffic.fi>
	 <1042642198.8610.173.camel@hurina>
	 <Pine.LNX.4.51.0301162208400.6460@samadhi.braincells.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1042804751.8602.222.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 17 Jan 2003 13:59:11 +0200
X-archive-position: 235
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 235                                                  
Status: O

On Fri, 2003-01-17 at 05:11, Jaldhar H. Vyas wrote:
> On Wed, 15 Jan 2003, Timo Sirainen wrote:
> 
> > > Deb-build failed (woody-debian) at vpopmail.c like parse errors.
> > > Source download from: deb-src http://src.braincells.com/debian woody/
> >
> > Yes, so it seems. This patch fixes it:
> >
> 
> So I imagined the .debs I put up on my site??????
> 
> Weird. Very weird.
> 
> Should I update the packages with the patch or will it be ok to wait for
> the next stable release?

You just didn't build the debs with vpopmail support. Probably shouldn't
either, it'd require extra libraries to be linked with.


From tss@iki.fi  Fri Jan 17 14:06:50 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 17 Jan 2003 14:06:50 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 2C6C323837
	for <dovecot@procontrol.fi>; Fri, 17 Jan 2003 14:06:50 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id EB70D5E01F60; Fri, 17 Jan 2003 14:06:49 +0200 (EET)
Subject: [dovecot] Re: Unable to Log in on FreeBSD server?
From: Timo Sirainen <tss@iki.fi>
To: Mark <mw@lanfear.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <1042783017.5740.9.camel@donburi>
References: <1042783017.5740.9.camel@donburi>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1042805209.8610.230.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 17 Jan 2003 14:06:49 +0200
X-archive-position: 236
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 236                                                  
Status: O

On Fri, 2003-01-17 at 07:56, Mark wrote:
> I recently compiled dovecot 0.99.7 on a FreeBSD 4.3 server, and have
> been having problems with logging in and password authentication.
> 
> a. I can't seem to get it to compile MD5 support -- it only seems to
> support plain, plain-file, and pam.  

Do you mean Digest-MD5? That's an authentication mechanism, like plain.
PAM and passwd-file are different things, they're used to check if
password is correct.

> b. Whenever I try to log in, I always get something along the following
> lines in /var/log/messages ....
> 
> 
> Jan 16 17:55:33 akira imap-auth: Userinfo pam doesn't support DIGEST-MD5
> method

PAM and Digest-MD5 can't work together, so it complains. Digest-MD5
requires that the passwords are stored in special format, currently
supported only by passwd-file.


From tss@iki.fi  Fri Jan 17 14:37:32 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 17 Jan 2003 14:37:32 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 56AA923837
	for <dovecot@procontrol.fi>; Fri, 17 Jan 2003 14:37:32 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 239435E01F60; Fri, 17 Jan 2003 14:37:32 +0200 (EET)
Subject: [dovecot] Plain auth broken
From: Timo Sirainen <tss@iki.fi>
To: james broermann <james@hwr.arizona.edu>
Cc: dovecot@procontrol.fi
In-Reply-To: <1042805732.8610.235.camel@hurina>
References: <Pine.LNX.4.52.0301131838330.14774@kyanite.hwr.arizona.edu>
	 <1042509723.8609.113.camel@hurina>
	 <Pine.LNX.4.52.0301141731000.15973@kyanite.hwr.arizona.edu>
	 <1042592701.8610.171.camel@hurina>
	 <Pine.LNX.4.52.0301141830500.15973@kyanite.hwr.arizona.edu>
	 <1042668222.8602.203.camel@hurina>
	 <Pine.LNX.4.52.0301151505210.16969@kyanite.hwr.arizona.edu>
	 <Pine.LNX.4.52.0301151819050.16969@kyanite.hwr.arizona.edu>
	 <1042805732.8610.235.camel@hurina>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1042807051.8610.243.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 17 Jan 2003 14:37:32 +0200
X-archive-position: 237
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 237                                                  
Status: O

On Fri, 2003-01-17 at 14:15, Timo Sirainen wrote:
> On Thu, 2003-01-16 at 03:31, james broermann wrote:
> > pine still doesn't want to work.  It does detect that the server is using
> > plain text passwords.  I'll try the sniffer and see what turns up.
> 
> Whops, you're right. I've tested pine only with digest-md5
> authentication before. Looks like my PLAIN authentication isn't working
> properly. Normally other clients just use LOGIN command which is
> different.

Patch is now available at http://dovecot.procontrol.fi/

From pekka.jalonen@mediatraffic.fi  Fri Jan 17 18:02:30 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 17 Jan 2003 18:02:30 +0200 (EET)
Return-Path: <pekka.jalonen@mediatraffic.fi>
Delivered-To: dovecot@procontrol.fi
Received: from mx1.lansilinkki.net (mx1.lansilinkki.net [212.83.96.242])
	by danu.procontrol.fi (Postfix) with ESMTP id D8FE323837
	for <dovecot@procontrol.fi>; Fri, 17 Jan 2003 18:02:30 +0200 (EET)
Received: from zool.mediatraffic.fi (xdsl-228.mediatraffic.fi [212.83.107.228])
	by mx1.lansilinkki.net (8.11.4/8.11.2) with ESMTP id h0HG2Gf18256;
	Fri, 17 Jan 2003 18:02:16 +0200 (EET)
Message-Id: <5.2.0.9.0.20030117175726.00d42988@beta.mediatraffic.fi>
X-Sender: peja@beta.mediatraffic.fi
X-Mailer: QUALCOMM Windows Eudora Version 5.2.0.9
Date: Fri, 17 Jan 2003 18:02:17 +0200
To: Timo Sirainen <tss@iki.fi>,
	"Jaldhar H. Vyas" <jaldhar@debian.org>
From: Pekka Jalonen <pekka.jalonen@mediatraffic.fi>
Subject: [dovecot] Re: 0.99.7 out
Cc: dovecot@procontrol.fi
In-Reply-To: <1042804751.8602.222.camel@hurina>
References: <Pine.LNX.4.51.0301162208400.6460@samadhi.braincells.com>
 <5.2.0.9.0.20030115094314.02f263c8@beta.mediatraffic.fi>
 <1042642198.8610.173.camel@hurina>
 <Pine.LNX.4.51.0301162208400.6460@samadhi.braincells.com>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"; format=flowed
X-archive-position: 238
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: pekka.jalonen@mediatraffic.fi
Precedence: bulk
X-list: dovecot
X-UID: 238                                                  
Status: O

At 13:59 17.1.2003 +0200, Timo Sirainen wrote:
>On Fri, 2003-01-17 at 05:11, Jaldhar H. Vyas wrote:
> > On Wed, 15 Jan 2003, Timo Sirainen wrote:
> >
> > > > Deb-build failed (woody-debian) at vpopmail.c like parse errors.
> > > > Source download from: deb-src http://src.braincells.com/debian woody/
> > >
> > > Yes, so it seems. This patch fixes it:
> > >
> >
> > So I imagined the .debs I put up on my site??????
> >
> > Weird. Very weird.
> >
> > Should I update the packages with the patch or will it be ok to wait for
> > the next stable release?
>
>You just didn't build the debs with vpopmail support. Probably shouldn't
>either, it'd require extra libraries to be linked with.

I build my own debs so configure found vpopmail libs....

'checking for vpopmail configuration at /home/vpopmail/etc/lib_deps... found'

Hmm what extra libs I need to build to deb-packages?

--
peja


From jaldhar@debian.org  Fri Jan 17 18:08:35 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 17 Jan 2003 18:08:35 +0200 (EET)
Return-Path: <jaldhar@debian.org>
Delivered-To: dovecot@procontrol.fi
Received: from mail.braincells.com (samadhi.braincells.com [216.162.42.100])
	by danu.procontrol.fi (Postfix) with ESMTP id 7CFF923837
	for <dovecot@procontrol.fi>; Fri, 17 Jan 2003 18:08:35 +0200 (EET)
Received: from localhost (localhost [127.0.0.1])
	by mail.braincells.com (Postfix) with ESMTP
	id 0A1628010; Fri, 17 Jan 2003 11:08:34 -0500 (EST)
Date: Fri, 17 Jan 2003 11:08:34 -0500 (EST)
From: "Jaldhar H. Vyas" <jaldhar@debian.org>
X-X-Sender: jaldhar@samadhi.braincells.com
Reply-To: "Jaldhar H. Vyas" <jaldhar@debian.org>
To: Pekka Jalonen <pekka.jalonen@mediatraffic.fi>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: 0.99.7 out
In-Reply-To: <5.2.0.9.0.20030117175726.00d42988@beta.mediatraffic.fi>
Message-ID: <Pine.LNX.4.51.0301171103160.11932@samadhi.braincells.com>
References: <Pine.LNX.4.51.0301162208400.6460@samadhi.braincells.com>
 <5.2.0.9.0.20030115094314.02f263c8@beta.mediatraffic.fi> <1042642198.8610.173.camel@hurina>
 <Pine.LNX.4.51.0301162208400.6460@samadhi.braincells.com>
 <5.2.0.9.0.20030117175726.00d42988@beta.mediatraffic.fi>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 239
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jaldhar@debian.org
Precedence: bulk
X-list: dovecot
X-UID: 239                                                  
Status: O

On Fri, 17 Jan 2003, Pekka Jalonen wrote:

>
> I build my own debs so configure found vpopmail libs....
>
> 'checking for vpopmail configuration at /home/vpopmail/etc/lib_deps... found'
>

Ok now I understand.

> Hmm what extra libs I need to build to deb-packages?
>

I think Timo meant there would have to be an extra dependency on
libvpopmail1.  I don't want to do that for the main dovecot package as for
most people it would just be extra bloat but I'll consider making an extra
dovecot-vpopmail package.  That will have to wait for -3 though as new
packages cause a delay in entering the archive and I want to get -2 with
the patches installed quickly.

-- 
Jaldhar H. Vyas <jaldhar@debian.org>

From james@hwr.arizona.edu  Fri Jan 17 23:52:23 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 17 Jan 2003 23:52:23 +0200 (EET)
Return-Path: <james@hwr.arizona.edu>
Delivered-To: dovecot@procontrol.fi
Received: from mail1.hwr.arizona.edu (mail1.hwr.Arizona.EDU [128.196.72.31])
	by danu.procontrol.fi (Postfix) with ESMTP id 39F83238C3
	for <dovecot@procontrol.fi>; Fri, 17 Jan 2003 23:52:23 +0200 (EET)
Received: from mail1 (localhost [127.0.0.1])
	by mail1.hwr.arizona.edu (8.12.7/8.12.7) with ESMTP id h0HLqBXW021558
	for <dovecot@procontrol.fi>; Fri, 17 Jan 2003 14:52:11 -0700 (MST)
Date: Fri, 17 Jan 2003 14:48:23 -0700 (MST)
From: james broermann <james@hwr.arizona.edu>
To: dovecot@procontrol.fi
Subject: [dovecot] mbox & Maildir
Message-ID: <Pine.LNX.4.52.0301171439550.19329@kyanite.hwr.arizona.edu>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 240
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: james@hwr.arizona.edu
Precedence: bulk
X-list: dovecot
X-UID: 240                                                  
Status: O

Hi,

Is it possible for a client to read both mbox and Maildir formats from one
server running dovecot?

Without changing default_mail_env in dovecot.conf, Maildir folders are
working ... they're located in ~/Maildir. No /var/mail/username exists.  I
have mbox format folders in ~/mail and have been trying to get pine to find
them by adding pine folder collections. I always end up back in ~/Maildir,
though.

Thanks, Jim


From tss@iki.fi  Sat Jan 18 02:05:51 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 18 Jan 2003 02:05:51 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id AA7B523837
	for <dovecot@procontrol.fi>; Sat, 18 Jan 2003 02:05:51 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 6EB675E01F60; Sat, 18 Jan 2003 02:05:50 +0200 (EET)
Subject: [dovecot] Re: mbox & Maildir
From: Timo Sirainen <tss@iki.fi>
To: james broermann <james@hwr.arizona.edu>
Cc: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.52.0301171439550.19329@kyanite.hwr.arizona.edu>
References: <Pine.LNX.4.52.0301171439550.19329@kyanite.hwr.arizona.edu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1042848350.11439.6.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 18 Jan 2003 02:05:50 +0200
X-archive-position: 241
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 241                                                  
Status: O

On Fri, 2003-01-17 at 23:48, james broermann wrote:
> Is it possible for a client to read both mbox and Maildir formats from one
> server running dovecot?
> 
> Without changing default_mail_env in dovecot.conf, Maildir folders are
> working ... they're located in ~/Maildir. No /var/mail/username exists.  I
> have mbox format folders in ~/mail and have been trying to get pine to find
> them by adding pine folder collections. I always end up back in ~/Maildir,
> though.

Within same session it's currently not possible to use both mbox and
maildir folders. Different users could access both mbox and maildir with
the autodetection code (~/Maildir if exists, fallbacks to ~/mail).

Accessing both with same user would mostly be a configuration and
namespace issue. I'd rather not add code for those before supporting
shared folders.


From amyzing@talsever.com  Sat Jan 18 19:01:48 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 18 Jan 2003 19:01:48 +0200 (EET)
Return-Path: <amyzing@talsever.com>
Delivered-To: dovecot@procontrol.fi
Received: from mclean.mail.mindspring.net (mclean.mail.mindspring.net [207.69.200.57])
	by danu.procontrol.fi (Postfix) with ESMTP id 42811238C3
	for <dovecot@procontrol.fi>; Sat, 18 Jan 2003 19:01:48 +0200 (EET)
Received: from user-2ivf46j.dialup.mindspring.com ([165.247.144.211] helo=marajen.talsever.com)
	by mclean.mail.mindspring.net with esmtp (Exim 3.33 #1)
	id 18ZwLk-0004BY-00; Sat, 18 Jan 2003 12:01:40 -0500
Received: from ythgin.talsever.com (ythgin.talsever.com [192.168.0.20])
	by marajen.talsever.com (Postfix) with SMTP
	id 976628044; Sat, 18 Jan 2003 12:03:30 -0500 (EST)
Date: Sat, 18 Jan 2003 12:01:37 -0500
From: Amelia A.Lewis <amyzing@talsever.com>
To: Timo Sirainen <tss@iki.fi>
Cc: james@hwr.arizona.edu, dovecot@procontrol.fi
Subject: [dovecot] Re: Plain auth broken
Message-Id: <20030118120137.794e417b.amyzing@talsever.com>
In-Reply-To: <1042807051.8610.243.camel@hurina>
References: <Pine.LNX.4.52.0301131838330.14774@kyanite.hwr.arizona.edu>
	<1042509723.8609.113.camel@hurina>
	<Pine.LNX.4.52.0301141731000.15973@kyanite.hwr.arizona.edu>
	<1042592701.8610.171.camel@hurina>
	<Pine.LNX.4.52.0301141830500.15973@kyanite.hwr.arizona.edu>
	<1042668222.8602.203.camel@hurina>
	<Pine.LNX.4.52.0301151505210.16969@kyanite.hwr.arizona.edu>
	<Pine.LNX.4.52.0301151819050.16969@kyanite.hwr.arizona.edu>
	<1042805732.8610.235.camel@hurina>
	<1042807051.8610.243.camel@hurina>
Organization: The Mysthical World of Talsever!
X-Mailer: Sylpheed version 0.8.8 (GTK+ 1.2.10; i386-debian-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-archive-position: 242
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: amyzing@talsever.com
Precedence: bulk
X-list: dovecot
X-UID: 242                                                  
Status: O
Content-Length: 1201

On 17 Jan 2003 14:37:32 +0200
Timo Sirainen <tss@iki.fi> wrote:

> On Fri, 2003-01-17 at 14:15, Timo Sirainen wrote:
> > On Thu, 2003-01-16 at 03:31, james broermann wrote:
> > > pine still doesn't want to work.  It does detect that the server
> > > is using plain text passwords.  I'll try the sniffer and see what
> > > turns up.
> > 
> > Whops, you're right. I've tested pine only with digest-md5
> > authentication before. Looks like my PLAIN authentication isn't
> > working properly. Normally other clients just use LOGIN command
> > which is different.
> 
> Patch is now available at http://dovecot.procontrol.fi/

Hmm.

I'm running the debian package 0.99.7-2.  If I turn off SSL, and allow
plaintext, I can log in.  If I turn SSL on (comment out ssl_diable =
yes), then I can't.  It was working in 0.99.6, I know.

Same situation using 0.99.7-1 alpha (it takes longer for alpha builds to
make it into debian).

I can provide more information, as necessary.  All that's logged is
"disconnected for inactivity".  Monitoring via tcpdump doesn't seem too
useful, given that TLS is negotiated.

Amy! 
-- 
Amelia A. Lewis                    amyzing {at} talsever.com
Igne natura renovatur integra.

From mw@lanfear.com  Sat Jan 18 21:56:28 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 18 Jan 2003 21:56:28 +0200 (EET)
Return-Path: <mw@lanfear.com>
Delivered-To: dovecot@procontrol.fi
Received: from akira.lanfear.com (akira.lanfear.com [216.168.61.84])
	by danu.procontrol.fi (Postfix) with SMTP id D1D83238C3
	for <dovecot@procontrol.fi>; Sat, 18 Jan 2003 21:56:27 +0200 (EET)
Received: (qmail 17378 invoked from network); 18 Jan 2003 19:56:25 -0000
Received: from localhost.lanfear.com (HELO localhost) (127.0.0.1)
  by localhost.lanfear.com with SMTP; 18 Jan 2003 19:56:25 -0000
Subject: [dovecot] Re: Unable to Log in on FreeBSD server?
From: Mark <mw@lanfear.com>
To: Timo Sirainen <tss@iki.fi>
Cc: dovecot@procontrol.fi
In-Reply-To: <1042805209.8610.230.camel@hurina>
References: <1042783017.5740.9.camel@donburi> 
	<1042805209.8610.230.camel@hurina>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
X-Mailer: Ximian Evolution 1.0.8 
Date: 18 Jan 2003 11:56:33 -0800
Message-Id: <1042919794.7750.17.camel@donburi>
Mime-Version: 1.0
X-archive-position: 243
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mw@lanfear.com
Precedence: bulk
X-list: dovecot
X-UID: 243                                                  
Status: O
Content-Length: 1616


 I was more just asking about the other problems (I can worry about MD5
later ...).  Even with the 99.7-2 patch, I cannot get any logins to work
to my server.  I always get the

"Authentication process died" message on my client, and messages in my
/var/log/mess such as:


Jan 16 17:52:15 akira imap-login: close(master) failed: Bad file
descriptor
Jan 16 18:08:28 akira imap-master: Login process died too early -
shutting down


- I can only connect to port 993, not 143
- I have the following changes in my dovecot.conf:

default_mail_env = mbox:~/.imapmail:INBOX=~/Mailbox
# (incoming mail is ~/Mailbox, I want mail in ~/.imapmail)



Any ideas at all?

Thanks much!

ciao,
mark.





On Fri, 2003-01-17 at 04:06, Timo Sirainen wrote:
> On Fri, 2003-01-17 at 07:56, Mark wrote:
> > I recently compiled dovecot 0.99.7 on a FreeBSD 4.3 server, and have
> > been having problems with logging in and password authentication.
> > 
> > a. I can't seem to get it to compile MD5 support -- it only seems to
> > support plain, plain-file, and pam.  
> 
> Do you mean Digest-MD5? That's an authentication mechanism, like plain.
> PAM and passwd-file are different things, they're used to check if
> password is correct.
> 
> > b. Whenever I try to log in, I always get something along the following
> > lines in /var/log/messages ....
> > 
> > 
> > Jan 16 17:55:33 akira imap-auth: Userinfo pam doesn't support DIGEST-MD5
> > method
> 
> PAM and Digest-MD5 can't work together, so it complains. Digest-MD5
> requires that the passwords are stored in special format, currently
> supported only by passwd-file.
> 
> 
> 



From tss@iki.fi  Sat Jan 18 22:20:56 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 18 Jan 2003 22:20:56 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 2A51823837
	for <dovecot@procontrol.fi>; Sat, 18 Jan 2003 22:20:56 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 7F92E5E01F96; Sat, 18 Jan 2003 22:20:55 +0200 (EET)
Subject: [dovecot] Re: Unable to Log in on FreeBSD server?
From: Timo Sirainen <tss@iki.fi>
To: Mark <mw@lanfear.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <1042919794.7750.17.camel@donburi>
References: <1042783017.5740.9.camel@donburi>
	 <1042805209.8610.230.camel@hurina>  <1042919794.7750.17.camel@donburi>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1042921255.11444.64.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 18 Jan 2003 22:20:55 +0200
X-archive-position: 244
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 244                                                  
Status: O

On Sat, 2003-01-18 at 21:56, Mark wrote:
> Jan 16 17:52:15 akira imap-login: close(master) failed: Bad file
> descriptor
> Jan 16 18:08:28 akira imap-master: Login process died too early -
> shutting down

Well, if those happen all the time, it's not because of the
configuration. FreeBSD 4.3 is a bit old, but I'd think it supports
everything that Dovecot wants. Hard to say, that'd require some
debugging with the system..

> "Authentication process died" message on my client, and messages in my
> /var/log/mess such as:

It doesn't say anything about auth process in log files?


From mw@lanfear.com  Sun Jan 19 05:36:30 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 19 Jan 2003 05:36:30 +0200 (EET)
Return-Path: <mw@lanfear.com>
Delivered-To: dovecot@procontrol.fi
Received: from akira.lanfear.com (akira.lanfear.com [216.168.61.84])
	by danu.procontrol.fi (Postfix) with SMTP id 39576238C3
	for <dovecot@procontrol.fi>; Sun, 19 Jan 2003 05:36:29 +0200 (EET)
Received: (qmail 25432 invoked from network); 19 Jan 2003 03:36:27 -0000
Received: from localhost.lanfear.com (HELO localhost) (127.0.0.1)
  by localhost.lanfear.com with SMTP; 19 Jan 2003 03:36:27 -0000
Subject: [dovecot] Re: Unable to Log in on FreeBSD server?
From: Mark <mw@lanfear.com>
To: Timo Sirainen <tss@iki.fi>
Cc: dovecot@procontrol.fi
In-Reply-To: <1042921255.11444.64.camel@hurina>
References: <1042783017.5740.9.camel@donburi>
	<1042805209.8610.230.camel@hurina>  <1042919794.7750.17.camel@donburi> 
	<1042921255.11444.64.camel@hurina>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
X-Mailer: Ximian Evolution 1.0.8 
Date: 18 Jan 2003 19:36:43 -0800
Message-Id: <1042947403.1373.4.camel@donburi>
Mime-Version: 1.0
X-archive-position: 245
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mw@lanfear.com
Precedence: bulk
X-list: dovecot
X-UID: 245                                                  
Status: O
Content-Length: 1263


I recently recompiled with --enable-asserts and --enable-debug, and I
when trying to log in to either port 143 or port 993 using Outlook
Express, the following happens:

1. Outlook Express complains that the authentication failed with "Login
Process died unexpectedly"
2. The imap-master and all other processes die on my FreeBSD machine.
3. I see the following in the logs:

Jan 18 19:32:21 akira imap-master: Login process died too early -
shutting down


That's it.   Btw -- FreeBSD 4.3 isn't all that old -- perhaps 18
months.  I've had uptimes longer than that !! :-)


ciao,
mark.


On Sat, 2003-01-18 at 12:20, Timo Sirainen wrote:
> On Sat, 2003-01-18 at 21:56, Mark wrote:
> > Jan 16 17:52:15 akira imap-login: close(master) failed: Bad file
> > descriptor
> > Jan 16 18:08:28 akira imap-master: Login process died too early -
> > shutting down
> 
> Well, if those happen all the time, it's not because of the
> configuration. FreeBSD 4.3 is a bit old, but I'd think it supports
> everything that Dovecot wants. Hard to say, that'd require some
> debugging with the system..
> 
> > "Authentication process died" message on my client, and messages in my
> > /var/log/mess such as:
> 
> It doesn't say anything about auth process in log files?
> 
> 
> 



From tss@iki.fi  Tue Jan 21 09:43:08 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 21 Jan 2003 09:43:08 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 7D3AA238C5
	for <dovecot@procontrol.fi>; Tue, 21 Jan 2003 09:43:07 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id BE12C5E01F96; Tue, 21 Jan 2003 09:43:06 +0200 (EET)
Subject: [dovecot] Re: Plain auth broken
From: Timo Sirainen <tss@iki.fi>
To: "Amelia A.Lewis" <amyzing@talsever.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030118120137.794e417b.amyzing@talsever.com>
References: <Pine.LNX.4.52.0301131838330.14774@kyanite.hwr.arizona.edu>
	 <1042509723.8609.113.camel@hurina>
	 <Pine.LNX.4.52.0301141731000.15973@kyanite.hwr.arizona.edu>
	 <1042592701.8610.171.camel@hurina>
	 <Pine.LNX.4.52.0301141830500.15973@kyanite.hwr.arizona.edu>
	 <1042668222.8602.203.camel@hurina>
	 <Pine.LNX.4.52.0301151505210.16969@kyanite.hwr.arizona.edu>
	 <Pine.LNX.4.52.0301151819050.16969@kyanite.hwr.arizona.edu>
	 <1042805732.8610.235.camel@hurina> <1042807051.8610.243.camel@hurina>
	 <20030118120137.794e417b.amyzing@talsever.com>
Content-Type: multipart/mixed; boundary="=-Jf/Oz1qqyUMq6k680+bK"
Organization: 
Message-Id: <1043134986.11439.337.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 21 Jan 2003 09:43:06 +0200
X-archive-position: 246
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 246                                                  
Status: O
Content-Length: 15348


--=-Jf/Oz1qqyUMq6k680+bK
Content-Type: text/plain
Content-Transfer-Encoding: 7bit

On Sat, 2003-01-18 at 19:01, Amelia A.Lewis wrote:
> I'm running the debian package 0.99.7-2.  If I turn off SSL, and allow
> plaintext, I can log in.  If I turn SSL on (comment out ssl_diable =
> yes), then I can't.  It was working in 0.99.6, I know.

If it was working in .6, I can't think of what could have broken. But
here's a patch for more verbose logging if "auth_verbose = yes" in
config file.


--=-Jf/Oz1qqyUMq6k680+bK
Content-Disposition: attachment; filename=verbose.diff
Content-Type: text/x-patch; name=verbose.diff; charset=ISO-8859-15
Content-Transfer-Encoding: quoted-printable

diff -ru dovecot-0.99.7/src/auth/auth-digest-md5.c dovecot-0.99.7p1/src/aut=
h/auth-digest-md5.c
--- dovecot-0.99.7/src/auth/auth-digest-md5.c	2003-01-11 21:55:56.000000000=
 +0200
+++ dovecot-0.99.7p1/src/auth/auth-digest-md5.c	2003-01-21 09:39:28.0000000=
00 +0200
@@ -195,8 +195,14 @@
=20
 		if (i =3D=3D 0) {
 			/* verify response */
-			if (memcmp(response_hex, auth->response, 32) !=3D 0)
+			if (memcmp(response_hex, auth->response, 32) !=3D 0) {
+				if (verbose) {
+					i_info("digest-md5(%s): "
+					       "password mismatch",
+					       auth->username);
+				}
 				return FALSE;
+			}
 		} else {
 			auth->rspauth =3D p_strconcat(auth->pool, "rspauth=3D",
 						    response_hex, NULL);
@@ -506,7 +512,7 @@
 		auth->qop_value =3D p_strdup(auth->pool, "auth");
=20
 	if (!failed && !verify_auth(auth)) {
-		*error =3D "Authentication failed";
+		*error =3D NULL;
 		failed =3D TRUE;
 	}
=20
@@ -557,6 +563,11 @@
 		return;
 	}
=20
+	if (error =3D=3D NULL)
+                error =3D "Authentication failed";
+	else if (verbose)
+		i_info("digest-md5: %s", error);
+
 	/* failed */
 	reply.result =3D AUTH_RESULT_FAILURE;
 	callback(&reply, error, context);
diff -ru dovecot-0.99.7/src/auth/common.h dovecot-0.99.7p1/src/auth/common.=
h
--- dovecot-0.99.7/src/auth/common.h	2003-01-05 15:09:51.000000000 +0200
+++ dovecot-0.99.7p1/src/auth/common.h	2003-01-21 09:39:28.000000000 +0200
@@ -8,5 +8,6 @@
 #define LOGIN_LISTEN_FD 3
=20
 extern struct ioloop *ioloop;
+extern int verbose;
=20
 #endif
diff -ru dovecot-0.99.7/src/auth/login-connection.c dovecot-0.99.7p1/src/au=
th/login-connection.c
--- dovecot-0.99.7/src/auth/login-connection.c	2003-01-05 17:19:50.00000000=
0 +0200
+++ dovecot-0.99.7p1/src/auth/login-connection.c	2003-01-21 09:39:28.000000=
000 +0200
@@ -84,6 +84,10 @@
 		login_connection_destroy(conn);
 	} else {
 		conn->pid =3D rec.pid;
+		if (verbose) {
+			i_info("Login process %d sent handshake: PID %s",
+			       conn->fd, dec2str(conn->pid));
+		}
 	}
 }
=20
@@ -173,6 +177,9 @@
 {
 	struct login_connection *conn;
=20
+	if (verbose)
+		i_info("Login process %d connected", fd);
+
 	conn =3D i_new(struct login_connection, 1);
=20
 	conn->fd =3D fd;
@@ -199,6 +206,9 @@
 {
 	struct login_connection **pos;
=20
+	if (verbose)
+		i_info("Login process %d disconnected", conn->fd);
+
 	for (pos =3D &connections; *pos !=3D NULL; pos =3D &(*pos)->next) {
 		if (*pos =3D=3D conn) {
 			*pos =3D conn->next;
diff -ru dovecot-0.99.7/src/auth/main.c dovecot-0.99.7p1/src/auth/main.c
--- dovecot-0.99.7/src/auth/main.c	2003-01-08 23:13:05.000000000 +0200
+++ dovecot-0.99.7p1/src/auth/main.c	2003-01-21 09:39:28.000000000 +0200
@@ -17,6 +17,8 @@
 #include <syslog.h>
=20
 struct ioloop *ioloop;
+int verbose =3D FALSE;
+
 static struct io *io_listen;
=20
 static void sig_quit(int signo __attr_unused__)
@@ -69,6 +71,8 @@
 {
 	lib_init_signals(sig_quit);
=20
+	verbose =3D getenv("VERBOSE") !=3D NULL;
+
 	auth_init();
 	cookies_init();
 	login_connections_init();
diff -ru dovecot-0.99.7/src/auth/userinfo-pam.c dovecot-0.99.7p1/src/auth/u=
serinfo-pam.c
--- dovecot-0.99.7/src/auth/userinfo-pam.c	2003-01-05 15:09:51.000000000 +0=
200
+++ dovecot-0.99.7p1/src/auth/userinfo-pam.c	2003-01-21 09:39:28.000000000 =
+0200
@@ -148,25 +148,45 @@
 	return PAM_SUCCESS;
 }
=20
-static int pam_auth(pam_handle_t *pamh)
+static int pam_auth(pam_handle_t *pamh, const char *user)
 {
 	char *item;
 	int status;
=20
-	if ((status =3D pam_authenticate(pamh, 0)) !=3D PAM_SUCCESS)
+	if ((status =3D pam_authenticate(pamh, 0)) !=3D PAM_SUCCESS) {
+		if (verbose) {
+			i_info("PAM: pam_authenticate(%s) failed: %s",
+			       user, pam_strerror(pamh, status));
+		}
 		return status;
+	}
=20
 #ifdef HAVE_PAM_SETCRED
-	if ((status =3D pam_setcred(pamh, PAM_ESTABLISH_CRED)) !=3D PAM_SUCCESS)
+	if ((status =3D pam_setcred(pamh, PAM_ESTABLISH_CRED)) !=3D PAM_SUCCESS) =
{
+		if (verbose) {
+			i_info("PAM: pam_setcred(%s) failed: %s",
+			       user, pam_strerror(pamh, status));
+		}
 		return status;
+	}
 #endif
=20
-	if ((status =3D pam_acct_mgmt(pamh, 0)) !=3D PAM_SUCCESS)
+	if ((status =3D pam_acct_mgmt(pamh, 0)) !=3D PAM_SUCCESS) {
+		if (verbose) {
+			i_info("PAM: pam_acct_mgmt(%s) failed: %s",
+			       user, pam_strerror(pamh, status));
+		}
 		return status;
+	}
=20
 	status =3D pam_get_item(pamh, PAM_USER, (linux_const void **)&item);
-	if (status !=3D PAM_SUCCESS)
+	if (status !=3D PAM_SUCCESS) {
+		if (verbose) {
+			i_info("PAM: pam_get_item(%s) failed: %s",
+			       user, pam_strerror(pamh, status));
+		}
 		return status;
+	}
=20
 	return PAM_SUCCESS;
 }
@@ -187,12 +207,18 @@
 	userpass.pass =3D password;
=20
 	status =3D pam_start(service_name, user, &conv, &pamh);
-	if (status !=3D PAM_SUCCESS)
+	if (status !=3D PAM_SUCCESS) {
+		if (verbose) {
+			i_info("PAM: pam_start(%s) failed: %s",
+			       user, pam_strerror(pamh, status));
+		}
 		return FALSE;
+	}
=20
-	status =3D pam_auth(pamh);
+	status =3D pam_auth(pamh, user);
 	if ((status2 =3D pam_end(pamh, status)) !=3D PAM_SUCCESS) {
-		i_error("pam_end() failed: %s", pam_strerror(pamh, status2));
+		i_error("pam_end(%s) failed: %s",
+			user, pam_strerror(pamh, status2));
 		return FALSE;
 	}
=20
@@ -201,8 +227,10 @@
=20
 	/* password ok, save the user info */
 	pw =3D getpwnam(user);
-	if (pw =3D=3D NULL)
+	if (pw =3D=3D NULL) {
+		i_error("PAM: getpwnam(%s) failed: %m", user);
 		return FALSE;
+	}
=20
 	safe_memset(pw->pw_passwd, 0, strlen(pw->pw_passwd));
 	passwd_fill_cookie_reply(pw, reply);
diff -ru dovecot-0.99.7/src/auth/userinfo-passwd-file.c dovecot-0.99.7p1/sr=
c/auth/userinfo-passwd-file.c
--- dovecot-0.99.7/src/auth/userinfo-passwd-file.c	2003-01-11 21:55:56.0000=
00000 +0200
+++ dovecot-0.99.7p1/src/auth/userinfo-passwd-file.c	2003-01-21 09:39:28.00=
0000000 +0200
@@ -67,8 +67,11 @@
 				  strlen(pu->realm) - 1);
=20
 		pw =3D getpwnam(user);
-		if (pw =3D=3D NULL)
+		if (pw =3D=3D NULL) {
+			i_error("passwd-file(%s): missing info and "
+				"not found with getpwnam()", user);
 			return FALSE;
+		}
=20
 		passwd_fill_cookie_reply(pw, reply);
 	}
@@ -115,21 +118,35 @@
=20
 	/* find it from all realms */
 	pu =3D hash_lookup(passwd_file->users, user);
-	if (pu =3D=3D NULL)
+	if (pu =3D=3D NULL) {
+		if (verbose)
+			i_info("passwd-file(%s): unknown user", user);
 		return FALSE;
+	}
=20
 	/* verify that password matches */
 	switch (pu->password_type) {
 	case PASSWORD_DES:
-		if (strcmp(mycrypt(password, pu->password), pu->password) !=3D 0)
+		if (strcmp(mycrypt(password, pu->password),
+			   pu->password) !=3D 0) {
+			if (verbose) {
+				i_info("passwd-file(%s): DES password mismatch",
+				       user);
+			}
 			return FALSE;
+		}
 		break;
 	case PASSWORD_MD5:
 		md5_get_digest(password, strlen(password), digest);
 		str =3D binary_to_hex(digest, sizeof(digest));
=20
-		if (strcmp(str, pu->password) !=3D 0)
+		if (strcmp(str, pu->password) !=3D 0) {
+			if (verbose) {
+				i_info("passwd-file(%s): MD5 password mismatch",
+				       user);
+			}
 			return FALSE;
+		}
 		break;
 	case PASSWORD_DIGEST_MD5:
 		/* user:realm:passwd */
@@ -140,8 +157,13 @@
 		md5_get_digest(str, strlen(str), digest);
 		str =3D binary_to_hex(digest, sizeof(digest));
=20
-		if (strcmp(str, pu->password) !=3D 0)
+		if (strcmp(str, pu->password) !=3D 0) {
+			if (verbose) {
+				i_info("passwd-file(%s): "
+				       "DIGEST-MD5 password mismatch", user);
+			}
 			return FALSE;
+		}
 		break;
 	default:
                 i_unreached();
@@ -167,16 +189,22 @@
 		t_strconcat(user, ":", realm, NULL);
=20
 	pu =3D hash_lookup(passwd_file->users, id);
-	if (pu =3D=3D NULL)
+	if (pu =3D=3D NULL) {
+		if (verbose)
+			i_info("passwd-file(%s): unknown user", user);
 		return FALSE;
+	}
=20
 	/* found */
 	i_assert(strlen(pu->password) =3D=3D 32);
=20
 	buf =3D buffer_create_data(data_stack_pool, digest, 16);
-	if (!hex_to_binary(pu->password, buf))
+	if (!hex_to_binary(pu->password, buf)) {
+		if (verbose)
+			i_info("passwd-file(%s): invalid password field", user);
 		return FALSE;
-=09
+	}
+
 	return get_reply_data(pu, reply);
 }
=20
diff -ru dovecot-0.99.7/src/auth/userinfo-passwd.c dovecot-0.99.7p1/src/aut=
h/userinfo-passwd.c
--- dovecot-0.99.7/src/auth/userinfo-passwd.c	2003-01-05 15:09:51.000000000=
 +0200
+++ dovecot-0.99.7p1/src/auth/userinfo-passwd.c	2003-01-21 09:39:28.0000000=
00 +0200
@@ -37,8 +37,21 @@
 	int result;
=20
 	pw =3D getpwnam(user);
-	if (pw =3D=3D NULL || !IS_VALID_PASSWD(pw->pw_passwd))
+	if (pw =3D=3D NULL) {
+		if (errno !=3D 0)
+			i_error("getpwnam(%s) failed: %m", user);
+		else if (verbose)
+			i_info("passwd(%s): unknown user", user);
 		return FALSE;
+	}
+
+	if (!IS_VALID_PASSWD(pw->pw_passwd)) {
+		if (verbose) {
+			i_info("passwd(%s): invalid password field '%s'",
+			       user, pw->pw_passwd);
+		}
+		return FALSE;
+	}
=20
 	/* check if the password is valid */
 	result =3D strcmp(mycrypt(password, pw->pw_passwd), pw->pw_passwd) =3D=3D=
 0;
@@ -46,8 +59,11 @@
 	/* clear the passwords from memory */
 	safe_memset(pw->pw_passwd, 0, strlen(pw->pw_passwd));
=20
-	if (!result)
+	if (!result) {
+		if (verbose)
+			i_info("passwd(%s): password mismatch", user);
 		return FALSE;
+	}
=20
 	/* password ok, save the user info */
         passwd_fill_cookie_reply(pw, reply);
diff -ru dovecot-0.99.7/src/auth/userinfo-shadow.c dovecot-0.99.7p1/src/aut=
h/userinfo-shadow.c
--- dovecot-0.99.7/src/auth/userinfo-shadow.c	2003-01-05 15:09:51.000000000=
 +0200
+++ dovecot-0.99.7p1/src/auth/userinfo-shadow.c	2003-01-21 09:39:28.0000000=
00 +0200
@@ -23,8 +23,21 @@
 	int result;
=20
 	spw =3D getspnam(user);
-	if (spw =3D=3D NULL || !IS_VALID_PASSWD(spw->sp_pwdp))
+	if (spw =3D=3D NULL) {
+		if (errno !=3D 0)
+			i_error("getspnam(%s) failed: %m", user);
+		else if (verbose)
+			i_info("shadow(%s): unknown user", user);
 		return FALSE;
+	}
+
+	if (!IS_VALID_PASSWD(spw->sp_pwdp)) {
+		if (verbose) {
+			i_info("shadow(%s): invalid password field '%s'",
+			       user, spw->sp_pwdp);
+		}
+		return FALSE;
+	}
=20
 	/* check if the password is valid */
 	result =3D strcmp(mycrypt(password, spw->sp_pwdp), spw->sp_pwdp) =3D=3D 0=
;
@@ -32,13 +45,18 @@
 	/* clear the passwords from memory */
 	safe_memset(spw->sp_pwdp, 0, strlen(spw->sp_pwdp));
=20
-	if (!result)
+	if (!result) {
+		if (verbose)
+			i_info("shadow(%s): password mismatch", user);
 		return FALSE;
+	}
=20
 	/* password ok, save the user info */
 	pw =3D getpwnam(user);
-	if (pw =3D=3D NULL)
+	if (pw =3D=3D NULL) {
+		i_error("shadow(%s): getpwnam() failed: %m", user);
 		return FALSE;
+	}
=20
         passwd_fill_cookie_reply(pw, reply);
 	return TRUE;
diff -ru dovecot-0.99.7/src/auth/userinfo-vpopmail.c dovecot-0.99.7p1/src/a=
uth/userinfo-vpopmail.c
--- dovecot-0.99.7/src/auth/userinfo-vpopmail.c	2003-01-05 15:09:51.0000000=
00 +0200
+++ dovecot-0.99.7p1/src/auth/userinfo-vpopmail.c	2003-01-21 09:39:28.00000=
0000 +0200
@@ -14,8 +14,6 @@
 #include <vpopmail.h>
 #include <vauth.h>
=20
-#define I_DEBUG(x) /* i_warning x */
-
 /* Limit user and domain to 80 chars each (+1 for \0). I wouldn't recommen=
d
    raising this limit at least much, vpopmail is full of potential buffer
    overflows. */
@@ -36,7 +34,8 @@
=20
 	if (parse_email(t_strdup_noconst(user), vpop_user, vpop_domain,
 			sizeof(vpop_user)-1) < 0) {
-		I_DEBUG(("vpopmail: parse_email(%s) failed", user));
+		if (verbose)
+			i_info("vpopmail(%s): parse_email() failed", user);
 		return FALSE;
 	}
=20
@@ -44,19 +43,25 @@
 	   struct vqpasswd isn't really gid at all but just some flags... */
 	if (vget_assign(vpop_domain, NULL, 0,
 			&reply->uid, &reply->gid) =3D=3D NULL) {
-		I_DEBUG(("vpopmail: vget_assign(%s) failed", vpop_domain));
+		if (verbose) {
+			i_info("vpopmail(%s): vget_assign(%s) failed",
+			       user, vpop_domain);
+		}
 		return FALSE;
 	}
=20
 	vpw =3D vauth_getpw(vpop_user, vpop_domain);
 	if (vpw !=3D NULL && (vpw->pw_dir =3D=3D NULL || vpw->pw_dir[0] =3D=3D '\=
0')) {
 		/* user's homedir doesn't exist yet, create it */
-		I_DEBUG(("vpopmail: pw_dir isn't set, creating"));
+		if (verbose) {
+			i_info("vpopmail(%s): pw_dir isn't set, creating",
+			       user);
+		}
=20
 		if (make_user_dir(vpop_user, vpop_domain,
 				  reply->uid, reply->gid) =3D=3D NULL) {
-			i_error("vpopmail: make_user_dir(%s, %s) failed",
-				vpop_user, vpop_domain);
+			i_error("vpopmail(%s): make_user_dir(%s, %s) failed",
+				user, vpop_user, vpop_domain);
 			return FALSE;
 		}
=20
@@ -64,14 +69,16 @@
 	}
=20
 	if (vpw =3D=3D NULL) {
-		I_DEBUG(("vpopmail: vauth_getpw(%s, %s) failed",
-		       vpop_user, vpop_domain));
+		if (verbose) {
+			i_info("vpopmail(%s): vauth_getpw(%s, %s) failed",
+			       user, vpop_user, vpop_domain);
+		}
 		return FALSE;
 	}
=20
 	if (vpw->pw_gid & NO_IMAP) {
-		I_DEBUG(("vpopmail: IMAP disabled for %s@%s",
-		       vpop_user, vpop_domain));
+		if (verbose)
+			i_info("vpopmail(%s): IMAP disabled", user);
 		return FALSE;
 	}
=20
@@ -80,8 +87,8 @@
 	safe_memset(vpw->pw_passwd, 0, strlen(vpw->pw_passwd));
=20
 	if (!result) {
-		I_DEBUG(("vpopmail: password mismatch for user %s@%s",
-		       vpop_user, vpop_domain));
+		if (verbose)
+			i_info("vpopmail(%s): password mismatch", user);
 		return FALSE;
 	}
=20
diff -ru dovecot-0.99.7/src/master/auth-process.c dovecot-0.99.7p1/src/mast=
er/auth-process.c
--- dovecot-0.99.7/src/master/auth-process.c	2003-01-11 21:55:57.000000000 =
+0200
+++ dovecot-0.99.7p1/src/master/auth-process.c	2003-01-21 09:39:28.00000000=
0 +0200
@@ -278,6 +278,8 @@
=20
 	if (config->use_cyrus_sasl)
 		env_put("USE_CYRUS_SASL=3D1");
+	if (config->verbose)
+		env_put("VERBOSE=3D1");
=20
 	restrict_process_size(config->process_size);
=20
diff -ru dovecot-0.99.7/src/master/settings.c dovecot-0.99.7p1/src/master/s=
ettings.c
--- dovecot-0.99.7/src/master/settings.c	2003-01-05 17:19:50.000000000 +020=
0
+++ dovecot-0.99.7p1/src/master/settings.c	2003-01-21 09:39:28.000000000 +0=
200
@@ -417,6 +417,9 @@
 	if (strcmp(key, "auth_cyrus_sasl") =3D=3D 0)
 		return get_bool(value, &auth->use_cyrus_sasl);
=20
+	if (strcmp(key, "auth_verbose") =3D=3D 0)
+		return get_bool(value, &auth->verbose);
+
 	if (strcmp(key, "auth_count") =3D=3D 0) {
 		int num;
=20
diff -ru dovecot-0.99.7/src/master/settings.h dovecot-0.99.7p1/src/master/s=
ettings.h
--- dovecot-0.99.7/src/master/settings.h	2003-01-05 17:19:50.000000000 +020=
0
+++ dovecot-0.99.7p1/src/master/settings.h	2003-01-21 09:39:28.000000000 +0=
200
@@ -71,7 +71,7 @@
 	char *user;
 	char *chroot;
=20
-	int use_cyrus_sasl;
+	int use_cyrus_sasl, verbose;
=20
 	unsigned int count;
 	unsigned int process_size;

--=-Jf/Oz1qqyUMq6k680+bK--

From tss@iki.fi  Tue Jan 21 10:00:56 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 21 Jan 2003 10:00:56 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 9DD3723837
	for <dovecot@procontrol.fi>; Tue, 21 Jan 2003 10:00:56 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 5460B5E01F96; Tue, 21 Jan 2003 10:00:56 +0200 (EET)
Subject: [dovecot] Re: Unable to Log in on FreeBSD server?
From: Timo Sirainen <tss@iki.fi>
To: Mark <mw@lanfear.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <1042947403.1373.4.camel@donburi>
References: <1042783017.5740.9.camel@donburi>
	 <1042805209.8610.230.camel@hurina>  <1042919794.7750.17.camel@donburi>
	 <1042921255.11444.64.camel@hurina>  <1042947403.1373.4.camel@donburi>
Content-Type: multipart/mixed; boundary="=-DWonjSm/fUvyITU9LhZD"
Organization: 
Message-Id: <1043136055.11445.356.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 21 Jan 2003 10:00:56 +0200
X-archive-position: 247
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 247                                                  
Status: O
Content-Length: 4617


--=-DWonjSm/fUvyITU9LhZD
Content-Type: text/plain
Content-Transfer-Encoding: 7bit

On Sun, 2003-01-19 at 05:36, Mark wrote:
> I recently recompiled with --enable-asserts and --enable-debug, and I
> when trying to log in to either port 143 or port 993 using Outlook
> Express, the following happens:

--enable-asserts is actually the default. --enable-debug does only some
internal sanity checks and bad performance warnings.

> 1. Outlook Express complains that the authentication failed with "Login
> Process died unexpectedly"
> 2. The imap-master and all other processes die on my FreeBSD machine.
> 3. I see the following in the logs:
> 
> Jan 18 19:32:21 akira imap-master: Login process died too early -
> shutting down

That "close(master) failed: Bad file descriptor" you had in log is the
only indicator that something wrong even happened. But it still should
have logged something more.

Hmm. Looks like the new code that complains about auth/login process
dying too soon doesn't tell the reason for it if the process crashed or
exited without logging a failure.

See if the attached patch shows something more in the logs? It doesn't
fix the problem, but at least I'll know if it crashes or something else.


--=-DWonjSm/fUvyITU9LhZD
Content-Disposition: attachment; filename=master.diff
Content-Type: text/plain; name=master.diff; charset=ISO-8859-15
Content-Transfer-Encoding: quoted-printable

? src/master/gmon.out
Index: src/master/auth-process.c
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
RCS file: /home/cvs/dovecot/src/master/auth-process.c,v
retrieving revision 1.26
diff -u -r1.26 auth-process.c
--- src/master/auth-process.c	21 Jan 2003 07:40:54 -0000	1.26
+++ src/master/auth-process.c	21 Jan 2003 07:57:29 -0000
@@ -160,8 +160,10 @@
 	struct auth_process **pos;
 	struct waiting_request *next;
=20
-	if (!p->initialized)
-		i_fatal("Auth process died too early - shutting down");
+	if (!p->initialized) {
+		i_error("Auth process died too early - shutting down");
+		io_loop_stop(ioloop);
+	}
=20
 	for (pos =3D &processes; *pos !=3D NULL; pos =3D &(*pos)->next) {
 		if (*pos =3D=3D p) {
Index: src/master/common.h
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
RCS file: /home/cvs/dovecot/src/master/common.h,v
retrieving revision 1.9
diff -u -r1.9 common.h
--- src/master/common.h	5 Jan 2003 13:09:53 -0000	1.9
+++ src/master/common.h	21 Jan 2003 07:57:29 -0000
@@ -18,6 +18,7 @@
 	PROCESS_TYPE_MAX
 };
=20
+extern struct ioloop *ioloop;
 extern struct hash_table *pids;
 extern int null_fd, imap_fd, imaps_fd;
=20
Index: src/master/login-process.c
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
RCS file: /home/cvs/dovecot/src/master/login-process.c,v
retrieving revision 1.28
diff -u -r1.28 login-process.c
--- src/master/login-process.c	11 Jan 2003 15:29:47 -0000	1.28
+++ src/master/login-process.c	21 Jan 2003 07:57:29 -0000
@@ -223,8 +223,10 @@
 		return;
 	p->destroyed =3D TRUE;
=20
-	if (!p->initialized)
-		i_fatal("Login process died too early - shutting down");
+	if (!p->initialized) {
+		i_error("Login process died too early - shutting down");
+		io_loop_stop(ioloop);
+	}
 	if (p->listening)
 		listening_processes--;
=20
Index: src/master/main.c
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
RCS file: /home/cvs/dovecot/src/master/main.c,v
retrieving revision 1.27
diff -u -r1.27 main.c
--- src/master/main.c	11 Jan 2003 15:29:47 -0000	1.27
+++ src/master/main.c	21 Jan 2003 07:57:29 -0000
@@ -28,9 +28,9 @@
 };
=20
 static const char *configfile =3D SYSCONFDIR "/" PACKAGE ".conf";
-static struct ioloop *ioloop;
 static struct timeout *to;
=20
+struct ioloop *ioloop;
 struct hash_table *pids;
 int null_fd, imap_fd, imaps_fd;
=20
@@ -258,6 +258,9 @@
 {
         if (lib_signal_kill !=3D 0)
 		i_warning("Killed with signal %d", lib_signal_kill);
+
+	/* make sure we log if child processes died unexpectedly */
+	timeout_handler(NULL, NULL);
=20
 	login_processes_deinit();
 	auth_processes_deinit();

--=-DWonjSm/fUvyITU9LhZD--

From jpeterson275@attbi.com  Fri Jan 24 06:33:51 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 24 Jan 2003 06:33:51 +0200 (EET)
Return-Path: <jpeterson275@attbi.com>
Delivered-To: dovecot@procontrol.fi
Received: from sccrmhc03.attbi.com (sccrmhc03.attbi.com [204.127.202.63])
	by danu.procontrol.fi (Postfix) with ESMTP id 01CF0238C6
	for <dovecot@procontrol.fi>; Fri, 24 Jan 2003 06:33:50 +0200 (EET)
Received: from attbi.com (12-228-160-142.client.attbi.com[12.228.160.142])
          by sccrmhc03.attbi.com (sccrmhc03) with SMTP
          id <200301240433460030005i33e>; Fri, 24 Jan 2003 04:33:47 +0000
Message-ID: <3E30C231.7020702@attbi.com>
Date: Thu, 23 Jan 2003 20:33:53 -0800
From: Jesse Peterson <jpeterson275@attbi.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] cvs down?
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 248
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jpeterson275@attbi.com
Precedence: bulk
X-list: dovecot
X-UID: 248                                                  
Status: O

(Logging in to anonymous@dovecot.procontrol.fi)
CVS password:
cvs [login aborted]: connect to dovecot.procontrol.fi:2401 failed: 
Connection refused
cvs [checkout aborted]: connect to dovecot.procontrol.fi:2401 failed: 
Connection refused


Was the CVS server taken down?


-- 
Jesse Peterson  /  jesse@pixeltechs.com


From tss@iki.fi  Fri Jan 24 07:07:47 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 24 Jan 2003 07:07:47 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 6D32F238C5
	for <dovecot@procontrol.fi>; Fri, 24 Jan 2003 07:07:47 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 24B1D5E01F60; Fri, 24 Jan 2003 07:07:46 +0200 (EET)
Subject: [dovecot] Re: cvs down?
From: Timo Sirainen <tss@iki.fi>
To: Jesse Peterson <jpeterson275@attbi.com>
Cc: Dovecot Mail List <dovecot@procontrol.fi>
In-Reply-To: <3E30C231.7020702@attbi.com>
References: <3E30C231.7020702@attbi.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1043384865.29567.89.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 24 Jan 2003 07:07:46 +0200
X-archive-position: 249
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 249                                                  
Status: O

On Fri, 2003-01-24 at 06:33, Jesse Peterson wrote:
> Was the CVS server taken down?

Yes, until either CVS package is updated in Debian/unstable or I patch
it myself. I'll probably set it up today in any case.

BTW. CVS is getting some neat new code :) Mail storage API is now better
which had a side effect of making Dovecot a bit faster and take a bit
less memory than before.

I'm also rewriting authentication code. It's now split into three parts:
authentication (SASL) mechanism, user database and password database.
This means you can mix them in any possible way, for example use
digest-md5 for users in /etc/passwd, but the passwords being in SQL
database. And yes, SQL support will likely come soon, both for
authentication and storing mails.

From amyzing@talsever.com  Sun Feb  2 08:28:50 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 02 Feb 2003 08:28:50 +0200 (EET)
Return-Path: <amyzing@talsever.com>
Delivered-To: dovecot@procontrol.fi
Received: from smtp10.atl.mindspring.net (smtp10.atl.mindspring.net [207.69.200.246])
	by danu.procontrol.fi (Postfix) with ESMTP id CBB1F239A7
	for <dovecot@procontrol.fi>; Sun,  2 Feb 2003 08:28:49 +0200 (EET)
Received: from user-2ivf46j.dialup.mindspring.com ([165.247.144.211] helo=marajen.talsever.com)
	by smtp10.atl.mindspring.net with esmtp (Exim 3.33 #1)
	id 18fDcR-0003XG-00; Sun, 02 Feb 2003 01:28:43 -0500
Received: from ythgin.talsever.com (ythgin.talsever.com [192.168.0.20])
	by marajen.talsever.com (Postfix) with SMTP
	id 6E7CB8044; Sun,  2 Feb 2003 01:30:07 -0500 (EST)
Date: Sun, 2 Feb 2003 01:28:42 -0500
From: Amelia A.Lewis <amyzing@talsever.com>
To: Timo Sirainen <tss@iki.fi>
Cc: dovecot@procontrol.fi
Subject: [dovecot] STARTTLS hangs due to client_skip_line (Was: Re: Plain auth broken)
Message-Id: <20030202012842.5b9972cb.amyzing@talsever.com>
In-Reply-To: <1043134986.11439.337.camel@hurina>
References: <Pine.LNX.4.52.0301131838330.14774@kyanite.hwr.arizona.edu>
	<1042509723.8609.113.camel@hurina>
	<Pine.LNX.4.52.0301141731000.15973@kyanite.hwr.arizona.edu>
	<1042592701.8610.171.camel@hurina>
	<Pine.LNX.4.52.0301141830500.15973@kyanite.hwr.arizona.edu>
	<1042668222.8602.203.camel@hurina>
	<Pine.LNX.4.52.0301151505210.16969@kyanite.hwr.arizona.edu>
	<Pine.LNX.4.52.0301151819050.16969@kyanite.hwr.arizona.edu>
	<1042805732.8610.235.camel@hurina>
	<1042807051.8610.243.camel@hurina>
	<20030118120137.794e417b.amyzing@talsever.com>
	<1043134986.11439.337.camel@hurina>
Organization: The Mysthical World of Talsever!
X-Mailer: Sylpheed version 0.8.9 (GTK+ 1.2.10; i386-debian-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-archive-position: 250
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: amyzing@talsever.com
Precedence: bulk
X-list: dovecot
X-UID: 250                                                  
Status: O
Content-Length: 2468

Dear Timo,

Thanks for the patch.  It shows the connections, but auth never gets
called.

I finally pulled my act together so that I could compile from source. 
So, I thought I would be a little more clear.

If I turn on ssl (comment out ssl_disable = yes, the default) and turn
off plaintext (uncomment disable_plaintext_auth = yes), then immediately
after SSL negotiation, my client hangs (I'm testing with mutt).

Eventually, I determined what's happening, to some degree.  Alas, I've
been programming in Java for five years, so I have trouble debugging a
real programming language.  However: in login/client.c,
client_handle_input, the first part of the function checks for
client->cmd_finished, and if so, clears client->cmd_tag and
client->cmd_name.  It then checks client->skip_line, and if true, calls
client_skip_line.  Adding debugging to client_skip_line (i_info with the
contents of data) shows that, after the starttls command,
client_skip_line discards the whole next command (in my case, a0002
CAPABILITY).  The client is waiting for a response.  The server is
waiting for a command (having discarded one).  login times out sixty
seconds later, for inactivity.

There's where my skills prove inadequate, I'm afraid, because bypassing
client_skip_line if the last command was STARTTLS doesn't seem to do any
good; the server never sees the capability command.  I'm between a rock
and a hard place, it appears; if the server sees the command, it
discards it and then times out, but if it doesn't, it times out anyway. 
*sigh*

No one else seems to be having this sort of problem, though.  Is that
because most folks are using TLS on the imaps port?  Or have I got a
misconfiguration that runs somehow deeper?  I don't *think* I'm chasing
a wild hare.

Sorry to be a bother.

Amy!
On 21 Jan 2003 09:43:06 +0200
Timo Sirainen <tss@iki.fi> wrote:

> On Sat, 2003-01-18 at 19:01, Amelia A.Lewis wrote:
> > I'm running the debian package 0.99.7-2.  If I turn off SSL, and
> > allow plaintext, I can log in.  If I turn SSL on (comment out
> > ssl_diable = yes), then I can't.  It was working in 0.99.6, I know.
> 
> If it was working in .6, I can't think of what could have broken. But
> here's a patch for more verbose logging if "auth_verbose = yes" in
> config file.
> 
> 


-- 
Amelia A. Lewis                    amyzing {at} talsever.com
There are two major products that came out of Berkeley: LSD and BSD
Unix.  We don't believe this to be a coincidence.

From tss@iki.fi  Sun Feb  2 09:15:26 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 02 Feb 2003 09:15:26 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id E4AD3239AF
	for <dovecot@procontrol.fi>; Sun,  2 Feb 2003 09:15:25 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 27FE75E017E8; Sun,  2 Feb 2003 09:15:20 +0200 (EET)
Subject: [dovecot] Re: STARTTLS hangs due to client_skip_line (Was: Re: Plain auth
	broken)
From: Timo Sirainen <tss@iki.fi>
To: "Amelia A.Lewis" <amyzing@talsever.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030202012842.5b9972cb.amyzing@talsever.com>
References: <Pine.LNX.4.52.0301131838330.14774@kyanite.hwr.arizona.edu>
	 <1042509723.8609.113.camel@hurina>
	 <Pine.LNX.4.52.0301141731000.15973@kyanite.hwr.arizona.edu>
	 <1042592701.8610.171.camel@hurina>
	 <Pine.LNX.4.52.0301141830500.15973@kyanite.hwr.arizona.edu>
	 <1042668222.8602.203.camel@hurina>
	 <Pine.LNX.4.52.0301151505210.16969@kyanite.hwr.arizona.edu>
	 <Pine.LNX.4.52.0301151819050.16969@kyanite.hwr.arizona.edu>
	 <1042805732.8610.235.camel@hurina> <1042807051.8610.243.camel@hurina>
	 <20030118120137.794e417b.amyzing@talsever.com>
	 <1043134986.11439.337.camel@hurina>
	 <20030202012842.5b9972cb.amyzing@talsever.com>
Content-Type: multipart/mixed; boundary="=-vQk1xOrFZGaBhlVjmokm"
Organization: 
Message-Id: <1044170119.27230.2.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 02 Feb 2003 09:15:19 +0200
X-archive-position: 251
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 251                                                  
Status: O
Content-Length: 1816


--=-vQk1xOrFZGaBhlVjmokm
Content-Type: text/plain
Content-Transfer-Encoding: 7bit

On Sun, 2003-02-02 at 08:28, Amelia A.Lewis wrote:
> Eventually, I determined what's happening, to some degree.  Alas, I've
> been programming in Java for five years, so I have trouble debugging a
> real programming language.

Java is real too :)

> Adding debugging to client_skip_line (i_info with the
> contents of data) shows that, after the starttls command,
> client_skip_line discards the whole next command (in my case, a0002
> CAPABILITY).  The client is waiting for a response.  The server is
> waiting for a command (having discarded one).  login times out sixty
> seconds later, for inactivity.

Yes, so it seems.

> No one else seems to be having this sort of problem, though.  Is that
> because most folks are using TLS on the imaps port?  Or have I got a
> misconfiguration that runs somehow deeper?  I don't *think* I'm chasing
> a wild hare.

I've tested STARTTLS only with Evolution which I guess didn't mind about
not getting a reply to next command.

Here's a patch, thanks for bug report :)


--=-vQk1xOrFZGaBhlVjmokm
Content-Disposition: attachment; filename=dovecot-starttls.diff
Content-Type: text/x-patch; name=dovecot-starttls.diff; charset=ISO-8859-15
Content-Transfer-Encoding: quoted-printable

diff -ru dovecot-0.99.7/src/login/client.c dovecot-0.99.7p1/src/login/clien=
t.c
--- dovecot-0.99.7/src/login/client.c	2003-01-11 17:29:47.000000000 +0200
+++ dovecot-0.99.7p1/src/login/client.c	2003-02-02 09:11:18.000000000 +0200
@@ -91,6 +91,9 @@
 		client->tls =3D TRUE;
                 client_set_title(client);
=20
+		/* we skipped it already, so don't ignore next command */
+		client->skip_line =3D FALSE;
+
 		client->fd =3D fd_ssl;
=20
 		i_stream_unref(client->input);

--=-vQk1xOrFZGaBhlVjmokm--

From amyzing@talsever.com  Sun Feb  2 18:06:48 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 02 Feb 2003 18:06:48 +0200 (EET)
Return-Path: <amyzing@talsever.com>
Delivered-To: dovecot@procontrol.fi
Received: from maynard.mail.mindspring.net (maynard.mail.mindspring.net [207.69.200.243])
	by danu.procontrol.fi (Postfix) with ESMTP id E1B3B239AF
	for <dovecot@procontrol.fi>; Sun,  2 Feb 2003 18:06:47 +0200 (EET)
Received: from user-2ivf46j.dialup.mindspring.com ([165.247.144.211] helo=marajen.talsever.com)
	by maynard.mail.mindspring.net with esmtp (Exim 3.33 #1)
	id 18fMdk-000396-00; Sun, 02 Feb 2003 11:06:40 -0500
Received: from ythgin.talsever.com (ythgin.talsever.com [192.168.0.20])
	by marajen.talsever.com (Postfix) with SMTP
	id 34CE38044; Sun,  2 Feb 2003 11:08:09 -0500 (EST)
Date: Sun, 2 Feb 2003 11:06:39 -0500
From: Amelia A.Lewis <amyzing@talsever.com>
To: Timo Sirainen <tss@iki.fi>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: STARTTLS hangs due to client_skip_line (Was: Re:
 Plain auth broken)
Message-Id: <20030202110639.4e452d33.amyzing@talsever.com>
In-Reply-To: <1044170119.27230.2.camel@hurina>
References: <Pine.LNX.4.52.0301131838330.14774@kyanite.hwr.arizona.edu>
	<1042509723.8609.113.camel@hurina>
	<Pine.LNX.4.52.0301141731000.15973@kyanite.hwr.arizona.edu>
	<1042592701.8610.171.camel@hurina>
	<Pine.LNX.4.52.0301141830500.15973@kyanite.hwr.arizona.edu>
	<1042668222.8602.203.camel@hurina>
	<Pine.LNX.4.52.0301151505210.16969@kyanite.hwr.arizona.edu>
	<Pine.LNX.4.52.0301151819050.16969@kyanite.hwr.arizona.edu>
	<1042805732.8610.235.camel@hurina>
	<1042807051.8610.243.camel@hurina>
	<20030118120137.794e417b.amyzing@talsever.com>
	<1043134986.11439.337.camel@hurina>
	<20030202012842.5b9972cb.amyzing@talsever.com>
	<1044170119.27230.2.camel@hurina>
Organization: The Mysthical World of Talsever!
X-Mailer: Sylpheed version 0.8.9 (GTK+ 1.2.10; i386-debian-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-archive-position: 252
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: amyzing@talsever.com
Precedence: bulk
X-list: dovecot
X-UID: 252                                                  
Status: O
Content-Length: 5450

Dear Timo,

On 02 Feb 2003 09:15:19 +0200
Timo Sirainen <tss@iki.fi> wrote:

> On Sun, 2003-02-02 at 08:28, Amelia A.Lewis wrote:
> > Adding debugging to client_skip_line (i_info with the
> > contents of data) shows that, after the starttls command,
> > client_skip_line discards the whole next command (in my case, a0002
> > CAPABILITY).  The client is waiting for a response.  The server is
> > waiting for a command (having discarded one).  login times out sixty
> > seconds later, for inactivity.
> 
> Yes, so it seems.
> 
> > No one else seems to be having this sort of problem, though.  Is
> > that because most folks are using TLS on the imaps port?  Or have I
> > got a misconfiguration that runs somehow deeper?  I don't *think*
> > I'm chasing a wild hare.
> 
> I've tested STARTTLS only with Evolution which I guess didn't mind
> about not getting a reply to next command.
> 
> Here's a patch, thanks for bug report :)

Thank you!  Only it doesn't work.  I don't quite know why, either (it's
almost exactly what I tried, but skipping over the skip_line seems to
mean that it can't find the tag to read).  Which seems weird.  Is it
possible that client->parser->input != client->input?  Such that
client->parser->input still points at the original fd?

For whatever it might be worth, here's two runs of mutt, one without,
and one with the patch.  Most of the stuff occurs inside
client_handle_input.

Feb  2 10:55:51 talifane imap-master: Dovecot starting up
Feb  2 10:55:52 talifane imap-auth: Login process 6 connected
Feb  2 10:55:52 talifane imap-auth: Login process 7 connected
Feb  2 10:55:52 talifane imap-auth: Login process 8 connected
Feb  2 10:55:52 talifane imap-auth: Login process 8 sent handshake: PID
9137
Feb  2 10:55:52 talifane imap-auth: Login process 7 sent handshake: PID
9138
Feb  2 10:55:52 talifane imap-auth: Login process 6 sent handshake: PID
9139
Feb  2 10:55:53 talifane imap-login: client_handle_input: cmd_tag is
null
Feb  2 10:55:53 talifane imap-login: client_handle_input: cmd_name is
null
Feb  2 10:55:53 talifane imap-login: client_handle_input: cmd_finished:
cmd_tag: a0000 ; cmd_name: CAPABILITY
Feb  2 10:55:53 talifane imap-login: Skipping line in data: 
Feb  2 10:55:53 talifane imap-login: Skipped 2 chars
Feb  2 10:55:53 talifane imap-login: client_handle_input: cmd_tag is
null
Feb  2 10:55:53 talifane imap-login: client_handle_input: cmd_name is
null
Feb  2 10:55:53 talifane imap-login: gnutls ssl_proxy_new
Feb  2 10:55:54 talifane imap-auth: Login process 9 connected
Feb  2 10:55:54 talifane imap-auth: Login process 9 sent handshake: PID
9141
Feb  2 10:55:54 talifane imap-login: client_handle_input: cmd_finished:
cmd_tag: a0001 ; cmd_name: STARTTLS
Feb  2 10:55:54 talifane imap-login: Skipping line in data: a0002
CAPABILITY
Feb  2 10:55:54 talifane imap-login: Skipped 18 chars
Feb  2 10:55:54 talifane imap-login: client_handle_input: cmd_tag is
null
Feb  2 10:55:54 talifane imap-login: client_handle_input: can't fill
cmd_tag (need more data)
Feb  2 10:56:54 talifane imap-login: Disconnected: Inactivity
[127.0.0.1]
Feb  2 10:56:54 talifane imap-auth: Login process 8 disconnected

The next one is with the patch applied.

Feb  2 11:00:41 talifane imap-master: Dovecot starting up
Feb  2 11:00:42 talifane imap-auth: Login process 6 connected
Feb  2 11:00:42 talifane imap-auth: Login process 7 connected
Feb  2 11:00:42 talifane imap-auth: Login process 8 connected
Feb  2 11:00:42 talifane imap-auth: Login process 8 sent handshake: PID
9361
Feb  2 11:00:42 talifane imap-auth: Login process 7 sent handshake: PID
9362
Feb  2 11:00:42 talifane imap-auth: Login process 6 sent handshake: PID
9363
Feb  2 11:00:47 talifane imap-login: client_handle_input: cmd_tag is
null
Feb  2 11:00:47 talifane imap-login: client_handle_input: cmd_name is
null
Feb  2 11:00:47 talifane imap-login: client_handle_input: cmd_finished:
cmd_tag: a0000 ; cmd_name: CAPABILITY
Feb  2 11:00:47 talifane imap-login: Skipping line in data: 
Feb  2 11:00:47 talifane imap-login: Skipped 2 chars
Feb  2 11:00:47 talifane imap-login: client_handle_input: cmd_tag is
null
Feb  2 11:00:47 talifane imap-login: client_handle_input: cmd_name is
null
Feb  2 11:00:47 talifane imap-login: gnutls ssl_proxy_new
Feb  2 11:00:47 talifane imap-auth: Login process 9 connected
Feb  2 11:00:47 talifane imap-auth: Login process 9 sent handshake: PID
9365
Feb  2 11:00:48 talifane imap-login: client_handle_input: cmd_finished:
cmd_tag: a0001 ; cmd_name: STARTTLS
Feb  2 11:00:48 talifane imap-login: client_handle_input: cmd_tag is
null
Feb  2 11:00:48 talifane imap-login: client_handle_input: can't fill
cmd_tag (need more data)
Feb  2 11:01:48 talifane imap-login: Disconnected: Inactivity
[127.0.0.1]
Feb  2 11:01:48 talifane imap-auth: Login process 8 disconnected

As you can see, the major difference is that it doesn't discard the
command, but it still can't seem to see it (client_handle_input: can't
fill cmd_tag (need more data) happens in just the place where "need more
data" appears as a comment).  Now, looking around, it appears that
skip_line uses i_stream_get_data on client->input, while filling the tag
calls imap_parser_read_word, which uses i_stream_get_data on
parser->input.  Does all the necessary information for the parser get
reset in starttls?

Amy!
-- 
Amelia A. Lewis                    amyzing {at} talsever.com
Early to bed and early to rise
makes a man stupid and blind in the eyes.

From kaeesalm@cc.jyu.fi  Sun Feb  2 18:23:17 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 02 Feb 2003 18:23:17 +0200 (EET)
Return-Path: <kaeesalm@cc.jyu.fi>
Delivered-To: dovecot@procontrol.fi
Received: from yabba.kortex.jyu.fi (yabba.kortex.jyu.fi [130.234.182.31])
	by danu.procontrol.fi (Postfix) with ESMTP id CE3B1239AF
	for <dovecot@procontrol.fi>; Sun,  2 Feb 2003 18:23:17 +0200 (EET)
Received: from localhost (localhost [127.0.0.1])
	by yabba.kortex.jyu.fi (Postfix) with ESMTP id 897613DD
	for <dovecot@procontrol.fi>; Sun,  2 Feb 2003 18:23:17 +0200 (EET)
From: Karo Salminen <kaeesalm@cc.jyu.fi>
Organization: University of =?iso-8859-1?q?Jyv=E4skyl=E4?=
To: dovecot@procontrol.fi
Subject: [dovecot] Dovecot on FreeBSD
Date: Sun, 2 Feb 2003 18:23:11 +0200
User-Agent: KMail/1.5
MIME-Version: 1.0
Content-Type: Text/Plain;
  charset="us-ascii"
Content-Transfer-Encoding: quoted-printable
Content-Description: clearsigned data
Content-Disposition: inline
Message-Id: <200302021823.16801.kaeesalm@cc.jyu.fi>
X-archive-position: 253
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: kaeesalm@cc.jyu.fi
Precedence: bulk
X-list: dovecot
X-UID: 253                                                  
Status: O

=2D----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hello,

I built Dovecot (0.99.5) from Ports on FreeBSD 5.0. The mail client (Kmail)=
=20
cannot login and it complains that authentication process died. The only=20
thing in the logs is:
=46eb  2 18:13:01 karo imap-login: Disconnected [client-ip]

I tried also passwd authentication method, but its symptoms are the very sa=
me.

My configure can be found at http://people.jyu.fi/~kaeesalm/dovecot.conf

I also tried CVS version in hope of fix and more comprehensive debug messag=
es.=20
The compilation failes when it tries to look for passwd.h even though I set=
=20
=2D --disable-passwd and --without-passwd to configure parameters. Could so=
meone=20
fix that.
=2D --=20
Karo Salminen
=2D----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.1 (FreeBSD)

iD8DBQE+PUX0vt6lNXuj7xcRAp70AJ0R+zhmgF+WBaXaX2V2j+07eVyJRACgh6Ze
Pmep2Uy2OnVe/EVuo9O3b80=3D
=3DeqOO
=2D----END PGP SIGNATURE-----


From overflow@eurielec.etsit.upm.es  Sun Feb  2 19:18:50 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 02 Feb 2003 19:18:50 +0200 (EET)
Return-Path: <overflow@eurielec.etsit.upm.es>
Delivered-To: dovecot@procontrol.fi
Received: from eurielec.etsit.upm.es (uno.eurielec.etsit.upm.es [138.100.31.227])
	by danu.procontrol.fi (Postfix) with ESMTP id 05F97239A7
	for <dovecot@procontrol.fi>; Sun,  2 Feb 2003 19:18:50 +0200 (EET)
Received: from dos.eurielec.etsit.upm.es (dos.eurielec.etsit.upm.es [138.100.31.228])
	by eurielec.etsit.upm.es (Postfix) with SMTP id 03906B5D
	for <dovecot@procontrol.fi>; Sun,  2 Feb 2003 18:19:55 +0100 (CET)
Received: by dos.eurielec.etsit.upm.es (sSMTP sendmail emulation); Sun,  2 Feb 2003 18:18:46 +0100
Date: Sun, 2 Feb 2003 18:18:46 +0100
From: Jaime Medrano <overflow@eurielec.etsit.upm.es>
To: dovecot@procontrol.fi
Subject: [dovecot] Recent messages
Message-ID: <20030202171846.GA4164@eurielec.etsit.upm.es>
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-15
Content-Disposition: inline
User-Agent: Mutt/1.5.3i
X-archive-position: 254
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: overflow@eurielec.etsit.upm.es
Precedence: bulk
X-list: dovecot
X-UID: 254                                                  
Status: O

Dovecot seems to manage \Recent messages in a weird way. When a STATUS
command is performed in a mailbox, then the \Recent flag of its messages
disappear and latter STATUS commands report that there are no recent
messagges.

I don't know exactly the behavior of the RFC. But other imap servers
(UW-imapd, Netscape Messenger...) report the same number of recent
messages when two STATUS commands are performed together.

--
Jaime.


From amyzing@talsever.com  Sun Feb  2 20:14:53 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 02 Feb 2003 20:14:53 +0200 (EET)
Return-Path: <amyzing@talsever.com>
Delivered-To: dovecot@procontrol.fi
Received: from maynard.mail.mindspring.net (maynard.mail.mindspring.net [207.69.200.243])
	by danu.procontrol.fi (Postfix) with ESMTP id 9208F239AF
	for <dovecot@procontrol.fi>; Sun,  2 Feb 2003 20:14:51 +0200 (EET)
Received: from user-2ivf46j.dialup.mindspring.com ([165.247.144.211] helo=marajen.talsever.com)
	by maynard.mail.mindspring.net with esmtp (Exim 3.33 #1)
	id 18fOdj-0007S2-00; Sun, 02 Feb 2003 13:14:47 -0500
Received: from ythgin.talsever.com (ythgin.talsever.com [192.168.0.20])
	by marajen.talsever.com (Postfix) with SMTP
	id 04FDE8044; Sun,  2 Feb 2003 13:16:16 -0500 (EST)
Date: Sun, 2 Feb 2003 13:14:46 -0500
From: Amelia A.Lewis <amyzing@talsever.com>
To: "Amelia A.Lewis" <amyzing@talsever.com>
Cc: tss@iki.fi, dovecot@procontrol.fi
Subject: [dovecot] Re: STARTTLS hangs due to client_skip_line (Was: Re:
 Plain auth broken)
Message-Id: <20030202131446.7178cbcc.amyzing@talsever.com>
In-Reply-To: <20030202110639.4e452d33.amyzing@talsever.com>
References: <Pine.LNX.4.52.0301131838330.14774@kyanite.hwr.arizona.edu>
	<1042509723.8609.113.camel@hurina>
	<Pine.LNX.4.52.0301141731000.15973@kyanite.hwr.arizona.edu>
	<1042592701.8610.171.camel@hurina>
	<Pine.LNX.4.52.0301141830500.15973@kyanite.hwr.arizona.edu>
	<1042668222.8602.203.camel@hurina>
	<Pine.LNX.4.52.0301151505210.16969@kyanite.hwr.arizona.edu>
	<Pine.LNX.4.52.0301151819050.16969@kyanite.hwr.arizona.edu>
	<1042805732.8610.235.camel@hurina>
	<1042807051.8610.243.camel@hurina>
	<20030118120137.794e417b.amyzing@talsever.com>
	<1043134986.11439.337.camel@hurina>
	<20030202012842.5b9972cb.amyzing@talsever.com>
	<1044170119.27230.2.camel@hurina>
	<20030202110639.4e452d33.amyzing@talsever.com>
Organization: The Mysthical World of Talsever!
X-Mailer: Sylpheed version 0.8.9 (GTK+ 1.2.10; i386-debian-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-archive-position: 255
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: amyzing@talsever.com
Precedence: bulk
X-list: dovecot
X-UID: 255                                                  
Status: O
Content-Length: 2101

Replying to myself, what fun.

On Sun, 2 Feb 2003 11:06:39 -0500
"Amelia A.Lewis" <amyzing@talsever.com> wrote:
> On 02 Feb 2003 09:15:19 +0200
> Timo Sirainen <tss@iki.fi> wrote:
> > Here's a patch, thanks for bug report :)
> 
> Thank you!  Only it doesn't work.  I don't quite know why, either
> (it's almost exactly what I tried, but skipping over the skip_line
> seems to mean that it can't find the tag to read).  Which seems weird.
>  Is it
> possible that client->parser->input != client->input?  Such that
> client->parser->input still points at the original fd?

Seems to solve the problem.  Here's the patch (inlined), modified to
make a new parser attached to the new fds.

diff -ru dovecot-0.99.7/src/login/client.c
dovecot-0.99.7p1/src/login/client.c
--- dovecot-0.99.7/src/login/client.c	2003-01-11 17:29:47.000000000 +0200
+++ dovecot-0.99.7p1/src/login/client.c	2003-02-02 09:11:18.000000000 +0200
@@ -91,6 +91,9 @@
 		client->tls = TRUE;
                 client_set_title(client);
 
+		/* we skipped it already, so don't ignore next command */
+		client->skip_line = FALSE;
+
 		client->fd = fd_ssl;
 
 		i_stream_unref(client->input);
                o_stream_unref(client->output);

                client->input = i_stream_create_file(fd_ssl,
default_pool,
                                                     8192, FALSE);
                client->output = o_stream_create_file(fd_ssl,
default_pool,
                                                      1024,
IO_PRIORITY_DEFAULT,
                                                      FALSE);
+
+               imap_parser_destroy(client->parser);
+               client->parser = imap_parser_create(client->input,
client->output,
+                                           MAX_INBUF_SIZE,
+                                           MAX_IMAP_ARG_ELEMENTS);
        } else {
                client_send_line(client, " * BYE TLS handehake
failed.");
                client_destroy(client, "TLS handshake failed");



Amy!
-- 
Amelia A. Lewis                    amyzing {at} talsever.com
A hundred thousand lemmings can't be wrong.

From tss@iki.fi  Mon Feb  3 07:08:18 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 03 Feb 2003 07:08:18 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 44427239A7
	for <dovecot@procontrol.fi>; Mon,  3 Feb 2003 07:08:18 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 2CC8E5E017E8; Mon,  3 Feb 2003 07:08:16 +0200 (EET)
Subject: [dovecot] Re: STARTTLS hangs due to client_skip_line (Was: Re:
	Plain auth broken)
From: Timo Sirainen <tss@iki.fi>
To: "Amelia A.Lewis" <amyzing@talsever.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030202131446.7178cbcc.amyzing@talsever.com>
References: <Pine.LNX.4.52.0301131838330.14774@kyanite.hwr.arizona.edu>
	 <1042509723.8609.113.camel@hurina>
	 <Pine.LNX.4.52.0301141731000.15973@kyanite.hwr.arizona.edu>
	 <1042592701.8610.171.camel@hurina>
	 <Pine.LNX.4.52.0301141830500.15973@kyanite.hwr.arizona.edu>
	 <1042668222.8602.203.camel@hurina>
	 <Pine.LNX.4.52.0301151505210.16969@kyanite.hwr.arizona.edu>
	 <Pine.LNX.4.52.0301151819050.16969@kyanite.hwr.arizona.edu>
	 <1042805732.8610.235.camel@hurina> <1042807051.8610.243.camel@hurina>
	 <20030118120137.794e417b.amyzing@talsever.com>
	 <1043134986.11439.337.camel@hurina>
	 <20030202012842.5b9972cb.amyzing@talsever.com>
	 <1044170119.27230.2.camel@hurina>
	 <20030202110639.4e452d33.amyzing@talsever.com>
	 <20030202131446.7178cbcc.amyzing@talsever.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1044248895.27239.12.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 03 Feb 2003 07:08:15 +0200
X-archive-position: 256
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 256                                                  
Status: O

On Sun, 2003-02-02 at 20:14, Amelia A.Lewis wrote:
> >  Is it
> > possible that client->parser->input != client->input?  Such that
> > client->parser->input still points at the original fd?
> 
> Seems to solve the problem.  Here's the patch (inlined), modified to
> make a new parser attached to the new fds.

Hmm. I had fixed that already in CVS, but I though it was because I had
changed something that required it. Wonder why that ever even worked..


From tss@iki.fi  Mon Feb  3 07:12:48 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 03 Feb 2003 07:12:48 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 18577239A7
	for <dovecot@procontrol.fi>; Mon,  3 Feb 2003 07:12:48 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id DC5D45E017E8; Mon,  3 Feb 2003 07:12:47 +0200 (EET)
Subject: [dovecot] Re: Recent messages
From: Timo Sirainen <tss@iki.fi>
To: Jaime Medrano <overflow@eurielec.etsit.upm.es>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030202171846.GA4164@eurielec.etsit.upm.es>
References: <20030202171846.GA4164@eurielec.etsit.upm.es>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1044249167.13761.16.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 03 Feb 2003 07:12:47 +0200
X-archive-position: 257
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 257                                                  
Status: O
Content-Length: 1028

On Sun, 2003-02-02 at 19:18, Jaime Medrano wrote:
> Dovecot seems to manage \Recent messages in a weird way. When a STATUS
> command is performed in a mailbox, then the \Recent flag of its messages
> disappear and latter STATUS commands report that there are no recent
> messagges.

Whops, fixed.

Index: src/imap/cmd-status.c
===================================================================
RCS file: /home/cvs/dovecot/src/imap/cmd-status.c,v
retrieving revision 1.9
retrieving revision 1.10
diff -u -r1.9 -r1.10
--- src/imap/cmd-status.c       10 Jan 2003 11:02:10 -0000      1.9
+++ src/imap/cmd-status.c       3 Feb 2003 05:11:16 -0000       1.10
@@ -65,7 +65,7 @@
        } else {
                /* open the mailbox */
                box = client->storage->open_mailbox(client->storage,
-                                                   mailbox, FALSE, TRUE);
+                                                   mailbox, TRUE, TRUE);
                if (box == NULL)
                        return FALSE;
        }


From tss@iki.fi  Mon Feb  3 07:17:27 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 03 Feb 2003 07:17:27 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 1020D239B4
	for <dovecot@procontrol.fi>; Mon,  3 Feb 2003 07:17:27 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id C999D5E017E8; Mon,  3 Feb 2003 07:17:26 +0200 (EET)
Subject: [dovecot] Re: Dovecot on FreeBSD
From: Timo Sirainen <tss@iki.fi>
To: Karo Salminen <kaeesalm@cc.jyu.fi>
Cc: dovecot@procontrol.fi
In-Reply-To: <200302021823.16801.kaeesalm@cc.jyu.fi>
References: <200302021823.16801.kaeesalm@cc.jyu.fi>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1044249446.27239.22.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 03 Feb 2003 07:17:26 +0200
X-archive-position: 258
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 258                                                  
Status: O

On Sun, 2003-02-02 at 18:23, Karo Salminen wrote:

> I also tried CVS version in hope of fix and more comprehensive debug messages. 
> The compilation failes when it tries to look for passwd.h even though I set 
> - --disable-passwd and --without-passwd to configure parameters. Could someone 
> fix that.

You said shadow.h in IRC :) --without-shadow would have disabled that.
Does FreeBSD really have getspnam() function elsewhere? Anyway I added
now check to configure to check for shadow.h too before assuming it
exists.


From jaldhar@debian.org  Mon Feb  3 08:45:28 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 03 Feb 2003 08:45:28 +0200 (EET)
Return-Path: <jaldhar@debian.org>
Delivered-To: dovecot@procontrol.fi
Received: from mail.braincells.com (samadhi.braincells.com [216.162.42.100])
	by danu.procontrol.fi (Postfix) with ESMTP id D6862239AF
	for <dovecot@procontrol.fi>; Mon,  3 Feb 2003 08:45:27 +0200 (EET)
Received: from localhost (localhost [127.0.0.1])
	by mail.braincells.com (Postfix) with ESMTP id 044577FBB
	for <dovecot@procontrol.fi>; Mon,  3 Feb 2003 01:45:30 -0500 (EST)
Date: Mon, 3 Feb 2003 01:45:29 -0500 (EST)
From: "Jaldhar H. Vyas" <jaldhar@debian.org>
X-X-Sender: jaldhar@samadhi.braincells.com
Reply-To: "Jaldhar H. Vyas" <jaldhar@debian.org>
To: dovecot@procontrol.fi
Subject: [dovecot] About the dovecot package (fwd)
Message-ID: <Pine.LNX.4.53.0302030141400.5030@samadhi.braincells.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=iso-8859-1
Content-Transfer-Encoding: 8BIT
X-archive-position: 259
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jaldhar@debian.org
Precedence: bulk
X-list: dovecot
X-UID: 259                                                  
Status: O
Content-Length: 1610

Dear Timo,

What do you think of this?  Fyi, I've been getting the same thing lately
and I'm wondering if gnutls is to blame?  (i've had inexlicable SIGSEGVs
in other apps before due to it.)  Tomorrow I'll try with openssl but I was
wondering if you had any other ideas?

-- 
Jaldhar H. Vyas <jaldhar@debian.org>
La Salle Debain - http://www.braincells.com/debian/

---------- Forwarded message ----------
From: Guille -bisho- <bisho@eurielec.etsit.upm.es>
To: jaldhar@debian.org
Date: Mon, 3 Feb 2003 02:08:19 +0100
Subject: About the dovecot package

Hello!

First of all thanks for maintain such a good imap server. It's trully
fast and lightweight!!! I was trying Courier, but it is not very
interoperable with others linux tools like procmail and others, and
uw-imapd performance was really bad.

I only have one problem:

If I put a lot of folders to check in mutt the imapd server closes de
connection saying in the logs:

Jan 31 02:50:25 www imap-login: Login: bisho
Jan 31 02:50:44 www imap-master: child 22234 (imap) killed with signal 11

It only happens when mutt is configured with a lot of folders. Maybe
covecot loads too much indexes in memory and reachs some limit, but I
have readed carefully the conf file and hadn't found anything related.

Do you have any thought about that?

Thanks a lot again
See you

-- 
        .,,,   Guillermo Pérez    -=] 03/02/2003 [=-
      _' .,,,,  - bisho@ ( onirica.com | eurielec.etsit.upm.es )
     (v)/ ,''
      ( \/    ::  "Nuestras mayores tonterias pueden ser muy sabias."   ::
bisho! ``\\  ::                  -- Leonardo Da Vinci                 ::

From tss@iki.fi  Mon Feb  3 09:03:54 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 03 Feb 2003 09:03:54 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 4B85B239A7
	for <dovecot@procontrol.fi>; Mon,  3 Feb 2003 09:03:54 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 0A62D5E017E8; Mon,  3 Feb 2003 09:03:54 +0200 (EET)
Subject: [dovecot] Re: About the dovecot package (fwd)
From: Timo Sirainen <tss@iki.fi>
To: "Jaldhar H. Vyas" <jaldhar@debian.org>
Cc: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.53.0302030141400.5030@samadhi.braincells.com>
References: <Pine.LNX.4.53.0302030141400.5030@samadhi.braincells.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1044255833.13761.35.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 03 Feb 2003 09:03:53 +0200
X-archive-position: 260
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 260                                                  
Status: O
Content-Length: 1594

On Mon, 2003-02-03 at 08:45, Jaldhar H. Vyas wrote:
> Dear Timo,
> 
> What do you think of this?  Fyi, I've been getting the same thing lately
> and I'm wondering if gnutls is to blame?  (i've had inexlicable SIGSEGVs
> in other apps before due to it.)  Tomorrow I'll try with openssl but I was
> wondering if you had any other ideas?
..
> Jan 31 02:50:44 www imap-master: child 22234 (imap) killed with signal 11

SSL connections are handled by imap-login process, so it can't be that.
Can't really say what would be crashing it .. Well, I'm not sure what
commands mutt uses, but I've found at least a few bugs with SEARCH
command that could crash.

Best way to find out would be to get stacktrace of the crash. imap
processes won't core dump because they've called setuid() (which is kind
of annoying), so you'd have to attach gdb to the running process:

gdb /usr/lib/dovecot/imap <pid>
c
<wait for crash>
bt

> It only happens when mutt is configured with a lot of folders. Maybe
> covecot loads too much indexes in memory and reachs some limit, but I
> have readed carefully the conf file and hadn't found anything related.

Indexes are loaded only one at a time (or two sometimes) to memory.
Amount of folders shouldn't affect anything, but maybe one of the
folders contained something Dovecot didn't like.

CVS has quite a lot of rewritten code for many things though and has
fixed at least a couple of possible crashes.. I think it's now in pretty
usable state, maybe I should put some test-version out of it. New things
are at least POP3 server and (not quite finished) LDAP support.


From kaeesalm@cc.jyu.fi  Mon Feb  3 18:13:12 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 03 Feb 2003 18:13:12 +0200 (EET)
Return-Path: <kaeesalm@cc.jyu.fi>
Delivered-To: dovecot@procontrol.fi
Received: from yabba.kortex.jyu.fi (yabba.kortex.jyu.fi [130.234.182.31])
	by danu.procontrol.fi (Postfix) with ESMTP id 2CF93238C9
	for <dovecot@procontrol.fi>; Mon,  3 Feb 2003 18:13:12 +0200 (EET)
Received: from localhost (localhost [127.0.0.1])
	by yabba.kortex.jyu.fi (Postfix) with ESMTP
	id 7AD4038; Mon,  3 Feb 2003 18:13:10 +0200 (EET)
From: Karo Salminen <kaeesalm@cc.jyu.fi>
Organization: University of =?iso-8859-1?q?Jyv=E4skyl=E4?=
To: Timo Sirainen <tss@iki.fi>
Subject: [dovecot] Re: Dovecot on FreeBSD
Date: Mon, 3 Feb 2003 18:13:06 +0200
User-Agent: KMail/1.5
References: <200302021823.16801.kaeesalm@cc.jyu.fi> <1044249446.27239.22.camel@hurina>
In-Reply-To: <1044249446.27239.22.camel@hurina>
Cc: dovecot@procontrol.fi
MIME-Version: 1.0
Content-Type: Text/Plain;
  charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
Content-Description: clearsigned data
Content-Disposition: inline
Message-Id: <200302031813.10033.kaeesalm@cc.jyu.fi>
X-archive-position: 261
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: kaeesalm@cc.jyu.fi
Precedence: bulk
X-list: dovecot
X-UID: 261                                                  
Status: O
Content-Length: 2134

=2D----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On Monday 03 February 2003 07:17, Timo Sirainen wrote:

> You said shadow.h in IRC :) --without-shadow would have disabled that.
> Does FreeBSD really have getspnam() function elsewhere? Anyway I added
> now check to configure to check for shadow.h too before assuming it
> exists.

I was mixing the terms. Sorry for that. I mean shadow.h of course and=20
=2D --without-shadow.
I did configure with: ./configure --prefix=3D/opt/dovecot --without-shadow=
=20
=2D --without-pop3d --disable-ipv6
ran make and get:
source=3D'passdb-shadow.c' object=3D'passdb-shadow.o' libtool=3Dno =20
depfile=3D'.deps/passdb-shadow.Po' tmpdepfile=3D'.deps/passdb-shadow.TPo' =
=20
depmode=3Dgcc3 /bin/sh ../../depcomp  gcc -DHAVE_CONFIG_H -I. -I. -I../..=20
=2D -I../../src/lib  -I../../src/lib-settings       -g -O2 -Wall -W=20
=2D -Wmissing-prototypes -Wmissing-declarations -Wpointer-arith -Wchar-subs=
cripts=20
=2D -Wformat=3D2 -Wbad-function-cast -c `test -f passdb-shadow.c || echo=20
'./'`passdb-shadow.c
passdb-shadow.c:13:20: shadow.h: No such file or directory
passdb-shadow.c: In function `shadow_verify_plain':
passdb-shadow.c:28: warning: implicit declaration of function `getspnam'
passdb-shadow.c:28: warning: assignment makes pointer from integer without =
a=20
cast
passdb-shadow.c:38: dereferencing pointer to incomplete type
passdb-shadow.c:38: dereferencing pointer to incomplete type
passdb-shadow.c:38: dereferencing pointer to incomplete type
passdb-shadow.c:41: dereferencing pointer to incomplete type
passdb-shadow.c:48: dereferencing pointer to incomplete type
passdb-shadow.c:48: dereferencing pointer to incomplete type
passdb-shadow.c:51: dereferencing pointer to incomplete type
passdb-shadow.c:51: dereferencing pointer to incomplete type
passdb-shadow.c: In function `shadow_deinit':
passdb-shadow.c:65: warning: implicit declaration of function `endspent'
*** Error code 1
=2D----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.1 (FreeBSD)

iD8DBQE+PpUVvt6lNXuj7xcRAl2xAJ9CRJPD1/ul0HtaECQmCsSkz2TQowCgiHf8
zB8A/+ilTJeP5mCwzbBBzHA=3D
=3D3jvm
=2D----END PGP SIGNATURE-----


From tss@iki.fi  Tue Feb  4 02:36:03 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 04 Feb 2003 02:36:03 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 1D528238CB
	for <dovecot@procontrol.fi>; Tue,  4 Feb 2003 02:36:03 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 9C47C5E017E8; Tue,  4 Feb 2003 02:36:02 +0200 (EET)
Subject: [dovecot] Re: Dovecot on FreeBSD
From: Timo Sirainen <tss@iki.fi>
To: Karo Salminen <kaeesalm@cc.jyu.fi>
Cc: dovecot@procontrol.fi
In-Reply-To: <200302031813.10033.kaeesalm@cc.jyu.fi>
References: <200302021823.16801.kaeesalm@cc.jyu.fi>
	 <1044249446.27239.22.camel@hurina>  <200302031813.10033.kaeesalm@cc.jyu.fi>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1044318962.1886.0.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 04 Feb 2003 02:36:02 +0200
X-archive-position: 262
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 262                                                  
Status: O

On Mon, 2003-02-03 at 18:13, Karo Salminen wrote:
> I was mixing the terms. Sorry for that. I mean shadow.h of course and 
> - --without-shadow.

Whops, cvs update for fix :)


From tss@iki.fi  Tue Feb  4 05:45:19 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 04 Feb 2003 05:45:20 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id BBB49238C9
	for <dovecot@procontrol.fi>; Tue,  4 Feb 2003 05:45:19 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 6FB8D5E017E8; Tue,  4 Feb 2003 05:45:19 +0200 (EET)
Subject: [dovecot] 0.99.8-test1 released
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1044330319.1885.50.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 04 Feb 2003 05:45:19 +0200
X-archive-position: 263
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 263                                                  
Status: O
Content-Length: 1560

I think all of the reported bugs are again fixed in CVS, so I made a
tarball of it. I'd like to hear if there's any problems with it. Here's
the most important changes:

v0.99.8 2003-02-xx  Timo Sirainen <tss@iki.fi>

	* NOTE: Configuration file has changed a bit: auth_userinfo was
	  replaced by userdb and passdb. *_port were merged into *_listen.
	  Disabling listening in imaps port is now done by changing protocols
	  setting.

	+ Fully featured POP3 server included. Disabled by default.
	+ Support for LITERAL+, MULTIAPPEND and UNSELECT extensions.
	+ Internal API cleanups made Dovecot faster and take less memory
	+ auth_verbose logs now all authentication failures
	+ Support for Solaris 9 sendfilev() (not really tested)
	- COPY now behaves as RFC2060 says: "If the COPY command is
	  unsuccessful for any reason, server implementations MUST restore the
	  destination mailbox to its state before the COPY attempt."
	- maildir_copy_with_hardlinks = yes was broken.
	- mboxes in subfolders weren't selectable.
	- STORE didn't accept multiple flags without () around them
	- PLAIN SASL-authentication was a bit broken.
	- IMAP dates were parsed a few hours wrong
	- If auth/login process died unexpectedly at startup, the exit status
	  or killing signal wasn't logged.
	- mbox parsing might have crashed sometimes
	- Next command after STARTTLS was ignored which left the connection
	  stuck sometimes
	- STATUS command removed \Recent flags from messages
	- Several bugfixes to SEARCH command, especially related to multiple
	  search conditions


From kaeesalm@cc.jyu.fi  Tue Feb  4 08:57:08 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 04 Feb 2003 08:57:08 +0200 (EET)
Return-Path: <kaeesalm@cc.jyu.fi>
Delivered-To: dovecot@procontrol.fi
Received: from yabba.kortex.jyu.fi (yabba.kortex.jyu.fi [130.234.182.31])
	by danu.procontrol.fi (Postfix) with ESMTP id 19E48238CB
	for <dovecot@procontrol.fi>; Tue,  4 Feb 2003 08:57:08 +0200 (EET)
Received: from localhost (localhost [127.0.0.1])
	by yabba.kortex.jyu.fi (Postfix) with ESMTP
	id A15B738; Tue,  4 Feb 2003 08:57:07 +0200 (EET)
From: Karo Salminen <kaeesalm@cc.jyu.fi>
Organization: University of =?iso-8859-1?q?Jyv=E4skyl=E4?=
To: Timo Sirainen <tss@iki.fi>
Subject: [dovecot] Re: Dovecot on FreeBSD
Date: Tue, 4 Feb 2003 08:57:03 +0200
User-Agent: KMail/1.5
References: <200302021823.16801.kaeesalm@cc.jyu.fi> <200302031813.10033.kaeesalm@cc.jyu.fi> <1044318962.1886.0.camel@hurina>
In-Reply-To: <1044318962.1886.0.camel@hurina>
Cc: dovecot@procontrol.fi
MIME-Version: 1.0
Content-Type: Text/Plain;
  charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
Content-Description: clearsigned data
Content-Disposition: inline
Message-Id: <200302040857.07068.kaeesalm@cc.jyu.fi>
X-archive-position: 264
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: kaeesalm@cc.jyu.fi
Precedence: bulk
X-list: dovecot
X-UID: 264                                                  
Status: O

=2D----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On Tuesday 04 February 2003 02:36, Timo Sirainen wrote:

> > I was mixing the terms. Sorry for that. I mean shadow.h of course and
> > - --without-shadow.
>
> Whops, cvs update for fix :)

You should fix this too:
If building with --without-pop3d dovecot still looks for pop3-login executa=
ble=20
at startup. The prefix for -login bins should also be put as examples=20
referring to $PREFIX set when building instead of /usr/libexec.

=2D----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.1 (FreeBSD)

iD8DBQE+P2RDvt6lNXuj7xcRAjiPAJ4h3T+JCSAwFR3LrhKurDLm7XvaUwCfUtS/
H0oB3+cikZSqvvs8hWbaGOE=3D
=3DjVA9
=2D----END PGP SIGNATURE-----


From kaeesalm@cc.jyu.fi  Tue Feb  4 08:59:53 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 04 Feb 2003 08:59:53 +0200 (EET)
Return-Path: <kaeesalm@cc.jyu.fi>
Delivered-To: dovecot@procontrol.fi
Received: from yabba.kortex.jyu.fi (yabba.kortex.jyu.fi [130.234.182.31])
	by danu.procontrol.fi (Postfix) with ESMTP id 8417D238CB
	for <dovecot@procontrol.fi>; Tue,  4 Feb 2003 08:59:53 +0200 (EET)
Received: from localhost (localhost [127.0.0.1])
	by yabba.kortex.jyu.fi (Postfix) with ESMTP
	id 11BCB38; Tue,  4 Feb 2003 08:59:53 +0200 (EET)
From: Karo Salminen <kaeesalm@cc.jyu.fi>
Organization: University of =?iso-8859-1?q?Jyv=E4skyl=E4?=
To: Timo Sirainen <tss@iki.fi>
Subject: [dovecot] Re: Dovecot on FreeBSD
Date: Tue, 4 Feb 2003 08:59:48 +0200
User-Agent: KMail/1.5
References: <200302021823.16801.kaeesalm@cc.jyu.fi> <1044318962.1886.0.camel@hurina> <200302040857.07068.kaeesalm@cc.jyu.fi>
In-Reply-To: <200302040857.07068.kaeesalm@cc.jyu.fi>
Cc: dovecot@procontrol.fi
MIME-Version: 1.0
Content-Type: Text/Plain;
  charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
Content-Description: clearsigned data
Content-Disposition: inline
Message-Id: <200302040859.52553.kaeesalm@cc.jyu.fi>
X-archive-position: 265
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: kaeesalm@cc.jyu.fi
Precedence: bulk
X-list: dovecot
X-UID: 265                                                  
Status: O

=2D----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On Tuesday 04 February 2003 08:57, Karo Salminen wrote:

> You should fix this too:

And this:
base_dir variable has $PREFIX/var/run/dovecot as its value by default.=20
Shouldn't it be /var/run/dovecot?
=2D----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.1 (FreeBSD)

iD8DBQE+P2Tovt6lNXuj7xcRAgXgAKCDa3BVBdXiNJd8TqIlVKnsWNilaQCfQ3RQ
5fPGBq+sRkbadmv7K/87dtg=3D
=3D9PEz
=2D----END PGP SIGNATURE-----


From tss@iki.fi  Tue Feb  4 09:15:10 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 04 Feb 2003 09:15:10 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 305EE238C7
	for <dovecot@procontrol.fi>; Tue,  4 Feb 2003 09:15:10 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id D7F275E11664; Tue,  4 Feb 2003 09:09:01 +0200 (EET)
Subject: [dovecot] Re: Dovecot on FreeBSD
From: Timo Sirainen <tss@iki.fi>
To: Karo Salminen <kaeesalm@cc.jyu.fi>
Cc: dovecot@procontrol.fi
In-Reply-To: <200302040857.07068.kaeesalm@cc.jyu.fi>
References: <200302021823.16801.kaeesalm@cc.jyu.fi>
	 <200302031813.10033.kaeesalm@cc.jyu.fi> <1044318962.1886.0.camel@hurina>
	 <200302040857.07068.kaeesalm@cc.jyu.fi>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1044342541.1885.109.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 04 Feb 2003 09:09:01 +0200
X-archive-position: 266
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 266                                                  
Status: O

On Tue, 2003-02-04 at 08:57, Karo Salminen wrote:
> You should fix this too:
> If building with --without-pop3d dovecot still looks for pop3-login executable 
> at startup.

Or rather only if protocols setting contains it. Added that check.

>  The prefix for -login bins should also be put as examples 
> referring to $PREFIX set when building instead of /usr/libexec.

No, they would just look stupid there. The beginning of the config file
says what paths are being used, and those are the preferred locations
that package maintainers should use.


From kaeesalm@cc.jyu.fi  Tue Feb  4 09:15:46 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 04 Feb 2003 09:15:46 +0200 (EET)
Return-Path: <kaeesalm@cc.jyu.fi>
Delivered-To: dovecot@procontrol.fi
Received: from yabba.kortex.jyu.fi (yabba.kortex.jyu.fi [130.234.182.31])
	by danu.procontrol.fi (Postfix) with ESMTP id 9D5AD238C7
	for <dovecot@procontrol.fi>; Tue,  4 Feb 2003 09:15:46 +0200 (EET)
Received: from localhost (localhost [127.0.0.1])
	by yabba.kortex.jyu.fi (Postfix) with ESMTP
	id 96B1638; Tue,  4 Feb 2003 09:15:45 +0200 (EET)
From: Karo Salminen <kaeesalm@cc.jyu.fi>
Organization: University of =?iso-8859-1?q?Jyv=E4skyl=E4?=
To: Timo Sirainen <tss@iki.fi>
Subject: [dovecot] Re: Dovecot on FreeBSD
Date: Tue, 4 Feb 2003 09:15:41 +0200
User-Agent: KMail/1.5
Cc: dovecot@procontrol.fi
References: <200302021823.16801.kaeesalm@cc.jyu.fi> <200302040857.07068.kaeesalm@cc.jyu.fi> <200302040859.52553.kaeesalm@cc.jyu.fi>
In-Reply-To: <200302040859.52553.kaeesalm@cc.jyu.fi>
MIME-Version: 1.0
Content-Type: Text/Plain;
  charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
Content-Description: clearsigned data
Content-Disposition: inline
Message-Id: <200302040915.44997.kaeesalm@cc.jyu.fi>
X-archive-position: 267
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: kaeesalm@cc.jyu.fi
Precedence: bulk
X-list: dovecot
X-UID: 267                                                  
Status: O

=2D----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On Tuesday 04 February 2003 08:59, Karo Salminen wrote:

> And this:
> base_dir variable has $PREFIX/var/run/dovecot as its value by default.
> Shouldn't it be /var/run/dovecot?

i built Dovecot again, but with --with-pop3d in order to get it running. It=
=20
seems to execute fine, but it isn't running after all and there are a coupl=
e=20
of critical lines in logs:
=46eb  4 09:11:49 karo dovecot: fcntl(F_GETFD) failed: Bad file descriptor
=46eb  4 09:11:49 karo imap-login: fd_send() failed: Broken pipe

Looks fun.
=2D --=20
Karo Salminen
GSM: +358 45 6728280
WWW: http://www.cc.jyu.fi/~kaeesalm/
=2D----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.1 (FreeBSD)

iD8DBQE+P2igvt6lNXuj7xcRAtE8AJ9VNv9DdZWpyheN8YSKO68Hfy/S0wCdFhEw
hbSa9wdcO78FUAWd9jbxkRU=3D
=3DyAj3
=2D----END PGP SIGNATURE-----


From lfarkas@bnap.hu  Tue Feb  4 13:43:54 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 04 Feb 2003 13:43:54 +0200 (EET)
Return-Path: <lfarkas@bnap.hu>
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 465F4238C7
	for <dovecot@procontrol.fi>; Tue,  4 Feb 2003 13:43:54 +0200 (EET)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id 2EBB775401D
	for <dovecot@procontrol.fi>; Tue,  4 Feb 2003 12:47:21 +0100 (CET)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id CD9223EAF
	for <dovecot@procontrol.fi>; Tue,  4 Feb 2003 12:43:52 +0100 (CET)
Message-ID: <3E3FA779.9070107@bnap.hu>
Date: Tue, 04 Feb 2003 12:43:53 +0100
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2) Gecko/20021202
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: dovecot@procontrol.fi
Subject: [dovecot] bincimap
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 268
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 268                                                  
Status: O

hi,
what do you tyhink about it? especially the faq comment about dovecot?
http://www.bincimap.andreas.hanssen.name/

-- 
   Levente                               "Si vis pacem para bellum!"


From tss@iki.fi  Tue Feb  4 15:36:13 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 04 Feb 2003 15:36:13 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id C221A238C7
	for <dovecot@procontrol.fi>; Tue,  4 Feb 2003 15:36:12 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 0FC055E015A9; Tue,  4 Feb 2003 15:36:11 +0200 (EET)
Subject: [dovecot] Re: bincimap
From: Timo Sirainen <tss@iki.fi>
To: Farkas Levente <lfarkas@bnap.hu>
Cc: dovecot@procontrol.fi, andreas@hanssen.name
In-Reply-To: <3E3FA779.9070107@bnap.hu>
References: <3E3FA779.9070107@bnap.hu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1044365771.942.62.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 04 Feb 2003 15:36:11 +0200
X-archive-position: 269
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 269                                                  
Status: O
Content-Length: 2633

[oh well, let's cc the author as well]

On Tue, 2003-02-04 at 13:43, Farkas Levente wrote:
> hi,
> what do you tyhink about it? especially the faq comment about dovecot?
> http://www.bincimap.andreas.hanssen.name/

That's interesting. Haven't noticed it before. Author's name is actually
familiar from imap mailing list :) Initial impressions:

It uses C++, so why is it still using sprintf() in a few places, just
waiting to be exploited? That alone actually makes me question his "C++
security experience" (well, that's not C++ exactly..). The ones in COPY
and APPEND handling actually can cause buffer overflows if host has long
enough hostname.

Says it's a replacement for Courier IMAP, and the design looks that way
too. Currently at least maildir-specific (there was some empty mbox dir
though) and without any kind of smart indexing, meaning it's quite
likely close to Courier's performance.

I don't really get his comments about TCP wrappers. Meaning that I do
network I/O instead of letting inetd handle it? That's only minimal part
of the code and I'd say it has near-zero possibility for any security
related problems, or any kind of all really. Well, of course doing it in
inetd allows /etc/hosts.deny and such.

I guess his server runs as root until user is authenticated. That
requires that all IMAP commands check properly that they're not run
before authentication, that everything that is run before authentication
must have perfect security or attacker can get roots. SSL communication
is likely also done as root.

That's very different from Dovecot's design, where login process has
been designed so that even in case of a security flaw (eg. SSL library),
there's no way for the attacker to do _anything_ before being properly
authenticated (chrooted, non-privileged user, only access to communicate
with auth process via pipe but no way to get other users' passwords or
anything). Post-login SSL communication is also done by the same login
process, so that exploiting SSL library bugs even then won't do any
good.

It wouldn't be too difficult to allow Dovecot to be run from inetd, but
I don't think there's much point. It's certainly less secure since it
initially requires roots.

Hmm. What else .. I would have expected C++ code to be more .. prettier.
It's 10k lines count may be partially because of C++ and using lex
instead of writing own parsers, but I think it's mostly because it
doesn't really do much. Plaintext authentication + maildir + IMAP4rev1
is pretty much what it does now, without anything special in design or
implementation (except for being C++). Very much like Courier or UW
imapd.


From cras@irccrew.org  Tue Feb  4 17:14:18 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 04 Feb 2003 17:14:18 +0200 (EET)
Return-Path: <cras@irccrew.org>
Delivered-To: dovecot@procontrol.fi
Received: from shodan.irccrew.org (shodan.irccrew.org [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id B32E1238C7
	for <dovecot@procontrol.fi>; Tue,  4 Feb 2003 17:14:18 +0200 (EET)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id B2EA74C0A0; Tue,  4 Feb 2003 17:14:16 +0200 (EET)
Date: Tue, 4 Feb 2003 17:14:16 +0200
From: Timo Sirainen <tss@iki.fi>
To: Binc IMAP <lists-bincimap@infeline.org>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: bincimap
Message-ID: <20030204151416.GA21151@irccrew.org>
References: <1044365771.942.62.camel@hurina> <Pine.LNX.4.40L0.0302041447050.1343-100000@bitto.np>
Mime-Version: 1.0
Content-Disposition: inline
In-Reply-To: <Pine.LNX.4.40L0.0302041447050.1343-100000@bitto.np>
User-Agent: Mutt/1.4i
Content-Type: text/plain; charset=us-ascii
X-archive-position: 270
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 270                                                  
Status: O
Content-Length: 2111

On Tue, Feb 04, 2003 at 02:54:47PM +0100, Andreas Aardal Hanssen wrote:
> I can change the words in the FAQ if you feel offended by it, but you'll
> have to address points individually. I never made remarks about your
> personal code conventions, and I never claimed that my server "focuses on
> security" in the extent that Dovecot does.
> 
> If you want to discuss our different designs, please do it seriously,
> point for point, and don't just troll around like this.

Sorry, I just got a bit disappointed after reading the the web page first.
Your lines of code comparisions just seemed to imply that your server does
everything that others would but with only a fraction of code. There was
also something about Dovecot's design being too complex, so I thought you
might have solved those problems more elegantly.

When you write something from scratch, I think it's a good idea to design it
so that it's superior to existing implementations in at least some ways, not
just make a clone with slightly different coding style. If all you wanted
was a clone with some changes (and better maintainer), forking the project
would be much smaller job.

Well, here's some design thoughts:

Maildir implementation could be hidden behind a class to access it. That
would keep the ugly details hidden from the rest of the code, as well as
allow easily implementing other mail storages.

Restricting yourself to only plaintext authentication doesn't sound very
good plan.

Separating the pre-login process from post-login process would probably be a
good idea to keep their functionality completely separated. It would also be
easier to audit the pre-login code if you knew exactly what there is.
After logging in, you could just exec() the post-login process.

Don't use sprintf().

> Actually I don't get why you guys CC'd me personally on this. If you have
> anything in particular you want to discuss you can post it to the mailing
> list.

I just thought you'd rather want to see it now than months later in google.
I know I would. I didn't think it was really relevant to your mailing list,
but if you say so..


From disco@pervert.ca  Tue Feb  4 18:18:50 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 04 Feb 2003 18:18:50 +0200 (EET)
Return-Path: <disco@pervert.ca>
Delivered-To: dovecot@procontrol.fi
Received: from iridium.pervert.ca (CPE0050bad0aa3e-CM.cpe.net.cable.rogers.com [24.112.138.163])
	by danu.procontrol.fi (Postfix) with ESMTP id 35586238C7
	for <dovecot@procontrol.fi>; Tue,  4 Feb 2003 18:18:48 +0200 (EET)
Received: from PHOTEK (photek.pervert.ca [192.168.1.100])
	by iridium.pervert.ca (8.12.5/8.12.5) with ESMTP id h14CBjOw012085
	for <dovecot@procontrol.fi>; Tue, 4 Feb 2003 12:11:52 GMT
	(envelope-from disco@pervert.ca)
Reply-To: <disco@pervert.ca>
From: "Rick Stewart" <disco@pervert.ca>
To: <dovecot@procontrol.fi>
Subject: [dovecot] Re: bincimap
Date: Tue, 4 Feb 2003 11:21:19 -0500
Organization: Misc. Perversion
Message-ID: <000001c2cc69$7b963870$6401a8c0@PHOTEK>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Priority: 3 (Normal)
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook, Build 10.0.4024
In-Reply-To: <1044365771.942.62.camel@hurina>
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2800.1106
Importance: Normal
X-archive-position: 271
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: disco@pervert.ca
Precedence: bulk
X-list: dovecot
X-UID: 271                                                  
Status: O

	Wait a sec, so dovecot isn't supposed to run from inetd or
xinetd?  I'm just wondering cause that's how I've been running it for
about 2 months.  If not then how "should" I be running it?

./disco

P.S.  Thanks for a slick imap program.  I've been using it and am very
happy with its performance and features.  Cheers Timo.


-----Original Message-----
From: dovecot-bounce@procontrol.fi [mailto:dovecot-bounce@procontrol.fi]
On Behalf Of Timo Sirainen
Sent: February 4, 2003 8:36 AM
To: Farkas Levente
Cc: dovecot@procontrol.fi; andreas@hanssen.name
Subject: [dovecot] Re: bincimap

---[ snip ]---

It wouldn't be too difficult to allow Dovecot to be run from inetd, but
I don't think there's much point. It's certainly less secure since it
initially requires roots.

---[ snip ]---





From tss@iki.fi  Tue Feb  4 19:19:47 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 04 Feb 2003 19:19:47 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 676F5238C9
	for <dovecot@procontrol.fi>; Tue,  4 Feb 2003 19:19:47 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 9B5995E015A9; Tue,  4 Feb 2003 19:19:46 +0200 (EET)
Subject: [dovecot] Re: bincimap
From: Timo Sirainen <tss@iki.fi>
To: disco@pervert.ca
Cc: dovecot@procontrol.fi
In-Reply-To: <000001c2cc69$7b963870$6401a8c0@PHOTEK>
References: <000001c2cc69$7b963870$6401a8c0@PHOTEK>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1044379186.941.81.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 04 Feb 2003 19:19:46 +0200
X-archive-position: 272
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 272                                                  
Status: O

On Tue, 2003-02-04 at 18:21, Rick Stewart wrote:
> 	Wait a sec, so dovecot isn't supposed to run from inetd or
> xinetd?  I'm just wondering cause that's how I've been running it for
> about 2 months.  If not then how "should" I be running it?

Uh. Have you set it to run the imap binary? It doesn't require any
authentication then, just connecting to the port gives direct access.
Not a good idea :)

You should have run imap-master binary. Or dovecot binary in next
version.

From kaeesalm@cc.jyu.fi  Wed Feb  5 22:21:33 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 05 Feb 2003 22:21:33 +0200 (EET)
Return-Path: <kaeesalm@cc.jyu.fi>
Delivered-To: dovecot@procontrol.fi
Received: from yabba.kortex.jyu.fi (yabba.kortex.jyu.fi [130.234.182.31])
	by danu.procontrol.fi (Postfix) with ESMTP id 000042382E
	for <dovecot@procontrol.fi>; Wed,  5 Feb 2003 22:21:32 +0200 (EET)
Received: from localhost (localhost [127.0.0.1])
	by yabba.kortex.jyu.fi (Postfix) with ESMTP
	id A577E59; Wed,  5 Feb 2003 22:21:32 +0200 (EET)
From: Karo Salminen <kaeesalm@cc.jyu.fi>
Organization: University of =?iso-8859-1?q?Jyv=E4skyl=E4?=
To: Timo Sirainen <tss@iki.fi>
Subject: [dovecot] Re: Dovecot on FreeBSD
Date: Wed, 5 Feb 2003 22:21:32 +0200
User-Agent: KMail/1.5
Cc: dovecot@procontrol.fi
References: <200302021823.16801.kaeesalm@cc.jyu.fi> <200302040859.52553.kaeesalm@cc.jyu.fi> <200302040915.44997.kaeesalm@cc.jyu.fi>
In-Reply-To: <200302040915.44997.kaeesalm@cc.jyu.fi>
MIME-Version: 1.0
Content-Type: text/plain;
  charset="iso-8859-1"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline
Message-Id: <200302052221.32110.kaeesalm@cc.jyu.fi>
X-archive-position: 273
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: kaeesalm@cc.jyu.fi
Precedence: bulk
X-list: dovecot
X-UID: 273                                                  
Status: O

On Tuesday 04 February 2003 09:15, Karo Salminen wrote:

> i built Dovecot again, but with --with-pop3d in order to get it running. It
> seems to execute fine, but it isn't running after all and there are a
> couple of critical lines in logs:
> Feb  4 09:11:49 karo dovecot: fcntl(F_GETFD) failed: Bad file descriptor
> Feb  4 09:11:49 karo imap-login: fd_send() failed: Broken pipe

Still no advices?
-- 
Karo Salminen
GSM: +358 45 6728280
WWW: http://www.cc.jyu.fi/~kaeesalm/


From tss@iki.fi  Thu Feb  6 04:35:16 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 06 Feb 2003 04:35:16 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 802D82382E
	for <dovecot@procontrol.fi>; Thu,  6 Feb 2003 04:35:16 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id AC4CA5E015A9; Thu,  6 Feb 2003 04:35:13 +0200 (EET)
Subject: [dovecot] Re: Dovecot on FreeBSD
From: Timo Sirainen <tss@iki.fi>
To: Karo Salminen <kaeesalm@cc.jyu.fi>
Cc: dovecot@procontrol.fi
In-Reply-To: <200302052221.32110.kaeesalm@cc.jyu.fi>
References: <200302021823.16801.kaeesalm@cc.jyu.fi>
	 <200302040859.52553.kaeesalm@cc.jyu.fi>
	 <200302040915.44997.kaeesalm@cc.jyu.fi>
	 <200302052221.32110.kaeesalm@cc.jyu.fi>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1044498913.943.89.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 06 Feb 2003 04:35:13 +0200
X-archive-position: 274
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 274                                                  
Status: O

On Wed, 2003-02-05 at 22:21, Karo Salminen wrote:
> > i built Dovecot again, but with --with-pop3d in order to get it running. It
> > seems to execute fine, but it isn't running after all and there are a
> > couple of critical lines in logs:
> > Feb  4 09:11:49 karo dovecot: fcntl(F_GETFD) failed: Bad file descriptor
> > Feb  4 09:11:49 karo imap-login: fd_send() failed: Broken pipe
> 
> Still no advices?

Does it happen right after startup or only after trying to log in? I'll
probably install FreeBSD 5 soon myself too so I can try then..


From kiwi@oav.net  Thu Feb  6 13:27:56 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 06 Feb 2003 13:27:56 +0200 (EET)
Return-Path: <kiwi@oav.net>
Delivered-To: dovecot@procontrol.fi
Received: from kaneda.oav.net (kaneda.oav.net [195.154.210.144])
	by danu.procontrol.fi (Postfix) with ESMTP id D6516238C5
	for <dovecot@procontrol.fi>; Thu,  6 Feb 2003 13:27:55 +0200 (EET)
Received: from oav.net (localhost.oav.net [127.0.0.1])
	by localhost.oav.net (Postfix) with ESMTP
	id 01E9C1575A; Thu,  6 Feb 2003 12:27:51 +0100 (CET)
	(envelope-from kiwi@oav.net)
X-MessageWall-Score: 0 (oav.net)
Received: from [127.0.0.1] by oav.net (MessageWall 1.0.8) with SMTP; 6 Feb 2003 11:27:46 -0000
Received: from oav.net (kiwi.adsl.isdnet.net [195.154.177.33])
	(using TLSv1 with cipher DES-CBC3-SHA (168/168 bits))
	(No client certificate requested)
	by kaneda.oav.net (Postfix) with ESMTP
	id 29A8815759; Thu,  6 Feb 2003 12:27:46 +0100 (CET)
	(envelope-from kiwi@oav.net)
Date: Thu, 6 Feb 2003 12:27:44 +0100
Subject: [dovecot] Re: Dovecot on FreeBSD
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Mime-Version: 1.0 (Apple Message framework v551)
Cc: dovecot@procontrol.fi
To: Timo Sirainen <tss@iki.fi>
From: Xavier Beaudouin <kiwi@oav.net>
In-Reply-To: <1044498913.943.89.camel@hurina>
Message-Id: <0318CC6C-39C6-11D7-AA02-000393B64262@oav.net>
Content-Transfer-Encoding: quoted-printable
X-Mailer: Apple Mail (2.551)
X-archive-position: 275
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: kiwi@oav.net
Precedence: bulk
X-list: dovecot
X-UID: 275                                                  
Status: O
Content-Length: 1038


Le jeudi, 6 f=E9v 2003, =E0 03:35 Europe/Paris, Timo Sirainen a =E9crit =
:

> On Wed, 2003-02-05 at 22:21, Karo Salminen wrote:
>>> i built Dovecot again, but with --with-pop3d in order to get it=20
>>> running. It
>>> seems to execute fine, but it isn't running after all and there are =
a
>>> couple of critical lines in logs:
>>> Feb  4 09:11:49 karo dovecot: fcntl(F_GETFD) failed: Bad file=20
>>> descriptor
>>> Feb  4 09:11:49 karo imap-login: fd_send() failed: Broken pipe
>>
>> Still no advices?
>
> Does it happen right after startup or only after trying to log in? =
I'll
> probably install FreeBSD 5 soon myself too so I can try then..
>

I had such thing with FreeBSD 4.7-RELEASE-p2 on alpha with a old
dovecot (0.98.4) using the freebsd port ...

Maybe it has been updated. I will have a look at that.

/Xavier
--
Xavier Beaudouin - Unix System Administrator & Projects Leader.
Please visit http://caudium.net/, home of Caudium & Camas projects
O  ascii ribbon campaign against html email
  |\  and Microsoft attachments=


From jaldhar@debian.org  Fri Feb  7 09:08:47 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 07 Feb 2003 09:08:47 +0200 (EET)
Return-Path: <jaldhar@debian.org>
Delivered-To: dovecot@procontrol.fi
Received: from mail.braincells.com (samadhi.braincells.com [216.162.42.100])
	by danu.procontrol.fi (Postfix) with ESMTP id 889EC238C5
	for <dovecot@procontrol.fi>; Fri,  7 Feb 2003 09:08:47 +0200 (EET)
Received: from localhost (localhost [127.0.0.1])
	by mail.braincells.com (Postfix) with ESMTP
	id 7CF4484F5; Fri,  7 Feb 2003 00:43:53 -0500 (EST)
Date: Fri, 7 Feb 2003 00:43:53 -0500 (EST)
From: "Jaldhar H. Vyas" <jaldhar@debian.org>
X-X-Sender: jaldhar@samadhi.braincells.com
Reply-To: "Jaldhar H. Vyas" <jaldhar@debian.org>
To: dovecot@procontrol.fi
Cc: bisho@eurielec.etsit.upm.es
Subject: [dovecot] Re: About the dovecot package (fwd)
In-Reply-To: <1044255833.13761.35.camel@hurina>
Message-ID: <Pine.LNX.4.53.0302070040320.10356@samadhi.braincells.com>
References: <Pine.LNX.4.53.0302030141400.5030@samadhi.braincells.com>
 <1044255833.13761.35.camel@hurina>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 276
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jaldhar@debian.org
Precedence: bulk
X-list: dovecot
X-UID: 276                                                  
Status: O

On Mon, 3 Feb 2003, Timo Sirainen wrote:

> SSL connections are handled by imap-login process, so it can't be that.
> Can't really say what would be crashing it .. Well, I'm not sure what
> commands mutt uses, but I've found at least a few bugs with SEARCH
> command that could crash.
>

just FYI, 0.99.8.test1 appears to have fixed the problems.  Unfortunately
as a number of things have changed, I can't upload new Debian packages
until I make a clean upgrade possible.

Any idea when 0.99.8 final will be released?

-- 
Jaldhar H. Vyas <jaldhar@debian.org>
La Salle Debain - http://www.braincells.com/debian/

From tss@iki.fi  Fri Feb  7 09:18:37 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 07 Feb 2003 09:18:37 +0200 (EET)
Return-Path: <tss@iki.fi>
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id E8F43238C5
	for <dovecot@procontrol.fi>; Fri,  7 Feb 2003 09:18:36 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 39B495E017E9; Fri,  7 Feb 2003 09:18:36 +0200 (EET)
Subject: [dovecot] Re: About the dovecot package (fwd)
From: Timo Sirainen <tss@iki.fi>
To: "Jaldhar H. Vyas" <jaldhar@debian.org>
Cc: dovecot@procontrol.fi, bisho@eurielec.etsit.upm.es
In-Reply-To: <Pine.LNX.4.53.0302070040320.10356@samadhi.braincells.com>
References: <Pine.LNX.4.53.0302030141400.5030@samadhi.braincells.com>
	 <1044255833.13761.35.camel@hurina>
	 <Pine.LNX.4.53.0302070040320.10356@samadhi.braincells.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1044602316.5777.10.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 07 Feb 2003 09:18:36 +0200
X-archive-position: 277
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 277                                                  
Status: O

On Fri, 2003-02-07 at 07:43, Jaldhar H. Vyas wrote:
> just FYI, 0.99.8.test1 appears to have fixed the problems.  Unfortunately
> as a number of things have changed, I can't upload new Debian packages
> until I make a clean upgrade possible.
> 
> Any idea when 0.99.8 final will be released?

There's still some problems with it. At least this doesn't look good:

dovecot: Feb 06 14:22:01 Error: login: Authentication process 0 doesn't exist
imap-login: Feb 06 14:22:01 Fatal: Master sent reply with unknown tag 0

I haven't yet figured out why that happened. Maybe it's also related to
the FreeBSD problems. Anyway, I'll start looking into it again. I didn't
get much done for the past week after seeing first episode of Alias in
TV, I had to get and watch them all ;)


From tss@iki.fi  Sat Feb  8 21:14:48 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 08 Feb 2003 21:14:48 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 8C60F2384B
	for <dovecot@procontrol.fi>; Sat,  8 Feb 2003 21:14:48 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 426855E01F68; Sat,  8 Feb 2003 21:14:48 +0200 (EET)
Subject: [dovecot] 0.99.8-test2 released
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1044731688.29839.101.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 08 Feb 2003 21:14:48 +0200
X-archive-position: 278
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 278                                                  
Status: O

Fixes several smaller bugs. Finally works with FreeBSD (tested with 4.7
and 5.0). I think there's still some problems with authentication
failing sometimes due to memory/ipc corruption. I haven't seen those
today, but I don't think I've fixed that either..

One behaviour change is that if default_mail_env isn't set and mbox
format is detected (~/mail dir), /var/mail/user or /var/spool/mail/user
is used as INBOX if found.

From tss@iki.fi  Tue Feb 11 13:17:17 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 11 Feb 2003 13:17:17 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 8FC762384D
	for <dovecot@procontrol.fi>; Tue, 11 Feb 2003 13:17:17 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 61E8C5E01F68; Tue, 11 Feb 2003 13:17:17 +0200 (EET)
Subject: [dovecot] 0.99.8-test3
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1044962237.29839.243.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 11 Feb 2003 13:17:17 +0200
X-archive-position: 279
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 279                                                  
Status: O

It includes full LDAP support now, can anyone test if it really works?
It has worked with some of my tests, but I don't know too much about
LDAP so I might have missed something important.

The authentication problem in test1 and test2 is also fixed now.


From lfarkas@bnap.hu  Tue Feb 11 13:34:55 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 11 Feb 2003 13:34:55 +0200 (EET)
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id BBB172384D
	for <dovecot@procontrol.fi>; Tue, 11 Feb 2003 13:34:55 +0200 (EET)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id EBB7975401B
	for <dovecot@procontrol.fi>; Tue, 11 Feb 2003 12:35:43 +0100 (CET)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id E9D193EAD
	for <dovecot@procontrol.fi>; Tue, 11 Feb 2003 12:34:53 +0100 (CET)
Message-ID: <3E48E008.8010701@bnap.hu>
Date: Tue, 11 Feb 2003 12:35:36 +0100
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2) Gecko/20021202
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: [dovecot] Re: 0.99.8-test3
References: <1044962237.29839.243.camel@hurina>
In-Reply-To: <1044962237.29839.243.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 280
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 280                                                  
Status: O



Timo Sirainen wrote:
> It includes full LDAP support now, can anyone test if it really works?
> It has worked with some of my tests, but I don't know too much about
> LDAP so I might have missed something important.

ohh? and is there any doc about this part?
did you see
http://jamm.sourceforge.net/howto/html/
we plan to use it, but I'm not realy like courier...

-- 
    Levente                               "Si vis pacem para bellum!"



From mark@mercurial-mouth.com  Fri Feb 14 14:19:23 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 14 Feb 2003 14:19:23 +0200 (EET)
Return-Path: <mark@mercurial-mouth.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from nmail1.systems.pipex.net (nmail1.systems.pipex.net [62.241.160.130])
	by danu.procontrol.fi (Postfix) with ESMTP id AF8142384E
	for <dovecot@procontrol.fi>; Fri, 14 Feb 2003 14:19:23 +0200 (EET)
Received: from nmail1.systems.pipex.net (localhost [127.0.0.1])
	by nmail1.systems.pipex.net (8.12.4/8.12.4) with ESMTP id h1ECJNcL013530
	for <dovecot@procontrol.fi>; Fri, 14 Feb 2003 12:19:23 GMT
Received: (from nobody@localhost)
	by nmail1.systems.pipex.net (8.12.4/8.12.4/Submit) id h1ECJNtl013529
	for dovecot@procontrol.fi; Fri, 14 Feb 2003 12:19:23 GMT
To: <dovecot@procontrol.fi>
Subject: [dovecot] Brain bubbles
Message-ID: <1045225163.3e4cdecb57871@netmail.pipex.net>
Date: Fri, 14 Feb 2003 12:19:23 +0000
From: Mark Lancaster <mark@mercurial-mouth.com>
MIME-Version: 1.0
Content-Type: text/plain
Content-Transfer-Encoding: 8bit
User-Agent: PIPEX NetMail 2.2.0-pre13
X-PIPEX-username: aonz04%dsl.pipex.com
X-Originating-IP: 62.189.158.225
X-Usage: Use of PIPEX NetMail is subject to the PIPEX Terms and Conditions of use
X-archive-position: 281
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mark@mercurial-mouth.com
Precedence: bulk
X-list: dovecot
X-UID: 281                                                  
Status: O


Hi

Bit of a newbie to imap servers re: the article on webmonkey!
http://hotwired.lycos.com/webmonkey/03/04/index3a_page4.html?tw=backend 

Been trying to set up SSL support with the latest ver. of dovecote I'm guessing 
that the following line from STDOUT is the problem. How to fix it is beyond my 
grasp currently.

checking for SSL_read in -lssl... (cached) no

Any ideas.

ttfn

Mark




From charlieb-dovecot@e-smith.com  Mon Feb 17 05:01:14 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 17 Feb 2003 05:01:14 +0200 (EET)
Return-Path: <charlieb-dovecot@e-smith.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from nssg.mitel.com (mail.e-smith.com [216.191.234.126])
	by danu.procontrol.fi (Postfix) with SMTP id 7E9CE23839
	for <dovecot@procontrol.fi>; Mon, 17 Feb 2003 05:01:13 +0200 (EET)
Received: (qmail 20052 invoked by uid 404); 17 Feb 2003 03:01:11 -0000
Received: from charlieb-dovecot@e-smith.com by tripe.nssg.mitel.com with qmail-scanner; 16 Feb 2003 22:01:10 -0000
Received: from allspice-core.nssg.mitel.com (HELO e-smith.com) (10.33.16.12)
  by tripe.nssg.mitel.com (10.33.17.11) with SMTP; 17 Feb 2003 03:01:10 -0000
Received: (qmail 21592 invoked by uid 5008); 17 Feb 2003 03:01:10 -0000
Received: from localhost (sendmail-bs@127.0.0.1)
  by localhost with SMTP; 17 Feb 2003 03:01:10 -0000
Date: Sun, 16 Feb 2003 22:01:09 -0500 (EST)
From: Charlie Brady <charlieb-dovecot@e-smith.com>
X-X-Sender: charlieb@allspice.nssg.mitel.com
To: Timo Sirainen <tss@iki.fi>
Cc: Binc IMAP <lists-bincimap@infeline.org>, <dovecot@procontrol.fi>
Subject: [dovecot] Re: bincimap
In-Reply-To: <20030204151416.GA21151@irccrew.org>
Message-ID: <Pine.LNX.4.44.0302162136490.2041-100000@allspice.nssg.mitel.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 282
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: charlieb-dovecot@e-smith.com
Precedence: bulk
X-list: dovecot
X-UID: 282                                                  
Status: O
Content-Length: 1890


On Tue, 4 Feb 2003, Timo Sirainen wrote:

> Sorry, I just got a bit disappointed after reading the the web page first.
> Your lines of code comparisions just seemed to imply that your server does
> everything that others would but with only a fraction of code.

Well, it doesn't claim to support other than Maildir, but it does claim to 
be a full IMAP4rev1 implementation.

> When you write something from scratch, I think it's a good idea to design it
> so that it's superior to existing implementations in at least some ways

Are you suggesting that Andreas hasn't done this?

> just make a clone with slightly different coding style. If all you wanted
> was a clone with some changes (and better maintainer), forking the project
> would be much smaller job.

Who would want a clone of Courier IMAP? :-)

> Separating the pre-login process from post-login process would probably be a
> good idea to keep their functionality completely separated. It would also be
> easier to audit the pre-login code if you knew exactly what there is.
> After logging in, you could just exec() the post-login process.

Agreed. Given that qmail-pop3d was an inspiration, I'm surprised this 
hasn't been done.

You might look at http://www.untroubled.org/mailfront/imapfront.html for a 
pre-existing pre-login imapd. Doesn't handle STARTTLS though.

Timo, my preferred way to run network servers is to have tcpserver 
running under supervise, and logging to multilog. bincimap is designed to 
run this way. I don't know how dovecot executes - there's no mention of 
either init.d or inetd in the documentation AFAICT. Can dovecot be used in 
a supervise/tcpserver/multilog environment, and if so, how?

--
Charlie Brady 
Lead Product Developer
Network Server Solutions Group
Mitel Networks Corporation      http://www.mitel.com/smallbusiness
Phone: +1 (613) 592 5660 or 592 2122  Fax: +1 (613) 592 1175



From tss@iki.fi  Mon Feb 17 10:45:42 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 17 Feb 2003 10:45:42 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 59B3E23839
	for <dovecot@procontrol.fi>; Mon, 17 Feb 2003 10:45:42 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 29CC75E01F68; Mon, 17 Feb 2003 10:45:42 +0200 (EET)
Subject: [dovecot] Re: Brain bubbles
From: Timo Sirainen <tss@iki.fi>
To: Mark Lancaster <mark@mercurial-mouth.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <1045225163.3e4cdecb57871@netmail.pipex.net>
References: <1045225163.3e4cdecb57871@netmail.pipex.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1045471541.4604.110.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 17 Feb 2003 10:45:42 +0200
X-archive-position: 283
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 283                                                  
Status: O

On Fri, 2003-02-14 at 14:19, Mark Lancaster wrote:
> Been trying to set up SSL support with the latest ver. of dovecote I'm guessing 
> that the following line from STDOUT is the problem. How to fix it is beyond my 
> grasp currently.
> 
> checking for SSL_read in -lssl... (cached) no

Install OpenSSL. Depending on your os/distribution it's likely in
libssl* packages. libssl-dev is also needed. Or you could get the
sources from www.openssl.org

Also remove config.cache file after installing so that the check runs
again.


From tss@iki.fi  Mon Feb 17 11:14:36 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 17 Feb 2003 11:14:36 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id CEAFF23839
	for <dovecot@procontrol.fi>; Mon, 17 Feb 2003 11:14:35 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 826DA5E01F68; Mon, 17 Feb 2003 11:14:35 +0200 (EET)
Subject: [dovecot] Re: [bincimap] Re: Re: bincimap
From: Timo Sirainen <tss@iki.fi>
To: Binc IMAP <lists-bincimap@infeline.org>
Cc: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.44.0302170709340.1469-100000@krs-dhcp401.studby.uio.no>
References:
	 <Pine.LNX.4.44.0302170709340.1469-100000@krs-dhcp401.studby.uio.no>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1045473275.4601.140.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 17 Feb 2003 11:14:35 +0200
X-archive-position: 284
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 284                                                  
Status: O
Content-Length: 1243

On Mon, 2003-02-17 at 08:28, Andreas Aardal Hanssen wrote:
> I wonder what the motives for the author of Dovecot IMAP was when he
> started his project.

Lack of securely written code in other servers, although Courier did
prove to be quite secure after all.

> I wouldn't want to comment on Dovecot's design, since I'm no fan of
> trolling.

I don't think commenting is trolling, as long as there's truth in it, or
at least honest opinions.

> The project clearly has different goals than Binc. Dovecot wants
> excellent features, indexing and an advanced security promoting design. 

Implementation security as well. I'm not sure about features. It's more
about trying to be fast and light. Indexes make Dovecot comparable to
Cyrus in speed, but updating them isn't required so it's still drop-in
replacement for UW imapd and Courier. Index files themselves aren't
really required either, but there's no option currently to disable them.

> It even recently included a POP server. What's the reasoning there?

Someone wanted it so it'd be easy to run both POP3 and IMAP servers
without having to configure them twice. I don't see any harm in it
anyway, it took only few hours to write, it's optional and doesn't take
much space in sources.


From tss@iki.fi  Mon Feb 17 11:29:48 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 17 Feb 2003 11:29:48 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 33D8523839
	for <dovecot@procontrol.fi>; Mon, 17 Feb 2003 11:29:48 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id F0A915E01F68; Mon, 17 Feb 2003 11:29:47 +0200 (EET)
Subject: [dovecot] Re: bincimap
From: Timo Sirainen <tss@iki.fi>
To: Charlie Brady <charlieb-dovecot@e-smith.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.44.0302162136490.2041-100000@allspice.nssg.mitel.com>
References:
	 <Pine.LNX.4.44.0302162136490.2041-100000@allspice.nssg.mitel.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1045474187.4604.155.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 17 Feb 2003 11:29:47 +0200
X-archive-position: 285
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 285                                                  
Status: O

On Mon, 2003-02-17 at 05:01, Charlie Brady wrote:
> Timo, my preferred way to run network servers is to have tcpserver 
> running under supervise, and logging to multilog. bincimap is designed to 
> run this way. I don't know how dovecot executes - there's no mention of 
> either init.d or inetd in the documentation AFAICT. Can dovecot be used in 
> a supervise/tcpserver/multilog environment, and if so, how?

I haven't looked too deeply into daemontools, but CVS supports logging
into /dev/stderr (it was before closed or used for other purposes) which
I've heard is enough for multilog.

I don't think it could be made to run with tcpserver without changes.
Dovecot is executed by running a master binary (imap-master before,
dovecot in CVS) which creates rest of the required processes
(authentication, pre-auth imap, post-auth imap)


From tss@iki.fi  Mon Feb 17 12:09:02 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 17 Feb 2003 12:09:02 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 552A423839
	for <dovecot@procontrol.fi>; Mon, 17 Feb 2003 12:09:02 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 174945E01F68; Mon, 17 Feb 2003 12:09:02 +0200 (EET)
Subject: [dovecot] Re: [bincimap] bincimap
From: Timo Sirainen <tss@iki.fi>
To: Binc IMAP <lists-bincimap@infeline.org>
Cc: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.40L0.0302171022280.2040-100000@bitto.np>
References: <Pine.LNX.4.40L0.0302171022280.2040-100000@bitto.np>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1045476541.4601.189.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 17 Feb 2003 12:09:01 +0200
X-archive-position: 286
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 286                                                  
Status: O
Content-Length: 1615

On Mon, 2003-02-17 at 11:33, Andreas Aardal Hanssen wrote:
> Binc IMAP's approaches are to use a secure programming language with
> secure well-known contructs, and with an as-simple-as-possible design,
> making it very easy for everyone to grasp how the server works. This will
> also help the community find and fix bugs.

I kind of agree, but not at the expense of security. I have tried to
keep my code clean and ugly-optimization-free anyway.

> Here's where I would say - there are hundreds of working POP3 servers
> around, both in closed and open source, so adding a POP3 server to the
> Dovecot project just introduces more lines of code where bugs may appear
> ;).

Yes, and I wouldn't have done it if it hadn't been so easy. I don't
really encourage people to use it anyway, it's even disabled by default.
If it has bugs, it doesn't affect the IMAP side.

If people really need to run both IMAP and POP3 servers, it is simpler
to use the same configuration for both, especially if the configuration
isn't "standard" (eg. LDAP or SQL authentication, mailboxes in special
locations, etc).

All other major IMAP servers provide their own POP3 servers as well, if
you haven't noticed :)

> Donald Knuth said in a seminar that I attended that the best way to keep a
> program free from bugs it to complete it. Finish off the project, work on
> fixing bugs. That's Binc IMAP's philosophy.

That's the ideal situation, and even possible if you keep the original
goals. But there are IMAP extensions which may require large changes,
new mail storage formats and ways to deliver mail into them, clustering,
etc.


From ianj@ian-justman.com  Mon Feb 17 12:15:49 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 17 Feb 2003 12:15:49 +0200 (EET)
Return-Path: <ianj@ian-justman.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from narshe.chocobo.org (dsl-207-126-72-242.dsl.netasset.net [207.126.72.242])
	by danu.procontrol.fi (Postfix) with ESMTP id B596523839
	for <dovecot@procontrol.fi>; Mon, 17 Feb 2003 12:15:48 +0200 (EET)
Received: from zozo.intrn.chocobo.org (zozo.chocobo.org [207.126.72.244])
	by narshe.chocobo.org (Postfix) with ESMTP id C4C8430FE72
	for <dovecot@procontrol.fi>; Mon, 17 Feb 2003 02:15:46 -0800 (PST)
Received: by zozo.intrn.chocobo.org (Postfix, from userid 501)
	id A43ED86E3BF; Mon, 17 Feb 2003 02:15:46 -0800 (PST)
Received: from localhost (localhost [127.0.0.1])
	by zozo.intrn.chocobo.org (Postfix) with ESMTP id 95531449AD3
	for <dovecot@procontrol.fi>; Mon, 17 Feb 2003 02:15:46 -0800 (PST)
Date: Mon, 17 Feb 2003 02:14:47 -0800 (PST)
From: "Ian R. Justman" <ianj@ian-justman.com>
X-X-Sender: ianj@zozo.chocobo.org
To: Binc IMAP <lists-bincimap@infeline.org>
Subject: [dovecot] Re: [bincimap] Re: Re: bincimap
In-Reply-To: <Pine.LNX.4.40L0.0302171022280.2040-100000@bitto.np>
Message-ID: <Pine.LNX.4.44.0302170143390.11860-100000@zozo.chocobo.org>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
ReSent-Date: Mon, 17 Feb 2003 02:15:42 -0800 (PST)
Resent-From: "Ian R. Justman" <ianj@ian-justman.com>
Resent-To: dovecot@procontrol.fi
ReSent-Subject: Re: [dovecot] Re: [bincimap] Re: Re: bincimap
ReSent-Message-ID: <Pine.LNX.4.44.0302170215420.11860@zozo.chocobo.org>
X-archive-position: 287
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: ianj@ian-justman.com
Precedence: bulk
X-list: dovecot
X-UID: 287                                                  
Status: O
Content-Length: 2089



On Mon, 17 Feb 2003, Andreas Aardal Hanssen wrote:

> >> It even recently included a POP server. What's the reasoning there?
> >Someone wanted it so it'd be easy to run both POP3 and IMAP servers
> >without having to configure them twice. I don't see any harm in it
> >anyway, it took only few hours to write, it's optional and doesn't take
> >much space in sources.
>
> Here's where I would say - there are hundreds of working POP3 servers
> around, both in closed and open source, so adding a POP3 server to the
> Dovecot project just introduces more lines of code where bugs may appear
> ;).

Here is what -I- would say:

I use mbox on all my servers which I have absolutely no intention of
changing despite the issues concerning file locking inherent in the whole
mbox format.  So please, --NO-- attempts to convince me to go to maildir.

My take is that if I am going to use an IMAP server, it would be VERY nice
if a POP3 server also came bundled with it.  Dovecot's having both IMAP
and POP3 servers is great because they will likely use the same
file-locking schemes (in fact, probably even share the same locking
settings).

That way if I inadvertently start up a POP3 session while I am connected
via IMAP, if they use identical locking mechanisms, I don't screw up my
mailboxes should I inadvertently tell my system that I want to delete the
messages from my mailbox.

Basically, if you open via IMAP using a server with a diffent locking
scheme while your hung POP3 session is still running AND you modify your
mailbox, you are screwed.  Especially if that mailstore is NFS-shared,
which is always a dicey proposition.

Additionally, the number of mbox POP3 servers which Do Not Suck(R) is
rather low right now.  Timo finally introduced an mbox IMAP server which
definitely Does Not Suck, notably it allows for multiple clients accessing
the same mbox mailstore, something previously only offered by Cyrus and
perhaps maildir ("perhaps" only because I do not use maildir).

Not to mention, quite frankly, most mbox POP3 implementations suck pretty
badly anyway. :P

--Ian.



From tss@iki.fi  Mon Feb 17 19:34:04 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 17 Feb 2003 19:34:04 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id F06C52384D
	for <dovecot@procontrol.fi>; Mon, 17 Feb 2003 19:34:03 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id B465A5E01F68; Mon, 17 Feb 2003 19:34:03 +0200 (EET)
Subject: [dovecot] Re: [bincimap] Re: Re: bincimap
From: Timo Sirainen <tss@iki.fi>
To: "Ian R. Justman" <ianj@ian-justman.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.44.0302170143390.11860-100000@zozo.chocobo.org>
References: <Pine.LNX.4.44.0302170143390.11860-100000@zozo.chocobo.org>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1045503243.4601.422.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 17 Feb 2003 19:34:03 +0200
X-archive-position: 288
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 288                                                  
Status: O

On Mon, 2003-02-17 at 12:14, Ian R. Justman wrote:
> Additionally, the number of mbox POP3 servers which Do Not Suck(R) is
> rather low right now.  Timo finally introduced an mbox IMAP server which
> definitely Does Not Suck, notably it allows for multiple clients accessing
> the same mbox mailstore, something previously only offered by Cyrus and
> perhaps maildir ("perhaps" only because I do not use maildir).

I don't actually understand why UW imapd doesn't allow it. It needs to
be able to deal with unexpected mbox changes anyway, so why allow only
one IMAP session for it? Or maybe it deals with unexpected changes just
by killing the IMAP connection? I'd have to try some day.

Few days ago I was also wondering how UW imapd even knows how to kill
the older connection. It seems that it writes PID to
/tmp/.<device>.<inode>. When another IMAP process tries to access the
same mbox it sees the file, sends SIGUSR2 to the PID inside it and waits
for a while to see if the lock file goes away. Strange.


From dovecot@andreas.hanssen.name  Mon Feb 17 20:07:22 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 17 Feb 2003 20:09:57 +0200 (EET)
Return-Path: <dovecot@andreas.hanssen.name>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from krs-dhcp401.studby.uio.no (krs-dhcp054.studby.uio.no [129.240.106.84])
	by danu.procontrol.fi (Postfix) with SMTP id 6A70C23839
	for <dovecot@procontrol.fi>; Mon, 17 Feb 2003 20:07:22 +0200 (EET)
Received: (qmail 7066 invoked by uid 500); 17 Feb 2003 18:07:39 -0000
Received: from localhost (sendmail-bs@127.0.0.1)
  by localhost with SMTP; 17 Feb 2003 18:07:39 -0000
Date: Mon, 17 Feb 2003 19:07:36 +0100 (CET)
From: Andreas Aardal Hanssen <dovecot@andreas.hanssen.name>
X-X-Sender: andreaha@krs-dhcp401.studby.uio.no
To: dovecot@procontrol.fi
Subject: [dovecot] Re: [bincimap] Re: Re: bincimap
In-Reply-To: <Pine.LNX.4.44.0302170143390.11860-100000@zozo.chocobo.org>
Message-ID: <Pine.LNX.4.44.0302171837210.2161-100000@krs-dhcp401.studby.uio.no>
X-Sent-From-Infeline: Yes
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 289
X-Approved-By: tss@iki.fi
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: dovecot@andreas.hanssen.name
Precedence: bulk
X-list: dovecot
X-UID: 289                                                  
Status: O
Content-Length: 3198

Hi, Ian. Cross-posting discussions like this is usually not appreciated by
those who subscribe to both foras, so I'll limit it to the Dovecot list.

On Mon, 17 Feb 2003, Ian R. Justman wrote:
>On Mon, 17 Feb 2003, Andreas Aardal Hanssen wrote:
>My take is that if I am going to use an IMAP server, it would be VERY nice
>if a POP3 server also came bundled with it.  Dovecot's having both IMAP
>and POP3 servers is great because they will likely use the same
>file-locking schemes (in fact, probably even share the same locking
>settings).

I agree with you.

But any shared mailbox format that makes assumptions on the type of
locking used by other accessors, and does not provide a standard locking
mechanism bundled with the format specification, is b0rken. But nobody
ever claimed that mbox was anything else, did they? ;) mbox is yesterday's
format, and the only reason people cling to it is for convenience and "if
it works, don't fix it".

Today we can exploit concurrency and rapid access in ways that were
unthinkable back when mbox was designed. It's only natural that the old
and worn fall by the swords of the young and strong. :-)

>Basically, if you open via IMAP using a server with a diffent locking
>Additionally, the number of mbox POP3 servers which Do Not Suck(R) is
>rather low right now.  Timo finally introduced an mbox IMAP server which

This I don't agree with. Most existing POP3 servers are quite ok, and
one POP3 Maildir server that is excellent and bug free since 1998,
qmail-pop3d, is quite a piece of art.

>Not to mention, quite frankly, most mbox POP3 implementations suck pretty
>badly anyway. :P

This I do agree with. Don't confuse POP3 servers in general with mbox POP3
servers. The root, the source of the evil is the storage format mbox.

Now I will not claim that Maildir is indefinitely much better, but it's
almost, but not quite, much much better than mbox.

With Maildir there's no need to lock the depository when deleting or
delivering mails (even on NFS), but you can't store (append) a message
with a timestamp nor with flags without breaking consistency, and servers
have to search for lost messages when an external client changes a flag.

With mbox you have to rewrite the entire mailbox after expunging message
#1, and exclusive access is required when doing so. With no indexes,
mboxes also need to be more or less parsed on every login - I understand
that Dovecot has done some smart stuff here, but that's a workaround for
one of the big headaches of a crappy storage format.

Nobody with their wits intact would come up with something as pathetic as
the mbox storage format in 2003. That's _my_ personal opinion on this
matter.

Now Binc IMAP does not support this format, but that's not because I
don't want it to. Rather, I'd like to investigate neat ways to make it
work just like Timo has with Dovecot. But rather than breathing fresh
air into the wrinkled nostrels of one of the Internet age's uglier
artifacts, I'd like to find a way to move all users away from mbox and
into a new mailbox format. One box to rule them all. ;)

btw, Flames are happily accepted. :-)

Andy

-- 
Andreas Aardal Hanssen
http://www.andreas.hanssen.name/gpg


From skvidal@phy.duke.edu  Mon Feb 17 20:17:01 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 17 Feb 2003 20:17:01 +0200 (EET)
Return-Path: <skvidal@phy.duke.edu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail.phy.duke.edu (mail.phy.duke.edu [152.3.182.2])
	by danu.procontrol.fi (Postfix) with ESMTP id 5FB2423839
	for <dovecot@procontrol.fi>; Mon, 17 Feb 2003 20:17:01 +0200 (EET)
Received: from user-152-16-65-11.adsl.duke.edu (user-152-16-65-11.adsl.duke.edu [152.16.65.11])
	by mail.phy.duke.edu (Postfix) with ESMTP
	id 722A0301AF; Mon, 17 Feb 2003 13:16:56 -0500 (EST)
Subject: [dovecot] Re: [bincimap] Re: Re: bincimap
From: seth vidal <skvidal@phy.duke.edu>
To: Andreas Aardal Hanssen <dovecot@andreas.hanssen.name>
Cc: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.44.0302171837210.2161-100000@krs-dhcp401.studby.uio.no>
References:
	 <Pine.LNX.4.44.0302171837210.2161-100000@krs-dhcp401.studby.uio.no>
Content-Type: text/plain
Organization: 
Message-Id: <1045505809.23411.93.camel@binkley>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 (1.2.2-0) 
Date: 17 Feb 2003 13:16:50 -0500
Content-Transfer-Encoding: 7bit
X-archive-position: 290
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: skvidal@phy.duke.edu
Precedence: bulk
X-list: dovecot
X-UID: 290                                                  
Status: O
Content-Length: 1566


> I agree with you.
> 
> But any shared mailbox format that makes assumptions on the type of
> locking used by other accessors, and does not provide a standard locking
> mechanism bundled with the format specification, is b0rken. But nobody
> ever claimed that mbox was anything else, did they? ;) mbox is yesterday's
> format, and the only reason people cling to it is for convenience and "if
> it works, don't fix it".

Actually, there are a number of reasons why I still have mbox format.
Most of them are legacy. But keep in mind this is 10yrs of legacy in the
same format. That kind of inertia takes effort to break free of and in
some cases there are political situations which make breaking free just
about impossible. But thanks for only attributing laziness to those of
us who need to use  mbox.

The reason I want an imap and pop server than can handle both mbox and
maildir is so I can gradually migrate my users over.

I can take them in batches and move their mail spools to maildir w/o
massively disrupting their normal activities.

200-400 users at 2-4 a day will take me 1/3 of a year.

Doing them all in one day will take me a lifetime of cleaning up
problems and also trying to explain to those above me why I put all of
our users through it.

> Nobody with their wits intact would come up with something as pathetic as
> the mbox storage format in 2003. That's _my_ personal opinion on this
> matter.

We're not disputing that. But mbox is going to HAVE to be there for
migration, otherwise you'll not be able to get the users moved over.

-sv



From tss@iki.fi  Mon Feb 17 20:39:02 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 17 Feb 2003 20:39:02 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id E42942384D
	for <dovecot@procontrol.fi>; Mon, 17 Feb 2003 20:39:01 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id A30D45E01F68; Mon, 17 Feb 2003 20:39:01 +0200 (EET)
Subject: [dovecot] Re: [bincimap] Re: Re: bincimap
From: Timo Sirainen <tss@iki.fi>
To: Andreas Aardal Hanssen <dovecot@andreas.hanssen.name>
Cc: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.44.0302171837210.2161-100000@krs-dhcp401.studby.uio.no>
References:
	 <Pine.LNX.4.44.0302171837210.2161-100000@krs-dhcp401.studby.uio.no>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1045507141.4601.450.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 17 Feb 2003 20:39:01 +0200
X-archive-position: 291
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 291                                                  
Status: O
Content-Length: 1668

On Mon, 2003-02-17 at 20:07, Andreas Aardal Hanssen wrote:
> Now I will not claim that Maildir is indefinitely much better, but it's
> almost, but not quite, much much better than mbox.

The main difference is if there should be one file per message or one
file per mailbox. Per-mailbox files are faster (less syscalls, less
filesystem stress) as long as mails aren't being expunged from the
middle of it. I'm still personally using mbox and I know I usually
delete only mails that I've received recently so only small parts of the
file needs to be rewritten.

So which one is faster depends mostly on the user. I'm not sure about
"better" argument. mbox needs a more work to make it work well. UW imapd
supports also another flat file format "mbx" which should be more
IMAP-friendly.

UW imapd author also says that mbox is slow and changing to mbx would
give a lot higher performance, but I think that's mostly commenting UW
imapd implementation than mbox format itself. There are some ugly
slowing hacks that have to be done, but they're not _that_ slow if
implemented well. And that slowness shows just in CPU usage which is
cheap in IMAP servers compared to I/O.

> With Maildir there's no need to lock the depository when deleting or
> delivering mails (even on NFS), but you can't store (append) a message
> with a timestamp nor with flags without breaking consistency,

I don't understand this. What's the problem with setting timestamp or
flags when appending a message? You create it in tmp/ with wanted name
and timestamp, then rename() it.

>  and servers
> have to search for lost messages when an external client changes a flag.

Yes, this is annoying.


From dovecot@andreas.hanssen.name  Mon Feb 17 20:59:00 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 17 Feb 2003 20:59:00 +0200 (EET)
Return-Path: <dovecot@andreas.hanssen.name>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from krs-dhcp401.studby.uio.no (krs-dhcp054.studby.uio.no [129.240.106.84])
	by danu.procontrol.fi (Postfix) with SMTP id B51692384D
	for <dovecot@procontrol.fi>; Mon, 17 Feb 2003 20:59:00 +0200 (EET)
Received: (qmail 10353 invoked by uid 500); 17 Feb 2003 18:59:18 -0000
Received: from localhost (sendmail-bs@127.0.0.1)
  by localhost with SMTP; 17 Feb 2003 18:59:18 -0000
Date: Mon, 17 Feb 2003 19:59:17 +0100 (CET)
From: Andreas Aardal Hanssen <dovecot@andreas.hanssen.name>
X-X-Sender: andreaha@krs-dhcp401.studby.uio.no
To: dovecot@procontrol.fi
Subject: [dovecot] Re: [bincimap] Re: Re: bincimap
In-Reply-To: <1045507141.4601.450.camel@hurina>
Message-ID: <Pine.LNX.4.44.0302171942430.9975-100000@krs-dhcp401.studby.uio.no>
X-Sent-From-Infeline: Yes
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 292
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: dovecot@andreas.hanssen.name
Precedence: bulk
X-list: dovecot
X-UID: 292                                                  
Status: O
Content-Length: 1869

On 17 Feb 2003, Timo Sirainen wrote:
>On Mon, 2003-02-17 at 20:07, Andreas Aardal Hanssen wrote:
>> With Maildir there's no need to lock the depository when deleting or
>> delivering mails (even on NFS), but you can't store (append) a message
>> with a timestamp nor with flags without breaking consistency,
>I don't understand this. What's the problem with setting timestamp or
>flags when appending a message? You create it in tmp/ with wanted name
>and timestamp, then rename() it.

You use the rename system call for this?
From maildir-storage.c, line 325:

        while (rename(src, dest) < 0 && count < 2) {
                if (errno != EEXIST) {

rename can never return EEXIST in errno. maildir-save.c, line 124.

        /* move the file into new/ directory - syncing will pick it
           up from there */
        if (rename(tmp_path, new_path) == 0)
                failed = FALSE;

Here you can lose emails if the new/ folder contains a message whose base 
name is equal. The only way to avoid this is:

1) use link and unlink, not rename
2) leave messages that have a time_t part equal to or higher than 
   time(NULL).

Anyway, Maildir has a strict consistency criteria which says that all
messages that are linked from tmp/ into new/ _must_ use time(NULL) plus a
number that is guaranteed not to lapse within one second, and which does
not collide with other messages in new/. new/ is the single entry point
into cur/, and messages in new/ can not be "older" than the messages in
cur/.

The simple reasoning for this is that you can never guarantee that there
is no message in cur/ that has the same base name, but perhaps different
flags. It follows that when moving a message from new/ to cur/, it is
required that the server only picks messages that are older than one
second.

Andy

-- 
Andreas Aardal Hanssen
http://www.andreas.hanssen.name/gpg


From dovecot@andreas.hanssen.name  Mon Feb 17 21:03:02 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 17 Feb 2003 21:03:02 +0200 (EET)
Return-Path: <dovecot@andreas.hanssen.name>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from krs-dhcp401.studby.uio.no (krs-dhcp054.studby.uio.no [129.240.106.84])
	by danu.procontrol.fi (Postfix) with SMTP id E3E9A2384D
	for <dovecot@procontrol.fi>; Mon, 17 Feb 2003 21:03:01 +0200 (EET)
Received: (qmail 10377 invoked by uid 500); 17 Feb 2003 19:03:19 -0000
Received: from localhost (sendmail-bs@127.0.0.1)
  by localhost with SMTP; 17 Feb 2003 19:03:19 -0000
Date: Mon, 17 Feb 2003 20:03:14 +0100 (CET)
From: Andreas Aardal Hanssen <dovecot@andreas.hanssen.name>
X-X-Sender: andreaha@krs-dhcp401.studby.uio.no
To: dovecot@procontrol.fi
Subject: [dovecot] Re: [bincimap] Re: Re: bincimap
In-Reply-To: <Pine.LNX.4.44.0302171942430.9975-100000@krs-dhcp401.studby.uio.no>
Message-ID: <Pine.LNX.4.44.0302172002070.9975-100000@krs-dhcp401.studby.uio.no>
X-Sent-From-Infeline: Yes
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 293
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: dovecot@andreas.hanssen.name
Precedence: bulk
X-list: dovecot
X-UID: 293                                                  
Status: O

On Mon, 17 Feb 2003, Andreas Aardal Hanssen wrote:
>On 17 Feb 2003, Timo Sirainen wrote:
>>On Mon, 2003-02-17 at 20:07, Andreas Aardal Hanssen wrote:
>From maildir-storage.c, line 325:
>        while (rename(src, dest) < 0 && count < 2) {
>                if (errno != EEXIST) {
>rename can never return EEXIST in errno. maildir-save.c, line 124.

I'd like to stress here that rename can't return EEXIST when moving files.

Andy

-- 
Andreas Aardal Hanssen
http://www.andreas.hanssen.name/gpg


From tss@iki.fi  Mon Feb 17 21:39:20 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 17 Feb 2003 21:39:20 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id BF7D123839
	for <dovecot@procontrol.fi>; Mon, 17 Feb 2003 21:39:20 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 86B5F5E01F68; Mon, 17 Feb 2003 21:39:20 +0200 (EET)
Subject: [dovecot] Re: [bincimap] Re: Re: bincimap
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.44.0302171942430.9975-100000@krs-dhcp401.studby.uio.no>
References:
	 <Pine.LNX.4.44.0302171942430.9975-100000@krs-dhcp401.studby.uio.no>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1045510760.4604.485.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 17 Feb 2003 21:39:20 +0200
X-archive-position: 294
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 294                                                  
Status: O
Content-Length: 2778

On Mon, 2003-02-17 at 20:59, Andreas Aardal Hanssen wrote:
> >From maildir-storage.c, line 325:
> 
>         while (rename(src, dest) < 0 && count < 2) {
>                 if (errno != EEXIST) {
> 
> rename can never return EEXIST in errno.

Sure it can:

       ENOTEMPTY or EEXIST
              newpath  is  a non-empty directory, i.e., contains entries other
              than "." and "..".

But looks like I've missed the ENOTEMPTY check there, adding. I'm
renaming directories there, not files.

>         /* move the file into new/ directory - syncing will pick it
>            up from there */
>         if (rename(tmp_path, new_path) == 0)
>                 failed = FALSE;
> 
> Here you can lose emails if the new/ folder contains a message whose base 
> name is equal.

In theory, yes. In practice, I'd say not. It can only happen with broken
MUAs, are there any? User could of course deliberately break it, but is
there some gain in it?

> The only way to avoid this is:
> 
> 1) use link and unlink, not rename

..and if it crashes (or loses NFS link) between those calls, you'll
suddenly see two mails. I prefer atomic operations.

> Anyway, Maildir has a strict consistency criteria which says that all
> messages that are linked from tmp/ into new/ _must_ use time(NULL) plus a
> number that is guaranteed not to lapse within one second, and which does
> not collide with other messages in new/. new/ is the single entry point
> into cur/, and messages in new/ can not be "older" than the messages in
> cur/.

It only has requirement that the file name is unique. There's other ways
to do that than time(NULL). http://cr.yp.to/proto/maildir.html lists
some.

> 2) leave messages that have a time_t part equal to or higher than 
>    time(NULL).
..
> The simple reasoning for this is that you can never guarantee that there
> is no message in cur/ that has the same base name, but perhaps different
> flags. It follows that when moving a message from new/ to cur/, it is
> required that the server only picks messages that are older than one
> second.

I'm not sure what you mean by this.. What's special in files that were
just created? What changes after it's older than one second? Or are you
changing the base name when moving it to cur/? (What makes you sure that
the new base name still doesn't exist?)

I don't think you should rely on checking timestamps in any case. What
if the maildir is accessed via NFS and some other computer with
different time created the file?

But about the flags, looks like maildir spec says they could be used
only in cur/ directory, so I guess my code is broken because it allows
setting them already in new/.. Well, I'll fix it anyway later by moving
mails directly from tmp/ into cur/ when implementing UIDPLUS extension.


From tss@iki.fi  Mon Feb 17 21:48:13 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 17 Feb 2003 21:48:13 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id CE19F23839
	for <dovecot@procontrol.fi>; Mon, 17 Feb 2003 21:48:13 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 663845E01F68; Mon, 17 Feb 2003 21:48:13 +0200 (EET)
Subject: [dovecot] Re: [bincimap] Re: Re: bincimap
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <1045510760.4604.485.camel@hurina>
References:
	 <Pine.LNX.4.44.0302171942430.9975-100000@krs-dhcp401.studby.uio.no>
	 <1045510760.4604.485.camel@hurina>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1045511293.4604.489.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 17 Feb 2003 21:48:13 +0200
X-archive-position: 295
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 295                                                  
Status: O

On Mon, 2003-02-17 at 21:39, Timo Sirainen wrote:
> >         /* move the file into new/ directory - syncing will pick it
> >            up from there */
> >         if (rename(tmp_path, new_path) == 0)
> >                 failed = FALSE;
> > 
> > Here you can lose emails if the new/ folder contains a message whose base 
> > name is equal.
> 
> In theory, yes. In practice, I'd say not.

Courier and qmail-pop3d also use rename() instead of link()+unlink().
I'd say it's safe enough then.


From dovecot@andreas.hanssen.name  Mon Feb 17 22:07:24 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 17 Feb 2003 22:07:24 +0200 (EET)
Return-Path: <dovecot@andreas.hanssen.name>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from krs-dhcp401.studby.uio.no (krs-dhcp054.studby.uio.no [129.240.106.84])
	by danu.procontrol.fi (Postfix) with SMTP id 8F00023839
	for <dovecot@procontrol.fi>; Mon, 17 Feb 2003 22:07:24 +0200 (EET)
Received: (qmail 11097 invoked by uid 500); 17 Feb 2003 20:07:42 -0000
Received: from localhost (sendmail-bs@127.0.0.1)
  by localhost with SMTP; 17 Feb 2003 20:07:42 -0000
Date: Mon, 17 Feb 2003 21:07:42 +0100 (CET)
From: Andreas Aardal Hanssen <dovecot@andreas.hanssen.name>
X-X-Sender: andreaha@krs-dhcp401.studby.uio.no
To: dovecot@procontrol.fi
Subject: [dovecot] Re: [bincimap] Re: Re: bincimap
In-Reply-To: <1045510760.4604.485.camel@hurina>
Message-ID: <Pine.LNX.4.44.0302172053490.9975-100000@krs-dhcp401.studby.uio.no>
X-Sent-From-Infeline: Yes
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 296
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: dovecot@andreas.hanssen.name
Precedence: bulk
X-list: dovecot
X-UID: 296                                                  
Status: O
Content-Length: 4615

On 17 Feb 2003, Timo Sirainen wrote:
>On Mon, 2003-02-17 at 20:59, Andreas Aardal Hanssen wrote:
>But looks like I've missed the ENOTEMPTY check there, adding. I'm
>renaming directories there, not files.

My bad.

>>         /* move the file into new/ directory - syncing will pick it
>>            up from there */
>>         if (rename(tmp_path, new_path) == 0)
>>                 failed = FALSE;
>> Here you can lose emails if the new/ folder contains a message whose base 
>> name is equal.
>In theory, yes. In practice, I'd say not. It can only happen with broken
>MUAs, are there any? User could of course deliberately break it, but is
>there some gain in it?

It seems the qmail community disagrees with you here - I followed the
discussion on the qmail mailing list. I guess the Dovecot community will
be knocking on your door when important emails start disappearing
unprovoked, and Dovecot is the service that deleted them.

The bottom line is that you can not rely on other Maildir clients
following your server's conventions. They will only oblige to the Maildir
standard, and using Dovecot, emails will disappear. But there's no sweat - 
it's a simple fix.

>> The only way to avoid this is:
>> 1) use link and unlink, not rename
>..and if it crashes (or loses NFS link) between those calls, you'll
>suddenly see two mails. I prefer atomic operations.

Well, then Dovecot has to have a way to communicate this to the sysadmin
as an error condition. It's indefinitely better than deleting innocent
(blog) users' emails.

>> Anyway, Maildir has a strict consistency criteria which says that all
>> messages that are linked from tmp/ into new/ _must_ use time(NULL) plus a
>> number that is guaranteed not to lapse within one second, and which does
>> not collide with other messages in new/. new/ is the single entry point
>> into cur/, and messages in new/ can not be "older" than the messages in
>> cur/.
>It only has requirement that the file name is unique. There's other ways
>to do that than time(NULL). http://cr.yp.to/proto/maildir.html lists
>some.

"A unique name has three pieces, separated by dots. On the left is the 
result of time() or the second counter from gettimeofday(). On the right 
is the result of gethostname(). (To deal with invalid host names, replace 
/ with \057 and : with \072.) In the middle is a delivery identifier, 
discussed below."

Quite clear.

>> flags. It follows that when moving a message from new/ to cur/, it is
>> required that the server only picks messages that are older than one
>> second.
>I'm not sure what you mean by this.. What's special in files that were
>just created? What changes after it's older than one second? Or are you
>changing the base name when moving it to cur/? (What makes you sure that
>the new base name still doesn't exist?)

1) I create a message in tmp and link this to new, then unlink the
original.

2) I create a new message in tmp. I'm about to link this message to new/, 
when suddenly

3) You move my original message from new/ to cur/.

4) I now complete my link from tmp/ to new/.

5) You move my new message from new/ to cur.

Boom. My original message is gone. What's the point of only moving
messages from new/ older than one second?

All messages delivered to new/ in the same second will get a new
middle-part name, sometimes with a _0, _1 ... _n next to the pid. When you
move the messages from new/ to cur/ after one second, all new messages
delivered to new/ will have a different time part. No collisions. But if 
you move the messages _before_ one second has lapsed, then a message in 
cur/ may be overwritten when you either

  1) move the message from new/ to cur/
  2) change the flags of two messages whose base is equal.

Using link avoids the loss of emails, and allows the sysadmin to clean up 
the server's buggy behavior. rename means bye-bye.

>I don't think you should rely on checking timestamps in any case. What
>if the maildir is accessed via NFS and some other computer with
>different time created the file?

Maildir relies on timestamps - like it or not.

>But about the flags, looks like maildir spec says they could be used
>only in cur/ directory, so I guess my code is broken because it allows
>setting them already in new/.. Well, I'll fix it anyway later by moving
>mails directly from tmp/ into cur/ when implementing UIDPLUS extension.

You will lose emails if you move messages from tmp to cur directly. Simply 
because you have no idea wether or not messages in cur have the same base 
as your message in tmp.

Andy

-- 
Andreas Aardal Hanssen
http://www.andreas.hanssen.name/gpg


From dovecot@andreas.hanssen.name  Mon Feb 17 22:21:27 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 17 Feb 2003 22:21:27 +0200 (EET)
Return-Path: <dovecot@andreas.hanssen.name>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from krs-dhcp401.studby.uio.no (krs-dhcp054.studby.uio.no [129.240.106.84])
	by danu.procontrol.fi (Postfix) with SMTP id 9D33823839
	for <dovecot@procontrol.fi>; Mon, 17 Feb 2003 22:21:27 +0200 (EET)
Received: (qmail 11240 invoked by uid 500); 17 Feb 2003 20:21:45 -0000
Received: from localhost (sendmail-bs@127.0.0.1)
  by localhost with SMTP; 17 Feb 2003 20:21:45 -0000
Date: Mon, 17 Feb 2003 21:21:44 +0100 (CET)
From: Andreas Aardal Hanssen <dovecot@andreas.hanssen.name>
X-X-Sender: andreaha@krs-dhcp401.studby.uio.no
To: dovecot@procontrol.fi
Subject: [dovecot] Re: [bincimap] Re: Re: bincimap
In-Reply-To: <1045511293.4604.489.camel@hurina>
Message-ID: <Pine.LNX.4.44.0302172107560.9975-100000@krs-dhcp401.studby.uio.no>
X-Sent-From-Infeline: Yes
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 297
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: dovecot@andreas.hanssen.name
Precedence: bulk
X-list: dovecot
X-UID: 297                                                  
Status: O
Content-Length: 1281

On 17 Feb 2003, Timo Sirainen wrote:
>On Mon, 2003-02-17 at 21:39, Timo Sirainen wrote:
>> >         /* move the file into new/ directory - syncing will pick it
>> >            up from there */
>> >         if (rename(tmp_path, new_path) == 0)
>> >                 failed = FALSE;
>> > Here you can lose emails if the new/ folder contains a message whose base 
>> > name is equal.
>> In theory, yes. In practice, I'd say not.
>Courier and qmail-pop3d also use rename() instead of link()+unlink().
>I'd say it's safe enough then.

Quoting a well known friend of ours, Mark Crispin - Two wrongs doesn't
make one right.

qmail-pop3d doesn't move messages from tmp/ to new/. It only moves
messages from new/ to cur/. Messages _can_ get lost there, and it seems
like Bernstein accepts this.

If a message is lost in this operation, it basically means that a broken
server/client has moved a message from new to cur earlier, without taking
the one second into consideration.

So where is the bug - qmail-pop3d or Dovecot? I'd say both. First and
foremost the server that placed the original message in cur/ in the first
place, in breach of Maildir, and qmail-pop3d for renaming that message
instead of linking it.

Andy

-- 
Andreas Aardal Hanssen
http://www.andreas.hanssen.name/gpg




From tss@iki.fi  Mon Feb 17 23:17:19 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 17 Feb 2003 23:17:19 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 75C082384D
	for <dovecot@procontrol.fi>; Mon, 17 Feb 2003 23:17:19 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 3305E5E01F68; Mon, 17 Feb 2003 23:17:19 +0200 (EET)
Subject: [dovecot] Re: [bincimap] Re: Re: bincimap
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.44.0302172053490.9975-100000@krs-dhcp401.studby.uio.no>
References:
	 <Pine.LNX.4.44.0302172053490.9975-100000@krs-dhcp401.studby.uio.no>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1045516638.4604.563.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 17 Feb 2003 23:17:19 +0200
X-archive-position: 298
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 298                                                  
Status: O
Content-Length: 2539

On Mon, 2003-02-17 at 22:07, Andreas Aardal Hanssen wrote:
> It seems the qmail community disagrees with you here - I followed the
> discussion on the qmail mailing list.

Do you have URL or something? I didn't find it.

> >> 1) use link and unlink, not rename
> >..and if it crashes (or loses NFS link) between those calls, you'll
> >suddenly see two mails. I prefer atomic operations.
> 
> Well, then Dovecot has to have a way to communicate this to the sysadmin
> as an error condition. It's indefinitely better than deleting innocent
> (blog) users' emails.

Reporting lost NFS link is possible, but what if the whole system
crashes in the middle?

> >It only has requirement that the file name is unique. There's other ways
> >to do that than time(NULL). http://cr.yp.to/proto/maildir.html lists
> >some.
> 
> "A unique name has three pieces, separated by dots. On the left is the 
> result of time() or the second counter from gettimeofday().

Yeah, I should actually read things instead of skipping to interesting
part :)

> All messages delivered to new/ in the same second will get a new
> middle-part name, sometimes with a _0, _1 ... _n next to the pid. When you
> move the messages from new/ to cur/ after one second, all new messages
> delivered to new/ will have a different time part. No collisions. But if 
> you move the messages _before_ one second has lapsed, then a message in 
> cur/ may be overwritten when you either

Waiting just has several annoying problems. Either you really wait for
one second (ugh), ignore the file (complicates or breaks some new mail
checks) or handle it just as if it were in cur/ already (complicates
again, you'd have to check if the missing file was actually in new/).

> Using link avoids the loss of emails, and allows the sysadmin to clean up 
> the server's buggy behavior. rename means bye-bye.

When moving from tmp/ to new/, I agree that I should have used link()
(fixed in CVS) since there's no harm if the unlink() in tmp didn't
occur.

Moving from new/ to cur/ or renaming within cur/ is more tricky though.
MUAs could see both of the mails at the same time which could lead to
weird problems.

> >I don't think you should rely on checking timestamps in any case. What
> >if the maildir is accessed via NFS and some other computer with
> >different time created the file?
> 
> Maildir relies on timestamps - like it or not.

Only system-wide timestamps since the filename contains hostname part.
Nothing should break by itself if two systems have completely different
times.


From dovecot@andreas.hanssen.name  Mon Feb 17 23:31:10 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 17 Feb 2003 23:31:10 +0200 (EET)
Return-Path: <dovecot@andreas.hanssen.name>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from krs-dhcp401.studby.uio.no (krs-dhcp054.studby.uio.no [129.240.106.84])
	by danu.procontrol.fi (Postfix) with SMTP id 144A72384D
	for <dovecot@procontrol.fi>; Mon, 17 Feb 2003 23:31:10 +0200 (EET)
Received: (qmail 11992 invoked by uid 500); 17 Feb 2003 21:31:28 -0000
Received: from localhost (sendmail-bs@127.0.0.1)
  by localhost with SMTP; 17 Feb 2003 21:31:28 -0000
Date: Mon, 17 Feb 2003 22:31:28 +0100 (CET)
From: Andreas Aardal Hanssen <dovecot@andreas.hanssen.name>
X-X-Sender: andreaha@krs-dhcp401.studby.uio.no
To: dovecot@procontrol.fi
Subject: [dovecot] Re: [bincimap] Re: Re: bincimap
In-Reply-To: <1045516638.4604.563.camel@hurina>
Message-ID: <Pine.LNX.4.44.0302172221070.9975-100000@krs-dhcp401.studby.uio.no>
X-Sent-From-Infeline: Yes
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 299
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: dovecot@andreas.hanssen.name
Precedence: bulk
X-list: dovecot
X-UID: 299                                                  
Status: O
Content-Length: 3203

On 17 Feb 2003, Timo Sirainen wrote:
>On Mon, 2003-02-17 at 22:07, Andreas Aardal Hanssen wrote:
>> It seems the qmail community disagrees with you here - I followed the
>> discussion on the qmail mailing list.
>Do you have URL or something? I didn't find it.

Starts here:

http://marc.theaimsgroup.com/?l=qmail&m=104250383122015&w=2

Sam of Courier-IMAP claimed that OpenBSD's random pid assignment broke
qmail and Courier-IMAP. It certainly broke Courier-IMAP.

>> >> 1) use link and unlink, not rename
>> >..and if it crashes (or loses NFS link) between those calls, you'll
>> >suddenly see two mails. I prefer atomic operations.
>> Well, then Dovecot has to have a way to communicate this to the sysadmin
>> as an error condition. It's indefinitely better than deleting innocent
>> (blog) users' emails.
>Reporting lost NFS link is possible, but what if the whole system
>crashes in the middle?

Then you have either one A link, two links A and B, or one link B. If you
have A and B, the Maildir clients should detect this and report it.

>> All messages delivered to new/ in the same second will get a new
>> middle-part name, sometimes with a _0, _1 ... _n next to the pid. When you
>> move the messages from new/ to cur/ after one second, all new messages
>> delivered to new/ will have a different time part. No collisions. But if 
>> you move the messages _before_ one second has lapsed, then a message in 
>> cur/ may be overwritten when you either
>Waiting just has several annoying problems. Either you really wait for
>one second (ugh), ignore the file (complicates or breaks some new mail
>checks) or handle it just as if it were in cur/ already (complicates
>again, you'd have to check if the missing file was actually in new/).

Yes! :-) Waiting one second is quiet intolerable. "Ignoring" the message
until it's one second old is the only way that I've found that works. That
means that you need to make some precautions with APPEND to currently
selected mailbox, but I'm not sure how this works in Dovecot. :-/

>> Using link avoids the loss of emails, and allows the sysadmin to clean up 
>> the server's buggy behavior. rename means bye-bye.
>When moving from tmp/ to new/, I agree that I should have used link()
>(fixed in CVS) since there's no harm if the unlink() in tmp didn't
>occur.
>Moving from new/ to cur/ or renaming within cur/ is more tricky though.
>MUAs could see both of the mails at the same time which could lead to
>weird problems.

Yes - if both mails are present, the client needs to 1) do something smart 
or 2) ignore the problem and let the sysadmin do something smart.

>> >I don't think you should rely on checking timestamps in any case. What
>> >if the maildir is accessed via NFS and some other computer with
>> >different time created the file?
>> Maildir relies on timestamps - like it or not.
>Only system-wide timestamps since the filename contains hostname part.
>Nothing should break by itself if two systems have completely different
>times.

True.. but I wish there was a better mailbox storage format out there
without little buggers like this messing up the simple design.

Andy

-- 
Andreas Aardal Hanssen
http://www.andreas.hanssen.name/gpg


From tss@iki.fi  Tue Feb 18 00:29:38 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 18 Feb 2003 00:29:38 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 5BDA623839
	for <dovecot@procontrol.fi>; Tue, 18 Feb 2003 00:29:38 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id E14745E01F68; Tue, 18 Feb 2003 00:29:37 +0200 (EET)
Subject: [dovecot] Re: [bincimap] Re: Re: bincimap
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.44.0302172221070.9975-100000@krs-dhcp401.studby.uio.no>
References:
	 <Pine.LNX.4.44.0302172221070.9975-100000@krs-dhcp401.studby.uio.no>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1045520977.4604.579.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 18 Feb 2003 00:29:37 +0200
X-archive-position: 300
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 300                                                  
Status: O
Content-Length: 1512

On Mon, 2003-02-17 at 23:31, Andreas Aardal Hanssen wrote:
> >Do you have URL or something? I didn't find it.
> 
> Starts here:
> 
> http://marc.theaimsgroup.com/?l=qmail&m=104250383122015&w=2
> 
> Sam of Courier-IMAP claimed that OpenBSD's random pid assignment broke
> qmail and Courier-IMAP. It certainly broke Courier-IMAP.

Well, that helped some, except most of the suggested "fixes" didn't
really help.

I can think of one clean solution for this: Make sure the base filename
is unique by using inode and/or making sure that process trying to
APPEND has existed at least for a second and will exist for at least the
next second.

That still doesn't help if someone else screwed up and created multiple
identical base names, but I'd really rather not use link+unlink. I think
I will anyway make my maildir_sync() to check for basename conflicts and
fix them.

> >Moving from new/ to cur/ or renaming within cur/ is more tricky though.
> >MUAs could see both of the mails at the same time which could lead to
> >weird problems.
> 
> Yes - if both mails are present, the client needs to 1) do something smart 
> or 2) ignore the problem and let the sysadmin do something smart.

I don't mean that as any failure condition. That could happen in
everyday mail usage if there's multiple clients accessing the same
mailbox. One client scanning the maildir at the same time as another
client is updating mail flag. The same mail could show up twice with
readdir() even if the other one is soon after unlink()ed.


From ianj@ian-justman.com  Tue Feb 18 11:09:32 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 18 Feb 2003 11:09:32 +0200 (EET)
Return-Path: <ianj@ian-justman.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from narshe.chocobo.org (dsl-207-126-72-242.dsl.netasset.net [207.126.72.242])
	by danu.procontrol.fi (Postfix) with ESMTP id 14D7A2384D
	for <dovecot@procontrol.fi>; Tue, 18 Feb 2003 11:09:32 +0200 (EET)
Received: from zozo.intrn.chocobo.org (zozo.chocobo.org [207.126.72.244])
	by narshe.chocobo.org (Postfix) with ESMTP id 2483A30FE72
	for <dovecot@procontrol.fi>; Tue, 18 Feb 2003 01:09:31 -0800 (PST)
Received: by zozo.intrn.chocobo.org (Postfix, from userid 501)
	id BB4E586E3BF; Tue, 18 Feb 2003 01:09:30 -0800 (PST)
Received: from localhost (localhost [127.0.0.1])
	by zozo.intrn.chocobo.org (Postfix) with ESMTP id 9AFF2449AD0
	for <dovecot@procontrol.fi>; Tue, 18 Feb 2003 01:09:30 -0800 (PST)
Date: Tue, 18 Feb 2003 01:09:30 -0800 (PST)
From: "Ian R. Justman" <ianj@ian-justman.com>
X-X-Sender: ianj@zozo.chocobo.org
To: dovecot@procontrol.fi
Subject: [dovecot] mbox vs maildir debate (was re: subject concerning binc imap, even
 though my original message never touched on it or maildir)
Message-ID: <Pine.LNX.4.44.0302180106440.11860-100000@zozo.chocobo.org>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 301
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: ianj@ian-justman.com
Precedence: bulk
X-list: dovecot
X-UID: 301                                                  
Status: O
Content-Length: 3036


Tried sending this message with the original topic

On Mon, 17 Feb 2003, Andreas Aardal Hanssen wrote:

> Hi, Ian. Cross-posting discussions like this is usually not appreciated
> by those who subscribe to both foras, so I'll limit it to the Dovecot
> list.

Mea culpa.

That was an inadvertent mess-up on my part; I did not see the headers,
usually going by the list's reply-to headers which are usually there, but
not this time.  I only "cross-posted" it because the first time, it went
to the wrong list (the dovecot list was a CC line).  I then remailed it to
the correct list.  I will be more careful in future.

> >Basically, if you open via IMAP using a server with a diffent locking
> >Additionally, the number of mbox POP3 servers which Do Not Suck(R) is
> >rather low right now.  Timo finally introduced an mbox IMAP server which
>
> This I don't agree with. Most existing POP3 servers are quite ok, and
> one POP3 Maildir server that is excellent and bug free since 1998,
> qmail-pop3d, is quite a piece of art.

You are missing my point. I am not talking about POP3 servers in general.
See below.

> >Not to mention, quite frankly, most mbox POP3 implementations suck
> >pretty badly anyway. :P
>
> This I do agree with. Don't confuse POP3 servers in general with mbox
> POP3 servers. The root, the source of the evil is the storage format
> mbox.

<Rest of argument re mbox vs. maildir removed>

I am specifcally targeting mbox POP3 servers, of which there are several
implementations; Qpopper, GNU POP3 Server, Cucipop, ipop3d to name a few.

I am NOT speaking to maildir, nor to Cyrus, nor to SQL-enabled products.
Solely to mbox.  In fact, I even said that stuff that talks to maildir, in
addition to Cyrus, offered the one thing for IMAP you could not get with
mbox until Dovecot came along; something resembling robust dealing with
multiple clients to the same mbox store.

Nor am I particularly insterested in debating the merits of any format
over mbox, a format I have stated I -KNOW- has annoying technical
limitations and issues.  While I would imagine other formats may have
advantages over mbox, I continue to use mbox simply because of the sheer
amount of stored mail I have accumulated on all my machines for the past
seven years.

My point is that Dovecot seems to be the most robust IMAP server I have
come across at coping with mbox stores, especially if I am trying to
access the same mailbox with two different clients, whether intentionally
or inadvertnetly.  My hope is that Dovecot's POP3 server will prove just
as robust at dealing with mailboxes that may also be open by an IMAP
client.

Whether Dovecot, BINC IMAP, or even Courier IMAP (or whichever POP3 server
for that matter) are better for maildir or anything else, I will leave
that debate to those who actually use them.

In the end, I have made a choice.  Not necessarily the best one, but I
made the choice with the full understanding of what that choice would
entail.  However, you never know.  I may change my mind later.  ;)

--Ian.




From kevin@kevinlee2001.f2s.com  Tue Feb 18 18:56:50 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 18 Feb 2003 18:56:50 +0200 (EET)
Return-Path: <kevin@kevinlee2001.f2s.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from server0027.freedom2surf.net (server0011.freedom2surf.net [194.106.56.14])
	by danu.procontrol.fi (Postfix) with ESMTP id A345E2384D
	for <dovecot@procontrol.fi>; Tue, 18 Feb 2003 18:56:50 +0200 (EET)
Received: from kenny ([195.137.105.222])
	by server0027.freedom2surf.net (8.12.6/8.12.6/Debian-7) with ESMTP id h1IGutP6012510
	for <dovecot@procontrol.fi.>; Tue, 18 Feb 2003 16:57:03 GMT
From: "Kevin Lee" <kevin@kevinlee2001.f2s.com>
To: <dovecot@procontrol.fi>
Subject: [dovecot] IMAP folder problem
Date: Tue, 18 Feb 2003 16:56:43 -0000
Message-ID: <001401c2d76e$b9d31cb0$0a00000a@kenny>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="US-ASCII"
Content-Transfer-Encoding: quoted-printable
X-Priority: 3 (Normal)
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook, Build 10.0.4510
Importance: Normal
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2800.1106
X-archive-position: 302
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: kevin@kevinlee2001.f2s.com
Precedence: bulk
X-list: dovecot
X-UID: 302                                                  
Status: O

Hi,
	I have tried multiple dovecot versions (0.99 and CVS) and I keep
getting the same problem.

I connect to the IMAP server fine using outlook xp, but when I try to =
create
folders it creates them and then they just disappear.  In the Maildir on =
the
IMAP server the folder are there but they don't show up using a client.  =
I
basically can't do anything with folders, including copying outlook =
folders
to the server or create/delete folders.  And when I move mail to =
specific
folders using procmail it just gets put back into the inbox again...



I'm using freebsd 4.7-RELEASE


My config file only adds the following lines...


auth =3D plain
auth_methods =3D plain
auth_userinfo =3D password-file /etc/passwd.imap
auth_user =3D root


My password file (/etc/passwd.imp) only consists of

kev:XXXXXchangedXX[13]:1001:1001::/home/kev::::

I've just created a folder /home/kev/Maildir where dovecot created the
MailDir hierarchies.=20


Any help would be appreciated.



Cheers

Kev




From tss@iki.fi  Tue Feb 18 19:17:31 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 18 Feb 2003 19:17:31 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id E80062384D
	for <dovecot@procontrol.fi>; Tue, 18 Feb 2003 19:17:30 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id A612E5E01F68; Tue, 18 Feb 2003 19:17:30 +0200 (EET)
Subject: [dovecot] Re: IMAP folder problem
From: Timo Sirainen <tss@iki.fi>
To: Kevin Lee <kevin@kevinlee2001.f2s.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <001401c2d76e$b9d31cb0$0a00000a@kenny>
References: <001401c2d76e$b9d31cb0$0a00000a@kenny>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1045588650.4601.606.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 18 Feb 2003 19:17:30 +0200
X-archive-position: 303
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 303                                                  
Status: O

On Tue, 2003-02-18 at 18:56, Kevin Lee wrote:
> Hi,
> 	I have tried multiple dovecot versions (0.99 and CVS) and I keep
> getting the same problem.
> 
> I connect to the IMAP server fine using outlook xp, but when I try to create
> folders it creates them and then they just disappear.  In the Maildir on the
> IMAP server the folder are there but they don't show up using a client.  I
> basically can't do anything with folders, including copying outlook folders
> to the server or create/delete folders.  

Just guessing, but maybe you also have to subscribe to the folders
before they show up in Outlook XP? Also make sure you haven't set
anything to root folder path.

> And when I move mail to specific
> folders using procmail it just gets put back into the inbox again...

This sounds more strange. Dovecot at least doesn't move mails by itself.
Is it Outlook moving them back?


From ianj@ian-justman.com  Tue Feb 18 19:48:59 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 18 Feb 2003 19:48:59 +0200 (EET)
Return-Path: <ianj@ian-justman.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from narshe.chocobo.org (dsl-207-126-72-242.dsl.netasset.net [207.126.72.242])
	by danu.procontrol.fi (Postfix) with ESMTP id 36F9323839
	for <dovecot@procontrol.fi>; Tue, 18 Feb 2003 19:48:59 +0200 (EET)
Received: from zozo.intrn.chocobo.org (zozo.chocobo.org [207.126.72.244])
	by narshe.chocobo.org (Postfix) with ESMTP
	id BD4A130FE72; Tue, 18 Feb 2003 09:48:57 -0800 (PST)
Received: by zozo.intrn.chocobo.org (Postfix, from userid 501)
	id AA12586E3BF; Tue, 18 Feb 2003 09:48:55 -0800 (PST)
Received: from localhost (localhost [127.0.0.1])
	by zozo.intrn.chocobo.org (Postfix) with ESMTP
	id 65165449ADD; Tue, 18 Feb 2003 09:48:55 -0800 (PST)
Date: Tue, 18 Feb 2003 09:48:55 -0800 (PST)
From: "Ian R. Justman" <ianj@ian-justman.com>
X-X-Sender: ianj@zozo.chocobo.org
To: Timo Sirainen <tss@iki.fi>
Cc: Kevin Lee <kevin@kevinlee2001.f2s.com>, <dovecot@procontrol.fi>
Subject: [dovecot] Re: IMAP folder problem
In-Reply-To: <1045588650.4601.606.camel@hurina>
Message-ID: <Pine.LNX.4.44.0302180948250.11860-100000@zozo.chocobo.org>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 304
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: ianj@ian-justman.com
Precedence: bulk
X-list: dovecot
X-UID: 304                                                  
Status: O



On 18 Feb 2003, Timo Sirainen wrote:

> On Tue, 2003-02-18 at 18:56, Kevin Lee wrote:
> > Hi,
> > 	I have tried multiple dovecot versions (0.99 and CVS) and I keep
> > getting the same problem.
> >
> > I connect to the IMAP server fine using outlook xp, but when I try to create
> > folders it creates them and then they just disappear.  In the Maildir on the
> > IMAP server the folder are there but they don't show up using a client.  I
> > basically can't do anything with folders, including copying outlook folders
> > to the server or create/delete folders.
>
> Just guessing, but maybe you also have to subscribe to the folders
> before they show up in Outlook XP? Also make sure you haven't set
> anything to root folder path.

I know this to be the case with NS7's mail client.

--Ian.



From kevin@kevinlee2001.f2s.com  Tue Feb 18 20:45:56 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 18 Feb 2003 20:45:56 +0200 (EET)
Return-Path: <kevin@kevinlee2001.f2s.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from server0027.freedom2surf.net (server0011.freedom2surf.net [194.106.56.14])
	by danu.procontrol.fi (Postfix) with ESMTP id A471B2384D
	for <dovecot@procontrol.fi>; Tue, 18 Feb 2003 20:45:56 +0200 (EET)
Received: from kenny ([195.137.105.222])
	by server0027.freedom2surf.net (8.12.6/8.12.6/Debian-7) with ESMTP id h1IIk1P6023894
	for <dovecot@procontrol.fi.>; Tue, 18 Feb 2003 18:46:09 GMT
From: "Kevin Lee" <kevin@kevinlee2001.f2s.com>
To: <dovecot@procontrol.fi>
Subject: [dovecot] Re: IMAP folder problem
Date: Tue, 18 Feb 2003 18:45:49 -0000
Message-ID: <000201c2d77d$f7e180f0$0a00000a@kenny>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: quoted-printable
X-Priority: 3 (Normal)
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook, Build 10.0.4510
Importance: Normal
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2800.1106
X-archive-position: 305
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: kevin@kevinlee2001.f2s.com
Precedence: bulk
X-list: dovecot
X-UID: 305                                                  
Status: O
Content-Length: 1590

Hi,

I've tried other outlook installs and setting.
When I try to copy a folder to the imap account I get...

"Can't move the items. The move operation could not be completed. It is
possible that the destination server is unavailable or does not support
subfolders."

And when I try to copy mail to the imap folder (with subscribed folders) =
I
get:=20

"Can't move items.  This IMAP command could not be sent to the server =
before
the connection was terminated"


I get some corresponding errors in dovecots logs:

"
imap-master: Feb 18 18:31:41 Error: child 60038 (imap) killed with =
signal 6
imap((null)): Feb 18 18:33:49 Panic: file cmd-append.c: line 25
(validate_args): assertion failed: ((unsigned int) ret =3D=3D count)
imap-master: Feb 18 18:33:49 Error: child 60042 (imap) killed with =
signal 6
"

related?





> On Tue, 2003-02-18 at 18:56, Kevin Lee wrote:
> > Hi,
> > 	I have tried multiple dovecot versions (0.99 and CVS) and I keep
> > getting the same problem.
> >
> > I connect to the IMAP server fine using outlook xp, but when I try =
to
create
> > folders it creates them and then they just disappear.  In the =
Maildir on
the
> > IMAP server the folder are there but they don't show up using a =
client.
I
> > basically can't do anything with folders, including copying outlook
folders
> > to the server or create/delete folders.
>
> Just guessing, but maybe you also have to subscribe to the folders
> before they show up in Outlook XP? Also make sure you haven't set
> anything to root folder path.

I know this to be the case with NS7's mail client.

--Ian.





From tss@iki.fi  Tue Feb 18 21:06:36 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 18 Feb 2003 21:06:36 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 4A0332384D
	for <dovecot@procontrol.fi>; Tue, 18 Feb 2003 21:06:36 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id EA2CE5E01F68; Tue, 18 Feb 2003 21:06:35 +0200 (EET)
Subject: [dovecot] Re: IMAP folder problem
From: Timo Sirainen <tss@iki.fi>
To: Kevin Lee <kevin@kevinlee2001.f2s.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <000201c2d77d$f7e180f0$0a00000a@kenny>
References: <000201c2d77d$f7e180f0$0a00000a@kenny>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1045595195.21737.10.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 18 Feb 2003 21:06:35 +0200
X-archive-position: 306
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 306                                                  
Status: O

On Tue, 2003-02-18 at 20:45, Kevin Lee wrote:
> I get some corresponding errors in dovecots logs:
> 
> "
> imap-master: Feb 18 18:31:41 Error: child 60038 (imap) killed with signal 6
> imap((null)): Feb 18 18:33:49 Panic: file cmd-append.c: line 25
> (validate_args): assertion failed: ((unsigned int) ret == count)
> imap-master: Feb 18 18:33:49 Error: child 60042 (imap) killed with signal 6
> "
> 
> related?

Could well be. It looks like you're running Dovecot 0.97 which is almost
half a year old and quite buggy.


From tss@iki.fi  Thu Feb 20 03:06:49 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 20 Feb 2003 03:06:49 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id B3B2F2384D
	for <dovecot@procontrol.fi>; Thu, 20 Feb 2003 03:06:48 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id DA8005E01F68; Thu, 20 Feb 2003 03:06:47 +0200 (EET)
Subject: [dovecot] 0.99.8-test7
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1045703207.16148.19.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 20 Feb 2003 03:06:47 +0200
X-archive-position: 307
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 307                                                  
Status: O

OK, I really should release 0.99.8 final soon, but not just yet :)
Mostly just documentation updates left I think. There's a few recent
changes that might have some nasty bugs:

- problems with copying messages from mbox to another should be fixed
now
- LIST and subscription handling rewritten.
- "mail_read_mmaped = no" used to corrupt mboxes when expunging
messages. It now enabled again by default, and it seems to be working. I
did update my backups though :)

Dovecot's LDAP support currently requires that it can read the
userPassword field of every user. I'm not sure if I should support 
"authentication binds" that seems to be more standard way to do LDAP
authentication. That's just slower, works only with plaintext
authentication and makes my code more complex.


From dave@tamos.net  Thu Feb 20 05:10:55 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 20 Feb 2003 05:10:55 +0200 (EET)
Return-Path: <dave@tamos.net>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from grue.tamos.net (dsl093-083-029.wdc1.dsl.speakeasy.net [66.93.83.29])
	by danu.procontrol.fi (Postfix) with ESMTP id 5CAE42384D
	for <dovecot@procontrol.fi>; Thu, 20 Feb 2003 05:10:54 +0200 (EET)
Received: (qmail 12550 invoked from network); 20 Feb 2003 03:10:50 -0000
Received: from unknown (HELO ?192.168.1.20?) (dave@127.0.0.1)
  by localhost with SMTP; 20 Feb 2003 03:10:50 -0000
Subject: [dovecot] Re: 0.99.8-test7
From: "David E. Storey" <dave@tamos.net>
To: dovecot@procontrol.fi
In-Reply-To: <1045703207.16148.19.camel@hurina>
References: <1045703207.16148.19.camel@hurina>
Content-Type: multipart/signed; micalg=pgp-sha1; protocol="application/pgp-signature"; boundary="=-V2G2IWply6qN6dlN+nVX"
Organization: tamos
Message-Id: <1045710658.23769.42.camel@localhost>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 19 Feb 2003 22:10:58 -0500
X-archive-position: 308
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: dave@tamos.net
Precedence: bulk
X-list: dovecot
X-UID: 308                                                  
Status: O
Content-Length: 1333


--=-V2G2IWply6qN6dlN+nVX
Content-Type: text/plain
Content-Transfer-Encoding: quoted-printable

On Wed, 2003-02-19 at 20:06, Timo Sirainen wrote:
> Dovecot's LDAP support currently requires that it can read the
> userPassword field of every user. I'm not sure if I should support=20
> "authentication binds" that seems to be more standard way to do LDAP
> authentication. That's just slower, works only with plaintext
> authentication and makes my code more complex.

authentication binds are the only "across the board" method for
authenticating users i know of. yes, they are slow. suppose i'm
authenticating against active directory. i know of no way to expose the
userPassword attribute in ad. personally, i wouldn't go near ad, but i
don't really have much of a choice in the matter. at best, you could
probably get compare rights. authentication binds mean i can support
whatever hashing mechanism my ldap server supports without exposing the
value itself.

d!

--=-V2G2IWply6qN6dlN+nVX
Content-Type: application/pgp-signature; name=signature.asc
Content-Description: This is a digitally signed message part

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.1 (GNU/Linux)

iD8DBQA+VEdC+5sC2muyxOMRAosHAJ42h9gLkZosPVmS+ZhaSbe0XfcpfgCfZHFk
mjMZa9AUNSHYjP6tbAIAGwM=
=nJYW
-----END PGP SIGNATURE-----

--=-V2G2IWply6qN6dlN+nVX--


From timsn@thtree.com  Fri Feb 21 02:37:58 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 21 Feb 2003 02:37:58 +0200 (EET)
Return-Path: <timsn@thtree.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from cedar.thtree.com (s216-232-27-178.bc.hsia.telus.net [216.232.27.178])
	by danu.procontrol.fi (Postfix) with ESMTP id CAB2C23839
	for <dovecot@procontrol.fi>; Fri, 21 Feb 2003 02:37:57 +0200 (EET)
Received: from timsn by cedar.thtree.com with local (Exim 4.04)
	id 18m1CO-0004os-00
	for dovecot@procontrol.fi; Thu, 20 Feb 2003 16:37:56 -0800
Subject: [dovecot] Trouble setting up dovecot
From: Tim Snider <timsn@thtree.com>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
X-Mailer: Ximian Evolution 1.0.3 (1.0.3-6) 
Date: 20 Feb 2003 16:37:56 -0800
Message-Id: <1045787876.18341.54.camel@cedar.thtree.com>
Mime-Version: 1.0
X-archive-position: 309
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: timsn@thtree.com
Precedence: bulk
X-list: dovecot
X-UID: 309                                                  
Status: O
Content-Length: 2856

Hi,

I'm new to the list but have been trying to get dovecot configured for
the past week and a bit. I've gone through the list archives and solved
a few of my problems, but most don't seem to be addressed.

First off I want to say thanks for starting this project, I've been
hoping that someone would start an IMAP/POP server with some flexibility
in the way it's configured and provides both packages in one.I've tried
setting up Courier once and found it onerous, UW was easier but forces a
bunch of assumption that don't suit the way I wanted to configure
virtual mail.

I'd love to run dovecot, eventually with LDAP and Jamm, and Exim to
handle my virtual domains, however I'm running into a fair number of
problems and haven't had any luck getting past them.

I'm running a RedHat 7.3 SMP server, with iptables for a firewall, so
I've got several cards and thus IPs.I started out with dovecot 99.4 but
noted that it was missing the LDAP, tried 99.8-test5 and am now working
with 99.8-test7, both seem to have the same problems.

I'm currently trying to setup a IMAP server on the inside of the
firewall, 192.168.2.X. If I use just imap, turn of SSL/TLS I'm fine,
and can do plaintext authentication via shadow, but I can't get PAM
authentication working.

If I turn on SSL(ssl_disable = no), neither the imap or the imaps
respond and a netstat -tp shows that no process owns the socket
PID/process = '-', often with characters in the Recv-Q.

I've tried turning on all the debugging flags for configure on,
--with-rawlog --enable-debug --enable-asserts --with-ssl=openssl
as well as verbose_proctitle = yes, and auth_verbose = yes, setup
logfiles /var/log/dovecot/messages, yet all I get are authorization
messages. And I've noted that a number of them only show up after I've
killed the dovecot process, so I'm wondering if there needs to be a bit
of flushing somewhere?

As well I've also tried to run "dovecot -F", with the log files
commented out in the .conf file, but get nothing via stderr. I note that
when I try the log_timestamp option, the dates sent from imap-login are
completely incorrect and don't change, so I don't think the date is
being read correctly. Is log_timestamp operational?

One thing I'm not clear on is what process to run it under, I've setup a
user/group 'dovecot', but does dovecot have to be a member of wheel?
I've also noted in earlier versions you had things running via
imapd-master, but that now seems to been replaced by "dovecot", is that
correct?

Is anyone else running dovecot on a SMP system? 

Any comments or suggestions? I do have development experience, but my
Linux/UNIX programming is a bit rusty. I'd love to help make this a
rocking product, but need some help getting it dovecot up and running.

Any help is appreciated.

Thanks,

TJ

timsn@thtree.com
http://www.thtree.com/People/TJ/Resume.html

From tss@iki.fi  Fri Feb 21 03:08:53 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 21 Feb 2003 03:08:53 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 361A22384D
	for <dovecot@procontrol.fi>; Fri, 21 Feb 2003 03:08:53 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id AF8C75E01F68; Fri, 21 Feb 2003 03:08:52 +0200 (EET)
Subject: [dovecot] Re: Trouble setting up dovecot
From: Timo Sirainen <tss@iki.fi>
To: Tim Snider <timsn@thtree.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <1045787876.18341.54.camel@cedar.thtree.com>
References: <1045787876.18341.54.camel@cedar.thtree.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1045789732.25367.49.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 21 Feb 2003 03:08:52 +0200
X-archive-position: 310
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 310                                                  
Status: O
Content-Length: 3211

On Fri, 2003-02-21 at 02:37, Tim Snider wrote:
> I'm running a RedHat 7.3 SMP server, with iptables for a firewall, so
> I've got several cards and thus IPs.I started out with dovecot 99.4 but
> noted that it was missing the LDAP, tried 99.8-test5 and am now working
> with 99.8-test7, both seem to have the same problems.

Well, I'll put out -test8 now. There's a bit more fixes, although not
for any of yours.

> I'm currently trying to setup a IMAP server on the inside of the
> firewall, 192.168.2.X. If I use just imap, turn of SSL/TLS I'm fine,
> and can do plaintext authentication via shadow, but I can't get PAM
> authentication working.

What error messages does PAM give if auth_verbose = yes? Or is that just
PAM configuration problem (pam_ldap?), nothing to do with Dovecot?

> If I turn on SSL(ssl_disable = no), neither the imap or the imaps
> respond and a netstat -tp shows that no process owns the socket
> PID/process = '-', often with characters in the Recv-Q.

But the dovecot processes exist? And the imap-login processes? Your
certificates are ok? Maybe the processes are stuck at something.. Check
if they call poll() every few seconds with strace -p? And what do you
mean by doesn't respond - "connection refused" or does it just hang
there?

> I've tried turning on all the debugging flags for configure on,
> --with-rawlog --enable-debug --enable-asserts --with-ssl=openssl
> as well as verbose_proctitle = yes, and auth_verbose = yes, setup
> logfiles /var/log/dovecot/messages, yet all I get are authorization
> messages. And I've noted that a number of them only show up after I've
> killed the dovecot process, so I'm wondering if there needs to be a bit
> of flushing somewhere?

I do call fflush() after each write to log. Killing with SIGTERM will do
clean exit which may log more things, maybe it's just that? Also killing
child processes makes master process log their exits.

> As well I've also tried to run "dovecot -F", with the log files
> commented out in the .conf file, but get nothing via stderr.

Default is to log with syslog. If you want stderr, set log path to
/dev/stderr.

>  I note that
> when I try the log_timestamp option, the dates sent from imap-login are
> completely incorrect and don't change, so I don't think the date is
> being read correctly. Is log_timestamp operational?

What messages do you even get from imap-login? Normally there should
never be anything. I didn't anyway notice problems with log_timestamp,
what format did you try?

imap-logins are also chrooted by default. There used to be a bug that
they couldn't get timezone right because of it, but that's the only time
related problem I can think of.

> One thing I'm not clear on is what process to run it under, I've setup a
> user/group 'dovecot', but does dovecot have to be a member of wheel?

You should run dovecot as root. The dovecot user should be used only for
login processes (defined in config file), and it shouldn't be in wheel
group. Actually I think it even refuses to run if it's in wheel group
(or gid 0).

> I've also noted in earlier versions you had things running via
> imapd-master, but that now seems to been replaced by "dovecot", is that
> correct?

Yes.


From jpeterson275@attbi.com  Sun Feb 23 01:16:54 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 23 Feb 2003 01:16:54 +0200 (EET)
Return-Path: <jpeterson275@attbi.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from rwcrmhc52.attbi.com (rwcrmhc52.attbi.com [216.148.227.88])
	by danu.procontrol.fi (Postfix) with ESMTP id 107FC2384D
	for <dovecot@procontrol.fi>; Sun, 23 Feb 2003 01:16:54 +0200 (EET)
Received: from attbi.com (12-228-160-142.client.attbi.com[12.228.160.142])
          by rwcrmhc52.attbi.com (rwcrmhc52) with SMTP
          id <2003022223165105200fo5h6e>; Sat, 22 Feb 2003 23:16:51 +0000
Message-ID: <3E5804E0.1040100@attbi.com>
Date: Sat, 22 Feb 2003 15:16:48 -0800
From: Jesse Peterson <jpeterson275@attbi.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] ./autogen.sh
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 311
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jpeterson275@attbi.com
Precedence: bulk
X-list: dovecot
X-UID: 311                                                  
Status: O

CVS update @ Sat Feb 22 15:14:52 PST 2003

When ./autogen.sh is run, I get:

src/Makefile.am:5: required directory src/lib-settings does not exist

Just thought someone would want to know.

- Jesse


From jpeterson275@attbi.com  Sun Feb 23 01:41:45 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 23 Feb 2003 01:41:45 +0200 (EET)
Return-Path: <jpeterson275@attbi.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from rwcrmhc51.attbi.com (rwcrmhc51.attbi.com [204.127.198.38])
	by danu.procontrol.fi (Postfix) with ESMTP id 20FF023839
	for <dovecot@procontrol.fi>; Sun, 23 Feb 2003 01:41:45 +0200 (EET)
Received: from attbi.com (12-228-160-142.client.attbi.com[12.228.160.142])
          by rwcrmhc51.attbi.com (rwcrmhc51) with SMTP
          id <2003022223414205100a7umoe>; Sat, 22 Feb 2003 23:41:42 +0000
Message-ID: <3E580AB3.7080708@attbi.com>
Date: Sat, 22 Feb 2003 15:41:39 -0800
From: Jesse Peterson <jpeterson275@attbi.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Re: ./autogen.sh
References: <3E5804E0.1040100@attbi.com>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 312
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jpeterson275@attbi.com
Precedence: bulk
X-list: dovecot
X-UID: 312                                                  
Status: O

Seems my update was corrupted somehow, I just did a checkout and it 
worked fine.

Jesse Peterson wrote:
> CVS update @ Sat Feb 22 15:14:52 PST 2003
> 
> When ./autogen.sh is run, I get:
> 
> src/Makefile.am:5: required directory src/lib-settings does not exist
> 
> Just thought someone would want to know.
> 
> - Jesse
> 
> 
> 

-- 
Jesse Peterson  /  jesse@pixeltechs.com


From tss@iki.fi  Sun Feb 23 02:55:15 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 23 Feb 2003 02:55:15 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id C773D2384D
	for <dovecot@procontrol.fi>; Sun, 23 Feb 2003 02:55:15 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 269B75E01F68; Sun, 23 Feb 2003 02:55:14 +0200 (EET)
Subject: [dovecot] Re: ./autogen.sh
From: Timo Sirainen <tss@iki.fi>
To: Jesse Peterson <jpeterson275@attbi.com>
Cc: Dovecot Mail List <dovecot@procontrol.fi>
In-Reply-To: <3E580AB3.7080708@attbi.com>
References: <3E5804E0.1040100@attbi.com>  <3E580AB3.7080708@attbi.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1045961714.13486.0.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 23 Feb 2003 02:55:14 +0200
X-archive-position: 313
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 313                                                  
Status: O

On Sun, 2003-02-23 at 01:41, Jesse Peterson wrote:
> Seems my update was corrupted somehow, I just did a checkout and it 
> worked fine.
> 
> > src/Makefile.am:5: required directory src/lib-settings does not exist

You probably didn't give -P option to cvs update, which is required to
get new directories.


From timsn@thtree.com  Mon Feb 24 00:42:59 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 24 Feb 2003 00:42:59 +0200 (EET)
Return-Path: <timsn@thtree.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from cedar.thtree.com (s216-232-27-178.bc.hsia.telus.net [216.232.27.178])
	by danu.procontrol.fi (Postfix) with ESMTP id 208292384D
	for <dovecot@procontrol.fi>; Mon, 24 Feb 2003 00:42:59 +0200 (EET)
Received: from timsn by cedar.thtree.com with local (Exim 4.04)
	id 18n4pk-0001AT-00; Sun, 23 Feb 2003 14:42:56 -0800
Subject: [dovecot] Re: Trouble setting up dovecot
From: Tim Snider <timsn@thtree.com>
To: Timo Sirainen <tss@iki.fi>
Cc: dovecot mailing list <dovecot@procontrol.fi>
In-Reply-To: <1045799208.25366.161.camel@hurina>
References: <1045787876.18341.54.camel@cedar.thtree.com>
	<1045789732.25367.49.camel@hurina>
	<1045795586.18343.93.camel@cedar.thtree.com> 
	<1045799208.25366.161.camel@hurina>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
X-Mailer: Ximian Evolution 1.0.3 (1.0.3-6) 
Date: 23 Feb 2003 14:42:56 -0800
Message-Id: <1046040176.4208.96.camel@cedar.thtree.com>
Mime-Version: 1.0
X-archive-position: 314
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: timsn@thtree.com
Precedence: bulk
X-list: dovecot
X-UID: 314                                                  
Status: O
Content-Length: 3984

Thanks Timo, turns out I'm more of a rookie at sysconfiguring than I
thought, so perhaps this helps identify stuff that a rookie wouldn't
already know...<G>


On Thu, 2003-02-20 at 19:46, Timo Sirainen wrote:
> 
> > I've not configured up LDAP on my server yet, so it's just plain PAM for
> > now. I'm able to login fine with all my other apps, so I doubt it's a
> > problem with PAM, but not impossible. I haven't done anything with PAM
> > on this machine yet as it's live. I've been testing things out on
> > another machine(NON-SMP/RH8), which I'll try tomorrow if I get a
> > chance.)
> 
> You have to have it configured in /etc/pam.d/imap. For example:
> 
> auth    required        pam_unix.so nullok
> account required        pam_unix.so

Thanks this makes more sense than the options you provide in
doc/auth.txt, so you may wish to change that. On both RH7.3 and a RH8.0
box here, I don't have pwdfile, it's apparently been replaced by other
functionality.
> 
> > each imap-login is waiting at a read(7,
> 
> That's the problem then. It really shouldn't be blocking there. Could
> you get the backtrace to see where it's hanging? ie. run as root:
> 
> gdb /usr/local/libexec/dovecot/imap-login <pid of the imap-login>
> 
> and "bt" in it.

It's hung up in SSL_CTX_use_PrivateKey() in ssl-proxy-openssl.c, which
as you correctly surmised below, is due to a password protected key. 

I've located and used mkcert.sh. As a note the only docs for
doc/mkcert.sh are halfway through the NEWS file and rapidly receeding as
you add new releases, (congrats on the fast progress by the way!),
however you might consider adding a short note about it to the
doc/auth.txt or doc/configuration.txt file for those new to dovecot.

> > > I do call fflush() after each write to log. Killing with SIGTERM will do
> > > clean exit which may log more things, maybe it's just that? Also killing
> > > child processes makes master process log their exits.
> > 
> > I usually note the messages log (watched by a tail -f) show up after I
> > kill the dovecot master process.(Kill -9)
> 
> Depends on what the messages are I guess. But if you're kill -9ing the
> master process, it's quite likely that the child processes will complain
> about losing it.

After playing a bit, I think that those messages were due to the kill
-9, SIGTERM is nicer. I still end up with little in the way of verbose
debugging messages, by my standards. Usually all I see is login and
logout messages. Otherwise, I get the occasional lockfile message, which
is something that I need to sort out with Exim, and completely on my
end.

> > dovecot: Feb 20 18:11:51 Info: Dovecot starting up
> > imap-login: Dec 31 16:00:00 Fatal: Can't load private key file
> > /usr/local/ssl/private/cedarintkey.pem: error:0906406D:PEM
> > routines:DEF_CALLBACK:problems getting password
> 
> Err, isn't this the reason why your SSL doesn't work? :) Or was that
> just an example? If your private key is crypted with some password,
> Dovecot can't use it at least currently..

Correct! Doh! I have been able to use imaps, since I built a
non-passworded private key. I was using passworded keys that I'd built
for Apache, and would eventually like to have one set of keys that I can
reference for each virtual domain. Were you planning on something like
the Apache startssl option?

I can live with the constraint of one 'connection' key for now. Have you
considered allowing each virtual domain to have it's own keys? Kind of
difficult as the secure pipe to the server is already in place by the
time the login name is seen... Kinda makes it tough for a true virtual
presence without explicit assigned IP's. Hmmm, any plans for at least a
different keys/identity per IP? If I understand the configuration file
for now, it seems to be designed for one cert per machine.

Thanks for the help, I've just got to sort out the lockfile differences
between Exim and Dovecot and I should then be functional. After that
I'll start using LDAP.

TJ


From tss@iki.fi  Mon Feb 24 02:45:54 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 24 Feb 2003 02:45:54 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 6E8E22384D
	for <dovecot@procontrol.fi>; Mon, 24 Feb 2003 02:45:54 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 4795C5E01F94; Mon, 24 Feb 2003 02:45:54 +0200 (EET)
Subject: [dovecot] Re: Trouble setting up dovecot
From: Timo Sirainen <tss@iki.fi>
To: Tim Snider <timsn@thtree.com>
Cc: dovecot mailing list <dovecot@procontrol.fi>
In-Reply-To: <1046040176.4208.96.camel@cedar.thtree.com>
References: <1045787876.18341.54.camel@cedar.thtree.com>
	 <1045789732.25367.49.camel@hurina>
	 <1045795586.18343.93.camel@cedar.thtree.com>
	 <1045799208.25366.161.camel@hurina>
	 <1046040176.4208.96.camel@cedar.thtree.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1046047554.785.44.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 24 Feb 2003 02:45:54 +0200
X-archive-position: 315
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 315                                                  
Status: O
Content-Length: 2109

On Mon, 2003-02-24 at 00:42, Tim Snider wrote:
> > You have to have it configured in /etc/pam.d/imap. For example:
> > 
> > auth    required        pam_unix.so nullok
> > account required        pam_unix.so
> 
> Thanks this makes more sense than the options you provide in
> doc/auth.txt, so you may wish to change that.

I guess it would. The pwdfile was just an example I use elsewhere. It
doesn't come with PAM by default.

> It's hung up in SSL_CTX_use_PrivateKey() in ssl-proxy-openssl.c, which
> as you correctly surmised below, is due to a password protected key. 

Well, have to fix this in some way. Hanging there isn't very nice way to
report errors.

> I've located and used mkcert.sh. As a note the only docs for
> doc/mkcert.sh are halfway through the NEWS file and rapidly receeding as
> you add new releases, (congrats on the fast progress by the way!),
> however you might consider adding a short note about it to the
> doc/auth.txt or doc/configuration.txt file for those new to dovecot.

I've added "quick setup" to beginning of it which says that.

> Correct! Doh! I have been able to use imaps, since I built a
> non-passworded private key. I was using passworded keys that I'd built
> for Apache, and would eventually like to have one set of keys that I can
> reference for each virtual domain. Were you planning on something like
> the Apache startssl option?

I guess that would be nice feature. I'll add in TODO.

> I can live with the constraint of one 'connection' key for now. Have you
> considered allowing each virtual domain to have it's own keys? Kind of
> difficult as the secure pipe to the server is already in place by the
> time the login name is seen... Kinda makes it tough for a true virtual
> presence without explicit assigned IP's. Hmmm, any plans for at least a
> different keys/identity per IP? If I understand the configuration file
> for now, it seems to be designed for one cert per machine.

.. and I thought I could keep the configuration file simple. Well, it
won't come before 1.0 anyway. You could always run multiple dovecots
with different config files.


From spamfiltered@gmx.net  Tue Feb 25 00:42:45 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 25 Feb 2003 00:42:45 +0200 (EET)
Return-Path: <spamfiltered@gmx.net>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail.gmx.net (mail.gmx.net [213.165.64.20])
	by danu.procontrol.fi (Postfix) with SMTP id A00012384D
	for <dovecot@procontrol.fi>; Tue, 25 Feb 2003 00:42:45 +0200 (EET)
Received: (qmail 19593 invoked by uid 0); 24 Feb 2003 22:42:43 -0000
Received: from p5081BCCA.dip.t-dialin.net (HELO data) (80.129.188.202)
  by mail.gmx.net (mp016-rz3) with SMTP; 24 Feb 2003 22:42:43 -0000
Content-Type: text/plain;
  charset="us-ascii"
From: wolfgang <spamfiltered@gmx.net>
To: dovecot@procontrol.fi
Subject: [dovecot] Maildir plus mbox?
Date: Mon, 24 Feb 2003 23:42:41 +0100
User-Agent: KMail/1.4.3
Organization: planet earth
MIME-Version: 1.0
Content-Transfer-Encoding: quoted-printable
Message-Id: <200302242342.41503.spamfiltered@gmx.net>
X-archive-position: 316
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: spamfiltered@gmx.net
Precedence: bulk
X-list: dovecot
X-UID: 316                                                  
Status: O

is it possible with dovecot to have the inbox in Maildir format and addit=
ional=20
imap folders in mbox format?

regards,
wolfgang


From tss@iki.fi  Tue Feb 25 01:06:31 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 25 Feb 2003 01:06:31 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id B26852384D
	for <dovecot@procontrol.fi>; Tue, 25 Feb 2003 01:06:31 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 58BC05E01F94; Tue, 25 Feb 2003 01:06:31 +0200 (EET)
Subject: [dovecot] Re: Maildir plus mbox?
From: Timo Sirainen <tss@iki.fi>
To: wolfgang <spamfiltered@gmx.net>
Cc: dovecot@procontrol.fi
In-Reply-To: <200302242342.41503.spamfiltered@gmx.net>
References: <200302242342.41503.spamfiltered@gmx.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1046127991.787.219.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 25 Feb 2003 01:06:31 +0200
X-archive-position: 317
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 317                                                  
Status: O

On Tue, 2003-02-25 at 00:42, wolfgang wrote:
> is it possible with dovecot to have the inbox in Maildir format and additional 
> imap folders in mbox format?

Currently no, but it's mostly just because I haven't figured out how it
should be configured.

I think they should be in their own namespaces at least. So that default
Maildir namespace has your INBOX, and then there would be #mbox/
namespace. That's how uw-imapd supports different mailbox formats.
Dovecot doesn't have any namespace configuration support yet, but I'll
probably add that soon.

If you really wanted it now, it wouldn't be too difficult to kludge into
the code though :)


From spamfiltered@gmx.net  Tue Feb 25 01:26:32 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 25 Feb 2003 01:26:33 +0200 (EET)
Return-Path: <spamfiltered@gmx.net>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail.gmx.net (mail.gmx.net [213.165.65.60])
	by danu.procontrol.fi (Postfix) with SMTP id 8FE622384D
	for <dovecot@procontrol.fi>; Tue, 25 Feb 2003 01:26:32 +0200 (EET)
Received: (qmail 11777 invoked by uid 0); 24 Feb 2003 23:26:31 -0000
Received: from p5081BCCA.dip.t-dialin.net (HELO data) (80.129.188.202)
  by mail.gmx.net (mp006-rz3) with SMTP; 24 Feb 2003 23:26:31 -0000
Content-Type: text/plain;
  charset="iso-8859-1"
From: wolfgang <spamfiltered@gmx.net>
Organization: planet earth
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Maildir plus mbox?
Date: Tue, 25 Feb 2003 00:26:29 +0100
User-Agent: KMail/1.4.3
References: <200302242342.41503.spamfiltered@gmx.net> <1046127991.787.219.camel@hurina>
In-Reply-To: <1046127991.787.219.camel@hurina>
MIME-Version: 1.0
Content-Transfer-Encoding: quoted-printable
Message-Id: <200302250026.29224.spamfiltered@gmx.net>
X-archive-position: 318
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: spamfiltered@gmx.net
Precedence: bulk
X-list: dovecot
X-UID: 318                                                  
Status: O

In an older episode (Tuesday 25 February 2003 00:06), Timo Sirainen wrote=
:

> I think they should be in their own namespaces at least. So that defaul=
t
> Maildir namespace has your INBOX, and then there would be #mbox/
> namespace. That's how uw-imapd supports different mailbox formats.
> Dovecot doesn't have any namespace configuration support yet, but I'll
> probably add that soon.
>
> If you really wanted it now, it wouldn't be too difficult to kludge int=
o
> the code though :)

what we would like to do, is have a Maildir INBOX on the server and have =
the=20
users create/use additional mbox folders in ~/mail/ via their clients.

wolfgang


From tss@iki.fi  Tue Feb 25 02:11:33 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 25 Feb 2003 02:11:33 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 8329723839
	for <dovecot@procontrol.fi>; Tue, 25 Feb 2003 02:11:33 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 498E45E01F94; Tue, 25 Feb 2003 02:11:33 +0200 (EET)
Subject: [dovecot] Configuration file format changes
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1046131893.787.273.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 25 Feb 2003 02:11:33 +0200
X-archive-position: 319
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 319                                                  
Status: O
Content-Length: 1773

After tomorrow's 0.99.8 release I think it's time for a new config file
format. It could be made backwards compatibile with the old format, but 
there would be new tree-like categories. I was thinking something like
this:

# global settings
protocols = imap

# "foo.server.org" is just descriptive name
# settings inside server { .. } will override global ones.
# groups (namespace, login settings, auth settings) aren't replaced
# unless same name is used.
server foo.server.org {
  imap_listen = 1.2.3.4
  ssl_cert_file = /etc/ssl/certs/foo.cer

  # default namespace (no name)
  namespace {
    type = private
    mail = mbox:~/mail
  }

  # Have to quote so '#' won't be thought out as comment.
  # I think quoting should work everywhere actually..
  namespace "#maildir" {
    type = private
    inbox = yes # this namespace contains INBOX
    mail = Maildir:~/Maildir
  }

  # override global auth default
  auth default {
    auth_mechanisms = plain digest-md5
    auth_realms = foo.server.org
    auth_userdb = ldap /etc/dovecot-ldap.conf
    auth_passdb = ldap /etc/dovecot-ldap.conf
  }
}

server bar.server.org {
  imap_listen = 1.2.3.5
  ssl_cert_file = /etc/ssl/certs/bar.cer

  namespace {
    type = private
    #mail = #autodetect
  }

  # shared mailboxes between users
  # eg. user/timo.sirainen/some-shared-folder
  namespace user {
    type = user
    mail = /home/%u/mail/shared
  }
}

server baz.server.org {
  imap_listen = 1.2.3.6
  ssl_disable = yes

  # Only Courier-like INBOX namespace
  namespace INBOX {
    type = private
  }
}

# common namespace between all instances
namespace shared {
  type = shared
  mail = mbox:/var/lists:INDEX=~/mail/.shared/
}

auth default {
  auth_mechanisms = plain
  auth_userdb = passwd
  auth_passdb = pam
}


From tss@iki.fi  Tue Feb 25 02:17:20 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 25 Feb 2003 02:17:20 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 61ADF23839
	for <dovecot@procontrol.fi>; Tue, 25 Feb 2003 02:17:20 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 273545E01F94; Tue, 25 Feb 2003 02:17:20 +0200 (EET)
Subject: [dovecot] Re: Configuration file format changes
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <1046131893.787.273.camel@hurina>
References: <1046131893.787.273.camel@hurina>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1046132239.787.277.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 25 Feb 2003 02:17:20 +0200
X-archive-position: 320
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 320                                                  
Status: O

On Tue, 2003-02-25 at 02:11, Timo Sirainen wrote:
> server foo.server.org {

Actually, not "server", but "group". This would allow things like:

group imap {
  protocols = imap

  group foo.server.org { ... }
  group bar.server.org { ... }
}

group pop3 {
  protocols = pop3
  ...
}


From tss@iki.fi  Tue Feb 25 03:23:14 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 25 Feb 2003 03:23:14 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id A51672384D
	for <dovecot@procontrol.fi>; Tue, 25 Feb 2003 03:23:14 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 665825E01F94; Tue, 25 Feb 2003 03:23:14 +0200 (EET)
Subject: [dovecot] Re: Configuration file format changes
From: Timo Sirainen <tss@iki.fi>
To: Brad Figg <brad@triplepoint.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <3E5ABF46.8020005@triplepoint.com>
References: <1046131893.787.273.camel@hurina>
	 <1046132239.787.277.camel@hurina>  <3E5ABF46.8020005@triplepoint.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1046136194.788.287.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 25 Feb 2003 03:23:14 +0200
X-archive-position: 321
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 321                                                  
Status: O

On Tue, 2003-02-25 at 02:56, Brad Figg wrote:
> Just my $.02 (and that's probably overcharging). Anytime I need
> a config file I use XML and an open source parser.

I hate XML config files. Not going to happen. Ever. :)

I think they're difficult to read with standard text editor. Even more
difficult to modify. And creating read-only parser for just about any
config file format doesn't take hardly any time. External XML libraries
would also annoy people.

From asf@void.at  Tue Feb 25 10:30:51 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 25 Feb 2003 10:30:51 +0200 (EET)
Return-Path: <asf@void.at>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from ycpmailsrv01.ycn.com (ycpmailsrv01.ycn.com [212.88.160.6])
	by danu.procontrol.fi (Postfix) with ESMTP id 8D74123839
	for <dovecot@procontrol.fi>; Tue, 25 Feb 2003 10:30:51 +0200 (EET)
Received: from eris.void.at (212-88-187-152.ADSL.ycn.com [212.88.187.152])
	by ycpmailsrv01.ycn.com (8.12.3/8.12.3/Debian -4) with ESMTP id h1P8NuvJ006000;
	Tue, 25 Feb 2003 09:23:56 +0100
Received: from asf by eris.void.at with local (Exim 3.36 #1 (Debian))
	id 18naU2-0002U1-00; Tue, 25 Feb 2003 09:30:38 +0100
Mail-Copies-To: never
X-Url: http://asf.void.at/
To: Timo Sirainen <tss@iki.fi>
Cc: Brad Figg <brad@triplepoint.com>, dovecot@procontrol.fi
Subject: [dovecot] Re: Configuration file format changes
X-Attribution: asf
X-Face:  3*3w/y?I6|`'CYW7F~m0]U1)L\|[x"?/V6^;s3FU#q|F'AL(3C?$eslHvAmR:KjT"&LZeqM
 0wMS%HM`
References: <1046131893.787.273.camel@hurina>
	<1046132239.787.277.camel@hurina> <3E5ABF46.8020005@triplepoint.com>
	<1046136194.788.287.camel@hurina>
From: Andreas Fuchs <asf@void.at>
Message-ID: <87ptpgsqxd.fsf@eris.void.at>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Date: Tue, 25 Feb 2003 09:30:38 +0100
X-archive-position: 322
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: asf@void.at
Precedence: bulk
X-list: dovecot
X-UID: 322                                                  
Status: O

Today, Timo Sirainen <tss@iki.fi> wrote:
> I hate XML config files. Not going to happen. Ever. :)
> 
> I think they're difficult to read with standard text editor. Even more
> difficult to modify. And creating read-only parser for just about any
> config file format doesn't take hardly any time. External XML
> libraries would also annoy people.

Yay for sexp syntax!

see http://www.complang.tuwien.ac.at/~schani/lispreader/ for a nice
implementation of a suitable reader.

Ha, ha, only serious (-:
-- 
Andreas Fuchs, <asf@acm.org>, asf@jabber.at, antifuchs

From tss@iki.fi  Tue Feb 25 23:33:15 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 25 Feb 2003 23:33:15 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 3E5C12384D
	for <dovecot@procontrol.fi>; Tue, 25 Feb 2003 23:33:14 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 710275E01F94; Tue, 25 Feb 2003 23:33:13 +0200 (EET)
Subject: [dovecot] 0.99.8 released
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1046208793.30814.15.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 25 Feb 2003 23:33:13 +0200
X-archive-position: 323
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 323                                                  
Status: O
Content-Length: 3088

Hope I didn't forget anything :)

v0.99.8 2003-02-25  Timo Sirainen <tss@iki.fi>

	* NOTE: Configuration file has changed a bit: auth_userinfo was
	  replaced by userdb and passdb. *_port were merged into *_listen.
	  Disabling listening in imaps port is now done by changing protocols
	  setting.

	* Maildir: .customflags location has changed for INBOX. If you have
	  set any custom flags, move Maildir/.INBOX/.customflags into
	  Maildir/.customflags or they will be lost.

	* mbox: Autodetect /var/mail/%u and /var/spool/mail/%u as INBOXes
	  if they're found and mail_default_env isn't set.

	* passwd-file: File format changed a bit. If you used realm or mail
	  fields, you'll have to fix the file. See doc/auth.txt for description
	  of the format.

	+ Fully featured POP3 server included. Disabled by default.
	+ Support for LITERAL+, MULTIAPPEND, UNSELECT, IDLE, CHILDREN and
	  LISTEXT extensions.
	+ LDAP authentication support.
	+ Internal API cleanups made Dovecot faster and take less memory
	+ auth_verbose logs now all authentication failures
	+ Support for Solaris 9 sendfilev()
	+ New setting: mail_full_filesystem_access allows clients to access the
	  whole filesystem by simply giving the path before the mailbox name
	  (eg. SELECT ~user/mail/box, LIST "" /tmp/%). While this allows users
	  to share mailboxes, it's not recommended since Dovecot's index files
	  can't be safely shared.
	+ New setting: client_workarounds.
	+ Dynamically loadable authentication modules. Binary package builders
	  should consider using it for at least LDAP.
	+ mbox: Content-Length is saved now to each saved message, so it's
	  now safe to have lines beginning with "From ".
	+ mbox: mail_read_mmaped = no works with it now
	+ Indexes can be kept in memory by adding :INDEX=MEMORY to MAIL
	  environment. There's not much point to do this now though, since the
	  UIDs won't be saved.
	- COPY now behaves as RFC2060 says: "If the COPY command is
	  unsuccessful for any reason, server implementations MUST restore the
	  destination mailbox to its state before the COPY attempt."
	- LIST and LSUB rewrite, should fix several bugs in them
	- maildir_copy_with_hardlinks = yes was broken.
	- mboxes in subfolders weren't selectable.
	- STORE didn't accept multiple flags without () around them
	- PLAIN SASL-authentication was a bit broken.
	- IMAP dates were parsed a few hours wrong
	- STATUS command removed \Recent flags from messages
	- Several bugfixes to SEARCH command, especially related to multiple
	  search conditions
	- If auth/login process died unexpectedly at startup, the exit status
	  or killing signal wasn't logged.
	- mbox parsing might have crashed sometimes
	- mbox: when saving mails, internal headers were allowed in input,
	  sometimes causing problems (eg. duplicate headers) when appending
	  and copying messages
	- mbox: X-Keywords headers were duplicated
	- Some small fixes to how messages are saved to Maildir
	- Next command after STARTTLS was ignored which left the connection
	  stuck sometimes
	- Dovecot was pretty much broken with FreeBSD


From tss@iki.fi  Wed Feb 26 03:52:42 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 26 Feb 2003 03:52:42 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id DEC8623839
	for <dovecot@procontrol.fi>; Wed, 26 Feb 2003 03:52:41 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 21C6E5E01F94; Wed, 26 Feb 2003 03:52:40 +0200 (EET)
Subject: [dovecot] inetd/xinetd/tcpserver support
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1046224359.30815.36.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 26 Feb 2003 03:52:40 +0200
X-archive-position: 324
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 324                                                  
Status: O

I was just thinking how they could be easily supported. This would work,
right? :

imap stream tcp nowait root /usr/sbin/tcpd /usr/local/libexec/dovecot/imap-login
imaps stream tcp nowait root /usr/sbin/tcpd /usr/local/libexec/dovecot/imap-login --ssl

imap-login would try to connect to master process using some named
socket. If it couldn't, it would create the master process itself.
Master process would work as usual (executes auth and imap processes),
except it wouldn't be executing login processes.

This wouldn't require much code changing, and it would still be using
all the same privilege separations as the standalone version so it would
be just a secure.

Only thing I'm wondering is if any of the TCP wrappers care about the
created child processes? The master process would have to stay alive
after the connection that created it dies.

I guess I'll implement this soon and try if it works.


From lfarkas@bnap.hu  Wed Feb 26 10:58:31 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 26 Feb 2003 10:58:31 +0200 (EET)
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 75EC32384D
	for <dovecot@procontrol.fi>; Wed, 26 Feb 2003 10:58:31 +0200 (EET)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id 4E3AA75401D
	for <dovecot@procontrol.fi>; Wed, 26 Feb 2003 09:59:03 +0100 (CET)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id 4B1A63EF2
	for <dovecot@procontrol.fi>; Wed, 26 Feb 2003 09:58:29 +0100 (CET)
Message-ID: <3E5C81BC.6090100@bnap.hu>
Date: Wed, 26 Feb 2003 09:58:36 +0100
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2) Gecko/20021202
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: dovecot@procontrol.fi
Subject: [dovecot] Re: inetd/xinetd/tcpserver support
References: <1046224359.30815.36.camel@hurina>
In-Reply-To: <1046224359.30815.36.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 325
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 325                                                  
Status: O
Content-Length: 1392

I always prefer standalone daemons, and as we see the tendency is that 
most server run as standalone (apache, vsftpd, ssh...). at the begining 
they has (x)inetd version later remove it...
IMHO ip/tcp filtering should have done in a firewall or some fitering 
can be implemented in the standalone server too..
but this is just my 2c:-)

Timo Sirainen wrote:
> I was just thinking how they could be easily supported. This would work,
> right? :
> 
> imap stream tcp nowait root /usr/sbin/tcpd /usr/local/libexec/dovecot/imap-login
> imaps stream tcp nowait root /usr/sbin/tcpd /usr/local/libexec/dovecot/imap-login --ssl
> 
> imap-login would try to connect to master process using some named
> socket. If it couldn't, it would create the master process itself.
> Master process would work as usual (executes auth and imap processes),
> except it wouldn't be executing login processes.
> 
> This wouldn't require much code changing, and it would still be using
> all the same privilege separations as the standalone version so it would
> be just a secure.
> 
> Only thing I'm wondering is if any of the TCP wrappers care about the
> created child processes? The master process would have to stay alive
> after the connection that created it dies.
> 
> I guess I'll implement this soon and try if it works.
> 
> 
> 


-- 
   Levente                               "Si vis pacem para bellum!"



From mem@mv.mv.com  Wed Feb 26 23:04:56 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 26 Feb 2003 23:04:56 +0200 (EET)
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id 2808A2384D
	for <dovecot@procontrol.fi>; Wed, 26 Feb 2003 23:04:56 +0200 (EET)
Received: (qmail 28075 invoked by uid 101); 26 Feb 2003 16:04:54 -0500
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Wed, 26 Feb 2003 16:04:54 -0500
To: dovecot@procontrol.fi
Subject: [dovecot] pop3: last, and auth plain
Message-ID: <20030226160454.N19224@iridium.mv.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
X-archive-position: 326
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mem@mv.mv.com
Precedence: bulk
X-list: dovecot
X-UID: 326                                                  
Status: O

Hi-

A couple of comments regarding the POP3 server (I realize the POP3
server is probably low priority though..)

One problem is that the "LAST" command is not supported.  Some mail
clients end up downloading all messages every time because of this
(or so I'm told).  The biggest source of these remarks is people
using the yahoo webmail front end.  I wonder if this could be added?

Also, under BSD/OS, the "auth plain" mechanism doesn't work.  Perusing
the mailing list archives, I see that the symptoms appear just like
those that were reported earlier for another BSD system.  I'm curious
as to whether there has been any progress on that front?

Yours,
-mm-

From tss@iki.fi  Wed Feb 26 23:26:49 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 26 Feb 2003 23:26:49 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 0A9712384D
	for <dovecot@procontrol.fi>; Wed, 26 Feb 2003 23:26:49 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id C895E5E01F94; Wed, 26 Feb 2003 23:26:48 +0200 (EET)
Subject: [dovecot] Re: pop3: last, and auth plain
From: Timo Sirainen <tss@iki.fi>
To: "Mark E. Mallett" <mem@mv.mv.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030226160454.N19224@iridium.mv.net>
References: <20030226160454.N19224@iridium.mv.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1046294808.30811.66.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 26 Feb 2003 23:26:48 +0200
X-archive-position: 327
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 327                                                  
Status: O
Content-Length: 1149

On Wed, 2003-02-26 at 23:04, Mark E. Mallett wrote:
> A couple of comments regarding the POP3 server (I realize the POP3
> server is probably low priority though..)
> 
> One problem is that the "LAST" command is not supported.  Some mail
> clients end up downloading all messages every time because of this
> (or so I'm told).  The biggest source of these remarks is people
> using the yahoo webmail front end.  I wonder if this could be added?

http://www.remote.org/jochen/mail/info/pop3-last.html

I could add support for it, but how exactly? Maybe return the previous
message of the first unseen message?

> Also, under BSD/OS, the "auth plain" mechanism doesn't work.  Perusing
> the mailing list archives, I see that the symptoms appear just like
> those that were reported earlier for another BSD system.  I'm curious
> as to whether there has been any progress on that front?

All BSD issues should have been fixed by now. I just tested with FreeBSD
5 and Linux, AUTH PLAIN worked just fine in both. Does USER+PASS work?
Try enabling auth_verbose = yes?

And what errors exactly do you see now? There's been several different
BSD errors :)


From ipswitch@apk.net  Wed Feb 26 23:29:39 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 26 Feb 2003 23:29:39 +0200 (EET)
Return-Path: <ipswitch@apk.net>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from cleopatra.apk.net (cleopatra.apk.net [207.54.158.24])
	by danu.procontrol.fi (Postfix) with ESMTP id 8537A2384D
	for <dovecot@procontrol.fi>; Wed, 26 Feb 2003 23:29:39 +0200 (EET)
Received: from [207.54.133.252] (helo=[10.1.3.2])
	by cleopatra.apk.net with esmtp (Exim 4.12)
	id 18o9AG-0004MQ-00
	for dovecot@procontrol.fi; Wed, 26 Feb 2003 16:32:32 -0500
Date: Wed, 26 Feb 2003 16:28:13 -0500
From: Stuart Krivis <ipswitch@apk.net>
Reply-To: Stuart Krivis <ipswitch@apk.net>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: inetd/xinetd/tcpserver support
Message-ID: <8165265.1046276893@[10.1.3.2]>
In-Reply-To: <3E5C81BC.6090100@bnap.hu>
References: <1046224359.30815.36.camel@hurina> <3E5C81BC.6090100@bnap.hu>
X-Mailer: Mulberry/3.0.0 (Win32)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
Content-Disposition: inline
X-archive-position: 328
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: ipswitch@apk.net
Precedence: bulk
X-list: dovecot
X-UID: 328                                                  
Status: O
Content-Length: 1374



--On Wednesday, February 26, 2003 9:58 AM +0100 Farkas Levente 
<lfarkas@bnap.hu> wrote:

> I always prefer standalone daemons, and as we see the tendency is that
> most server run as standalone (apache, vsftpd, ssh...). at the begining
> they has (x)inetd version later remove it... IMHO ip/tcp filtering should
> have done in a firewall or some fitering can be implemented in the
> standalone server too.. but this is just my 2c:-)

Services that get heavily used can push inetd to its limits - or beyond. :-)

Standalone is normally better in this case, with sendmail being a common 
example.


>>
>> imap stream tcp nowait root /usr/sbin/tcpd
>> /usr/local/libexec/dovecot/imap-login imaps stream tcp nowait root
>> /usr/sbin/tcpd /usr/local/libexec/dovecot/imap-login --ssl

I don't think this will work for tcpserver. :-)

One advantage to using something sitting before the daemon is that you can 
depend on the other software for certain functionality and keep the daemon 
simple.

I suppose xinetd and tcpwrappers would do the job, or djb's tcpserver. It 
just depends upon which flavor you like. :-)

I'm coming to have more and more respect for djb's software, although there 
are still some things that make me shake my head. hehe

One disadvantage to running daemons standalone is that they if they die, 
they stay that way. djb's daemontools can help there.

From tss@iki.fi  Wed Feb 26 23:36:04 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 26 Feb 2003 23:36:04 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 77CF72384D
	for <dovecot@procontrol.fi>; Wed, 26 Feb 2003 23:36:04 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 4A1855E01F94; Wed, 26 Feb 2003 23:36:04 +0200 (EET)
Subject: [dovecot] Re: pop3: last, and auth plain
From: Timo Sirainen <tss@iki.fi>
To: "Mark E. Mallett" <mem@mv.mv.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <1046294808.30811.66.camel@hurina>
References: <20030226160454.N19224@iridium.mv.net>
	 <1046294808.30811.66.camel@hurina>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1046295364.30814.74.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 26 Feb 2003 23:36:04 +0200
X-archive-position: 329
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 329                                                  
Status: O

On Wed, 2003-02-26 at 23:26, Timo Sirainen wrote:
> http://www.remote.org/jochen/mail/info/pop3-last.html
> 
> I could add support for it, but how exactly? Maybe return the previous
> message of the first unseen message?

No, RFC1460 defined it differently. I think I'll do it like UW ipop3d.
\Seen flags are used to track the "last" message. If RSET command is
used, it would clear the \Seen flag from all messages. So it doesn't
interact too nicely with IMAP. Maybe this should be optional..


From mem@mv.mv.com  Wed Feb 26 23:45:40 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 26 Feb 2003 23:45:41 +0200 (EET)
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id 4BDC823839
	for <dovecot@procontrol.fi>; Wed, 26 Feb 2003 23:45:40 +0200 (EET)
Received: (qmail 23276 invoked by uid 101); 26 Feb 2003 16:45:38 -0500
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Wed, 26 Feb 2003 16:45:38 -0500
To: Timo Sirainen <tss@iki.fi>
Cc: "Mark E. Mallett" <mem@mv.mv.com>, dovecot@procontrol.fi
Subject: [dovecot] Re: pop3: last, and auth plain
Message-ID: <20030226164538.P19224@iridium.mv.net>
References: <20030226160454.N19224@iridium.mv.net> <1046294808.30811.66.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
In-Reply-To: <1046294808.30811.66.camel@hurina>; from tss@iki.fi on Wed, Feb 26, 2003 at 11:26:48PM +0200
X-archive-position: 330
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mem@mv.mv.com
Precedence: bulk
X-list: dovecot
X-UID: 330                                                  
Status: O
Content-Length: 1754

On Wed, Feb 26, 2003 at 11:26:48PM +0200, Timo Sirainen wrote:
> On Wed, 2003-02-26 at 23:04, Mark E. Mallett wrote:
> > A couple of comments regarding the POP3 server (I realize the POP3
> > server is probably low priority though..)
> > 
> > One problem is that the "LAST" command is not supported.  Some mail
> > clients end up downloading all messages every time because of this
> > (or so I'm told).  The biggest source of these remarks is people
> > using the yahoo webmail front end.  I wonder if this could be added?
> 
> http://www.remote.org/jochen/mail/info/pop3-last.html

Yes, of course.  Duh.  I was just having a conversation a few hours
ago with somebody about how the concept of "mailbox order" is
not always a valid one.  Sometimes I fail to connect the dots.



> > Also, under BSD/OS, the "auth plain" mechanism doesn't work.  Perusing
> > the mailing list archives, I see that the symptoms appear just like
> > those that were reported earlier for another BSD system.  I'm curious
> > as to whether there has been any progress on that front?
> 
> All BSD issues should have been fixed by now. I just tested with FreeBSD
> 5 and Linux, AUTH PLAIN worked just fine in both. Does USER+PASS work?
> Try enabling auth_verbose = yes?
> 
> And what errors exactly do you see now? There's been several different
> BSD errors :)

I'll have to investigate further.  Unfortunately the main symptom
is that people call and say "it doesn't work" -- enabling auth_verbose
may help.  I had some indications that the dovecot-auth process died
prematurely, but that could simply be operator error.

BTW for a completely random remark: you might get configure to check
whether "lchown()" exists and use "chown()" if it does not
(in safe-mkdir.c)

-mm-

From tss@iki.fi  Thu Feb 27 00:00:07 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 27 Feb 2003 00:00:08 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 8D07123839
	for <dovecot@procontrol.fi>; Thu, 27 Feb 2003 00:00:07 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 2F7B65E01F94; Thu, 27 Feb 2003 00:00:07 +0200 (EET)
Subject: [dovecot] Re: pop3: last, and auth plain
From: Timo Sirainen <tss@iki.fi>
To: "Mark E. Mallett" <mem@mv.mv.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030226164538.P19224@iridium.mv.net>
References: <20030226160454.N19224@iridium.mv.net>
	 <1046294808.30811.66.camel@hurina>  <20030226164538.P19224@iridium.mv.net>
Content-Type: multipart/mixed; boundary="=-5aQC1Iv8Ec5otzvmhZZr"
Organization: 
Message-Id: <1046296806.30814.89.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 27 Feb 2003 00:00:07 +0200
X-archive-position: 331
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 331                                                  
Status: O
Content-Length: 2126


--=-5aQC1Iv8Ec5otzvmhZZr
Content-Type: text/plain
Content-Transfer-Encoding: 7bit

On Wed, 2003-02-26 at 23:45, Mark E. Mallett wrote:
> > > Also, under BSD/OS, the "auth plain" mechanism doesn't work.  Perusing
> I had some indications that the dovecot-auth process died
> prematurely, but that could simply be operator error.

I noticed that too while testing. It crashes if client sends invalid
data to auth plain. It shouldn't affect valid authentications though,
except by aborting auth for other people who were just logging in. Well,
I'll include the fixpatch.

> BTW for a completely random remark: you might get configure to check
> whether "lchown()" exists and use "chown()" if it does not
> (in safe-mkdir.c)

Oh, didn't notice lchown() wasn't posix. I'll make it use fchown() and
fchmod().


--=-5aQC1Iv8Ec5otzvmhZZr
Content-Disposition: attachment; filename=auth-crashfix.patch
Content-Type: text/x-patch; name=auth-crashfix.patch; charset=ISO-8859-15
Content-Transfer-Encoding: quoted-printable

Index: mech-plain.c
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
RCS file: /home/cvs/dovecot/src/auth/mech-plain.c,v
retrieving revision 1.9
retrieving revision 1.10
diff -u -r1.9 -r1.10
--- mech-plain.c	18 Feb 2003 19:11:26 -0000	1.9
+++ mech-plain.c	26 Feb 2003 21:27:17 -0000	1.10
@@ -42,12 +42,17 @@
 		}
 	}
=20
-	/* split and save user/realm */
-	auth_request->user =3D p_strdup(auth_request->pool, authenid);
-	passdb->verify_plain(auth_request, pass, verify_callback);
+	if (authenid =3D=3D NULL) {
+		/* invalid input */
+		mech_auth_finish(auth_request, NULL, 0, FALSE);
+	} else {
+		/* split and save user/realm */
+		auth_request->user =3D p_strdup(auth_request->pool, authenid);
+		passdb->verify_plain(auth_request, pass, verify_callback);
=20
-	/* make sure it's cleared */
-	safe_memset(pass, 0, strlen(pass));
+		/* make sure it's cleared */
+		safe_memset(pass, 0, strlen(pass));
+	}
 	return TRUE;
 }
=20

--=-5aQC1Iv8Ec5otzvmhZZr--

From skvidal@phy.duke.edu  Thu Feb 27 01:16:24 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 27 Feb 2003 01:16:24 +0200 (EET)
Return-Path: <skvidal@phy.duke.edu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail.phy.duke.edu (mail.phy.duke.edu [152.3.182.2])
	by danu.procontrol.fi (Postfix) with ESMTP id 3CD772384D
	for <dovecot@procontrol.fi>; Thu, 27 Feb 2003 01:16:24 +0200 (EET)
Received: from opus.phy.duke.edu (opus.phy.duke.edu [152.3.182.42])
	by mail.phy.duke.edu (Postfix) with ESMTP id 871AE30198
	for <dovecot@procontrol.fi>; Wed, 26 Feb 2003 18:16:21 -0500 (EST)
Subject: [dovecot] zlib support
From: seth vidal <skvidal@phy.duke.edu>
To: dovecot@procontrol.fi
Content-Type: multipart/signed; micalg=pgp-sha1; protocol="application/pgp-signature"; boundary="=-CXdjCwudM9u9+QeyDt39"
Organization: 
Message-Id: <1046301401.16349.123.camel@opus>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 (1.2.2-1) 
Date: 26 Feb 2003 18:16:41 -0500
X-archive-position: 332
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: skvidal@phy.duke.edu
Precedence: bulk
X-list: dovecot
X-UID: 332                                                  
Status: O


--=-CXdjCwudM9u9+QeyDt39
Content-Type: text/plain
Content-Transfer-Encoding: quoted-printable

Hi,
 Silly idea, Ever considered zlib support so the imap server could read
through gzipped mbox files or gzipped maildir entries?

-sv


--=-CXdjCwudM9u9+QeyDt39
Content-Type: application/pgp-signature; name=signature.asc
Content-Description: This is a digitally signed message part

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.1 (GNU/Linux)

iD8DBQA+XUrZ1Aj3x2mIbMcRAiE8AJwOeb8Vo+/gT/A/Qz06iB/0fBs2RgCglUQY
krG7Hax1uyZTUF4J1Jk4ANQ=
=/feb
-----END PGP SIGNATURE-----

--=-CXdjCwudM9u9+QeyDt39--


From tss@iki.fi  Thu Feb 27 01:26:48 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 27 Feb 2003 01:26:48 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id AC26E2384D
	for <dovecot@procontrol.fi>; Thu, 27 Feb 2003 01:26:48 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 771875E01F94; Thu, 27 Feb 2003 01:26:48 +0200 (EET)
Subject: [dovecot] Re: zlib support
From: Timo Sirainen <tss@iki.fi>
To: seth vidal <skvidal@phy.duke.edu>
Cc: dovecot@procontrol.fi
In-Reply-To: <1046301401.16349.123.camel@opus>
References: <1046301401.16349.123.camel@opus>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1046302008.30814.96.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 27 Feb 2003 01:26:48 +0200
X-archive-position: 333
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 333                                                  
Status: O

On Thu, 2003-02-27 at 01:16, seth vidal wrote:
>  Silly idea, Ever considered zlib support so the imap server could read
> through gzipped mbox files or gzipped maildir entries?

Yes, it's been in todo for some time now. mbox support would likely be
read-only, read-write would require recreating the whole .gz file on
updates.


From ianj@ian-justman.com  Thu Feb 27 02:18:12 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 27 Feb 2003 02:18:12 +0200 (EET)
Return-Path: <ianj@ian-justman.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from sakura.ian-justman.com (sakura.ian-justman.com [207.126.64.32])
	by danu.procontrol.fi (Postfix) with ESMTP id C900B23839
	for <dovecot@procontrol.fi>; Thu, 27 Feb 2003 02:18:11 +0200 (EET)
Received: from localhost.localdomain (localhost [127.0.0.1])
	by localhost.ian-justman.com (Postfix) with ESMTP id 09C40611288
	for <dovecot@procontrol.fi>; Wed, 26 Feb 2003 16:18:10 -0800 (PST)
Received: from ian-justman.com (fenchurch.netasset.com [207.126.67.194])
	by sakura.ian-justman.com (Postfix) with ESMTP id 11950611288
	for <dovecot@procontrol.fi>; Wed, 26 Feb 2003 16:18:08 -0800 (PST)
Message-ID: <3E5D5940.9000606@ian-justman.com>
Date: Wed, 26 Feb 2003 16:18:08 -0800
From: "Ian R. Justman" <ianj@ian-justman.com>
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.0; en-US; rv:1.0.2) Gecko/20021120 Netscape/7.01
X-Accept-Language: en-us, en, ja
MIME-Version: 1.0
To: dovecot@procontrol.fi
Subject: [dovecot] Re: zlib support
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 334
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: ianj@ian-justman.com
Precedence: bulk
X-list: dovecot
X-UID: 334                                                  
Status: O



Timo Sirainen wrote:
 > Yes, it's been in todo for some time now. mbox support would likely be
 > read-only, read-write would require recreating the whole .gz file on
 > updates.

Actually, I wouldn't mind seeing something like this so I can compress
up my old mail and perhaps store them on CD, for example.  I tend to
archive mailing list traffic by month (which I store in mbox format), so 
past months tend to not change much, if at all.  :)

While not an absolute necessity, it'd be nice to have.

--Ian.



From kahnert@mail.desy.de  Thu Feb 27 20:02:14 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 27 Feb 2003 20:02:14 +0200 (EET)
Return-Path: <kahnert@mail.desy.de>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1-195.desy.de (mailserver1.desy.de [131.169.87.109])
	by danu.procontrol.fi (Postfix) with ESMTP id 35CE923839
	for <dovecot@procontrol.fi>; Thu, 27 Feb 2003 20:02:14 +0200 (EET)
Received: from pcx3332.desy.de (pcx3332.desy.de [131.169.214.139])
	by mail1-195.desy.de (8.8.5/8.8.5/R) with ESMTP id TAA14080
	for <dovecot@procontrol.fi>; Thu, 27 Feb 2003 19:02:12 +0100 (MET)
Received: (from kahnert@localhost)
	by pcx3332.desy.de (8.11.3/8.8.5) id h1RI2D310522
	for dovecot@procontrol.fi; Thu, 27 Feb 2003 19:02:13 +0100
Date: Thu, 27 Feb 2003 19:02:13 +0100
From: Juergen Kahnert <Juergen.Kahnert@DESY.de>
To: dovecot@procontrol.fi
Subject: [dovecot] IMAP Folder paths
Message-ID: <20030227190212.F3097@pcx3332.desy.de>
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
User-Agent: Mutt/1.3.16i
X-archive-position: 335
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: Juergen.Kahnert@DESY.de
Precedence: bulk
X-list: dovecot
X-UID: 335                                                  
Status: O

Hello,

we like to use dovecot, but our old imapd used to store the paths of the
folder in the file ~/.mailboxlist. This file contains something like
this:

    mail/read
    mail/dovecot
    .netscape/imap/mailbox
    .Mail/foo

Each line with a path to one mbox folder. And please pay attention that
there is no path to the inbox, because this is stored on the server...
Is there a way to use this files with dovecot? It would be a real pain
to change this for a few thousand user...

Do you see a chance of using such a file? Or is it already possible and
I'd overlooked it? Or is it easy / hard to implement?

kind regards,

    Jürgen Kahnert



From skvidal@phy.duke.edu  Thu Feb 27 20:23:36 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 27 Feb 2003 20:23:37 +0200 (EET)
Return-Path: <skvidal@phy.duke.edu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail.phy.duke.edu (mail.phy.duke.edu [152.3.182.2])
	by danu.procontrol.fi (Postfix) with ESMTP id C166E23839
	for <dovecot@procontrol.fi>; Thu, 27 Feb 2003 20:23:36 +0200 (EET)
Received: from opus.phy.duke.edu (opus.phy.duke.edu [152.3.182.42])
	by mail.phy.duke.edu (Postfix) with ESMTP
	id 6495930376; Thu, 27 Feb 2003 13:23:35 -0500 (EST)
Subject: [dovecot] Re: IMAP Folder paths
From: seth vidal <skvidal@phy.duke.edu>
To: Juergen Kahnert <Juergen.Kahnert@DESY.de>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030227190212.F3097@pcx3332.desy.de>
References: <20030227190212.F3097@pcx3332.desy.de>
Content-Type: text/plain
Organization: 
Message-Id: <1046370236.20267.14.camel@opus>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 (1.2.2-1) 
Date: 27 Feb 2003 13:23:56 -0500
Content-Transfer-Encoding: 7bit
X-archive-position: 336
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: skvidal@phy.duke.edu
Precedence: bulk
X-list: dovecot
X-UID: 336                                                  
Status: O

On Thu, 2003-02-27 at 13:02, Juergen Kahnert wrote:
> Hello,
> 
> we like to use dovecot, but our old imapd used to store the paths of the
> folder in the file ~/.mailboxlist. This file contains something like
> this:
> 
>     mail/read
>     mail/dovecot
>     .netscape/imap/mailbox
>     .Mail/foo
> 

If it were eventually possible to use this file and add to it a tag of
what type of mailbox it is (mbox or maildir) that'd be cool too.

I know thats Hard(tm) but it would be cool.

:)

-sv



From tss@iki.fi  Thu Feb 27 21:19:15 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 27 Feb 2003 21:19:15 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 94CB02384D
	for <dovecot@procontrol.fi>; Thu, 27 Feb 2003 21:19:15 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id B33E55E01F94; Thu, 27 Feb 2003 21:19:14 +0200 (EET)
Subject: [dovecot] Re: IMAP Folder paths
From: Timo Sirainen <tss@iki.fi>
To: Juergen Kahnert <Juergen.Kahnert@DESY.de>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030227190212.F3097@pcx3332.desy.de>
References: <20030227190212.F3097@pcx3332.desy.de>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1046373554.18310.4.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 27 Feb 2003 21:19:14 +0200
X-archive-position: 337
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 337                                                  
Status: O

On Thu, 2003-02-27 at 20:02, Juergen Kahnert wrote:
> we like to use dovecot, but our old imapd used to store the paths of the
> folder in the file ~/.mailboxlist. This file contains something like
> this:
> 
>     mail/read
>     mail/dovecot
>     .netscape/imap/mailbox
>     .Mail/foo

That's UW-IMAP's subscription list.

> Is there a way to use this files with dovecot? It would be a real pain
> to change this for a few thousand user...

Set "default_mail_env = mbox:~/" and rename those ".mailboxlist" files
to ".subscriptions" file (or modify dovecot's sources to make it use the
.mailboxlist directly).


From kahnert@mail.desy.de  Thu Feb 27 22:21:28 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 27 Feb 2003 22:21:28 +0200 (EET)
Return-Path: <kahnert@mail.desy.de>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1-195.desy.de (mailserver1.desy.de [131.169.87.109])
	by danu.procontrol.fi (Postfix) with ESMTP id 83EFF23839
	for <dovecot@procontrol.fi>; Thu, 27 Feb 2003 22:21:28 +0200 (EET)
Received: from pcx3332.desy.de (pcx3332.desy.de [131.169.214.139])
	by mail1-195.desy.de (8.8.5/8.8.5/R) with ESMTP id VAA29688
	for <dovecot@procontrol.fi>; Thu, 27 Feb 2003 21:21:28 +0100 (MET)
Received: (from kahnert@localhost)
	by pcx3332.desy.de (8.11.3/8.8.5) id h1RKLRF10992
	for dovecot@procontrol.fi; Thu, 27 Feb 2003 21:21:27 +0100
Date: Thu, 27 Feb 2003 21:21:27 +0100
From: Juergen Kahnert <Juergen.Kahnert@DESY.de>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: IMAP Folder paths
Message-ID: <20030227212127.A10927@pcx3332.desy.de>
References: <20030227190212.F3097@pcx3332.desy.de> <1046373554.18310.4.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
User-Agent: Mutt/1.3.16i
In-Reply-To: <1046373554.18310.4.camel@hurina>; from tss@iki.fi on Thu, Feb 27, 2003 at 09:19:14PM +0200
X-archive-position: 338
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: Juergen.Kahnert@DESY.de
Precedence: bulk
X-list: dovecot
X-UID: 338                                                  
Status: O

On Thu, 27. Feb. 2003 at 21:19:14 +0200, Timo Sirainen wrote:
> Set "default_mail_env = mbox:~/" and rename those ".mailboxlist" files
> to ".subscriptions" file (or modify dovecot's sources to make it use the
> .mailboxlist directly).

Yes, that's what I searched for. I guess you'll add something to the
config file to change SUBSCRIPTION_FILE_NAME - but so far I change it in
the source.

And with the new version I'm able to let the inbox in a separate
directory and all other folders in the home directories of the users,
right?

That's perfect. Thanks Timo, good work. :)

    Jürgen Kahnert



From alex@wankwood.com  Sat Mar  1 07:23:48 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 01 Mar 2003 07:23:48 +0200 (EET)
Return-Path: <alex@wankwood.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from net-srv-0001.bvrd.com (mail.bvrd.com [216.216.73.130])
	by danu.procontrol.fi (Postfix) with SMTP id E49D82384D
	for <dovecot@procontrol.fi>; Sat,  1 Mar 2003 07:23:47 +0200 (EET)
Received: (qmail 19396 invoked from network); 28 Feb 2003 23:23:47 -0600
Received: from psn01.birdview.com (HELO net-srv-0001.bvrd.com) (192.168.254.2)
  by psn01.birdview.com with SMTP; 28 Feb 2003 23:23:47 -0600
Date: Fri, 28 Feb 2003 23:23:46 -0600 (CST)
From: Alex Howansky <alex@wankwood.com>
X-X-Sender: alex@net-srv-0001.bvrd.com
To: dovecot@procontrol.fi
Subject: [dovecot] patch for src/auth/db-ldap.c
Message-ID: <Pine.LNX.4.44.0302282321330.16063-100000@net-srv-0001.bvrd.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 339
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: alex@wankwood.com
Precedence: bulk
X-list: dovecot
X-UID: 339                                                  
Status: O


*** src/auth/db-ldap.c.orig     Sat Mar  1 00:20:10 2003
--- src/auth/db-ldap.c  Sat Mar  1 00:20:31 2003
***************
*** 35,42 ****
        DEF(SET_STR, pass_attrs),
        DEF(SET_STR, pass_filter),
        DEF(SET_STR, default_pass_scheme),
!       DEF(SET_STR, user_global_uid),
!       DEF(SET_STR, user_global_gid)
  };

  struct ldap_settings default_ldap_settings = {
--- 35,42 ----
        DEF(SET_STR, pass_attrs),
        DEF(SET_STR, pass_filter),
        DEF(SET_STR, default_pass_scheme),
!       DEF(SET_INT, user_global_uid),
!       DEF(SET_INT, user_global_gid)
  };

  struct ldap_settings default_ldap_settings = {

-- 
Alex Howansky
Wankwood Associates
http://www.wankwood.com/


From dave@tamos.net  Sat Mar  1 20:10:05 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 01 Mar 2003 20:10:05 +0200 (EET)
Return-Path: <dave@tamos.net>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from grue.tamos.net (tamos.net [66.93.83.29])
	by danu.procontrol.fi (Postfix) with ESMTP id 14EEA23839
	for <dovecot@procontrol.fi>; Sat,  1 Mar 2003 20:10:05 +0200 (EET)
Received: (qmail 14197 invoked from network); 1 Mar 2003 18:10:03 -0000
Received: from unknown (HELO ?192.168.1.20?) (dave@66.93.83.29)
  by tamos.net with SMTP; 1 Mar 2003 18:10:03 -0000
Subject: [dovecot] pine/dovecot issues
From: "David E. Storey" <dave@tamos.net>
To: dovecot@procontrol.fi
Content-Type: multipart/signed; micalg=pgp-sha1; protocol="application/pgp-signature"; boundary="=-K94EY0OZnYQ/AgA2IJf8"
Organization: tamos
Message-Id: <1046542211.1240.9.camel@localhost>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 01 Mar 2003 13:10:12 -0500
X-archive-position: 340
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: dave@tamos.net
Precedence: bulk
X-list: dovecot
X-UID: 340                                                  
Status: O
Content-Length: 1683


--=-K94EY0OZnYQ/AgA2IJf8
Content-Type: text/plain
Content-Transfer-Encoding: quoted-printable

Folks,

I'm running into some issues with pine and dovecot. (dovecot is running
mbox for now... plan to switch to maildir soon.) At first I thought it
was a funky issue with the way I was using pine to access mailboxes. (I
use rsh to invoke imap as pre-authenticated so when I switch to
maildirs, I don't have to worry about pine being patched to support it.)
But after switching over to using authenticated IMAP over port 143, it
still had issues.

I'm getting messages like:

Junk in start of group
Not an Address
Junk at end of envelope
Unknown Message property

Thus far, it seems to only occur in pine. (Squirrelmail and evolution
appear to be fine) Is it the client? Is it dovecot? is it easily
fixable? It feels like some sort of escaping issue or parsing issue or
something. I just don't know enough about IMAP to determine exactly what
it is.

I'm using dovecot v0.99.8, MAIL=3Dmbox:%h/Mail/:INBOX=3D%h/.mailbox
I've just converted off of wu-imap in hopes of someday migrating to
maildirs on that box. (anyone know of a good mbox to maildir conversion
tool? I used to have on that worked fine, but I've since found a ton
that don't work well for me at all. I have about a gig of email to
backup and convert)

d!

--=-K94EY0OZnYQ/AgA2IJf8
Content-Type: application/pgp-signature; name=signature.asc
Content-Description: This is a digitally signed message part

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.1 (GNU/Linux)

iD8DBQA+YPeD+5sC2muyxOMRAuZ2AJ9g6te94e6Mp9JVvMueGbgY2rV2AwCdE24Q
3slxocRXfMeMzljC7Lkqeoo=
=JHGo
-----END PGP SIGNATURE-----

--=-K94EY0OZnYQ/AgA2IJf8--


From ianj@ian-justman.com  Sat Mar  1 20:42:43 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 01 Mar 2003 20:42:43 +0200 (EET)
Return-Path: <ianj@ian-justman.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from narshe.chocobo.org (dsl-207-126-72-242.dsl.netasset.net [207.126.72.242])
	by danu.procontrol.fi (Postfix) with ESMTP id 1BE8C2384D
	for <dovecot@procontrol.fi>; Sat,  1 Mar 2003 20:42:43 +0200 (EET)
Received: from ian-justman.com (jidoor.chocobo.org [207.126.72.253])
	by narshe.chocobo.org (Postfix) with ESMTP id B8C7C30FE42
	for <dovecot@procontrol.fi>; Sat,  1 Mar 2003 10:42:39 -0800 (PST)
Message-ID: <3E60FF1F.5020308@ian-justman.com>
Date: Sat, 01 Mar 2003 10:42:39 -0800
From: "Ian R. Justman" <ianj@ian-justman.com>
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.0; en-US; rv:1.0.2) Gecko/20021120 Netscape/7.01
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: dovecot@procontrol.fi
Subject: [dovecot] Re: pine/dovecot issues
References: <1046542211.1240.9.camel@localhost>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 341
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: ianj@ian-justman.com
Precedence: bulk
X-list: dovecot
X-UID: 341                                                  
Status: O
Content-Length: 1592



David E. Storey wrote:
> Folks,
> 
> I'm running into some issues with pine and dovecot. (dovecot is running
> mbox for now... plan to switch to maildir soon.) At first I thought it
> was a funky issue with the way I was using pine to access mailboxes. (I
> use rsh to invoke imap as pre-authenticated so when I switch to
> maildirs, I don't have to worry about pine being patched to support it.)
> But after switching over to using authenticated IMAP over port 143, it
> still had issues.
> 
> I'm getting messages like:
> 
> Junk in start of group
> Not an Address
> Junk at end of envelope
> Unknown Message property
> 
> Thus far, it seems to only occur in pine. (Squirrelmail and evolution
> appear to be fine) Is it the client? Is it dovecot? is it easily
> fixable? It feels like some sort of escaping issue or parsing issue or
> something. I just don't know enough about IMAP to determine exactly what
> it is.

Same here, though the only thing I have observed is that when you get a 
message with just the e-mail address, i.e. no GCOS field, in the To: field, 
the address field in the message list is blank.  Normally with UW IMAP and 
Pine reading the spools directly, it will just happily replace that field 
with just the e-mail address.

Minor thing, but thought I'd bring it up since we are on the topic of Pine 
and Dovecot since this issue only seems to affect Pine.  Though in this 
case, I do not think that the mailstore format is the issue here.  Since I 
also saw a headers section in the config file, it could be a peculiarity 
that could be fixed that way.

--Ian.


From ianj@ian-justman.com  Sat Mar  1 20:47:21 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 01 Mar 2003 20:47:21 +0200 (EET)
Return-Path: <ianj@ian-justman.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from narshe.chocobo.org (dsl-207-126-72-242.dsl.netasset.net [207.126.72.242])
	by danu.procontrol.fi (Postfix) with ESMTP id 0AAF12384D
	for <dovecot@procontrol.fi>; Sat,  1 Mar 2003 20:47:21 +0200 (EET)
Received: from ian-justman.com (jidoor.chocobo.org [207.126.72.253])
	by narshe.chocobo.org (Postfix) with ESMTP id C968030FE42
	for <dovecot@procontrol.fi>; Sat,  1 Mar 2003 10:47:19 -0800 (PST)
Message-ID: <3E610037.9040200@ian-justman.com>
Date: Sat, 01 Mar 2003 10:47:19 -0800
From: "Ian R. Justman" <ianj@ian-justman.com>
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.0; en-US; rv:1.0.2) Gecko/20021120 Netscape/7.01
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: dovecot@procontrol.fi
Subject: [dovecot] Re: pine/dovecot issues
References: <1046542211.1240.9.camel@localhost> <3E60FF1F.5020308@ian-justman.com>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 342
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: ianj@ian-justman.com
Precedence: bulk
X-list: dovecot
X-UID: 342                                                  
Status: O



Ian R. Justman wrote:


> Same here, though the only thing I have observed is that when you get a 
> message with just the e-mail address, i.e. no GCOS field, in the To: 
> field, the address field in the message list is blank.  Normally with UW 
> IMAP and Pine reading the spools directly, it will just happily replace 
> that field with just the e-mail address.

Actually, my bad, the From: field gets this treatment, though the To: field 
gets
affected when I'm sending something to a mailing list and the mailing list
address is the only thing in the To: field on the message coming back.

--Ian.


From stefan@sels.com  Sun Mar  2 21:26:49 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 02 Mar 2003 21:26:49 +0200 (EET)
Return-Path: <stefan@sels.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from dsl-mail.kamp.net (mail.kamp-dsl.de [195.62.99.42])
	by danu.procontrol.fi (Postfix) with SMTP id 67D712384D
	for <dovecot@procontrol.fi>; Sun,  2 Mar 2003 21:26:49 +0200 (EET)
Received: (qmail 23640 invoked by uid 505); 2 Mar 2003 19:26:54 -0000
Received: from stefan@sels.com by dsl-mail by uid 502 with qmail-scanner-1.14 
 (spamassassin: 2.43.  Clear:. 
 Processed in 0.019707 secs); 02 Mar 2003 19:26:54 -0000
Received: from unknown (HELO sels.com) (213.146.112.93)
  by dsl-mail.kamp.net with SMTP; 2 Mar 2003 19:26:54 -0000
Message-ID: <3E625B08.2000209@sels.com>
Date: Sun, 02 Mar 2003 20:27:04 +0100
From: Stefan Sels <stefan@sels.com>
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.2.1) Gecko/20021130
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: dovecot@procontrol.fi
Subject: [dovecot] ldap config
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 343
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: stefan@sels.com
Precedence: bulk
X-list: dovecot
X-UID: 343                                                  
Status: O

Hi,

how do I setup the config to use an ldap server for authentification ?

I tried :
auth_userdb = ldap:/usr/local/dovecot/etc/dovecot-ldap.conf
auth_userdb = ldap:/usr/local/dovecot/etc/
auth_userdb = usr/local/dovecot/etc/dovecot-ldap.conf

however I got an error. What is the correct syntax for the ldap config ?

Regards,
   Stefan Sels




From alex@wankwood.com  Mon Mar  3 01:26:48 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 03 Mar 2003 01:26:48 +0200 (EET)
Return-Path: <alex@wankwood.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from net-srv-0001.bvrd.com (mail.bvrd.com [216.216.73.130])
	by danu.procontrol.fi (Postfix) with SMTP id 800802384D
	for <dovecot@procontrol.fi>; Mon,  3 Mar 2003 01:26:47 +0200 (EET)
Received: (qmail 31340 invoked from network); 2 Mar 2003 17:26:45 -0600
Received: from psn01.birdview.com (HELO net-srv-0001.bvrd.com) (192.168.254.2)
  by psn01.birdview.com with SMTP; 2 Mar 2003 17:26:45 -0600
Date: Sun, 2 Mar 2003 17:26:45 -0600 (CST)
From: Alex Howansky <alex@wankwood.com>
X-X-Sender: alex@net-srv-0001.bvrd.com
To: dovecot@procontrol.fi
Subject: [dovecot] Re: ldap config
In-Reply-To: <3E625B08.2000209@sels.com>
Message-ID: <Pine.LNX.4.44.0303021726040.30744-100000@net-srv-0001.bvrd.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 344
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: alex@wankwood.com
Precedence: bulk
X-list: dovecot
X-UID: 344                                                  
Status: O

> how do I setup the config to use an ldap server for authentification ?
>
> I tried :
> auth_userdb = ldap:/usr/local/dovecot/etc/dovecot-ldap.conf
> auth_userdb = ldap:/usr/local/dovecot/etc/
> auth_userdb = usr/local/dovecot/etc/dovecot-ldap.conf
>
> however I got an error. What is the correct syntax for the ldap config ?

I believe it's:

auth_userdb = ldap /usr/local/etc/dovecot-ldap.conf

-- 
Alex Howansky
Wankwood Associates
http://www.wankwood.com/


From tss@iki.fi  Tue Mar  4 03:09:27 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 04 Mar 2003 03:09:28 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id C9AE32384D
	for <dovecot@procontrol.fi>; Tue,  4 Mar 2003 03:09:27 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 98AE35E01F94; Tue,  4 Mar 2003 03:09:27 +0200 (EET)
Subject: [dovecot] Re: pine/dovecot issues
From: Timo Sirainen <tss@iki.fi>
To: "David E. Storey" <dave@tamos.net>
Cc: dovecot@procontrol.fi
In-Reply-To: <1046542211.1240.9.camel@localhost>
References: <1046542211.1240.9.camel@localhost>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1046740167.18310.1277.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 04 Mar 2003 03:09:27 +0200
X-archive-position: 345
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 345                                                  
Status: O

On Sat, 2003-03-01 at 20:10, David E. Storey wrote:
> I'm getting messages like:
> 
> Junk in start of group
> Not an Address
> Junk at end of envelope
> Unknown Message property

Whops. Looks like I broke it pretty badly in 0.99.8. Several headers
containing '"' and maybe '\' characters will break it. Maybe it's time
for 0.99.9 earlier than I thought.


From tss@iki.fi  Tue Mar  4 03:24:16 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 04 Mar 2003 03:24:16 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id EC9172384D
	for <dovecot@procontrol.fi>; Tue,  4 Mar 2003 03:24:15 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id B38D25E01F94; Tue,  4 Mar 2003 03:24:15 +0200 (EET)
Subject: [dovecot] Re: pine/dovecot issues
From: Timo Sirainen <tss@iki.fi>
To: "Ian R. Justman" <ianj@ian-justman.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <3E610037.9040200@ian-justman.com>
References: <1046542211.1240.9.camel@localhost>
	 <3E60FF1F.5020308@ian-justman.com>  <3E610037.9040200@ian-justman.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1046741055.18310.1281.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 04 Mar 2003 03:24:15 +0200
X-archive-position: 346
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 346                                                  
Status: O

On Sat, 2003-03-01 at 20:47, Ian R. Justman wrote:
> > Same here, though the only thing I have observed is that when you get a 
> > message with just the e-mail address, i.e. no GCOS field, in the To: 
> > field, the address field in the message list is blank.  Normally with UW 
> > IMAP and Pine reading the spools directly, it will just happily replace 
> > that field with just the e-mail address.
> 
> Actually, my bad, the From: field gets this treatment, though the To: field 
> gets
> affected when I'm sending something to a mailing list and the mailing list
> address is the only thing in the To: field on the message coming back.

I don't think this happens with 0.99.8 anymore since I changed Dovecot
to return NIL instead of "" if the name doesn't exist. If you still see
it with old mails that's probably because Dovecot has cached them into
indexes - deleting them would fix it.


From ianj@ian-justman.com  Tue Mar  4 10:17:36 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 04 Mar 2003 10:17:36 +0200 (EET)
Return-Path: <ianj@ian-justman.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from vector.chocobo.org (dsl-207-126-72-243.dsl.netasset.net [207.126.72.243])
	by danu.procontrol.fi (Postfix) with ESMTP id 6AD4023839
	for <dovecot@procontrol.fi>; Tue,  4 Mar 2003 10:17:36 +0200 (EET)
Received: from ian-justman.com (jidoor.chocobo.org [207.126.72.253])
	by vector.chocobo.org (Postfix) with ESMTP id B16AEE2F44A
	for <dovecot@procontrol.fi>; Tue,  4 Mar 2003 00:17:33 -0800 (PST)
Message-ID: <3E64611D.8050301@ian-justman.com>
Date: Tue, 04 Mar 2003 00:17:33 -0800
From: "Ian R. Justman" <ianj@ian-justman.com>
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.0; en-US; rv:1.0.2) Gecko/20021120 Netscape/7.01
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: dovecot@procontrol.fi
Subject: [dovecot] Torture tests
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 347
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: ianj@ian-justman.com
Precedence: bulk
X-list: dovecot
X-UID: 347                                                  
Status: O


Hi, all.

I've been so impressed with Dovecot, I'm in the process of moving my mail 
over to it.  In fact, one of my mailboxes got SO huge, it'll likely 
literally take more than a day to move it all over (in excess of 19,000 
mails, about 140 megabytes).

So far, the IMAP server shows absolutely no sign of crapping out yet.

It should also be noted that I'm moving all this mail out of a Cyrus 
mailstore into an mbox folder on the same server using Pine.

And at work, for my work mail, I recently installed Dovecot 0.99.8, using 
the POP2 port so I can have test it out while not disturbing my coworkers' 
ability to retrieve mail.  So far, I have yet to see anything bad happen.

My IMAP test is taking place under Debian GNU/Linux Woody and my POP3 test 
under FreeBSD 4.7-STABLE.

Though any suggestions in what to keep an eye out for in either case?

--Ian.


From maildump@jp.pp.ru  Tue Mar  4 19:56:27 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 04 Mar 2003 20:29:51 +0200 (EET)
Return-Path: <maildump@jp.pp.ru>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from btp212.dyn.ee (3eea18e5.cable.wanadoo.nl [62.234.24.229])
	by danu.procontrol.fi (Postfix) with ESMTP id 6758023887
	for <dovecot@procontrol.fi>; Tue,  4 Mar 2003 19:56:27 +0200 (EET)
Received: from localhost (localhost [127.0.0.1])
	by btp212.dyn.ee (Postfix) with ESMTP
	id 6914212DC3; Tue,  4 Mar 2003 18:56:14 +0100 (CET)
Received: from btp212.dyn.ee ([127.0.0.1])
 by localhost (btp212.dyn.ee [127.0.0.1:10024]) (amavisd-new) with ESMTP
 id 05753-08; Tue,  4 Mar 2003 18:56:10 +0100 (CET)
Received: from jp.linux (192.168.1.16 [192.168.1.16])
	by btp212.dyn.ee (Postfix) with ESMTP
	id EE57F12D3C; Tue,  4 Mar 2003 18:56:09 +0100 (CET)
Date: Tue, 4 Mar 2003 18:53:07 +0100
From: JP <maildump@jp.pp.ru>
To: dovecot@procontrol.fi
Subject: [dovecot] problem with COPY?
Message-Id: <20030304185307.7c585230.maildump@jp.pp.ru>
Organization: BTP212
X-Mailer: Sylpheed version 0.8.10claws54 (GTK+ 1.2.10; i686-pc-linux-gnu)
X-Face: $%1K|-`ahl(-&?b8PZ2v|;z)#GO&6Hb08DYw[uQwBKh-vQn`i9.tLj{qM!UQ.[r-Cx')J}$
 d^G9AO5~]UPs6hXAq,!nVW?dX3UMv>;'1iU-co{]~
X-Operating-System: Linux 2.4.21pre4-8mdk
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-Scanned: by amavisd-new (spamassassin+clamav) on btp212.dyn.ee
X-archive-position: 348
X-Approved-By: tss@iki.fi
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: maildump@jp.pp.ru
Precedence: bulk
X-list: dovecot
X-UID: 348                                                  
Status: O
Content-Length: 3021

hi all,

I've been trying to use dovecot (from cvs 03.mar.2003, linux 2.2.20,
gcc 2.96, openssl 0.9.7a) as an replacement for uw-imap, and it seems
to be doing its job, except for one thing:

I have my mua (sylpheed-claws from cvs) set up so that it will sort
message into certain(imap) directories. so when I check the mail in the
INBOX, new mails will be processed automatically and, for example spamcop
related emails are moved to their own 'folder'. imap session below.

[STARTTLS and LOGIN stuff not included... no errors whatsoever there.]

[18:06:39] IMAP4< 5 OK Logged in.
[18:06:39] IMAP4> 6 SELECT INBOX
[18:06:40] IMAP4< * FLAGS (\Answered \Flagged \Deleted \Seen \Draft)
[18:06:40] IMAP4< * OK [PERMANENTFLAGS (\Answered \Flagged \Deleted \Seen
\Draft \*)] Flags permitted.
[18:06:40] IMAP4< * 49 EXISTS
[18:06:40] IMAP4< * 3 RECENT
[18:06:40] IMAP4< * OK [UNSEEN 47] First unseen.
[18:06:40] IMAP4< * OK [UIDVALIDITY 1046109663] UIDs valid
[18:06:40] IMAP4< * OK [UIDNEXT 64] Predicted next UID
[18:06:40] IMAP4< 6 OK [READ-WRITE] Select completed.
[18:06:40] IMAP4> 7 UID SEARCH UID 1:*
[18:06:40] IMAP4< * SEARCH 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19
20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 49 52 55 56
57 58 61 62 63
[18:06:40] IMAP4< 7 OK Search completed.
[18:06:40] IMAP4> 8 STATUS INBOX (MESSAGES RECENT UIDNEXT UIDVALIDITY
UNSEEN)
[18:06:40] IMAP4< * STATUS "INBOX" (MESSAGES 49 RECENT 3 UIDNEXT 64
UIDVALIDITY 1046109663 UNSEEN 3)
[18:06:40] IMAP4< 8 OK Status completed.
[18:06:40] IMAP4> 9 UID FETCH 61:63 (UID FLAGS RFC822.SIZE
BODY.PEEK[HEADER.FIELDS (Date From To Cc Newsgroups Subject Message-Id
References In-Reply-To Content-Type Seen Status X-Status From)])
[18:06:40] IMAP4< * 47 FETCH (UID 61 FLAGS (\Recent) RFC822.SIZE 3111
BODY[HEADER.FIELDS (DATE FROM TO CC NEWSGROUPS SUBJECT MESSAGE-ID
REFERENCES IN-REPLY-TO CONTENT-TYPE SEEN STATUS X-STATUS FROM)]
{322}
[18:06:40] IMAP4< * 48 FETCH (UID 62 FLAGS (\Recent) RFC822.SIZE 3111
BODY[HEADER.FIELDS (DATE FROM TO CC NEWSGROUPS SUBJECT MESSAGE-ID
REFERENCES IN-REPLY-TO CONTENT-TYPE SEEN STATUS X-STATUS FROM)]
{322}
[18:06:40] IMAP4< * 49 FETCH (UID 63 FLAGS (\Recent) RFC822.SIZE 3109
BODY[HEADER.FIELDS (DATE FROM TO CC NEWSGROUPS SUBJECT MESSAGE-ID
REFERENCES IN-REPLY-TO CONTENT-TYPE SEEN STATUS X-STATUS FROM)]
{322}
[18:06:40] IMAP4< 9 OK Fetch completed.
[18:06:40] IMAP4> 10 STATUS Spamcop (MESSAGES RECENT UIDNEXT UIDVALIDITY
UNSEEN)
[18:06:40] IMAP4< * STATUS "Spamcop" (MESSAGES 14 RECENT 0 UIDNEXT
51 UIDVALIDITY 1046109859 UNSEEN 0)
[18:06:40] IMAP4< 10 OK Status completed.
[18:06:40] IMAP4> 11 UID COPY 61 Spamcop

now after this, the conenction goes unresponsive and the following appears
in the server log:

Mar  4 18:06:42 btp212 imap(jp): file index-save.c: line 61
(write_with_lf): assertion failed:(size > 0 && size <= SSIZE_T_MAX)
Mar  4 18:06:42 btp212 dovecot: child 6022 (imap) killed with signal 6

any ideas on what might be causing this? dovecot/mua/some else?

regards,

JP

From tss@iki.fi  Tue Mar  4 20:53:43 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 04 Mar 2003 20:53:43 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id A4EA82384D
	for <dovecot@procontrol.fi>; Tue,  4 Mar 2003 20:53:43 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 640225E01F94; Tue,  4 Mar 2003 20:53:43 +0200 (EET)
Subject: [dovecot] Re: problem with COPY?
From: Timo Sirainen <tss@iki.fi>
To: JP <maildump@jp.pp.ru>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030304185307.7c585230.maildump@jp.pp.ru>
References: <20030304185307.7c585230.maildump@jp.pp.ru>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1046804023.20080.1463.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 04 Mar 2003 20:53:43 +0200
X-archive-position: 349
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 349                                                  
Status: O
Content-Length: 1395

On Tue, 2003-03-04 at 19:53, JP wrote:
> I have my mua (sylpheed-claws from cvs)

Just a few comments on that first:

> [18:06:39] IMAP4> 6 SELECT INBOX
..
> [18:06:40] IMAP4> 8 STATUS INBOX (MESSAGES RECENT UIDNEXT UIDVALIDITY
> UNSEEN)

It's not considered good behaviour to ask STATUS of selected mailbox,
some (old?) servers will break with that. There's also not much reason
since the client already received everything except UNSEEN as reply to
SELECT.

> [18:06:40] IMAP4> 9 UID FETCH 61:63 (UID FLAGS RFC822.SIZE
> BODY.PEEK[HEADER.FIELDS (Date From To Cc Newsgroups Subject Message-Id
> References In-Reply-To Content-Type Seen Status X-Status From)])

Why is it asking From twice? Why is it asking Status and X-Status at
all? These are likely to be fields internally used by mbox format and
shouldn't be sent client even if it asks it (well, Dovecot does send
them currently, but it will be fixed). I don't know what generates
Seen-field, but I think that doesn't belong to Sylpheed either.

> Mar  4 18:06:42 btp212 imap(jp): file index-save.c: line 61
> (write_with_lf): assertion failed:(size > 0 && size <= SSIZE_T_MAX)
> Mar  4 18:06:42 btp212 dovecot: child 6022 (imap) killed with signal 6

The message probably hasn't been read yet and Dovecot tries to write
empty Status-header which triggers the assert. Stupid assert, I should
have just ignored if size == 0. Fixed in CVS.


From tss@iki.fi  Tue Mar  4 21:50:41 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 04 Mar 2003 21:50:41 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 3782B23839
	for <dovecot@procontrol.fi>; Tue,  4 Mar 2003 21:50:41 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id F0DEC5E01F94; Tue,  4 Mar 2003 21:50:40 +0200 (EET)
Subject: [dovecot] Re: Torture tests
From: Timo Sirainen <tss@iki.fi>
To: "Ian R. Justman" <ianj@ian-justman.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <3E64611D.8050301@ian-justman.com>
References: <3E64611D.8050301@ian-justman.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1046807440.18310.1500.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 04 Mar 2003 21:50:40 +0200
X-archive-position: 350
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 350                                                  
Status: O

On Tue, 2003-03-04 at 10:17, Ian R. Justman wrote:
> I've been so impressed with Dovecot, I'm in the process of moving my mail 
> over to it.  In fact, one of my mailboxes got SO huge, it'll likely 
> literally take more than a day to move it all over (in excess of 19,000 
> mails, about 140 megabytes).

Well, I have 1,4GB mbox test file with around 367 000 messages :) I also
tested 64bit file support with one >4GB mail file in Maildir. I don't
think the amount of messages or their sizes should affect Dovecot.
Except there's probably a few problems that could happen once UIDs are
close to their maximum value (4GB), have to fix those some day.

> It should also be noted that I'm moving all this mail out of a Cyrus 
> mailstore into an mbox folder on the same server using Pine.
> 
> Though any suggestions in what to keep an eye out for in either case?

Huge mbox files aren't very good idea if you plan to delete old messages
or add new custom flags, they may result in pretty large copying of
data.


From maildump@jp.pp.ru  Wed Mar  5 17:33:54 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 05 Mar 2003 17:33:54 +0200 (EET)
Return-Path: <maildump@jp.pp.ru>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from btp212.dyn.ee (3eea169b.cable.wanadoo.nl [62.234.22.155])
	by danu.procontrol.fi (Postfix) with ESMTP id C06912384D
	for <dovecot@procontrol.fi>; Wed,  5 Mar 2003 17:33:53 +0200 (EET)
Received: from localhost (localhost [127.0.0.1])
	by btp212.dyn.ee (Postfix) with ESMTP id B8FBB12D35
	for <dovecot@procontrol.fi>; Wed,  5 Mar 2003 16:33:50 +0100 (CET)
Received: from btp212.dyn.ee ([127.0.0.1])
 by localhost (btp212.dyn.ee [127.0.0.1:10024]) (amavisd-new) with ESMTP
 id 16251-09 for <dovecot@procontrol.fi>;
 Wed,  5 Mar 2003 16:33:48 +0100 (CET)
Received: from jp.linux (192.168.1.16 [192.168.1.16])
	by btp212.dyn.ee (Postfix) with ESMTP id 2F75312932
	for <dovecot@procontrol.fi>; Wed,  5 Mar 2003 16:33:48 +0100 (CET)
Date: Wed, 5 Mar 2003 16:30:45 +0100
From: JP <maildump@jp.pp.ru>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: problem with COPY?
Message-Id: <20030305163045.10888830.maildump@jp.pp.ru>
In-Reply-To: <1046804023.20080.1463.camel@hurina>
References: <20030304185307.7c585230.maildump@jp.pp.ru>
	<1046804023.20080.1463.camel@hurina>
Organization: BTP212
X-Mailer: Sylpheed version 0.8.10claws80 (GTK+ 1.2.10; i686-pc-linux-gnu)
X-Face: $%1K|-`ahl(-&?b8PZ2v|;z)#GO&6Hb08DYw[uQwBKh-vQn`i9.tLj{qM!UQ.[r-Cx')J}$
 d^G9AO5~]UPs6hXAq,!nVW?dX3UMv>;'1iU-co{]~
X-Operating-System: Linux 2.4.21pre4-8mdk
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-Scanned: by amavisd-new (spamassassin+clamav) on btp212.dyn.ee
X-archive-position: 351
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: maildump@jp.pp.ru
Precedence: bulk
X-list: dovecot
X-UID: 351                                                  
Status: O
Content-Length: 1399

Timo Sirainen <tss@iki.fi>:

> On Tue, 2003-03-04 at 19:53, JP wrote:
> > I have my mua (sylpheed-claws from cvs)
> 
> Just a few comments on that first:
>
> It's not considered good behaviour to ask STATUS of selected mailbox,
> some (old?) servers will break with that. There's also not much reason
> since the client already received everything except UNSEEN as reply to
> SELECT.
> 
> Why is it asking From twice? Why is it asking Status and X-Status at
> all? These are likely to be fields internally used by mbox format and
> shouldn't be sent client even if it asks it (well, Dovecot does send
> them currently, but it will be fixed). I don't know what generates
> Seen-field, but I think that doesn't belong to Sylpheed either.

seems there's still some bugs left to fix in sylpheed-claws too ;-)

as i'm not a developer of sylpheed-claws, i have no clue why it asks for
all those fields, and what it does with the information.

> > Mar  4 18:06:42 btp212 imap(jp): file index-save.c: line 61
> > (write_with_lf): assertion failed:(size > 0 && size <= SSIZE_T_MAX)
> > Mar  4 18:06:42 btp212 dovecot: child 6022 (imap) killed with signal 6
> 
> The message probably hasn't been read yet and Dovecot tries to write
> empty Status-header which triggers the assert. Stupid assert, I should
> have just ignored if size == 0. Fixed in CVS.

indeed, the error is gone. thanks alot.

regards, 

JP

From charlieb-dovecot@e-smith.com  Thu Mar  6 00:14:52 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 06 Mar 2003 00:14:52 +0200 (EET)
Return-Path: <charlieb-dovecot@e-smith.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from nssg.mitel.com (mail.e-smith.com [216.191.234.126])
	by danu.procontrol.fi (Postfix) with SMTP id 7980223839
	for <dovecot@procontrol.fi>; Thu,  6 Mar 2003 00:14:51 +0200 (EET)
Received: (qmail 12159 invoked by uid 404); 5 Mar 2003 22:14:47 -0000
Received: from charlieb-dovecot@e-smith.com by tripe.nssg.mitel.com with qmail-scanner; 05 Mar 2003 17:14:47 -0000
Received: from allspice-core.nssg.mitel.com (HELO e-smith.com) (10.33.16.12)
  by tripe.nssg.mitel.com (10.33.17.11) with SMTP; 05 Mar 2003 22:14:47 -0000
Received: (qmail 21094 invoked by uid 5008); 5 Mar 2003 22:14:47 -0000
Received: from localhost (sendmail-bs@127.0.0.1)
  by localhost with SMTP; 5 Mar 2003 22:14:47 -0000
Date: Wed, 5 Mar 2003 17:14:47 -0500 (EST)
From: Charlie Brady <charlieb-dovecot@e-smith.com>
X-X-Sender: charlieb@allspice.nssg.mitel.com
To: Stuart Krivis <ipswitch@apk.net>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: inetd/xinetd/tcpserver support
In-Reply-To: <8165265.1046276893@[10.1.3.2]>
Message-ID: <Pine.LNX.4.44.0303051709200.22486-100000@allspice.nssg.mitel.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 352
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: charlieb-dovecot@e-smith.com
Precedence: bulk
X-list: dovecot
X-UID: 352                                                  
Status: O
Content-Length: 1415


On Wed, 26 Feb 2003, Stuart Krivis wrote:

> --On Wednesday, February 26, 2003 9:58 AM +0100 Farkas Levente 
> <lfarkas@bnap.hu> wrote:
> 
> > I always prefer standalone daemons, and as we see the tendency is that
> > most server run as standalone (apache, vsftpd, ssh...). at the begining
> > they has (x)inetd version later remove it... IMHO ip/tcp filtering should
> > have done in a firewall or some fitering can be implemented in the
> > standalone server too.. but this is just my 2c:-)
> 
> Services that get heavily used can push inetd to its limits - or beyond. :-)

So avoid inetd. tcpserver does the job very well.

> Standalone is normally better in this case, with sendmail being a common 
> example.

sendmail is not such a good example to quote for anything, especially this 
week.

> >> imap stream tcp nowait root /usr/sbin/tcpd
> >> /usr/local/libexec/dovecot/imap-login imaps stream tcp nowait root
> >> /usr/sbin/tcpd /usr/local/libexec/dovecot/imap-login --ssl
> 
> I don't think this will work for tcpserver. :-)

No, but a run script for using tcpserver would be something like:

#! /bin/sh
exec 2>&1
exec tcpserver \
 -c 100 \
 -u 0 -g 0\
 -l 0 \
 -HDRP \
 0 143 \
 /usr/local/libexec/dovecot/imap-login

> One advantage to using something sitting before the daemon is that you can 
> depend on the other software for certain functionality and keep the daemon 
> simple.

Yep.

--
Charlie


From tss@iki.fi  Thu Mar  6 02:00:17 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 06 Mar 2003 02:00:17 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 99FCF23839
	for <dovecot@procontrol.fi>; Thu,  6 Mar 2003 02:00:17 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id DFFA25E01F94; Thu,  6 Mar 2003 02:00:15 +0200 (EET)
Subject: [dovecot] Re: inetd/xinetd/tcpserver support
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.44.0303051709200.22486-100000@allspice.nssg.mitel.com>
References:
	 <Pine.LNX.4.44.0303051709200.22486-100000@allspice.nssg.mitel.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1046908815.18301.1591.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 06 Mar 2003 02:00:15 +0200
X-archive-position: 353
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 353                                                  
Status: O

On Thu, 2003-03-06 at 00:14, Charlie Brady wrote:
> No, but a run script for using tcpserver would be something like:
> 
> #! /bin/sh
> exec 2>&1
> exec tcpserver \
>  -c 100 \
>  -u 0 -g 0\
>  -l 0 \
>  -HDRP \
>  0 143 \
>  /usr/local/libexec/dovecot/imap-login

Anyone want to try this? CVS has now support for inetd at least. I've
tested that this works:

imap            stream  tcp     nowait  root    /usr/sbin/tcpd /usr/local/libexec/dovecot/imap-login
imaps           stream  tcp     nowait  root    /usr/sbin/tcpd /usr/local/libexec/dovecot/imap-login --ssl
pop3            stream  tcp     nowait  root    /usr/sbin/tcpd /usr/local/libexec/dovecot/pop3-login
pop3s           stream  tcp     nowait  root    /usr/sbin/tcpd /usr/local/libexec/dovecot/pop3-login --ssl

There's also optional --group parameter to specify which one of the
"login = xx" sections in config file to use. Hmm. Maybe I should add
parameter to specify path for config file as well..


From lfarkas@bnap.hu  Thu Mar  6 14:25:45 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 06 Mar 2003 14:25:45 +0200 (EET)
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id B3A7223839
	for <dovecot@procontrol.fi>; Thu,  6 Mar 2003 14:25:45 +0200 (EET)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id 69404754024
	for <dovecot@procontrol.fi>; Thu,  6 Mar 2003 13:25:44 +0100 (CET)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id AED7D3EFB
	for <dovecot@procontrol.fi>; Thu,  6 Mar 2003 13:25:41 +0100 (CET)
Message-ID: <3E673E4E.2070407@bnap.hu>
Date: Thu, 06 Mar 2003 13:25:50 +0100
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.3b) Gecko/20030211
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: [dovecot] ldap support
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 354
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 354                                                  
Status: O

hi,
it seem to me that dovecot support only v2 ldap protocol but openldap2.1 
support only v3 (or you can enable v2 in the conf file, but it seems 
they wouldn't like to support it in the future). will dovecot support v3 
ldap protocal?
thanks.

-- 
   Levente                               "Si vis pacem para bellum!"



From tss@iki.fi  Thu Mar  6 15:20:33 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 06 Mar 2003 15:20:33 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id C2FD52384D
	for <dovecot@procontrol.fi>; Thu,  6 Mar 2003 15:20:32 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 24CCD5E01F94; Thu,  6 Mar 2003 15:20:32 +0200 (EET)
Subject: [dovecot] Re: ldap support
From: Timo Sirainen <tss@iki.fi>
To: Farkas Levente <lfarkas@bnap.hu>
Cc: Dovecot List <dovecot@procontrol.fi>
In-Reply-To: <3E673E4E.2070407@bnap.hu>
References: <3E673E4E.2070407@bnap.hu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1046956831.943.24.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 06 Mar 2003 15:20:31 +0200
X-archive-position: 355
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 355                                                  
Status: O

On Thu, 2003-03-06 at 14:25, Farkas Levente wrote:
> it seem to me that dovecot support only v2 ldap protocol but openldap2.1 
> support only v3 (or you can enable v2 in the conf file, but it seems 
> they wouldn't like to support it in the future). will dovecot support v3 
> ldap protocal?

Why do you think it supports only v2? I don't really know what their
difference is, but it should be v3.


From lfarkas@bnap.hu  Thu Mar  6 17:42:25 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 06 Mar 2003 17:42:25 +0200 (EET)
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 898FB23839
	for <dovecot@procontrol.fi>; Thu,  6 Mar 2003 17:42:25 +0200 (EET)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id E626B754011
	for <dovecot@procontrol.fi>; Thu,  6 Mar 2003 16:42:26 +0100 (CET)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id A63F03EE4
	for <dovecot@procontrol.fi>; Thu,  6 Mar 2003 16:42:24 +0100 (CET)
Message-ID: <3E676C6B.9070802@bnap.hu>
Date: Thu, 06 Mar 2003 16:42:35 +0100
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.3b) Gecko/20030211
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: [dovecot] Re: ldap support
References: <3E673E4E.2070407@bnap.hu> <1046956831.943.24.camel@hurina>
In-Reply-To: <1046956831.943.24.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 356
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 356                                                  
Status: O

Timo Sirainen wrote:
> On Thu, 2003-03-06 at 14:25, Farkas Levente wrote:
> 
>>it seem to me that dovecot support only v2 ldap protocol but openldap2.1 
>>support only v3 (or you can enable v2 in the conf file, but it seems 
>>they wouldn't like to support it in the future). will dovecot support v3 
>>ldap protocal?
> 
> 
> Why do you think it supports only v2? I don't really know what their
> difference is, but it should be v3.

for log file:
-------------------------
Mar  3 23:02:51 atom dovecot-auth: LDAP: ldap_simple_bind_s() failed (dn 
cn=proxyuser, ou=People, dc=bnap, dc=hu): Protocol error
-------------------------
and when I add allow bind_v2 to slapd.conf the error message disappear...


-- 
   Levente                               "Si vis pacem para bellum!"



From dave@tamos.net  Thu Mar  6 18:08:41 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 06 Mar 2003 18:08:41 +0200 (EET)
Return-Path: <dave@tamos.net>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from grue.tamos.net (tamos.net [66.93.83.29])
	by danu.procontrol.fi (Postfix) with ESMTP id A78E423839
	for <dovecot@procontrol.fi>; Thu,  6 Mar 2003 18:08:40 +0200 (EET)
Received: (qmail 10063 invoked from network); 6 Mar 2003 16:08:38 -0000
Received: from unknown (HELO ws229.mclean.va.suprtek.com) (dave@66.93.83.29)
  by tamos.net with SMTP; 6 Mar 2003 16:08:38 -0000
Subject: [dovecot] Re: ldap support
From: "David E. Storey" <dave@tamos.net>
To: dovecot@procontrol.fi
In-Reply-To: <3E676C6B.9070802@bnap.hu>
References: <3E673E4E.2070407@bnap.hu> <1046956831.943.24.camel@hurina>
	 <3E676C6B.9070802@bnap.hu>
Content-Type: multipart/signed; micalg=pgp-sha1; protocol="application/pgp-signature"; boundary="=-EiDOiePtZqWbOu1Ad13l"
Organization: tamos
Message-Id: <1046966947.26387.27.camel@localhost>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.1 
Date: 06 Mar 2003 11:09:07 -0500
X-archive-position: 357
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: dave@tamos.net
Precedence: bulk
X-list: dovecot
X-UID: 357                                                  
Status: O
Content-Length: 1295


--=-EiDOiePtZqWbOu1Ad13l
Content-Type: text/plain
Content-Transfer-Encoding: quoted-printable

I think it would be trivial to make dovecot support LDAPv3.

All it would entail is modifying ldap_conn_open() in src/auth/db-ldap.c.

code might look something like:

	int version =3D LDAP_VERSION3;
        if (ldap_set_option (conn->ld, LDAP_OPT_PROTOCOL_VERSION,
		&version)!=3D LDAP_OPT_SUCCESS)
        {
		i_fatal ("could not set LDAP_OPT_PROTOCOL_VERSION %d", 			version);
        }

How Timo would want to integrate with configuration is up to him. But at
any rate, if you really NEED LDAPv3, you now have it.

d!

On Thu, 2003-03-06 at 10:42, Farkas Levente wrote:
> >>it seem to me that dovecot support only v2 ldap protocol but openldap2.=
1=20
> >>support only v3 (or you can enable v2 in the conf file, but it seems=20
> >>they wouldn't like to support it in the future). will dovecot support v=
3=20
> >>ldap protocal?

--=-EiDOiePtZqWbOu1Ad13l
Content-Type: application/pgp-signature; name=signature.asc
Content-Description: This is a digitally signed message part

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.1 (GNU/Linux)

iD8DBQA+Z3Kj+5sC2muyxOMRAiv4AJ9HBwRiiqhsY1QiNqhdzuuPx0dM6QCeOFWp
cHf8c16tWXgmPyEYWqnwiY4=
=kBxS
-----END PGP SIGNATURE-----

--=-EiDOiePtZqWbOu1Ad13l--


From cras@irccrew.org  Thu Mar  6 18:16:06 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 06 Mar 2003 18:16:06 +0200 (EET)
Return-Path: <cras@irccrew.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from shodan.irccrew.org (shodan [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id D60FF23839
	for <dovecot@procontrol.fi>; Thu,  6 Mar 2003 18:16:06 +0200 (EET)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id 310F04C0A0; Thu,  6 Mar 2003 18:16:06 +0200 (EET)
Date: Thu, 6 Mar 2003 18:16:06 +0200
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: ldap support
Message-ID: <20030306161606.GB9016@irccrew.org>
References: <3E673E4E.2070407@bnap.hu> <1046956831.943.24.camel@hurina> <3E676C6B.9070802@bnap.hu> <1046966947.26387.27.camel@localhost>
Mime-Version: 1.0
Content-Disposition: inline
In-Reply-To: <1046966947.26387.27.camel@localhost>
User-Agent: Mutt/1.4i
Content-Type: text/plain; charset=us-ascii
X-archive-position: 358
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 358                                                  
Status: O

On Thu, Mar 06, 2003 at 11:09:07AM -0500, David E. Storey wrote:
> I think it would be trivial to make dovecot support LDAPv3.
..

Thanks, I thought v3 was default since it's already years old. I'll add
option for it to config file.


From scott@xs4all.net  Thu Mar  6 19:49:53 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 06 Mar 2003 19:49:53 +0200 (EET)
Return-Path: <scott@xs4all.net>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from trouble.oink.org (trouble.oink.org [194.109.215.226])
	by danu.procontrol.fi (Postfix) with ESMTP id AFA0B23839
	for <dovecot@procontrol.fi>; Thu,  6 Mar 2003 19:49:52 +0200 (EET)
Received: from xs4all.net (vla.gotsiedikkie.nl [194.109.29.21])
	by trouble.oink.org (Postfix) with ESMTP id 40C7F3EBC
	for <dovecot@procontrol.fi>; Thu,  6 Mar 2003 18:49:51 +0100 (CET)
Date: Thu, 6 Mar 2003 18:49:51 +0100
Mime-Version: 1.0 (Apple Message framework v551)
Content-Type: text/plain; charset=US-ASCII; format=flowed
Subject: [dovecot] OSX & Authentication
From: Scott A.McIntyre <scott@xs4all.net>
To: dovecot@procontrol.fi
Content-Transfer-Encoding: 7bit
Message-Id: <07F59BBE-4FFC-11D7-9568-000393AC9622@xs4all.net>
X-Mailer: Apple Mail (2.551)
X-archive-position: 359
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: scott@xs4all.net
Precedence: bulk
X-list: dovecot
X-UID: 359                                                  
Status: O
Content-Length: 1307

Hi,

Taking a stab at getting OSX Server 10.2.4 running Dovecot -- with a 
minor tweak of replacing lchown() with chown() in the 
src/lib/sakfe-mkdir.c, it compiled and installed without any problems.

However, oddness in authentication.  It works once, but only once.  I'm 
trying to use pam and have the following:

auth       required     pam_securityserver.so
auth       sufficient     pam_unix.so
account    required       pam_unix.so

In the dovecot.conf I have (amongst other things):

auth_userdb = passwd
auth_passdb = pam

I start up dovecot and do:

Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
* OK dovecot ready.
. login scott pass
. OK Logged in.
. logout
* BYE Logging out
. OK Logout completed.

No problem.

However, try it again and:

Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
* OK dovecot ready.
. login scott pass
. NO Authentication failed.
. logout
* BYE Logging out
. OK Logout completed.



Perhaps there's a better way to get dovecot playing under osx; I'd 
tried a number of ways of using pam, but perhaps there's a magic other 
option I've not got working yet.  I do run the password server and my 
account name is using that as per the Workgroup Manager's settings (as 
opposed to Basic)...

Any thoughts appreciated!

Scott


From alex@wankwood.com  Thu Mar  6 21:32:02 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 06 Mar 2003 21:32:02 +0200 (EET)
Return-Path: <alex@wankwood.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from net-srv-0001.bvrd.com (mail.bvrd.com [216.216.73.130])
	by danu.procontrol.fi (Postfix) with SMTP id 4C3E12384D
	for <dovecot@procontrol.fi>; Thu,  6 Mar 2003 21:32:01 +0200 (EET)
Received: (qmail 31019 invoked from network); 6 Mar 2003 13:31:55 -0600
Received: from psn01.birdview.com (HELO net-srv-0001.bvrd.com) (192.168.254.2)
  by psn01.birdview.com with SMTP; 6 Mar 2003 13:31:55 -0600
Date: Thu, 6 Mar 2003 13:31:55 -0600 (CST)
From: Alex Howansky <alex@wankwood.com>
X-X-Sender: alex@net-srv-0001.bvrd.com
To: dovecot@procontrol.fi
Subject: [dovecot] PostgreSQL support
In-Reply-To: <1046908815.18301.1591.camel@hurina>
Message-ID: <Pine.LNX.4.44.0303061313180.26816-100000@net-srv-0001.bvrd.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 360
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: alex@wankwood.com
Precedence: bulk
X-list: dovecot
X-UID: 360                                                  
Status: O
Content-Length: 1240


Timo,

I've written passdb and userdb modules for PostgreSQL. My C skills aren't that
great, so I borrowed heavily from the LDAP modules, and I've never developed
with automake/autoconf before, so I don't know how acceptable my patch to
configure.in is. Anyway, it seems to work ok but I haven't done really heavy
testing. If you can get past my poor C skills, I hope you will at least find my
work useful as a base to expand from.

The patch supports arbitrary queries which can use the %h/%n/%d macros, so
there's no need to have specific table or field names. For example, in the
configuration file, you'd specify something like:

password_query = select password from users where userid = '%u'

Like the LDAP module, it supports PLAIN, PLAIN-MD5, DIGEST-MD5, and CRYPT. It
also tries to be secure by immediately rejecting any auth attempts that don't
fit a very strict format. If the user-provided data contains any non-standard
characters, the query returns more than one row, etc., auth will immediately
fail.

Are you interested in my patch, and if so, how should I send it? Does the list
accept attachments? (The patch is against current CVS, by the way.)

Regards,

-- 
Alex Howansky
Wankwood Associates
http://www.wankwood.com/


From tss@iki.fi  Thu Mar  6 21:58:50 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 06 Mar 2003 21:58:50 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 5CA9A23839
	for <dovecot@procontrol.fi>; Thu,  6 Mar 2003 21:58:50 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 8A04E5E01F94; Thu,  6 Mar 2003 21:58:49 +0200 (EET)
Subject: [dovecot] Re: PostgreSQL support
From: Timo Sirainen <tss@iki.fi>
To: Alex Howansky <alex@wankwood.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.44.0303061313180.26816-100000@net-srv-0001.bvrd.com>
References: <Pine.LNX.4.44.0303061313180.26816-100000@net-srv-0001.bvrd.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1046980729.931.47.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 06 Mar 2003 21:58:49 +0200
X-archive-position: 361
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 361                                                  
Status: O
Content-Length: 1287

On Thu, 2003-03-06 at 21:31, Alex Howansky wrote:
> I've written passdb and userdb modules for PostgreSQL. My C skills aren't that
> great, so I borrowed heavily from the LDAP modules, and I've never developed
> with automake/autoconf before, so I don't know how acceptable my patch to
> configure.in is. Anyway, it seems to work ok but I haven't done really heavy
> testing. If you can get past my poor C skills, I hope you will at least find my
> work useful as a base to expand from.

My plans for SQL support was to create a simple SQL wrapper library so
that there wouldn't have to be multiple separate authentication modules
for different SQL databases. The same library could be used also by SQL
mail database code once I get around writing that.

But since I haven't managed to write either one yet, I could include
separate pgsql auth module for now. And I'd guess that code could be
later just modified to use the SQL library instead of direct pgsql calls
and renamed to be generic SQL auth module.

> Are you interested in my patch, and if so, how should I send it? Does the list
> accept attachments? (The patch is against current CVS, by the way.)

List accepts attachments, but I'm not sure if anyone else here but me
cares about it :) So "cvs diff -u" and mail it to me.


From oskar@mail.solls.net  Thu Mar  6 21:59:14 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 06 Mar 2003 21:59:14 +0200 (EET)
Return-Path: <oskar@mail.solls.net>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from a.mx.solls.net (puffy.solls.net [212.87.130.100])
	by danu.procontrol.fi (Postfix) with SMTP id E73A723839
	for <dovecot@procontrol.fi>; Thu,  6 Mar 2003 21:59:12 +0200 (EET)
Received: (qmail 7062 invoked from network); 6 Mar 2003 19:59:06 -0000
Received: from unknown (HELO mail.solls.net) (127.0.0.1)
  by puffy.solls.net with SMTP; 6 Mar 2003 19:59:06 -0000
Received: from 217.81.141.223
        (SquirrelMail authenticated user oskar@mail.solls.net)
        by www.solls.net with HTTP;
        Thu, 6 Mar 2003 20:59:06 +0100 (CET)
Message-ID: <57801.217.81.141.223.1046980746.squirrel@www.solls.net>
Date: Thu, 6 Mar 2003 20:59:06 +0100 (CET)
Subject: [dovecot] vpopmail auth failure
From: "Oskar Eyb" <oskar@mail.solls.net>
To: <dovecot@procontrol.fi>
X-Priority: 3
Importance: Normal
X-Mailer: SquirrelMail (version 1.2.10)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: 8bit
X-archive-position: 362
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: oskar@mail.solls.net
Precedence: bulk
X-list: dovecot
X-UID: 362                                                  
Status: O

hello!


when is try to use IMP with dovecot and vpopmail i receive the following
error-msg:

dovecot-auth: Mar 06 20:43:24 Info: vpopmail(test@$DOMAIN): unknown user

But this user exists!
Where i can search for the mistake?

Greets,
Oskar



From tss@iki.fi  Thu Mar  6 23:08:34 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 06 Mar 2003 23:08:34 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 1BC2F2384D
	for <dovecot@procontrol.fi>; Thu,  6 Mar 2003 23:08:34 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 587DE5E01F94; Thu,  6 Mar 2003 23:08:33 +0200 (EET)
Subject: [dovecot] Re: vpopmail auth failure
From: Timo Sirainen <tss@iki.fi>
To: Oskar Eyb <oskar@mail.solls.net>
Cc: dovecot@procontrol.fi
In-Reply-To: <57801.217.81.141.223.1046980746.squirrel@www.solls.net>
References: <57801.217.81.141.223.1046980746.squirrel@www.solls.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1046984913.937.53.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 06 Mar 2003 23:08:33 +0200
X-archive-position: 363
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 363                                                  
Status: O

On Thu, 2003-03-06 at 21:59, Oskar Eyb wrote:
> when is try to use IMP with dovecot and vpopmail i receive the following
> error-msg:
> 
> dovecot-auth: Mar 06 20:43:24 Info: vpopmail(test@$DOMAIN): unknown user
> 
> But this user exists!
> Where i can search for the mistake?

It looks like your client is trying to log in with username
"test@$DOMAIN" .. do you really have domain named "$DOMAIN"? Dovecot at
least hasn't added it.


From tss@iki.fi  Thu Mar  6 23:15:50 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 06 Mar 2003 23:15:51 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id C51B62384D
	for <dovecot@procontrol.fi>; Thu,  6 Mar 2003 23:15:50 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 94FF85E01F94; Thu,  6 Mar 2003 23:15:50 +0200 (EET)
Subject: [dovecot] Re: OSX & Authentication
From: Timo Sirainen <tss@iki.fi>
To: "Scott A.McIntyre" <scott@xs4all.net>
Cc: dovecot@procontrol.fi
In-Reply-To: <07F59BBE-4FFC-11D7-9568-000393AC9622@xs4all.net>
References: <07F59BBE-4FFC-11D7-9568-000393AC9622@xs4all.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1046985350.937.60.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 06 Mar 2003 23:15:50 +0200
X-archive-position: 364
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 364                                                  
Status: O

On Thu, 2003-03-06 at 19:49, Scott A.McIntyre wrote:
> Taking a stab at getting OSX Server 10.2.4 running Dovecot -- with a 
> minor tweak of replacing lchown() with chown() in the 
> src/lib/sakfe-mkdir.c, it compiled and installed without any problems.

This is fixed in CVS.

> However, oddness in authentication.  It works once, but only once.  I'm 
> trying to use pam and have the following:

Can you login with another user name? What if you kill dovecot-auth
process, does that reset it so that you can login again?

> auth       required     pam_securityserver.so

What does this do? Does it contain user login limits of any kind? Just
thinking if something is waiting for the process that did PAM checking
to terminate before allowing to login again..

> . NO Authentication failed.

Setting "auth_verbose = yes" in config file would give better error
message.


From mem@mv.mv.com  Thu Mar  6 23:52:14 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 06 Mar 2003 23:52:14 +0200 (EET)
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id B6C6223839
	for <dovecot@procontrol.fi>; Thu,  6 Mar 2003 23:52:11 +0200 (EET)
Received: (qmail 17312 invoked by uid 101); 6 Mar 2003 16:52:08 -0500
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Thu, 6 Mar 2003 16:52:08 -0500
To: dovecot@procontrol.fi
Subject: [dovecot] Re: IMAP Folder paths
Message-ID: <20030306165208.F14976@iridium.mv.net>
References: <20030227190212.F3097@pcx3332.desy.de> <1046373554.18310.4.camel@hurina> <20030227212127.A10927@pcx3332.desy.de>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
In-Reply-To: <20030227212127.A10927@pcx3332.desy.de>; from Juergen.Kahnert@DESY.de on Thu, Feb 27, 2003 at 09:21:27PM +0100
X-archive-position: 365
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mem@mv.mv.com
Precedence: bulk
X-list: dovecot
X-UID: 365                                                  
Status: O
Content-Length: 1412

On Thu, Feb 27, 2003 at 09:21:27PM +0100, Juergen Kahnert wrote:
> On Thu, 27. Feb. 2003 at 21:19:14 +0200, Timo Sirainen wrote:
> > Set "default_mail_env = mbox:~/" and rename those ".mailboxlist" files
> > to ".subscriptions" file (or modify dovecot's sources to make it use the
> > .mailboxlist directly).
> 
> Yes, that's what I searched for. I guess you'll add something to the
> config file to change SUBSCRIPTION_FILE_NAME - but so far I change it in
> the source.
> 
> And with the new version I'm able to let the inbox in a separate
> directory and all other folders in the home directories of the users,
> right?

That's also what I'd hope for, but so far don't seem to see the solution.
Just to step back:

The notion of having the ~/Maildir/ be both a mailbox and the root of
the folder tree is interesting (I understand it's not unique to dovecot),
but limiting.  Ideally I would like to be able to specify:

 - the default inbox (e.g. ~/Maildir/ or ~/Mailbox or /var/mail/user
   or whatever)

 - multiple paths to folder directories (e.g. ~/Mail or ~/Private or
   ~/Work/Mail or ~/Maildir/ or simply set it to ~/ and let the user
   browse their own home directory through an IMAP client and set up
   their own subscription).

 - have the imap server autorecognize the format of any mail folder that
   the client directs it to look at.

Can this be done?  Have I missed something?

Yours,
-mm-

From oskar@mail.solls.net  Fri Mar  7 00:01:06 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 07 Mar 2003 00:01:06 +0200 (EET)
Return-Path: <oskar@mail.solls.net>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from a.mx.solls.net (puffy.solls.net [212.87.130.100])
	by danu.procontrol.fi (Postfix) with SMTP id 3C1D523839
	for <dovecot@procontrol.fi>; Fri,  7 Mar 2003 00:01:06 +0200 (EET)
Received: (qmail 26229 invoked from network); 6 Mar 2003 22:00:59 -0000
Received: from unknown (HELO mail.solls.net) (127.0.0.1)
  by puffy.solls.net with SMTP; 6 Mar 2003 22:00:59 -0000
Received: from 217.81.136.209
        (SquirrelMail authenticated user oskar@mail.solls.net)
        by www.solls.net with HTTP;
        Thu, 6 Mar 2003 23:00:59 +0100 (CET)
Message-ID: <54514.217.81.136.209.1046988059.squirrel@www.solls.net>
Date: Thu, 6 Mar 2003 23:00:59 +0100 (CET)
Subject: [dovecot] Re: vpopmail auth failure
From: "Oskar Eyb" <oskar@mail.solls.net>
To: <tss@iki.fi>
In-Reply-To: <1046984913.937.53.camel@hurina>
References: <57801.217.81.141.223.1046980746.squirrel@www.solls.net>
        <1046984913.937.53.camel@hurina>
X-Priority: 3
Importance: Normal
Cc: <dovecot@procontrol.fi>
X-Mailer: SquirrelMail (version 1.2.10)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: 8bit
X-archive-position: 366
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: oskar@mail.solls.net
Precedence: bulk
X-list: dovecot
X-UID: 366                                                  
Status: O


Timo Sirainen sagte:

> It looks like your client is trying to log in with username
> "test@$DOMAIN" .. do you really have domain named "$DOMAIN"? Dovecot at
> least hasn't added it.

oh sorry, i've replaced the real domain name with $DOMAIN.
So the username seems to be correkt.

-- 
Oskar



From scott@xs4all.net  Fri Mar  7 00:07:38 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 07 Mar 2003 00:07:38 +0200 (EET)
Return-Path: <scott@xs4all.net>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from trouble.oink.org (trouble.oink.org [194.109.215.226])
	by danu.procontrol.fi (Postfix) with ESMTP id BBB7323839
	for <dovecot@procontrol.fi>; Fri,  7 Mar 2003 00:07:38 +0200 (EET)
Received: from xs4all.net (vla.gotsiedikkie.nl [194.109.29.21])
	by trouble.oink.org (Postfix) with ESMTP
	id C23323EBC; Thu,  6 Mar 2003 23:07:37 +0100 (CET)
Date: Thu, 6 Mar 2003 23:07:37 +0100
Subject: [dovecot] Re: OSX & Authentication
Content-Type: text/plain; charset=US-ASCII; format=flowed
Mime-Version: 1.0 (Apple Message framework v551)
Cc: dovecot@procontrol.fi
To: Timo Sirainen <tss@iki.fi>
From: Scott A.McIntyre <scott@xs4all.net>
In-Reply-To: <1046985350.937.60.camel@hurina>
Message-Id: <0AAFC2BE-5020-11D7-9568-000393AC9622@xs4all.net>
Content-Transfer-Encoding: 7bit
X-Mailer: Apple Mail (2.551)
X-archive-position: 367
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: scott@xs4all.net
Precedence: bulk
X-list: dovecot
X-UID: 367                                                  
Status: O
Content-Length: 1880

>
> Can you login with another user name? What if you kill dovecot-auth
> process, does that reset it so that you can login again?

No -- once dovecot-auth gets a failure back, it repeats failures for 
any other account logins.  If I kill it and try to login again, it will 
work once, then same problem.


>> auth       required     pam_securityserver.so
>
> What does this do? Does it contain user login limits of any kind? Just
> thinking if something is waiting for the process that did PAM checking
> to terminate before allowing to login again..

I stole that from the pam entry for SSH -- however, your questions got 
me thinking.  I changed it to:

auth       required       pam_unix.so
auth       sufficient     pam_netinfo.so
account    required       pam_unix.so

And this will work, repeatedly, for accounts which are set to "Basic" 
authentication and not the password server; the Security Server (same 
thing as Password Server, I believe) is the element that controls 
minimum password length, validity period, etc.

However, for a different account, which was converted to Password 
Server from Basic and then converted back again, I'm still unable to 
authenticate more than once.



>
>> . NO Authentication failed.
>
> Setting "auth_verbose = yes" in config file would give better error
> message.


Not during telnet, however, in the mail logs:

Mar  6 21:41:55 alles imap-login: Login: scott [127.0.0.1]
Mar  6 22:42:13 alles dovecot-auth: PAM unable to resolve symbol: 
pam_sm_authenticate
Mar  6 22:42:13 alles dovecot-auth: PAM unable to resolve symbol: 
pam_sm_setcred
Mar  6 22:42:13 alles dovecot-auth: PAM: pam_authenticate(scott) 
failed: Authentication failure
Mar  6 21:42:14 alles imap-login: Aborted login [127.0.0.1]

It would seem that the problem is tied up with how OSX and Pam and the 
Security server work -- I'll keep poking at it.

Scott


From tss@iki.fi  Fri Mar  7 01:35:16 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 07 Mar 2003 01:35:16 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 83D322384D
	for <dovecot@procontrol.fi>; Fri,  7 Mar 2003 01:35:16 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 413165E01F94; Fri,  7 Mar 2003 01:35:16 +0200 (EET)
Subject: [dovecot] Re: vpopmail auth failure
From: Timo Sirainen <tss@iki.fi>
To: Oskar Eyb <oskar@mail.solls.net>
Cc: dovecot@procontrol.fi
In-Reply-To: <54514.217.81.136.209.1046988059.squirrel@www.solls.net>
References: <57801.217.81.141.223.1046980746.squirrel@www.solls.net>
	 <1046984913.937.53.camel@hurina>
	 <54514.217.81.136.209.1046988059.squirrel@www.solls.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1046993715.931.109.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 07 Mar 2003 01:35:16 +0200
X-archive-position: 368
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 368                                                  
Status: O
Content-Length: 1245

On Fri, 2003-03-07 at 00:00, Oskar Eyb wrote:
> > It looks like your client is trying to log in with username
> > "test@$DOMAIN" .. do you really have domain named "$DOMAIN"? Dovecot at
> > least hasn't added it.
> 
> oh sorry, i've replaced the real domain name with $DOMAIN.
> So the username seems to be correkt.

Well, unless I've somehow broken vpopmail support, the problem is
somewhere in vpopmail side. You could also try if this patch shows
different user@domain in log file:


Index: userdb-vpopmail.c
===================================================================
RCS file: /home/cvs/dovecot/src/auth/userdb-vpopmail.c,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- userdb-vpopmail.c   18 Feb 2003 19:11:26 -0000      1.4
+++ userdb-vpopmail.c   6 Mar 2003 23:31:43 -0000       1.5
@@ -34,8 +34,10 @@
 
        vpw = vauth_getpw(vpop_user, vpop_domain);
        if (vpw == NULL) {
-               if (verbose)
-                       i_info("vpopmail(%s): unknown user", user);
+               if (verbose) {
+                       i_info("vpopmail(%s): unknown user (%s@%s)",
+                              user, vpop_user, vpop_domain);
+               }
                return NULL;
        }
 

From tss@iki.fi  Fri Mar  7 01:58:42 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 07 Mar 2003 01:58:42 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 6192023839
	for <dovecot@procontrol.fi>; Fri,  7 Mar 2003 01:58:42 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 2669A5E01F94; Fri,  7 Mar 2003 01:58:42 +0200 (EET)
Subject: [dovecot] Dovecot plans [was: IMAP Folder paths]
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030306165208.F14976@iridium.mv.net>
References: <20030227190212.F3097@pcx3332.desy.de>
	 <1046373554.18310.4.camel@hurina> <20030227212127.A10927@pcx3332.desy.de>
	 <20030306165208.F14976@iridium.mv.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1046995121.931.134.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 07 Mar 2003 01:58:41 +0200
X-archive-position: 369
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 369                                                  
Status: O
Content-Length: 1704

On Thu, 2003-03-06 at 23:52, Mark E. Mallett wrote:
> The notion of having the ~/Maildir/ be both a mailbox and the root of
> the folder tree is interesting (I understand it's not unique to dovecot),
> but limiting.  Ideally I would like to be able to specify:
..
> Can this be done?  Have I missed something?

Not yet, but they will once I add namespace configuration to config
file.

My Dovecot plans go something like:

0.99.9:
 - should come out ASAP because of ENVELOPE/BODYSTRUCTURE quoting bug
and SEARCH crashing in some conditions
 - I should store UIDs permanently somewhere else besides indexes
    - CVS already supports X-UID headers in mbox
    - I'd just have to make Courier-like uid database file, also
optionally using filename:2,flags,Uuid or filename,U=uid:2,flags style
 - LIST with Maildir is still a bit buggy. Either do a kludgy fix or
rewrite the whole thing once more.

0.99.10:
 - Version numbers got too high too soon :) I should rather be in 0.8..
 - Now that UIDs are stored permanently, I'm fully free to change the
index file format in any way I want. There's several optimizations that
I have in mind.
 - Much more optimized mbox rewriting, which requires a few index file
modifications
 - Several mbox-internal headers shouldn't be sent to client. To do this
fast, their locations should be stored to index
 - New config file format
 - Namespace support

0.99.11:
 - hopefully the large changes stop here and I could get towards 1.0..

1.0:
 - There hasn't been known bugs for at least a few months
 - I've fully audited the source code at least a few times and I'm sure
it doesn't have a single security hole in it :)

1.1:
 - Shared folders with ACL support
 - quota


From rueckert@informatik.uni-rostock.de  Fri Mar  7 02:43:08 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 07 Mar 2003 02:43:09 +0200 (EET)
Return-Path: <rueckert@informatik.uni-rostock.de>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from monsters.dnsalias.net (vpn018071.uni-rostock.de [139.30.18.71])
	by danu.procontrol.fi (Postfix) with ESMTP id DA1FA2384D
	for <dovecot@procontrol.fi>; Fri,  7 Mar 2003 02:43:08 +0200 (EET)
Received: by monsters.dnsalias.net (Postfix, from userid 500)
	id F08951441E6; Fri,  7 Mar 2003 01:43:13 +0100 (CET)
Date: Fri, 7 Mar 2003 01:43:13 +0100
From: Marcus Rueckert <rueckert@informatik.uni-rostock.de>
To: "Mark E. Mallett" <mem@mv.mv.com>, dovecot@procontrol.fi
Subject: [dovecot] Re: IMAP Folder paths
Message-ID: <20030307004313.GI30148@irssi.ath.cx>
References: <20030227190212.F3097@pcx3332.desy.de> <1046373554.18310.4.camel@hurina> <20030227212127.A10927@pcx3332.desy.de> <20030306165208.F14976@iridium.mv.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20030306165208.F14976@iridium.mv.net>
User-Agent: Mutt/1.5.3i
X-archive-position: 370
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: rueckert@informatik.uni-rostock.de
Precedence: bulk
X-list: dovecot
X-UID: 370                                                  
Status: O
Content-Length: 1211

On 2003-03-06 16:52:08 -0500, Mark E. Mallett wrote:
>  - multiple paths to folder directories (e.g. ~/Mail or ~/Private or
>    ~/Work/Mail or ~/Maildir/ or simply set it to ~/ and let the user
>    browse their own home directory through an IMAP client and set up
>    their own subscription).

this is one of the points i really hated with uw-imapd. if you have a
unix home used a bit you will have a lot of folders. everytime you
start with a fresh mua it scanned _all_ folders of my homedir if i
forgot to say "only look in ~/Mail". it took really _long_ to get the
initial list. e.g. some muas like sylpheed try to connect to the imap
server after setting up only server/user name. no chance to specify the
mail path....

>  - have the imap server autorecognize the format of any mail folder
>  that
>    the client directs it to look at.

hmhm on of the points of maildir+ was using the leading "." to allow a
mixed setup with other maildir/mbox formats.
so imagine we have:
~/Maildir/.foo/ (maildir+)
~/Maildir/foo (mbox)

which one will be shown?

> Can this be done?  Have I missed something?
dunno

darix

-- 
irssi - the client of the smart and beautiful people

              http://www.irssi.de/


From scott@xs4all.net  Fri Mar  7 18:39:11 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 07 Mar 2003 18:39:11 +0200 (EET)
Return-Path: <scott@xs4all.net>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from trouble.oink.org (trouble.oink.org [194.109.215.226])
	by danu.procontrol.fi (Postfix) with ESMTP id 5DE4223839
	for <dovecot@procontrol.fi>; Fri,  7 Mar 2003 18:39:11 +0200 (EET)
Received: from xs4all.net (vla.gotsiedikkie.nl [194.109.29.21])
	by trouble.oink.org (Postfix) with ESMTP id 5D3643EBC
	for <dovecot@procontrol.fi>; Fri,  7 Mar 2003 17:39:10 +0100 (CET)
Date: Fri, 7 Mar 2003 17:39:10 +0100
Mime-Version: 1.0 (Apple Message framework v551)
Content-Type: text/plain; charset=US-ASCII; format=flowed
Subject: [dovecot] Apple's Mail.app 
From: Scott A.McIntyre <scott@xs4all.net>
To: dovecot@procontrol.fi
Content-Transfer-Encoding: 7bit
Message-Id: <5281F38E-50BB-11D7-B8C1-000393AC9622@xs4all.net>
X-Mailer: Apple Mail (2.551)
X-archive-position: 371
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: scott@xs4all.net
Precedence: bulk
X-list: dovecot
X-UID: 371                                                  
Status: O
Content-Length: 1724


Hi,

I solved the OSX Authentication issue; I'm now reliably able to get 
authenticated using the Password Server with PAM with:

# login: auth account password session
auth       required       pam_nologin.so
auth       sufficient     pam_securityserver.so
auth       sufficient     pam_unix.so
auth       required       pam_deny.so
account    required       pam_permit.so
password   required       pam_deny.so
session    required       pam_permit.so


As the /etc/pam.d/imap

Anyway -- new problem.  With Apple's Mail.app and how it wants to 
download messages into it's cache, I've found that there's a 
problematic interaction between Dovecot and Mail.app -- but pinning 
down exactly what and where is proving to be a hassle.

I was running Courier-Imap with Mail.app, and that worked without 
incident (however, the courier-imap server was on Linux, not OSX 
Server, that will not work (yet) with osx-server).

If I use Entourage and Dovecot, it works fine.

The primary symptom is that as it downloads messages Mail.app just 
hangs; no response, the session just freezes.  Usually it's when the 
status bar is saying something akin to "Caching 9 of 506" at which 
point it stops.  The number varies, but it's always in the first couple 
of dozen.  Messages are small, so it's not that it's hanging on a large 
mail download.  I eventually have to forcibly kill Mail.app.

The log says nothing of use:

dovecot: Mar 07 17:31:23 Info: Dovecot starting up
imap-login: Mar 07 16:32:50 Info: Login: scott [194.109.29.21]
imap-login: Mar 07 16:33:46 Info: Login: scott [194.109.29.21]
imap-login: Mar 07 16:35:38 Info: Login: scott [194.109.29.21]


But perhaps there's a more verbose option somewhere.

Thoughts?

Scott


From cras@irccrew.org  Fri Mar  7 18:50:00 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 07 Mar 2003 18:50:00 +0200 (EET)
Return-Path: <cras@irccrew.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from shodan.irccrew.org (shodan [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id C61B92384D
	for <dovecot@procontrol.fi>; Fri,  7 Mar 2003 18:50:00 +0200 (EET)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id 945004C0A0; Fri,  7 Mar 2003 18:50:00 +0200 (EET)
Date: Fri, 7 Mar 2003 18:50:00 +0200
From: Timo Sirainen <tss@iki.fi>
To: "Scott A.McIntyre" <scott@xs4all.net>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: Apple's Mail.app
Message-ID: <20030307165000.GB23022@irccrew.org>
References: <5281F38E-50BB-11D7-B8C1-000393AC9622@xs4all.net>
Mime-Version: 1.0
Content-Disposition: inline
In-Reply-To: <5281F38E-50BB-11D7-B8C1-000393AC9622@xs4all.net>
User-Agent: Mutt/1.4i
Content-Type: multipart/mixed; boundary="LZvS9be/3tNcYl/X"
X-archive-position: 372
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 372                                                  
Status: O
Content-Length: 1850


--LZvS9be/3tNcYl/X
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline

On Fri, Mar 07, 2003 at 05:39:10PM +0100, Scott A.McIntyre wrote:
> The primary symptom is that as it downloads messages Mail.app just 
> hangs; no response, the session just freezes.  Usually it's when the 
> status bar is saying something akin to "Caching 9 of 506" at which 
> point it stops.  The number varies, but it's always in the first couple 
> of dozen.  Messages are small, so it's not that it's hanging on a large 
> mail download.  I eventually have to forcibly kill Mail.app.

My best guess is that it uses FETCH ENVELOPE, which is somewhat broken in
0.99.8 if some headers (subject, in-reply-to mostly) contain '"' characters.
BODY and BODYSTRUCTURE fetches can also break but they're less likely to
contain '"' chars.

Try if the included patch fixes. Dovecot may have cached those replies
already, so delete all .imap.index* files.

--LZvS9be/3tNcYl/X
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename="quote.diff"

Index: src/lib-imap/imap-quote.c
===================================================================
RCS file: /home/cvs/dovecot/src/lib-imap/imap-quote.c,v
retrieving revision 1.8
retrieving revision 1.9
diff -u -r1.8 -r1.9
--- src/lib-imap/imap-quote.c	13 Feb 2003 21:07:44 -0000	1.8
+++ src/lib-imap/imap-quote.c	4 Mar 2003 01:10:28 -0000	1.9
@@ -19,12 +19,13 @@
 		if (value[i] == 13 || value[i] == 10)
                         linefeeds++;
 
-		if ((value[i] & 0x80) != 0)
+		if ((value[i] & 0x80) != 0 ||
+		    value[i] == '"' || value[i] == '\\')
 			literal = TRUE;
 	}
 
 	if (!literal) {
-		/* no 8bit chars, return as "string" */
+		/* no 8bit chars or imapspecials, return as "string" */
 		str_append_c(str, '"');
 	} else {
 		/* return as literal */

--LZvS9be/3tNcYl/X--


From scott@xs4all.net  Fri Mar  7 18:57:05 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 07 Mar 2003 18:57:05 +0200 (EET)
Return-Path: <scott@xs4all.net>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from trouble.oink.org (trouble.oink.org [194.109.215.226])
	by danu.procontrol.fi (Postfix) with ESMTP id C63A92384D
	for <dovecot@procontrol.fi>; Fri,  7 Mar 2003 18:57:05 +0200 (EET)
Received: from xs4all.net (vla.gotsiedikkie.nl [194.109.29.21])
	by trouble.oink.org (Postfix) with ESMTP
	id 01ADC3EBC; Fri,  7 Mar 2003 17:57:05 +0100 (CET)
Date: Fri, 7 Mar 2003 17:57:05 +0100
Subject: [dovecot] Re: Apple's Mail.app
Content-Type: text/plain; charset=US-ASCII; format=flowed
Mime-Version: 1.0 (Apple Message framework v551)
Cc: dovecot@procontrol.fi
To: Timo Sirainen <tss@iki.fi>
From: "Scott A. McIntyre" <scott@xs4all.net>
In-Reply-To: <20030307165000.GB23022@irccrew.org>
Message-Id: <D3086A75-50BD-11D7-B8C1-000393AC9622@xs4all.net>
Content-Transfer-Encoding: 7bit
X-Mailer: Apple Mail (2.551)
X-archive-position: 373
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: scott@xs4all.net
Precedence: bulk
X-list: dovecot
X-UID: 373                                                  
Status: O

Hi,

> Try if the included patch fixes. Dovecot may have cached those replies
> already, so delete all .imap.index* files.
> <quote.diff>

Turns out that patch is already in CVS -- I took a stab at trying the 
CVS version earlier (around 1500 today) just in case whatever it was 
was fixed from 0.99.8 to CVS.  Same result.   --version still says 
0.99.8, but it's definitely the newer one.

I'd have thought it would break with Entourage as well if it were this, 
though...

Scott


From tss@iki.fi  Sat Mar  8 19:24:55 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 08 Mar 2003 19:24:55 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 32A8023852
	for <dovecot@procontrol.fi>; Sat,  8 Mar 2003 19:24:55 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 577485E01F94; Sat,  8 Mar 2003 19:24:54 +0200 (EET)
Subject: [dovecot] Re: Apple's Mail.app
From: Timo Sirainen <tss@iki.fi>
To: "Scott A. McIntyre" <scott@xs4all.net>
Cc: dovecot@procontrol.fi
In-Reply-To: <D3086A75-50BD-11D7-B8C1-000393AC9622@xs4all.net>
References: <D3086A75-50BD-11D7-B8C1-000393AC9622@xs4all.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1047144293.937.198.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 08 Mar 2003 19:24:54 +0200
X-archive-position: 374
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 374                                                  
Status: O

On Fri, 2003-03-07 at 18:57, Scott A. McIntyre wrote:
> > Try if the included patch fixes. Dovecot may have cached those replies
> > already, so delete all .imap.index* files.
> > <quote.diff>
> 
> Turns out that patch is already in CVS -- I took a stab at trying the 
> CVS version earlier (around 1500 today) just in case whatever it was 
> was fixed from 0.99.8 to CVS.  Same result.   --version still says 
> 0.99.8, but it's definitely the newer one.

And you tried to delete .imap.index* files too? :)

Well, I'd like to know what exactly it's talking to IMAP server. Either
use some network sniffer, or configure Dovecot --with-rawlog, and create
~/rawlog directory where they're saved.

I think some people have already tried Mail.app with 0.99.7 and it
worked..


From jpeterson275@attbi.com  Mon Mar 10 19:48:31 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 10 Mar 2003 19:48:31 +0200 (EET)
Return-Path: <jpeterson275@attbi.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from rwcrmhc51.attbi.com (rwcrmhc51.attbi.com [204.127.198.38])
	by danu.procontrol.fi (Postfix) with ESMTP id 18E9423839
	for <dovecot@procontrol.fi>; Mon, 10 Mar 2003 19:48:31 +0200 (EET)
Received: from attbi.com (12-228-143-121.client.attbi.com[12.228.143.121])
          by rwcrmhc51.attbi.com (rwcrmhc51) with SMTP
          id <2003031017482805100a6c2fe>; Mon, 10 Mar 2003 17:48:28 +0000
Message-ID: <3E6CD002.1020302@attbi.com>
Date: Mon, 10 Mar 2003 09:48:50 -0800
From: Jesse Peterson <jpeterson275@attbi.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Re: Apple's Mail.app
References: <D3086A75-50BD-11D7-B8C1-000393AC9622@xs4all.net>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 375
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jpeterson275@attbi.com
Precedence: bulk
X-list: dovecot
X-UID: 375                                                  
Status: O

I've been using dovecot (a co & build from dec. 28th) without this 
problem with Mail.app just fine even with it's cacheing option turned on 
(i have it off now).  Granted, the server is on a netbsd/i386 machine, I 
doubt that'd make a difference.

Scott A. McIntyre wrote:
> Hi,
> 
>> Try if the included patch fixes. Dovecot may have cached those replies
>> already, so delete all .imap.index* files.
>> <quote.diff>
> 
> 
> Turns out that patch is already in CVS -- I took a stab at trying the 
> CVS version earlier (around 1500 today) just in case whatever it was was 
> fixed from 0.99.8 to CVS.  Same result.   --version still says 0.99.8, 
> but it's definitely the newer one.
> 
> I'd have thought it would break with Entourage as well if it were this, 
> though...
> 
> Scott
> 
> 
> 

-- 
Jesse Peterson  /  jesse@pixeltechs.com


From tss@iki.fi  Tue Mar 11 23:40:57 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 11 Mar 2003 23:40:57 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id A8C6223839
	for <dovecot@procontrol.fi>; Tue, 11 Mar 2003 23:40:57 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 82E765E01F94; Tue, 11 Mar 2003 23:24:52 +0200 (EET)
Subject: [dovecot] 0.99.8.1 out
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1047417892.32459.33.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 11 Mar 2003 23:24:52 +0200
X-archive-position: 376
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 376                                                  
Status: O
Content-Length: 1674

Nothing but bugfixes from CVS:

	* src/lib-storage/index/mbox/mbox-list.c: mbox: LIST ""
	invalid-directory/% doesn't anymore give internal error

	* src/lib-storage/index/index-fetch.c: FETCH: \Seen flag updating
	didn't work (eg. FETCH BODY[]).

	* src/lib-imap/imap-parser.c: Literal parser broke if \r\n wasn't
	in buffer at the time '}' was parsed.

	* src/lib-mail/message-address.c: message_address_write() didn't
	work.

	* src/lib-mail/message-address.c: message_address_parse(): allow
	using data_stack_pool

(above two fix SEARCH FROM, TO, CC, BCC crashing)

	* src/lib-storage/index/index-save.c: Don't crash if something
	tries to write 0 bytes in headers while saving the message. This
	happened sometimes with mbox.

	* src/auth/master-connection.c: Don't crash if auth request wasn't
	found.

	* src/lib/failures.c: Handle /dev/stderr directly instead of
	open()ing.

	* src/lib-imap/imap-quote.c: Use literals for strings containing
	'"' and '\' characters too. This wasn't done at all before so FETCH
	ENVELOPE, BODY and BODYSTRUCTURE could have returned pretty broken
	results.

	* src/lib-storage/index/mbox/mbox-storage.c: Selecting INBOX didn't
	use index files if full_filesystem_access was yes.

	* src/auth/db-ldap.c: Setting user_global_uid or user_global_gid
	crashed.

	* src/lib/safe-mkdir.c: safe_mkdir(): usage fchmod() and fchown().
	chmod() wasn't really safe and lchown() wasn't portable.

	* src/auth/mech-plain.c: Invalid PLAIN auth request crashed auth
	process.

	* src/master/main.c: [::] address wasn't treated exactly as "ipv6
	any", but looks like gethostbyname() worked with it.

	* doc/nfs.txt: updated

	* doc/index.txt: update


From jpeterson275@attbi.com  Thu Mar 13 07:57:27 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 13 Mar 2003 07:57:27 +0200 (EET)
Return-Path: <jpeterson275@attbi.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from rwcrmhc51.attbi.com (rwcrmhc51.attbi.com [204.127.198.38])
	by danu.procontrol.fi (Postfix) with ESMTP id D1E3823839
	for <dovecot@procontrol.fi>; Thu, 13 Mar 2003 07:57:26 +0200 (EET)
Received: from attbi.com (12-228-143-121.client.attbi.com[12.228.143.121])
          by rwcrmhc51.attbi.com (rwcrmhc51) with SMTP
          id <20030313055719051001ot0ue>; Thu, 13 Mar 2003 05:57:19 +0000
Message-ID: <3E701DD8.4010609@attbi.com>
Date: Wed, 12 Mar 2003 21:57:44 -0800
From: Jesse Peterson <jpeterson275@attbi.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] SMTP options
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 377
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jpeterson275@attbi.com
Precedence: bulk
X-list: dovecot
X-UID: 377                                                  
Status: O

I realize this is not an SMTP discussion list, but... here goes:

This is my situation.  We have mobile users that need a secure (SSL) 
SMTP+auth gateway that simply forwards rfc822's to our real MTA.  All it 
would have to do is accept SSL connections, authenticate the user, 
accept his message, then send that to the MTA.

Anybody know of a very minimal software package that can do this?


-- 
Jesse Peterson  /  jesse@pixeltechs.com


From Leslie_Viljoen@icoc.org  Thu Mar 13 13:05:16 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 13 Mar 2003 13:05:16 +0200 (EET)
Return-Path: <Leslie_Viljoen@icoc.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from icchub.icoc.org (ns1.icoc.org [209.101.42.2])
	by danu.procontrol.fi (Postfix) with ESMTP id 7A28D23852
	for <dovecot@procontrol.fi>; Thu, 13 Mar 2003 13:05:16 +0200 (EET)
Subject: [dovecot] Configure SSL problem
To: dovecot@procontrol.fi
X-Mailer: Lotus Notes Release 6.0 September 26, 2002
Message-ID: <OFF6D684CA.26838A7C-ON42256CE8.003A8EFC-42256CE8.003B49AC@icoc.org>
From: Leslie Viljoen <Leslie_Viljoen@icoc.org>
Date: Thu, 13 Mar 2003 12:44:52 +0200
X-MIMETrack: Serialize by Router on ICC_Hub/ICC(Release 6.0.1|February 07, 2003) at 03/13/2003
 03:05:21 AM
MIME-Version: 1.0
Content-type: text/plain; charset=US-ASCII
X-archive-position: 378
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: Leslie_Viljoen@icoc.org
Precedence: bulk
X-list: dovecot
X-UID: 378                                                  
Status: O





Hi everyone

I have been trying to get Dovecot installed with OpenSSL support, but no
matter what I do,
when I run Configure, it says "Building with SSL support.........No".
I have even tried configure --with-ssl=openssl, to no avail.

I have built and installed OpenSSL, and libssl.so and libcrypto.so are in
the /lib directory -
what more does Dovecot want? I have tried figuring it out from the
Configure script itself
but it's cryptic and I am no shell script boffin!

Thanks for any tips

Les


______________________________________
Leslie Viljoen
Africa Missions Systems Administrator
Cell: 0836186100 Work: 011 6991700
Fax: 011 7945522


From Leslie_Viljoen@icoc.org  Thu Mar 13 14:23:37 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 13 Mar 2003 14:23:38 +0200 (EET)
Return-Path: <Leslie_Viljoen@icoc.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from icchub.icoc.org (ns1.icoc.org [209.101.42.2])
	by danu.procontrol.fi (Postfix) with ESMTP id 911D523839
	for <dovecot@procontrol.fi>; Thu, 13 Mar 2003 14:23:37 +0200 (EET)
Subject: [dovecot] Starting Dovecot?
To: dovecot@procontrol.fi
X-Mailer: Lotus Notes Release 6.0 September 26, 2002
Message-ID: <OFB6822765.890FE704-ON42256CE8.00439049-42256CE8.0044525D@icoc.org>
From: Leslie Viljoen <Leslie_Viljoen@icoc.org>
Date: Thu, 13 Mar 2003 14:23:33 +0200
X-MIMETrack: Serialize by Router on ICC_Hub/ICC(Release 6.0.1|February 07, 2003) at 03/13/2003
 04:23:42 AM
MIME-Version: 1.0
Content-type: text/plain; charset=US-ASCII
X-archive-position: 379
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: Leslie_Viljoen@icoc.org
Precedence: bulk
X-list: dovecot
X-UID: 379                                                  
Status: O





Hello!

I have laid SSL aside for the time being, and continued compiling and
installing Dovecot.
Now I don't know how to start it! I have been through the config file and
mostly left things as-is.
I have created the dovecot user and group and put only dovecot user in the
dovecot group.

Then I tried imap-master, as specified in the INSTALL documentation, but
there is no such file!
Under src/master, "dovecot" gets built. I tried running this, and
/var/log/messages says
"dovecot starting", but this process seems to just end. If I run it twice
very quickly, I get
told that port 143 is busy - so it seems that it is starting up, but only
staying up for a very short
while. Messages gives no more clues as to why the server quits.


Any ideas?

Les

PS: I am trying dovecot 0.99.8.1.
______________________________________
Leslie Viljoen
Africa Missions Systems Administrator
Cell: 0836186100 Work: 011 6991700
Fax: 011 7945522


From pomac@vapor.com  Thu Mar 13 14:30:47 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 13 Mar 2003 14:30:47 +0200 (EET)
Return-Path: <pomac@vapor.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from pomac.netswarm.net (c-1b0072d5.012-136-6c756e2.cust.bredbandsbolaget.se [213.114.0.27])
	by danu.procontrol.fi (Postfix) with ESMTP id 0CB9D23839
	for <dovecot@procontrol.fi>; Thu, 13 Mar 2003 14:30:47 +0200 (EET)
Received: from big.pomac.com (big.pomac.com [10.0.0.254])
	by pomac.netswarm.net (Postfix) with ESMTP id C1B879D38B
	for <dovecot@procontrol.fi>; Thu, 13 Mar 2003 13:30:45 +0100 (CET)
Subject: [dovecot] Re: Configure SSL problem
From: Ian Kumlien <pomac@vapor.com>
To: dovecot@procontrol.fi
In-Reply-To: <OFF6D684CA.26838A7C-ON42256CE8.003A8EFC-42256CE8.003B49AC@icoc.org>
References:
	 <OFF6D684CA.26838A7C-ON42256CE8.003A8EFC-42256CE8.003B49AC@icoc.org>
Content-Type: multipart/signed; micalg=pgp-sha1; protocol="application/pgp-signature"; boundary="=-1b6FEwpOk0avQOG7URhg"
Organization: 
Message-Id: <1047558645.2217.42.camel@big.pomac.com>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 13 Mar 2003 13:30:45 +0100
X-archive-position: 380
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: pomac@vapor.com
Precedence: bulk
X-list: dovecot
X-UID: 380                                                  
Status: O
Content-Length: 1186


--=-1b6FEwpOk0avQOG7URhg
Content-Type: text/plain
Content-Transfer-Encoding: quoted-printable

On Thu, 2003-03-13 at 11:44, Leslie Viljoen wrote:
> I have been trying to get Dovecot installed with OpenSSL support, but no
> matter what I do,
> when I run Configure, it says "Building with SSL support.........No".
> I have even tried configure --with-ssl=3Dopenssl, to no avail.
>=20
> I have built and installed OpenSSL, and libssl.so and libcrypto.so are in
> the /lib directory -
> what more does Dovecot want? I have tried figuring it out from the
> Configure script itself
> but it's cryptic and I am no shell script boffin!

I assume that you have to change /etc/ld.so.conf or what's its name.
And then do a ldconfig.

PS. Can someone make this ml set "Reply-To:" headers?
DS.

--=20
Ian Kumlien <pomac@vapor.com>

--=-1b6FEwpOk0avQOG7URhg
Content-Type: application/pgp-signature; name=signature.asc
Content-Description: This is a digitally signed message part

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.0.7 (GNU/Linux)

iD8DBQA+cHn17F3Euyc51N8RAmLoAKCjkHmz/gsUKTyy3JMIGss3QreGNACglFPe
bbjJd47y1LzcoJyOFTfz8Vg=
=lJqA
-----END PGP SIGNATURE-----

--=-1b6FEwpOk0avQOG7URhg--


From pomac@vapor.com  Thu Mar 13 14:33:39 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 13 Mar 2003 14:33:39 +0200 (EET)
Return-Path: <pomac@vapor.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from pomac.netswarm.net (c-1b0072d5.012-136-6c756e2.cust.bredbandsbolaget.se [213.114.0.27])
	by danu.procontrol.fi (Postfix) with ESMTP id 9E9BE23839
	for <dovecot@procontrol.fi>; Thu, 13 Mar 2003 14:33:39 +0200 (EET)
Received: from big.pomac.com (big.pomac.com [10.0.0.254])
	by pomac.netswarm.net (Postfix) with ESMTP id 5E14A9D4B9
	for <dovecot@procontrol.fi>; Thu, 13 Mar 2003 13:33:39 +0100 (CET)
Subject: [dovecot] Re: Starting Dovecot?
From: Ian Kumlien <pomac@vapor.com>
To: dovecot@procontrol.fi
In-Reply-To: <OFB6822765.890FE704-ON42256CE8.00439049-42256CE8.0044525D@icoc.org>
References:
	 <OFB6822765.890FE704-ON42256CE8.00439049-42256CE8.0044525D@icoc.org>
Content-Type: multipart/signed; micalg=pgp-sha1; protocol="application/pgp-signature"; boundary="=-fcKDuUFqbX7jYJdW94RC"
Organization: 
Message-Id: <1047558819.2217.48.camel@big.pomac.com>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 13 Mar 2003 13:33:39 +0100
X-archive-position: 381
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: pomac@vapor.com
Precedence: bulk
X-list: dovecot
X-UID: 381                                                  
Status: O
Content-Length: 1316


--=-fcKDuUFqbX7jYJdW94RC
Content-Type: text/plain
Content-Transfer-Encoding: quoted-printable

On Thu, 2003-03-13 at 13:23, Leslie Viljoen wrote:
> Then I tried imap-master, as specified in the INSTALL documentation, but
> there is no such file!
> Under src/master, "dovecot" gets built. I tried running this, and
> /var/log/messages says
> "dovecot starting", but this process seems to just end. If I run it twice
> very quickly, I get
> told that port 143 is busy - so it seems that it is starting up, but only
> staying up for a very short
> while. Messages gives no more clues as to why the server quits.

run dovecot and then do:
netstat -anp |grep dovecot
or
netstat -anp |grep 143

And you'll most likely find that dovecot is running and listening to
port 143, just as it should. Else check your logs for error messages.

PS. Sorry, remembered to change the email the first time but not the second=
.
DS.

--=20
Ian Kumlien <pomac@vapor.com>

--=-fcKDuUFqbX7jYJdW94RC
Content-Type: application/pgp-signature; name=signature.asc
Content-Description: This is a digitally signed message part

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.0.7 (GNU/Linux)

iD8DBQA+cHqj7F3Euyc51N8RAknYAKC2yO8VH2YHPp+mMDdBPBOTtrj90ACgtm65
3kOu+Nz0a0/DvqFVVypfDP8=
=6nWC
-----END PGP SIGNATURE-----

--=-fcKDuUFqbX7jYJdW94RC--


From eskimoe@ananzi.co.za  Thu Mar 13 15:12:04 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 13 Mar 2003 15:12:04 +0200 (EET)
Return-Path: <eskimoe@ananzi.co.za>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from sun.com (port-212-202-171-172.reverse.qdsl-home.de [212.202.171.172])
	by danu.procontrol.fi (Postfix) with SMTP id C17EE23852
	for <dovecot@procontrol.fi>; Thu, 13 Mar 2003 15:12:03 +0200 (EET)
Received: (qmail 32144 invoked by uid 1000); 13 Mar 2003 13:12:51 -0000
Date: Thu, 13 Mar 2003 14:12:51 +0100
From: Moe Wibble <eskimoe@ananzi.co.za>
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Shared Folders?
Message-ID: <20030313131251.GA21426@woom.net>
Mail-Followup-To: Moe Wibble <eskimoe@ananzi.co.za>,
	Dovecot Mail List <dovecot@procontrol.fi>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
X-archive-position: 382
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: eskimoe@ananzi.co.za
Precedence: bulk
X-list: dovecot
X-UID: 382                                                  
Status: O

Hello everybody (esp. Timo ;)),

in an attempt to replace our cyrus imapd with something less bloated
I have recently evaluated some of the younger imapd implementations,
namely bincimap and also dovecot.

Bincimap didn't work properly with mozilla for me, dovecot hasn't
failed on any test, yet.

Unfornationally, since we have been using cyrus for over 1.5 yrs, we
pretty much depend on the "shared folders"-feature.

Are there any plans to make shared folders available in dovecot anytime soon?


best regards!
-- 
MW


From Leslie_Viljoen@icoc.org  Thu Mar 13 15:17:13 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 13 Mar 2003 15:17:13 +0200 (EET)
Return-Path: <Leslie_Viljoen@icoc.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from icchub.icoc.org (ns1.icoc.org [209.101.42.2])
	by danu.procontrol.fi (Postfix) with ESMTP id 47B7E23852
	for <dovecot@procontrol.fi>; Thu, 13 Mar 2003 15:17:13 +0200 (EET)
Subject: [dovecot] Sorry (Starting Dovecot)
To: dovecot@procontrol.fi
X-Mailer: Lotus Notes Release 6.0 September 26, 2002
Message-ID: <OF0D6D2936.9B9009B9-ON42256CE8.00442CD3-42256CE8.00448621@icoc.org>
From: Leslie Viljoen <Leslie_Viljoen@icoc.org>
Date: Thu, 13 Mar 2003 14:25:45 +0200
X-MIMETrack: Serialize by Router on ICC_Hub/ICC(Release 6.0.1|February 07, 2003) at 03/13/2003
 05:17:13 AM
MIME-Version: 1.0
Content-type: text/plain; charset=US-ASCII
X-archive-position: 383
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: Leslie_Viljoen@icoc.org
Precedence: bulk
X-list: dovecot
X-UID: 383                                                  
Status: O





Sorry, I didn't check all my logs.
PAM password DB was not found - it was in syslog.

Les
______________________________________
Leslie Viljoen
Africa Missions Systems Administrator
Cell: 0836186100 Work: 011 6991700
Fax: 011 7945522


From jonas@jones.dk  Thu Mar 13 13:23:36 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 13 Mar 2003 15:47:46 +0200 (EET)
Return-Path: <jonas@jones.dk>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from auryn.jones.dk (unknown [62.79.77.233])
	by danu.procontrol.fi (Postfix) with ESMTP id 8390623852
	for <dovecot@procontrol.fi>; Thu, 13 Mar 2003 13:23:36 +0200 (EET)
Received: from auryn (auryn [127.0.0.1])
	by auryn.jones.dk (Postfix) with ESMTP
	id C21233F20D5; Thu, 13 Mar 2003 07:05:17 +0100 (CET)
Date: Thu, 13 Mar 2003 07:05:17 +0100 (CET)
From: Jonas Smedegaard <jonas@jones.dk>
To: Jesse Peterson <jpeterson275@attbi.com>
Cc: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Re: SMTP options
In-Reply-To: <3E701DD8.4010609@attbi.com>
Message-ID: <Pine.LNX.4.53.0303130703400.10863@auryn.jones.dk>
References: <3E701DD8.4010609@attbi.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=ISO-8859-1
Content-Transfer-Encoding: 8BIT
X-archive-position: 384
X-Approved-By: tss@iki.fi
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jonas@jones.dk
Precedence: bulk
X-list: dovecot
X-UID: 384                                                  
Status: O

On Wed, 12 Mar 2003, Jesse Peterson wrote:

> This is my situation.  We have mobile users that need a secure (SSL)
> SMTP+auth gateway that simply forwards rfc822's to our real MTA.  All it
> would have to do is accept SSL connections, authenticate the user,
> accept his message, then send that to the MTA.
>
> Anybody know of a very minimal software package that can do this?

I'd use postfix. It isn't exactly "very minimal" though...

 - Jonas

-- 
Jeg køber min økologiske sødmælk i 7-eleven!

Jonas Smedegaard (+45 40843136) http://dr.jones.dk/articles/7eleven

From cras@irccrew.org  Thu Mar 13 15:48:53 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 13 Mar 2003 15:48:53 +0200 (EET)
Return-Path: <cras@irccrew.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from shodan.irccrew.org (shodan [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id 4FEF523839
	for <dovecot@procontrol.fi>; Thu, 13 Mar 2003 15:48:53 +0200 (EET)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id 3DB394C0A0; Thu, 13 Mar 2003 15:48:53 +0200 (EET)
Date: Thu, 13 Mar 2003 15:48:53 +0200
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Configure SSL problem
Message-ID: <20030313134853.GC22006@irccrew.org>
References: <OFF6D684CA.26838A7C-ON42256CE8.003A8EFC-42256CE8.003B49AC@icoc.org>
Mime-Version: 1.0
Content-Disposition: inline
In-Reply-To: <OFF6D684CA.26838A7C-ON42256CE8.003A8EFC-42256CE8.003B49AC@icoc.org>
User-Agent: Mutt/1.4i
Content-Type: text/plain; charset=us-ascii
X-archive-position: 385
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 385                                                  
Status: O

On Thu, Mar 13, 2003 at 12:44:52PM +0200, Leslie Viljoen wrote:
> I have been trying to get Dovecot installed with OpenSSL support, but no
> matter what I do,
> when I run Configure, it says "Building with SSL support.........No".
> I have even tried configure --with-ssl=openssl, to no avail.

Check config.log what it says about it. Maybe it doesn't find ssl.h.


From cras@irccrew.org  Thu Mar 13 17:59:04 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 13 Mar 2003 17:59:04 +0200 (EET)
Return-Path: <cras@irccrew.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from shodan.irccrew.org (shodan [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id 1E1E523839
	for <dovecot@procontrol.fi>; Thu, 13 Mar 2003 17:59:04 +0200 (EET)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id DDC4B4C0A0; Thu, 13 Mar 2003 17:59:03 +0200 (EET)
Date: Thu, 13 Mar 2003 17:59:03 +0200
From: Timo Sirainen <tss@iki.fi>
To: Moe Wibble <eskimoe@ananzi.co.za>,
	Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Re: Shared Folders?
Message-ID: <20030313155903.GE22006@irccrew.org>
References: <20030313131251.GA21426@woom.net>
Mime-Version: 1.0
Content-Disposition: inline
In-Reply-To: <20030313131251.GA21426@woom.net>
User-Agent: Mutt/1.4i
Content-Type: text/plain; charset=us-ascii
X-archive-position: 386
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 386                                                  
Status: O
Content-Length: 1267

On Thu, Mar 13, 2003 at 02:12:51PM +0100, Moe Wibble wrote:
> Are there any plans to make shared folders available in dovecot anytime soon?

Well .. it's kind of possible already with symlinks, eg.:

ln -s /home/shared/Maildir/.shared.folder /home/user/Maildir/

Problems with that:
 - No way to do it from IMAP client, ie. no ACL support. No plans to support
that in near future
 - Sharing index files may not be that good idea from security point of
view, especially if users have direct access to filesystem. Specifying
different location for index files would then be good idea so each user
would have their own: default_mail_env = Maildir:~/Maildir:INDEX=~/indexes
 - If indexes aren't shared, there may be occational syncing problems when
someone changes message flag and another user just tries to fetch the
message. Dovecot will give "message not found" error, but next fetch will
work. This will be fixed by re-syncing maildir folder when it can't find
some file.
 - Sharing mbox files won't have the above problem, but flag changes aren't
noted by other users until you close the mailbox. I'll probably fix this
later so that the flag changes are written to mbox at least once in a few
seconds (if not immediately)
 - All users will have shared mail flags


From cras@irccrew.org  Thu Mar 13 18:07:20 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 13 Mar 2003 18:07:20 +0200 (EET)
Return-Path: <cras@irccrew.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from shodan.irccrew.org (shodan [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id A14A223839
	for <dovecot@procontrol.fi>; Thu, 13 Mar 2003 18:07:20 +0200 (EET)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id 7F95B4C0A0; Thu, 13 Mar 2003 18:07:20 +0200 (EET)
Date: Thu, 13 Mar 2003 18:07:20 +0200
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Configure SSL problem
Message-ID: <20030313160720.GF22006@irccrew.org>
References: <OFF6D684CA.26838A7C-ON42256CE8.003A8EFC-42256CE8.003B49AC@icoc.org> <1047558645.2217.42.camel@big.pomac.com>
Mime-Version: 1.0
Content-Disposition: inline
In-Reply-To: <1047558645.2217.42.camel@big.pomac.com>
User-Agent: Mutt/1.4i
Content-Type: text/plain; charset=us-ascii
X-archive-position: 387
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 387                                                  
Status: O

On Thu, Mar 13, 2003 at 01:30:45PM +0100, Ian Kumlien wrote:
> PS. Can someone make this ml set "Reply-To:" headers?

I don't think that's generally considered very good behaviour for mailing
list. For example it prevents easily replying privately. Some people also
prefer to get the replies in private mail as well as to mailing list, which
is useful especially with high traffic list.

Setting Mail-Followup-To header (or even reply-to) to mails yourself would
help. Of course, that doesn't help if you're accidentally replying
privately..

http://www.unicom.com/pw/reply-to-harmful.html
http://cr.yp.to/proto/replyto.html


From eskimoe@ananzi.co.za  Thu Mar 13 19:59:01 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 13 Mar 2003 19:59:01 +0200 (EET)
Return-Path: <eskimoe@ananzi.co.za>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from sun.com (port-212-202-171-172.reverse.qdsl-home.de [212.202.171.172])
	by danu.procontrol.fi (Postfix) with SMTP id E16C423839
	for <dovecot@procontrol.fi>; Thu, 13 Mar 2003 19:59:00 +0200 (EET)
Received: (qmail 31301 invoked by uid 1000); 13 Mar 2003 17:59:48 -0000
Date: Thu, 13 Mar 2003 18:59:48 +0100
From: Moe Wibble <eskimoe@ananzi.co.za>
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Re: Shared Folders?
Message-ID: <20030313175948.GA23796@woom.net>
Mail-Followup-To: Moe Wibble <eskimoe@ananzi.co.za>,
	Dovecot Mail List <dovecot@procontrol.fi>
References: <20030313131251.GA21426@woom.net> <20030313155903.GE22006@irccrew.org>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20030313155903.GE22006@irccrew.org>
X-archive-position: 388
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: eskimoe@ananzi.co.za
Precedence: bulk
X-list: dovecot
X-UID: 388                                                  
Status: O
Content-Length: 2512

On Thu, Mar 13, 2003 at 05:59:03PM +0200, Timo Sirainen wrote:
> On Thu, Mar 13, 2003 at 02:12:51PM +0100, Moe Wibble wrote:
> > Are there any plans to make shared folders available in dovecot anytime soon?
> 
> Well .. it's kind of possible already with symlinks, eg.:
> 
> ln -s /home/shared/Maildir/.shared.folder /home/user/Maildir/

Interesting.
That's exactly what I've tried but it didn't work.
The linked folder did show up in the subscribe-dialog but couldn't
be subscribed. I didn't save the error-message 'cause it was reproducable
so it seemed like dovecot simply didn't feel comfortable with that symlink
in a maildir.

Humm. I even disabled all the chroot-switches in dovecot.conf during
that test.  Well, I'll try again tomorrow!

> Problems with that:
>  - No way to do it from IMAP client, ie. no ACL support. No plans to support
> that in near future

We don't need no ACL, no problem here. :)
Read-only folders would be nice to have but that shouldn't be too difficult
to achieve thru unix file-permissions/ownership.

>  - Sharing index files may not be that good idea from security point of
> view, especially if users have direct access to filesystem. Specifying
> different location for index files would then be good idea so each user
> would have their own: default_mail_env = Maildir:~/Maildir:INDEX=~/indexes

Gotta look into that.  Not really a security issue here
since the imapd acts as a blackbox anyways; no user accounts.

Doesn't dovecot get confused by multiple users sharing the same
index for, say, their INBOX, tho?

That default_mail_env line will do for me anyways. :)

>  - If indexes aren't shared, there may be occational syncing problems when
> someone changes message flag and another user just tries to fetch the
> message. Dovecot will give "message not found" error, but next fetch will
> work. This will be fixed by re-syncing maildir folder when it can't find
> some file.

Can live with that.

>  - Sharing mbox files won't have the above problem, but flag changes aren't
> noted by other users until you close the mailbox. I'll probably fix this
> later so that the flag changes are written to mbox at least once in a few
> seconds (if not immediately)

mbox is dead and bzipped. ;)

>  - All users will have shared mail flags

I think that's even desirable for our environment.
Might be a misfeature for others, tho.

Thanks for your quick response!  I'll retry that little symlink-stunt
tomorrow and let you know about the results. :)


best regards
-- 
MW


From pomac@vapor.com  Fri Mar 14 00:53:03 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 14 Mar 2003 00:53:03 +0200 (EET)
Return-Path: <pomac@vapor.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from pomac.netswarm.net (c-1b0072d5.012-136-6c756e2.cust.bredbandsbolaget.se [213.114.0.27])
	by danu.procontrol.fi (Postfix) with ESMTP id 1ADCA23852
	for <dovecot@procontrol.fi>; Fri, 14 Mar 2003 00:53:03 +0200 (EET)
Received: from big.pomac.com (big.pomac.com [10.0.0.254])
	by pomac.netswarm.net (Postfix) with ESMTP
	id 3A3A29D4CD; Thu, 13 Mar 2003 23:53:01 +0100 (CET)
Subject: [dovecot] Re: Configure SSL problem
From: Ian Kumlien <pomac@vapor.com>
To: Timo Sirainen <tss@iki.fi>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030313160720.GF22006@irccrew.org>
References:
	 <OFF6D684CA.26838A7C-ON42256CE8.003A8EFC-42256CE8.003B49AC@icoc.org>
	 <1047558645.2217.42.camel@big.pomac.com>
	 <20030313160720.GF22006@irccrew.org>
Content-Type: multipart/signed; micalg=pgp-sha1; protocol="application/pgp-signature"; boundary="=-f8dxQyBVhjuHS6JPnxZn"
Organization: 
Message-Id: <1047595981.2216.53.camel@big.pomac.com>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 13 Mar 2003 23:53:01 +0100
X-archive-position: 389
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: pomac@vapor.com
Precedence: bulk
X-list: dovecot
X-UID: 389                                                  
Status: O
Content-Length: 1403


--=-f8dxQyBVhjuHS6JPnxZn
Content-Type: text/plain
Content-Transfer-Encoding: quoted-printable

On Thu, 2003-03-13 at 17:07, Timo Sirainen wrote:
> On Thu, Mar 13, 2003 at 01:30:45PM +0100, Ian Kumlien wrote:
> > PS. Can someone make this ml set "Reply-To:" headers?
>=20
> I don't think that's generally considered very good behaviour for mailing
> list. For example it prevents easily replying privately. Some people also
> prefer to get the replies in private mail as well as to mailing list, whi=
ch
> is useful especially with high traffic list.
>=20
> Setting Mail-Followup-To header (or even reply-to) to mails yourself woul=
d
> help. Of course, that doesn't help if you're accidentally replying
> privately..
>=20
> http://www.unicom.com/pw/reply-to-harmful.html
> http://cr.yp.to/proto/replyto.html

Ahhh, I generally saw it in the oposite direction since most ppl could
benefit from seeing the "full discussion come to an end".

But, i never know about the reply to all functionality =3D)

--=20
Ian Kumlien <pomac@vapor.com>

--=-f8dxQyBVhjuHS6JPnxZn
Content-Type: application/pgp-signature; name=signature.asc
Content-Description: This is a digitally signed message part

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.0.7 (GNU/Linux)

iD8DBQA+cQvM7F3Euyc51N8RAnB5AJ94zspVKoNJgoNh+9J64quVeVnFOQCfTiWx
Izb6cgCSdmxU3hbsC0Btiqo=
=4n/T
-----END PGP SIGNATURE-----

--=-f8dxQyBVhjuHS6JPnxZn--


From eskimoe@ananzi.co.za  Fri Mar 14 19:25:21 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 14 Mar 2003 19:25:21 +0200 (EET)
Return-Path: <eskimoe@ananzi.co.za>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from sun.com (port-212-202-171-172.reverse.qdsl-home.de [212.202.171.172])
	by danu.procontrol.fi (Postfix) with SMTP id DE36623852
	for <dovecot@procontrol.fi>; Fri, 14 Mar 2003 19:25:20 +0200 (EET)
Received: (qmail 20005 invoked by uid 1000); 14 Mar 2003 17:26:07 -0000
Date: Fri, 14 Mar 2003 18:26:07 +0100
From: Moe Wibble <eskimoe@ananzi.co.za>
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Shared Folders seem to work
Message-ID: <20030314172607.GA5217@woom.net>
Mail-Followup-To: Moe Wibble <eskimoe@ananzi.co.za>,
	Dovecot Mail List <dovecot@procontrol.fi>
References: <20030313131251.GA21426@woom.net> <20030313155903.GE22006@irccrew.org> <20030313175948.GA23796@woom.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20030313175948.GA23796@woom.net>
X-archive-position: 390
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: eskimoe@ananzi.co.za
Precedence: bulk
X-list: dovecot
X-UID: 390                                                  
Status: O

Hi,

I can't recall what my mistake was when first trying this.
Probably wrong directory-permissions.  Anyways, it does work fine now. :)

We're going to run dovecot in parallel to our cyrus for a while now
and if it turns out to be stable enough cyrus will be ceremoniously moved
to tape.


regards
-- 
MW


From umaro@narshe.net  Fri Mar 14 23:12:12 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 14 Mar 2003 23:12:12 +0200 (EET)
Return-Path: <umaro@narshe.net>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from narshe.net (unknown [209.140.74.64])
	by danu.procontrol.fi (Postfix) with SMTP id D806A23852
	for <dovecot@procontrol.fi>; Fri, 14 Mar 2003 23:12:11 +0200 (EET)
Received: (qmail 21095 invoked by uid 9001); 14 Mar 2003 21:12:09 -0000
Received: from unknown (HELO terra.slcnet) (209.140.74.61)
  by mail.narshe.net with SMTP; 14 Mar 2003 21:12:09 -0000
Date: Fri, 14 Mar 2003 14:15:28 -0700
From: Chris Doyle <umaro@narshe.net>
To: dovecot@procontrol.fi
Subject: [dovecot] dovecot/vpopmail auth problems
Message-Id: <20030314141528.6bdb8bba.umaro@narshe.net>
X-Mailer: Sylpheed version 0.8.11claws (GTK+ 1.2.10; i686-pc-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-archive-position: 391
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: umaro@narshe.net
Precedence: bulk
X-list: dovecot
X-UID: 391                                                  
Status: O

Hello.

I am having problems getting dovecot to authenticate correctly through
vpopmail.

I have used vpopmail for some time, and I understand how it works.

vpopmail is using mysql to store it's authentication data.

vpopmail's tools can access the user database just fine, and vchkpw
is working so far as authentication goes.

I took an "strace -f dovecot", in case it can help. It is about 900k,
and can be accessed at http://www.narshe.net/~umaro/dovecot.log

please help!

Thanks
Chris Doyle

From tss@iki.fi  Sat Mar 15 00:15:51 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 15 Mar 2003 00:15:51 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 7B9EE23839
	for <dovecot@procontrol.fi>; Sat, 15 Mar 2003 00:15:51 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 60A9B5E01F94; Sat, 15 Mar 2003 00:15:46 +0200 (EET)
Subject: [dovecot] Re: dovecot/vpopmail auth problems
From: Timo Sirainen <tss@iki.fi>
To: Chris Doyle <umaro@narshe.net>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030314141528.6bdb8bba.umaro@narshe.net>
References: <20030314141528.6bdb8bba.umaro@narshe.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1047680146.20734.64.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 15 Mar 2003 00:15:46 +0200
X-archive-position: 392
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 392                                                  
Status: O

On Fri, 2003-03-14 at 23:15, Chris Doyle wrote:
> I took an "strace -f dovecot", in case it can help. It is about 900k,
> and can be accessed at http://www.narshe.net/~umaro/dovecot.log

I didn't notice anything wrong in that strace, but it's not too easy to
follow. What is dovecot's error message if you set auth_verbose = yes?

Dovecot's vpopmail support isn't completely broken anyway, one guy just
told today that he got it working with 0.99.8.1.


From mem@mv.mv.com  Sat Mar 15 00:29:26 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 15 Mar 2003 00:29:26 +0200 (EET)
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id B395923839
	for <dovecot@procontrol.fi>; Sat, 15 Mar 2003 00:29:25 +0200 (EET)
Received: (qmail 11118 invoked by uid 101); 14 Mar 2003 17:29:24 -0500
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Fri, 14 Mar 2003 17:29:24 -0500
To: Leslie Viljoen <Leslie_Viljoen@icoc.org>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: Configure SSL problem
Message-ID: <20030314172924.L7268@iridium.mv.net>
References: <OFF6D684CA.26838A7C-ON42256CE8.003A8EFC-42256CE8.003B49AC@icoc.org>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
In-Reply-To: <OFF6D684CA.26838A7C-ON42256CE8.003A8EFC-42256CE8.003B49AC@icoc.org>; from Leslie_Viljoen@icoc.org on Thu, Mar 13, 2003 at 12:44:52PM +0200
X-archive-position: 393
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mem@mv.mv.com
Precedence: bulk
X-list: dovecot
X-UID: 393                                                  
Status: O

On Thu, Mar 13, 2003 at 12:44:52PM +0200, Leslie Viljoen wrote:
> 
> 
> 
> 
> Hi everyone
> 
> I have been trying to get Dovecot installed with OpenSSL support, but no
> matter what I do,
> when I run Configure, it says "Building with SSL support.........No".
> I have even tried configure --with-ssl=openssl, to no avail.
> 
> I have built and installed OpenSSL, and libssl.so and libcrypto.so are in
> the /lib directory -
> what more does Dovecot want? I have tried figuring it out from the
> Configure script itself
> but it's cryptic and I am no shell script boffin!

Did your ssl include files get installed in the fairly standard
/usr/local/ssl/include ?  If so try something like:

   ./configure --with-ssl=openssl --includedir=/usr/local/ssl/include

Maybe "configure" could be trained to look there by default..

-mm-

From jpeterson275@attbi.com  Sun Mar 16 08:01:47 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 16 Mar 2003 08:01:47 +0200 (EET)
Return-Path: <jpeterson275@attbi.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from rwcrmhc51.attbi.com (rwcrmhc51.attbi.com [204.127.198.38])
	by danu.procontrol.fi (Postfix) with ESMTP id 11BA523839
	for <dovecot@procontrol.fi>; Sun, 16 Mar 2003 08:01:47 +0200 (EET)
Received: from attbi.com (12-228-143-121.client.attbi.com[12.228.143.121])
          by rwcrmhc51.attbi.com (rwcrmhc51) with SMTP
          id <2003031606014505100rn5pie>; Sun, 16 Mar 2003 06:01:45 +0000
Message-ID: <3E741348.9080304@attbi.com>
Date: Sat, 15 Mar 2003 22:01:44 -0800
From: Jesse Peterson <jpeterson275@attbi.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] missing files...
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 394
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jpeterson275@attbi.com
Precedence: bulk
X-list: dovecot
X-UID: 394                                                  
Status: O

I'm probably missing something but.. from cvs:

gmake[1]: Entering directory 
`/usr/home/erage/dovecot/cvs/dovecot/src/lib-index'
source='mail-lockdir.c' object='mail-lockdir.o' libtool=no \
depfile='.deps/mail-lockdir.Po' tmpdepfile='.deps/mail-lockdir.TPo' \
depmode=gcc /bin/sh ../../depcomp \
gcc -DHAVE_CONFIG_H -I. -I. -I../.. -I../../src/lib -I../../src/lib-mail 
-I../../src/lib-imap    -g -O2 -Wall -W -Wmissing-prototypes 
-Wmissing-declarations -Wpointer-arith -Wchar-subscripts -Wformat=2 
-Wbad-function-cast  -c `test -f 'mail-lockdir.c' || echo 
'./'`mail-lockdir.c
gcc: ./mail-lockdir.c: No such file or directory
gcc: No input files



Any ideas?


From jpeterson275@attbi.com  Sun Mar 16 09:43:22 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 16 Mar 2003 09:43:22 +0200 (EET)
Return-Path: <jpeterson275@attbi.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from rwcrmhc52.attbi.com (rwcrmhc52.attbi.com [216.148.227.88])
	by danu.procontrol.fi (Postfix) with ESMTP id 6878823839
	for <dovecot@procontrol.fi>; Sun, 16 Mar 2003 09:43:22 +0200 (EET)
Received: from attbi.com (12-228-143-121.client.attbi.com[12.228.143.121])
          by rwcrmhc52.attbi.com (rwcrmhc52) with SMTP
          id <2003031607432005200593j2e>; Sun, 16 Mar 2003 07:43:20 +0000
Message-ID: <3E742B17.7000708@attbi.com>
Date: Sat, 15 Mar 2003 23:43:19 -0800
From: Jesse Peterson <jpeterson275@attbi.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Failed to create storage with data: ::
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 395
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jpeterson275@attbi.com
Precedence: bulk
X-list: dovecot
X-UID: 395                                                  
Status: O

# dovecot.conf:
protocols = imaps
login = imap
login_user = mail
default_mail_env = maildir:%h/
auth = default
auth_mechanisms = plain
auth_userdb = passwd-file /tmp/imap.passwd
auth_passdb = passwd-file /tmp/imap.passwd
auth_user = mail
auth_verbose = yes

In the log files I get:
   Mar 15 23:36:30 pos dovecot: Dovecot starting up
   Mar 15 23:36:37 pos imap-login: Login: testuser [10.0.66.1]
   Mar 15 23:36:37 pos imap(testuser): Failed to create storage with 
data: ::
   Mar 15 23:36:37 pos dovecot: child 23150 (imap) returned error 89


A typical entry in the imap.passwd:
   testuser:<md5>[34]:12345:12345::/some/home/directory/testuser:0::

-- 
Jesse Peterson  /  jesse@pixeltechs.com


From tss@iki.fi  Sun Mar 16 16:40:36 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 16 Mar 2003 16:40:36 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 0C9B0238D5
	for <dovecot@procontrol.fi>; Sun, 16 Mar 2003 16:40:36 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id A59A95E01F94; Sun, 16 Mar 2003 16:40:35 +0200 (EET)
Subject: [dovecot] Re: Failed to create storage with data: ::
From: Timo Sirainen <tss@iki.fi>
To: Jesse Peterson <jpeterson275@attbi.com>
Cc: Dovecot Mail List <dovecot@procontrol.fi>
In-Reply-To: <3E742B17.7000708@attbi.com>
References: <3E742B17.7000708@attbi.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Message-Id: <1047825287.24446.10.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 16 Mar 2003 16:40:35 +0200
X-archive-position: 396
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 396                                                  
Status: O

On Sun, 2003-03-16 at 09:43, Jesse Peterson wrote:
>    Mar 15 23:36:37 pos imap(testuser): Failed to create storage with 
> data: ::
>    Mar 15 23:36:37 pos dovecot: child 23150 (imap) returned error 89
> 
> A typical entry in the imap.passwd:
>    testuser:<md5>[34]:12345:12345::/some/home/directory/testuser:0::

Bug, fixed. You could also just remove the last two ':' characters.


From tss@iki.fi  Sun Mar 16 16:40:37 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 16 Mar 2003 16:40:37 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 3576E23993
	for <dovecot@procontrol.fi>; Sun, 16 Mar 2003 16:40:37 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id EBCA95E01F95; Sun, 16 Mar 2003 16:40:36 +0200 (EET)
Subject: [dovecot] Re: Failed to create storage with data: ::
From: Timo Sirainen <tss@iki.fi>
To: Jesse Peterson <jpeterson275@attbi.com>
Cc: Dovecot Mail List <dovecot@procontrol.fi>
In-Reply-To: <3E742B17.7000708@attbi.com>
References: <3E742B17.7000708@attbi.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1047825635.26219.0.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 16 Mar 2003 16:40:36 +0200
X-archive-position: 397
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 397                                                  
Status: O

On Sun, 2003-03-16 at 09:43, Jesse Peterson wrote:
>    Mar 15 23:36:37 pos imap(testuser): Failed to create storage with 
> data: ::
>    Mar 15 23:36:37 pos dovecot: child 23150 (imap) returned error 89

> A typical entry in the imap.passwd:
>    testuser:<md5>[34]:12345:12345::/some/home/directory/testuser:0::

passwd-file parser was buggy, fixed. You could also remove the last two
':' chars to fix it.


From jpeterson275@attbi.com  Sun Mar 16 21:17:31 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 16 Mar 2003 21:17:32 +0200 (EET)
Return-Path: <jpeterson275@attbi.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from rwcrmhc53.attbi.com (rwcrmhc53.attbi.com [204.127.198.39])
	by danu.procontrol.fi (Postfix) with ESMTP id 6886B238D5
	for <dovecot@procontrol.fi>; Sun, 16 Mar 2003 21:17:31 +0200 (EET)
Received: from attbi.com (12-228-143-121.client.attbi.com[12.228.143.121])
          by rwcrmhc53.attbi.com (rwcrmhc53) with SMTP
          id <2003031619172905300amug4e>; Sun, 16 Mar 2003 19:17:29 +0000
Message-ID: <3E74CDC7.7000508@attbi.com>
Date: Sun, 16 Mar 2003 11:17:27 -0800
From: Jesse Peterson <jpeterson275@attbi.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Re: Failed to create storage with data: ::
References: <3E742B17.7000708@attbi.com> <1047825635.26219.0.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 398
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jpeterson275@attbi.com
Precedence: bulk
X-list: dovecot
X-UID: 398                                                  
Status: O

I may have, but I constructed the file to the spec @:

http://dovecot.procontrol.fi/doc/auth.txt

=)

Timo Sirainen wrote:
> passwd-file parser was buggy, fixed. You could also remove the last two
> ':' chars to fix it.
> 


From jpeterson275@attbi.com  Mon Mar 17 02:24:38 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 17 Mar 2003 02:24:38 +0200 (EET)
Return-Path: <jpeterson275@attbi.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from rwcrmhc53.attbi.com (rwcrmhc53.attbi.com [204.127.198.39])
	by danu.procontrol.fi (Postfix) with ESMTP id 1465423839
	for <dovecot@procontrol.fi>; Mon, 17 Mar 2003 02:24:38 +0200 (EET)
Received: from attbi.com (12-228-143-121.client.attbi.com[12.228.143.121])
          by rwcrmhc53.attbi.com (rwcrmhc53) with SMTP
          id <2003031700243605300hdub6e>; Mon, 17 Mar 2003 00:24:36 +0000
Message-ID: <3E7515C2.90803@attbi.com>
Date: Sun, 16 Mar 2003 16:24:34 -0800
From: Jesse Peterson <jpeterson275@attbi.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Re: Failed to create storage with data: ::
References: <3E742B17.7000708@attbi.com> <1047825635.26219.0.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 399
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jpeterson275@attbi.com
Precedence: bulk
X-list: dovecot
X-UID: 399                                                  
Status: O

Hrm, I got the new files from CVS, but still:
Mar 16 16:19:08 pos imap(testuser): Failed to create storage with data: :
Mar 16 16:19:08 pos dovecot: child 24513 (imap) returned error 89

(note: one colon instead of two)
So I have to ask, is this still the correct usage:

user:password:uid:gid:(gecos):home:(shell):flags:mail
(from http://dovecot.procontrol.fi/doc/auth.txt)

Or are flags and mail not used?  How exactly is mail supposed to 
function and related to home?



Timo Sirainen wrote:
> On Sun, 2003-03-16 at 09:43, Jesse Peterson wrote:
> 
>>   Mar 15 23:36:37 pos imap(testuser): Failed to create storage with 
>>data: ::
>>   Mar 15 23:36:37 pos dovecot: child 23150 (imap) returned error 89
> 
> 
>>A typical entry in the imap.passwd:
>>   testuser:<md5>[34]:12345:12345::/some/home/directory/testuser:0::
> 
> 
> passwd-file parser was buggy, fixed. You could also remove the last two
> ':' chars to fix it.
> 
> 

-- 
Jesse Peterson  /  jesse@pixeltechs.com


From tss@iki.fi  Mon Mar 17 02:41:19 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 17 Mar 2003 02:41:19 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id AB77E238D5
	for <dovecot@procontrol.fi>; Mon, 17 Mar 2003 02:41:19 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 6D0235E01F94; Mon, 17 Mar 2003 02:41:19 +0200 (EET)
Subject: [dovecot] Re: Failed to create storage with data: ::
From: Timo Sirainen <tss@iki.fi>
To: Dovecot Mail List <dovecot@procontrol.fi>
In-Reply-To: <3E7515C2.90803@attbi.com>
References: <3E742B17.7000708@attbi.com> <1047825635.26219.0.camel@hurina>
	 <3E7515C2.90803@attbi.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1047861679.26217.7.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 17 Mar 2003 02:41:19 +0200
X-archive-position: 400
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 400                                                  
Status: O
Content-Length: 1160

On Mon, 2003-03-17 at 02:24, Jesse Peterson wrote:
> Hrm, I got the new files from CVS, but still:
> Mar 16 16:19:08 pos imap(testuser): Failed to create storage with data: :
> Mar 16 16:19:08 pos dovecot: child 24513 (imap) returned error 89
> 
> (note: one colon instead of two)
> So I have to ask, is this still the correct usage:
> 
> user:password:uid:gid:(gecos):home:(shell):flags:mail
> (from http://dovecot.procontrol.fi/doc/auth.txt)

Hmm. Strange. It is correct, and this works with me:

cras:{md5}$1$foo$A63FZiSi5N4yna6JuqND//:1000:1000::/home/cras:::

mail field is a bit special because it needs ':' characters itself,
that's why I don't just stop parsing if there's extra ':' characters at
end.

> Or are flags and mail not used?  How exactly is mail supposed to 
> function and related to home?

Either you give home or mail. mail can specify exactly where the mail
is, home is used just for autodetection. So you could give each user
different location for their mails, eg.:

user1:....:mbox:~/mail:INBOX=/var/mail/user1
user2:....:mbox:~/Mail
user3:....:Maildir:~/Maildir

Autodetection seems to work pretty well so it's not usually needed.


From jpeterson275@attbi.com  Mon Mar 17 03:08:31 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 17 Mar 2003 03:08:31 +0200 (EET)
Return-Path: <jpeterson275@attbi.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from rwcrmhc52.attbi.com (rwcrmhc52.attbi.com [216.148.227.88])
	by danu.procontrol.fi (Postfix) with ESMTP id 9F5C2238D5
	for <dovecot@procontrol.fi>; Mon, 17 Mar 2003 03:08:30 +0200 (EET)
Received: from attbi.com (12-228-143-121.client.attbi.com[12.228.143.121])
          by rwcrmhc52.attbi.com (rwcrmhc52) with SMTP
          id <2003031701082905200ptinbe>; Mon, 17 Mar 2003 01:08:29 +0000
Message-ID: <3E75200A.2010407@attbi.com>
Date: Sun, 16 Mar 2003 17:08:26 -0800
From: Jesse Peterson <jpeterson275@attbi.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Re: Failed to create storage with data: ::
References: <3E742B17.7000708@attbi.com> <1047825635.26219.0.camel@hurina>	 <3E7515C2.90803@attbi.com> <1047861679.26217.7.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 401
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jpeterson275@attbi.com
Precedence: bulk
X-list: dovecot
X-UID: 401                                                  
Status: O
Content-Length: 1553

I found the problem.  It seems as though my older dovecot installation
had passwd-file entries that looked like this:

testuser:<snip>:12345:12345::/mailhome/testuser:0:::

Note extra 0.  Snipping the 0 and a colon makes everything happy.



Timo Sirainen wrote:
 > On Mon, 2003-03-17 at 02:24, Jesse Peterson wrote:
 >
 >>Hrm, I got the new files from CVS, but still:
 >>Mar 16 16:19:08 pos imap(testuser): Failed to create storage with data: :
 >>Mar 16 16:19:08 pos dovecot: child 24513 (imap) returned error 89
 >>
 >>(note: one colon instead of two)
 >>So I have to ask, is this still the correct usage:
 >>
 >>user:password:uid:gid:(gecos):home:(shell):flags:mail
 >>(from http://dovecot.procontrol.fi/doc/auth.txt)
 >
 >
 > Hmm. Strange. It is correct, and this works with me:
 >
 > cras:{md5}$1$foo$A63FZiSi5N4yna6JuqND//:1000:1000::/home/cras:::
 >
 > mail field is a bit special because it needs ':' characters itself,
 > that's why I don't just stop parsing if there's extra ':' characters at
 > end.
 >
 >
 >>Or are flags and mail not used?  How exactly is mail supposed to
 >>function and related to home?
 >
 >
 > Either you give home or mail. mail can specify exactly where the mail
 > is, home is used just for autodetection. So you could give each user
 > different location for their mails, eg.:
 >
 > user1:....:mbox:~/mail:INBOX=/var/mail/user1
 > user2:....:mbox:~/Mail
 > user3:....:Maildir:~/Maildir
 >
 > Autodetection seems to work pretty well so it's not usually needed.
 >
 >
 >

-- 
Jesse Peterson  /  jesse@pixeltechs.com



From Leslie_Viljoen@icoc.org  Mon Mar 17 12:51:13 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 17 Mar 2003 12:51:13 +0200 (EET)
Return-Path: <Leslie_Viljoen@icoc.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from icchub.icoc.org (ns1.icoc.org [209.101.42.2])
	by danu.procontrol.fi (Postfix) with ESMTP id 40B55238D5
	for <dovecot@procontrol.fi>; Mon, 17 Mar 2003 12:51:12 +0200 (EET)
In-Reply-To: <20030314172924.L7268@iridium.mv.net>
Subject: [dovecot] Re: Configure SSL problem
To: "Mark E. Mallett" <mem@mv.mv.com>
Cc: dovecot@procontrol.fi
X-Mailer: Lotus Notes Release 6.0 September 26, 2002
Message-ID: <OF91BA0195.4F4A3575-ON42256CEC.00366598-42256CEC.003B7B72@icoc.org>
From: Leslie Viljoen <Leslie_Viljoen@icoc.org>
Date: Mon, 17 Mar 2003 12:46:54 +0200
X-MIMETrack: Serialize by Router on ICC_Hub/ICC(Release 6.0.1|February 07, 2003) at 03/17/2003
 02:51:15 AM
MIME-Version: 1.0
Content-type: text/plain; charset=US-ASCII
X-archive-position: 402
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: Leslie_Viljoen@icoc.org
Precedence: bulk
X-list: dovecot
X-UID: 402                                                  
Status: O
Content-Length: 3484






Thanks, I tried this, but it also didn't work.

OpenSSL's .h files are in /usr/local/ssl/include/openssl.
I copied all these .h files to /usr/local/ssl/include - and tried both
options below - but the configure
script still says "Building with SSL support........... no"

The problem seems to stem from:
checking for SSL_read in -lssl... (cached) no

My libcrypto.so and libssl.so files are in /usr/local/ssl/lib - this path
has been added
to /etc/ld.so.conf and I have run ldconfig.

Configure seems to be trying to compile this C file to test the SSL_read
function:

#line 7757 "configure"
#include "confdefs.h"
/* Override any gcc2 internal prototype to avoid an error.  */
/* We use char because int might match the return type of a gcc2
    builtin and then its argument prototype would still apply.  */
char SSL_read();

int main() {
SSL_read()
; return 0; }


I can compile this myself if I include -I /usr/local/ssl/include and I
replace the
"confdefs.h" with "ssl.h".

So I just don't know!

Les


______________________________________
Leslie Viljoen
Africa Missions Systems Administrator
Cell: 0836186100 Work: 011 6991700
Fax: 011 7945522


                                                                                                                                       
                      "Mark E. Mallett"                                                                                                
                      <mem@mv.mv.com>          To:       Leslie Viljoen <Leslie_Viljoen@icoc.org>                                      
                      Sent by:                 cc:       dovecot@procontrol.fi                                                         
                      dovecot-bounce@pr        Subject:  [dovecot] Re: Configure SSL problem                                           
                      ocontrol.fi                                                                                                      
                                                                                                                                       
                                                                                                                                       
                      2003-03-15 12:29                                                                                                 
                      AM                                                                                                               
                                                                                                                                       




On Thu, Mar 13, 2003 at 12:44:52PM +0200, Leslie Viljoen wrote:
>
>
>
>
> Hi everyone
>
> I have been trying to get Dovecot installed with OpenSSL support, but no
> matter what I do,
> when I run Configure, it says "Building with SSL support.........No".
> I have even tried configure --with-ssl=openssl, to no avail.
>
> I have built and installed OpenSSL, and libssl.so and libcrypto.so are in
> the /lib directory -
> what more does Dovecot want? I have tried figuring it out from the
> Configure script itself
> but it's cryptic and I am no shell script boffin!

Did your ssl include files get installed in the fairly standard
/usr/local/ssl/include ?  If so try something like:

   ./configure --with-ssl=openssl --includedir=/usr/local/ssl/include

Maybe "configure" could be trained to look there by default..

-mm-




From tss@iki.fi  Mon Mar 17 16:24:11 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 17 Mar 2003 16:24:11 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id C358C23839
	for <dovecot@procontrol.fi>; Mon, 17 Mar 2003 16:24:11 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 53AD05E03E53; Mon, 17 Mar 2003 16:24:11 +0200 (EET)
Subject: [dovecot] Re: Configure SSL problem
From: Timo Sirainen <tss@iki.fi>
To: Leslie Viljoen <Leslie_Viljoen@icoc.org>
Cc: dovecot@procontrol.fi
In-Reply-To: <OF91BA0195.4F4A3575-ON42256CEC.00366598-42256CEC.003B7B72@icoc.org>
References:
	 <OF91BA0195.4F4A3575-ON42256CEC.00366598-42256CEC.003B7B72@icoc.org>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1047911051.12401.36.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 17 Mar 2003 16:24:11 +0200
X-archive-position: 403
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 403                                                  
Status: O

On Mon, 2003-03-17 at 12:46, Leslie Viljoen wrote:
> The problem seems to stem from:
> checking for SSL_read in -lssl... (cached) no

Maybe it's just because of caching. Delete config.cache file.

> I can compile this myself if I include -I /usr/local/ssl/include and I
> replace the
> "confdefs.h" with "ssl.h".

Also you could try to run:

CPPFLAGS='-I /usr/local/ssl/include/' ./configure

(I don't know if --includedir helps with the configure checks, I should
try..)


From jaldhar@debian.org  Mon Mar 17 17:06:33 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 17 Mar 2003 17:06:33 +0200 (EET)
Return-Path: <jaldhar@debian.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail.braincells.com (samadhi.braincells.com [216.162.42.100])
	by danu.procontrol.fi (Postfix) with ESMTP id 3C3E9238D5
	for <dovecot@procontrol.fi>; Mon, 17 Mar 2003 17:06:32 +0200 (EET)
Received: from localhost (localhost [127.0.0.1])
	by mail.braincells.com (Postfix) with ESMTP id 9DCEE7F58
	for <dovecot@procontrol.fi>; Mon, 17 Mar 2003 10:06:31 -0500 (EST)
Date: Mon, 17 Mar 2003 10:06:31 -0500 (EST)
From: "Jaldhar H. Vyas" <jaldhar@debian.org>
X-X-Sender: jaldhar@samadhi.braincells.com
Reply-To: "Jaldhar H. Vyas" <jaldhar@debian.org>
To: dovecot@procontrol.fi
Subject: [dovecot] debian 0.99.8.1 packages available
Message-ID: <Pine.LNX.4.53.0303170952030.24562@jyoti.intranet.braincells.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 404
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jaldhar@debian.org
Precedence: bulk
X-list: dovecot
X-UID: 404                                                  
Status: O

I thought I'd mention it here because a lot of people have been waiting
for me on this.  My personal situation is getting saner now so I finally
was able to package up 0.99.8.1.  The package for sid was uploaded last
night and should appear in the archive today.  A backport for woody is
available from http://www.braincells.com/open/

I have not included POP3, LDAP or SASL2 support for now as I didn't want
anything to delay the package from entering the archive.  That will be the
next order of business.

The only bug I've seen so far is that when my mbox-format inbox was in
/home/jaldhar/mail/inbox dovecot thought it ha 0 messages.  It only showed
up properly after I moved it back to /var/spool/mail/jaldhar but I suspect
this is just a configuration error on my part.


-- 
Jaldhar H. Vyas <jaldhar@debian.org>
It's a girl! See the pictures - http://www.braincells.com/shailaja/

From jpeterson275@attbi.com  Mon Mar 17 22:01:38 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 17 Mar 2003 22:01:38 +0200 (EET)
Return-Path: <jpeterson275@attbi.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from sccrmhc01.attbi.com (sccrmhc01.attbi.com [204.127.202.61])
	by danu.procontrol.fi (Postfix) with ESMTP id 5EA4723839
	for <dovecot@procontrol.fi>; Mon, 17 Mar 2003 22:01:38 +0200 (EET)
Received: from attbi.com (12-228-143-121.client.attbi.com[12.228.143.121])
          by sccrmhc01.attbi.com (sccrmhc01) with SMTP
          id <20030317200128001008h9qge>; Mon, 17 Mar 2003 20:01:30 +0000
Message-ID: <3E76298F.4010609@attbi.com>
Date: Mon, 17 Mar 2003 12:01:19 -0800
From: Jesse Peterson <jpeterson275@attbi.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] big mail problems..
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 405
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jpeterson275@attbi.com
Precedence: bulk
X-list: dovecot
X-UID: 405                                                  
Status: O

Attachments, large mails & etc. seem to have problems with my 
installations of dovecot.  As we know, Mozilla likes to take it's mail 
in chunks, and after Mozilla, (or Mail.app, it likes to do this, too) 
takes its first chunk, it doesn't start getting the rest, even though 
ethereal tells me that dovecot OK'ed the 10K chunk.

9 UID fetch 4 (UID RFC822.SIZE BODY[]<0.10240>)
* 4 FETCH (UID 4 RFC822.SIZE 3958069 BODY[]<0> {3958069}
<snip>
9 OK Fetch completed.

Nothing gets transfered beyond this point.  I think this would be 
mozilla's fault, but I dont think this would happen with a release, and 
I dont think Mail.app would have the same problem, too.

Thanks for any help,

- Jesse


From tss@iki.fi  Tue Mar 18 02:34:29 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 18 Mar 2003 02:34:29 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 8E96623839
	for <dovecot@procontrol.fi>; Tue, 18 Mar 2003 02:34:29 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 3506C5E03E53; Tue, 18 Mar 2003 02:34:29 +0200 (EET)
Subject: [dovecot] Re: big mail problems..
From: Timo Sirainen <tss@iki.fi>
To: Dovecot Mail List <dovecot@procontrol.fi>
In-Reply-To: <3E76298F.4010609@attbi.com>
References: <3E76298F.4010609@attbi.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1047947668.12400.45.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 18 Mar 2003 02:34:29 +0200
X-archive-position: 406
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 406                                                  
Status: O

On Mon, 2003-03-17 at 22:01, Jesse Peterson wrote:
> 9 UID fetch 4 (UID RFC822.SIZE BODY[]<0.10240>)
> * 4 FETCH (UID 4 RFC822.SIZE 3958069 BODY[]<0> {3958069}

It gives too large size for the body data.
http://dovecot.procontrol.fi/partial.patch fixes.

I really should create some kind of testing suite which tests as much of
the commands/features as possible and shows if any of them fails..


From amyzing@talsever.com  Tue Mar 18 18:12:31 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 18 Mar 2003 18:12:31 +0200 (EET)
Return-Path: <amyzing@talsever.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from blount.mail.mindspring.net (blount.mail.mindspring.net [207.69.200.226])
	by danu.procontrol.fi (Postfix) with ESMTP id 1448523839
	for <dovecot@procontrol.fi>; Tue, 18 Mar 2003 18:12:31 +0200 (EET)
Received: from user-2ivf46j.dialup.mindspring.com ([165.247.144.211] helo=marajen.talsever.com)
	by blount.mail.mindspring.net with esmtp (Exim 3.33 #1)
	id 18vJhT-0007ER-00; Tue, 18 Mar 2003 11:12:27 -0500
Received: by marajen.talsever.com (Postfix, from userid 1000)
	id A2C4A809D; Tue, 18 Mar 2003 11:12:32 -0500 (EST)
Date: Tue, 18 Mar 2003 11:12:32 -0500
From: Amelia A Lewis <amyzing@talsever.com>
To: "Jaldhar H. Vyas" <jaldhar@debian.org>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: debian 0.99.8.1 packages available
Message-ID: <20030318161232.GA1537@talsever.com>
References: <Pine.LNX.4.53.0303170952030.24562@jyoti.intranet.braincells.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <Pine.LNX.4.53.0303170952030.24562@jyoti.intranet.braincells.com>
User-Agent: Mutt/1.5.3i
X-archive-position: 407
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: amyzing@talsever.com
Precedence: bulk
X-list: dovecot
X-UID: 407                                                  
Status: O
Content-Length: 1322

On Mon, Mar 17, 2003 at 10:06:31AM -0500, Jaldhar H. Vyas wrote:
>The only bug I've seen so far is that when my mbox-format inbox was in
>/home/jaldhar/mail/inbox dovecot thought it ha 0 messages.  It only showed
>up properly after I moved it back to /var/spool/mail/jaldhar but I suspect
>this is just a configuration error on my part.

I've got problems, that seem similar, using the 0.99.8.1 .deb.

I'm using Maildir.  I've got it set up on a user account to accept mail for
root (into .admin), for postmaster (into .admin.postmaster), and for
webmaster (.admin.webmaster).

mutt won't open .admin.  The message is "error trying to view file".  It
will let me open .admin as a container, so I can see the subfolders for
postmaster and webmaster, and it will let me open these.

sylpheed 0.8.5 (yes, an old version; I'll try a newer one later today when I
have access) shows admin as empty.  Completely empty, that is, even though
its new/ directory actually contains over twenty messages, and it should
display two subfolders.

So there's something very strange going on with navigation of folders, or so
it seems to me.

Amy!
-- 
Amelia A. Lewis                    amyzing {at} talsever.com
The flesh is strong.  The spirit stronger.  So shed your skin, baby.
Let it through.  Come on over.
                -- Amy Ray

From jaldhar@debian.org  Tue Mar 18 18:18:34 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 18 Mar 2003 18:18:34 +0200 (EET)
Return-Path: <jaldhar@debian.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail.braincells.com (samadhi.braincells.com [216.162.42.100])
	by danu.procontrol.fi (Postfix) with ESMTP id 4F49823839
	for <dovecot@procontrol.fi>; Tue, 18 Mar 2003 18:18:34 +0200 (EET)
Received: from localhost (localhost [127.0.0.1])
	by mail.braincells.com (Postfix) with ESMTP
	id A2ADA8043; Tue, 18 Mar 2003 11:18:33 -0500 (EST)
Date: Tue, 18 Mar 2003 11:18:33 -0500 (EST)
From: "Jaldhar H. Vyas" <jaldhar@debian.org>
X-X-Sender: jaldhar@samadhi.braincells.com
Reply-To: "Jaldhar H. Vyas" <jaldhar@debian.org>
To: Amelia A Lewis <amyzing@talsever.com>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: debian 0.99.8.1 packages available
In-Reply-To: <20030318161232.GA1537@talsever.com>
Message-ID: <Pine.LNX.4.53.0303181117010.7794@jyoti.intranet.braincells.com>
References: <Pine.LNX.4.53.0303170952030.24562@jyoti.intranet.braincells.com>
 <20030318161232.GA1537@talsever.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 408
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jaldhar@debian.org
Precedence: bulk
X-list: dovecot
X-UID: 408                                                  
Status: O
Content-Length: 1057

On Tue, 18 Mar 2003, Amelia A Lewis wrote:

> I've got problems, that seem similar, using the 0.99.8.1 .deb.
>
> I'm using Maildir.  I've got it set up on a user account to accept mail for
> root (into .admin), for postmaster (into .admin.postmaster), and for
> webmaster (.admin.webmaster).
>
> mutt won't open .admin.  The message is "error trying to view file".  It
> will let me open .admin as a container, so I can see the subfolders for
> postmaster and webmaster, and it will let me open these.
>
> sylpheed 0.8.5 (yes, an old version; I'll try a newer one later today when I
> have access) shows admin as empty.  Completely empty, that is, even though
> its new/ directory actually contains over twenty messages, and it should
> display two subfolders.
>
> So there's something very strange going on with navigation of folders, or so
> it seems to me.
>

Timo suggested I set the default_mail_env in the configuration file.

Btw Timo, that worked for me.

-- 
Jaldhar H. Vyas <jaldhar@debian.org>
La Salle Debain - http://www.braincells.com/debian/

From amyzing@talsever.com  Tue Mar 18 18:53:15 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 18 Mar 2003 18:53:15 +0200 (EET)
Return-Path: <amyzing@talsever.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mclean.mail.mindspring.net (mclean.mail.mindspring.net [207.69.200.57])
	by danu.procontrol.fi (Postfix) with ESMTP id 38B352385F
	for <dovecot@procontrol.fi>; Tue, 18 Mar 2003 18:53:15 +0200 (EET)
Received: from user-2ivf46j.dialup.mindspring.com ([165.247.144.211] helo=marajen.talsever.com)
	by mclean.mail.mindspring.net with esmtp (Exim 3.33 #1)
	id 18vKKv-0000Iu-00; Tue, 18 Mar 2003 11:53:14 -0500
Received: by marajen.talsever.com (Postfix, from userid 1000)
	id 9D104809D; Tue, 18 Mar 2003 11:53:19 -0500 (EST)
Date: Tue, 18 Mar 2003 11:53:19 -0500
From: Amelia A Lewis <amyzing@talsever.com>
To: "Jaldhar H. Vyas" <jaldhar@debian.org>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: debian 0.99.8.1 packages available
Message-ID: <20030318165319.GA1697@talsever.com>
References: <Pine.LNX.4.53.0303170952030.24562@jyoti.intranet.braincells.com> <20030318161232.GA1537@talsever.com> <Pine.LNX.4.53.0303181117010.7794@jyoti.intranet.braincells.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <Pine.LNX.4.53.0303181117010.7794@jyoti.intranet.braincells.com>
User-Agent: Mutt/1.5.3i
X-archive-position: 409
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: amyzing@talsever.com
Precedence: bulk
X-list: dovecot
X-UID: 409                                                  
Status: O
Content-Length: 1453

On Tue, Mar 18, 2003 at 11:18:33AM -0500, Jaldhar H. Vyas wrote:
>On Tue, 18 Mar 2003, Amelia A Lewis wrote:
>
>> I've got problems, that seem similar, using the 0.99.8.1 .deb.
>>
>> I'm using Maildir.  I've got it set up on a user account to accept mail for
>> root (into .admin), for postmaster (into .admin.postmaster), and for
>> webmaster (.admin.webmaster).
>>
>> mutt won't open .admin.  The message is "error trying to view file".  It
>> will let me open .admin as a container, so I can see the subfolders for
>> postmaster and webmaster, and it will let me open these.
>>
>> sylpheed 0.8.5 (yes, an old version; I'll try a newer one later today when I
>> have access) shows admin as empty.  Completely empty, that is, even though
>> its new/ directory actually contains over twenty messages, and it should
>> display two subfolders.
>>
>> So there's something very strange going on with navigation of folders, or so
>> it seems to me.
>>
>
>Timo suggested I set the default_mail_env in the configuration file.

Already set.  Finds the main folder.  It's just acting bizarre for folders
that hold both messages and child folders (as far as I can tell).

Amy!
-- 
Amelia A. Lewis                    amyzing {at} talsever.com
I don't want what's best for you--
    where will I be when you've found it?
        I pray a lot about these bad feelings inside
            but I can't pray my way through or around it.
                -- Emily Saliers

From amyzing@talsever.com  Tue Mar 18 19:05:17 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 18 Mar 2003 19:05:17 +0200 (EET)
Return-Path: <amyzing@talsever.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from hall.mail.mindspring.net (hall.mail.mindspring.net [207.69.200.60])
	by danu.procontrol.fi (Postfix) with ESMTP id D0E572385F
	for <dovecot@procontrol.fi>; Tue, 18 Mar 2003 19:05:16 +0200 (EET)
Received: from user-2ivf46j.dialup.mindspring.com ([165.247.144.211] helo=marajen.talsever.com)
	by hall.mail.mindspring.net with esmtp (Exim 3.33 #1)
	id 18vKWZ-0002vX-00; Tue, 18 Mar 2003 12:05:15 -0500
Received: by marajen.talsever.com (Postfix, from userid 1000)
	id 18CB7809D; Tue, 18 Mar 2003 12:05:21 -0500 (EST)
Date: Tue, 18 Mar 2003 12:05:20 -0500
From: Amelia A Lewis <amyzing@talsever.com>
To: "Jaldhar H. Vyas" <jaldhar@debian.org>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: debian 0.99.8.1 packages available
Message-ID: <20030318170520.GA1766@talsever.com>
References: <Pine.LNX.4.53.0303170952030.24562@jyoti.intranet.braincells.com> <20030318161232.GA1537@talsever.com> <Pine.LNX.4.53.0303181117010.7794@jyoti.intranet.braincells.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <Pine.LNX.4.53.0303181117010.7794@jyoti.intranet.braincells.com>
User-Agent: Mutt/1.5.3i
X-archive-position: 410
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: amyzing@talsever.com
Precedence: bulk
X-list: dovecot
X-UID: 410                                                  
Status: O
Content-Length: 1586

On Tue, Mar 18, 2003 at 11:18:33AM -0500, Jaldhar H. Vyas wrote:
>On Tue, 18 Mar 2003, Amelia A Lewis wrote:
>
>> I've got problems, that seem similar, using the 0.99.8.1 .deb.
>>
>> I'm using Maildir.  I've got it set up on a user account to accept mail for
>> root (into .admin), for postmaster (into .admin.postmaster), and for
>> webmaster (.admin.webmaster).

Update:

Created a folder, "test", using Sylpheed.  Okay.  Copied mail to it.  Okay. 
Tried to create subfolder "child".  Error; not created.  Created folder
"test2".  Okay.  Tried to create subfolder "child".  Error; not created.

Using mutt: created folder "test".  Okay.  Copied mail to it.  Okay.  Folder
opens; mail is visible.  Tried to create subfolder "child" (mutt prompts as
test.child, accept).  Okay.  test folder no longer visible as mail
container, but child folder is visible.

There's something weird happening when you put mail and subfolders in the
same folder.  Creating a subfolder means that any mail in the folder is no
longer accessible.  For whatever reason, sylpheed can't even see subfolders
(much less create them).

I could try to tcpdump this, but it won't help much, I'm afraid: it's set to
disable plaintext, so it always does starttls, which means the dump won't
have any interesting information.

Amy!
-- 
Amelia A. Lewis                    amyzing {at} talsever.com
I don't want what's best for you--
    where will I be when you've found it?
        I pray a lot about these bad feelings inside
            but I can't pray my way through or around it.
                -- Emily Saliers

From tss@iki.fi  Tue Mar 18 19:06:30 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 18 Mar 2003 19:06:30 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 8EA452385F
	for <dovecot@procontrol.fi>; Tue, 18 Mar 2003 19:06:30 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 47B3F5E01F94; Tue, 18 Mar 2003 19:06:29 +0200 (EET)
Subject: [dovecot] Re: debian 0.99.8.1 packages available
From: Timo Sirainen <tss@iki.fi>
To: Amelia A Lewis <amyzing@talsever.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030318161232.GA1537@talsever.com>
References:
	 <Pine.LNX.4.53.0303170952030.24562@jyoti.intranet.braincells.com>
	 <20030318161232.GA1537@talsever.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1048007189.863.22.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 18 Mar 2003 19:06:29 +0200
X-archive-position: 411
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 411                                                  
Status: O

On Tue, 2003-03-18 at 18:12, Amelia A Lewis wrote:
> I'm using Maildir.  I've got it set up on a user account to accept mail for
> root (into .admin), for postmaster (into .admin.postmaster), and for
> webmaster (.admin.webmaster).
> 
> mutt won't open .admin.  The message is "error trying to view file".  It
> will let me open .admin as a container, so I can see the subfolders for
> postmaster and webmaster, and it will let me open these.

It's probably because LIST handling is a bit buggy. If mutt asks LIST ""
admin.%, Dovecot replies that "admin." is \NoSelect folder. I haven't
yet got around to fixing this, I think I'll rewrite the LIST handling
once again..


From jpeterson275@attbi.com  Wed Mar 19 01:03:59 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 19 Mar 2003 01:04:00 +0200 (EET)
Return-Path: <jpeterson275@attbi.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from rwcrmhc52.attbi.com (rwcrmhc52.attbi.com [216.148.227.88])
	by danu.procontrol.fi (Postfix) with ESMTP id 48C412385F
	for <dovecot@procontrol.fi>; Wed, 19 Mar 2003 01:03:59 +0200 (EET)
Received: from attbi.com (12-228-143-121.client.attbi.com[12.228.143.121])
          by rwcrmhc52.attbi.com (rwcrmhc52) with SMTP
          id <2003031823035405200lsv6ne>; Tue, 18 Mar 2003 23:03:54 +0000
Message-ID: <3E77A5D0.5000100@attbi.com>
Date: Tue, 18 Mar 2003 15:03:44 -0800
From: Jesse Peterson <jpeterson275@attbi.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Re: big mail problems..
References: <3E76298F.4010609@attbi.com> <1047947668.12400.45.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 412
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jpeterson275@attbi.com
Precedence: bulk
X-list: dovecot
X-UID: 412                                                  
Status: O

Mail.app still has problems.  It gets the first chunk just fine:

9 UID FETCH 25 BODY.PEEK[]<0.8192>
* 25 FETCH (UID 25 BODY[]<0> {8192}
<snip>
9 OK Fetch completed.

But then it tries to do the decond chunk:

10 UID FETCH 25 BODY.PEEK[]<8192.6813>
* 25 FETCH (UID 25 BODY[]<8192> {6813}

)
10 OK Fetch completed.

8192 bytes requested and 2(?) returned?  Which is weird becuase it 
worked for other mails that were very large (MB+).

I know Mozilla does a little different method for grabbing chunks then 
does Mail.app, maybe that has something to do with it.

Thanks,

Timo Sirainen wrote:
> On Mon, 2003-03-17 at 22:01, Jesse Peterson wrote:
> 
>>9 UID fetch 4 (UID RFC822.SIZE BODY[]<0.10240>)
>>* 4 FETCH (UID 4 RFC822.SIZE 3958069 BODY[]<0> {3958069}
> 
> 
> It gives too large size for the body data.
> http://dovecot.procontrol.fi/partial.patch fixes.
> 
> I really should create some kind of testing suite which tests as much of
> the commands/features as possible and shows if any of them fails..
> 


From lfarkas@bnap.hu  Wed Mar 19 13:35:39 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 19 Mar 2003 13:35:39 +0200 (EET)
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 125E52385F
	for <dovecot@procontrol.fi>; Wed, 19 Mar 2003 13:35:39 +0200 (EET)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id BA3F8754025
	for <dovecot@procontrol.fi>; Wed, 19 Mar 2003 12:37:34 +0100 (CET)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id A814C3EE4
	for <dovecot@procontrol.fi>; Wed, 19 Mar 2003 12:35:36 +0100 (CET)
From: "Farkas Levente" <lfarkas@bnap.hu>
To: <dovecot@procontrol.fi>
Subject: [dovecot] some problem with dovecot
Date: Wed, 19 Mar 2003 12:35:37 +0100
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: 7bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2800.1106
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2800.1106
Message-Id: <20030319113734.BA3F8754025@mail1.bppiac.hu>
X-archive-position: 413
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 413                                                  
Status: O
Content-Length: 1465

hi,
yesterday we switch to courir to dovecot the whole company. there is good
and bad news. the good one that about 200 people use outlook and outlook
works fine (after we make some registry hack to delete the INBOX form imap
root folder, which was required for courier but not for dovecot). the bad
news we try most of the thing before the switch except outself. since the
whole it department use linux and mozilla. and almost nothing is working
with mozilla:
- first of all the folder list can't be subscribed i.e. only the top level
folder can be subscribed. can't subscribe to folder which has subfolders and
mail inside. all folders with has subfolders shonw as an empty name folder
under itself. and you can't select these folders in mozilla's subscribe
window (i.e you are not able to check it even it is there).
- you can't send any messages!!! since mozilla can't find the Sent folder
and can't move the mail after sending!!! even if you reconfigure mozilla to
use that "Sent" folder as Sent folder.
- you can't see the mails in a folder which has subfolders i.e. it seem
there is no message in that folders.
- we store mails in ~/Maildir/. dovecot create a ~/Maildir/.INBOX and put
the index files of the ~/Maildir/{cur,new,tmp} into that folder but for all
other folders it keep the index files in that folder's directory. it's realy
confusing.

this is _very_ anoying:-(((
is there any dirty trick to use mozilla?
when thses will be useable?

thanks.



From lfarkas@bnap.hu  Wed Mar 19 14:14:11 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 19 Mar 2003 14:14:11 +0200 (EET)
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 6164123839
	for <dovecot@procontrol.fi>; Wed, 19 Mar 2003 14:14:11 +0200 (EET)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id 5C0BF754013
	for <dovecot@procontrol.fi>; Wed, 19 Mar 2003 13:16:08 +0100 (CET)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id 0A7583EE4
	for <dovecot@procontrol.fi>; Wed, 19 Mar 2003 13:14:10 +0100 (CET)
From: "Farkas Levente" <lfarkas@bnap.hu>
To: <dovecot@procontrol.fi>
References: <20030319113734.BA3F8754025@mail1.bppiac.hu>
Subject: [dovecot] Re: some problem with dovecot
Date: Wed, 19 Mar 2003 13:14:14 +0100
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: 7bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2800.1106
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2800.1106
Message-Id: <20030319121608.5C0BF754013@mail1.bppiac.hu>
X-archive-position: 414
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 414                                                  
Status: O
Content-Length: 1902


----- Original Message -----
From: "Farkas Levente" <lfarkas@bnap.hu>
To: <dovecot@procontrol.fi>
Sent: Wednesday, March 19, 2003 12:35 PM
Subject: [dovecot] some problem with dovecot


> hi,
> yesterday we switch to courir to dovecot the whole company. there is good
> and bad news. the good one that about 200 people use outlook and outlook
> works fine (after we make some registry hack to delete the INBOX form imap
> root folder, which was required for courier but not for dovecot). the bad
> news we try most of the thing before the switch except outself. since the
> whole it department use linux and mozilla. and almost nothing is working
> with mozilla:
> - first of all the folder list can't be subscribed i.e. only the top level
> folder can be subscribed. can't subscribe to folder which has subfolders
and
> mail inside. all folders with has subfolders shonw as an empty name folder
> under itself. and you can't select these folders in mozilla's subscribe
> window (i.e you are not able to check it even it is there).
> - you can't send any messages!!! since mozilla can't find the Sent folder
> and can't move the mail after sending!!! even if you reconfigure mozilla
to
> use that "Sent" folder as Sent folder.
> - you can't see the mails in a folder which has subfolders i.e. it seem
> there is no message in that folders.
> - we store mails in ~/Maildir/. dovecot create a ~/Maildir/.INBOX and put
> the index files of the ~/Maildir/{cur,new,tmp} into that folder but for
all
> other folders it keep the index files in that folder's directory. it's
realy
> confusing.
>
> this is _very_ anoying:-(((
> is there any dirty trick to use mozilla?
> when thses will be useable?
>
> thanks.

other probles, that the outlook express can't be used when the folders
contains big messages (it's died during send/recv), but if we switch folder
setting headers only than it's works correctly.



From tss@iki.fi  Wed Mar 19 14:32:21 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 19 Mar 2003 14:32:21 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id C242223839
	for <dovecot@procontrol.fi>; Wed, 19 Mar 2003 14:32:21 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 0A2F25E01F94; Wed, 19 Mar 2003 14:32:20 +0200 (EET)
Subject: [dovecot] Re: some problem with dovecot
From: Timo Sirainen <tss@iki.fi>
To: Farkas Levente <lfarkas@bnap.hu>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030319121608.5C0BF754013@mail1.bppiac.hu>
References: <20030319113734.BA3F8754025@mail1.bppiac.hu>
	 <20030319121608.5C0BF754013@mail1.bppiac.hu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1048077140.848.19.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 19 Mar 2003 14:32:20 +0200
X-archive-position: 415
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 415                                                  
Status: O

On Wed, 2003-03-19 at 14:14, Farkas Levente wrote:
> > - we store mails in ~/Maildir/. dovecot create a ~/Maildir/.INBOX and put
> > the index files of the ~/Maildir/{cur,new,tmp} into that folder but for
> all
> > other folders it keep the index files in that folder's directory. it's
> realy
> > confusing.

I didn't really like having indexes stored in the root directory..

> other probles, that the outlook express can't be used when the folders
> contains big messages (it's died during send/recv), but if we switch folder
> setting headers only than it's works correctly.

Maybe it's because it tries partial fetches then. Did you apply the
patch for it?

I'll look at the other problems later today/tomorrow.. I think some
people have used Dovecot with Mozilla though. 


From rueckert@informatik.uni-rostock.de  Wed Mar 19 14:43:45 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 19 Mar 2003 14:43:45 +0200 (EET)
Return-Path: <rueckert@informatik.uni-rostock.de>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from monsters.dnsalias.net (vpn017022.uni-rostock.de [139.30.17.22])
	by danu.procontrol.fi (Postfix) with ESMTP id 4B4172385F
	for <dovecot@procontrol.fi>; Wed, 19 Mar 2003 14:43:45 +0200 (EET)
Received: by monsters.dnsalias.net (Postfix, from userid 500)
	id 74FDE1441E3; Wed, 19 Mar 2003 13:46:16 +0100 (CET)
Date: Wed, 19 Mar 2003 13:46:16 +0100
From: Marcus Rueckert <rueckert@informatik.uni-rostock.de>
To: Farkas Levente <lfarkas@bnap.hu>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: some problem with dovecot
Message-ID: <20030319124616.GA10729@irssi.ath.cx>
References: <20030319113734.BA3F8754025@mail1.bppiac.hu> <20030319121608.5C0BF754013@mail1.bppiac.hu> <1048077140.848.19.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1048077140.848.19.camel@hurina>
User-Agent: Mutt/1.5.3i
X-archive-position: 416
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: rueckert@informatik.uni-rostock.de
Precedence: bulk
X-list: dovecot
X-UID: 416                                                  
Status: O

On 2003-03-19 14:32:20 +0200, Timo Sirainen wrote:
> I'll look at the other problems later today/tomorrow.. I think some
> people have used Dovecot with Mozilla though. 

mozilla 1.3b + cvs 2003-03-18 is working well here. with the old
0.99.8.1 i had some problems with attachments. working well after
updating dovecot.

marcus

-- 
irssi - the client of the smart and beautiful people

              http://www.irssi.de/


From rueckert@informatik.uni-rostock.de  Wed Mar 19 15:58:10 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 19 Mar 2003 15:58:10 +0200 (EET)
Return-Path: <rueckert@informatik.uni-rostock.de>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from monsters.dnsalias.net (vpn017022.uni-rostock.de [139.30.17.22])
	by danu.procontrol.fi (Postfix) with ESMTP id 3A70523839
	for <dovecot@procontrol.fi>; Wed, 19 Mar 2003 15:58:10 +0200 (EET)
Received: by monsters.dnsalias.net (Postfix, from userid 500)
	id EF8EF1441E3; Wed, 19 Mar 2003 15:00:44 +0100 (CET)
Date: Wed, 19 Mar 2003 15:00:44 +0100
From: Marcus Rueckert <rueckert@informatik.uni-rostock.de>
To: Farkas Levente <lfarkas@bnap.hu>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: some problem with dovecot
Message-ID: <20030319140044.GB10729@irssi.ath.cx>
References: <20030319113734.BA3F8754025@mail1.bppiac.hu> <20030319121608.5C0BF754013@mail1.bppiac.hu> <1048077140.848.19.camel@hurina> <20030319124616.GA10729@irssi.ath.cx> <3E786802.10403@bnap.hu>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <3E786802.10403@bnap.hu>
User-Agent: Mutt/1.5.3i
X-archive-position: 417
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: rueckert@informatik.uni-rostock.de
Precedence: bulk
X-list: dovecot
X-UID: 417                                                  
Status: O

On 2003-03-19 13:52:18 +0100, Farkas Levente wrote:
> >mozilla 1.3b + cvs 2003-03-18 is working well here. with the old
> >0.99.8.1 i had some problems with attachments. working well after
> >updating dovecot.
> 
> we also use 1.3b but with 0.99.8.1, so I waiting for 0.100....

try CVS. maybe it solves your problems.

marcus

-- 
irssi - the client of the smart and beautiful people

              http://www.irssi.de/


From jaldhar@debian.org  Wed Mar 19 16:04:51 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 19 Mar 2003 16:04:51 +0200 (EET)
Return-Path: <jaldhar@debian.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail.braincells.com (samadhi.braincells.com [216.162.42.100])
	by danu.procontrol.fi (Postfix) with ESMTP id 52FBF23839
	for <dovecot@procontrol.fi>; Wed, 19 Mar 2003 16:04:51 +0200 (EET)
Received: from localhost (localhost [127.0.0.1])
	by mail.braincells.com (Postfix) with ESMTP id 1B6937F5E
	for <dovecot@procontrol.fi>; Wed, 19 Mar 2003 09:04:51 -0500 (EST)
Date: Wed, 19 Mar 2003 09:04:51 -0500 (EST)
From: "Jaldhar H. Vyas" <jaldhar@debian.org>
X-X-Sender: jaldhar@samadhi.braincells.com
Reply-To: "Jaldhar H. Vyas" <jaldhar@debian.org>
To: dovecot@procontrol.fi
Subject: [dovecot] Dotlocking doesn't work?
Message-ID: <Pine.LNX.4.53.0303190900030.1549@samadhi.braincells.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 418
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jaldhar@debian.org
Precedence: bulk
X-list: dovecot
X-UID: 418                                                  
Status: O


A Debian developer had this to say:

> >>  Files in the above dir are group mail, and the dir is group mail.  However,
> > > all binaries in /usr/lib/dovecot are root/root.  I have set them all to g+s,
> > > and group mail, and now the imap process can lock the INBOX.
> >
>
> > imap should be the only one that needs to be setgid mail.
>
> Actually, I've looked at the dovecot source code.  There is no way having
> setgid on the executable will work.  The source drops the privledges long
> before it tries to do a dotlock.
>
> This is an upstream problem.
>
> For now, I've disable dotlock, and use fcntl instead, as that is what exim
> uses anyways.

Is dotlocking still  a work in progress or are we missing something here?

-- 
Jaldhar H. Vyas <jaldhar@debian.org>
La Salle Debain - http://www.braincells.com/debian/

From tss@iki.fi  Wed Mar 19 16:23:41 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 19 Mar 2003 16:23:41 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 9EB8F23839
	for <dovecot@procontrol.fi>; Wed, 19 Mar 2003 16:23:41 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 5841C5E01F94; Wed, 19 Mar 2003 16:23:41 +0200 (EET)
Subject: [dovecot] Re: Dotlocking doesn't work?
From: Timo Sirainen <tss@iki.fi>
To: "Jaldhar H. Vyas" <jaldhar@debian.org>
Cc: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.53.0303190900030.1549@samadhi.braincells.com>
References: <Pine.LNX.4.53.0303190900030.1549@samadhi.braincells.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1048083821.850.30.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 19 Mar 2003 16:23:41 +0200
X-archive-position: 419
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 419                                                  
Status: O

On Wed, 2003-03-19 at 16:04, Jaldhar H. Vyas wrote:
> > >>  Files in the above dir are group mail, and the dir is group mail.  However,
> > > > all binaries in /usr/lib/dovecot are root/root.  I have set them all to g+s,
> > > > and group mail, and now the imap process can lock the INBOX.
> 
> Is dotlocking still  a work in progress or are we missing something here?

Only solution for now is to set /var/mail world-writable and sticky.

Another way would be to use more privileged process for handling lock
files. Some programs use setuid or setgid binary for that. I was
thinking that I'd let imap process request the locks from master
process. That would also allow overriding stale lock files created by
other users with shared mailboxes.


From jaldhar@debian.org  Wed Mar 19 16:30:34 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 19 Mar 2003 16:30:34 +0200 (EET)
Return-Path: <jaldhar@debian.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail.braincells.com (samadhi.braincells.com [216.162.42.100])
	by danu.procontrol.fi (Postfix) with ESMTP id A8ABB23839
	for <dovecot@procontrol.fi>; Wed, 19 Mar 2003 16:30:34 +0200 (EET)
Received: from localhost (localhost [127.0.0.1])
	by mail.braincells.com (Postfix) with ESMTP
	id 878BE7F5E; Wed, 19 Mar 2003 09:30:34 -0500 (EST)
Date: Wed, 19 Mar 2003 09:30:34 -0500 (EST)
From: "Jaldhar H. Vyas" <jaldhar@debian.org>
X-X-Sender: jaldhar@samadhi.braincells.com
Reply-To: "Jaldhar H. Vyas" <jaldhar@debian.org>
To: Timo Sirainen <tss@iki.fi>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: Dotlocking doesn't work?
In-Reply-To: <1048083821.850.30.camel@hurina>
Message-ID: <Pine.LNX.4.53.0303190926260.1549@samadhi.braincells.com>
References: <Pine.LNX.4.53.0303190900030.1549@samadhi.braincells.com>
 <1048083821.850.30.camel@hurina>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 420
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jaldhar@debian.org
Precedence: bulk
X-list: dovecot
X-UID: 420                                                  
Status: O

On Wed, 19 Mar 2003, Timo Sirainen wrote:

> Only solution for now is to set /var/mail world-writable and sticky.
>

Debian policy doesn't like that.

> Another way would be to use more privileged process for handling lock
> files. Some programs use setuid or setgid binary for that. I was
> thinking that I'd let imap process request the locks from master
> process. That would also allow overriding stale lock files created by
> other users with shared mailboxes.
>

I think this is a better idea overall.  It would reduce the amount of code
which needed elevated privileges and like you said, allow stale lock files
to be overriden.  I used to have that problem with uw-imap.

In the meantime, could you add something to the documentation about this
issue?

-- 
Jaldhar H. Vyas <jaldhar@debian.org>
La Salle Debain - http://www.braincells.com/debian/

From lfarkas@bnap.hu  Wed Mar 19 17:02:19 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 19 Mar 2003 17:02:19 +0200 (EET)
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 1A59C2385F
	for <dovecot@procontrol.fi>; Wed, 19 Mar 2003 17:02:19 +0200 (EET)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id 2D4D9754031
	for <dovecot@procontrol.fi>; Wed, 19 Mar 2003 16:04:16 +0100 (CET)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id CD78C3EE4
	for <dovecot@procontrol.fi>; Wed, 19 Mar 2003 16:02:16 +0100 (CET)
Message-ID: <3E788683.3040803@bnap.hu>
Date: Wed, 19 Mar 2003 16:02:27 +0100
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.3b) Gecko/20030211
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: dovecot@procontrol.fi
Subject: [dovecot] Re: some problem with dovecot
References: <20030319113734.BA3F8754025@mail1.bppiac.hu>	 <20030319121608.5C0BF754013@mail1.bppiac.hu> <1048077140.848.19.camel@hurina>
In-Reply-To: <1048077140.848.19.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 421
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 421                                                  
Status: O

Timo Sirainen wrote:
> On Wed, 2003-03-19 at 14:14, Farkas Levente wrote:
> 
>>>- we store mails in ~/Maildir/. dovecot create a ~/Maildir/.INBOX and put
>>>the index files of the ~/Maildir/{cur,new,tmp} into that folder but for
>>
>>all
>>
>>>other folders it keep the index files in that folder's directory. it's
>>
>>realy
>>
>>>confusing.
> 
> 
> I didn't really like having indexes stored in the root directory..

why?
there are other files in the root directory:
.subscriptions
.customflags
and in this case the directory stucture would be consistent.
what's more currently e.g. under mozilla's subscribe INDEX shown as a 
folder to be able to subscribe althougfh there is no such "real" mail 
folder. which is confusing. what's more what happens if someone would 
like to create a folder called INBOX? hmm...

-- 
   Levente                               "Si vis pacem para bellum!"



From jpeterson275@attbi.com  Wed Mar 19 19:30:30 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 19 Mar 2003 19:30:30 +0200 (EET)
Return-Path: <jpeterson275@attbi.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from rwcrmhc53.attbi.com (rwcrmhc53.attbi.com [204.127.198.39])
	by danu.procontrol.fi (Postfix) with ESMTP id C76512385F
	for <dovecot@procontrol.fi>; Wed, 19 Mar 2003 19:30:29 +0200 (EET)
Received: from attbi.com (12-228-143-121.client.attbi.com[12.228.143.121])
          by rwcrmhc53.attbi.com (rwcrmhc53) with SMTP
          id <2003031917302605300n1l0pe>; Wed, 19 Mar 2003 17:30:26 +0000
Message-ID: <3E78A928.1020708@attbi.com>
Date: Wed, 19 Mar 2003 09:30:16 -0800
From: Jesse Peterson <jpeterson275@attbi.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Re: some problem with dovecot
References: <20030319113734.BA3F8754025@mail1.bppiac.hu> <20030319121608.5C0BF754013@mail1.bppiac.hu>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 422
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jpeterson275@attbi.com
Precedence: bulk
X-list: dovecot
X-UID: 422                                                  
Status: O

Farkas Levente wrote:
> other probles, that the outlook express can't be used when the folders
> contains big messages (it's died during send/recv), but if we switch folder
> setting headers only than it's works corre

I think I found a repeatable symptom with large messages:

If you get any amount of small messages first (i think) it works fine. 
The first large message you get, dovecot messes on the second chunk 
requested.  If you just try that message again, dovecot fixes itself, 
and sends messages fine (i think).  Hope that helps, yet to test 
Mail.app.  I'll keep you posted!



-- 
Jesse Peterson  /  jesse@pixeltechs.com


From ianj@ian-justman.com  Wed Mar 19 19:50:39 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 19 Mar 2003 19:50:39 +0200 (EET)
Return-Path: <ianj@ian-justman.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from sakura.ian-justman.com (sakura.ian-justman.com [207.126.64.32])
	by danu.procontrol.fi (Postfix) with ESMTP id 32EE823839
	for <dovecot@procontrol.fi>; Wed, 19 Mar 2003 19:50:39 +0200 (EET)
Received: from spampd.localdomain (localhost [127.0.0.1])
	by localhost.ian-justman.com (Postfix) with ESMTP id 6D0B661129F
	for <dovecot@procontrol.fi>; Wed, 19 Mar 2003 09:50:37 -0800 (PST)
Received: from ian-justman.com (fenchurch.netasset.com [207.126.67.194])
	by sakura.ian-justman.com (Postfix) with ESMTP id 2C06B61129F
	for <dovecot@procontrol.fi>; Wed, 19 Mar 2003 09:50:34 -0800 (PST)
Message-ID: <3E78ADEA.8010908@ian-justman.com>
Date: Wed, 19 Mar 2003 09:50:34 -0800
From: "Ian R. Justman" <ianj@ian-justman.com>
Organization: Net Asset, Network Operations
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.0; en-US; rv:1.0.2) Gecko/20030208 Netscape/7.02
X-Accept-Language: en-us, en, ja
MIME-Version: 1.0
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Dotlocking doesn't work?
References: <Pine.LNX.4.53.0303190900030.1549@samadhi.braincells.com> <1048083821.850.30.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 423
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: ianj@ian-justman.com
Precedence: bulk
X-list: dovecot
X-UID: 423                                                  
Status: O
Content-Length: 1240



Timo Sirainen wrote:
> On Wed, 2003-03-19 at 16:04, Jaldhar H. Vyas wrote:
> 
>>>>> Files in the above dir are group mail, and the dir is group mail.  However,
>>>>>all binaries in /usr/lib/dovecot are root/root.  I have set them all to g+s,
>>>>>and group mail, and now the imap process can lock the INBOX.
>>>>
>>Is dotlocking still  a work in progress or are we missing something here?
> 
> 
> Only solution for now is to set /var/mail world-writable and sticky.
> 
> Another way would be to use more privileged process for handling lock
> files. Some programs use setuid or setgid binary for that. I was
> thinking that I'd let imap process request the locks from master
> process. That would also allow overriding stale lock files created by
> other users with shared mailboxes.

On this tack, this problem bit me yesterday when I migrated one of my 
public-access machines from Qpopper to Dovecot on the POP3 side of 
things.  The best way I could solve this, until something can be done 
for dotlocking is to use fcntl(2) for now.

Though I seem to remember some manner of warnings using fcntl(2). 
However, since none of my systems use NFS for their mailstores, I felt 
this is safe enough.  Any thoughts on this matter?

--Ian.


From charlieb-dovecot@e-smith.com  Thu Mar 20 03:30:56 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 20 Mar 2003 03:30:56 +0200 (EET)
Return-Path: <charlieb-dovecot@e-smith.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from nssg.mitel.com (mail.e-smith.com [216.191.234.126])
	by danu.procontrol.fi (Postfix) with SMTP id 20AF82385F
	for <dovecot@procontrol.fi>; Thu, 20 Mar 2003 03:30:56 +0200 (EET)
Received: (qmail 16961 invoked by uid 404); 20 Mar 2003 01:30:54 -0000
Received: from charlieb-dovecot@e-smith.com by tripe.nssg.mitel.com with qmail-scanner; 19 Mar 2003 20:30:53 -0000
Received: from allspice-core.nssg.mitel.com (HELO e-smith.com) (10.33.16.12)
  by tripe.nssg.mitel.com (10.33.17.11) with SMTP; 20 Mar 2003 01:30:53 -0000
Received: (qmail 14140 invoked by uid 5008); 20 Mar 2003 01:30:53 -0000
Received: from localhost (sendmail-bs@127.0.0.1)
  by localhost with SMTP; 20 Mar 2003 01:30:53 -0000
Date: Wed, 19 Mar 2003 20:30:53 -0500 (EST)
From: Charlie Brady <charlieb-dovecot@e-smith.com>
X-X-Sender: charlieb@allspice.nssg.mitel.com
To: Timo Sirainen <tss@iki.fi>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: inetd/xinetd/tcpserver support
In-Reply-To: <1046224359.30815.36.camel@hurina>
Message-ID: <Pine.LNX.4.44.0303192003510.28377-100000@allspice.nssg.mitel.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 424
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: charlieb-dovecot@e-smith.com
Precedence: bulk
X-list: dovecot
X-UID: 424                                                  
Status: O
Content-Length: 4270


On 26 Feb 2003, Timo Sirainen wrote:

> I was just thinking how they could be easily supported. This would work,
> right? :
> 
> imap stream tcp nowait root /usr/sbin/tcpd /usr/local/libexec/dovecot/imap-login
> imaps stream tcp nowait root /usr/sbin/tcpd /usr/local/libexec/dovecot/imap-login --ssl
> 
> imap-login would try to connect to master process using some named
> socket. If it couldn't, it would create the master process itself.
> Master process would work as usual (executes auth and imap processes),
> except it wouldn't be executing login processes.

I have a working tcpserver system, but one using a substantially different 
process mix. I haven't used imap-login at all, but have used 
imapfront-auth from Bruce Guenter's mailfront package 
(http://www.untroubled.org/mailfront/).

Here is the run script:

#!/bin/sh

concurrency=20
ulimitdata=3000000
CVM_SASL_PLAIN=cvm-local:/tmp/.cvm-unix-local
export CVM_SASL_PLAIN
CVM_ACCOUNT_SPLIT_CHARS=
export CVM_ACCOUNT_SPLIT_CHARS

exec 2>&1
exec \
  softlimit -m $ulimitdata \
  tcpserver -dHRvX \
  -c "$concurrency" \
  -x tcp.cdb \
  0 imap \
  /usr/bin/imapfront-auth \
  /usr/local/bin/imap


And here is the IMAP session:

* OK imapfront ready.
001 capability
* CAPABILITY IMAP4rev1 
001 OK CAPABILITY completed
002 login foo xxxxx
* PREAUTH [CAPABILITY IMAP4rev1 SORT THREAD=REFERENCES MULTIAPPEND 
UNSELECT LITERAL+ IDLE CHILDREN LISTEXT LIST-SUBSCRIBED] Logged in as foo
002 capability
* CAPABILITY IMAP4rev1 SORT THREAD=REFERENCES MULTIAPPEND UNSELECT 
LITERAL+ IDLE CHILDREN LISTEXT LIST-SUBSCRIBED
002 OK Capability completed.
003 select inbox
* FLAGS (\Answered \Flagged \Deleted \Seen \Draft)
* OK [PERMANENTFLAGS (\Answered \Flagged \Deleted \Seen \Draft \*)] Flags 
permitted.
* 4 EXISTS
* 0 RECENT
* OK [UIDVALIDITY 1045884314] UIDs valid
* OK [UIDNEXT 5] Predicted next UID
003 OK [READ-WRITE] Select completed.
004 create abox
004 OK Create completed.
005 select abox
* FLAGS (\Answered \Flagged \Deleted \Seen \Draft)
* OK [PERMANENTFLAGS (\Answered \Flagged \Deleted \Seen \Draft \*)] Flags 
permitted.
* 0 EXISTS
* 0 RECENT
* OK [UIDVALIDITY 1045885867] UIDs valid
* OK [UIDNEXT 1] Predicted next UID
005 OK [READ-WRITE] Select completed.
006 list "" % 
* LIST (\UnMarked) "." "Trash"
* LIST (\UnMarked) "." "foo"
* LIST (\UnMarked) "." "onebox"
* LIST (\UnMarked) "." "abox"
* LIST (\UnMarked) "." "INBOX"
006 OK List completed.
006 list "" ""
* LIST (\Noselect) "." ""
006 OK List completed.
007 logout
* BYE Logging out
007 OK Logout completed.

This setup can't do STARTTLS, but now that I have it working in plaintext,
I can look at adapting Scott Gifford's stunnel TLS proxy work:

http://www.suspectclass.com/~sgifford/stunnel-tlsproxy/stunnel-tlsproxy.html 

I don't expect this to be too difficult.
 
> This wouldn't require much code changing, and it would still be using
> all the same privilege separations as the standalone version so it would
> be just a secure.

Privilege separation is a very good thing. Is there any more detailed 
documentation of how you have done yours than 
http://dovecot.procontrol.fi/doc/design.txt?

You'll see that in the setup I've detailed above I am only using the 
"imap" binary from dovecot. I'm happy with the division of labour which 
has tcpserver doing network connection control, imapfront-auth+cvm doing 
authentication and uid switching, and imap doing mailbox access and IMAp 
protocol implementation. I expect to add stunnel doing TLS to that mix 
tomorrow. 

Can you provide any reasons why I should use your imap-master, imap-auth
and imap-login proceses rather than my mix'n'match setup? I'm confident 
that my setup has the simple, secure, reliable characteristics that I 
need, whereas I don't have the same confidence in your process set - it 
seems unnecessarily complex to me.

> Only thing I'm wondering is if any of the TCP wrappers care about the
> created child processes? The master process would have to stay alive
> after the connection that created it dies.

In general they will, as they will do connection counting. This is handled 
in my setup above, as each process execs the following one: tcpserver 
forks, and the child execs "imapfront-auth", which then authenticates and 
execs "imap". 

--
Charlie



From lfarkas@bnap.hu  Thu Mar 20 11:38:16 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 20 Mar 2003 11:38:16 +0200 (EET)
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 4C6832385F
	for <dovecot@procontrol.fi>; Thu, 20 Mar 2003 11:38:16 +0200 (EET)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id AFCAE754023
	for <dovecot@procontrol.fi>; Thu, 20 Mar 2003 10:40:21 +0100 (CET)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id E7F193EEC
	for <dovecot@procontrol.fi>; Thu, 20 Mar 2003 10:38:14 +0100 (CET)
Message-ID: <3E798C0E.8000409@bnap.hu>
Date: Thu, 20 Mar 2003 10:38:22 +0100
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.3b) Gecko/20030211
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: [dovecot] more problem with Sent
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 425
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 425                                                  
Status: O

hi,
ok it's turn out that not just mozilla not able to put the sent mails 
into the Sent folder but our webmail frontend (SquirrelMail) can't do 
it. so those who are using the webmail no longer able to use the mail 
system:-(((

-- 
   Levente                               "Si vis pacem para bellum!"



From rueckert@informatik.uni-rostock.de  Thu Mar 20 13:22:28 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 20 Mar 2003 13:22:28 +0200 (EET)
Return-Path: <rueckert@informatik.uni-rostock.de>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from monsters.dnsalias.net (vpn017022.uni-rostock.de [139.30.17.22])
	by danu.procontrol.fi (Postfix) with ESMTP id 07C192385F
	for <dovecot@procontrol.fi>; Thu, 20 Mar 2003 13:22:28 +0200 (EET)
Received: by monsters.dnsalias.net (Postfix, from userid 500)
	id BE25B1441E3; Thu, 20 Mar 2003 12:25:17 +0100 (CET)
Date: Thu, 20 Mar 2003 12:25:17 +0100
From: Marcus Rueckert <rueckert@informatik.uni-rostock.de>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: inetd/xinetd/tcpserver support
Message-ID: <20030320112517.GF10729@irssi.ath.cx>
References: <1046224359.30815.36.camel@hurina> <Pine.LNX.4.44.0303192003510.28377-100000@allspice.nssg.mitel.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <Pine.LNX.4.44.0303192003510.28377-100000@allspice.nssg.mitel.com>
User-Agent: Mutt/1.5.3i
X-archive-position: 426
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: rueckert@informatik.uni-rostock.de
Precedence: bulk
X-list: dovecot
X-UID: 426                                                  
Status: O
Content-Length: 2364

On 2003-03-19 20:30:53 -0500, Charlie Brady wrote:
> Privilege separation is a very good thing. Is there any more detailed
> documentation of how you have done yours than
> http://dovecot.procontrol.fi/doc/design.txt?
>
> You'll see that in the setup I've detailed above I am only using the
> "imap" binary from dovecot. I'm happy with the division of labour
> which
> has tcpserver doing network connection control, imapfront-auth+cvm
> doing
> authentication and uid switching, and imap doing mailbox access and
> IMAp
> protocol implementation. I expect to add stunnel doing TLS to that mix
> tomorrow.
>
> Can you provide any reasons why I should use your imap-master,
> imap-auth
> and imap-login proceses rather than my mix'n'match setup? I'm
> confident
> that my setup has the simple, secure, reliable characteristics that I
> need, whereas I don't have the same confidence in your process set -
> it
> seems unnecessarily complex to me.
>
> > Only thing I'm wondering is if any of the TCP wrappers care about
> > the
> > created child processes? The master process would have to stay alive
> > after the connection that created it dies.
>
> In general they will, as they will do connection counting. This is
> handled
> in my setup above, as each process execs the following one: tcpserver
> forks, and the child execs "imapfront-auth", which then authenticates
> and
> execs "imap".

hi
first of all i want to paste this

On Wed, 19 Mar 2003, Timo Sirainen wrote:
( Message-Id: <1048083821.850.30.camel@hurina> )
> Only solution for now is to set /var/mail world-writable and sticky.
> Another way would be to use more privileged process for handling lock
> files. Some programs use setuid or setgid binary for that. I was
> thinking that I'd let imap process request the locks from master
> process. That would also allow overriding stale lock files created by
> other users with shared mailboxes.

another point would be no reusing. you restart all processes on each
connection. if i count correctly:

1 tcpserver + 1 imapauth + 1 imap binary per connection

forked on every connect.

iirc correctly cras implemented resuing of the already spawned
processes. maybe a reason.

isnt there a lib offering tcp-server like functionality?

just my pi cents
darix

-- 
irssi - the client of the smart and beautiful people

              http://www.irssi.de/


From ggendel@sarnoff.com  Thu Mar 20 14:53:47 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 20 Mar 2003 14:53:47 +0200 (EET)
Return-Path: <ggendel@sarnoff.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from ace.sarnoff.com (ace.sarnoff.com [130.33.8.46])
	by danu.procontrol.fi (Postfix) with SMTP id 08C512385F
	for <dovecot@procontrol.fi>; Thu, 20 Mar 2003 14:53:47 +0200 (EET)
Received: from postoffice.sarnoff.com(130.33.10.147) by ace.sarnoff.com via csmap 
	 id 8703; Thu, 20 Mar 2003 07:53:22 -0500 (EST)
Received: from sarnoff.com ([130.33.205.137]) by
          postoffice.sarnoff.com (Netscape Messaging Server 4.15) with
          ESMTP id HC1T5S00.DLP for <dovecot@procontrol.fi>; Thu, 20 Mar
          2003 07:53:52 -0500 
Message-ID: <3E79B947.2010801@sarnoff.com>
Date: Thu, 20 Mar 2003 07:51:19 -0500
From: "GARY GENDEL" <ggendel@sarnoff.com>
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.0; en-US; rv:1.0.2) Gecko/20030208 Netscape/7.02
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: dovecot@procontrol.fi
Subject: [dovecot] Re: inetd/xinetd/tcpserver support
References: <1046224359.30815.36.camel@hurina> <Pine.LNX.4.44.0303192003510.28377-100000@allspice.nssg.mitel.com> <20030320112517.GF10729@irssi.ath.cx>
X-Enigmail-Version: 0.63.3.0
X-Enigmail-Supports: pgp-inline, pgp-mime
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 427
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: ggendel@sarnoff.com
Precedence: bulk
X-list: dovecot
X-UID: 427                                                  
Status: O
Content-Length: 2830



Marcus Rueckert wrote:
> On 2003-03-19 20:30:53 -0500, Charlie Brady wrote:
> 
>>Privilege separation is a very good thing. Is there any more detailed
>>documentation of how you have done yours than
>>http://dovecot.procontrol.fi/doc/design.txt?
>>
>>You'll see that in the setup I've detailed above I am only using the
>>"imap" binary from dovecot. I'm happy with the division of labour
>>which
>>has tcpserver doing network connection control, imapfront-auth+cvm
>>doing
>>authentication and uid switching, and imap doing mailbox access and
>>IMAp
>>protocol implementation. I expect to add stunnel doing TLS to that mix
>>tomorrow.
>>
>>Can you provide any reasons why I should use your imap-master,
>>imap-auth
>>and imap-login proceses rather than my mix'n'match setup? I'm
>>confident
>>that my setup has the simple, secure, reliable characteristics that I
>>need, whereas I don't have the same confidence in your process set -
>>it
>>seems unnecessarily complex to me.
>>
>>
>>>Only thing I'm wondering is if any of the TCP wrappers care about
>>>the
>>>created child processes? The master process would have to stay alive
>>>after the connection that created it dies.
>>
>>In general they will, as they will do connection counting. This is
>>handled
>>in my setup above, as each process execs the following one: tcpserver
>>forks, and the child execs "imapfront-auth", which then authenticates
>>and
>>execs "imap".
> 
> 
> hi
> first of all i want to paste this
> 
> On Wed, 19 Mar 2003, Timo Sirainen wrote:
> ( Message-Id: <1048083821.850.30.camel@hurina> )
> 
>>Only solution for now is to set /var/mail world-writable and sticky.
>>Another way would be to use more privileged process for handling lock
>>files. Some programs use setuid or setgid binary for that. I was
>>thinking that I'd let imap process request the locks from master
>>process. That would also allow overriding stale lock files created by
>>other users with shared mailboxes.
> 
> 
> another point would be no reusing. you restart all processes on each
> connection. if i count correctly:
> 
> 1 tcpserver + 1 imapauth + 1 imap binary per connection
> 
> forked on every connect.
> 
> iirc correctly cras implemented resuing of the already spawned
> processes. maybe a reason.

tcpserver has been used in the high-performance mail system, Qmail.  It 
really doesn't suffer as high an overhead as you think.  Three processes 
are not spawned, instead each one is replaced by the next in the same 
process space (using execv or execvp).  tcpserver either rejects the 
connection (based upon connecting IP rules), or adds specified variables 
to the environment and execs the next program in the chain.  imapauth 
negotiates login, fails or execs imap.  This kind of exec chaining has 
shown to be really efficient on unix/linux platforms.

Gary




From tss@iki.fi  Thu Mar 20 15:26:40 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 20 Mar 2003 15:26:40 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 383FB2385F
	for <dovecot@procontrol.fi>; Thu, 20 Mar 2003 15:26:40 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 01FEC5E01F94; Thu, 20 Mar 2003 15:26:39 +0200 (EET)
Subject: [dovecot] Re: inetd/xinetd/tcpserver support
From: Timo Sirainen <tss@iki.fi>
To: Charlie Brady <charlieb-dovecot@e-smith.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.44.0303192003510.28377-100000@allspice.nssg.mitel.com>
References:
	 <Pine.LNX.4.44.0303192003510.28377-100000@allspice.nssg.mitel.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1048166799.5765.93.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 20 Mar 2003 15:26:39 +0200
X-archive-position: 428
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 428                                                  
Status: O
Content-Length: 2777

On Thu, 2003-03-20 at 03:30, Charlie Brady wrote:
> I have a working tcpserver system, but one using a substantially different 
> process mix. I haven't used imap-login at all, but have used 
> imapfront-auth from Bruce Guenter's mailfront package 
> (http://www.untroubled.org/mailfront/).
> 
> 002 login foo xxxxx
> * PREAUTH [CAPABILITY IMAP4rev1 SORT THREAD=REFERENCES MULTIAPPEND 
> UNSELECT LITERAL+ IDLE CHILDREN LISTEXT LIST-SUBSCRIBED] Logged in as foo

There's one problem. Dovecot shouldn't reply with PREAUTH but "002 OK".
Mailfront gives the 002 in environment variable, so you'd have to modify
Dovecot to use it. Dovecot did before use such variable, but I changed
it later to send the OK before executing imap process. I don't really
remember why anymore, but I think there was a good reason :)

> Privilege separation is a very good thing. Is there any more detailed 
> documentation of how you have done yours than 
> http://dovecot.procontrol.fi/doc/design.txt?

Not really. And I'm not really sure how I could get it more detailed? :)
I think that tells the most relevant things.

> Can you provide any reasons why I should use your imap-master, imap-auth
> and imap-login proceses rather than my mix'n'match setup? I'm confident 
> that my setup has the simple, secure, reliable characteristics that I 
> need, whereas I don't have the same confidence in your process set - it 
> seems unnecessarily complex to me.

Well, your setup doesn't have privilege separation :) It runs as root
all the way until imap process is started. I looked at mailfront and it
looked good, but I wouldn't be that confident after you add SSL support.
There's been holes in OpenSSL library, and I think there's still more to
be found (or created). Security holes in it gives instant root access
with your setup, with Dovecot setup the process executing SSL is
non-privileged and chrooted so it's not very likely that attacker could
do much there.

Another problem with mailfront is that it doesn't support IMAP literals,
eg.:

x login {4}
user {4}
pass

I don't know if there's any clients that would do it, but it would be
valid for them.

> > Only thing I'm wondering is if any of the TCP wrappers care about the
> > created child processes? The master process would have to stay alive
> > after the connection that created it dies.
> 
> In general they will, as they will do connection counting. This is handled 
> in my setup above, as each process execs the following one: tcpserver 
> forks, and the child execs "imapfront-auth", which then authenticates and 
> execs "imap". 

I implemented this now so that imap-login executes, which forks a new
master process. imap-login dies after user logs in, but master stays
there. imap process is also forked by master process.


From lfarkas@bnap.hu  Thu Mar 20 15:41:33 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 20 Mar 2003 15:41:33 +0200 (EET)
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 5E92823839
	for <dovecot@procontrol.fi>; Thu, 20 Mar 2003 15:41:33 +0200 (EET)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id 65B8E754019
	for <dovecot@procontrol.fi>; Thu, 20 Mar 2003 14:41:31 +0100 (CET)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id ECED13EEC
	for <dovecot@procontrol.fi>; Thu, 20 Mar 2003 14:41:30 +0100 (CET)
Message-ID: <3E79C514.7090004@bnap.hu>
Date: Thu, 20 Mar 2003 14:41:40 +0100
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.3b) Gecko/20030211
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: [dovecot] Re: more problem with Sent
References: <3E798C0E.8000409@bnap.hu>
In-Reply-To: <3E798C0E.8000409@bnap.hu>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 429
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 429                                                  
Status: O

Farkas Levente wrote:
> hi,
> ok it's turn out that not just mozilla not able to put the sent mails 
> into the Sent folder but our webmail frontend (SquirrelMail) can't do 
> it. so those who are using the webmail no longer able to use the mail 
> system:-(((

or may be the problem with the attachmnet and the reason can be the same 
as with large file retriving...

-- 
   Levente                               "Si vis pacem para bellum!"



From tss@iki.fi  Thu Mar 20 15:42:17 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 20 Mar 2003 15:42:17 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 41A4E23839
	for <dovecot@procontrol.fi>; Thu, 20 Mar 2003 15:42:17 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 24C2F5E01F94; Thu, 20 Mar 2003 15:42:17 +0200 (EET)
Subject: [dovecot] Re: inetd/xinetd/tcpserver support
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <3E79B947.2010801@sarnoff.com>
References: <1046224359.30815.36.camel@hurina>
	 <Pine.LNX.4.44.0303192003510.28377-100000@allspice.nssg.mitel.com>
	 <20030320112517.GF10729@irssi.ath.cx>  <3E79B947.2010801@sarnoff.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1048167736.5765.111.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 20 Mar 2003 15:42:17 +0200
X-archive-position: 430
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 430                                                  
Status: O
Content-Length: 1971

On Thu, 2003-03-20 at 14:51, GARY GENDEL wrote:
> > iirc correctly cras implemented resuing of the already spawned
> > processes. maybe a reason.

No, I don't reuse processes. They could be reused within same UID, but
I'm not sure if it's good idea. At least if the UID is used by multiple
users, something sensitive could be left in process memory space from
previous user and that's not really good.

I've actually been thinking that I could make imap process completely
non-blocking which would allow using one process for multiple IMAP
connections for same user. The problem cases are mostly just APPEND
which blocks for input from user, and the commands which return a lot of
data and block on output. After fixing those, there's still the problem
that at least SEARCH could block because it's so slow. Maybe have two
processes, one handling slow/large queries, other handling quick
queries.

Well, there's still the annoying problem that by making the output
non-blocking, I'd have to be constantly calling poll() to see when I can
write more data. That's a lot of useless syscalls compared to the
current blocking model.

> tcpserver has been used in the high-performance mail system, Qmail.  It 
> really doesn't suffer as high an overhead as you think.  Three processes 
> are not spawned, instead each one is replaced by the next in the same 
> process space (using execv or execvp).  tcpserver either rejects the 
> connection (based upon connecting IP rules), or adds specified variables 
> to the environment and execs the next program in the chain.  imapauth 
> negotiates login, fails or execs imap.  This kind of exec chaining has 
> shown to be really efficient on unix/linux platforms.

It also has the problem that it has to run as root until user has
authenticated.

Dovecot can also be setup to use a single process to handle multiple
login connections. That means only a single fork+exec per connection,
and still never parsing user input as root.


From tss@iki.fi  Thu Mar 20 16:32:09 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 20 Mar 2003 16:32:09 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id F2CF923839
	for <dovecot@procontrol.fi>; Thu, 20 Mar 2003 16:32:08 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 41B6C5E01F94; Thu, 20 Mar 2003 16:32:08 +0200 (EET)
Subject: [dovecot] Re: more problem with Sent
From: Timo Sirainen <tss@iki.fi>
To: Farkas Levente <lfarkas@bnap.hu>
Cc: Dovecot List <dovecot@procontrol.fi>
In-Reply-To: <3E79C514.7090004@bnap.hu>
References: <3E798C0E.8000409@bnap.hu>  <3E79C514.7090004@bnap.hu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1048170728.5765.118.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 20 Mar 2003 16:32:08 +0200
X-archive-position: 431
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 431                                                  
Status: O

On Thu, 2003-03-20 at 15:41, Farkas Levente wrote:
> > ok it's turn out that not just mozilla not able to put the sent mails 
> > into the Sent folder but our webmail frontend (SquirrelMail) can't do 
> > it. so those who are using the webmail no longer able to use the mail 
> > system:-(((
> 
> or may be the problem with the attachmnet and the reason can be the same 
> as with large file retriving...

Well, at least try if the partial.patch fixes that, you can get it from
Dovecot's web page. Anyway, I think I have now time to look at the
problems, unless something happens to interrupt me..


From charlieb-dovecot@e-smith.com  Thu Mar 20 17:11:51 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 20 Mar 2003 17:11:51 +0200 (EET)
Return-Path: <charlieb-dovecot@e-smith.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from nssg.mitel.com (mail.e-smith.com [216.191.234.126])
	by danu.procontrol.fi (Postfix) with SMTP id 7C5FC2385F
	for <dovecot@procontrol.fi>; Thu, 20 Mar 2003 17:11:50 +0200 (EET)
Received: (qmail 28860 invoked by uid 404); 20 Mar 2003 15:11:49 -0000
Received: from charlieb-dovecot@e-smith.com by tripe.nssg.mitel.com with qmail-scanner; 20 Mar 2003 10:11:48 -0000
Received: from allspice-core.nssg.mitel.com (HELO e-smith.com) (10.33.16.12)
  by tripe.nssg.mitel.com (10.33.17.11) with SMTP; 20 Mar 2003 15:11:48 -0000
Received: (qmail 9474 invoked from network); 20 Mar 2003 15:11:48 -0000
Received: from vegemite.nssg.mitel.com (10.33.15.70)
  by allspice.nssg.mitel.com with QMQP; 20 Mar 2003 15:11:48 -0000
Received: from localhost (sendmail-bs@127.0.0.1)
  by localhost with SMTP; 20 Mar 2003 15:15:48 -0000
Date: Thu, 20 Mar 2003 10:15:48 -0500 (EST)
From: Charlie Brady <charlieb-dovecot@e-smith.com>
X-X-Sender: charlieb@vegemite.nssg.mitel.com
To: Marcus Rueckert <rueckert@informatik.uni-rostock.de>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: inetd/xinetd/tcpserver support
In-Reply-To: <20030320112517.GF10729@irssi.ath.cx>
Message-ID: <Pine.LNX.4.44.0303201009470.18300-100000@vegemite.nssg.mitel.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 432
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: charlieb-dovecot@e-smith.com
Precedence: bulk
X-list: dovecot
X-UID: 432                                                  
Status: O
Content-Length: 1585


[Please remember to trim down to minimum quoted text, guys]

On Thu, 20 Mar 2003, Marcus Rueckert wrote:

> > In general they will, as they will do connection counting. This is
> > handled
> > in my setup above, as each process execs the following one: tcpserver
> > forks, and the child execs "imapfront-auth", which then authenticates
> > and
> > execs "imap".
> 
> first of all i want to paste this
>
> On Wed, 19 Mar 2003, Timo Sirainen wrote:
> ( Message-Id: <1048083821.850.30.camel@hurina> )
> > Only solution for now is to set /var/mail world-writable and sticky.
> > Another way would be to use more privileged process for handling lock
> > files. Some programs use setuid or setgid binary for that. I was
> > thinking that I'd let imap process request the locks from master
> > process. That would also allow overriding stale lock files created by
> > other users with shared mailboxes.

You haven't said why you wanted to paste that. Could you explain please?

> another point would be no reusing. you restart all processes on each
> connection. if i count correctly:
> 
> 1 tcpserver + 1 imapauth + 1 imap binary per connection
> 
> forked on every connect.

You haven't counted correct, as someone has already pointed out (and as
indeed I did in the text you have quoted above).

> iirc correctly cras implemented resuing of the already spawned
> processes. maybe a reason.

I had to use google to find out what "cras" was. ["cras" is Timo.]

> isnt there a lib offering tcp-server like functionality?

Probably not, but I don't see the relevance anyway.

--
Charlie





From charlieb-dovecot@e-smith.com  Thu Mar 20 17:23:56 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 20 Mar 2003 17:23:56 +0200 (EET)
Return-Path: <charlieb-dovecot@e-smith.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from nssg.mitel.com (mail.e-smith.com [216.191.234.126])
	by danu.procontrol.fi (Postfix) with SMTP id 646822385F
	for <dovecot@procontrol.fi>; Thu, 20 Mar 2003 17:23:55 +0200 (EET)
Received: (qmail 923 invoked by uid 404); 20 Mar 2003 15:23:54 -0000
Received: from charlieb-dovecot@e-smith.com by tripe.nssg.mitel.com with qmail-scanner; 20 Mar 2003 10:23:53 -0000
Received: from allspice-core.nssg.mitel.com (HELO e-smith.com) (10.33.16.12)
  by tripe.nssg.mitel.com (10.33.17.11) with SMTP; 20 Mar 2003 15:23:52 -0000
Received: (qmail 13688 invoked from network); 20 Mar 2003 15:23:40 -0000
Received: from vegemite.nssg.mitel.com (10.33.15.70)
  by allspice.nssg.mitel.com with QMQP; 20 Mar 2003 15:23:40 -0000
Received: from localhost (sendmail-bs@127.0.0.1)
  by localhost with SMTP; 20 Mar 2003 15:27:39 -0000
Date: Thu, 20 Mar 2003 10:27:39 -0500 (EST)
From: Charlie Brady <charlieb-dovecot@e-smith.com>
X-X-Sender: charlieb@vegemite.nssg.mitel.com
To: Timo Sirainen <tss@iki.fi>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: inetd/xinetd/tcpserver support
In-Reply-To: <1048166799.5765.93.camel@hurina>
Message-ID: <Pine.LNX.4.44.0303201016400.18300-100000@vegemite.nssg.mitel.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 433
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: charlieb-dovecot@e-smith.com
Precedence: bulk
X-list: dovecot
X-UID: 433                                                  
Status: O
Content-Length: 3197


On 20 Mar 2003, Timo Sirainen wrote:

> On Thu, 2003-03-20 at 03:30, Charlie Brady wrote:
> > I have a working tcpserver system, but one using a substantially different 
> > process mix. I haven't used imap-login at all, but have used 
> > imapfront-auth from Bruce Guenter's mailfront package 
> > (http://www.untroubled.org/mailfront/).
> > 
> > 002 login foo xxxxx
> > * PREAUTH [CAPABILITY IMAP4rev1 SORT THREAD=REFERENCES MULTIAPPEND 
> > UNSELECT LITERAL+ IDLE CHILDREN LISTEXT LIST-SUBSCRIBED] Logged in as foo
> 
> There's one problem. Dovecot shouldn't reply with PREAUTH but "002 OK".
> Mailfront gives the 002 in environment variable, so you'd have to modify
> Dovecot to use it.

I realised that was a problem. I'm happy to hear that you have a solution 
:-)

> Dovecot did before use such variable, but I changed
> it later to send the OK before executing imap process. I don't really
> remember why anymore, but I think there was a good reason :)

Perhaps the reason is to be found in CVS change logs.

I'd really appreciate it if you could point out to me where I'd find the 
code which would make use of the variable.

> > Privilege separation is a very good thing. Is there any more detailed 
> > documentation of how you have done yours than 
> > http://dovecot.procontrol.fi/doc/design.txt?
> 
> Not really. And I'm not really sure how I could get it more detailed? :)
> I think that tells the most relevant things.

I guess I asked the wrong question. I shouldn't have asked "how" - I 
should have asked "why have you done it that way?". The system you have 
seems over complex. Simple solutions (if they work correctly) are always 
better.

> > Can you provide any reasons why I should use your imap-master, imap-auth
> > and imap-login proceses rather than my mix'n'match setup? I'm confident 
> > that my setup has the simple, secure, reliable characteristics that I 
> > need, whereas I don't have the same confidence in your process set - it 
> > seems unnecessarily complex to me.
> 
> Well, your setup doesn't have privilege separation :) It runs as root
> all the way until imap process is started. I looked at mailfront and it
> looked good, but I wouldn't be that confident after you add SSL support.
> There's been holes in OpenSSL library, and I think there's still more to
> be found (or created). Security holes in it gives instant root access
> with your setup,

Not so. See below.

> with Dovecot setup the process executing SSL is
> non-privileged and chrooted so it's not very likely that attacker could
> do much there.

If you have a look at Scott Gifford's work, he also runs SSL non-root and 
chrooted. I agree with you that that is a very significant improvement 
over established practice.

> Another problem with mailfront is that it doesn't support IMAP literals,
> eg.:
> 
> x login {4}
> user {4}
> pass
> 
> I don't know if there's any clients that would do it, but it would be
> valid for them.

Yes, that is a deficiency, but as you point out, probably not practically 
relevant at the moment. If it did become a problem, mailfront could be 
patched - it's GPL software, and Bruce Guenter can be persuaded to do
commissioned work.

--
Charlie



From lfarkas@bnap.hu  Thu Mar 20 17:27:02 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 20 Mar 2003 17:27:02 +0200 (EET)
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id C536C2385F
	for <dovecot@procontrol.fi>; Thu, 20 Mar 2003 17:27:01 +0200 (EET)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id 7ED2F75402A
	for <dovecot@procontrol.fi>; Thu, 20 Mar 2003 16:26:59 +0100 (CET)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id 739CD3EE4
	for <dovecot@procontrol.fi>; Thu, 20 Mar 2003 16:26:58 +0100 (CET)
Message-ID: <3E79DDCD.9000608@bnap.hu>
Date: Thu, 20 Mar 2003 16:27:09 +0100
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.3b) Gecko/20030211
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: [dovecot] Re: more problem with Sent
References: <3E798C0E.8000409@bnap.hu>  <3E79C514.7090004@bnap.hu> <1048170728.5765.118.camel@hurina>
In-Reply-To: <1048170728.5765.118.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 434
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 434                                                  
Status: O

Timo Sirainen wrote:
> On Thu, 2003-03-20 at 15:41, Farkas Levente wrote:
> 
>>>ok it's turn out that not just mozilla not able to put the sent mails 
>>>into the Sent folder but our webmail frontend (SquirrelMail) can't do 
>>>it. so those who are using the webmail no longer able to use the mail 
>>>system:-(((
>>
>>or may be the problem with the attachmnet and the reason can be the same 
>>as with large file retriving...
> 
> 
> Well, at least try if the partial.patch fixes that, you can get it from
> Dovecot's web page. Anyway, I think I have now time to look at the
> problems, unless something happens to interrupt me..

now I able to manage the compile a the latest cvs (libtool are hardcoded 
and other problems:-)
all problems remain:-(
- "only header" works in OE6 but "all messages" still not with mailbox 
with large messages.
- squirelmail can't senmd mails with attachments
- mozilla can't work.


-- 
   Levente                               "Si vis pacem para bellum!"



From charlieb-dovecot@e-smith.com  Thu Mar 20 17:44:41 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 20 Mar 2003 17:44:41 +0200 (EET)
Return-Path: <charlieb-dovecot@e-smith.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from nssg.mitel.com (mail.e-smith.com [216.191.234.126])
	by danu.procontrol.fi (Postfix) with SMTP id 02E2F23839
	for <dovecot@procontrol.fi>; Thu, 20 Mar 2003 17:44:41 +0200 (EET)
Received: (qmail 5805 invoked by uid 404); 20 Mar 2003 15:44:40 -0000
Received: from charlieb-dovecot@e-smith.com by tripe.nssg.mitel.com with qmail-scanner; 20 Mar 2003 10:44:39 -0000
Received: from allspice-core.nssg.mitel.com (HELO e-smith.com) (10.33.16.12)
  by tripe.nssg.mitel.com (10.33.17.11) with SMTP; 20 Mar 2003 15:44:38 -0000
Received: (qmail 19213 invoked from network); 20 Mar 2003 15:44:10 -0000
Received: from vegemite.nssg.mitel.com (10.33.15.70)
  by allspice.nssg.mitel.com with QMQP; 20 Mar 2003 15:44:10 -0000
Received: from localhost (sendmail-bs@127.0.0.1)
  by localhost with SMTP; 20 Mar 2003 15:48:10 -0000
Date: Thu, 20 Mar 2003 10:48:10 -0500 (EST)
From: Charlie Brady <charlieb-dovecot@e-smith.com>
X-X-Sender: charlieb@vegemite.nssg.mitel.com
To: dovecot@procontrol.fi
Subject: [dovecot] Re: inetd/xinetd/tcpserver support
In-Reply-To: <Pine.LNX.4.44.0303201016400.18300-100000@vegemite.nssg.mitel.com>
Message-ID: <Pine.LNX.4.44.0303201044000.18300-100000@vegemite.nssg.mitel.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 435
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: charlieb-dovecot@e-smith.com
Precedence: bulk
X-list: dovecot
X-UID: 435                                                  
Status: O
Content-Length: 2329


On Thu, 20 Mar 2003, Charlie Brady wrote:

> On 20 Mar 2003, Timo Sirainen wrote:
> 
> > Dovecot did before use such variable, but I changed
> > it later to send the OK before executing imap process. I don't really
> > remember why anymore, but I think there was a good reason :)
> 
> Perhaps the reason is to be found in CVS change logs.
> 
> I'd really appreciate it if you could point out to me where I'd find the 
> code which would make use of the variable.

Found it. Here's the change which broke mailfront compatibility:

revision 1.20
date: 2003/01/27 01:33:40;  author: cras;  state: Exp;  lines: +4 -5
We have now separate "userdb" and "passdb". They aren't tied to each 
others
in any way, so it's possible to use whatever user database with whatever
password database.

Added "static" userdb, which uses same uid/gid for everyone and generates
home directory from given template. This could be useful with PAM, 
although
insecure since everyone uses same uid.

Not too well tested, and userdb/passdb API still needs to be changed to
asynchronous for sql/ldap/etc lookups.


diff -u -r1.19 -r1.20
--- src/imap/main.c     5 Jan 2003 13:09:51 -0000       1.19
+++ src/imap/main.c     27 Jan 2003 01:33:40 -0000      1.20
@@ -12,7 +12,7 @@
 #include <syslog.h>
 
 #define IS_STANDALONE() \
-        (getenv("LOGIN_TAG") == NULL)
+        (getenv("LOGGED_IN") == NULL)
 
 struct ioloop *ioloop;
 static char log_prefix[128]; /* syslog() needs this to be permanent */
@@ -104,9 +104,6 @@
                client_send_line(client, t_strconcat(
                        "* PREAUTH [CAPABILITY "CAPABILITY_STRING"] "
                        "Logged in as ", getenv("USER"), NULL));
-       } else {
-               client_send_line(client, t_strconcat(getenv("LOGIN_TAG"),
-                                                    " OK Logged in.", 
NULL));
        }
 }
 
@@ -125,8 +122,10 @@
 int main(int argc __attr_unused__, char *argv[], char *envp[])
 {
 #ifdef DEBUG
-       if (getenv("LOGIN_TAG") != NULL)
+       if (getenv("LOGGED_IN") != NULL) {
                fd_debug_verify_leaks(3, 1024);
+               putenv("DISABLE_ALARMHUP=1"); /* annoying when debugging 
*/
+       }
 #endif
        /* NOTE: we start rooted, so keep the code minimal until
           restrict_access_by_env() is called */


--
Charlie



From tss@iki.fi  Thu Mar 20 19:09:58 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 20 Mar 2003 19:09:58 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id BAB202385F
	for <dovecot@procontrol.fi>; Thu, 20 Mar 2003 19:09:57 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 376815E01F95; Thu, 20 Mar 2003 19:09:57 +0200 (EET)
Subject: [dovecot] Re: more problem with Sent
From: Timo Sirainen <tss@iki.fi>
To: Farkas Levente <lfarkas@bnap.hu>
Cc: Dovecot List <dovecot@procontrol.fi>
In-Reply-To: <3E798C0E.8000409@bnap.hu>
References: <3E798C0E.8000409@bnap.hu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1048180196.5765.146.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 20 Mar 2003 19:09:57 +0200
X-archive-position: 436
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 436                                                  
Status: O

On Thu, 2003-03-20 at 11:38, Farkas Levente wrote:
> ok it's turn out that not just mozilla not able to put the sent mails 
> into the Sent folder but our webmail frontend (SquirrelMail) can't do 
> it. so those who are using the webmail no longer able to use the mail 
> system:-(((

Using LITERAL+ with APPEND was broken. That's at least why Mozilla
couldn't save messages. Fixed in CVS, and I also added patch to web
page.


From tss@iki.fi  Thu Mar 20 19:47:15 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 20 Mar 2003 19:47:15 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id E0C9523839
	for <dovecot@procontrol.fi>; Thu, 20 Mar 2003 19:47:14 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 895445E01F95; Thu, 20 Mar 2003 19:47:14 +0200 (EET)
Subject: [dovecot] Re: some problem with dovecot
From: Timo Sirainen <tss@iki.fi>
To: Farkas Levente <lfarkas@bnap.hu>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030319113734.BA3F8754025@mail1.bppiac.hu>
References: <20030319113734.BA3F8754025@mail1.bppiac.hu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1048182434.5760.177.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 20 Mar 2003 19:47:14 +0200
X-archive-position: 437
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 437                                                  
Status: O
Content-Length: 1282

On Wed, 2003-03-19 at 13:35, Farkas Levente wrote:
> - first of all the folder list can't be subscribed i.e. only the top level
> folder can be subscribed. can't subscribe to folder which has subfolders and
> mail inside. all folders with has subfolders shonw as an empty name folder
> under itself. and you can't select these folders in mozilla's subscribe
> window (i.e you are not able to check it even it is there).

Looks like mozilla is a bit buggy here. But Dovecot was too, fixed again
in CVS and patch in web page.

LIST "" foo.%
* LIST () "." "foo."
* LIST () "." "foo.bar"

Mozilla doesn't like the "foo." in the reply. IMAP protocol says that it
should be sent, but Courier and Cyrus doesn't send it either. Also this
was buggy in Dovecot anyway since it was always sent as \NoSelect
folder, which is why you couldn't subscribe to those folders.

Another strange thing that I see is:

3 list "" "%"
* LIST (\Children \UnMarked) "." "evolution"
..
4 list "" "%.%"
* LIST (\UnMarked) "." "evolution.juttu"
..
11 subscribe "evolution/juttu"
11 NO [TRYCREATE] Mailbox doesn't exist: evolution/juttu

Why does it try "/" separator? That's clearly mozilla bug. Actually
Dovecot is buggy there too, it shouldn't have said [TRYCREATE] since "/"
makes it invalid mailbox name..


From tss@iki.fi  Thu Mar 20 19:50:57 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 20 Mar 2003 19:50:57 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 42DC823839
	for <dovecot@procontrol.fi>; Thu, 20 Mar 2003 19:50:57 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 5349D5E01F95; Thu, 20 Mar 2003 19:50:56 +0200 (EET)
Subject: [dovecot] Re: some problem with dovecot
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <1048182434.5760.177.camel@hurina>
References: <20030319113734.BA3F8754025@mail1.bppiac.hu>
	 <1048182434.5760.177.camel@hurina>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1048182656.5765.179.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 20 Mar 2003 19:50:56 +0200
X-archive-position: 438
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 438                                                  
Status: O

On Thu, 2003-03-20 at 19:47, Timo Sirainen wrote:
> 11 NO [TRYCREATE] Mailbox doesn't exist: evolution/juttu
> 
> Why does it try "/" separator? That's clearly mozilla bug. Actually
> Dovecot is buggy there too, it shouldn't have said [TRYCREATE] since "/"
> makes it invalid mailbox name..

Whops, no it wasn't, I just had full_filesystem_access = yes.


From tss@iki.fi  Thu Mar 20 19:56:12 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 20 Mar 2003 19:56:12 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id DFA3D23839
	for <dovecot@procontrol.fi>; Thu, 20 Mar 2003 19:56:11 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 6B7EA5E01F95; Thu, 20 Mar 2003 19:56:11 +0200 (EET)
Subject: [dovecot] Re: debian 0.99.8.1 packages available
From: Timo Sirainen <tss@iki.fi>
To: Amelia A Lewis <amyzing@talsever.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030318170520.GA1766@talsever.com>
References:
	 <Pine.LNX.4.53.0303170952030.24562@jyoti.intranet.braincells.com>
	 <20030318161232.GA1537@talsever.com>
	 <Pine.LNX.4.53.0303181117010.7794@jyoti.intranet.braincells.com>
	 <20030318170520.GA1766@talsever.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1048182971.5760.181.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 20 Mar 2003 19:56:11 +0200
X-archive-position: 439
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 439                                                  
Status: O

On Tue, 2003-03-18 at 19:05, Amelia A Lewis wrote:
> There's something weird happening when you put mail and subfolders in the
> same folder.  Creating a subfolder means that any mail in the folder is no
> longer accessible.  For whatever reason, sylpheed can't even see subfolders
> (much less create them).

I think these are now fixed in CVS or list.patch in web page.


From tss@iki.fi  Thu Mar 20 20:09:13 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 20 Mar 2003 20:09:13 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 5EE4723839
	for <dovecot@procontrol.fi>; Thu, 20 Mar 2003 20:09:13 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 34C495E01F95; Thu, 20 Mar 2003 20:09:13 +0200 (EET)
Subject: [dovecot] Re: some problem with dovecot
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <3E788683.3040803@bnap.hu>
References: <20030319113734.BA3F8754025@mail1.bppiac.hu>
	 <20030319121608.5C0BF754013@mail1.bppiac.hu>
	 <1048077140.848.19.camel@hurina>  <3E788683.3040803@bnap.hu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1048183752.5765.195.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 20 Mar 2003 20:09:13 +0200
X-archive-position: 440
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 440                                                  
Status: O

On Wed, 2003-03-19 at 17:02, Farkas Levente wrote:
> > I didn't really like having indexes stored in the root directory..
> 
> why?
> there are other files in the root directory:
> .subscriptions
> .customflags
> and in this case the directory stucture would be consistent.

Originally I made the .INBOX because I thought that'd help me with
renaming INBOX, so I wouldn't have to rename() all files separately. But
I don't even try to support renaming INBOX anymore since it can't be
done atomically.

I guess I could just put everything in the root dir. But I think I'll do
it only after next release so UIDs won't get lost when it gets moved.


From ggendel@sarnoff.com  Thu Mar 20 20:26:42 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 20 Mar 2003 20:26:42 +0200 (EET)
Return-Path: <ggendel@sarnoff.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from ace.sarnoff.com (ace.sarnoff.com [130.33.8.46])
	by danu.procontrol.fi (Postfix) with SMTP id B0D3823839
	for <dovecot@procontrol.fi>; Thu, 20 Mar 2003 20:26:41 +0200 (EET)
Received: from postoffice.sarnoff.com(130.33.10.147) by ace.sarnoff.com via csmap 
	 id 1879; Thu, 20 Mar 2003 13:26:17 -0500 (EST)
Received: from sarnoff.com ([130.33.205.137]) by
          postoffice.sarnoff.com (Netscape Messaging Server 4.15) with
          ESMTP id HC28KM00.GP2; Thu, 20 Mar 2003 13:26:46 -0500 
Message-ID: <3E7A074C.9030506@sarnoff.com>
Date: Thu, 20 Mar 2003 13:24:12 -0500
From: "GARY GENDEL" <ggendel@sarnoff.com>
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.0; en-US; rv:1.0.2) Gecko/20030208 Netscape/7.02
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Timo Sirainen <tss@iki.fi>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Conformance testing
References: <20030319113734.BA3F8754025@mail1.bppiac.hu>	 <20030319121608.5C0BF754013@mail1.bppiac.hu>	 <1048077140.848.19.camel@hurina>  <3E788683.3040803@bnap.hu> <1048183752.5765.195.camel@hurina>
X-Enigmail-Version: 0.63.3.0
X-Enigmail-Supports: pgp-inline, pgp-mime
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 441
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: ggendel@sarnoff.com
Precedence: bulk
X-list: dovecot
X-UID: 441                                                  
Status: O

Timo,

I tried Dovecot and think it has some real potential.  The version I 
used had some flakey operation and some correspond to the problems other 
people are reporting.  It could use more documentation so we can come up 
to speed properly to help develop, test, and expand it's capabilities.

As for all the issues with IMAP... Have you tried the following program 
to test dovecot's conformance?

http://www.alphaworks.ibm.com/tech/serverconformancetester

If not, I suggest it would be worthwhile.  This is the program that 
UW-IMAP and others use to verify their system.

Gary



From tss@iki.fi  Thu Mar 20 20:46:12 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 20 Mar 2003 20:46:12 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 0DD442385F
	for <dovecot@procontrol.fi>; Thu, 20 Mar 2003 20:46:12 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id DAA6E5E01F95; Thu, 20 Mar 2003 20:46:11 +0200 (EET)
Subject: [dovecot] Re: inetd/xinetd/tcpserver support
From: Timo Sirainen <tss@iki.fi>
To: Charlie Brady <charlieb-dovecot@e-smith.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.44.0303201016400.18300-100000@vegemite.nssg.mitel.com>
References:
	 <Pine.LNX.4.44.0303201016400.18300-100000@vegemite.nssg.mitel.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1048185971.5765.230.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 20 Mar 2003 20:46:11 +0200
X-archive-position: 442
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 442                                                  
Status: O
Content-Length: 1055

On Thu, 2003-03-20 at 17:27, Charlie Brady wrote:
> > > Privilege separation is a very good thing. Is there any more detailed 
> > > documentation of how you have done yours than 
> > > http://dovecot.procontrol.fi/doc/design.txt?
> > 
> > Not really. And I'm not really sure how I could get it more detailed? :)
> > I think that tells the most relevant things.
> 
> I guess I asked the wrong question. I shouldn't have asked "how" - I 
> should have asked "why have you done it that way?". The system you have 
> seems over complex. Simple solutions (if they work correctly) are always 
> better.

It's mostly about running things with least required privileges. I don't
think it's really complex either, only thing that makes it more complex
is IPC.

The current way also makes it possible to having long running auth and
login processes. Especially long running auth process can give much
higher performance since it doesn't have to keep reconnecting to LDAP or
SQL server, or keep reopening and reparsing some passwd files every time
a user logs in.


From charlieb-dovecot@e-smith.com  Thu Mar 20 21:02:01 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 20 Mar 2003 21:02:01 +0200 (EET)
Return-Path: <charlieb-dovecot@e-smith.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from nssg.mitel.com (mail.e-smith.com [216.191.234.126])
	by danu.procontrol.fi (Postfix) with SMTP id 9062D2385F
	for <dovecot@procontrol.fi>; Thu, 20 Mar 2003 21:02:00 +0200 (EET)
Received: (qmail 29569 invoked by uid 404); 20 Mar 2003 19:01:59 -0000
Received: from charlieb-dovecot@e-smith.com by tripe.nssg.mitel.com with qmail-scanner; 20 Mar 2003 14:01:59 -0000
Received: from allspice-core.nssg.mitel.com (HELO e-smith.com) (10.33.16.12)
  by tripe.nssg.mitel.com (10.33.17.11) with SMTP; 20 Mar 2003 19:01:58 -0000
Received: (qmail 19501 invoked from network); 20 Mar 2003 19:01:58 -0000
Received: from vegemite.nssg.mitel.com (10.33.15.70)
  by allspice.nssg.mitel.com with QMQP; 20 Mar 2003 19:01:58 -0000
Received: from localhost (sendmail-bs@127.0.0.1)
  by localhost with SMTP; 20 Mar 2003 19:05:58 -0000
Date: Thu, 20 Mar 2003 14:05:57 -0500 (EST)
From: Charlie Brady <charlieb-dovecot@e-smith.com>
X-X-Sender: charlieb@vegemite.nssg.mitel.com
To: Timo Sirainen <tss@iki.fi>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Long running auth/login processes (was Re: Re: inetd/xinetd/tcpserver
 support)
In-Reply-To: <1048185971.5765.230.camel@hurina>
Message-ID: <Pine.LNX.4.44.0303201352410.18300-100000@vegemite.nssg.mitel.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 443
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: charlieb-dovecot@e-smith.com
Precedence: bulk
X-list: dovecot
X-UID: 443                                                  
Status: O


On 20 Mar 2003, Timo Sirainen wrote:

> The current way also makes it possible to having long running auth and
> login processes. Especially long running auth process can give much
> higher performance since it doesn't have to keep reconnecting to LDAP or
> SQL server, or keep reopening and reparsing some passwd files every time
> a user logs in.

Why do you care about long running login processes?

The long running auth process problem can be solved by using a unix domain
socket.  This is how Bruce Guenter's mailfront works. The authenticator 
runs long term, and listens to a socket (unix domain preferred, but there 
are other options). The login process is run from tcpserver, and gathers 
information from the client, and then connects to the authenticator and 
verified the information.

--
Charlie


From ggendel@sarnoff.com  Thu Mar 20 21:42:54 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 20 Mar 2003 21:42:54 +0200 (EET)
Return-Path: <ggendel@sarnoff.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from ace.sarnoff.com (ace.sarnoff.com [130.33.8.46])
	by danu.procontrol.fi (Postfix) with SMTP id 84F6323839
	for <dovecot@procontrol.fi>; Thu, 20 Mar 2003 21:42:53 +0200 (EET)
Received: from postoffice.sarnoff.com(130.33.10.147) by ace.sarnoff.com via csmap 
	 id 4391; Thu, 20 Mar 2003 14:42:29 -0500 (EST)
Received: from sarnoff.com ([130.33.205.137]) by
          postoffice.sarnoff.com (Netscape Messaging Server 4.15) with
          ESMTP id HC2C3M00.BRO for <dovecot@procontrol.fi>; Thu, 20 Mar
          2003 14:42:58 -0500 
Message-ID: <3E7A1928.1060007@sarnoff.com>
Date: Thu, 20 Mar 2003 14:40:24 -0500
From: "GARY GENDEL" <ggendel@sarnoff.com>
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.0; en-US; rv:1.0.2) Gecko/20030208 Netscape/7.02
X-Accept-Language: en-us, en
MIME-Version: 1.0
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: Conformance testing
References: <Pine.LNX.4.44.0303201417120.18300-100000@vegemite.nssg.mitel.com>
X-Enigmail-Version: 0.63.3.0
X-Enigmail-Supports: pgp-inline, pgp-mime
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 444
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: ggendel@sarnoff.com
Precedence: bulk
X-list: dovecot
X-UID: 444                                                  
Status: O

Charlie Brady wrote:
> On Thu, 20 Mar 2003, GARY GENDEL wrote:
> 
> 
>>As for all the issues with IMAP... Have you tried the following program 
>>to test dovecot's conformance?
>>
>>http://www.alphaworks.ibm.com/tech/serverconformancetester
>>
>>If not, I suggest it would be worthwhile.
> 
> 
> Only runs on WIN32 and AIX unfortunately.

True, but the server can be running on anything.  You must have a 
kickaround machine that has windows on it. :^(

Gary




From tss@iki.fi  Thu Mar 20 21:46:13 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 20 Mar 2003 21:46:13 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 1965A23839
	for <dovecot@procontrol.fi>; Thu, 20 Mar 2003 21:46:13 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id A80155E01F95; Thu, 20 Mar 2003 21:46:12 +0200 (EET)
Subject: [dovecot] Re: Long running auth/login processes (was Re: Re:
	inetd/xinetd/tcpserver support)
From: Timo Sirainen <tss@iki.fi>
To: Charlie Brady <charlieb-dovecot@e-smith.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.44.0303201352410.18300-100000@vegemite.nssg.mitel.com>
References:
	 <Pine.LNX.4.44.0303201352410.18300-100000@vegemite.nssg.mitel.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1048189572.5765.246.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 20 Mar 2003 21:46:12 +0200
X-archive-position: 445
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 445                                                  
Status: O
Content-Length: 1488

On Thu, 2003-03-20 at 21:05, Charlie Brady wrote:
> On 20 Mar 2003, Timo Sirainen wrote:
> 
> > The current way also makes it possible to having long running auth and
> > login processes. Especially long running auth process can give much
> > higher performance since it doesn't have to keep reconnecting to LDAP or
> > SQL server, or keep reopening and reparsing some passwd files every time
> > a user logs in.
> 
> Why do you care about long running login processes?

That gives less amount of total running processes since you don't need
extra one for handling SSL. It also does SSL initialization only once,
instead of once per connection. Sure, this could also be done by
separate long running SSL process.

Anyway, I don't really care much about it since it pretty much means
that exploiting it gives access to connections of all users.

> The long running auth process problem can be solved by using a unix domain
> socket.  This is how Bruce Guenter's mailfront works. The authenticator 
> runs long term, and listens to a socket (unix domain preferred, but there 
> are other options). The login process is run from tcpserver, and gathers 
> information from the client, and then connects to the authenticator and 
> verified the information.

So, is it really much different from my design then? Sounds like the
only difference is that it runs login code as root and exec()s imap
binary after login, where my code sends it through master process which
forks new imap process.


From charlieb@e-smith.com  Thu Mar 20 21:20:55 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 20 Mar 2003 21:46:54 +0200 (EET)
Return-Path: <charlieb@e-smith.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from nssg.mitel.com (mail.e-smith.com [216.191.234.126])
	by danu.procontrol.fi (Postfix) with SMTP id 931842385F
	for <dovecot@procontrol.fi>; Thu, 20 Mar 2003 21:20:54 +0200 (EET)
Received: (qmail 4468 invoked by uid 404); 20 Mar 2003 19:20:53 -0000
Received: from charlieb@e-smith.com by tripe.nssg.mitel.com with qmail-scanner; 20 Mar 2003 14:20:53 -0000
Received: from allspice-core.nssg.mitel.com (HELO e-smith.com) (10.33.16.12)
  by tripe.nssg.mitel.com (10.33.17.11) with SMTP; 20 Mar 2003 19:20:52 -0000
Received: (qmail 27591 invoked from network); 20 Mar 2003 19:20:03 -0000
Received: from vegemite.nssg.mitel.com (10.33.15.70)
  by allspice.nssg.mitel.com with QMQP; 20 Mar 2003 19:20:03 -0000
Received: from localhost (sendmail-bs@127.0.0.1)
  by localhost with SMTP; 20 Mar 2003 19:24:03 -0000
Date: Thu, 20 Mar 2003 14:24:03 -0500 (EST)
From: Charlie Brady <charlieb@e-smith.com>
X-X-Sender: charlieb@vegemite.nssg.mitel.com
To: GARY GENDEL <ggendel@sarnoff.com>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: Conformance testing
In-Reply-To: <3E7A074C.9030506@sarnoff.com>
Message-ID: <Pine.LNX.4.44.0303201417120.18300-100000@vegemite.nssg.mitel.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 446
X-Approved-By: tss@iki.fi
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: charlieb@e-smith.com
Precedence: bulk
X-list: dovecot
X-UID: 446                                                  
Status: O


On Thu, 20 Mar 2003, GARY GENDEL wrote:

> As for all the issues with IMAP... Have you tried the following program 
> to test dovecot's conformance?
> 
> http://www.alphaworks.ibm.com/tech/serverconformancetester
> 
> If not, I suggest it would be worthwhile.

Only runs on WIN32 and AIX unfortunately.

--
Charlie



From charlieb-dovecot@e-smith.com  Thu Mar 20 23:23:20 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 20 Mar 2003 23:23:20 +0200 (EET)
Return-Path: <charlieb-dovecot@e-smith.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from nssg.mitel.com (mail.e-smith.com [216.191.234.126])
	by danu.procontrol.fi (Postfix) with SMTP id 6FF782385F
	for <dovecot@procontrol.fi>; Thu, 20 Mar 2003 23:23:19 +0200 (EET)
Received: (qmail 29420 invoked by uid 404); 20 Mar 2003 21:23:18 -0000
Received: from charlieb-dovecot@e-smith.com by tripe.nssg.mitel.com with qmail-scanner; 20 Mar 2003 16:23:18 -0000
Received: from allspice-core.nssg.mitel.com (HELO e-smith.com) (10.33.16.12)
  by tripe.nssg.mitel.com (10.33.17.11) with SMTP; 20 Mar 2003 21:23:17 -0000
Received: (qmail 8318 invoked from network); 20 Mar 2003 21:23:17 -0000
Received: from vegemite.nssg.mitel.com (10.33.15.70)
  by allspice.nssg.mitel.com with QMQP; 20 Mar 2003 21:23:17 -0000
Received: from localhost (sendmail-bs@127.0.0.1)
  by localhost with SMTP; 20 Mar 2003 21:27:17 -0000
Date: Thu, 20 Mar 2003 16:27:17 -0500 (EST)
From: Charlie Brady <charlieb-dovecot@e-smith.com>
X-X-Sender: charlieb@vegemite.nssg.mitel.com
To: Timo Sirainen <tss@iki.fi>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: Long running auth/login processes (was Re: Re: inetd/xinetd/tcpserver
 support)
In-Reply-To: <1048189572.5765.246.camel@hurina>
Message-ID: <Pine.LNX.4.44.0303201559420.18300-100000@vegemite.nssg.mitel.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 447
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: charlieb-dovecot@e-smith.com
Precedence: bulk
X-list: dovecot
X-UID: 447                                                  
Status: O
Content-Length: 2910


On 20 Mar 2003, Timo Sirainen wrote:

> On Thu, 2003-03-20 at 21:05, Charlie Brady wrote:
> > 
> > Why do you care about long running login processes?
> 
> That gives less amount of total running processes since you don't need
> extra one for handling SSL.

You need two processes per connection or you don't have adequate privilege 
separation. In my case, I have one acting either as a cleartext proxy or 
as an SSL wrapper, and the other does authentication and then execs the 
imap daemon. How would you avoid one 

> It also does SSL initialization only once, instead of once per
> connection. Sure, this could also be done by separate long running SSL
> process.

Yes, it would be nice to do SSL initialization once, but I don't think the 
performance issue is enough to compomise the security and reliabilty of 
the system for.

> Anyway, I don't really care much about it since it pretty much means
> that exploiting it gives access to connections of all users.

So you don't want to have a long running login process after all?

> > The long running auth process problem can be solved by using a unix domain
> > socket.  This is how Bruce Guenter's mailfront works. The authenticator 
> > runs long term, and listens to a socket (unix domain preferred, but there 
> > are other options). The login process is run from tcpserver, and gathers 
> > information from the client, and then connects to the authenticator and 
> > verified the information.
> 
> So, is it really much different from my design then? 

I don't know, but I'm trying to learn. You know your design and your code;  
I'm just feeling my way around. Your documentation is good in parts, but
there are still big gaps. The installation documentation only covers
building - I have yet to find anything which tells me how to execute
dovecot (have I missed it?). I'm not sure which processes run when, and
exactly what communication occurs between them over what communication
channels.

> Sounds like the
> only difference is that it runs login code as root and exec()s imap
> binary after login, where my code sends it through master process which
> forks new imap process.

I don't know exactly what "sent it through master process" means. 

I have a preference for running simple software which I already have
reason to trust.  This is why I want to use tcpserver, and why I have a 
leaning towards using mailfront and cvm. I know that stunnel isn't 
completely wonderful, but it is very widely used, and the chroot feature 
added by Scott Gifford fixes the principal weakness.

I am looking for a better IMAP daemon than I have at present, but I would 
prefer not to have a new system of authentication, and a new network 
connection monitor. There is a lot of new (to me) code in dovecot, but the 
only code of high value to me is the imap daemon itself.

I hope this explains my line of questioning to you a little.

--
Charlie



From charlieb-dovecot@e-smith.com  Fri Mar 21 00:16:53 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 21 Mar 2003 00:16:53 +0200 (EET)
Return-Path: <charlieb-dovecot@e-smith.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from nssg.mitel.com (mail.e-smith.com [216.191.234.126])
	by danu.procontrol.fi (Postfix) with SMTP id BDD2C23839
	for <dovecot@procontrol.fi>; Fri, 21 Mar 2003 00:16:52 +0200 (EET)
Received: (qmail 16803 invoked by uid 404); 20 Mar 2003 22:16:52 -0000
Received: from charlieb-dovecot@e-smith.com by tripe.nssg.mitel.com with qmail-scanner; 20 Mar 2003 17:16:52 -0000
Received: from allspice-core.nssg.mitel.com (HELO e-smith.com) (10.33.16.12)
  by tripe.nssg.mitel.com (10.33.17.11) with SMTP; 20 Mar 2003 22:16:51 -0000
Received: (qmail 28740 invoked from network); 20 Mar 2003 22:16:51 -0000
Received: from vegemite.nssg.mitel.com (10.33.15.70)
  by allspice.nssg.mitel.com with QMQP; 20 Mar 2003 22:16:51 -0000
Received: from localhost (sendmail-bs@127.0.0.1)
  by localhost with SMTP; 20 Mar 2003 22:20:51 -0000
Date: Thu, 20 Mar 2003 17:20:51 -0500 (EST)
From: Charlie Brady <charlieb-dovecot@e-smith.com>
X-X-Sender: charlieb@vegemite.nssg.mitel.com
To: dovecot@procontrol.fi
Subject: [dovecot] tcpserver/mailfront/stunnel with patch (was Re: inetd/xinetd/tcpserver
 support)
In-Reply-To: <1048166799.5765.93.camel@hurina>
Message-ID: <Pine.LNX.4.44.0303201715190.18300-200000@vegemite.nssg.mitel.com>
MIME-Version: 1.0
Content-Type: MULTIPART/MIXED; BOUNDARY="554321423-1746228115-1048198851=:18300"
X-archive-position: 448
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: charlieb-dovecot@e-smith.com
Precedence: bulk
X-list: dovecot
X-UID: 448                                                  
Status: O
Content-Length: 3242

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.
  Send mail to mime@docserver.cac.washington.edu for more info.

--554321423-1746228115-1048198851=:18300
Content-Type: TEXT/PLAIN; charset=US-ASCII


On 20 Mar 2003, Timo Sirainen wrote:

> On Thu, 2003-03-20 at 03:30, Charlie Brady wrote:
> > I have a working tcpserver system, but one using a substantially different 
> > process mix. I haven't used imap-login at all, but have used 
> > imapfront-auth from Bruce Guenter's mailfront package 
> > (http://www.untroubled.org/mailfront/).
> > 
> > 002 login foo xxxxx
> > * PREAUTH [CAPABILITY IMAP4rev1 SORT THREAD=REFERENCES MULTIAPPEND 
> > UNSELECT LITERAL+ IDLE CHILDREN LISTEXT LIST-SUBSCRIBED] Logged in as foo
> 
> There's one problem. Dovecot shouldn't reply with PREAUTH but "002 OK".
> Mailfront gives the 002 in environment variable, so you'd have to modify
> Dovecot to use it.

Done - patch is attached.

Here is the run file for running stunnel/mailfront/dovecot under 
tcpserver:

#!/bin/sh

concurrency=20
ulimitdata=3000000
CVM_SASL_PLAIN=cvm-local:/tmp/.cvm-unix-local
export CVM_SASL_PLAIN
CVM_ACCOUNT_SPLIT_CHARS=
export CVM_ACCOUNT_SPLIT_CHARS

SSLUID=`id -u stunnel`
SSLGID=`id -g stunnel`

exec 2>&1
exec \
  softlimit -m $ulimitdata \
  tcpserver -dHRvX \
  -c "$concurrency" \
  -x tcp.cdb \
  0 imap \
   makesock \
   stunnel -D debug -/ ssl -s "$SSLUID" -g "$SSLGID" \
       -N imap \
       -i -R seed -p imapd.pem -n imap- -f -F 3 \
    -makesock_connect_to \
  /usr/bin/imapfront-auth \
  /usr/libexec/dovecot/imap

This is the chroot jail required by stunnel:

-rw-r-----    1 root     stunnel ... ssl/imapd.pem
-rw-------    1 stunnel  stunnel ... ssl/seed
-rw-r--r--    1 root     root    ... ssl/usr/share/ssl/openssl.cnf

--
Charlie


--554321423-1746228115-1048198851=:18300
Content-Type: TEXT/PLAIN; charset=US-ASCII; name="dovecot-0.99.8.1.preauth.patch"
Content-Transfer-Encoding: BASE64
Content-ID: <Pine.LNX.4.44.0303201720510.18300@vegemite.nssg.mitel.com>
Content-Description: 
Content-Disposition: attachment; filename="dovecot-0.99.8.1.preauth.patch"

LS0tIHNyYy9pbWFwL21haW4uYy5vcmlnCVRodSBNYXIgMjAgMTY6MzI6NDgg
MjAwMw0KKysrIHNyYy9pbWFwL21haW4uYwlUaHUgTWFyIDIwIDE3OjAwOjM3
IDIwMDMNCkBAIC03MCw2ICs3MCw3IEBADQogCXN0cnVjdCBjbGllbnQgKmNs
aWVudDsNCiAJc3RydWN0IG1haWxfc3RvcmFnZSAqc3RvcmFnZTsNCiAJY29u
c3QgY2hhciAqdXNlciwgKm1haWwsICpzdHI7DQorCWNvbnN0IGNoYXIgKnRh
ZzsNCiAJaW50IGhpbiwgaG91dDsNCiANCiAJbGliX2luaXRfc2lnbmFscyhz
aWdfcXVpdCk7DQpAQCAtMTI0LDExICsxMjUsMTYgQEANCiANCiAJY2xpZW50
ID0gY2xpZW50X2NyZWF0ZShoaW4sIGhvdXQsIHN0b3JhZ2UpOw0KIA0KLQlp
ZiAoSVNfU1RBTkRBTE9ORSgpKSB7DQorCXRhZyA9IGdldGVudigiSU1BUExP
R0lOVEFHIik7DQorCWlmICh0YWcgPT0gTlVMTCB8fCAqdGFnID09ICdcMCcp
IHsNCiAJCWNsaWVudF9zZW5kX2xpbmUoY2xpZW50LCB0X3N0cmNvbmNhdCgN
CiAJCQkiKiBQUkVBVVRIIFtDQVBBQklMSVRZICJDQVBBQklMSVRZX1NUUklO
RyJdICINCiAJCQkiTG9nZ2VkIGluIGFzICIsIHVzZXIsIE5VTEwpKTsNCi0J
fQ0KKwl9IGVsc2Ugew0KKwkJICAgIGNsaWVudF9zZW5kX2xpbmUoY2xpZW50
LA0KKwkJICAgIHRfc3RyY29uY2F0KHRhZywgIiBPSyBMb2dnZWQgaW4uIiwg
TlVMTCkpOw0KKwkgCX0NCisNCiB9DQogDQogc3RhdGljIHZvaWQgbWFpbl9k
ZWluaXQodm9pZCkNCg==
--554321423-1746228115-1048198851=:18300--

From lfarkas@bnap.hu  Fri Mar 21 13:10:53 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 21 Mar 2003 13:10:53 +0200 (EET)
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 15EB62385F
	for <dovecot@procontrol.fi>; Fri, 21 Mar 2003 13:10:53 +0200 (EET)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id DF5A5754035
	for <dovecot@procontrol.fi>; Fri, 21 Mar 2003 12:10:57 +0100 (CET)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id EFDE63EEC
	for <dovecot@procontrol.fi>; Fri, 21 Mar 2003 12:10:46 +0100 (CET)
Message-ID: <3E7AF33D.7030606@bnap.hu>
Date: Fri, 21 Mar 2003 12:10:53 +0100
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.3b) Gecko/20030211
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: dovecot@procontrol.fi
Subject: [dovecot] Re: some problem with dovecot
References: <20030319113734.BA3F8754025@mail1.bppiac.hu>	 <20030319121608.5C0BF754013@mail1.bppiac.hu>	 <1048077140.848.19.camel@hurina>  <3E788683.3040803@bnap.hu> <1048183752.5765.195.camel@hurina>
In-Reply-To: <1048183752.5765.195.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 449
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 449                                                  
Status: O

Timo Sirainen wrote:
> On Wed, 2003-03-19 at 17:02, Farkas Levente wrote:
> 
>>>I didn't really like having indexes stored in the root directory..
>>
>>why?
>>there are other files in the root directory:
>>.subscriptions
>>.customflags
>>and in this case the directory stucture would be consistent.
> 
> 
> Originally I made the .INBOX because I thought that'd help me with
> renaming INBOX, so I wouldn't have to rename() all files separately. But
> I don't even try to support renaming INBOX anymore since it can't be
> done atomically.
> 
> I guess I could just put everything in the root dir. But I think I'll do
> it only after next release so UIDs won't get lost when it gets moved.

that's nice:-) I realy would like to see as .INBOX disappear:-)


-- 
   Levente                               "Si vis pacem para bellum!"



From lfarkas@bnap.hu  Fri Mar 21 13:41:03 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 21 Mar 2003 13:41:03 +0200 (EET)
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 4D7C123839
	for <dovecot@procontrol.fi>; Fri, 21 Mar 2003 13:41:03 +0200 (EET)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id EE6D4754031
	for <dovecot@procontrol.fi>; Fri, 21 Mar 2003 12:41:10 +0100 (CET)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id 9CCEB3EE4
	for <dovecot@procontrol.fi>; Fri, 21 Mar 2003 12:41:02 +0100 (CET)
Message-ID: <3E7AFA55.9060105@bnap.hu>
Date: Fri, 21 Mar 2003 12:41:09 +0100
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.3b) Gecko/20030211
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: [dovecot] a bit better
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 450
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 450                                                  
Status: O

hi,
so after test the today version.

works:
- squirrelmail works ie. it can send mail (even with attachments) and 
put the sent mail into the sent folder.
- mozilla can put sent mail into the imap server's sent folder
- mozilla see the right folder list (ie. there is no anoying empty name 
folder under the folders which has subfolder) and you can subcribe to 
these folders too.

still not works:

- in mozilla can't copy/move mails from local folder's sent into any of 
the imap folders.
- in mozilla can't sem messages to Drafts (when I put the save button in 
the compose window it's hang).
- in mozilla there is a folder called INBOX in the subscribe window:-(
- in OE6 with large mailbox with large message with the default "all 
messages" settings in the indox outlook hang (the "headers only" still 
work).

-- 
   Levente                               "Si vis pacem para bellum!"



From lfarkas@bnap.hu  Fri Mar 21 13:44:35 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 21 Mar 2003 13:44:35 +0200 (EET)
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 8AABC23839
	for <dovecot@procontrol.fi>; Fri, 21 Mar 2003 13:44:35 +0200 (EET)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id 49E40754032
	for <dovecot@procontrol.fi>; Fri, 21 Mar 2003 12:44:43 +0100 (CET)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id B10533EE4
	for <dovecot@procontrol.fi>; Fri, 21 Mar 2003 12:44:34 +0100 (CET)
Message-ID: <3E7AFB29.9040706@bnap.hu>
Date: Fri, 21 Mar 2003 12:44:41 +0100
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.3b) Gecko/20030211
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: [dovecot] a bit better, but...
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 451
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 451                                                  
Status: O
Content-Length: 1032

this is the correct list the previous was too fast:-(

hi,
so after test the today version.

works:
- squirrelmail works ie. it can send mail (even with attachments) and 
put the sent mail into the sent folder.
- mozilla see the right folder list (ie. there is no anoying empty name 
folder under the folders which has subfolder) and you can subcribe to 
these folders too.

still not works:
- mozilla can put sent mail into the imap server's sent folder at the 
first try, but at the next try (when I compose this mails) it hangs again:-(
- in mozilla can't copy/move mails from local folder's sent into any of 
the imap folders.
- in mozilla can't sem messages to Drafts (when I put the save button in 
the compose window it's hang).
- in mozilla there is a folder called INBOX in the subscribe window:-(
- in OE6 with large mailbox with large message with the default "all 
messages" settings in the indox outlook hang (the "headers only" still 
work).

-- 
   Levente                               "Si vis pacem para bellum!"



From Ron.Barker@v-pe.de  Tue Mar 25 09:02:36 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 25 Mar 2003 09:02:36 +0200 (EET)
Return-Path: <Ron.Barker@v-pe.de>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from v-pe.de (mail.v-pe.de [193.101.155.209])
	by danu.procontrol.fi (Postfix) with ESMTP id A251523825
	for <dovecot@procontrol.fi>; Tue, 25 Mar 2003 09:02:36 +0200 (EET)
X-MimeOLE: Produced By Microsoft Exchange V6.0.6249.0
content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: multipart/mixed;
	boundary="----_=_NextPart_001_01C2F29C.840FAF69"
Subject: [dovecot] dovecot+Solaris 9
Date: Tue, 25 Mar 2003 08:02:36 +0100
Message-ID: <55D9F49A60EF2A44BF1AC7F348D9385229471B@mail.v-pe.de>
X-MS-Has-Attach: yes
X-MS-TNEF-Correlator: 
Thread-Topic: dovecot+Solaris 9
Thread-Index: AcLynIQqvMZNBMtcQXqd4uesoJeoCQ==
From: "Barker, Ron, vpe" <Ron.Barker@v-pe.de>
To: <dovecot@procontrol.fi>
X-archive-position: 452
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: Ron.Barker@v-pe.de
Precedence: bulk
X-list: dovecot
X-UID: 452                                                  
Status: O
Content-Length: 1318

This is a multi-part message in MIME format.

------_=_NextPart_001_01C2F29C.840FAF69
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable


Does the /dev/urandom issue apply to Solaris 9 as well???

Thanks
Ron




--=20
Dr. Ronald Barker
Senior Technology Manager
Vodafone Group Research & Development - D

Vodafone Pilotentwicklung GmbH
Chiemgaustrasse 116
81549 Munich=20
Germany
Fon: + 49 (89) 95 410-0
Fax: + 49 (89) 95 410-111
mailto:ron.barker@v-pe.de
http://www.vodafone-rnd.com
 <<Barker, Ron, vpe.vcf>>=20

------_=_NextPart_001_01C2F29C.840FAF69
Content-Type: text/x-vcard;
	name="Barker, Ron, vpe.vcf"
Content-Transfer-Encoding: base64
Content-Description: Barker, Ron, vpe.vcf
Content-Disposition: attachment;
	filename="Barker, Ron, vpe.vcf"

QkVHSU46VkNBUkQNClZFUlNJT046Mi4xDQpOOkJhcmtlcjtSb24NCkZOOkJhcmtlciwgUm9uLCB2
cGUNCk9SRzpWb2RhZm9uZSBQaWxvdGVudHdpY2tsdW5nO01hdXQNClRFTDtXT1JLO1ZPSUNFOjUz
OA0KQURSO1dPUks6OztDaGllbWdhdXN0ci4gMTE2O038bmNoZW47QmF5ZXJuOzgxNTQ5O0RFVVRT
Q0hMQU5EDQpMQUJFTDtXT1JLO0VOQ09ESU5HPVFVT1RFRC1QUklOVEFCTEU6Q2hpZW1nYXVzdHIu
IDExNj0wRD0wQU09RkNuY2hlbiwgQmF5ZXJuIDgxNTQ5PTBEPTBBREVVVFNDSExBTkQNCkVNQUlM
O1BSRUY7SU5URVJORVQ6Um9uLkJhcmtlckB2LXBlLmRlDQpSRVY6MjAwMzAzMTdUMTIxOTE0Wg0K
RU5EOlZDQVJEDQo=

------_=_NextPart_001_01C2F29C.840FAF69--

From Ron.Barker@v-pe.de  Tue Mar 25 15:01:54 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 25 Mar 2003 15:01:54 +0200 (EET)
Return-Path: <Ron.Barker@v-pe.de>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from v-pe.de (mail.v-pe.de [193.101.155.209])
	by danu.procontrol.fi (Postfix) with ESMTP id BD91823825
	for <dovecot@procontrol.fi>; Tue, 25 Mar 2003 15:01:53 +0200 (EET)
X-MimeOLE: Produced By Microsoft Exchange V6.0.6249.0
content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: multipart/mixed;
	boundary="----_=_NextPart_001_01C2F2CE.B514C3AB"
Subject: [dovecot] Help
Date: Tue, 25 Mar 2003 14:01:53 +0100
Message-ID: <55D9F49A60EF2A44BF1AC7F348D9385229471E@mail.v-pe.de>
X-MS-Has-Attach: yes
X-MS-TNEF-Correlator: 
Thread-Topic: Help
Thread-Index: AcLyzrUNSDLstPaBT8eUAh6JVB+MuQ==
From: "Barker, Ron, vpe" <Ron.Barker@v-pe.de>
To: <dovecot@procontrol.fi>
X-archive-position: 453
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: Ron.Barker@v-pe.de
Precedence: bulk
X-list: dovecot
X-UID: 453                                                  
Status: O
Content-Length: 2094

This is a multi-part message in MIME format.

------_=_NextPart_001_01C2F2CE.B514C3AB
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable

Hi to all, =20
We are a bit of newbes to imap etc, so may be we just not doing it
right.  Nevertheless,

We have compiled dovecot to run under Solaris 8/9 for IPv6 test.  We are
going crazy.

After a successful compilation, the troubles really began.

Solaris 9
1. Every=B4time we reboot- the directory /var/run/dovecot/auth is gone
????
2. After the dir is created manually, the server starts.

However!!!=20
	1.  A telnet to host 143 connect to the server fine but no
commands are accepted.  The server simply returns "bad command"
	2.  If we try to connect via a e-mail client to the server - we
get a login refused - which I suspect is simply the "bad command" error
being interpreted as such.

We have tried every concivable combination of conf items in the conf
file but nothing.

Solaris8

Just does not start.

Any help apprecialted

Ron





--=20
Dr. Ronald Barker
Senior Technology Manager
Vodafone Group Research & Development - D

Vodafone Pilotentwicklung GmbH
Chiemgaustrasse 116
81549 Munich=20
Germany
Fon: + 49 (89) 95 410-0
Fax: + 49 (89) 95 410-111
mailto:ron.barker@v-pe.de
http://www.vodafone-rnd.com
 <<Barker, Ron, vpe.vcf>>=20

------_=_NextPart_001_01C2F2CE.B514C3AB
Content-Type: text/x-vcard;
	name="Barker, Ron, vpe.vcf"
Content-Transfer-Encoding: base64
Content-Description: Barker, Ron, vpe.vcf
Content-Disposition: attachment;
	filename="Barker, Ron, vpe.vcf"

QkVHSU46VkNBUkQNClZFUlNJT046Mi4xDQpOOkJhcmtlcjtSb24NCkZOOkJhcmtlciwgUm9uLCB2
cGUNCk9SRzpWb2RhZm9uZSBQaWxvdGVudHdpY2tsdW5nO01hdXQNClRFTDtXT1JLO1ZPSUNFOjUz
OA0KQURSO1dPUks6OztDaGllbWdhdXN0ci4gMTE2O038bmNoZW47QmF5ZXJuOzgxNTQ5O0RFVVRT
Q0hMQU5EDQpMQUJFTDtXT1JLO0VOQ09ESU5HPVFVT1RFRC1QUklOVEFCTEU6Q2hpZW1nYXVzdHIu
IDExNj0wRD0wQU09RkNuY2hlbiwgQmF5ZXJuIDgxNTQ5PTBEPTBBREVVVFNDSExBTkQNCkVNQUlM
O1BSRUY7SU5URVJORVQ6Um9uLkJhcmtlckB2LXBlLmRlDQpSRVY6MjAwMzAzMTdUMTIxOTE0Wg0K
RU5EOlZDQVJEDQo=

------_=_NextPart_001_01C2F2CE.B514C3AB--

From maikel@ladot.com  Tue Mar 25 16:10:19 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 25 Mar 2003 16:10:19 +0200 (EET)
Return-Path: <maikel@ladot.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from zeus.ladot.com (office.ladot.com [217.22.64.134])
	by danu.procontrol.fi (Postfix) with ESMTP id 482E923839
	for <dovecot@procontrol.fi>; Tue, 25 Mar 2003 16:10:18 +0200 (EET)
Received: from nlladot05.freehosting (nlladot05.intern.ladot.com [172.31.2.13])
	by zeus.ladot.com (8.12.8/8.12.6) with ESMTP id h2PEKpmB037823
	for <dovecot@procontrol.fi>; Tue, 25 Mar 2003 15:20:51 +0100 (CET)
	(envelope-from maikel@ladot.com)
Received: by nlladot05.intern.ladot.com with Internet Mail Service (5.5.2653.19)
	id <1VFZ5L2S>; Tue, 25 Mar 2003 14:56:18 +0100
Message-ID: <410777FC7A66D511911500B0D0783455024C4F78@nlladot05.intern.ladot.com>
From: Maikel Verheijen <maikel@ladot.com>
To: dovecot@procontrol.fi
Subject: [dovecot] mailbox problem
Date: Tue, 25 Mar 2003 14:56:10 +0100
MIME-Version: 1.0
X-Mailer: Internet Mail Service (5.5.2653.19)
Content-Type: multipart/alternative;
	boundary="----_=_NextPart_001_01C2F2D6.4A9B9AB0"
X-Spam-Status: No, hits=1.4 required=5.0
	tests=EXCHANGE_SERVER,MIME_NULL_BLOCK,SPAM_PHRASE_05_08
	version=2.44
X-Spam-Level: *
X-archive-position: 454
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: maikel@ladot.com
Precedence: bulk
X-list: dovecot
X-UID: 454                                                  
Status: O
Content-Length: 2316

This message is in MIME format. Since your mail reader does not understand
this format, some or all of this message may not be legible.

------_=_NextPart_001_01C2F2D6.4A9B9AB0
Content-Type: text/plain

Hi list!

Since a week I am testing with dovecot, and I must say, I like it a lot :)
Keep up the good work :)

I do have one questing regarding dovecot: If I login to a mailbox, and the
mailbox does NOT exist, and the parent directory does not exist either, I
will get disconnected, and dovecot claims it cannot create the directory.
(eg: my user blah@test.com has mail directory
/var/mail/t/te/test.com/blah/Maildir, and all directories up to
/var/mail/t/te/ exist, dovecot does not create the directory test.com/ and
on.)

Is this by design, or should this be created by dovecot?

The problem is solved as soon as the user receives his first email, since my
MTA creates the directories...


Thank you,

Maikel Verheijen

------_=_NextPart_001_01C2F2D6.4A9B9AB0
Content-Type: text/html
Content-Transfer-Encoding: quoted-printable

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV=3D"Content-Type" CONTENT=3D"text/html; =
charset=3Dus-ascii">
<META NAME=3D"Generator" CONTENT=3D"MS Exchange Server version =
5.5.2653.12">
<TITLE>mailbox problem</TITLE>
</HEAD>
<BODY>

<P><FONT SIZE=3D2>Hi list!</FONT>
</P>

<P><FONT SIZE=3D2>Since a week I am testing with dovecot, and I must =
say, I like it a lot :) Keep up the good work :)</FONT>
</P>

<P><FONT SIZE=3D2>I do have one questing regarding dovecot: If I login =
to a mailbox, and the mailbox does NOT exist, and the parent directory =
does not exist either, I will get disconnected, and dovecot claims it =
cannot create the directory. (eg: my user blah@test.com has mail =
directory /var/mail/t/te/test.com/blah/Maildir, and all directories up =
to /var/mail/t/te/ exist, dovecot does not create the directory =
test.com/ and on.)</FONT></P>

<P><FONT SIZE=3D2>Is this by design, or should this be created by =
dovecot?</FONT>
</P>

<P><FONT SIZE=3D2>The problem is solved as soon as the user receives =
his first email, since my MTA creates the directories...</FONT>
</P>
<BR>

<P><FONT SIZE=3D2>Thank you,</FONT>
</P>

<P><FONT SIZE=3D2>Maikel Verheijen</FONT>
</P>

</BODY>
</HTML>
------_=_NextPart_001_01C2F2D6.4A9B9AB0--

From jpeterson275@attbi.com  Tue Mar 25 21:53:47 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 25 Mar 2003 21:53:47 +0200 (EET)
Return-Path: <jpeterson275@attbi.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from sccrmhc02.attbi.com (sccrmhc02.attbi.com [204.127.202.62])
	by danu.procontrol.fi (Postfix) with ESMTP id CFC4D23839
	for <dovecot@procontrol.fi>; Tue, 25 Mar 2003 21:53:46 +0200 (EET)
Received: from attbi.com (12-228-143-121.client.attbi.com[12.228.143.121])
          by sccrmhc02.attbi.com (sccrmhc02) with SMTP
          id <2003032519534500200jbjg2e>; Tue, 25 Mar 2003 19:53:45 +0000
Message-ID: <3E80B3D3.6050603@attbi.com>
Date: Tue, 25 Mar 2003 11:53:55 -0800
From: Jesse Peterson <jpeterson275@attbi.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] FETCH BODY[part]<partial>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 455
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jpeterson275@attbi.com
Precedence: bulk
X-list: dovecot
X-UID: 455                                                  
Status: O

2003-03-24 12:59  Timo Sirainen <tss@iki.fi>

This CVS update didn't actually seem to fix the problem.  I still get 
the problem as before, like this capture:


10 UID FETCH 60 BODY.PEEK[]<8192.1915>
* 60 FETCH (UID 60 BODY[]<8192> {1915}

)
10 OK Fetch completed.

Not quite 1,915 bytes =).  Perhaps the "[]" (without a part) is 
confusing it?  But still, it grabs the first chunk correctly.  At any 
rate, any input would be great.


From mike@innercite.com  Wed Mar 26 01:48:20 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 26 Mar 2003 01:48:20 +0200 (EET)
Return-Path: <mike@innercite.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from knight.innercite.com (knight.innercite.com [158.222.3.8])
	by danu.procontrol.fi (Postfix) with ESMTP id 9E65F23839
	for <dovecot@procontrol.fi>; Wed, 26 Mar 2003 01:48:19 +0200 (EET)
Received: from localhost.localdomain (rocket.innercite.com [158.222.7.10])
	by knight.innercite.com (8.12.3/8.12.3/Debian -4) with ESMTP id h2PNgvpB026494
	for <dovecot@procontrol.fi>; Tue, 25 Mar 2003 15:42:57 -0800
Subject: [dovecot] Dovecot and Quotas
From: Mike Machado <mike@innercite.com>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
X-Mailer: Ximian Evolution 1.0.8 
Date: 25 Mar 2003 15:48:41 -0800
Message-Id: <1048636121.31457.31.camel@rocket>
Mime-Version: 1.0
X-archive-position: 456
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mike@innercite.com
Precedence: bulk
X-list: dovecot
X-UID: 456                                                  
Status: O

Is there anything that can be done so that when users IMAP to their
inbox and have reached their filesystem quota, that they can still
DELETE their mail? They can login, but when they go to delete/expunge
this is the error I get in syslog. I have tried mail_read_mmaped to yes
and no, and same result.

Mar 25 14:54:27 penguin1 imap(bob): file_set_size() failed with index
data file /home/bob/mail/.imap/INBOX/.imap.index.data: Disk quota
exceededMar 25 14:54:27 penguin1 imap(bob): mmap_istream.madvise():
Function not implemented
Mar 25 14:54:28 penguin1 last message repeated 65 times



When using UW IMAP, sometimes users can delete mail and other times they
cannot. I am desperately seeking a solution to have customers be able to
delete their own mail when their box is full and not have to call our
support center. Any suggestions? Thanks.

Debian with kernel 2.4.18.

-- 
Mike Machado
mike@innercite.com
InnerCite Inc.
Engineering Director / CTO


From skvidal@phy.duke.edu  Wed Mar 26 05:29:14 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 26 Mar 2003 05:29:15 +0200 (EET)
Return-Path: <skvidal@phy.duke.edu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail.phy.duke.edu (mail.phy.duke.edu [152.3.182.2])
	by danu.procontrol.fi (Postfix) with ESMTP id 8EC0323825
	for <dovecot@procontrol.fi>; Wed, 26 Mar 2003 05:29:14 +0200 (EET)
Received: from user-152-16-65-11.adsl.duke.edu (user-152-16-65-11.adsl.duke.edu [152.16.65.11])
	by mail.phy.duke.edu (Postfix) with ESMTP
	id 4EEB5A77DC; Tue, 25 Mar 2003 22:29:11 -0500 (EST)
Subject: [dovecot] Re: Dovecot and Quotas
From: seth vidal <skvidal@phy.duke.edu>
To: Mike Machado <mike@innercite.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <1048636121.31457.31.camel@rocket>
References: <1048636121.31457.31.camel@rocket>
Content-Type: text/plain
Organization: 
Message-Id: <1048649163.5455.0.camel@binkley>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 (1.2.2-1) 
Date: 25 Mar 2003 22:26:03 -0500
Content-Transfer-Encoding: 7bit
X-archive-position: 457
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: skvidal@phy.duke.edu
Precedence: bulk
X-list: dovecot
X-UID: 457                                                  
Status: O
Content-Length: 1142

On Tue, 2003-03-25 at 18:48, Mike Machado wrote:
> Is there anything that can be done so that when users IMAP to their
> inbox and have reached their filesystem quota, that they can still
> DELETE their mail? They can login, but when they go to delete/expunge
> this is the error I get in syslog. I have tried mail_read_mmaped to yes
> and no, and same result.
> 
> Mar 25 14:54:27 penguin1 imap(bob): file_set_size() failed with index
> data file /home/bob/mail/.imap/INBOX/.imap.index.data: Disk quota
> exceededMar 25 14:54:27 penguin1 imap(bob): mmap_istream.madvise():
> Function not implemented
> Mar 25 14:54:28 penguin1 last message repeated 65 times
> 
> 
> 
> When using UW IMAP, sometimes users can delete mail and other times they
> cannot. I am desperately seeking a solution to have customers be able to
> delete their own mail when their box is full and not have to call our
> support center. Any suggestions? Thanks.

What about making soft file quotas w/unlimited grace periods.

You'd have to lace your mail system into it so it could tell them they
are over quota and bounce mail but not actually have a hard limit.

-sv



From tss@iki.fi  Wed Mar 26 10:03:49 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 26 Mar 2003 10:03:50 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id C522123839
	for <dovecot@procontrol.fi>; Wed, 26 Mar 2003 10:03:49 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 749B75E928DF; Wed, 26 Mar 2003 10:03:48 +0200 (EET)
Subject: [dovecot] Re: dovecot+Solaris 9
From: Timo Sirainen <tss@iki.fi>
To: "Barker, Ron, vpe" <Ron.Barker@v-pe.de>
Cc: dovecot@procontrol.fi
In-Reply-To: <55D9F49A60EF2A44BF1AC7F348D9385229471B@mail.v-pe.de>
References: <55D9F49A60EF2A44BF1AC7F348D9385229471B@mail.v-pe.de>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1048665828.30187.70.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 26 Mar 2003 10:03:48 +0200
X-archive-position: 458
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 458                                                  
Status: O

On Tue, 2003-03-25 at 09:02, Barker, Ron, vpe wrote:
> Does the /dev/urandom issue apply to Solaris 9 as well???

Solaris 9 has /dev/urandom, so no need to do any patching.


From tss@iki.fi  Wed Mar 26 10:07:17 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 26 Mar 2003 10:07:17 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 6AE7E23839
	for <dovecot@procontrol.fi>; Wed, 26 Mar 2003 10:07:17 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id D42665E928DF; Wed, 26 Mar 2003 10:07:16 +0200 (EET)
Subject: [dovecot] Re: Help
From: Timo Sirainen <tss@iki.fi>
To: "Barker, Ron, vpe" <Ron.Barker@v-pe.de>
Cc: dovecot@procontrol.fi
In-Reply-To: <55D9F49A60EF2A44BF1AC7F348D9385229471E@mail.v-pe.de>
References: <55D9F49A60EF2A44BF1AC7F348D9385229471E@mail.v-pe.de>
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
Organization: 
Message-Id: <1048666036.31565.75.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 26 Mar 2003 10:07:16 +0200
X-archive-position: 459
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 459                                                  
Status: O

On Tue, 2003-03-25 at 15:01, Barker, Ron, vpe wrote:
> Solaris 9
> 1. Every=B4time we reboot- the directory /var/run/dovecot/auth is gone
> ????
> 2. After the dir is created manually, the server starts.

Hm. You've set auth_chroot then. Looks like I don't check that the
directory exists, I'll fix that.

>=20
> However!!!=20
> 	1.  A telnet to host 143 connect to the server fine but no
> commands are accepted.  The server simply returns "bad command"

What commands did you try? IMAP commands are prefixed with a tag, so
you'd need to do eg. "1 login user password".

> 	2.  If we try to connect via a e-mail client to the server - we
> get a login refused - which I suspect is simply the "bad command" error
> being interpreted as such.

And this is probably because you set the auth_chroot, and the auth
process can't read /etc/passwd (or whatever) when chrooted. So just
comment out the auth_chroot line and it would probably work. If not, set
auth_verbose =3D yes and see what it shows in log file.


From tss@iki.fi  Wed Mar 26 10:21:49 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 26 Mar 2003 10:21:49 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 8953623839
	for <dovecot@procontrol.fi>; Wed, 26 Mar 2003 10:21:49 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 607AD5E928DF; Wed, 26 Mar 2003 10:21:49 +0200 (EET)
Subject: [dovecot] Re: mailbox problem
From: Timo Sirainen <tss@iki.fi>
To: Maikel Verheijen <maikel@ladot.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <410777FC7A66D511911500B0D0783455024C4F78@nlladot05.intern.ladot.com>
References:
	 <410777FC7A66D511911500B0D0783455024C4F78@nlladot05.intern.ladot.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1048666909.31565.91.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 26 Mar 2003 10:21:49 +0200
X-archive-position: 460
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 460                                                  
Status: O
Content-Length: 1561

On Tue, 2003-03-25 at 15:56, Maikel Verheijen wrote:
> I do have one questing regarding dovecot: If I login to a mailbox, and
> the mailbox does NOT exist, and the parent directory does not exist
> either, I will get disconnected, and dovecot claims it cannot create
> the directory. (eg: my user blah@test.com has mail directory
> /var/mail/t/te/test.com/blah/Maildir, and all directories up to
> /var/mail/t/te/ exist, dovecot does not create the directory test.com/
> and on.)
> 
> Is this by design, or should this be created by dovecot?

Hmm. Unless you're using one UID for everyone, those directories would
have be to be created as root. Also test.com should be created with
different owner as blah and blah/Maildir. Maybe I could add a new
setting for this, but I'm not sure how to do it without making it too
kludgy. There would have to be separation of where user directory
structure starts, and uid/gid settings what to use for created
directories before them. Something like:

mail_global_dir = /var/mail/t/te/%d
mail_global_uid = root
mail_global_gid = mail
mail_user_dir = /var/mail/t/te/%d/%n

Would be better if the mail_user_dir didn't have to be set at all since
it's already in mail_default_env, but the user directory has to be
created while still root, and parsing mail_default_env there is kludgy
too. Or maybe:

mail_global_dir = /var/mail/t/te/%d/%n

And the last directory would always be assumed to be user directory.
That would prevent creating /var/mail-like shared directories though,
but I guess there's no need to create those..


From tss@iki.fi  Wed Mar 26 10:29:04 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 26 Mar 2003 10:29:04 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id C113923839
	for <dovecot@procontrol.fi>; Wed, 26 Mar 2003 10:29:03 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 527865E928DF; Wed, 26 Mar 2003 10:29:03 +0200 (EET)
Subject: [dovecot] Re: Dovecot and Quotas
From: Timo Sirainen <tss@iki.fi>
To: Mike Machado <mike@innercite.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <1048636121.31457.31.camel@rocket>
References: <1048636121.31457.31.camel@rocket>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1048667343.30187.100.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 26 Mar 2003 10:29:03 +0200
X-archive-position: 461
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 461                                                  
Status: O

On Wed, 2003-03-26 at 01:48, Mike Machado wrote:
> Mar 25 14:54:27 penguin1 imap(bob): file_set_size() failed with index
> data file /home/bob/mail/.imap/INBOX/.imap.index.data: Disk quota
> exceededMar 25 14:54:27 penguin1 imap(bob): mmap_istream.madvise():
> Function not implemented
> Mar 25 14:54:28 penguin1 last message repeated 65 times

Oh, write() returns EDQUOT instead of ENOSPC when quota is full? Didn't
know that before. I'll fix it so that they're both checked. After that
Dovecot will just use memory instead if it can't create the index files.

From tss@iki.fi  Wed Mar 26 10:56:51 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 26 Mar 2003 10:56:51 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id DED8E23825
	for <dovecot@procontrol.fi>; Wed, 26 Mar 2003 10:56:50 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id A70385E928DF; Wed, 26 Mar 2003 10:56:50 +0200 (EET)
Subject: [dovecot] Re: Long running auth/login processes (was Re: Re:
	inetd/xinetd/tcpserver support)
From: Timo Sirainen <tss@iki.fi>
To: Charlie Brady <charlieb-dovecot@e-smith.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.44.0303201559420.18300-100000@vegemite.nssg.mitel.com>
References:
	 <Pine.LNX.4.44.0303201559420.18300-100000@vegemite.nssg.mitel.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1048669010.30187.127.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 26 Mar 2003 10:56:50 +0200
X-archive-position: 462
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 462                                                  
Status: O
Content-Length: 2554

On Thu, 2003-03-20 at 23:27, Charlie Brady wrote:
> > Anyway, I don't really care much about it since it pretty much means
> > that exploiting it gives access to connections of all users.
> 
> So you don't want to have a long running login process after all?

I don't, but I give option if someone else does who cares more about
performance than security.

> I don't know, but I'm trying to learn. You know your design and your code;  
> I'm just feeling my way around. Your documentation is good in parts, but
> there are still big gaps. The installation documentation only covers
> building - I have yet to find anything which tells me how to execute
> dovecot (have I missed it?). I'm not sure which processes run when, and
> exactly what communication occurs between them over what communication
> channels.

It's executed by running "dovecot" :) INSTALL document actually still
says imap-master, fixing..

dovecot process anyway executes everything else. They talk to each
others only with UNIX sockets.

> > Sounds like the
> > only difference is that it runs login code as root and exec()s imap
> > binary after login, where my code sends it through master process which
> > forks new imap process.
> 
> I don't know exactly what "sent it through master process" means.

File descriptor passing through UNIX socket. Login process accept()s the
new socket and handles everything until client has successfully logged
in, after that the socket is passed to master process and closed. Master
process executes new imap process and sets the socket as it's
stdin/stdout.

> I have a preference for running simple software which I already have
> reason to trust.  This is why I want to use tcpserver, and why I have a 
> leaning towards using mailfront and cvm. I know that stunnel isn't 
> completely wonderful, but it is very widely used, and the chroot feature 
> added by Scott Gifford fixes the principal weakness.

Actually Dovecot's SSL tunnel seems to be somewhat broken now.

> I am looking for a better IMAP daemon than I have at present, but I would 
> prefer not to have a new system of authentication, and a new network 
> connection monitor. There is a lot of new (to me) code in dovecot, but the 
> only code of high value to me is the imap daemon itself.

OK, currently there's no reason why you shouldn't do that. I'll probably
add some communication with dovecot master process <-> imap process
later, but that will be optional as well. At least for requesting lock
files (shared folders or mboxes in /var/mail), maybe something else..


From maikel@ladot.com  Wed Mar 26 11:08:43 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 26 Mar 2003 11:08:43 +0200 (EET)
Return-Path: <maikel@ladot.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from zeus.ladot.com (office.ladot.com [217.22.64.134])
	by danu.procontrol.fi (Postfix) with ESMTP id DB7DA23825
	for <dovecot@procontrol.fi>; Wed, 26 Mar 2003 11:08:42 +0200 (EET)
Received: from nlladot05.freehosting (nlladot05.intern.ladot.com [172.31.2.13])
	by zeus.ladot.com (8.12.8/8.12.6) with ESMTP id h2Q9JFmB057931
	for <dovecot@procontrol.fi>; Wed, 26 Mar 2003 10:19:16 +0100 (CET)
	(envelope-from maikel@ladot.com)
Received: by nlladot05.intern.ladot.com with Internet Mail Service (5.5.2653.19)
	id <1VFZ6C33>; Wed, 26 Mar 2003 09:54:39 +0100
Message-ID: <410777FC7A66D511911500B0D078345501F221F2@nlladot05.intern.ladot.com>
From: Maikel Verheijen <maikel@ladot.com>
To: "'dovecot@procontrol.fi'" <dovecot@procontrol.fi>
Subject: [dovecot] Re: mailbox problem
Date: Wed, 26 Mar 2003 09:54:39 +0100
MIME-Version: 1.0
X-Mailer: Internet Mail Service (5.5.2653.19)
Content-Type: multipart/alternative;
	boundary="----_=_NextPart_001_01C2F375.55A33E00"
X-Spam-Status: No, hits=-0.5 required=5.0
	tests=EXCHANGE_SERVER,MIME_NULL_BLOCK,QUOTED_EMAIL_TEXT,
	      SPAM_PHRASE_01_02
	version=2.44
X-archive-position: 463
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: maikel@ladot.com
Precedence: bulk
X-list: dovecot
X-UID: 463                                                  
Status: O
Content-Length: 4556

This message is in MIME format. Since your mail reader does not understand
this format, some or all of this message may not be legible.

------_=_NextPart_001_01C2F375.55A33E00
Content-Type: text/plain

> Hmm. Unless you're using one UID for everyone, those 
> directories would have be to be created as root. Also 
> test.com should be created with different owner as blah and 
> blah/Maildir. Maybe I could add a new setting for this, but 
> I'm not sure how to do it without making it too kludgy. There 
> would have to be separation of where user directory structure 
> starts, and uid/gid settings what to use for created 
> directories before them. Something like:

I do use 1 UID and 1 GID for everyone. Would that be more simple?

> mail_global_dir = /var/mail/t/te/%d
> mail_global_uid = root
> mail_global_gid = mail
> mail_user_dir = /var/mail/t/te/%d/%n
> 
> Would be better if the mail_user_dir didn't have to be set at 
> all since it's already in mail_default_env, but the user 
> directory has to be created while still root, and parsing 
> mail_default_env there is kludgy too. Or maybe:
> 
> mail_global_dir = /var/mail/t/te/%d/%n
> 
> And the last directory would always be assumed to be user 
> directory. That would prevent creating /var/mail-like shared 
> directories though, but I guess there's no need to create those..

Maybe there could be a "toggle" to do or don't create the dirs, so you don't
need the mail_global_dir setting for "normal" use.

My idea was to check the full path to the mailbox, and to create the
nonexisting part if necessary. At that point you DO have the full path to
the mailbox/maildir, and you can create it, right?


Kind regards,

Maikel Verheijen. 

------_=_NextPart_001_01C2F375.55A33E00
Content-Type: text/html
Content-Transfer-Encoding: quoted-printable

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV=3D"Content-Type" CONTENT=3D"text/html; =
charset=3Dus-ascii">
<META NAME=3D"Generator" CONTENT=3D"MS Exchange Server version =
5.5.2653.12">
<TITLE>RE: [dovecot] mailbox problem</TITLE>
</HEAD>
<BODY>

<P><FONT SIZE=3D2>&gt; Hmm. Unless you're using one UID for everyone, =
those </FONT>
<BR><FONT SIZE=3D2>&gt; directories would have be to be created as =
root. Also </FONT>
<BR><FONT SIZE=3D2>&gt; test.com should be created with different owner =
as blah and </FONT>
<BR><FONT SIZE=3D2>&gt; blah/Maildir. Maybe I could add a new setting =
for this, but </FONT>
<BR><FONT SIZE=3D2>&gt; I'm not sure how to do it without making it too =
kludgy. There </FONT>
<BR><FONT SIZE=3D2>&gt; would have to be separation of where user =
directory structure </FONT>
<BR><FONT SIZE=3D2>&gt; starts, and uid/gid settings what to use for =
created </FONT>
<BR><FONT SIZE=3D2>&gt; directories before them. Something like:</FONT>
</P>

<P><FONT SIZE=3D2>I do use 1 UID and 1 GID for everyone. Would that be =
more simple?</FONT>
</P>

<P><FONT SIZE=3D2>&gt; mail_global_dir =3D /var/mail/t/te/%d</FONT>
<BR><FONT SIZE=3D2>&gt; mail_global_uid =3D root</FONT>
<BR><FONT SIZE=3D2>&gt; mail_global_gid =3D mail</FONT>
<BR><FONT SIZE=3D2>&gt; mail_user_dir =3D /var/mail/t/te/%d/%n</FONT>
<BR><FONT SIZE=3D2>&gt; </FONT>
<BR><FONT SIZE=3D2>&gt; Would be better if the mail_user_dir didn't =
have to be set at </FONT>
<BR><FONT SIZE=3D2>&gt; all since it's already in mail_default_env, but =
the user </FONT>
<BR><FONT SIZE=3D2>&gt; directory has to be created while still root, =
and parsing </FONT>
<BR><FONT SIZE=3D2>&gt; mail_default_env there is kludgy too. Or =
maybe:</FONT>
<BR><FONT SIZE=3D2>&gt; </FONT>
<BR><FONT SIZE=3D2>&gt; mail_global_dir =3D /var/mail/t/te/%d/%n</FONT>
<BR><FONT SIZE=3D2>&gt; </FONT>
<BR><FONT SIZE=3D2>&gt; And the last directory would always be assumed =
to be user </FONT>
<BR><FONT SIZE=3D2>&gt; directory. That would prevent creating =
/var/mail-like shared </FONT>
<BR><FONT SIZE=3D2>&gt; directories though, but I guess there's no need =
to create those..</FONT>
</P>

<P><FONT SIZE=3D2>Maybe there could be a &quot;toggle&quot; to do or =
don't create the dirs, so you don't need the mail_global_dir setting =
for &quot;normal&quot; use.</FONT></P>

<P><FONT SIZE=3D2>My idea was to check the full path to the mailbox, =
and to create the nonexisting part if necessary. At that point you DO =
have the full path to the mailbox/maildir, and you can create it, =
right?</FONT></P>
<BR>

<P><FONT SIZE=3D2>Kind regards,</FONT>
</P>

<P><FONT SIZE=3D2>Maikel Verheijen. </FONT>
</P>

</BODY>
</HTML>
------_=_NextPart_001_01C2F375.55A33E00--

From tss@iki.fi  Wed Mar 26 11:09:53 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 26 Mar 2003 11:09:53 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 9020C23825
	for <dovecot@procontrol.fi>; Wed, 26 Mar 2003 11:09:53 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 66D785E928DF; Wed, 26 Mar 2003 11:09:53 +0200 (EET)
Subject: [dovecot] Re: FETCH BODY[part]<partial>
From: Timo Sirainen <tss@iki.fi>
To: Jesse Peterson <jpeterson275@attbi.com>
Cc: Dovecot Mail List <dovecot@procontrol.fi>
In-Reply-To: <3E80B3D3.6050603@attbi.com>
References: <3E80B3D3.6050603@attbi.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1048669793.30187.133.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 26 Mar 2003 11:09:53 +0200
X-archive-position: 464
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 464                                                  
Status: O

On Tue, 2003-03-25 at 21:53, Jesse Peterson wrote:
> This CVS update didn't actually seem to fix the problem.  I still get 
> the problem as before, like this capture:
> 
> 
> 10 UID FETCH 60 BODY.PEEK[]<8192.1915>
> * 60 FETCH (UID 60 BODY[]<8192> {1915}
> 
> )
> 10 OK Fetch completed.

Does this happen every time now? What if you run the "imap" binary
directly and ask this? What if you skip the first block and ask only the
second? Is the message really 10107 bytes long?

> Not quite 1,915 bytes =).  Perhaps the "[]" (without a part) is 
> confusing it?  But still, it grabs the first chunk correctly.  At any 
> rate, any input would be great.

I can't get this to break with me..


From tss@iki.fi  Wed Mar 26 11:29:27 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 26 Mar 2003 11:29:27 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id E4A4F23825
	for <dovecot@procontrol.fi>; Wed, 26 Mar 2003 11:29:26 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id B82FE5E928DF; Wed, 26 Mar 2003 11:29:26 +0200 (EET)
Subject: [dovecot] Re: mailbox problem
From: Timo Sirainen <tss@iki.fi>
To: Maikel Verheijen <maikel@ladot.com>
Cc: "'dovecot@procontrol.fi'" <dovecot@procontrol.fi>
In-Reply-To: <410777FC7A66D511911500B0D078345501F221F2@nlladot05.intern.ladot.com>
References:
	 <410777FC7A66D511911500B0D078345501F221F2@nlladot05.intern.ladot.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1048670966.30186.150.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 26 Mar 2003 11:29:26 +0200
X-archive-position: 465
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 465                                                  
Status: O
Content-Length: 1204

On Wed, 2003-03-26 at 10:54, Maikel Verheijen wrote:
> > Hmm. Unless you're using one UID for everyone, those 
> > directories would have be to be created as root. Also 
> > test.com should be created with different owner as blah and 
> > blah/Maildir.
> 
> I do use 1 UID and 1 GID for everyone. Would that be more simple?

For your case, yes..

> Maybe there could be a "toggle" to do or don't create the dirs, so you
> don't need the mail_global_dir setting for "normal" use.

The toggle would be just not to set mail_global_dir :)

> My idea was to check the full path to the mailbox, and to create the
> nonexisting part if necessary. At that point you DO have the full path
> to the mailbox/maildir, and you can create it, right?

Yes, but normally you also don't have permissions to create the
directories at that point. I'm not sure if I want to add extra code just
for one-uid-for-everyone case. But maybe this could be useful for other
cases too .. Such as one-uid-per-domain, or if Maildir isn't directly
under home dir. I guess I'll add code for this. If you want some
temporary kludges you could call the mkdir()s at end of 
src/lib-storage/index/maildir/maildir-storage.c:maildir_create()


From jpeterson275@attbi.com  Wed Mar 26 16:52:14 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 26 Mar 2003 16:52:15 +0200 (EET)
Return-Path: <jpeterson275@attbi.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from sccrmhc03.attbi.com (sccrmhc03.attbi.com [204.127.202.63])
	by danu.procontrol.fi (Postfix) with ESMTP id 609F323825
	for <dovecot@procontrol.fi>; Wed, 26 Mar 2003 16:52:14 +0200 (EET)
Received: from attbi.com (12-228-143-121.client.attbi.com[12.228.143.121])
          by sccrmhc03.attbi.com (sccrmhc03) with SMTP
          id <20030326145212003004j77se>; Wed, 26 Mar 2003 14:52:12 +0000
Message-ID: <3E81BEAF.8050803@attbi.com>
Date: Wed, 26 Mar 2003 06:52:31 -0800
From: Jesse Peterson <jpeterson275@attbi.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Re: FETCH BODY[part]<partial>
References: <3E80B3D3.6050603@attbi.com> <1048669793.30187.133.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 466
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jpeterson275@attbi.com
Precedence: bulk
X-list: dovecot
X-UID: 466                                                  
Status: O



Timo Sirainen wrote:
> On Tue, 2003-03-25 at 21:53, Jesse Peterson wrote:
> 
>>This CVS update didn't actually seem to fix the problem.  I still get 
>>the problem as before, like this capture:
>>
>>
>>10 UID FETCH 60 BODY.PEEK[]<8192.1915>
>>* 60 FETCH (UID 60 BODY[]<8192> {1915}
>>
>>)
>>10 OK Fetch completed.
> 
> 
> Does this happen every time now? What if you run the "imap" binary
> directly and ask this? What if you skip the first block and ask only the
> second? Is the message really 10107 bytes long?

I'll give all these a try and let you know.

> 
> 
>>Not quite 1,915 bytes =).  Perhaps the "[]" (without a part) is 
>>confusing it?  But still, it grabs the first chunk correctly.  At any 
>>rate, any input would be great.
> 
> 
> I can't get this to break with me..

Could it possibly be that my indexes (from before the update) were 
screwed and deleteing them would help?  Maybe it cached the body or 
summin, I'll do it anyways to be sure.


From mem@mv.mv.com  Wed Mar 26 17:39:55 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 26 Mar 2003 17:39:55 +0200 (EET)
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id 1271E23825
	for <dovecot@procontrol.fi>; Wed, 26 Mar 2003 17:39:55 +0200 (EET)
Received: (qmail 15144 invoked by uid 101); 26 Mar 2003 10:39:53 -0500
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Wed, 26 Mar 2003 10:39:53 -0500
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Dovecot and Quotas
Message-ID: <20030326103953.D8046@iridium.mv.net>
References: <1048636121.31457.31.camel@rocket> <1048667343.30187.100.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
In-Reply-To: <1048667343.30187.100.camel@hurina>; from tss@iki.fi on Wed, Mar 26, 2003 at 10:29:03AM +0200
X-archive-position: 467
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mem@mv.mv.com
Precedence: bulk
X-list: dovecot
X-UID: 467                                                  
Status: O

On Wed, Mar 26, 2003 at 10:29:03AM +0200, Timo Sirainen wrote:
> On Wed, 2003-03-26 at 01:48, Mike Machado wrote:
> > Mar 25 14:54:27 penguin1 imap(bob): file_set_size() failed with index
> > data file /home/bob/mail/.imap/INBOX/.imap.index.data: Disk quota
> > exceededMar 25 14:54:27 penguin1 imap(bob): mmap_istream.madvise():
> > Function not implemented
> > Mar 25 14:54:28 penguin1 last message repeated 65 times
> 
> Oh, write() returns EDQUOT instead of ENOSPC when quota is full? Didn't
> know that before. I'll fix it so that they're both checked. After that
> Dovecot will just use memory instead if it can't create the index files.

That would be great.  (Suffering from the same issue here.)

mm

From mike@innercite.com  Wed Mar 26 18:54:18 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 26 Mar 2003 18:54:19 +0200 (EET)
Return-Path: <mike@innercite.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from knight.innercite.com (knight.innercite.com [158.222.3.8])
	by danu.procontrol.fi (Postfix) with ESMTP id 0B76823839
	for <dovecot@procontrol.fi>; Wed, 26 Mar 2003 18:54:18 +0200 (EET)
Received: from localhost.localdomain (rocket.innercite.com [158.222.7.10])
	by knight.innercite.com (8.12.3/8.12.3/Debian -4) with ESMTP id h2QGmqpB029789
	for <dovecot@procontrol.fi>; Wed, 26 Mar 2003 08:48:52 -0800
Subject: [dovecot] Re: Dovecot and Quotas
From: Mike Machado <mike@innercite.com>
To: dovecot@procontrol.fi
In-Reply-To: <1048649163.5455.0.camel@binkley>
References: <1048636121.31457.31.camel@rocket> 
	<1048649163.5455.0.camel@binkley>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
X-Mailer: Ximian Evolution 1.0.8 
Date: 26 Mar 2003 08:54:38 -0800
Message-Id: <1048697679.31484.40.camel@rocket>
Mime-Version: 1.0
X-archive-position: 468
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mike@innercite.com
Precedence: bulk
X-list: dovecot
X-UID: 468                                                  
Status: O

I have seen this suggestion elsewhere and would be perfect. The customer
only needs a few extra kilobytes when their quota is full, so the hard
quota could be just a bit bigger with a long/unlimited grace. The hard
part is to get procmail or whatever local delivery agent to stop at the
SOFT quota. I could probably quite some funky procmail rules, but that
will add an unwanted amount of load to an already busy system. Anyone
know if their are some built in sendmail/procmail checking that can aide
here?


On Tue, 2003-03-25 at 19:26, seth vidal wrote:
> What about making soft file quotas w/unlimited grace periods.
> 
> You'd have to lace your mail system into it so it could tell them they
> are over quota and bounce mail but not actually have a hard limit.
> 
> -sv
> 
-- 
Mike Machado
mike@innercite.com
InnerCite Inc.
Engineering Director / CTO


From mike@innercite.com  Wed Mar 26 18:55:02 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 26 Mar 2003 18:55:02 +0200 (EET)
Return-Path: <mike@innercite.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from knight.innercite.com (knight.innercite.com [158.222.3.8])
	by danu.procontrol.fi (Postfix) with ESMTP id 3417B23839
	for <dovecot@procontrol.fi>; Wed, 26 Mar 2003 18:55:02 +0200 (EET)
Received: from localhost.localdomain (rocket.innercite.com [158.222.7.10])
	by knight.innercite.com (8.12.3/8.12.3/Debian -4) with ESMTP id h2QGnbpB029880
	for <dovecot@procontrol.fi>; Wed, 26 Mar 2003 08:49:37 -0800
Subject: [dovecot] Re: Dovecot and Quotas
From: Mike Machado <mike@innercite.com>
To: dovecot@procontrol.fi
In-Reply-To: <1048667343.30187.100.camel@hurina>
References: <1048636121.31457.31.camel@rocket> 
	<1048667343.30187.100.camel@hurina>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
X-Mailer: Ximian Evolution 1.0.8 
Date: 26 Mar 2003 08:55:24 -0800
Message-Id: <1048697724.31736.42.camel@rocket>
Mime-Version: 1.0
X-archive-position: 469
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mike@innercite.com
Precedence: bulk
X-list: dovecot
X-UID: 469                                                  
Status: O

> Oh, write() returns EDQUOT instead of ENOSPC when quota is full? Didn't
> know that before. I'll fix it so that they're both checked. After that
> Dovecot will just use memory instead if it can't create the index files.

Thanks a lot!

-- 
Mike Machado
mike@innercite.com
InnerCite Inc.
Engineering Director / CTO


From jpeterson275@attbi.com  Wed Mar 26 19:59:33 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 26 Mar 2003 19:59:33 +0200 (EET)
Return-Path: <jpeterson275@attbi.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from sccrmhc01.attbi.com (sccrmhc01.attbi.com [204.127.202.61])
	by danu.procontrol.fi (Postfix) with ESMTP id 4BCF423825
	for <dovecot@procontrol.fi>; Wed, 26 Mar 2003 19:59:33 +0200 (EET)
Received: from attbi.com (12-228-143-121.client.attbi.com[12.228.143.121])
          by sccrmhc01.attbi.com (sccrmhc01) with SMTP
          id <2003032617593000100ctbmde>; Wed, 26 Mar 2003 17:59:30 +0000
Message-ID: <3E81EA93.5000306@attbi.com>
Date: Wed, 26 Mar 2003 09:59:47 -0800
From: Jesse Peterson <jpeterson275@attbi.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Re: FETCH BODY[part]<partial>
References: <3E80B3D3.6050603@attbi.com> <1048669793.30187.133.camel@hurina> <3E81BEAF.8050803@attbi.com>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 470
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jpeterson275@attbi.com
Precedence: bulk
X-list: dovecot
X-UID: 470                                                  
Status: O
Content-Length: 1423

I've found a couple of things:

When the reply to the fetch is given, it seems to be missing a ")" on 
the end:

23 UID FETCH 48 BODY.PEEK[]<8192.1915>
* 48 FETCH (UID 48 BODY[]<8192> {1915}

How does an IMAP client learn the size of a message?  Because the size 
of this particular message is 10107 bytes (header + message, in a 
maildir file).  The IMAP client (Mac OS X Mail.app) asks for two chunks 
of the body: 8192 and 1915.  Together these two make 10107, but that's 
1448 bytes too big.  In fact, 1448 is the size of the header it requests:

21 UID FETCH 48 BODY.PEEK[HEADER]
* 48 FETCH (UID 48 BODY[HEADER] {1448}

Together, that is 11555, too much.


Further investigation gives me this:

For another message that is 11821 bytes (header+body,maildir), this is 
the request:

37 UID FETCH 20:* (INTERNALDATE UID RFC822.SIZE FLAGS 
BODY.PEEK[HEADER.FIELDS (date subject from to list-id)])
* 17 FETCH (UID 20 FLAGS (\Recent) INTERNALDATE "26-Mar-2003 09:47:03 
-0800" RFC822.SIZE 12116 BODY[HEADER.FIELDS (DATE SUBJECT FROM TO 
LIST-ID)] {148}

If you multiply the simple header returned by this (148) by two, then 
add that to the filesize of the message, you get 12117 (minus a CR 
probably).  Is this how RFC822.SIZE is defined?

Anyway, in conclusion, it now DOES work, it's just that apparently 
Mail.app cached the old file sizes on the broken messages, so those 
didn't work (i think).


Thanks again Timo.


From mem@mv.mv.com  Wed Mar 26 20:28:03 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 26 Mar 2003 20:28:03 +0200 (EET)
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id D138C23825
	for <dovecot@procontrol.fi>; Wed, 26 Mar 2003 20:28:02 +0200 (EET)
Received: (qmail 1690 invoked by uid 101); 26 Mar 2003 13:28:01 -0500
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Wed, 26 Mar 2003 13:28:01 -0500
To: dovecot@procontrol.fi
Subject: [dovecot] Failure in the presence of too many connections
Message-ID: <20030326132801.B26665@iridium.mv.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
X-archive-position: 471
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mem@mv.mv.com
Precedence: bulk
X-list: dovecot
X-UID: 471                                                  
Status: O


Had an event today where dovecot refused new connections and would not
accept more until restarted, whereupon it worked for a few minutes and
locked up again.  Looking at the logs it appeared that it had run out
of file descriptors.  I increased the open files limit and started it
again-- which worked but it only pushes off the problem.

Does dovecot keep an open file descriptor for every imap or pop3
child?  If so, this would argue more towards a tcpserver sort of
control.  If not, perhaps something is leaking..

-mm-

PS: assume you saw recent RFCs 3501 and 3502 ?


From tss@iki.fi  Wed Mar 26 20:31:46 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 26 Mar 2003 20:31:46 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id DA45823825
	for <dovecot@procontrol.fi>; Wed, 26 Mar 2003 20:31:45 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 1EF855E928E0; Wed, 26 Mar 2003 20:31:45 +0200 (EET)
Subject: [dovecot] Re: FETCH BODY[part]<partial>
From: Timo Sirainen <tss@iki.fi>
To: Jesse Peterson <jpeterson275@attbi.com>
Cc: Dovecot Mail List <dovecot@procontrol.fi>
In-Reply-To: <3E81EA93.5000306@attbi.com>
References: <3E80B3D3.6050603@attbi.com> <1048669793.30187.133.camel@hurina>
	 <3E81BEAF.8050803@attbi.com>  <3E81EA93.5000306@attbi.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1048703504.30186.200.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 26 Mar 2003 20:31:45 +0200
X-archive-position: 472
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 472                                                  
Status: O

On Wed, 2003-03-26 at 19:59, Jesse Peterson wrote:
> When the reply to the fetch is given, it seems to be missing a ")" on 
> the end:

It's sent after the message text.

> 23 UID FETCH 48 BODY.PEEK[]<8192.1915>
> * 48 FETCH (UID 48 BODY[]<8192> {1915}
> 
> How does an IMAP client learn the size of a message?  Because the size 
> of this particular message is 10107 bytes (header + message, in a 
> maildir file).

IMAP requires that linebreaks are CR+LF. In maildir files you have only
LFs. So there's one extra byte per each line.

> If you multiply the simple header returned by this (148) by two, then 
> add that to the filesize of the message, you get 12117 (minus a CR 
> probably).  Is this how RFC822.SIZE is defined?

RFC822.SIZE is just the full size of message, again with CR+LFs.

> Anyway, in conclusion, it now DOES work, it's just that apparently 
> Mail.app cached the old file sizes on the broken messages, so those 
> didn't work (i think).

OK, good. Now only thing left to fix is SSL proxy.


From tss@iki.fi  Wed Mar 26 20:45:04 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 26 Mar 2003 20:45:04 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 757BD23839
	for <dovecot@procontrol.fi>; Wed, 26 Mar 2003 20:45:04 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id A43125E928E0; Wed, 26 Mar 2003 20:45:03 +0200 (EET)
Subject: [dovecot] Re: Failure in the presence of too many connections
From: Timo Sirainen <tss@iki.fi>
To: "Mark E. Mallett" <mem@mv.mv.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030326132801.B26665@iridium.mv.net>
References: <20030326132801.B26665@iridium.mv.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1048704303.31565.214.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 
Date: 26 Mar 2003 20:45:03 +0200
X-archive-position: 473
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 473                                                  
Status: O

On Wed, 2003-03-26 at 20:28, Mark E. Mallett wrote:
> Had an event today where dovecot refused new connections and would not
> accept more until restarted, whereupon it worked for a few minutes and
> locked up again.  Looking at the logs it appeared that it had run out
> of file descriptors.  I increased the open files limit and started it
> again-- which worked but it only pushes off the problem.

Which process ran out of fds? "dovecot"?

> Does dovecot keep an open file descriptor for every imap or pop3
> child?

No, except imap-login <-> imap does keep one open for SSL connections. 

>   If so, this would argue more towards a tcpserver sort of
> control.  If not, perhaps something is leaking..

I haven't noticed any leaks. stracing dovecot process kept the fds
pretty much the same.

> PS: assume you saw recent RFCs 3501 and 3502 ?

Yes, I've read both as drafts.


From dgc@uchicago.edu  Wed Mar 26 21:15:38 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 26 Mar 2003 21:15:38 +0200 (EET)
Return-Path: <dgc@uchicago.edu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from dust.uchicago.edu (dust.uchicago.edu [128.135.0.35])
	by danu.procontrol.fi (Postfix) with ESMTP id 5943A23839
	for <dovecot@procontrol.fi>; Wed, 26 Mar 2003 21:15:36 +0200 (EET)
Received: (from dgc@localhost)
	by dust.uchicago.edu (8.11.6/8.11.6) id h2QJFRs29565;
	Wed, 26 Mar 2003 13:15:27 -0600 (CST)
X-Authentication-Warning: dust.uchicago.edu: dgc set sender to dgc@uchicago.edu using -f
Date: Wed, 26 Mar 2003 13:15:27 -0600
From: David Champion <dgc@uchicago.edu>
To: Mike Machado <mike@innercite.com>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: Dovecot and Quotas
Message-ID: <20030326191527.GB25982@dust.uchicago.edu>
Mail-Followup-To: Mike Machado <mike@innercite.com>,
	dovecot@procontrol.fi
References: <1048636121.31457.31.camel@rocket> <1048649163.5455.0.camel@binkley> <1048697679.31484.40.camel@rocket>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1048697679.31484.40.camel@rocket>
User-Agent: Mutt/1.5.2i
X-archive-position: 474
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: dgc@uchicago.edu
Precedence: bulk
X-list: dovecot
X-UID: 474                                                  
Status: O
Content-Length: 2397

* On 2003.03.26, in <1048697679.31484.40.camel@rocket>,
*	"Mike Machado" <mike@innercite.com> wrote:
> I have seen this suggestion elsewhere and would be perfect. The customer
> only needs a few extra kilobytes when their quota is full, so the hard
> quota could be just a bit bigger with a long/unlimited grace. The hard
> part is to get procmail or whatever local delivery agent to stop at the
> SOFT quota. I could probably quite some funky procmail rules, but that
> will add an unwanted amount of load to an already busy system. Anyone
> know if their are some built in sendmail/procmail checking that can aide
> here?

None that I know of. Hard quotas are terrible for a mail system, in my
experience. Part of the trouble is the automation -- we run across a lot
of cases where automated management isn't very nice to users. There are
always exceptions -- Professor Jones is doing field research in Egypt,
or somesuch, and has limited access. For such cases, we want longer
quota warning periods.

We have a nightly job that checks everyone's mail usage nightly. If
someone's usage goes above what we consider good, it decrements a
counter, set initially to 7 days (5 working days). Each day that this
counter is set, it mails the user a warning that mail will be blocked
in N days, and when a counter reaches 0 it mails us, the admins, and we
run a script to block access. Part of this is sticking a helpful entry
in /etc/mail/access to block incoming mail. (We use sendmail.) So that's
where you can cause SMTP blocks, but you need your own scripts for
managing it.

There are two loopholes here -- people can still store as much mail as
they want to the server via IMAP, and people can neglect their overuse
for as long as they want to. Those might be weaknesses or advantages,
depending on how you look at it. But most people want new mail via SMTP,
too, and they don't get it until they clear their IMAP. But since we
have so many users, the relatively small number of troublesome users
never cause major trouble -- their abuses are relatively small. IOW, we
don't generally need to keep individuals reined in, just the masses.

-- 
 -D.	dgc@uchicago.edu	NSIT	University of Chicago
 "The whole thrust of the text adventure was one picture was worth
  a thousand words and we would rather give you the thousand words."
                                        - Dave Lebling, Implementor

From mem@mv.mv.com  Wed Mar 26 21:17:11 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 26 Mar 2003 21:17:11 +0200 (EET)
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id 59F4523839
	for <dovecot@procontrol.fi>; Wed, 26 Mar 2003 21:17:11 +0200 (EET)
Received: (qmail 4370 invoked by uid 101); 26 Mar 2003 14:17:09 -0500
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Wed, 26 Mar 2003 14:17:09 -0500
To: Timo Sirainen <tss@iki.fi>
Cc: "Mark E. Mallett" <mem@mv.mv.com>, dovecot@procontrol.fi
Subject: [dovecot] Re: Failure in the presence of too many connections
Message-ID: <20030326141709.A2687@iridium.mv.net>
References: <20030326132801.B26665@iridium.mv.net> <1048704303.31565.214.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
In-Reply-To: <1048704303.31565.214.camel@hurina>; from tss@iki.fi on Wed, Mar 26, 2003 at 08:45:03PM +0200
X-archive-position: 475
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mem@mv.mv.com
Precedence: bulk
X-list: dovecot
X-UID: 475                                                  
Status: O

On Wed, Mar 26, 2003 at 08:45:03PM +0200, Timo Sirainen wrote:
> On Wed, 2003-03-26 at 20:28, Mark E. Mallett wrote:
> > Had an event today where dovecot refused new connections and would not
> > accept more until restarted, whereupon it worked for a few minutes and
> > locked up again.  Looking at the logs it appeared that it had run out
> > of file descriptors.  I increased the open files limit and started it
> > again-- which worked but it only pushes off the problem.
> 
> Which process ran out of fds? "dovecot"?

Sorry for being non-specific.  dovecot-auth was the program that logged
the error, like this:

dovecot-auth: getpwnam(xxxx) failed: Too many open files

mm

From jpeterson275@attbi.com  Thu Mar 27 01:42:01 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 27 Mar 2003 01:42:01 +0200 (EET)
Return-Path: <jpeterson275@attbi.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from rwcrmhc53.attbi.com (rwcrmhc53.attbi.com [204.127.198.39])
	by danu.procontrol.fi (Postfix) with ESMTP id B525823825
	for <dovecot@procontrol.fi>; Thu, 27 Mar 2003 01:42:00 +0200 (EET)
Received: from attbi.com (12-228-143-121.client.attbi.com[12.228.143.121])
          by rwcrmhc53.attbi.com (rwcrmhc53) with SMTP
          id <20030326234159053005kae6e>; Wed, 26 Mar 2003 23:41:59 +0000
Message-ID: <3E823AD7.1040300@attbi.com>
Date: Wed, 26 Mar 2003 15:42:15 -0800
From: Jesse Peterson <jpeterson275@attbi.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Re: FETCH BODY[part]<partial>
References: <3E80B3D3.6050603@attbi.com> <1048669793.30187.133.camel@hurina>	 <3E81BEAF.8050803@attbi.com>  <3E81EA93.5000306@attbi.com> <1048703504.30186.200.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 476
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jpeterson275@attbi.com
Precedence: bulk
X-list: dovecot
X-UID: 476                                                  
Status: O


> 
> IMAP requires that linebreaks are CR+LF. In maildir files you have only
> LFs. So there's one extra byte per each line.
> RFC822.SIZE is just the full size of message, again with CR+LFs.

D'0h, I feel like an idiot now. =)


> 
> OK, good. Now only thing left to fix is SSL proxy.
> 
> 
> 

What happens to be wrong with the SSL proxy?

-- 
Jesse Peterson  /  jesse@pixeltechs.com


From tss@iki.fi  Sat Mar 29 11:00:39 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 29 Mar 2003 11:00:39 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 08A2623839
	for <dovecot@procontrol.fi>; Sat, 29 Mar 2003 11:00:38 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 8D08D5E017F5; Sat, 29 Mar 2003 11:00:38 +0200 (EET)
Subject: [dovecot] Re: FETCH BODY[part]<partial>
From: Timo Sirainen <tss@iki.fi>
To: Dovecot Mail List <dovecot@procontrol.fi>
In-Reply-To: <3E823AD7.1040300@attbi.com>
References: <3E80B3D3.6050603@attbi.com> <1048669793.30187.133.camel@hurina>
	 <3E81BEAF.8050803@attbi.com>  <3E81EA93.5000306@attbi.com>
	 <1048703504.30186.200.camel@hurina>  <3E823AD7.1040300@attbi.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1048928438.6856.15.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.3 
Date: 29 Mar 2003 11:00:38 +0200
X-archive-position: 477
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 477                                                  
Status: O

On Thu, 2003-03-27 at 01:42, Jesse Peterson wrote:
> > OK, good. Now only thing left to fix is SSL proxy.
> What happens to be wrong with the SSL proxy?

It seems to get stuck sometimes. I think it's now fixed in CVS. Or this
is with openssl at least, I'm not really sure how well gnutls works.


From tss@iki.fi  Sat Mar 29 11:05:23 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 29 Mar 2003 11:05:23 +0200 (EET)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 8F8ED23839
	for <dovecot@procontrol.fi>; Sat, 29 Mar 2003 11:05:23 +0200 (EET)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 59AF85E017F5; Sat, 29 Mar 2003 11:05:23 +0200 (EET)
Subject: [dovecot] Re: Failure in the presence of too many connections
From: Timo Sirainen <tss@iki.fi>
To: "Mark E. Mallett" <mem@mv.mv.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030326141709.A2687@iridium.mv.net>
References: <20030326132801.B26665@iridium.mv.net>
	 <1048704303.31565.214.camel@hurina>  <20030326141709.A2687@iridium.mv.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1048928723.6856.21.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.3 
Date: 29 Mar 2003 11:05:23 +0200
X-archive-position: 478
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 478                                                  
Status: O

On Wed, 2003-03-26 at 21:17, Mark E. Mallett wrote:
> Sorry for being non-specific.  dovecot-auth was the program that logged
> the error, like this:
> 
> dovecot-auth: getpwnam(xxxx) failed: Too many open files

What passdb are you using? PAM? Something is leaking fds there, but I
don't think it's getpwnam() itself.


From mem@mv.mv.com  Sat Mar 29 16:39:52 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 29 Mar 2003 16:39:52 +0200 (EET)
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id 9D80623825
	for <dovecot@procontrol.fi>; Sat, 29 Mar 2003 16:39:51 +0200 (EET)
Received: (qmail 6368 invoked by uid 101); 29 Mar 2003 09:39:49 -0500
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Sat, 29 Mar 2003 09:39:49 -0500
To: Timo Sirainen <tss@iki.fi>
Cc: "Mark E. Mallett" <mem@mv.mv.com>, dovecot@procontrol.fi
Subject: [dovecot] Re: Failure in the presence of too many connections
Message-ID: <20030329093949.B18450@iridium.mv.net>
References: <20030326132801.B26665@iridium.mv.net> <1048704303.31565.214.camel@hurina> <20030326141709.A2687@iridium.mv.net> <1048928723.6856.21.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
In-Reply-To: <1048928723.6856.21.camel@hurina>; from tss@iki.fi on Sat, Mar 29, 2003 at 11:05:23AM +0200
X-archive-position: 479
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mem@mv.mv.com
Precedence: bulk
X-list: dovecot
X-UID: 479                                                  
Status: O

On Sat, Mar 29, 2003 at 11:05:23AM +0200, Timo Sirainen wrote:
> On Wed, 2003-03-26 at 21:17, Mark E. Mallett wrote:
> > Sorry for being non-specific.  dovecot-auth was the program that logged
> > the error, like this:
> > 
> > dovecot-auth: getpwnam(xxxx) failed: Too many open files
> 
> What passdb are you using? PAM? Something is leaking fds there, but I
> don't think it's getpwnam() itself.

Hi-

Plain old passwd file checking.

auth = default
auth_mechanisms = plain
auth_userdb = passwd
auth_passdb = passwd

mm

From maikel@ladot.com  Sun Mar 30 23:38:09 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 30 Mar 2003 23:38:09 +0300 (EEST)
Return-Path: <maikel@ladot.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from zeus.ladot.com (office.ladot.com [217.22.64.134])
	by danu.procontrol.fi (Postfix) with ESMTP id 1E5D12385F
	for <dovecot@procontrol.fi>; Sun, 30 Mar 2003 23:38:09 +0300 (EEST)
Received: from nlladot05.freehosting (nlladot05.intern.ladot.com [172.31.2.13])
	by zeus.ladot.com (8.12.8/8.12.6) with ESMTP id h2UKmpmB033512
	for <dovecot@procontrol.fi>; Sun, 30 Mar 2003 22:48:51 +0200 (CEST)
	(envelope-from maikel@ladot.com)
Received: by nlladot05.intern.ladot.com with Internet Mail Service (5.5.2653.19)
	id <1VFZ7X2K>; Sun, 30 Mar 2003 22:23:57 +0200
Message-ID: <410777FC7A66D511911500B0D0783455024C4F8F@nlladot05.intern.ladot.com>
From: Maikel Verheijen <maikel@ladot.com>
To: "Dovecot (E-mail)" <dovecot@procontrol.fi>
Subject: [dovecot] NFS mounted IMAP dirs
Date: Sun, 30 Mar 2003 22:23:56 +0200
MIME-Version: 1.0
X-Mailer: Internet Mail Service (5.5.2653.19)
Content-Type: multipart/alternative;
	boundary="----_=_NextPart_001_01C2F6FA.4A1A9C30"
X-Spam-Status: No, hits=0.9 required=5.0
	tests=EXCHANGE_SERVER,MIME_NULL_BLOCK,SPAM_PHRASE_03_05
	version=2.44
X-archive-position: 480
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: maikel@ladot.com
Precedence: bulk
X-list: dovecot
X-UID: 480                                                  
Status: O
Content-Length: 3333

This message is in MIME format. Since your mail reader does not understand
this format, some or all of this message may not be legible.

------_=_NextPart_001_01C2F6FA.4A1A9C30
Content-Type: text/plain;
	charset="iso-8859-1"

Hi list,


I am trying to build an email system that is using multiple frontends, to a
clustered backend using nfs. The backend mounts his filesystems from a
central storage, and will be running active-active.

While reading through the dovecot documentation, I read that I could do
without indexes (well: use memory indexes), and could then be able to run
dovecot over NFS. Well: that was until friday, when I was reading a little
bit better through nfs.txt. :)

My problem is now that dovecot writes it's subscriptions to the mailstore.
Since I want as little difference between my frondends as possible, (and as
static as possible), I would love to see dovecot handle subscriptions in a
database, or perhaps a nfs-safe file.

Since I am only a junior programmer (my code is really not far from "Hello
world", although I am trying to find some time to teach myself more), I
might not be able to be of much assistance to you all in coding stuff, but I
am willing to help out where-ever possible.

Can anyone help me solve my problem in any way, and how can I contribute as
well?


Thank you all,

Maikel Verheijen.

------_=_NextPart_001_01C2F6FA.4A1A9C30
Content-Type: text/html;
	charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV=3D"Content-Type" CONTENT=3D"text/html; =
charset=3Diso-8859-1">
<META NAME=3D"Generator" CONTENT=3D"MS Exchange Server version =
5.5.2653.12">
<TITLE>NFS mounted IMAP dirs</TITLE>
</HEAD>
<BODY>

<P><FONT SIZE=3D2 FACE=3D"Arial">Hi list,</FONT>
</P>
<BR>

<P><FONT SIZE=3D2 FACE=3D"Arial">I am trying to build an email system =
that is using multiple frontends, to a clustered backend using nfs. The =
backend mounts his filesystems from a central storage, and will be =
running active-active.</FONT></P>

<P><FONT SIZE=3D2 FACE=3D"Arial">While reading through the dovecot =
documentation, I read that I could do without indexes (well: use memory =
indexes), and could then be able to run dovecot over NFS. Well: that =
was until friday, when I was reading a little bit better through =
nfs.txt. :)</FONT></P>

<P><FONT SIZE=3D2 FACE=3D"Arial">My problem is now that dovecot writes =
it's subscriptions to the mailstore. Since I want as little difference =
between my frondends as possible, (and as static as possible), I would =
love to see dovecot handle subscriptions in a database, or perhaps a =
nfs-safe file.</FONT></P>

<P><FONT SIZE=3D2 FACE=3D"Arial">Since I am only a junior programmer =
(my code is really not far from &quot;Hello world&quot;, although I am =
trying to find some time to teach myself more), I might not be able to =
be of much assistance to you all in coding stuff, but I am willing to =
help out where-ever possible.</FONT></P>

<P><FONT SIZE=3D2 FACE=3D"Arial">Can anyone help me solve my problem in =
any way, and how can I contribute as well?</FONT>
</P>
<BR>

<P><FONT SIZE=3D2 FACE=3D"Arial">Thank you all,</FONT>
</P>

<P><FONT SIZE=3D2 FACE=3D"Arial">Maikel Verheijen.</FONT>
</P>

</BODY>
</HTML>
------_=_NextPart_001_01C2F6FA.4A1A9C30--

From tss@iki.fi  Mon Mar 31 11:53:48 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 31 Mar 2003 11:53:48 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 4B7BF23839
	for <dovecot@procontrol.fi>; Mon, 31 Mar 2003 11:53:48 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 131315E017F5; Mon, 31 Mar 2003 11:53:48 +0300 (EEST)
Subject: [dovecot] Re: NFS mounted IMAP dirs
From: Timo Sirainen <tss@iki.fi>
To: Maikel Verheijen <maikel@ladot.com>
Cc: "Dovecot (E-mail)" <dovecot@procontrol.fi>
In-Reply-To: <410777FC7A66D511911500B0D0783455024C4F8F@nlladot05.intern.ladot.com>
References:
	 <410777FC7A66D511911500B0D0783455024C4F8F@nlladot05.intern.ladot.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1049100827.883.119.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.3 
Date: 31 Mar 2003 11:53:47 +0300
X-archive-position: 481
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 481                                                  
Status: O

On Sun, 2003-03-30 at 23:23, Maikel Verheijen wrote:
> While reading through the dovecot documentation, I read that I could
> do without indexes (well: use memory indexes),

Currently that's not really good idea, since message UIDs aren't then
stored permanently. In CVS there's support for this with mbox format,
and I've also been writing support for Courier-like uidlist-file, but
that's still not really working.

> My problem is now that dovecot writes it's subscriptions to the
> mailstore. Since I want as little difference between my frondends as
> possible, (and as static as possible), I would love to see dovecot
> handle subscriptions in a database, or perhaps a nfs-safe file.

Database? SQL? Another problem is also .customflags file which isn't
NFS-safe. With mbox it's not really required, but with Maildir it is if
you want custom message flags. It wouldn't be too difficult to change
the code to use dotlock files with these files anyway, I've been going
to make it configurable.


From tss@iki.fi  Mon Mar 31 11:59:21 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 31 Mar 2003 11:59:21 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 8902F23839
	for <dovecot@procontrol.fi>; Mon, 31 Mar 2003 11:59:21 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 50E4B5E017F5; Mon, 31 Mar 2003 11:59:21 +0300 (EEST)
Subject: [dovecot] Re: Failure in the presence of too many connections
From: Timo Sirainen <tss@iki.fi>
To: "Mark E. Mallett" <mem@mv.mv.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030329093949.B18450@iridium.mv.net>
References: <20030326132801.B26665@iridium.mv.net>
	 <1048704303.31565.214.camel@hurina> <20030326141709.A2687@iridium.mv.net>
	 <1048928723.6856.21.camel@hurina>  <20030329093949.B18450@iridium.mv.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1049101161.884.126.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.3 
Date: 31 Mar 2003 11:59:21 +0300
X-archive-position: 482
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 482                                                  
Status: O

On Sat, 2003-03-29 at 16:39, Mark E. Mallett wrote:
> > > dovecot-auth: getpwnam(xxxx) failed: Too many open files
> > 
> > What passdb are you using? PAM? Something is leaking fds there, but I
> > don't think it's getpwnam() itself.
> 
> Plain old passwd file checking.
> 
> auth = default
> auth_mechanisms = plain
> auth_userdb = passwd
> auth_passdb = passwd

Well, that's strange. I don't think getpwnam() should leave any fds
open. Auth process does keep one fd per login process, but that's also
closed when client logs in or closes the connection. Maybe using
passwd-file instead would help?


From maikel@ladot.com  Mon Mar 31 12:06:31 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 31 Mar 2003 12:06:31 +0300 (EEST)
Return-Path: <maikel@ladot.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from zeus.ladot.com (office.ladot.com [217.22.64.134])
	by danu.procontrol.fi (Postfix) with ESMTP id 8ED2C23839
	for <dovecot@procontrol.fi>; Mon, 31 Mar 2003 12:06:31 +0300 (EEST)
Received: from nlladot05.freehosting (nlladot05.intern.ladot.com [172.31.2.13])
	by zeus.ladot.com (8.12.8/8.12.6) with ESMTP id h2V9GwmB038080;
	Mon, 31 Mar 2003 11:16:58 +0200 (CEST)
	(envelope-from maikel@ladot.com)
Received: by nlladot05.intern.ladot.com with Internet Mail Service (5.5.2653.19)
	id <1VFZ7X0B>; Mon, 31 Mar 2003 10:52:02 +0200
Message-ID: <410777FC7A66D511911500B0D0783455024C4F94@nlladot05.intern.ladot.com>
From: Maikel Verheijen <maikel@ladot.com>
To: "'Timo Sirainen'" <tss@iki.fi>
Cc: "Dovecot (E-mail)" <dovecot@procontrol.fi>
Subject: [dovecot] Re: NFS mounted IMAP dirs
Date: Mon, 31 Mar 2003 10:52:01 +0200
MIME-Version: 1.0
X-Mailer: Internet Mail Service (5.5.2653.19)
Content-Type: multipart/alternative;
	boundary="----_=_NextPart_001_01C2F762.CB6F2630"
X-Spam-Status: No, hits=-0.2 required=5.0
	tests=EXCHANGE_SERVER,MIME_NULL_BLOCK,QUOTED_EMAIL_TEXT,
	      SPAM_PHRASE_02_03
	version=2.44
X-archive-position: 483
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: maikel@ladot.com
Precedence: bulk
X-list: dovecot
X-UID: 483                                                  
Status: O
Content-Length: 4712

This message is in MIME format. Since your mail reader does not understand
this format, some or all of this message may not be legible.

------_=_NextPart_001_01C2F762.CB6F2630
Content-Type: text/plain

Hi Timo,

> On Sun, 2003-03-30 at 23:23, Maikel Verheijen wrote:
> > While reading through the dovecot documentation, I read 
> that I could 
> > do without indexes (well: use memory indexes),
> 
> Currently that's not really good idea, since message UIDs 
> aren't then stored permanently. In CVS there's support for 
> this with mbox format, and I've also been writing support for 
> Courier-like uidlist-file, but that's still not really working.
Well: I am working with Maildir mailstores, so I guess I need to
have a uidlist kinda file then? Sorry it wasn't clear in my post 
that I am using Maildir style mailboxes... But I figured maildir was
better than Mbox over nfs... 

> > My problem is now that dovecot writes it's subscriptions to the 
> > mailstore. Since I want as little difference between my 
> frondends as 
> > possible, (and as static as possible), I would love to see dovecot 
> > handle subscriptions in a database, or perhaps a nfs-safe file.
> 
> Database? SQL? Another problem is also .customflags file 
> which isn't NFS-safe. With mbox it's not really required, but 
> with Maildir it is if you want custom message flags. It 
> wouldn't be too difficult to change the code to use dotlock 
> files with these files anyway, I've been going to make it 
> configurable.
My current setup is with postgresql and Maildir. So in a way, a lot of
info COULD come from my database, if it isn't safe enough via nfs.

Can you make all file locking configurable? Or will you do it on a 
"per-type" basis? (eg: mailbox locking, index locking, flag-file locking,
etc).

regards,


Maikel Verheijen.

------_=_NextPart_001_01C2F762.CB6F2630
Content-Type: text/html

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="Generator" CONTENT="MS Exchange Server version 5.5.2653.12">
<TITLE>RE: [dovecot] NFS mounted IMAP dirs</TITLE>
</HEAD>
<BODY>

<P><FONT SIZE=2>Hi Timo,</FONT>
</P>

<P><FONT SIZE=2>&gt; On Sun, 2003-03-30 at 23:23, Maikel Verheijen wrote:</FONT>
<BR><FONT SIZE=2>&gt; &gt; While reading through the dovecot documentation, I read </FONT>
<BR><FONT SIZE=2>&gt; that I could </FONT>
<BR><FONT SIZE=2>&gt; &gt; do without indexes (well: use memory indexes),</FONT>
<BR><FONT SIZE=2>&gt; </FONT>
<BR><FONT SIZE=2>&gt; Currently that's not really good idea, since message UIDs </FONT>
<BR><FONT SIZE=2>&gt; aren't then stored permanently. In CVS there's support for </FONT>
<BR><FONT SIZE=2>&gt; this with mbox format, and I've also been writing support for </FONT>
<BR><FONT SIZE=2>&gt; Courier-like uidlist-file, but that's still not really working.</FONT>
<BR><FONT SIZE=2>Well: I am working with Maildir mailstores, so I guess I need to</FONT>
<BR><FONT SIZE=2>have a uidlist kinda file then? Sorry it wasn't clear in my post </FONT>
<BR><FONT SIZE=2>that I am using Maildir style mailboxes... But I figured maildir was</FONT>
<BR><FONT SIZE=2>better than Mbox over nfs... </FONT>
</P>

<P><FONT SIZE=2>&gt; &gt; My problem is now that dovecot writes it's subscriptions to the </FONT>
<BR><FONT SIZE=2>&gt; &gt; mailstore. Since I want as little difference between my </FONT>
<BR><FONT SIZE=2>&gt; frondends as </FONT>
<BR><FONT SIZE=2>&gt; &gt; possible, (and as static as possible), I would love to see dovecot </FONT>
<BR><FONT SIZE=2>&gt; &gt; handle subscriptions in a database, or perhaps a nfs-safe file.</FONT>
<BR><FONT SIZE=2>&gt; </FONT>
<BR><FONT SIZE=2>&gt; Database? SQL? Another problem is also .customflags file </FONT>
<BR><FONT SIZE=2>&gt; which isn't NFS-safe. With mbox it's not really required, but </FONT>
<BR><FONT SIZE=2>&gt; with Maildir it is if you want custom message flags. It </FONT>
<BR><FONT SIZE=2>&gt; wouldn't be too difficult to change the code to use dotlock </FONT>
<BR><FONT SIZE=2>&gt; files with these files anyway, I've been going to make it </FONT>
<BR><FONT SIZE=2>&gt; configurable.</FONT>
<BR><FONT SIZE=2>My current setup is with postgresql and Maildir. So in a way, a lot of</FONT>
<BR><FONT SIZE=2>info COULD come from my database, if it isn't safe enough via nfs.</FONT>
</P>

<P><FONT SIZE=2>Can you make all file locking configurable? Or will you do it on a </FONT>
<BR><FONT SIZE=2>&quot;per-type&quot; basis? (eg: mailbox locking, index locking, flag-file locking, etc).</FONT>
</P>

<P><FONT SIZE=2>regards,</FONT>
</P>
<BR>

<P><FONT SIZE=2>Maikel Verheijen.</FONT>
</P>

</BODY>
</HTML>
------_=_NextPart_001_01C2F762.CB6F2630--

From charlieb-dovecot@e-smith.com  Mon Mar 31 18:08:44 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 31 Mar 2003 18:08:44 +0300 (EEST)
Return-Path: <charlieb-dovecot@e-smith.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from nssg.mitel.com (mail.e-smith.com [216.191.234.126])
	by danu.procontrol.fi (Postfix) with SMTP id 0CE8323839
	for <dovecot@procontrol.fi>; Mon, 31 Mar 2003 18:08:44 +0300 (EEST)
Received: (qmail 16267 invoked by uid 404); 31 Mar 2003 15:08:41 -0000
Received: from charlieb-dovecot@e-smith.com by tripe.nssg.mitel.com with qmail-scanner; 31 Mar 2003 10:08:41 -0000
Received: from allspice-core.nssg.mitel.com (HELO e-smith.com) (10.33.16.12)
  by tripe.nssg.mitel.com (10.33.17.11) with SMTP; 31 Mar 2003 15:08:40 -0000
Received: (qmail 5279 invoked from network); 31 Mar 2003 15:08:40 -0000
Received: from vegemite.nssg.mitel.com (10.33.15.70)
  by allspice.nssg.mitel.com with QMQP; 31 Mar 2003 15:08:40 -0000
Received: from localhost (sendmail-bs@127.0.0.1)
  by localhost with SMTP; 31 Mar 2003 15:12:22 -0000
Date: Mon, 31 Mar 2003 10:12:22 -0500 (EST)
From: Charlie Brady <charlieb-dovecot@e-smith.com>
X-X-Sender: charlieb@vegemite.nssg.mitel.com
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Failure in the presence of too many connections
In-Reply-To: <1049101161.884.126.camel@hurina>
Message-ID: <Pine.LNX.4.44.0303311009510.17234-100000@vegemite.nssg.mitel.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 484
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: charlieb-dovecot@e-smith.com
Precedence: bulk
X-list: dovecot
X-UID: 484                                                  
Status: O


On 31 Mar 2003, Timo Sirainen wrote:

> On Sat, 2003-03-29 at 16:39, Mark E. Mallett wrote:
> > > > dovecot-auth: getpwnam(xxxx) failed: Too many open files
> > > 
> > > What passdb are you using? PAM? Something is leaking fds there, but I
> > > don't think it's getpwnam() itself.
> > 
> > Plain old passwd file checking.
> > 
> > auth = default
> > auth_mechanisms = plain
> > auth_userdb = passwd
> > auth_passdb = passwd
> 
> Well, that's strange. I don't think getpwnam() should leave any fds
> open. Auth process does keep one fd per login process, but that's also
> closed when client logs in or closes the connection. Maybe using
> passwd-file instead would help?

If you are running this on linux then just:

ls -l /proc/xxx/fd/*

will show you where the file descriptors are going to.

--
Charlie



From mem@mv.mv.com  Mon Mar 31 19:51:27 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 31 Mar 2003 19:51:27 +0300 (EEST)
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id C9B01238B6
	for <dovecot@procontrol.fi>; Mon, 31 Mar 2003 19:51:26 +0300 (EEST)
Received: (qmail 26111 invoked by uid 101); 31 Mar 2003 11:51:00 -0500
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Mon, 31 Mar 2003 11:51:00 -0500
To: Timo Sirainen <tss@iki.fi>
Cc: "Mark E. Mallett" <mem@mv.mv.com>, dovecot@procontrol.fi
Subject: [dovecot] Re: Failure in the presence of too many connections
Message-ID: <20030331115059.C11524@iridium.mv.net>
References: <20030326132801.B26665@iridium.mv.net> <1048704303.31565.214.camel@hurina> <20030326141709.A2687@iridium.mv.net> <1048928723.6856.21.camel@hurina> <20030329093949.B18450@iridium.mv.net> <1049101161.884.126.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
In-Reply-To: <1049101161.884.126.camel@hurina>; from tss@iki.fi on Mon, Mar 31, 2003 at 11:59:21AM +0300
X-archive-position: 485
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mem@mv.mv.com
Precedence: bulk
X-list: dovecot
X-UID: 485                                                  
Status: O
Content-Length: 1663

On Mon, Mar 31, 2003 at 11:59:21AM +0300, Timo Sirainen wrote:
> On Sat, 2003-03-29 at 16:39, Mark E. Mallett wrote:
> > > > dovecot-auth: getpwnam(xxxx) failed: Too many open files
> > > 
> > > What passdb are you using? PAM? Something is leaking fds there, but I
> > > don't think it's getpwnam() itself.
> > 
> > Plain old passwd file checking.
> > 
> > auth = default
> > auth_mechanisms = plain
> > auth_userdb = passwd
> > auth_passdb = passwd
> 
> Well, that's strange. I don't think getpwnam() should leave any fds
> open. Auth process does keep one fd per login process, but that's also
> closed when client logs in or closes the connection. Maybe using
> passwd-file instead would help?

My suspicion (without any basis, admittedly) was that the fds were
related to the interprocess communication, not the passwd file access.
I was surprised when it happened, as the system ran fine for weeks
before I saw this error, and then I saw it recur quickly when I stopped
and restarted the dovecot processes before running it again with a
higher openfiles limit.  I think the fd exhaustion is related to a
sudden burst of connections to the POP or IMAP services, not a
long-term leakage of FDs (although I did say something like that in my
initial mail).

The point was not so much that this happens-- but that it doesn't
recover when it does happen (thus the subject line).  The only way to
make the services start responding again is to stop and restart the
dovecot suite of control processes.  Raising the openfiles limit
certainly pushes off the problem, and maybe that's a good enough
workaround (as long as there's always a higher limit availble...)

mm

From mem@mv.mv.com  Mon Mar 31 19:54:36 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 31 Mar 2003 19:54:36 +0300 (EEST)
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id F0413238B6
	for <dovecot@procontrol.fi>; Mon, 31 Mar 2003 19:54:34 +0300 (EEST)
Received: (qmail 28910 invoked by uid 101); 31 Mar 2003 11:53:48 -0500
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Mon, 31 Mar 2003 11:53:48 -0500
To: Charlie Brady <charlieb-dovecot@e-smith.com>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: Failure in the presence of too many connections
Message-ID: <20030331115348.D11524@iridium.mv.net>
References: <1049101161.884.126.camel@hurina> <Pine.LNX.4.44.0303311009510.17234-100000@vegemite.nssg.mitel.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
In-Reply-To: <Pine.LNX.4.44.0303311009510.17234-100000@vegemite.nssg.mitel.com>; from charlieb-dovecot@e-smith.com on Mon, Mar 31, 2003 at 10:12:22AM -0500
X-archive-position: 486
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mem@mv.mv.com
Precedence: bulk
X-list: dovecot
X-UID: 486                                                  
Status: O

> 
> If you are running this on linux then just:
> 
> ls -l /proc/xxx/fd/*
> 
> will show you where the file descriptors are going to.

no procfs here- yeah I could have done an 'fstat' or 'lsof' and traced
it further but did not think to do so.

mm

From seba@iq.pl  Mon Mar 31 22:10:53 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 31 Mar 2003 22:10:53 +0300 (EEST)
Return-Path: <seba@iq.pl>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from serv.iq.pl (serv.iq.pl [213.76.165.9])
	by danu.procontrol.fi (Postfix) with ESMTP id 9A51A238B6
	for <dovecot@procontrol.fi>; Mon, 31 Mar 2003 22:10:53 +0300 (EEST)
Received: by serv.iq.pl (Postfix, from userid 1390)
	id C280D6BDB3; Mon, 31 Mar 2003 21:11:20 +0200 (CEST)
Date: Mon, 31 Mar 2003 21:11:20 +0200
From: Sebastian Pachuta <seba@iq.pl>
To: dovecot@procontrol.fi
Subject: [dovecot] dovecot-0.99.8.1 @ old redhat6.2 box
Message-ID: <20030331191120.GB32315@iq.pl>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
X-archive-position: 487
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: seba@iq.pl
Precedence: bulk
X-list: dovecot
X-UID: 487                                                  
Status: O

Hi

I have some odd problem with running dovecot.
Program dies with message in maillog:

Mar 31 21:04:02 test-box dovecot: Dovecot starting up
Mar 31 21:04:04 test-box dovecot: execv(imap-login) failed: Resource temporarily unavailable
Mar 31 21:04:04 test-box dovecot: execv(imap-login) failed: Resource temporarily unavailable
Mar 31 21:04:04 test-box dovecot: Login process died too early - shutting down
Mar 31 21:04:04 test-box dovecot: child 28870 (login) returned error 84 (exec() failed)
Mar 31 21:04:04 test-box dovecot: child 28869 (login) returned error 84 (exec() failed)
Mar 31 21:04:04 test-box dovecot: execv(imap-login) failed: Resource temporarily unavailable

System is redhat6.2 (with all updates), kernel is 2.2.25 (with openwall
patch). Under rh7.3 dovecot launches fine.

From charlieb-dovecot@e-smith.com  Mon Mar 31 22:15:48 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 31 Mar 2003 22:15:48 +0300 (EEST)
Return-Path: <charlieb-dovecot@e-smith.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from nssg.mitel.com (mail.e-smith.com [216.191.234.126])
	by danu.procontrol.fi (Postfix) with SMTP id 0FDE2238B6
	for <dovecot@procontrol.fi>; Mon, 31 Mar 2003 22:15:48 +0300 (EEST)
Received: (qmail 26423 invoked by uid 404); 31 Mar 2003 19:15:46 -0000
Received: from charlieb-dovecot@e-smith.com by tripe.nssg.mitel.com with qmail-scanner; 31 Mar 2003 14:15:46 -0000
Received: from allspice-core.nssg.mitel.com (HELO e-smith.com) (10.33.16.12)
  by tripe.nssg.mitel.com (10.33.17.11) with SMTP; 31 Mar 2003 19:15:46 -0000
Received: (qmail 26113 invoked from network); 31 Mar 2003 19:15:46 -0000
Received: from vegemite.nssg.mitel.com (10.33.15.70)
  by allspice.nssg.mitel.com with QMQP; 31 Mar 2003 19:15:46 -0000
Received: from localhost (sendmail-bs@127.0.0.1)
  by localhost with SMTP; 31 Mar 2003 19:19:27 -0000
Date: Mon, 31 Mar 2003 14:19:27 -0500 (EST)
From: Charlie Brady <charlieb-dovecot@e-smith.com>
X-X-Sender: charlieb@vegemite.nssg.mitel.com
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Failure in the presence of too many connections
In-Reply-To: <20030331115059.C11524@iridium.mv.net>
Message-ID: <Pine.LNX.4.44.0303311414410.17234-100000@vegemite.nssg.mitel.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 488
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: charlieb-dovecot@e-smith.com
Precedence: bulk
X-list: dovecot
X-UID: 488                                                  
Status: O


On Mon, 31 Mar 2003, Mark E. Mallett wrote:

> The only way to make the services start responding again is to stop and
> restart the dovecot suite of control processes. dovecot suite of control
> processes.

Or you can run things my way (under tcpserver/stunnel/imapfront-auth) and 
there's one dovecot process for each connection, each unrelated. This 
illustrates my point about re-using already well trusted simple programs
to do as much of the task as possible. 

> Raising the openfiles limit
> certainly pushes off the problem, and maybe that's a good enough
> workaround (as long as there's always a higher limit availble...)

... which is something that you can *never* assume.

--
Charlie




From mem@mv.mv.com  Mon Mar 31 22:27:14 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 31 Mar 2003 22:27:14 +0300 (EEST)
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id D83F7238B6
	for <dovecot@procontrol.fi>; Mon, 31 Mar 2003 22:27:13 +0300 (EEST)
Received: (qmail 20536 invoked by uid 101); 31 Mar 2003 14:27:13 -0500
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Mon, 31 Mar 2003 14:27:13 -0500
To: Charlie Brady <charlieb-dovecot@e-smith.com>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: Failure in the presence of too many connections
Message-ID: <20030331142713.E20665@iridium.mv.net>
References: <20030331115059.C11524@iridium.mv.net> <Pine.LNX.4.44.0303311414410.17234-100000@vegemite.nssg.mitel.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
In-Reply-To: <Pine.LNX.4.44.0303311414410.17234-100000@vegemite.nssg.mitel.com>; from charlieb-dovecot@e-smith.com on Mon, Mar 31, 2003 at 02:19:27PM -0500
X-archive-position: 489
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mem@mv.mv.com
Precedence: bulk
X-list: dovecot
X-UID: 489                                                  
Status: O
Content-Length: 1482

On Mon, Mar 31, 2003 at 02:19:27PM -0500, Charlie Brady wrote:
> 
> On Mon, 31 Mar 2003, Mark E. Mallett wrote:
> 
> > The only way to make the services start responding again is to stop and
> > restart the dovecot suite of control processes. dovecot suite of control
> > processes.
> 
> Or you can run things my way (under tcpserver/stunnel/imapfront-auth) and 
> there's one dovecot process for each connection, each unrelated. This 
> illustrates my point about re-using already well trusted simple programs
> to do as much of the task as possible. 

yep- this kind of brings us full circle back to my original message :-)
(I had mentioned that this kind of problem may be less likely with
a tcpserver approach).

Although the distinction is not between using well-trusted simple
programs vs large monolitic ones, but how you access those simple
programs.  Do you use a long-running auth process and talk to it via a
UNIX socket (or other inteface), or fire up a new auth process for
each need?  Personally I'm with you: unless there's an awful lot of
state or caching or other long-term need that you lose by creating a
new auth process each time (e.g.  like innd's "actived" process), I'd
vote for a one-time short-running auth process.


> > Raising the openfiles limit
> > certainly pushes off the problem, and maybe that's a good enough
> > workaround (as long as there's always a higher limit availble...)
> 
> ... which is something that you can *never* assume.

Amen

mm

From tss@iki.fi  Mon Mar 31 22:30:26 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 31 Mar 2003 22:30:26 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id A4F3E238B6
	for <dovecot@procontrol.fi>; Mon, 31 Mar 2003 22:30:26 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id DFB095E0EC7E; Mon, 31 Mar 2003 22:30:25 +0300 (EEST)
Subject: [dovecot] Re: Failure in the presence of too many connections
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.44.0303311414410.17234-100000@vegemite.nssg.mitel.com>
References:
	 <Pine.LNX.4.44.0303311414410.17234-100000@vegemite.nssg.mitel.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1049139025.959.7.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.3 
Date: 31 Mar 2003 22:30:25 +0300
X-archive-position: 490
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 490                                                  
Status: O

On Mon, 2003-03-31 at 22:19, Charlie Brady wrote:
> Or you can run things my way (under tcpserver/stunnel/imapfront-auth) and 
> there's one dovecot process for each connection, each unrelated. This 
> illustrates my point about re-using already well trusted simple programs
> to do as much of the task as possible. 

Didn't you just say imapfront connected to separate auth process via
unix socket?


From tss@iki.fi  Mon Mar 31 22:33:00 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 31 Mar 2003 22:33:00 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id D02B0238B6
	for <dovecot@procontrol.fi>; Mon, 31 Mar 2003 22:33:00 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 995315E0EC7E; Mon, 31 Mar 2003 22:33:00 +0300 (EEST)
Subject: [dovecot] Re: dovecot-0.99.8.1 @ old redhat6.2 box
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030331191120.GB32315@iq.pl>
References: <20030331191120.GB32315@iq.pl>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1049139180.831.11.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.3 
Date: 31 Mar 2003 22:33:00 +0300
X-archive-position: 491
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 491                                                  
Status: O

On Mon, 2003-03-31 at 22:11, Sebastian Pachuta wrote:
> I have some odd problem with running dovecot.
> Program dies with message in maillog:
> 
> Mar 31 21:04:04 test-box dovecot: execv(imap-login) failed: Resource temporarily unavailable

> System is redhat6.2 (with all updates), kernel is 2.2.25 (with openwall
> patch). Under rh7.3 dovecot launches fine.

It's probably because of the openwall patch. Would this patch help?

diff -u -r1.38 login-process.c
--- src/master/login-process.c  4 Mar 2003 22:38:08 -0000       1.38
+++ src/master/login-process.c  31 Mar 2003 19:31:50 -0000
@@ -474,7 +474,7 @@
                        i_fatal("chdir(%s) failed: %m", set->login_dir);
        }
 
-       restrict_process_size(group->set->process_size, 0);
+       restrict_process_size(group->set->process_size, 1);
 
        /* make sure we don't leak syslog fd, but do it last so that
           any errors above will be logged */


From seba@iq.pl  Mon Mar 31 22:42:46 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 31 Mar 2003 22:42:46 +0300 (EEST)
Return-Path: <seba@iq.pl>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from serv.iq.pl (serv.iq.pl [213.76.165.9])
	by danu.procontrol.fi (Postfix) with ESMTP id E73872385F
	for <dovecot@procontrol.fi>; Mon, 31 Mar 2003 22:42:45 +0300 (EEST)
Received: by serv.iq.pl (Postfix, from userid 1390)
	id 0E2606BE30; Mon, 31 Mar 2003 21:43:13 +0200 (CEST)
Date: Mon, 31 Mar 2003 21:43:13 +0200
From: Sebastian Pachuta <seba@iq.pl>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: dovecot-0.99.8.1 @ old redhat6.2 box
Message-ID: <20030331194312.GA6677@iq.pl>
References: <20030331191120.GB32315@iq.pl> <1049139180.831.11.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1049139180.831.11.camel@hurina>
X-archive-position: 492
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: seba@iq.pl
Precedence: bulk
X-list: dovecot
X-UID: 492                                                  
Status: O
Content-Length: 1152

On Mon, Mar 31, 2003 at 22:33:00 +0300, Timo Sirainen wrote:
> On Mon, 2003-03-31 at 22:11, Sebastian Pachuta wrote:
> > I have some odd problem with running dovecot.
> > Program dies with message in maillog:
> > 
> > Mar 31 21:04:04 test-box dovecot: execv(imap-login) failed: Resource temporarily unavailable
> 
> > System is redhat6.2 (with all updates), kernel is 2.2.25 (with openwall
> > patch). Under rh7.3 dovecot launches fine.
> 
> It's probably because of the openwall patch. Would this patch help?
> 
> diff -u -r1.38 login-process.c
> --- src/master/login-process.c  4 Mar 2003 22:38:08 -0000       1.38
> +++ src/master/login-process.c  31 Mar 2003 19:31:50 -0000
> @@ -474,7 +474,7 @@
>                         i_fatal("chdir(%s) failed: %m", set->login_dir);
>         }
>  
> -       restrict_process_size(group->set->process_size, 0);
> +       restrict_process_size(group->set->process_size, 1);
>  
>         /* make sure we don't leak syslog fd, but do it last so that
>            any errors above will be logged */
> 

Nope :(

With and without this patch there is no abuse info generated by openwall in
dmesg or /var/log/alert.

From tss@iki.fi  Tue Apr  1 00:43:28 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 01 Apr 2003 00:43:28 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 0523F2385F
	for <dovecot@procontrol.fi>; Tue,  1 Apr 2003 00:43:28 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id D17075E0EC7E; Tue,  1 Apr 2003 00:43:27 +0300 (EEST)
Subject: [dovecot] Re: dovecot-0.99.8.1 @ old redhat6.2 box
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030331194312.GA6677@iq.pl>
References: <20030331191120.GB32315@iq.pl> <1049139180.831.11.camel@hurina>
	 <20030331194312.GA6677@iq.pl>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1049147007.6193.16.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.3 
Date: 01 Apr 2003 00:43:27 +0300
X-archive-position: 493
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 493                                                  
Status: O

On Mon, 2003-03-31 at 22:43, Sebastian Pachuta wrote:
> > -       restrict_process_size(group->set->process_size, 0);
> > +       restrict_process_size(group->set->process_size, 1);
> >  
> With and without this patch there is no abuse info generated by openwall in
> dmesg or /var/log/alert.

Well, changing 0 to (unsigned int)-1 at least should help?


From seba@iq.pl  Tue Apr  1 00:55:46 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 01 Apr 2003 00:55:46 +0300 (EEST)
Return-Path: <seba@iq.pl>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from serv.iq.pl (serv.iq.pl [213.76.165.9])
	by danu.procontrol.fi (Postfix) with ESMTP id A6A4B2385F
	for <dovecot@procontrol.fi>; Tue,  1 Apr 2003 00:55:46 +0300 (EEST)
Received: by serv.iq.pl (Postfix, from userid 1390)
	id 8D3006BCC7; Mon, 31 Mar 2003 23:56:13 +0200 (CEST)
Date: Mon, 31 Mar 2003 23:56:13 +0200
From: Sebastian Pachuta <seba@iq.pl>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: dovecot-0.99.8.1 @ old redhat6.2 box
Message-ID: <20030331215613.GA23630@iq.pl>
References: <20030331191120.GB32315@iq.pl> <1049139180.831.11.camel@hurina> <20030331194312.GA6677@iq.pl> <1049147007.6193.16.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1049147007.6193.16.camel@hurina>
X-archive-position: 494
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: seba@iq.pl
Precedence: bulk
X-list: dovecot
X-UID: 494                                                  
Status: O

On Tue, Apr 01, 2003 at 00:43:27 +0300, Timo Sirainen wrote:
> On Mon, 2003-03-31 at 22:43, Sebastian Pachuta wrote:
> > > -       restrict_process_size(group->set->process_size, 0);
> > > +       restrict_process_size(group->set->process_size, 1);
> > >  
> > With and without this patch there is no abuse info generated by openwall in
> > dmesg or /var/log/alert.
> 
> Well, changing 0 to (unsigned int)-1 at least should help?

Yes, tx

From charlieb-dovecot@e-smith.com  Tue Apr  1 06:09:11 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 01 Apr 2003 06:09:11 +0300 (EEST)
Return-Path: <charlieb-dovecot@e-smith.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from nssg.mitel.com (mail.e-smith.com [216.191.234.126])
	by danu.procontrol.fi (Postfix) with SMTP id F0ECC238B6
	for <dovecot@procontrol.fi>; Tue,  1 Apr 2003 06:09:10 +0300 (EEST)
Received: (qmail 7080 invoked by uid 404); 1 Apr 2003 03:09:08 -0000
Received: from charlieb-dovecot@e-smith.com by tripe.nssg.mitel.com with qmail-scanner; 31 Mar 2003 22:09:08 -0000
Received: from allspice-core.nssg.mitel.com (HELO e-smith.com) (10.33.16.12)
  by tripe.nssg.mitel.com (10.33.17.11) with SMTP; 01 Apr 2003 03:09:07 -0000
Received: (qmail 13379 invoked by uid 5008); 1 Apr 2003 03:09:07 -0000
Received: from localhost (sendmail-bs@127.0.0.1)
  by localhost with SMTP; 1 Apr 2003 03:09:07 -0000
Date: Mon, 31 Mar 2003 22:09:07 -0500 (EST)
From: Charlie Brady <charlieb-dovecot@e-smith.com>
X-X-Sender: charlieb@allspice.nssg.mitel.com
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Failure in the presence of too many connections
In-Reply-To: <1049139025.959.7.camel@hurina>
Message-ID: <Pine.LNX.4.44.0303312159470.22471-100000@allspice.nssg.mitel.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 495
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: charlieb-dovecot@e-smith.com
Precedence: bulk
X-list: dovecot
X-UID: 495                                                  
Status: O


On 31 Mar 2003, Timo Sirainen wrote:

> On Mon, 2003-03-31 at 22:19, Charlie Brady wrote:
> > Or you can run things my way (under tcpserver/stunnel/imapfront-auth) and 
> > there's one dovecot process for each connection, each unrelated. This 
> > illustrates my point about re-using already well trusted simple programs
> > to do as much of the task as possible. 
> 
> Didn't you just say imapfront connected to separate auth process via
> unix socket?

That's one of the options, but you can also run a standalone command. See 
http://untroubled.org/cvm/cvm.html.

In any case, these are still well trusted simple programs :-)

--
Charlie



From tss@iki.fi  Wed Apr  2 03:34:02 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 02 Apr 2003 03:34:03 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 9AD672385F
	for <dovecot@procontrol.fi>; Wed,  2 Apr 2003 03:34:02 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 3F35F5E0EC7E; Wed,  2 Apr 2003 03:34:02 +0300 (EEST)
Subject: [dovecot] Re: Failure in the presence of too many connections
From: Timo Sirainen <tss@iki.fi>
To: "Mark E. Mallett" <mem@mv.mv.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030331115059.C11524@iridium.mv.net>
References: <20030326132801.B26665@iridium.mv.net>
	 <1048704303.31565.214.camel@hurina> <20030326141709.A2687@iridium.mv.net>
	 <1048928723.6856.21.camel@hurina> <20030329093949.B18450@iridium.mv.net>
	 <1049101161.884.126.camel@hurina>  <20030331115059.C11524@iridium.mv.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1049243642.11879.25.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.3 
Date: 02 Apr 2003 03:34:02 +0300
X-archive-position: 496
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 496                                                  
Status: O

On Mon, 2003-03-31 at 19:51, Mark E. Mallett wrote:
> The point was not so much that this happens-- but that it doesn't
> recover when it does happen (thus the subject line).  The only way to
> make the services start responding again is to stop and restart the
> dovecot suite of control processes. 

I don't really see anything in code that would prevent dovecot-auth from
working again after some of the connections to login processes die and
free file descriptors. I guess I'll have to try myself.

>  Raising the openfiles limit
> certainly pushes off the problem, and maybe that's a good enough
> workaround (as long as there's always a higher limit availble...)

How much was it before? Dovecot limits the number of login processes to
384 by default (max_logging_users 256 + login_max_processes_count 128).


From mem@mv.mv.com  Wed Apr  2 03:37:37 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 02 Apr 2003 03:37:37 +0300 (EEST)
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id E56E82385F
	for <dovecot@procontrol.fi>; Wed,  2 Apr 2003 03:37:36 +0300 (EEST)
Received: (qmail 23777 invoked by uid 101); 1 Apr 2003 19:37:34 -0500
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Tue, 1 Apr 2003 19:37:34 -0500
To: Timo Sirainen <tss@iki.fi>
Cc: "Mark E. Mallett" <mem@mv.mv.com>, dovecot@procontrol.fi
Subject: [dovecot] Re: Failure in the presence of too many connections
Message-ID: <20030401193734.P8442@iridium.mv.net>
References: <20030326132801.B26665@iridium.mv.net> <1048704303.31565.214.camel@hurina> <20030326141709.A2687@iridium.mv.net> <1048928723.6856.21.camel@hurina> <20030329093949.B18450@iridium.mv.net> <1049101161.884.126.camel@hurina> <20030331115059.C11524@iridium.mv.net> <1049243642.11879.25.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.2.5i
In-Reply-To: <1049243642.11879.25.camel@hurina>; from tss@iki.fi on Wed, Apr 02, 2003 at 03:34:02AM +0300
X-archive-position: 497
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mem@mv.mv.com
Precedence: bulk
X-list: dovecot
X-UID: 497                                                  
Status: O


> >  Raising the openfiles limit
> > certainly pushes off the problem, and maybe that's a good enough
> > workaround (as long as there's always a higher limit availble...)
> 
> How much was it before? Dovecot limits the number of login processes to
> 384 by default (max_logging_users 256 + login_max_processes_count 128).

openfiles limit was 64 when the issue occured.  I then raised it to
some much larger value.


From maikel@ladot.com  Wed Apr  2 18:43:44 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 02 Apr 2003 18:43:44 +0300 (EEST)
Return-Path: <maikel@ladot.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from zeus.ladot.com (office.ladot.com [217.22.64.134])
	by danu.procontrol.fi (Postfix) with ESMTP id D82332385F
	for <dovecot@procontrol.fi>; Wed,  2 Apr 2003 18:43:43 +0300 (EEST)
Received: from nlladot05.freehosting (nlladot05.intern.ladot.com [172.31.2.13])
	by zeus.ladot.com (8.12.8/8.12.6) with ESMTP id h32FsSmB089567
	for <dovecot@procontrol.fi>; Wed, 2 Apr 2003 17:54:28 +0200 (CEST)
	(envelope-from maikel@ladot.com)
Received: by nlladot05.intern.ladot.com with Internet Mail Service (5.5.2653.19)
	id <1VFZ8BNB>; Wed, 2 Apr 2003 17:29:23 +0200
Message-ID: <410777FC7A66D511911500B0D0783455024C4FA0@nlladot05.intern.ladot.com>
From: Maikel Verheijen <maikel@ladot.com>
To: "Dovecot (E-mail)" <dovecot@procontrol.fi>
Subject: [dovecot] Question about the password field in a postgresql database
Date: Wed, 2 Apr 2003 17:29:17 +0200 
MIME-Version: 1.0
X-Mailer: Internet Mail Service (5.5.2653.19)
Content-Type: multipart/alternative;
	boundary="----_=_NextPart_001_01C2F92C.9FD1CFC0"
X-Spam-Status: No, hits=1.4 required=5.0
	tests=EXCHANGE_SERVER,MIME_NULL_BLOCK,SPAM_PHRASE_05_08
	version=2.44
X-Spam-Level: *
X-archive-position: 498
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: maikel@ladot.com
Precedence: bulk
X-list: dovecot
X-UID: 498                                                  
Status: O
Content-Length: 1571

This message is in MIME format. Since your mail reader does not understand
this format, some or all of this message may not be legible.

------_=_NextPart_001_01C2F92C.9FD1CFC0
Content-Type: text/plain

Hi List,


When I try to set the default_pass_scheme in dovecot-pgsql.conf to CRYPT,
the dovecot does not recognize my crypted passwords. If I prepend my
encrypted passwords with {CRYPT}, dovecot DOES recognize it. (even when I
set default_pass_scheme to PLAIN).

Is this supposed to work, or am I misinterpreting things here?


Thank you!

Maikel Verheijen.

------_=_NextPart_001_01C2F92C.9FD1CFC0
Content-Type: text/html
Content-Transfer-Encoding: quoted-printable

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV=3D"Content-Type" CONTENT=3D"text/html; =
charset=3Dus-ascii">
<META NAME=3D"Generator" CONTENT=3D"MS Exchange Server version =
5.5.2653.12">
<TITLE>Question about the password field in a postgresql =
database</TITLE>
</HEAD>
<BODY>

<P><FONT SIZE=3D2>Hi List,</FONT>
</P>
<BR>

<P><FONT SIZE=3D2>When I try to set the default_pass_scheme in =
dovecot-pgsql.conf to CRYPT, the dovecot does not recognize my crypted =
passwords. If I prepend my encrypted passwords with {CRYPT}, dovecot =
DOES recognize it. (even when I set default_pass_scheme to =
PLAIN).</FONT></P>

<P><FONT SIZE=3D2>Is this supposed to work, or am I misinterpreting =
things here?</FONT>
</P>
<BR>

<P><FONT SIZE=3D2>Thank you!</FONT>
</P>

<P><FONT SIZE=3D2>Maikel Verheijen.</FONT>
</P>

</BODY>
</HTML>
------_=_NextPart_001_01C2F92C.9FD1CFC0--

From seba@iq.pl  Thu Apr  3 13:10:08 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 03 Apr 2003 13:10:09 +0300 (EEST)
Return-Path: <seba@iq.pl>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from serv.iq.pl (serv.iq.pl [213.76.165.9])
	by danu.procontrol.fi (Postfix) with ESMTP id DA3002385F
	for <dovecot@procontrol.fi>; Thu,  3 Apr 2003 13:10:08 +0300 (EEST)
Received: by serv.iq.pl (Postfix, from userid 1390)
	id 3FE216BD08; Thu,  3 Apr 2003 12:10:27 +0200 (CEST)
Date: Thu, 3 Apr 2003 12:10:27 +0200
From: Sebastian Pachuta <seba@iq.pl>
To: dovecot@procontrol.fi
Subject: [dovecot] INBOX at /var in maildir storage format
Message-ID: <20030403101027.GF20161@iq.pl>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
X-archive-position: 499
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: seba@iq.pl
Precedence: bulk
X-list: dovecot
X-UID: 499                                                  
Status: O


Hi

I'm trying to figure out how to set default_mail_env to support such config:

INBOX is in '/var/mail/%u/' (note last slash at the end, %u is an folder with
new/tmp/cur subdirs - standard maildir structure).

Other imap folders are stored as files (in mbox format) in direcotry '%h/Mail/'.

Please advise.

From eskimoe@ananzi.co.za  Thu Apr  3 16:10:00 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 03 Apr 2003 16:10:00 +0300 (EEST)
Return-Path: <eskimoe@ananzi.co.za>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from sun.com (port-212-202-174-148.reverse.qdsl-home.de [212.202.174.148])
	by danu.procontrol.fi (Postfix) with SMTP id 11712238B6
	for <dovecot@procontrol.fi>; Thu,  3 Apr 2003 16:10:00 +0300 (EEST)
Received: (qmail 20640 invoked by uid 1000); 3 Apr 2003 13:11:09 -0000
Date: Thu, 3 Apr 2003 15:11:09 +0200
From: Moe Wibble <eskimoe@ananzi.co.za>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: INBOX at /var in maildir storage format
Message-ID: <20030403131108.GA31390@woom.net>
Mail-Followup-To: Moe Wibble <eskimoe@ananzi.co.za>,
	dovecot@procontrol.fi
References: <20030403101027.GF20161@iq.pl>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20030403101027.GF20161@iq.pl>
X-archive-position: 500
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: eskimoe@ananzi.co.za
Precedence: bulk
X-list: dovecot
X-UID: 500                                                  
Status: O

Hi,

I'm using:

default_mail_env = maildir:/var/imap/%n/Maildir:INDEX=/var/imap/%n/index

I like the extra Maildir-subdir to have the dovecot-index outside of it
but that's just my personal taste. :)

Why do you want to have your mails split over two locations and two
different formats (Maildir/mbox)?

On Thu, Apr 03, 2003 at 12:10:27PM +0200, Sebastian Pachuta wrote:
> Hi
> 
> I'm trying to figure out how to set default_mail_env to support such config:
> 
> INBOX is in '/var/mail/%u/' (note last slash at the end, %u is an folder with
> new/tmp/cur subdirs - standard maildir structure).
> 
> Other imap folders are stored as files (in mbox format) in direcotry '%h/Mail/'.
> 
> Please advise.

regards
-- 
MW


From seba@iq.pl  Thu Apr  3 22:22:03 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 03 Apr 2003 22:22:03 +0300 (EEST)
Return-Path: <seba@iq.pl>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from serv.iq.pl (serv.iq.pl [213.76.165.9])
	by danu.procontrol.fi (Postfix) with ESMTP id 24903238B6
	for <dovecot@procontrol.fi>; Thu,  3 Apr 2003 22:22:03 +0300 (EEST)
Received: by serv.iq.pl (Postfix, from userid 1390)
	id 1ACB06BD8D; Thu,  3 Apr 2003 21:22:23 +0200 (CEST)
Date: Thu, 3 Apr 2003 21:22:23 +0200
From: Sebastian Pachuta <seba@iq.pl>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: INBOX at /var in maildir storage format
Message-ID: <20030403192223.GA30832@iq.pl>
References: <20030403101027.GF20161@iq.pl> <20030403131108.GA31390@woom.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20030403131108.GA31390@woom.net>
X-archive-position: 501
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: seba@iq.pl
Precedence: bulk
X-list: dovecot
X-UID: 501                                                  
Status: O

On Thu, Apr 03, 2003 at 15:11:09 +0200, Moe Wibble wrote:
> Hi,
> 
> I'm using:
> 
> default_mail_env = maildir:/var/imap/%n/Maildir:INDEX=/var/imap/%n/index
> 
> I like the extra Maildir-subdir to have the dovecot-index outside of it
> but that's just my personal taste. :)
> 
> Why do you want to have your mails split over two locations and two
> different formats (Maildir/mbox)?

Because in config, who looks very familiar to Yours:
default_mail_env = maildir:/var/mail/%u
I cannot create imap folders (in maildir format).

I've tried patches from project homepage with no luck :(

Cvs version is unusable for me because I cannot generate configure file.

From tss@iki.fi  Thu Apr  3 22:34:47 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 03 Apr 2003 22:34:47 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 1861C238B6
	for <dovecot@procontrol.fi>; Thu,  3 Apr 2003 22:34:47 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id D98E95E01F95; Thu,  3 Apr 2003 22:34:46 +0300 (EEST)
Subject: [dovecot] Re: INBOX at /var in maildir storage format
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030403192223.GA30832@iq.pl>
References: <20030403101027.GF20161@iq.pl> <20030403131108.GA31390@woom.net>
	 <20030403192223.GA30832@iq.pl>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1049398486.22903.64.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.3 
Date: 03 Apr 2003 22:34:46 +0300
X-archive-position: 502
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 502                                                  
Status: O

On Thu, 2003-04-03 at 22:22, Sebastian Pachuta wrote:
> > Why do you want to have your mails split over two locations and two
> > different formats (Maildir/mbox)?

Currently this is not possible.

> Because in config, who looks very familiar to Yours:
> default_mail_env = maildir:/var/mail/%u
> I cannot create imap folders (in maildir format).

What do you mean by "cannot create"? Does it write something to log? Can
you even read the existing mailboxes? /var/mail/username/ directory
anyway has to exist, Dovecot doesn't even try to create it.


From tss@iki.fi  Thu Apr  3 22:45:55 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 03 Apr 2003 22:45:55 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 7B4232385F
	for <dovecot@procontrol.fi>; Thu,  3 Apr 2003 22:45:55 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 49A5B5E01F95; Thu,  3 Apr 2003 22:45:55 +0300 (EEST)
Subject: [dovecot] Re: Question about the password field in a postgresql
	database
From: Timo Sirainen <tss@iki.fi>
To: "Dovecot (E-mail)" <dovecot@procontrol.fi>
In-Reply-To: <410777FC7A66D511911500B0D0783455024C4FA0@nlladot05.intern.ladot.com>
References:
	 <410777FC7A66D511911500B0D0783455024C4FA0@nlladot05.intern.ladot.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1049399155.22896.72.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.3 
Date: 03 Apr 2003 22:45:55 +0300
X-archive-position: 503
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 503                                                  
Status: O

On Wed, 2003-04-02 at 18:29, Maikel Verheijen wrote:
> When I try to set the default_pass_scheme in dovecot-pgsql.conf to
> CRYPT, the dovecot does not recognize my crypted passwords. If I
> prepend my encrypted passwords with {CRYPT}, dovecot DOES recognize
> it. (even when I set default_pass_scheme to PLAIN).
> 
> Is this supposed to work, or am I misinterpreting things here?

Works fine with me.. Only thing I can think of is that it's some stupid
configuration mistake, like not uncommenting the line :)


From tss@iki.fi  Thu Apr  3 22:50:30 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 03 Apr 2003 22:50:30 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 9E7CF2385F
	for <dovecot@procontrol.fi>; Thu,  3 Apr 2003 22:50:30 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 69CC35E01F95; Thu,  3 Apr 2003 22:50:30 +0300 (EEST)
Subject: [dovecot] Re: NFS mounted IMAP dirs
From: Timo Sirainen <tss@iki.fi>
To: "Dovecot (E-mail)" <dovecot@procontrol.fi>
In-Reply-To: <410777FC7A66D511911500B0D0783455024C4F94@nlladot05.intern.ladot.com>
References:
	 <410777FC7A66D511911500B0D0783455024C4F94@nlladot05.intern.ladot.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1049399430.22898.78.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.3 
Date: 03 Apr 2003 22:50:30 +0300
X-archive-position: 504
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 504                                                  
Status: O

On Mon, 2003-03-31 at 11:52, Maikel Verheijen wrote:
> Well: I am working with Maildir mailstores, so I guess I need to
> have a uidlist kinda file then? Sorry it wasn't clear in my post 
> that I am using Maildir style mailboxes... But I figured maildir was
> better than Mbox over nfs... 

Maildir is much better over NFS and you would need the uidlist file
since you can't use indexes.

> My current setup is with postgresql and Maildir. So in a way, a lot of
> info COULD come from my database, if it isn't safe enough via nfs.

Well, I was thinking of supporting PostgreSQL/Oracle mailstores too.
Mail bodies could optionally be stored outside the database as files.

> Can you make all file locking configurable? Or will you do it on a 
> "per-type" basis? (eg: mailbox locking, index locking, flag-file
> locking, etc).

I'll add option to specify if we want NFS-safe locking for
.subscriptions and .customflags files. But it isn't really high priority
now.


From seba@iq.pl  Thu Apr  3 22:56:47 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 03 Apr 2003 22:56:47 +0300 (EEST)
Return-Path: <seba@iq.pl>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from serv.iq.pl (serv.iq.pl [213.76.165.9])
	by danu.procontrol.fi (Postfix) with ESMTP id 01AEA2385F
	for <dovecot@procontrol.fi>; Thu,  3 Apr 2003 22:56:46 +0300 (EEST)
Received: by serv.iq.pl (Postfix, from userid 1390)
	id 159AD6BCDF; Thu,  3 Apr 2003 21:57:07 +0200 (CEST)
Date: Thu, 3 Apr 2003 21:57:07 +0200
From: Sebastian Pachuta <seba@iq.pl>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: INBOX at /var in maildir storage format
Message-ID: <20030403195707.GB30832@iq.pl>
References: <20030403101027.GF20161@iq.pl> <20030403131108.GA31390@woom.net> <20030403192223.GA30832@iq.pl> <1049398486.22903.64.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1049398486.22903.64.camel@hurina>
X-archive-position: 505
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: seba@iq.pl
Precedence: bulk
X-list: dovecot
X-UID: 505                                                  
Status: O

> What do you mean by "cannot create"? Does it write something to log? Can
> you even read the existing mailboxes? /var/mail/username/ directory
> anyway has to exist, Dovecot doesn't even try to create it.

Empty directory /var/mail/username/ owned by username with perm 700 exist.
When I connect via imap dovecot automagical creates subfolders .INBOX
new tmp cur and .customflags file.
Next I'm trying to create folder via webmail software but nothing happens.
No info in log.

But now I've checked it by telnet to imap and issue rfc3501 'create' and
'list' commands. Works great.

Lame on me, but it looks like old webmail software make this mess.

From maikel@ladot.com  Fri Apr  4 01:09:04 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 04 Apr 2003 01:09:04 +0300 (EEST)
Return-Path: <maikel@ladot.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from zeus.ladot.com (office.ladot.com [217.22.64.134])
	by danu.procontrol.fi (Postfix) with ESMTP id 475D92385F
	for <dovecot@procontrol.fi>; Fri,  4 Apr 2003 01:09:04 +0300 (EEST)
Received: from nlladot05.freehosting (nlladot05.intern.ladot.com [172.31.2.13])
	by zeus.ladot.com (8.12.8/8.12.6) with ESMTP id h33MJomB044887
	for <dovecot@procontrol.fi>; Fri, 4 Apr 2003 00:19:50 +0200 (CEST)
	(envelope-from maikel@ladot.com)
Received: by nlladot05.intern.ladot.com with Internet Mail Service (5.5.2653.19)
	id <1VFZ8L5B>; Thu, 3 Apr 2003 23:54:40 +0200
Message-ID: <410777FC7A66D511911500B0D0783455024C4FA6@nlladot05.intern.ladot.com>
From: Maikel Verheijen <maikel@ladot.com>
To: "Dovecot (E-mail)" <dovecot@procontrol.fi>
Subject: [dovecot] Re: Question about the password field in a postgres
	ql database
Date: Thu, 3 Apr 2003 23:54:39 +0200 
MIME-Version: 1.0
X-Mailer: Internet Mail Service (5.5.2653.19)
Content-Type: multipart/alternative;
	boundary="----_=_NextPart_001_01C2FA2B.A00253C0"
X-Spam-Status: No, hits=-0.2 required=5.0
	tests=EXCHANGE_SERVER,MIME_NULL_BLOCK,QUOTED_EMAIL_TEXT,
	      SPAM_PHRASE_02_03
	version=2.44
X-archive-position: 506
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: maikel@ladot.com
Precedence: bulk
X-list: dovecot
X-UID: 506                                                  
Status: O
Content-Length: 6028

This message is in MIME format. Since your mail reader does not understand
this format, some or all of this message may not be legible.

------_=_NextPart_001_01C2FA2B.A00253C0
Content-Type: text/plain;
	charset="iso-8859-1"

> Works fine with me.. Only thing I can think of is that it's 
> some stupid
> configuration mistake, like not uncommenting the line :)

Hi Timo,

I just (double) checked my config files, and it LOOKS ok.

My dovecot is from cvs, updated yesterday, and running on Redhat 7.3 (if
that matters).

Here is my dovecot-pgsql.conf:

--8<--
#
# Postgress connect string. Similar to PHP
connect = host=A.B.C.D dbname=maildb user=mailuser password=******

password_query = SELECT password FROM aliases WHERE alias = '%u' AND
password != '' AND locked='f';
user_query = SELECT maildir as home, 100 as uid,498 as gid FROM aliases
where alias = '%u';

#default_pass_scheme = PLAIN
#default_pass_scheme = PLAIN-MD5
default_pass_scheme = CRYPT
--8<--


My NON-working DB entry is:
--8<--
maildb-> default_pass_scheme = CRYPT
maildb-> select * from aliases where alias = 'marc@test.com';
ERROR:  parser: parse error at or near "#"
maildb=> ;
maildb=> select * from aliases where alias = 'marc@test.com';
     alias     |        maildir         |              password
| locked 
---------------+------------------------+-----------------------------------
-+--------
 marc@test.com | test.com/marc/Maildir/ | $1$JJN5H82p$yKs5jnb/csQVYsZZ/4WFS0
| f
(1 row)
--8<--

and the one that IS working:
--8<--
maildb=> select * from aliases where alias = 'maikel@test.com';
      alias      |         maildir          |                 password
| locked 
-----------------+--------------------------+-------------------------------
------------+--------
 maikel@test.com | test.com/maikel/Maildir/ |
{CRYPT}$1$JJN5H82p$yKs5jnb/csQVYsZZ/4WFS0 | f
(1 row)
--8<--

Both strings are crypted versions of 'qwerty'


Thank you,


Maikel Verheijen

------_=_NextPart_001_01C2FA2B.A00253C0
Content-Type: text/html;
	charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV=3D"Content-Type" CONTENT=3D"text/html; =
charset=3Diso-8859-1">
<META NAME=3D"Generator" CONTENT=3D"MS Exchange Server version =
5.5.2653.12">
<TITLE>RE: [dovecot] Re: Question about the password field in a =
postgresql database</TITLE>
</HEAD>
<BODY>

<P><FONT SIZE=3D2>&gt; Works fine with me.. Only thing I can think of =
is that it's </FONT>
<BR><FONT SIZE=3D2>&gt; some stupid</FONT>
<BR><FONT SIZE=3D2>&gt; configuration mistake, like not uncommenting =
the line :)</FONT>
</P>

<P><FONT SIZE=3D2>Hi Timo,</FONT>
</P>

<P><FONT SIZE=3D2>I just (double) checked my config files, and it LOOKS =
ok.</FONT>
</P>

<P><FONT SIZE=3D2>My dovecot is from cvs, updated yesterday, and =
running on Redhat 7.3 (if that matters).</FONT>
</P>

<P><FONT SIZE=3D2>Here is my dovecot-pgsql.conf:</FONT>
</P>

<P><FONT SIZE=3D2>--8&lt;--</FONT>
<BR><FONT SIZE=3D2>#</FONT>
<BR><FONT SIZE=3D2># Postgress connect string. Similar to PHP</FONT>
<BR><FONT SIZE=3D2>connect =3D host=3DA.B.C.D dbname=3Dmaildb =
user=3Dmailuser password=3D******</FONT>
</P>

<P><FONT SIZE=3D2>password_query =3D SELECT password FROM aliases WHERE =
alias =3D '%u' AND password !=3D '' AND locked=3D'f';</FONT>
<BR><FONT SIZE=3D2>user_query =3D SELECT maildir as home, 100 as =
uid,498 as gid FROM aliases where alias =3D '%u';</FONT>
</P>

<P><FONT SIZE=3D2>#default_pass_scheme =3D PLAIN</FONT>
<BR><FONT SIZE=3D2>#default_pass_scheme =3D PLAIN-MD5</FONT>
<BR><FONT SIZE=3D2>default_pass_scheme =3D CRYPT</FONT>
<BR><FONT SIZE=3D2>--8&lt;--</FONT>
</P>
<BR>

<P><FONT SIZE=3D2>My NON-working DB entry is:</FONT>
<BR><FONT SIZE=3D2>--8&lt;--</FONT>
<BR><FONT SIZE=3D2>maildb-&gt; default_pass_scheme =3D CRYPT</FONT>
<BR><FONT SIZE=3D2>maildb-&gt; select * from aliases where alias =3D =
'marc@test.com';</FONT>
<BR><FONT SIZE=3D2>ERROR:&nbsp; parser: parse error at or near =
&quot;#&quot;</FONT>
<BR><FONT SIZE=3D2>maildb=3D&gt; ;</FONT>
<BR><FONT SIZE=3D2>maildb=3D&gt; select * from aliases where alias =3D =
'marc@test.com';</FONT>
<BR><FONT SIZE=3D2>&nbsp;&nbsp;&nbsp;&nbsp; =
alias&nbsp;&nbsp;&nbsp;&nbsp; =
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =
maildir&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; =
password&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp; | locked </FONT>
<BR><FONT =
SIZE=3D2>---------------+------------------------+----------------------=
--------------+--------</FONT>
<BR><FONT SIZE=3D2>&nbsp;marc@test.com | test.com/marc/Maildir/ | =
$1$JJN5H82p$yKs5jnb/csQVYsZZ/4WFS0 | f</FONT>
<BR><FONT SIZE=3D2>(1 row)</FONT>
<BR><FONT SIZE=3D2>--8&lt;--</FONT>
</P>

<P><FONT SIZE=3D2>and the one that IS working:</FONT>
<BR><FONT SIZE=3D2>--8&lt;--</FONT>
<BR><FONT SIZE=3D2>maildb=3D&gt; select * from aliases where alias =3D =
'maikel@test.com';</FONT>
<BR><FONT SIZE=3D2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =
alias&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =
maildir&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp;&nbsp; =
password&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | locked </FONT>
<BR><FONT =
SIZE=3D2>-----------------+--------------------------+------------------=
-------------------------+--------</FONT>
<BR><FONT SIZE=3D2>&nbsp;maikel@test.com | test.com/maikel/Maildir/ | =
{CRYPT}$1$JJN5H82p$yKs5jnb/csQVYsZZ/4WFS0 | f</FONT>
<BR><FONT SIZE=3D2>(1 row)</FONT>
<BR><FONT SIZE=3D2>--8&lt;--</FONT>
</P>

<P><FONT SIZE=3D2>Both strings are crypted versions of 'qwerty'</FONT>
</P>
<BR>

<P><FONT SIZE=3D2>Thank you,</FONT>
</P>
<BR>

<P><FONT SIZE=3D2>Maikel Verheijen</FONT>
</P>

</BODY>
</HTML>
------_=_NextPart_001_01C2FA2B.A00253C0--

From tss@iki.fi  Fri Apr  4 02:43:42 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 04 Apr 2003 02:43:42 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 89F262399A
	for <dovecot@procontrol.fi>; Fri,  4 Apr 2003 02:43:42 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 663B15E01F95; Fri,  4 Apr 2003 02:43:42 +0300 (EEST)
Subject: [dovecot] Re: Question about the password field in a postgres
	ql database
From: Timo Sirainen <tss@iki.fi>
To: "Dovecot (E-mail)" <dovecot@procontrol.fi>
In-Reply-To: <410777FC7A66D511911500B0D0783455024C4FA6@nlladot05.intern.ladot.com>
References:
	 <410777FC7A66D511911500B0D0783455024C4FA6@nlladot05.intern.ladot.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1049413422.22898.116.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.3 
Date: 04 Apr 2003 02:43:42 +0300
X-archive-position: 507
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 507                                                  
Status: O

On Fri, 2003-04-04 at 00:54, Maikel Verheijen wrote:
> $1$JJN5H82p$yKs5jnb/csQVYsZZ/4WFS0 | f

Oh, you're using MD5 passwords. If password begins with "$1$", Dovecot
assumes it's MD5 and handles it internally instead of via crypt(). And
their internal handling was buggy, fixed in CVS now.


From dovecot@andreas.hanssen.name  Fri Apr  4 09:38:58 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 04 Apr 2003 09:38:58 +0300 (EEST)
Return-Path: <dovecot@andreas.hanssen.name>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from lexx.infeline.org (unknown [217.144.230.27])
	by danu.procontrol.fi (Postfix) with SMTP id 4ED2C238B6
	for <dovecot@procontrol.fi>; Fri,  4 Apr 2003 09:38:58 +0300 (EEST)
Received: (qmail 23217 invoked from network); 4 Apr 2003 06:38:56 -0000
Received: from localhost (HELO krs-dhcp266.studby.uio.no) (andreaha@127.0.0.1)
  by localhost with SMTP; 4 Apr 2003 06:38:56 -0000
Date: Fri, 4 Apr 2003 08:38:56 +0200 (CEST)
From: Andreas Aardal Hanssen <dovecot@andreas.hanssen.name>
To: "Dovecot (E-mail)" <dovecot@procontrol.fi>
Subject: [dovecot] Re: Question about the password field in a postgres
 ql database
In-Reply-To: <1049413422.22898.116.camel@hurina>
Message-ID: <Pine.LNX.4.44.0304040838200.1309-100000@krs-dhcp266.studby.uio.no>
X-Sent-From-Infeline: Yes
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 508
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: dovecot@andreas.hanssen.name
Precedence: bulk
X-list: dovecot
X-UID: 508                                                  
Status: O

On 4 Apr 2003, Timo Sirainen wrote:
>On Fri, 2003-04-04 at 00:54, Maikel Verheijen wrote:
>> $1$JJN5H82p$yKs5jnb/csQVYsZZ/4WFS0 | f
>Oh, you're using MD5 passwords. If password begins with "$1$", Dovecot
>assumes it's MD5 and handles it internally instead of via crypt(). And
>their internal handling was buggy, fixed in CVS now.

No stupid configuration mistake? ;-)

Andy

-- 
Andreas Aardal Hanssen
http://www.andreas.hanssen.name/gpg


From fuyuki@hadaly.org  Sat Apr  5 10:16:05 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 05 Apr 2003 10:16:05 +0300 (EEST)
Return-Path: <fuyuki@hadaly.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from t-mta4.odn.ne.jp (mfep4.odn.ne.jp [143.90.131.182])
	by danu.procontrol.fi (Postfix) with ESMTP id 24BC22385F
	for <dovecot@procontrol.fi>; Sat,  5 Apr 2003 10:16:03 +0300 (EEST)
Received: from hadaly.dyndns.org ([210.237.238.79]) by t-mta4.odn.ne.jp
          with ESMTP
          id <20030405071600083.QITS.11456.t-mta4.odn.ne.jp@mta4.odn.ne.jp>
          for <dovecot@procontrol.fi>; Sat, 5 Apr 2003 16:16:00 +0900
Received: from hadaly.dyndns.org (localhost [127.0.0.1])
	by hadaly.dyndns.org (Postfix) with ESMTP id A689420D6
	for <dovecot@procontrol.fi>; Sat,  5 Apr 2003 16:15:58 +0900 (JST)
Date: Sat, 05 Apr 2003 16:15:58 +0900
Message-ID: <86smsx5s9d.wl%fuyuki@hadaly.org>
From: Kimura Fuyuki <fuyuki@hadaly.org>
To: dovecot@procontrol.fi
Subject: [dovecot] message order reversed on copying
User-Agent: Wanderlust/2.10.0 (Venus) Emacs/21.2 Mule/5.0 (SAKAKI)
X-Public-Key: http://www.hadaly.org/fuyuki/public.key
X-Fingerprint: 8D68 1138 1A85 8556 C6A9  274B 2C72 2E56 3AF7 3D89
MIME-Version: 1.0 (generated by SEMI 1.14.5 - "Awara-Onsen")
Content-Type: text/plain; charset=US-ASCII
X-archive-position: 509
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: fuyuki@hadaly.org
Precedence: bulk
X-list: dovecot
X-UID: 509                                                  
Status: O

Hi,

I noticed an annoying behavior of dovecot: the message order (sequence
numbering) is reversed on COPYing in the maildir.

I suspect that the following code in maildir-save.c is working like
"pushing".

		mf->next = ctx->files;
		...
		ctx->files = mf;

Later ctx->files is used like this.

		for (mf = ctx->files; mf != NULL; mf = mf->next) {

-- fuyuki

From fuyuki@hadaly.org  Sat Apr  5 12:31:02 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 05 Apr 2003 12:31:02 +0300 (EEST)
Return-Path: <fuyuki@hadaly.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from t-mta4.odn.ne.jp (mfep4.odn.ne.jp [143.90.131.182])
	by danu.procontrol.fi (Postfix) with ESMTP id AFA672385F
	for <dovecot@procontrol.fi>; Sat,  5 Apr 2003 12:31:01 +0300 (EEST)
Received: from hadaly.dyndns.org ([210.237.238.79]) by t-mta4.odn.ne.jp
          with ESMTP
          id <20030405093100562.RAKN.11456.t-mta4.odn.ne.jp@mta4.odn.ne.jp>
          for <dovecot@procontrol.fi>; Sat, 5 Apr 2003 18:31:00 +0900
Received: from hadaly.dyndns.org (localhost [127.0.0.1])
	by hadaly.dyndns.org (Postfix) with ESMTP id 83A5F2148
	for <dovecot@procontrol.fi>; Sat,  5 Apr 2003 18:30:59 +0900 (JST)
Date: Sat, 05 Apr 2003 18:30:59 +0900
Message-ID: <86r88h5m0c.wl%fuyuki@hadaly.org>
From: Kimura Fuyuki <fuyuki@hadaly.org>
To: dovecot@procontrol.fi
Subject: [dovecot] maildir_copy_with_hardlinks doesn't work
User-Agent: Wanderlust/2.10.0 (Venus) Emacs/21.2 Mule/5.0 (SAKAKI)
X-Public-Key: http://www.hadaly.org/fuyuki/public.key
X-Fingerprint: 8D68 1138 1A85 8556 C6A9  274B 2C72 2E56 3AF7 3D89
MIME-Version: 1.0 (generated by SEMI 1.14.5 - "Awara-Onsen")
Content-Type: text/plain; charset=US-ASCII
X-archive-position: 510
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: fuyuki@hadaly.org
Precedence: bulk
X-list: dovecot
X-UID: 510                                                  
Status: O

On my box maildir_copy_with_hardlinks=yes causes the following IMAP
error:

	Some of the requested messages no longer exist.

A possible fix follows.

--- src/lib-storage/index/maildir/maildir-copy.c	19 Feb 2003 21:32:21 -0000	1.21
+++ src/lib-storage/index/maildir/maildir-copy.c	5 Apr 2003 09:23:34 -0000
@@ -113,7 +113,7 @@
 	ret2 = index_messageset_deinit(ctx);
 	if (ret2 < 0)
 		ret = -1;
-	else {
+	else if (ret2 == 0) {
 		mail_storage_set_error(src->box.storage,
 			"Some of the requested messages no longer exist.");
 		ret = -1;

-- fuyuki

From tss@iki.fi  Sun Apr  6 00:13:29 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 06 Apr 2003 00:13:29 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 1399B2385F
	for <dovecot@procontrol.fi>; Sun,  6 Apr 2003 00:13:29 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 4D7B75E01F95; Sun,  6 Apr 2003 00:13:27 +0300 (EEST)
Subject: [dovecot] Re: message order reversed on copying
From: Timo Sirainen <tss@iki.fi>
To: Kimura Fuyuki <fuyuki@hadaly.org>
Cc: dovecot@procontrol.fi
In-Reply-To: <86smsx5s9d.wl%fuyuki@hadaly.org>
References: <86smsx5s9d.wl%fuyuki@hadaly.org>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1049577206.22903.272.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.3 
Date: 06 Apr 2003 00:13:27 +0300
X-archive-position: 511
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 511                                                  
Status: O

On Sat, 2003-04-05 at 10:15, Kimura Fuyuki wrote:
> I noticed an annoying behavior of dovecot: the message order (sequence
> numbering) is reversed on COPYing in the maildir.
> 
> I suspect that the following code in maildir-save.c is working like
> "pushing".

Order for new mails is currently the same as the order in which
readdir() returns the mails. I guess some filesystems list the files in
the order they were written to the directory, but many don't. It anyway
can't be relied on, so I won't even try.

Better fix for this comes once I add support for UIDPLUS IMAP extension.
That requires knowing the new UID for mail in destination mailbox, so I
have to update the indexes immediately, which also saves the mail order
permanently.


From tss@iki.fi  Sun Apr  6 00:34:13 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 06 Apr 2003 00:34:13 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 584D02385F
	for <dovecot@procontrol.fi>; Sun,  6 Apr 2003 00:34:13 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 28ACB5E01F95; Sun,  6 Apr 2003 00:34:13 +0300 (EEST)
Subject: [dovecot] Re: NFS mounted IMAP dirs
From: Timo Sirainen <tss@iki.fi>
To: "Dovecot (E-mail)" <dovecot@procontrol.fi>
In-Reply-To: <1049399430.22898.78.camel@hurina>
References:
	 <410777FC7A66D511911500B0D0783455024C4F94@nlladot05.intern.ladot.com>
	 <1049399430.22898.78.camel@hurina>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1049578452.22903.279.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.3 
Date: 06 Apr 2003 00:34:13 +0300
X-archive-position: 512
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 512                                                  
Status: O

On Thu, 2003-04-03 at 22:50, Timo Sirainen wrote:
> I'll add option to specify if we want NFS-safe locking for
> .subscriptions and .customflags files. But it isn't really high priority
> now.

Actually, I think I'll make them NFS-safe by default. I'll first create
a file.lock file where I write the new data, then I rename() it over the
old file. This way there's no need to do any read-locking which should
speed up the common case to access these files.


From charlieb-dovecot@e-smith.com  Sun Apr  6 22:12:17 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 06 Apr 2003 22:12:17 +0300 (EEST)
Return-Path: <charlieb-dovecot@e-smith.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from nssg.mitel.com (mail.e-smith.com [216.191.234.126])
	by danu.procontrol.fi (Postfix) with SMTP id C9C232385F
	for <dovecot@procontrol.fi>; Sun,  6 Apr 2003 22:12:16 +0300 (EEST)
Received: (qmail 11162 invoked by uid 404); 6 Apr 2003 19:12:12 -0000
Received: from charlieb-dovecot@e-smith.com by tripe.nssg.mitel.com with qmail-scanner; 06 Apr 2003 15:12:11 -0000
Received: from allspice-core.nssg.mitel.com (HELO e-smith.com) (10.33.16.12)
  by tripe.nssg.mitel.com (10.33.17.11) with SMTP; 06 Apr 2003 19:12:11 -0000
Received: (qmail 19325 invoked by uid 5008); 6 Apr 2003 19:12:11 -0000
Received: from localhost (sendmail-bs@127.0.0.1)
  by localhost with SMTP; 6 Apr 2003 19:12:11 -0000
Date: Sun, 6 Apr 2003 15:12:11 -0400 (EDT)
From: Charlie Brady <charlieb-dovecot@e-smith.com>
X-X-Sender: charlieb@allspice.nssg.mitel.com
To: dovecot@procontrol.fi
Cc: Kimura Fuyuki <fuyuki@hadaly.org>
Subject: [dovecot] Re: message order reversed on copying
In-Reply-To: <1049577206.22903.272.camel@hurina>
Message-ID: <Pine.LNX.4.44.0304061505350.10634-100000@allspice.nssg.mitel.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 513
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: charlieb-dovecot@e-smith.com
Precedence: bulk
X-list: dovecot
X-UID: 513                                                  
Status: O
Content-Length: 1800


On 6 Apr 2003, Timo Sirainen wrote:

> On Sat, 2003-04-05 at 10:15, Kimura Fuyuki wrote:
> > I noticed an annoying behavior of dovecot: the message order (sequence
> > numbering) is reversed on COPYing in the maildir.
> > 
> > I suspect that the following code in maildir-save.c is working like
> > "pushing".
> 
> Order for new mails is currently the same as the order in which
> readdir() returns the mails. I guess some filesystems list the files in
> the order they were written to the directory, but many don't. It anyway
> can't be relied on, so I won't even try.
> 
> Better fix for this comes once I add support for UIDPLUS IMAP extension.
> That requires knowing the new UID for mail in destination mailbox, so I
> have to update the indexes immediately, which also saves the mail order
> permanently.

You shouldn't need to do that. All you need to do is to sort the new 
message files (by name or by mtime - by name will be faster), before 
processing them. I remember fixing this same problem in the maildir 
patches for UW-imap, and this is pretty much all it took:

-  if (!(dir = opendir (tmp)))
-    return;
 
-  while (d = readdir (dir)) {
-    if (d->d_name[0] == '.')
-      continue;                        /* skip .files */
+  nfiles = scandir (tmp, &names, NULL, maildir_namesort);
+  for (i = 0; i < nfiles; i++)
+  {
+    struct direct *d = names[i];
 
     sprintf (file,"%s/../new/%s",LOCAL->dir,d->d_name);
                                /* make sure this is a normal file */
-    if (stat (file,&sbuf) == 0 && S_ISREG (sbuf.st_mode)) {
+    if (d->d_name[0] != '.' && stat (file, &sbuf) == 0 && S_ISREG (sbuf.st_mode))
+    {

As a workaround, Kimura, you can delete dovecot's .imap.* index files, and 
the new UIDs will be sorted again - until next time.

--
Charlie



From tss@iki.fi  Sun Apr  6 22:55:29 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 06 Apr 2003 22:55:29 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 6F6A42387F
	for <dovecot@procontrol.fi>; Sun,  6 Apr 2003 22:55:29 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 367675E01F95; Sun,  6 Apr 2003 22:55:29 +0300 (EEST)
Subject: [dovecot] Re: message order reversed on copying
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.44.0304061505350.10634-100000@allspice.nssg.mitel.com>
References:
	 <Pine.LNX.4.44.0304061505350.10634-100000@allspice.nssg.mitel.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1049658928.22898.360.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.3 
Date: 06 Apr 2003 22:55:29 +0300
X-archive-position: 514
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 514                                                  
Status: O
Content-Length: 1063

On Sun, 2003-04-06 at 22:12, Charlie Brady wrote:
> > Better fix for this comes once I add support for UIDPLUS IMAP extension.
> > That requires knowing the new UID for mail in destination mailbox, so I
> > have to update the indexes immediately, which also saves the mail order
> > permanently.
> 
> You shouldn't need to do that. All you need to do is to sort the new 
> message files (by name or by mtime - by name will be faster), before 
> processing them.

Yes, well, that does it too :)

> +  nfiles = scandir (tmp, &names, NULL, maildir_namesort);

scandir() isn't portable though. I'll just read them into array and
qsort() them. I pretty much have to do that anyway with the new scanning
code which uses (NFS-safe) .uidlist file to find out if the message
already has UID.

> As a workaround, Kimura, you can delete dovecot's .imap.* index files, and 
> the new UIDs will be sorted again - until next time.

Which changes UIDVALIDITY and forces clients to discard their cache. Not
too good idea. Pretty much the same as just disabling the index files.


From charlieb-dovecot@e-smith.com  Mon Apr  7 01:15:48 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 07 Apr 2003 01:15:48 +0300 (EEST)
Return-Path: <charlieb-dovecot@e-smith.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from nssg.mitel.com (mail.e-smith.com [216.191.234.126])
	by danu.procontrol.fi (Postfix) with SMTP id AC0872387F
	for <dovecot@procontrol.fi>; Mon,  7 Apr 2003 01:15:47 +0300 (EEST)
Received: (qmail 27315 invoked by uid 404); 6 Apr 2003 22:15:46 -0000
Received: from charlieb-dovecot@e-smith.com by tripe.nssg.mitel.com with qmail-scanner; 06 Apr 2003 18:15:46 -0000
Received: from allspice-core.nssg.mitel.com (HELO e-smith.com) (10.33.16.12)
  by tripe.nssg.mitel.com (10.33.17.11) with SMTP; 06 Apr 2003 22:15:46 -0000
Received: (qmail 13358 invoked by uid 5008); 6 Apr 2003 22:15:45 -0000
Received: from localhost (sendmail-bs@127.0.0.1)
  by localhost with SMTP; 6 Apr 2003 22:15:45 -0000
Date: Sun, 6 Apr 2003 18:15:45 -0400 (EDT)
From: Charlie Brady <charlieb-dovecot@e-smith.com>
X-X-Sender: charlieb@allspice.nssg.mitel.com
To: Timo Sirainen <tss@iki.fi>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: message order reversed on copying
In-Reply-To: <1049658928.22898.360.camel@hurina>
Message-ID: <Pine.LNX.4.44.0304061811480.10634-100000@allspice.nssg.mitel.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 515
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: charlieb-dovecot@e-smith.com
Precedence: bulk
X-list: dovecot
X-UID: 515                                                  
Status: O


On 6 Apr 2003, Timo Sirainen wrote:

> On Sun, 2003-04-06 at 22:12, Charlie Brady wrote:
> > 
> > You shouldn't need to do that. All you need to do is to sort the new 
> > message files (by name or by mtime - by name will be faster), before 
> > processing them.
> 
> Yes, well, that does it too :)
> 
> > +  nfiles = scandir (tmp, &names, NULL, maildir_namesort);
> 
> scandir() isn't portable though.

No? Which OS doesn't have it?

> > As a workaround, Kimura, you can delete dovecot's .imap.* index files, and 
> > the new UIDs will be sorted again - until next time.
> 
> Which changes UIDVALIDITY and forces clients to discard their cache.

Yes, I could have mentioned that. Still, it's the only way I know to 
restore the sorting order once it's jumbled.

> Not too good idea. Pretty much the same as just disabling the index
> files.

No, because after you fix the problem the indexes will be usable again.
But until then, you are right :-)

--
Charlie


From tss@iki.fi  Mon Apr  7 01:27:38 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 07 Apr 2003 01:27:38 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 2A7282387F
	for <dovecot@procontrol.fi>; Mon,  7 Apr 2003 01:27:38 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 3D1565E01F95; Mon,  7 Apr 2003 01:27:36 +0300 (EEST)
Subject: [dovecot] Re: message order reversed on copying
From: Timo Sirainen <tss@iki.fi>
To: Charlie Brady <charlieb-dovecot@e-smith.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.44.0304061811480.10634-100000@allspice.nssg.mitel.com>
References:
	 <Pine.LNX.4.44.0304061811480.10634-100000@allspice.nssg.mitel.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1049668055.22903.405.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.3 
Date: 07 Apr 2003 01:27:36 +0300
X-archive-position: 516
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 516                                                  
Status: O

On Mon, 2003-04-07 at 01:15, Charlie Brady wrote:
> > > +  nfiles = scandir (tmp, &names, NULL, maildir_namesort);
> > scandir() isn't portable though.
> No? Which OS doesn't have it?

It's not in any standard -> it's not portable. Maybe it's portable
enough, but I try to avoid those whenever possible.

> > Which changes UIDVALIDITY and forces clients to discard their cache.
> 
> Yes, I could have mentioned that. Still, it's the only way I know to 
> restore the sorting order once it's jumbled.

How about making your client sort the messages by received-date? :)


From fuyuki@hadaly.org  Mon Apr  7 02:50:09 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 07 Apr 2003 02:50:09 +0300 (EEST)
Return-Path: <fuyuki@hadaly.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from t-mta4.odn.ne.jp (mfep4.odn.ne.jp [143.90.131.182])
	by danu.procontrol.fi (Postfix) with ESMTP id D410D2387F
	for <dovecot@procontrol.fi>; Mon,  7 Apr 2003 02:50:07 +0300 (EEST)
Received: from hadaly.dyndns.org ([210.237.238.79]) by t-mta4.odn.ne.jp
          with ESMTP
          id <20030406235002384.FXEL.13932.t-mta4.odn.ne.jp@mta4.odn.ne.jp>
          for <dovecot@procontrol.fi>; Mon, 7 Apr 2003 08:50:02 +0900
Received: from hadaly.dyndns.org (localhost [127.0.0.1])
	by hadaly.dyndns.org (Postfix) with ESMTP id 8444020A3
	for <dovecot@procontrol.fi>; Mon,  7 Apr 2003 08:50:00 +0900 (JST)
Date: Mon, 07 Apr 2003 08:50:00 +0900
Message-ID: <86brzjgp93.wl%fuyuki@hadaly.org>
From: Kimura Fuyuki <fuyuki@hadaly.org>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: message order reversed on copying
In-Reply-To: <Pine.LNX.4.44.0304061505350.10634-100000@allspice.nssg.mitel.com>
References: <1049577206.22903.272.camel@hurina>
	<Pine.LNX.4.44.0304061505350.10634-100000@allspice.nssg.mitel.com>
User-Agent: Wanderlust/2.10.0 (Venus) Emacs/21.2 Mule/5.0 (SAKAKI)
X-Public-Key: http://www.hadaly.org/fuyuki/public.key
X-Fingerprint: 8D68 1138 1A85 8556 C6A9  274B 2C72 2E56 3AF7 3D89
MIME-Version: 1.0 (generated by SEMI 1.14.5 - "Awara-Onsen")
Content-Type: text/plain; charset=US-ASCII
X-archive-position: 517
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: fuyuki@hadaly.org
Precedence: bulk
X-list: dovecot
X-UID: 517                                                  
Status: O

At Sun, 6 Apr 2003 15:12:11 -0400 (EDT),
Charlie Brady <charlieb-dovecot@e-smith.com> wrote:
> 
> As a workaround, Kimura, you can delete dovecot's .imap.* index files, and 
> the new UIDs will be sorted again - until next time.

I'm now running dovecot with maildir_copy_with_hardlinks and it works
well enough since it doesn't do the deliberate reversing, though I'll
be happier if the dovecot implements UIDPLUS or merges your fix. :)

-- fuyuki

From tss@iki.fi  Mon Apr  7 04:23:14 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 07 Apr 2003 04:23:14 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 923DA2385F
	for <dovecot@procontrol.fi>; Mon,  7 Apr 2003 04:23:14 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 4D5D75E01F95; Mon,  7 Apr 2003 04:23:14 +0300 (EEST)
Subject: [dovecot] Re: message order reversed on copying
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <86brzjgp93.wl%fuyuki@hadaly.org>
References: <1049577206.22903.272.camel@hurina>
	 <Pine.LNX.4.44.0304061505350.10634-100000@allspice.nssg.mitel.com>
	 <86brzjgp93.wl%fuyuki@hadaly.org>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1049678594.22898.416.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.3 
Date: 07 Apr 2003 04:23:14 +0300
X-archive-position: 518
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 518                                                  
Status: O

On Mon, 2003-04-07 at 02:50, Kimura Fuyuki wrote:
> > As a workaround, Kimura, you can delete dovecot's .imap.* index files, and 
> > the new UIDs will be sorted again - until next time.
> 
> I'm now running dovecot with maildir_copy_with_hardlinks and it works
> well enough since it doesn't do the deliberate reversing, though I'll
> be happier if the dovecot implements UIDPLUS or merges your fix. :)

My maildir syncing rewrite is almost finished now, just a few tweaks
left and I'll cvs commit that. It sorts the new files, supports
permanent UIDs in NFS-safe .uidlist file, takes less memory, checks that
maildir doesn't contain base filename duplicates, and behaves better
with other clients.

Finally. I started that code a month ago..


From lfarkas@bnap.hu  Mon Apr  7 12:46:00 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 07 Apr 2003 12:46:00 +0300 (EEST)
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 2F3F42387F
	for <dovecot@procontrol.fi>; Mon,  7 Apr 2003 12:46:00 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id AD6E2754012
	for <dovecot@procontrol.fi>; Mon,  7 Apr 2003 11:48:39 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id 69D773EFA
	for <dovecot@procontrol.fi>; Mon,  7 Apr 2003 11:45:58 +0200 (CEST)
Message-ID: <3E9148D5.2060105@bnap.hu>
Date: Mon, 07 Apr 2003 11:45:57 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: [dovecot] a few other problem
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 519
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 519                                                  
Status: O
Content-Length: 1370

hi,
I still has a few other problem with dovecot and mozilla.
- when I open mozilla mail I can only see the toplevel folders in the
   left handside folder list and when I close the imap folder and open it
   again (click on the arrow left to the imap server in the folder list)
   mozilla show me all folders and subfolders correctly (but not at the
   startup). it can be mozilla's bug, but this was worked when I use
   courier?!
- when I'd like to sort the messages by thread than the thread is usualy
   ok, but I'd like to see the the different threads sorted by date (as
   it was while using couirer or cyrus) but now it seems to me random:-((
   it's very anoying. my be it's mozilla fault again, but may be mozilla
   use server side thread support.
- in OE6 when we only select headers only sometime some message
   "disappear"! which means we see in OE6 a red line over the message (as
   it would be deleted), but no one delete it (yes I know you don't
   belive me, I also don't belive our users, but once I saw it). just
   click on it to see the message and inmediately become as deleted.
   while when I look at in the server the file is still there and _not_
   deleted. and OE6 show "the message already removed from the server".
- what about the ssl (imaps) problem?
yours.

-- 
   Levente                               "Si vis pacem para bellum!"



From johan@willard.se  Mon Apr  7 12:46:30 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 07 Apr 2003 12:46:30 +0300 (EEST)
Return-Path: <johan@willard.se>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail.willard.se (mail.willard.se [217.20.96.182])
	by danu.procontrol.fi (Postfix) with ESMTP id 4E1FE2387F
	for <dovecot@procontrol.fi>; Mon,  7 Apr 2003 12:46:30 +0300 (EEST)
Received: by mail.willard.se (Postfix, from userid 5000)
	id A5A52E6E96; Mon,  7 Apr 2003 10:04:03 +0000 (GMT)
Received: from localhost (localhost [127.0.0.1])
	by mail.willard.se (Postfix) with ESMTP id A4470115CFC
	for <dovecot@procontrol.fi>; Mon,  7 Apr 2003 10:04:03 +0000 (GMT)
Date: Mon, 7 Apr 2003 10:04:03 +0000 (GMT)
From: Johan Willard <johan@willard.se>
To: dovecot@procontrol.fi
Subject: [dovecot] Error: child 12625 (imap) killed with signal 12
Message-ID: <20030407095738.X14045@mail.willard.se>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 520
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: johan@willard.se
Precedence: bulk
X-list: dovecot
X-UID: 520                                                  
Status: O

Hi!

I have tried to install dovecot as my imap service on my FreeBSD server.
At first all looked fine and worked flawless. But after a while i started
to get errors. The imap process dies with signal 12 when the client tries
to check the contens of the folder.

dovecot: Apr 07 09:55:17 Error: child 12625 (imap) killed with signal 12

Any ideas what may cause this problem?

MvH Johan Willard

From cras@irccrew.org  Mon Apr  7 14:22:39 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 07 Apr 2003 14:22:39 +0300 (EEST)
Return-Path: <cras@irccrew.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from shodan.irccrew.org (shodan [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id 861692385F
	for <dovecot@procontrol.fi>; Mon,  7 Apr 2003 14:22:39 +0300 (EEST)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id 600AE2E003; Mon,  7 Apr 2003 14:22:39 +0300 (EEST)
Date: Mon, 7 Apr 2003 14:22:39 +0300
From: Timo Sirainen <tss@iki.fi>
To: Dovecot List <dovecot@procontrol.fi>
Subject: [dovecot] Re: a few other problem
Message-ID: <20030407112239.GA9258@irccrew.org>
References: <3E9148D5.2060105@bnap.hu>
Mime-Version: 1.0
Content-Disposition: inline
In-Reply-To: <3E9148D5.2060105@bnap.hu>
User-Agent: Mutt/1.4i
Content-Type: text/plain; charset=us-ascii
X-archive-position: 521
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 521                                                  
Status: O
Content-Length: 2075

On Mon, Apr 07, 2003 at 11:45:57AM +0200, Farkas Levente wrote:
> - when I open mozilla mail I can only see the toplevel folders in the
>   left handside folder list and when I close the imap folder and open it
>   again (click on the arrow left to the imap server in the folder list)
>   mozilla show me all folders and subfolders correctly (but not at the
>   startup). it can be mozilla's bug, but this was worked when I use
>   courier?!

Mozilla had same behaviour in subscription dialog, then it tried to use '/'
separator instead of '.'. If it works with Courier, I'm guessing it's
because Dovecot doesn't support NAMESPACE extension yet. It could be easily
added if needed.

> - when I'd like to sort the messages by thread than the thread is usualy
>   ok, but I'd like to see the the different threads sorted by date (as
>   it was while using couirer or cyrus) but now it seems to me random:-((
>   it's very anoying. my be it's mozilla fault again, but may be mozilla
>   use server side thread support.

Hmm.. They should be sorted by date. Last I checked it worked correctly,
maybe I've broken it later.

> - in OE6 when we only select headers only sometime some message
>   "disappear"! which means we see in OE6 a red line over the message (as
>   it would be deleted), but no one delete it (yes I know you don't
>   belive me, I also don't belive our users, but once I saw it). just
>   click on it to see the message and inmediately become as deleted.
>   while when I look at in the server the file is still there and _not_
>   deleted. and OE6 show "the message already removed from the server".

It's actually documented in dovecot.conf :) I couldn't figure out any way to
work around this, and I'm pretty sure Courier has exactly the same problem
(and we were seeing it too once in a while when we were still using
Courier). It may be that Courier does something a bit differently if you're
seeing this more with Dovecot. At least Courier doesn't check new mail as
often as Dovecot.

> - what about the ssl (imaps) problem?

I think it's fixed in CVS.


From ask@develooper.com  Mon Apr  7 20:47:12 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 07 Apr 2003 20:47:12 +0300 (EEST)
Return-Path: <ask@develooper.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from miette.develooper.com (miette.develooper.com [64.81.84.162])
	by danu.procontrol.fi (Postfix) with SMTP id 300762387F
	for <dovecot@procontrol.fi>; Mon,  7 Apr 2003 20:47:11 +0300 (EEST)
Received: (qmail 94762 invoked by uid 1001); 7 Apr 2003 17:47:09 -0000
Received: from localhost (sendmail-bs@127.0.0.1)
  by localhost with SMTP; 7 Apr 2003 17:47:09 -0000
Date: Mon, 7 Apr 2003 10:47:09 -0700 (PDT)
From: Ask Bjoern Hansen <ask@develooper.com>
To: dovecot@procontrol.fi
Subject: [dovecot] Mbox spool; dovecot rewriting and rewriting and rewriting
Message-ID: <20030407104125.O93909@miette.develooper.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 522
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: ask@develooper.com
Precedence: bulk
X-list: dovecot
X-UID: 522                                                  
Status: O

Hi,

jaldhar recommended dovecot to me -
http://www.askbjoernhansen.com/archives/2003/04/07/000286.html ...
and so far it seems much nicer than the other imapds.  yay.

I use the OS X Mail.app client.    I tested it with a test account
with no problems, but trying to use it with my usual mail folders
(~1.3GB; 120MB in the inbox) it's not working at all.

It seems like dovecot keeps copying the full inbox into a temp file
in mail/.imap/INBOX.  It did it at least 10 times while I was
watching without any noticable progress doing anything at all in
Mail.app.

I am running FreeBSD on an ancient box with 384MB ram (but nice SCSI
drives).

I tried stopping new mail deliveries to the inbox while I testing,
but it didn't seem to make a difference.



 - ask

-- 
ask bjoern hansen, http://www.askbjoernhansen.com/ !try; do();

From tss@iki.fi  Mon Apr  7 21:58:04 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 07 Apr 2003 21:58:04 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id CC4EC238D3
	for <dovecot@procontrol.fi>; Mon,  7 Apr 2003 21:58:04 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 98DAC5E01F95; Mon,  7 Apr 2003 21:58:04 +0300 (EEST)
Subject: [dovecot] Re: Mbox spool; dovecot rewriting and rewriting and
	rewriting
From: Timo Sirainen <tss@iki.fi>
To: Ask Bjoern Hansen <ask@develooper.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030407104125.O93909@miette.develooper.com>
References: <20030407104125.O93909@miette.develooper.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1049741884.25106.16.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.3 
Date: 07 Apr 2003 21:58:04 +0300
X-archive-position: 523
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 523                                                  
Status: O

On Mon, 2003-04-07 at 20:47, Ask Bjoern Hansen wrote:
> I use the OS X Mail.app client.    I tested it with a test account
> with no problems, but trying to use it with my usual mail folders
> (~1.3GB; 120MB in the inbox) it's not working at all.
> 
> It seems like dovecot keeps copying the full inbox into a temp file
> in mail/.imap/INBOX.  It did it at least 10 times while I was
> watching without any noticable progress doing anything at all in
> Mail.app.

That sounds like Mail.app is creating new custom flags. What does
X-IMAPbase header look like in the first mail?

Anyway, rewriting isn't too well optimized yet. It's a bit better in CVS
now and I think I could make it a bit more better for the next release
(which might be good enough for most), but "optimal" rewriting requires
a bit larger changes.

> I tried stopping new mail deliveries to the inbox while I testing,
> but it didn't seem to make a difference.

New mails shouldn't require rewriting, especially the whole file.

From tss@iki.fi  Mon Apr  7 22:04:26 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 07 Apr 2003 22:04:26 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 1014D238D3
	for <dovecot@procontrol.fi>; Mon,  7 Apr 2003 22:04:26 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id DEAA85E01F95; Mon,  7 Apr 2003 22:04:22 +0300 (EEST)
Subject: [dovecot] Re: Error: child 12625 (imap) killed with signal 12
From: Timo Sirainen <tss@iki.fi>
To: Johan Willard <johan@willard.se>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030407095738.X14045@mail.willard.se>
References: <20030407095738.X14045@mail.willard.se>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1049742262.25106.24.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.3 
Date: 07 Apr 2003 22:04:22 +0300
X-archive-position: 524
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 524                                                  
Status: O

On Mon, 2003-04-07 at 13:04, Johan Willard wrote:
> I have tried to install dovecot as my imap service on my FreeBSD server.
> At first all looked fine and worked flawless. But after a while i started
> to get errors. The imap process dies with signal 12 when the client tries
> to check the contens of the folder.
> 
> dovecot: Apr 07 09:55:17 Error: child 12625 (imap) killed with signal 12
> 
> Any ideas what may cause this problem?

That's "non-existent system call invoked" signal. Strange, I've never
seen that before. What's the point of it anyway, why not just return
ENOSYS?

What version of FreeBSD are you using? I'm guessing it's the sendfile()
call, try to comment out #define HAVE_FREEBSD_SENDFILE line from
config.h.

And you are using Dovecot 0.99.8.1, right? There were several FreeBSD
problems before.


From tss@iki.fi  Mon Apr  7 22:18:51 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 07 Apr 2003 22:18:51 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 39CF0238D3
	for <dovecot@procontrol.fi>; Mon,  7 Apr 2003 22:18:51 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id F0CCC5E01F95; Mon,  7 Apr 2003 22:18:50 +0300 (EEST)
Subject: [dovecot] Why can't hierarchy sep be changed?
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <1049739642.25105.2.camel@hurina>
References: <1049739642.25105.2.camel@hurina>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1049743130.25107.35.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.3 
Date: 07 Apr 2003 22:18:50 +0300
X-archive-position: 525
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 525                                                  
Status: O

>From: Charlie Brady <charlieb@e-smith.com>

There's something wrong with manually accepting posts from
non-subscribed addresses now, they're just left to queue directory for
some reason.. Please try to keep the From-address the same as the
subscribed one.

> >From maildir-storage.c:
> 
> ...
>         '.', /* hierarchy_sep - can't be changed */
> ...
> 
> Why can't it be changed? Is this just for courier compatibility, or is 
> there a deeper reason why it can't be changed?

Actually I'm going to change it to '/' to allow folders such as
shared/timo.sirainen/mailbox. The directory names themselves will still
contain '.' separator to stay compatible with Courier's Maildir++
format. So even though new IMAP separator will be '/', '.' still can't
be used in mailbox names.


From charlieb-dovecot@e-smith.com  Mon Apr  7 23:40:22 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 07 Apr 2003 23:40:22 +0300 (EEST)
Return-Path: <charlieb-dovecot@e-smith.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from nssg.mitel.com (mail.e-smith.com [216.191.234.126])
	by danu.procontrol.fi (Postfix) with SMTP id 470772385F
	for <dovecot@procontrol.fi>; Mon,  7 Apr 2003 23:40:22 +0300 (EEST)
Received: (qmail 16985 invoked by uid 404); 7 Apr 2003 20:40:19 -0000
Received: from charlieb-dovecot@e-smith.com by tripe.nssg.mitel.com with qmail-scanner; 07 Apr 2003 16:40:19 -0000
Received: from allspice-core.nssg.mitel.com (HELO e-smith.com) (10.33.16.12)
  by tripe.nssg.mitel.com (10.33.17.11) with SMTP; 07 Apr 2003 20:40:19 -0000
Received: (qmail 6017 invoked from network); 7 Apr 2003 20:40:19 -0000
Received: from vegemite.nssg.mitel.com (10.33.15.70)
  by allspice.nssg.mitel.com with QMQP; 7 Apr 2003 20:40:19 -0000
Received: from localhost (sendmail-bs@127.0.0.1)
  by localhost with SMTP; 7 Apr 2003 20:43:48 -0000
Date: Mon, 7 Apr 2003 16:43:48 -0400 (EDT)
From: Charlie Brady <charlieb-dovecot@e-smith.com>
X-X-Sender: charlieb@vegemite.nssg.mitel.com
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Why can't hierarchy sep be changed?
In-Reply-To: <1049743130.25107.35.camel@hurina>
Message-ID: <Pine.LNX.4.44.0304071640390.1466-100000@vegemite.nssg.mitel.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 526
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: charlieb-dovecot@e-smith.com
Precedence: bulk
X-list: dovecot
X-UID: 526                                                  
Status: O


On 7 Apr 2003, Timo Sirainen wrote:

> > >From maildir-storage.c:
> > 
> > ...
> >         '.', /* hierarchy_sep - can't be changed */
> > ...
> > 
> > Why can't it be changed? Is this just for courier compatibility, or is 
> > there a deeper reason why it can't be changed?
> 
> Actually I'm going to change it to '/' to allow folders such as
> shared/timo.sirainen/mailbox. The directory names themselves will still
> contain '.' separator to stay compatible with Courier's Maildir++
> format. So even though new IMAP separator will be '/', '.' still can't
> be used in mailbox names.

I don't care about Courier compatibility (speaking just for myself - no 
flames please), and I do want '.' in mailbox names. Will that be easy for 
me?

And just to repeat my question - is the only reason that '.' is unwelcome 
Courier compatibility?

--
Charlie



From tss@iki.fi  Tue Apr  8 00:19:04 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 08 Apr 2003 00:19:04 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 4CC9623845
	for <dovecot@procontrol.fi>; Tue,  8 Apr 2003 00:19:04 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 120385E017FE; Tue,  8 Apr 2003 00:19:04 +0300 (EEST)
Subject: [dovecot] Re: Why can't hierarchy sep be changed?
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.44.0304071640390.1466-100000@vegemite.nssg.mitel.com>
References:
	 <Pine.LNX.4.44.0304071640390.1466-100000@vegemite.nssg.mitel.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1049750343.25106.81.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.3 
Date: 08 Apr 2003 00:19:03 +0300
X-archive-position: 527
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 527                                                  
Status: O

On Mon, 2003-04-07 at 23:43, Charlie Brady wrote:
> > Actually I'm going to change it to '/' to allow folders such as
> > shared/timo.sirainen/mailbox. The directory names themselves will still
> > contain '.' separator to stay compatible with Courier's Maildir++
> > format. So even though new IMAP separator will be '/', '.' still can't
> > be used in mailbox names.
> 
> I don't care about Courier compatibility (speaking just for myself - no 
> flames please), and I do want '.' in mailbox names. Will that be easy for 
> me?

I could make it easy when I separate the IMAP/directory separators.
Currently you'd have to change the '.' from several places, it's
included inside some strings too. Everything should be in maildir-list.c
and maildir-storage.c anyway.

> And just to repeat my question - is the only reason that '.' is unwelcome 
> Courier compatibility?

Yes.


From ask@develooper.com  Tue Apr  8 01:38:16 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 08 Apr 2003 01:38:17 +0300 (EEST)
Return-Path: <ask@develooper.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from miette.develooper.com (miette.develooper.com [64.81.84.162])
	by danu.procontrol.fi (Postfix) with SMTP id C188D2385F
	for <dovecot@procontrol.fi>; Tue,  8 Apr 2003 01:38:15 +0300 (EEST)
Received: (qmail 22416 invoked by uid 1001); 7 Apr 2003 22:38:13 -0000
Received: from localhost (sendmail-bs@127.0.0.1)
  by localhost with SMTP; 7 Apr 2003 22:38:13 -0000
Date: Mon, 7 Apr 2003 15:38:13 -0700 (PDT)
From: Ask Bjoern Hansen <ask@develooper.com>
To: Timo Sirainen <tss@iki.fi>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: Mbox spool; dovecot rewriting and rewriting and
 rewriting
In-Reply-To: <1049741884.25106.16.camel@hurina>
Message-ID: <20030407153703.K21450@miette.develooper.com>
References: <20030407104125.O93909@miette.develooper.com> <1049741884.25106.16.camel@hurina>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 528
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: ask@develooper.com
Precedence: bulk
X-list: dovecot
X-UID: 528                                                  
Status: O
Content-Length: 1143

On Mon, 7 Apr 2003, Timo Sirainen wrote:

> On Mon, 2003-04-07 at 20:47, Ask Bjoern Hansen wrote:
> > I use the OS X Mail.app client.    I tested it with a test account
> > with no problems, but trying to use it with my usual mail folders
> > (~1.3GB; 120MB in the inbox) it's not working at all.
> >
> > It seems like dovecot keeps copying the full inbox into a temp file
> > in mail/.imap/INBOX.  It did it at least 10 times while I was
> > watching without any noticable progress doing anything at all in
> > Mail.app.
>
> That sounds like Mail.app is creating new custom flags. What does
> X-IMAPbase header look like in the first mail?

Ah, yes.  It keep track of the "Junk" status.

X-IMAPbase: 1049736224 0 NotJunk Junk

> Anyway, rewriting isn't too well optimized yet. It's a bit better in CVS
> now and I think I could make it a bit more better for the next release
> (which might be good enough for most), but "optimal" rewriting requires
> a bit larger changes.

So for every mail read it rewrites the 120MB file?  Ouch.  No wonder
it's a bit slow. ;-)



 - ask

-- 
ask bjoern hansen, http://www.askbjoernhansen.com/ !try; do();

From tss@iki.fi  Tue Apr  8 02:12:24 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 08 Apr 2003 02:12:24 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id CC7722399B
	for <dovecot@procontrol.fi>; Tue,  8 Apr 2003 02:12:24 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 181A45E017FE; Tue,  8 Apr 2003 02:12:23 +0300 (EEST)
Subject: [dovecot] Re: Mbox spool; dovecot rewriting and rewriting and
	rewriting
From: Timo Sirainen <tss@iki.fi>
To: Ask Bjoern Hansen <ask@develooper.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030407153703.K21450@miette.develooper.com>
References: <20030407104125.O93909@miette.develooper.com>
	 <1049741884.25106.16.camel@hurina>
	 <20030407153703.K21450@miette.develooper.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1049757142.25102.117.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.3 
Date: 08 Apr 2003 02:12:22 +0300
X-archive-position: 529
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 529                                                  
Status: O

On Tue, 2003-04-08 at 01:38, Ask Bjoern Hansen wrote:
> > That sounds like Mail.app is creating new custom flags. What does
> > X-IMAPbase header look like in the first mail?
> 
> Ah, yes.  It keep track of the "Junk" status.
> 
> X-IMAPbase: 1049736224 0 NotJunk Junk

Hmm. Maybe it then starts scanning the mails from beginning and setting
the flags one by one?

> > Anyway, rewriting isn't too well optimized yet. It's a bit better in CVS
> > now and I think I could make it a bit more better for the next release
> > (which might be good enough for most), but "optimal" rewriting requires
> > a bit larger changes.
> 
> So for every mail read it rewrites the 120MB file?  Ouch.  No wonder
> it's a bit slow. ;-)

Not whole file, but all mails after the one it modifies. So updating new
mails should be pretty fast.

CVS already writes some extra empty space between mails, but it's not
smart enough yet to use it for inserted headers.


From ask@develooper.com  Tue Apr  8 06:58:47 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 08 Apr 2003 06:58:47 +0300 (EEST)
Return-Path: <ask@develooper.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from miette.develooper.com (miette.develooper.com [64.81.84.162])
	by danu.procontrol.fi (Postfix) with SMTP id 401A72385F
	for <dovecot@procontrol.fi>; Tue,  8 Apr 2003 06:58:46 +0300 (EEST)
Received: (qmail 52993 invoked from network); 8 Apr 2003 03:58:44 -0000
Received: from one.develooper.com (HELO develooper.com) (@64.81.84.115)
  by miette.develooper.com with SMTP; 8 Apr 2003 03:58:44 -0000
Date: Mon, 7 Apr 2003 20:58:44 -0700
Subject: [dovecot] Re: Mbox spool; dovecot rewriting and rewriting and	rewriting
Content-Type: text/plain; charset=US-ASCII; format=flowed
Mime-Version: 1.0 (Apple Message framework v551)
Cc: dovecot@procontrol.fi
To: Timo Sirainen <tss@iki.fi>
From: Ask Bjoern Hansen <ask@develooper.com>
In-Reply-To: <1049757142.25102.117.camel@hurina>
Message-Id: <645B9AF4-6976-11D7-BBC9-000A95796C18@develooper.com>
Content-Transfer-Encoding: 7bit
X-Mailer: Apple Mail (2.551)
X-archive-position: 530
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: ask@develooper.com
Precedence: bulk
X-list: dovecot
X-UID: 530                                                  
Status: O

On Monday, Apr 7, 2003, at 16:12 America/Los_Angeles, Timo Sirainen 
wrote:

>> X-IMAPbase: 1049736224 0 NotJunk Junk
>
> Hmm. Maybe it then starts scanning the mails from beginning and setting
> the flags one by one?

Yes, it seems like it.


>> So for every mail read it rewrites the 120MB file?  Ouch.  No wonder
>> it's a bit slow. ;-)
>
> Not whole file, but all mails after the one it modifies. So updating 
> new
> mails should be pretty fast.
>
> CVS already writes some extra empty space between mails, but it's not
> smart enough yet to use it for inserted headers.

It sounds like adding that will fix the issue for me; I'll try dovecot 
again when it's there. Thanks!

For now I got imap-uw to not suck quite as much as it did first; thanks 
Jonas!


  - ask

-- 
http://www.askbjoernhansen.com/


From johan@willard.se  Tue Apr  8 09:43:04 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 08 Apr 2003 09:43:04 +0300 (EEST)
Return-Path: <johan@willard.se>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail.willard.se (mail.willard.se [217.20.96.182])
	by danu.procontrol.fi (Postfix) with ESMTP id A404E239A7
	for <dovecot@procontrol.fi>; Tue,  8 Apr 2003 09:43:04 +0300 (EEST)
Received: by mail.willard.se (Postfix, from userid 5000)
	id D7E9FE4E19; Tue,  8 Apr 2003 07:00:39 +0000 (GMT)
Received: from localhost (localhost [127.0.0.1])
	by mail.willard.se (Postfix) with ESMTP
	id D2B84115CFC; Tue,  8 Apr 2003 07:00:39 +0000 (GMT)
Date: Tue, 8 Apr 2003 07:00:39 +0000 (GMT)
From: Johan Willard <johan@willard.se>
To: Timo Sirainen <tss@iki.fi>
Cc: Johan Willard <johan@willard.se>, dovecot@procontrol.fi
Subject: [dovecot] Re: Error: child 12625 (imap) killed with signal 12
In-Reply-To: <1049742262.25106.24.camel@hurina>
Message-ID: <20030408065019.O33396@mail.willard.se>
References: <20030407095738.X14045@mail.willard.se> <1049742262.25106.24.camel@hurina>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 531
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: johan@willard.se
Precedence: bulk
X-list: dovecot
X-UID: 531                                                  
Status: O
Content-Length: 1882

On Mon, 7 Apr 2003, Timo Sirainen wrote:

> On Mon, 2003-04-07 at 13:04, Johan Willard wrote:
> > I have tried to install dovecot as my imap service on my FreeBSD server.
> > At first all looked fine and worked flawless. But after a while i started
> > to get errors. The imap process dies with signal 12 when the client tries
> > to check the contens of the folder.
> >
> > dovecot: Apr 07 09:55:17 Error: child 12625 (imap) killed with signal 12
> >
> > Any ideas what may cause this problem?
>
> That's "non-existent system call invoked" signal. Strange, I've never
> seen that before. What's the point of it anyway, why not just return
> ENOSYS?
>
> What version of FreeBSD are you using? I'm guessing it's the sendfile()
> call, try to comment out #define HAVE_FREEBSD_SENDFILE line from
> config.h.
>
I'm using FreeBSD 4.6-STABLE. If there's any time left over today i'll try
to recompile without that option.

> And you are using Dovecot 0.99.8.1, right? There were several FreeBSD
> problems before.
>
yes.

I was using the regular unix mailbox system when this error occured. T
thougth this would be best for compability reasons. I tried to configure
my system to use maildir instead. Now it looks like the problem have
disappered.

I allso tested another mail client after i had sent the previous mail.
When I encountered this problem I whas using outlook express 6. I tried
with an old version of Netscape Messenger and it actually worked better.
In the client everything looked fin. I was able to read my mail in all
boxes. But the imap child still died.

It looks like the maildir system suits imap much better than mailbox, so i
think i stick to it. The only problem now is that my favourite client,
pine, dosn't support maildir :/ I've located a patch that I will try, and
in worse case scenario, i'll have to connect to localhost via imap :(

>
>

MvH Johan Willard

From js@debian.org  Tue Apr  8 11:46:15 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 08 Apr 2003 11:46:15 +0300 (EEST)
Return-Path: <js@debian.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from auryn.jones.dk (unknown [62.79.77.233])
	by danu.procontrol.fi (Postfix) with ESMTP id 70300239A7
	for <dovecot@procontrol.fi>; Tue,  8 Apr 2003 11:46:15 +0300 (EEST)
Received: from auryn (auryn [127.0.0.1])
	by auryn.jones.dk (Postfix) with ESMTP
	id 339363F233F; Tue,  8 Apr 2003 10:46:16 +0200 (CEST)
Date: Tue, 8 Apr 2003 10:46:16 +0200 (CEST)
From: Jonas Smedegaard <js@debian.org>
X-X-Sender: jonas@auryn.jones.dk
Reply-To: Jonas Smedegaard <dr@jones.dk>
To: Johan Willard <johan@willard.se>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: Error: child 12625 (imap) killed with signal 12
In-Reply-To: <20030408065019.O33396@mail.willard.se>
Message-ID: <Pine.LNX.4.53.0304081042160.14898@auryn.jones.dk>
References: <20030407095738.X14045@mail.willard.se> <1049742262.25106.24.camel@hurina>
 <20030408065019.O33396@mail.willard.se>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 532
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: js@debian.org
Precedence: bulk
X-list: dovecot
X-UID: 532                                                  
Status: O

On Tue, 8 Apr 2003, Johan Willard wrote:

> It looks like the maildir system suits imap much better than mailbox, so
> i think i stick to it. The only problem now is that my favourite client,
> pine, dosn't support maildir :/ I've located a patch that I will try,
> and in worse case scenario, i'll have to connect to localhost via imap
> :(

I worked yesterday on tracing the history of the maildir patch for Pine
and uw-imap originally written by Mattias Larsson. Have a look here:
http://debian.jones.dk/official/uw-imap/changelog.maildir/

You may find a more recent version of your own patch there. If you have a
different one than already there, please let me know where you found it.

 - Jonas

-- 
* Debian GNU/Linux developer     http://www.debian.org/
* Jonas Smedegaard +45 40843136  http://dr.jones.dk/
* Consulting for machines and humans:   Spiff ApS
I have no signatures :-(

From johan@willard.se  Tue Apr  8 12:40:11 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 08 Apr 2003 12:40:11 +0300 (EEST)
Return-Path: <johan@willard.se>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail.willard.se (mail.willard.se [217.20.96.182])
	by danu.procontrol.fi (Postfix) with ESMTP id AFB062399B
	for <dovecot@procontrol.fi>; Tue,  8 Apr 2003 12:40:11 +0300 (EEST)
Received: by mail.willard.se (Postfix, from userid 5000)
	id 6CEBEE6E79; Tue,  8 Apr 2003 09:57:47 +0000 (GMT)
Received: from localhost (localhost [127.0.0.1])
	by mail.willard.se (Postfix) with ESMTP
	id 652A0115FDF; Tue,  8 Apr 2003 09:57:47 +0000 (GMT)
Date: Tue, 8 Apr 2003 09:57:47 +0000 (GMT)
From: Johan Willard <johan@willard.se>
To: Jonas Smedegaard <dr@jones.dk>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: Error: child 12625 (imap) killed with signal 12
In-Reply-To: <Pine.LNX.4.53.0304081042160.14898@auryn.jones.dk>
Message-ID: <20030408095610.K75206@mail.willard.se>
References: <20030407095738.X14045@mail.willard.se> <1049742262.25106.24.camel@hurina>
 <20030408065019.O33396@mail.willard.se> <Pine.LNX.4.53.0304081042160.14898@auryn.jones.dk>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 533
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: johan@willard.se
Precedence: bulk
X-list: dovecot
X-UID: 533                                                  
Status: O
Content-Length: 1102

On Tue, 8 Apr 2003, Jonas Smedegaard wrote:

> On Tue, 8 Apr 2003, Johan Willard wrote:
>
> > It looks like the maildir system suits imap much better than mailbox, so
> > i think i stick to it. The only problem now is that my favourite client,
> > pine, dosn't support maildir :/ I've located a patch that I will try,
> > and in worse case scenario, i'll have to connect to localhost via imap
> > :(
>
> I worked yesterday on tracing the history of the maildir patch for Pine
> and uw-imap originally written by Mattias Larsson. Have a look here:
> http://debian.jones.dk/official/uw-imap/changelog.maildir/
>
> You may find a more recent version of your own patch there. If you have a
> different one than already there, please let me know where you found it.
>
Here's the patch for pine 4.50. Haven't tested it yet thou.
http://hico.fphil.uniba.sk/pine-patches.html

>  - Jonas
>
> --
> * Debian GNU/Linux developer     http://www.debian.org/
> * Jonas Smedegaard +45 40843136  http://dr.jones.dk/
> * Consulting for machines and humans:   Spiff ApS
> I have no signatures :-(
>
>

MvH Johan Willard

From js@debian.org  Tue Apr  8 12:58:11 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 08 Apr 2003 12:58:11 +0300 (EEST)
Return-Path: <js@debian.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from auryn.jones.dk (unknown [62.79.77.233])
	by danu.procontrol.fi (Postfix) with ESMTP id 809F623845
	for <dovecot@procontrol.fi>; Tue,  8 Apr 2003 12:58:11 +0300 (EEST)
Received: from auryn (auryn [127.0.0.1])
	by auryn.jones.dk (Postfix) with ESMTP
	id 11D6D3F233F; Tue,  8 Apr 2003 11:58:11 +0200 (CEST)
Date: Tue, 8 Apr 2003 11:58:11 +0200 (CEST)
From: Jonas Smedegaard <js@debian.org>
X-X-Sender: jonas@auryn.jones.dk
Reply-To: Jonas Smedegaard <dr@jones.dk>
To: Johan Willard <johan@willard.se>
Cc: dovecot@procontrol.fi, hico1@im.from.mars.sef.sk
Subject: [dovecot] Re: Error: child 12625 (imap) killed with signal 12
In-Reply-To: <20030408095610.K75206@mail.willard.se>
Message-ID: <Pine.LNX.4.53.0304081154530.14898@auryn.jones.dk>
References: <20030407095738.X14045@mail.willard.se> <1049742262.25106.24.camel@hurina>
 <20030408065019.O33396@mail.willard.se> <Pine.LNX.4.53.0304081042160.14898@auryn.jones.dk>
 <20030408095610.K75206@mail.willard.se>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 534
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: js@debian.org
Precedence: bulk
X-list: dovecot
X-UID: 534                                                  
Status: O
Content-Length: 1392

On Tue, 8 Apr 2003, Johan Willard wrote:

> On Tue, 8 Apr 2003, Jonas Smedegaard wrote:
>
> > On Tue, 8 Apr 2003, Johan Willard wrote:
> >
> > > It looks like the maildir system suits imap much better than
> > > mailbox, so i think i stick to it. The only problem now is that my
> > > favourite client, pine, dosn't support maildir :/ I've located a
> > > patch that I will try, and in worse case scenario, i'll have to
> > > connect to localhost via imap
> > > :(
> >
> > I worked yesterday on tracing the history of the maildir patch for
> > Pine and uw-imap originally written by Mattias Larsson. Have a look
> > here: http://debian.jones.dk/official/uw-imap/changelog.maildir/
> >
> > You may find a more recent version of your own patch there. If you
> > have a different one than already there, please let me know where you
> > found it.
> >
> Here's the patch for pine 4.50. Haven't tested it yet thou.
> http://hico.fphil.uniba.sk/pine-patches.html

Looks like an older version of the same patch as in Debian. Haven't
investigated much yet, but I really recoomend looking into the other
alternatives I have collected.

This mail is Cc'ed the maintainer of the patch you found as well.

 - Jonas

-- 
* Debian GNU/Linux developer     http://www.debian.org/
* Jonas Smedegaard +45 40843136  http://dr.jones.dk/
* Consulting for machines and humans:   Spiff ApS
I have no signatures :-(

From aw@osn.de  Tue Apr  8 19:41:15 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 08 Apr 2003 19:41:15 +0300 (EEST)
Return-Path: <aw@osn.de>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from kuba.osn.de (kuba.osn.de [194.45.27.112])
	by danu.procontrol.fi (Postfix) with SMTP id AE89023845
	for <dovecot@procontrol.fi>; Tue,  8 Apr 2003 19:41:15 +0300 (EEST)
Received: (qmail 28794 invoked by uid 4179); 8 Apr 2003 16:41:37 -0000
Date: Tue, 8 Apr 2003 18:41:15 +0200
From: Armin Wolfermann <aw@osn.de>
To: dovecot@procontrol.fi
Subject: [dovecot] Patch for passdb-passwd-file.c
Message-ID: <20030408164137.GE26048@kuba.osn.de>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.5.4i
X-archive-position: 535
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: aw@osn.de
Precedence: bulk
X-list: dovecot
X-UID: 535                                                  
Status: O

Index: passdb-passwd-file.c
===================================================================
RCS file: /home/cvs/dovecot/src/auth/passdb-passwd-file.c,v
retrieving revision 1.6
diff -u -u -r1.6 passdb-passwd-file.c
--- passdb-passwd-file.c	18 Feb 2003 19:24:44 -0000	1.6
+++ passdb-passwd-file.c	8 Apr 2003 15:59:53 -0000
@@ -28,7 +28,7 @@
 
 	crypted_pass = pu->password;
 	scheme = password_get_scheme(&crypted_pass);
-	if (scheme == NULL) scheme = "DES";
+	if (scheme == NULL) scheme = "CRYPT";
 
 	ret = password_verify(password, crypted_pass, scheme,
 			      request->user);


From tss@iki.fi  Tue Apr  8 20:00:14 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 08 Apr 2003 20:00:14 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 3A1C723845
	for <dovecot@procontrol.fi>; Tue,  8 Apr 2003 20:00:14 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 16CC45E017FE; Tue,  8 Apr 2003 20:00:14 +0300 (EEST)
Subject: [dovecot] Re: Patch for passdb-passwd-file.c
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030408164137.GE26048@kuba.osn.de>
References: <20030408164137.GE26048@kuba.osn.de>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1049821213.25105.126.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.3 
Date: 08 Apr 2003 20:00:14 +0300
X-archive-position: 536
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 536                                                  
Status: O

On Tue, 2003-04-08 at 19:41, Armin Wolfermann wrote:
> -	if (scheme == NULL) scheme = "DES";
> +	if (scheme == NULL) scheme = "CRYPT";

Whops, thanks.


From ianj@ian-justman.com  Wed Apr  9 01:45:11 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 09 Apr 2003 01:45:12 +0300 (EEST)
Return-Path: <ianj@ian-justman.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from sakura.ian-justman.com (sakura.ian-justman.com [207.126.64.32])
	by danu.procontrol.fi (Postfix) with ESMTP id AB46A23845
	for <dovecot@procontrol.fi>; Wed,  9 Apr 2003 01:45:11 +0300 (EEST)
Received: from localhost (localhost [127.0.0.1])
	by localhost.ian-justman.com (Postfix) with ESMTP id 957E66112E1
	for <dovecot@procontrol.fi>; Tue,  8 Apr 2003 15:45:09 -0700 (PDT)
Received: from sakura.ian-justman.com ([127.0.0.1])
 by localhost (sakura [127.0.0.1]) (amavisd-new, port 10024) with ESMTP
 id 13609-10 for <dovecot@procontrol.fi>;
 Tue,  8 Apr 2003 15:45:07 -0700 (PDT)
Received: from ian-justman.com (fenchurch.netasset.com [207.126.67.194])
	by sakura.ian-justman.com (Postfix) with ESMTP id C7D306112CA
	for <dovecot@procontrol.fi>; Tue,  8 Apr 2003 15:45:06 -0700 (PDT)
Message-ID: <3E9350F2.4010205@ian-justman.com>
Date: Tue, 08 Apr 2003 15:45:06 -0700
From: "Ian R. Justman" <ianj@ian-justman.com>
Organization: Net Asset, Network Operations
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.0; en-US; rv:1.0.2) Gecko/20030208 Netscape/7.02
X-Accept-Language: en-us, en, ja
MIME-Version: 1.0
To: dovecot@procontrol.fi
Subject: [dovecot] Re: message order reversed on copying
References: <Pine.LNX.4.44.0304061811480.10634-100000@allspice.nssg.mitel.com> <1049668055.22903.405.camel@hurina>
X-Enigmail-Version: 0.71.2.0
X-Enigmail-Supports: pgp-inline, pgp-mime
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-Virus-Scanned: by amavisd-new-20030314-p1 (Debian)
X-archive-position: 537
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: ianj@ian-justman.com
Precedence: bulk
X-list: dovecot
X-UID: 537                                                  
Status: O



Timo Sirainen wrote:
>>Yes, I could have mentioned that. Still, it's the only way I know to 
>>restore the sorting order once it's jumbled.
> 
> 
> How about making your client sort the messages by received-date? :)

I generally tend to copy in received order, even if the dates are 
"jumbled".  Then they're TRULY in the correct order.

--Ian.



From tss@iki.fi  Wed Apr  9 14:03:54 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 09 Apr 2003 14:03:54 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 2905F23845
	for <dovecot@procontrol.fi>; Wed,  9 Apr 2003 14:03:54 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id BBE825E017FE; Wed,  9 Apr 2003 14:03:50 +0300 (EEST)
Subject: [dovecot] command line version of dovecot?
From: Timo Sirainen <tss@iki.fi>
To: kyler-keyword-dovecot.a0ff9b@lairds.org
Cc: dovecot@procontrol.fi
In-Reply-To: <ecartis-04092003032154.8589.1@danu>
References: <ecartis-04092003032154.8589.1@danu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1049886230.25106.264.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.3 
Date: 09 Apr 2003 14:03:50 +0300
X-archive-position: 538
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 538                                                  
Status: O

> From: Kyler Laird <kyler-keyword-dovecot.a0ff9b@lairds.org>

> I finally have dovecot mostly working and I was thinking that
> I'd been saved from having to use UW-IMAPd, but I just now
> noticed that there doesn't appear to be any way to run
> dovecot over standard I/O; it always wants to listen on a
> socket.

There's the "imap" binary that should do exactly that. Usually installed
into /usr/local/libexec/dovecot/imap

Or did you mean you wanted to run it from inetd? CVS version supports
that too if you execute imap-login.


From tss@iki.fi  Wed Apr  9 19:13:18 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 09 Apr 2003 19:13:18 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id B9DF623997
	for <dovecot@procontrol.fi>; Wed,  9 Apr 2003 19:13:18 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 78E1A5E017FE; Wed,  9 Apr 2003 19:13:16 +0300 (EEST)
Subject: [dovecot] Re: command line version of dovecot?
From: Timo Sirainen <tss@iki.fi>
To: Kyler Laird <Kyler@lairds.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030409155256.GR21821@remote.lairds.org>
References: <ecartis-04092003032154.8589.1@danu>
	 <1049886230.25106.264.camel@hurina>
	 <20030409155256.GR21821@remote.lairds.org>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1049904796.25102.319.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.3 
Date: 09 Apr 2003 19:13:16 +0300
X-archive-position: 539
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 539                                                  
Status: O
Content-Length: 1260

On Wed, 2003-04-09 at 18:52, Kyler Laird wrote:
> > There's the "imap" binary that should do exactly that. Usually installed
> > into /usr/local/libexec/dovecot/imap
> 
> Ah!  That's just the kind of solution I sought.
> 
> Unfortunately it doesn't seem to work for me.  It doesn't
> appear (via strace) to read any configuration file.  It just
> looks in /var/mail/[user] for a Maildir.  I need to to go to
> the Maildir in the user's home (and follow other behaviors
> defined in the config file).

It should look into ~/Maildir first, then ~/mail and ~/Mail unless it's
overridden in MAIL environment. You probably have MAIL=/var/mail/user
set, which is why it looks into there.

Currently it doesn't read any configuration file, and I'm not sure if I
should make it do that.. Well, it could be useful but I'd have to figure
out how to prevent unneeded code duplication for config file parsing.
All settings are passed via environment settings, but they're not
documented (they're basically uppercased versions of the setting names
in config file).

> Should I have found all of this in some documentation?  I
> appreciate the help but I feel like I should be reading
> about this on my own somewhere.

doc/mail-storages.txt explains the MAIL environment.


From dknudse@online.no  Wed Apr  9 21:46:31 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 09 Apr 2003 21:46:31 +0300 (EEST)
Return-Path: <dknudse@online.no>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail.broadpark.no (mail.broadpark.no [217.13.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id A93AD23845
	for <dovecot@procontrol.fi>; Wed,  9 Apr 2003 21:46:31 +0300 (EEST)
Received: from hal.technomedics.no (32.80-202-130.nextgentel.com [80.202.130.32])
	by mail.broadpark.no (Postfix) with ESMTP id E99B3789DC
	for <dovecot@procontrol.fi>; Wed,  9 Apr 2003 20:46:30 +0200 (MEST)
Received: from amavis by hal.technomedics.no with scanned-ok (Exim 3.35 #1 (Debian))
	id 193Kac-0004cA-00
	for <dovecot@procontrol.fi>; Wed, 09 Apr 2003 20:46:30 +0200
Received: from  by localhost (amavisd-new, port ) id XXRIiEoA
 for <dovecot@procontrol.fi>; Wed,  9 Apr 2003 20:46:21 +0200 (CEST)
Received: from dk by hal.technomedics.no with local (Exim 3.35 #1 (Debian))
	id 193KaS-0004bz-00
	for <dovecot@procontrol.fi>; Wed, 09 Apr 2003 20:46:20 +0200
Date: Wed, 9 Apr 2003 20:46:20 +0200
To: dovecot@procontrol.fi
Subject: [dovecot] New installation - error 89 on connect
Message-ID: <20030409184620.GB17645@hal>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.3.28i
From: David Knudsen <dknudse@online.no>
X-Virus-Scanned: by amavisd-new-20030314-p1 (Debian)
X-archive-position: 540
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: dknudse@online.no
Precedence: bulk
X-list: dovecot
X-UID: 540                                                  
Status: O
Content-Length: 1430

I've recently installed dovecot (0.99.8.1) from the Debian/woody 
backport at 'deb http://src.braincells.com/debian woody/'

Previously, all mail have been delivered to mbox'es in ~/Mail by
exim/procmail -- ~/Mail/inbox being my main mailbox.

Whenever I attempt to connect with an IMAP client, the connection is
closed and the following error is reported in /var/log/syslog:

	imap-login: Login: dk [192.168.0.2]
	imap(dk): Unknown client workaround: outlook-idle^I###
	dovecot: child 17653 (imap) returned error 89

What does error 89 signify?

My current configuration is: (non-comment lines only)

	imap_listen = 192.168.0.2
	imaps_listen = *
	login = imap
	login = pop3
	verbose_proctitle = yes
	client_workarounds = oe6-fetch-no-newmail outlook-idle
	mailbox_check_interval = 60
	auth = default
	auth_mechanisms = plain
	auth_userdb = passwd
	auth_passdb = pam
	auth_user = root
	auth_verbose = yes

In my confusion, I blindly tried changing settings, attempting to get a
different error message at least.  :-)

These are the settings I have tried, without success:

	default_mail_env = mbox:~/Mail:INBOX=~/Mail/inbox
	mail_full_filesystem_access = yes
	mbox_locks = fcntl
	auth_passdb = shadow

There is no subdirectories in ~/Mail, neither visible nor hidden.

I did try to read the docs, and I did browse the mailing list archives,
but either I missed something or it is not there.  Any ideas?


Thank you,
David Knudsen

From tss@iki.fi  Wed Apr  9 21:57:21 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 09 Apr 2003 21:57:21 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 8822923845
	for <dovecot@procontrol.fi>; Wed,  9 Apr 2003 21:57:21 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 40B355E017F5; Wed,  9 Apr 2003 21:57:21 +0300 (EEST)
Subject: [dovecot] Re: New installation - error 89 on connect
From: Timo Sirainen <tss@iki.fi>
To: David Knudsen <dknudse@online.no>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030409184620.GB17645@hal>
References: <20030409184620.GB17645@hal>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1049914641.25102.328.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.3 
Date: 09 Apr 2003 21:57:21 +0300
X-archive-position: 541
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 541                                                  
Status: O

On Wed, 2003-04-09 at 21:46, David Knudsen wrote:
> Whenever I attempt to connect with an IMAP client, the connection is
> closed and the following error is reported in /var/log/syslog:
> 
> 	imap-login: Login: dk [192.168.0.2]
> 	imap(dk): Unknown client workaround: outlook-idle^I###

This looks like you have TAB and ### at end of client_workarounds
setting in config file. Comments (and tabs) are not currently allowed
there.

> 	dovecot: child 17653 (imap) returned error 89
> 
> What does error 89 signify?

It's "default exit code", meaning the error should have been written to
log file (like it was).


From dknudse@online.no  Wed Apr  9 23:00:26 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 09 Apr 2003 23:00:26 +0300 (EEST)
Return-Path: <dknudse@online.no>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail.broadpark.no (mail.broadpark.no [217.13.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id 2C70823994
	for <dovecot@procontrol.fi>; Wed,  9 Apr 2003 23:00:26 +0300 (EEST)
Received: from hal.technomedics.no (32.80-202-130.nextgentel.com [80.202.130.32])
	by mail.broadpark.no (Postfix) with ESMTP id 46E8278D6B
	for <dovecot@procontrol.fi>; Wed,  9 Apr 2003 22:00:25 +0200 (MEST)
Received: from amavis by hal.technomedics.no with scanned-ok (Exim 3.35 #1 (Debian))
	id 193Lk8-0004ff-00
	for <dovecot@procontrol.fi>; Wed, 09 Apr 2003 22:00:24 +0200
Received: from  by localhost (amavisd-new, port ) id XXWgeN0x
 for <dovecot@procontrol.fi>; Wed,  9 Apr 2003 22:00:09 +0200 (CEST)
Received: from dk by hal.technomedics.no with local (Exim 3.35 #1 (Debian))
	id 193Ljk-0004fA-00; Wed, 09 Apr 2003 22:00:00 +0200
Date: Wed, 9 Apr 2003 22:00:00 +0200
To: Timo Sirainen <tss@iki.fi>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: New installation - error 89 on connect
Message-ID: <20030409200000.GA17921@hal>
References: <20030409184620.GB17645@hal> <1049914641.25102.328.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1049914641.25102.328.camel@hurina>
User-Agent: Mutt/1.3.28i
From: David Knudsen <dknudse@online.no>
X-Virus-Scanned: by amavisd-new-20030314-p1 (Debian)
X-archive-position: 542
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: dknudse@online.no
Precedence: bulk
X-list: dovecot
X-UID: 542                                                  
Status: O

On Wed, Apr 09, 2003 at 09:57:21PM +0300, Timo Sirainen wrote:
> On Wed, 2003-04-09 at 21:46, David Knudsen wrote:
> > Whenever I attempt to connect with an IMAP client, the connection is
> > closed and the following error is reported in /var/log/syslog:
> > 
> > 	imap-login: Login: dk [192.168.0.2]
> > 	imap(dk): Unknown client workaround: outlook-idle^I###
> 
> This looks like you have TAB and ### at end of client_workarounds
> setting in config file. Comments (and tabs) are not currently allowed
> there.

Exactly - that's the case.  I'll change that immediately.

Thanks for the swift reply!
David Knudsen

From tss@iki.fi  Wed Apr  9 23:21:39 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 09 Apr 2003 23:21:39 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id B1A5C23994
	for <dovecot@procontrol.fi>; Wed,  9 Apr 2003 23:21:38 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 67E055E017F5; Wed,  9 Apr 2003 23:21:38 +0300 (EEST)
Subject: [dovecot] Re: Error: child 12625 (imap) killed with signal 12
From: Timo Sirainen <tss@iki.fi>
To: Johan Willard <johan@willard.se>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030408065019.O33396@mail.willard.se>
References: <20030407095738.X14045@mail.willard.se>
	 <1049742262.25106.24.camel@hurina>  <20030408065019.O33396@mail.willard.se>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1049919698.25102.340.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.3 
Date: 09 Apr 2003 23:21:38 +0300
X-archive-position: 543
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 543                                                  
Status: O

On Tue, 2003-04-08 at 10:00, Johan Willard wrote:
> > > dovecot: Apr 07 09:55:17 Error: child 12625 (imap) killed with signal 12
> I was using the regular unix mailbox system when this error occured. T
> thougth this would be best for compability reasons. I tried to configure
> my system to use maildir instead. Now it looks like the problem have
> disappered.

It's probably because sendfile() was tried to be used to write to the
mbox file. It may crash again if you try to unsubscribe some mailboxes
(anything but the last one in .subscriptions file).

I just tried this with FreeBSD 4.8-PRERELEASE myself, sendfile() nicely
returns error instead of crashing the whole program. Maybe the problem
is something else, or maybe you've just configured the system
differently.

I think I'll just disable trying to use sendfile() for writing to files,
except under Linux where it works.


From tss@iki.fi  Thu Apr 10 00:03:15 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 10 Apr 2003 00:03:15 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 4FEAF23845
	for <dovecot@procontrol.fi>; Thu, 10 Apr 2003 00:03:15 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 1B0F65E017F5; Thu, 10 Apr 2003 00:03:15 +0300 (EEST)
Subject: [dovecot] Maildir syncing rewrite
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1049922194.25102.364.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.3 
Date: 10 Apr 2003 00:03:14 +0300
X-archive-position: 544
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 544                                                  
Status: O
Content-Length: 1249

It finally seems to be working. I've done some testing now and it seems
to be working fine. If you have time, see if you can get it to break
(especially with INDEX=memory or by manually modifying the maildir).

The UIDs are kept in Courier-compatible dovecot-uidlist file
(so "mv courierimapuiddb dovecot-uidlist" should work). The great thing
about this code is that we never wait for lock. If we can't lock, we
simply use the old uidlist file to sync whatever we can, which should be
everything but the very newest mails just being delivered and processed
by another Dovecot. Of course, if they share index files, we're still
blocking there.

I named the file as "dovecot-uidlist" instead of ".uidlist" because I
finally realized that files beginning with dot conflict with the mailbox
namespace. I should rename .customflags and .subscriptions files as
well. Also if I move .imap.index* files into root dir, I'll have to
rename them too.

new/ directory is now scanned every time to see if there's new mail.
cur/ directory is scanned if index file's timestamp differs from cur/
dir's timestamp. uidlist file is reread if it's device/inode changes.

You can get the sources from either CVS, or 0.99.9-test2 from
http://dovecot.procontrol.fi/test/

From fuyuki@hadaly.org  Thu Apr 10 10:14:28 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 10 Apr 2003 10:14:28 +0300 (EEST)
Return-Path: <fuyuki@hadaly.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from t-mta8.odn.ne.jp (mfep8.odn.ne.jp [143.90.131.186])
	by danu.procontrol.fi (Postfix) with ESMTP id A23B323845
	for <dovecot@procontrol.fi>; Thu, 10 Apr 2003 10:14:27 +0300 (EEST)
Received: from hadaly.dyndns.org ([218.46.133.203]) by t-mta8.odn.ne.jp
          with ESMTP
          id <20030410071425471.BCIO.28772.t-mta8.odn.ne.jp@mta8.odn.ne.jp>
          for <dovecot@procontrol.fi>; Thu, 10 Apr 2003 16:14:25 +0900
Received: from hadaly.dyndns.org (localhost [127.0.0.1])
	by hadaly.dyndns.org (Postfix) with ESMTP id DF3CA210F
	for <dovecot@procontrol.fi>; Thu, 10 Apr 2003 16:14:24 +0900 (JST)
Date: Thu, 10 Apr 2003 16:14:24 +0900
Message-ID: <86znmyu8mn.wl%fuyuki@hadaly.org>
From: Kimura Fuyuki <fuyuki@hadaly.org>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Maildir syncing rewrite
In-Reply-To: <1049922194.25102.364.camel@hurina>
References: <1049922194.25102.364.camel@hurina>
User-Agent: Wanderlust/2.10.0 (Venus) Emacs/21.3 Mule/5.0 (SAKAKI)
X-Public-Key: http://www.hadaly.org/fuyuki/public.key
X-Fingerprint: 8D68 1138 1A85 8556 C6A9  274B 2C72 2E56 3AF7 3D89
MIME-Version: 1.0 (generated by SEMI 1.14.5 - "Awara-Onsen")
Content-Type: text/plain; charset=US-ASCII
X-archive-position: 545
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: fuyuki@hadaly.org
Precedence: bulk
X-list: dovecot
X-UID: 545                                                  
Status: O

At 10 Apr 2003 00:03:14 +0300,
Timo Sirainen <tss@iki.fi> wrote:
> 
> You can get the sources from either CVS, or 0.99.9-test2 from
> http://dovecot.procontrol.fi/test/

Wow, it's much faster! ...but sometimes it dies with the following
syslog message. (locking broken?)

Apr 10 15:58:53 hadaly imap(fuyuki): Corrupted index file /home/fuyuki/Maildir/.INBOX/.imap.index: index.next_uid (12797) > uidlist.
next_uid (12790)
Apr 10 15:58:53 hadaly dovecot: child 71956 (imap) killed with signal 11

I'm using flock for both dovecot and postfix, which is my local mail
delivery agent.

-- fuyuki

From jejc@free.fr  Thu Apr 10 14:00:36 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 10 Apr 2003 14:00:36 +0300 (EEST)
Return-Path: <jejc@free.fr>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from postfix4-1.free.fr (postfix4-1.free.fr [213.228.0.62])
	by danu.procontrol.fi (Postfix) with ESMTP id B4C8A23845
	for <dovecot@procontrol.fi>; Thu, 10 Apr 2003 14:00:36 +0300 (EEST)
Received: from free.fr (lns-p19-18-81-57-232-34.adsl.proxad.net [81.57.232.34])
	by postfix4-1.free.fr (Postfix) with ESMTP id 34F4A196D1
	for <dovecot@procontrol.fi>; Thu, 10 Apr 2003 13:00:36 +0200 (CEST)
Message-ID: <3E954E82.1030306@free.fr>
Date: Thu, 10 Apr 2003 12:59:14 +0200
From: Jej <jejc@free.fr>
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.4a) Gecko/20030401
X-Accept-Language: fr-fr, en, en-us
MIME-Version: 1.0
To: dovecot@procontrol.fi
Subject: [dovecot] dovecot and virtual users
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 546
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jejc@free.fr
Precedence: bulk
X-list: dovecot
X-UID: 546                                                  
Status: O



Hello,


I set up a virtual smtp with exim (mails stored in /var/virtual/{domain}/{user}, passwd in /etc/virtual/{domain}.passwd). I have a patched pop3 server to deal with these mail boxes.

Would it be possible to use dovecot as imap server, or (even better) for imap and pop3, with this virtual domain model ?

Thanks, read you.

-- jej


From tss@iki.fi  Thu Apr 10 21:46:21 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 10 Apr 2003 21:46:21 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 8A66923845
	for <dovecot@procontrol.fi>; Thu, 10 Apr 2003 21:46:21 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id B12CF5E017F5; Thu, 10 Apr 2003 21:46:20 +0300 (EEST)
Subject: [dovecot] Re: dovecot and virtual users
From: Timo Sirainen <tss@iki.fi>
To: Jej <jejc@free.fr>
Cc: dovecot@procontrol.fi
In-Reply-To: <3E954E82.1030306@free.fr>
References: <3E954E82.1030306@free.fr>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1050000380.25105.382.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.3 
Date: 10 Apr 2003 21:46:20 +0300
X-archive-position: 547
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 547                                                  
Status: O

On Thu, 2003-04-10 at 13:59, Jej wrote:
> Hello,
> 
> 
> I set up a virtual smtp with exim (mails stored in /var/virtual/{domain}/{user}, 

Well, I guess that's INBOX. You'll also need a directory to contain rest
of the IMAP folders. Something like this maybe:

default_mail_env = mbox:~/mail:INBOX=/var/virtual/%d/%n

or default_mail_env = mbox:/var/virtual/%d/%n-dirs/

> passwd in /etc/virtual/{domain}.passwd).

This isn't supported currently. You could use passwd-file, but you'll
have to list the users like "user@domain:...etc..."


From tss@iki.fi  Thu Apr 10 23:44:23 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 10 Apr 2003 23:44:23 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 99B7923845
	for <dovecot@procontrol.fi>; Thu, 10 Apr 2003 23:44:23 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 5A8685E017F5; Thu, 10 Apr 2003 23:44:23 +0300 (EEST)
Subject: [dovecot] Re: Maildir syncing rewrite
From: Timo Sirainen <tss@iki.fi>
To: Kimura Fuyuki <fuyuki@hadaly.org>
Cc: dovecot@procontrol.fi
In-Reply-To: <86znmyu8mn.wl%fuyuki@hadaly.org>
References: <1049922194.25102.364.camel@hurina>
	 <86znmyu8mn.wl%fuyuki@hadaly.org>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1050007463.25102.414.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.3 
Date: 10 Apr 2003 23:44:23 +0300
X-archive-position: 548
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 548                                                  
Status: O
Content-Length: 1254

On Thu, 2003-04-10 at 10:14, Kimura Fuyuki wrote:
> > You can get the sources from either CVS, or 0.99.9-test2 from
> > http://dovecot.procontrol.fi/test/
> 
> Wow, it's much faster! ...but sometimes it dies with the following
> syslog message. (locking broken?)

Faster? How large mailboxes or slow computer do you have? :) I don't
think I made it any faster, and I don't think it was slow before
either.. It took more memory though.

> Apr 10 15:58:53 hadaly imap(fuyuki): Corrupted index file /home/fuyuki/Maildir/.INBOX/.imap.index: index.next_uid (12797) > uidlist.
> next_uid (12790)
> Apr 10 15:58:53 hadaly dovecot: child 71956 (imap) killed with signal 11
> 
> I'm using flock for both dovecot and postfix, which is my local mail
> delivery agent.

flock? With maildir? There's no locks with maildir, except for
uidlist.lock file which relies on O_EXCL working for open(). Indexes and
others are locked with fcntl(), unless you've directly changed that from
sources.

But I'm not really sure why the above happens.. Even the crash shouldn't
happen if the corruption happens (I forced corruption, worked fine). It
would help if you could get gdb backtrace, core dumps can be enabled by
setting "mail_drop_priv_before_exec = yes" in config file.


From dovecot@andreas.hanssen.name  Fri Apr 11 00:01:42 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 11 Apr 2003 00:01:42 +0300 (EEST)
Return-Path: <dovecot@andreas.hanssen.name>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from lexx.infeline.org (unknown [217.144.230.27])
	by danu.procontrol.fi (Postfix) with SMTP id D0E1A23845
	for <dovecot@procontrol.fi>; Fri, 11 Apr 2003 00:01:41 +0300 (EEST)
Received: (qmail 26265 invoked from network); 10 Apr 2003 21:01:40 -0000
Received: from localhost (HELO lexx.infeline.org) (andreaha@127.0.0.1)
  by localhost with SMTP; 10 Apr 2003 21:01:40 -0000
Date: Thu, 10 Apr 2003 23:01:40 +0200 (CEST)
From: Andreas Aardal Hanssen <dovecot@andreas.hanssen.name>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Maildir syncing rewrite
In-Reply-To: <1050007463.25102.414.camel@hurina>
Message-ID: <Pine.LNX.4.44.0304102300380.26185-100000@lexx.infeline.org>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 549
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: dovecot@andreas.hanssen.name
Precedence: bulk
X-list: dovecot
X-UID: 549                                                  
Status: O

On 10 Apr 2003, Timo Sirainen wrote:
>On Thu, 2003-04-10 at 10:14, Kimura Fuyuki wrote:
>> > You can get the sources from either CVS, or 0.99.9-test2 from
>> > http://dovecot.procontrol.fi/test/
>> I'm using flock for both dovecot and postfix, which is my local mail
>> delivery agent.
>flock? With maildir? There's no locks with maildir, except for
>uidlist.lock file which relies on O_EXCL working for open(). Indexes and
>others are locked with fcntl(), unless you've directly changed that from
>sources.

For the record, is out-of-the-box Dovecot+Maildir with indexes NFS-safe?

Andy

-- 
Andreas Aardal Hanssen | http://www.andreas.hanssen.name/gpg
Author of Binc IMAP    | Nil desperandum


From mem@mv.mv.com  Fri Apr 11 00:41:19 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 11 Apr 2003 00:41:19 +0300 (EEST)
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id DD22B23860
	for <dovecot@procontrol.fi>; Fri, 11 Apr 2003 00:41:17 +0300 (EEST)
Received: (qmail 19229 invoked by uid 101); 10 Apr 2003 17:41:13 -0400
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Thu, 10 Apr 2003 17:41:13 -0400
To: dovecot@procontrol.fi
Subject: [dovecot] compilation errors
Message-ID: <20030410214113.GQ12480@iridium.mv.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.4.1i
X-archive-position: 550
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mem@mv.mv.com
Precedence: bulk
X-list: dovecot
X-UID: 550                                                  
Status: O
Content-Length: 1032

Hi-

I always encounter the same two minor compilation issues which are
easily addressed simply by a quick edit, but this time I figured I'd
mention it in case you can work around it.

This is on a BSD/OS 4.2 system.

First, the generated config.h always creates a definition
for OFF_T_MAX which conflicts with the one in the system's
limits.h

config.h defines:

#define OFF_T_MAX LLONG_MAX

whereas /usr/include/machine/limits.h defines:

#define OFF_T_MAX       UQUAD_MAX       /* max value for an off_t */


I simply comment out the definition from config.h .


Second, in src/lib/mmap-anon.c there's a preprocessor conditional:

#if SSIZE_T_MAX >= LLONG_MAX
  (etc)

Unfortunately /usr/include/machine/limits.h defines LLONG_MAX thusly:

#define LLONG_MAX       (__extension__(9223372036854775807LL))

(evidently to suppress pedantic warnings about the gcc long long
constant extension) but the cpp prepreprocessor stumbles over this
comparison.  This might be fixed in a later gcc, I dunno- it's gcc
2.95.2 here.

Yours,
-mm-

From tss@iki.fi  Fri Apr 11 00:59:02 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 11 Apr 2003 00:59:02 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 766A023860
	for <dovecot@procontrol.fi>; Fri, 11 Apr 2003 00:59:02 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 468C05E017F5; Fri, 11 Apr 2003 00:59:02 +0300 (EEST)
Subject: [dovecot] Re: Maildir syncing rewrite
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.44.0304102300380.26185-100000@lexx.infeline.org>
References: <Pine.LNX.4.44.0304102300380.26185-100000@lexx.infeline.org>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1050011941.25105.425.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.3 
Date: 11 Apr 2003 00:59:02 +0300
X-archive-position: 551
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 551                                                  
Status: O

On Fri, 2003-04-11 at 00:01, Andreas Aardal Hanssen wrote:
> For the record, is out-of-the-box Dovecot+Maildir with indexes NFS-safe?

Index files will probably never be NFS-safe. They can be built into
memory which should be quite close to how other IMAP servers work, but I
don't think I'll do that by default.

Other than that, next release should be NFS-safe out of the box.


From mem@mv.mv.com  Fri Apr 11 02:31:05 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 11 Apr 2003 02:31:05 +0300 (EEST)
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id 17CDC23845
	for <dovecot@procontrol.fi>; Fri, 11 Apr 2003 02:31:05 +0300 (EEST)
Received: (qmail 10171 invoked by uid 101); 10 Apr 2003 19:31:04 -0400
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Thu, 10 Apr 2003 19:31:04 -0400
To: dovecot@procontrol.fi
Subject: [dovecot] dovecot-0.99.9-test2 probs
Message-ID: <20030410233104.GF12480@iridium.mv.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.4.1i
X-archive-position: 552
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mem@mv.mv.com
Precedence: bulk
X-list: dovecot
X-UID: 552                                                  
Status: O
Content-Length: 1396

Hi-

Tried 0.99.9-test2 -- had to go back.

Various problems in the log.  

Here's one:

Apr 10 08:56:25 mercury mem[10754]: imap(user0): msync() failed with
index data file /users/8b/user0/Maildir/.INBOX/.imap.index.data:
Cannot allocate memory

Apr 10 08:56:25 mercury mem[10754]: imap(user0): Corrupted index
data file /users/8b/user0/Maildir/.INBOX/.imap.index.data: Missing
location field for record 156

Apr 10 08:56:25 mercury mem[10754]: imap(user0): msync() failed with
index data file /users/8b/user0/Maildir/.INBOX/.imap.index.data:
Cannot allocate memory


Here's another:

Apr 10 18:56:59 mercury mem[13376]: pop3(user1): Corrupted index file
/users/30/user1/Maildir/.INBOX/.imap.index: index.next_uid (2365) >
uidlist.next_uid (2364)


And another:

Apr 10 19:09:24 mercury mem[10892]: pop3(user2): Corrupted index file
/users/39/user2/Maildir/.INBOX/.imap.index: index.next_uid (10422) >
uidlist.next_uid (10420)

Apr 10 19:09:24 mercury mem[10892]: pop3(user2):  Corrupted index file
(in-memory index for /users/39/user2/Maildir): Filename mismatch for UID 1:
1050015983.28176.mercury.mv.net vs 1046192106.460.mercury.mv.net

Apr 10 19:09:24 mercury mem[10892]:  pop3(user2): No INBOX for user


And a ton of these, without any other entry for the process ID
(which I assume is the number after "child"):

Apr 10 19:09:33 mercury dovecot: child 1645 (imap) killed with signal 11


From fuyuki@hadaly.org  Fri Apr 11 02:44:46 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 11 Apr 2003 02:44:46 +0300 (EEST)
Return-Path: <fuyuki@hadaly.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from t-mta3.odn.ne.jp (mfep3.odn.ne.jp [143.90.131.181])
	by danu.procontrol.fi (Postfix) with ESMTP id A5A6423860
	for <dovecot@procontrol.fi>; Fri, 11 Apr 2003 02:44:45 +0300 (EEST)
Received: from hadaly.dyndns.org ([218.46.140.75]) by t-mta3.odn.ne.jp
          with ESMTP
          id <20030410234443726.HGNJ.26423.t-mta3.odn.ne.jp@mta3.odn.ne.jp>
          for <dovecot@procontrol.fi>; Fri, 11 Apr 2003 08:44:43 +0900
Received: from hadaly.dyndns.org (localhost [127.0.0.1])
	by hadaly.dyndns.org (Postfix) with ESMTP id 9E66C2116
	for <dovecot@procontrol.fi>; Fri, 11 Apr 2003 08:44:41 +0900 (JST)
Date: Fri, 11 Apr 2003 08:44:41 +0900
Message-ID: <86u1d5sys6.wl%fuyuki@hadaly.org>
From: Kimura Fuyuki <fuyuki@hadaly.org>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Maildir syncing rewrite
In-Reply-To: <1050007463.25102.414.camel@hurina>
References: <1049922194.25102.364.camel@hurina>	<86znmyu8mn.wl%fuyuki@hadaly.org>	<1050007463.25102.414.camel@hurina>
User-Agent: Wanderlust/2.10.0 (Venus) Emacs/21.3 Mule/5.0 (SAKAKI)
X-Public-Key: http://www.hadaly.org/fuyuki/public.key
X-Fingerprint: 8D68 1138 1A85 8556 C6A9  274B 2C72 2E56 3AF7 3D89
MIME-Version: 1.0 (generated by SEMI 1.14.5 - "Awara-Onsen")
Content-Type: text/plain; charset=US-ASCII
X-archive-position: 553
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: fuyuki@hadaly.org
Precedence: bulk
X-list: dovecot
X-UID: 553                                                  
Status: O
Content-Length: 1153

At 10 Apr 2003 23:44:23 +0300,
Timo Sirainen <tss@iki.fi> wrote:
> 
> Faster? How large mailboxes or slow computer do you have? :) I don't
> think I made it any faster, and I don't think it was slow before
> either.. It took more memory though.

Yes, I'm surprised too. I have no idea how it could be done, but it's
really faster. (why??)

This is my slow computer. :)

OS:	FreeBSD 5.0
CPU:	K6-2 400MHz
MUA:	Wanderlust 2.10.0

And some mailboxes have 1000+ mails.

> But I'm not really sure why the above happens.. Even the crash shouldn't
> happen if the corruption happens (I forced corruption, worked fine). It
> would help if you could get gdb backtrace, core dumps can be enabled by
> setting "mail_drop_priv_before_exec = yes" in config file.

OK, I'll try it if I have time, but I suspect the mount option -o
noatime would be the source of the problem... (I've dropped the
option.)

BTW, Here's another ominous message.

Apr 11 08:12:08 hadaly imap(fuyuki): Corrupted index file (in-memory index for /home/fuyuki/Maildir): Filename mismatch for UID 1: 1050013385.V40dI4d173.hadaly.dyndns.org vs 1049984584.V40dI4d1f8.hadaly.dyndns.org

-- fuyuki

From juha.o.ylitalo@nokia.com  Fri Apr 11 09:41:10 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 11 Apr 2003 09:41:10 +0300 (EEST)
Return-Path: <juha.o.ylitalo@nokia.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mgw-x4.nokia.com (mgw-x4.nokia.com [131.228.20.27])
	by danu.procontrol.fi (Postfix) with ESMTP id 0043523860
	for <dovecot@procontrol.fi>; Fri, 11 Apr 2003 09:41:09 +0300 (EEST)
Received: from esvir03nok.nokia.com (esvir03nokt.ntc.nokia.com [172.21.143.35])
	by mgw-x4.nokia.com (Switch-2.2.6/Switch-2.2.6) with ESMTP id h3B6f7h24125
	for <dovecot@procontrol.fi>; Fri, 11 Apr 2003 09:41:07 +0300 (EET DST)
Received: from esebh003.NOE.Nokia.com (unverified) by esvir03nok.nokia.com
 (Content Technologies SMTPRS 4.2.5) with ESMTP id <T61888245d0ac158f2303a@esvir03nok.nokia.com> for <dovecot@procontrol.fi>;
 Fri, 11 Apr 2003 09:41:06 +0300
Received: from jylitlap.lnx.nokia.com ([172.21.200.174]) by esebh003.NOE.Nokia.com with Microsoft SMTPSVC(5.0.2195.6139);
	 Fri, 11 Apr 2003 09:41:06 +0300
Received: (from jylitalo@localhost)
	by jylitlap.lnx.nokia.com (8.11.6/8.11.6) id h3B6f6k06133;
	Fri, 11 Apr 2003 09:41:06 +0300
X-Authentication-Warning: jylitlap.lnx.nokia.com: jylitalo set sender to juha.o.ylitalo@nokia.com using -f
Subject: [dovecot] Something wrong in SSL ?
From: Juha Ylitalo <juha.o.ylitalo@nokia.com>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
X-Mailer: Ximian Evolution 1.0.8 (1.0.8-9.7x.1) 
Date: 11 Apr 2003 09:41:06 +0300
Message-Id: <1050043266.5741.18.camel@jylitlap.lnx.nokia.com>
Mime-Version: 1.0
X-OriginalArrivalTime: 11 Apr 2003 06:41:06.0600 (UTC) FILETIME=[5449FA80:01C2FFF5]
X-archive-position: 554
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: juha.o.ylitalo@nokia.com
Precedence: bulk
X-list: dovecot
X-UID: 554                                                  
Status: O
Content-Length: 2062

Operating system: FreeBSD 4.7-RELEASE-p10
Dovecot: 0.99.8.1

I've used openssl to generate personal CA and I've used that one to
generate certificate for my web server. When I tried to go through same
pattern for generating certificate for IMAP server from CA, I ended up
in situation, where both mutt and evolution keep on rejecting my
certificates. 
From mutt's documentation, I was able to find helpful documentation for
checking IMAP connection. Based on that experimentation, it seems that
when I try to verify certificate files with openssl, all checks out, but
when I try to check thing through IMAPS, things go ugly (see log below).

If I try same openssl s_client command on my web server, it gets
everything correctly. As result from this one, I've even tried to use
certificate from my web server with IMAP and even then openssl keeps on
saying that there is bad record mac.

Is this bug in dovecot's SSL handling or have I managed to mess
something in my setup?

URLS:
CA cert: http://jylitalo.homeip.net/ca/ca.crt
IMAPD cert: http://jylitalo.homeip.net/ca/imapd.crt

[log starts]
bash-2.05a$ openssl verify -CAfile /usr/local/www/data/ca/ca.crt
/etc/ssl/certs/imapd.crt
/etc/ssl/certs/imapd.crt: OK
bash-2.05a$ openssl s_client -host localhost -port 993 -CAfile
/usr/local/www/data/ca/ca.crt -verify -debug                  
verify depth is 0
CONNECTED(00000003)
depth=1 /C=FI/ST=Finland/L=Helsinki/O=Juha Ylitalo/CN=Juha
Ylitalo/Email=jylitalo@iki.fi
verify return:1
depth=0 /C=FI/ST=Finland/O=Juha
Ylitalo/CN=coat.st-paul/Email=jylitalo@iki.fi
verify return:1
47169:error:140943FC:SSL routines:SSL3_READ_BYTES:sslv3 alert bad record
mac:/usr/src/secure/lib/libssl/../../../crypto/openssl/crypto/../ssl/s3_pkt.c:1046:SSL alert number 20
47169:error:140790E5:SSL routines:SSL23_WRITE:ssl handshake
failure:/usr/src/secure/lib/libssl/../../../crypto/openssl/crypto/../ssl/s23_lib.c:226:
bash-2.05a$ 
[log ends]

-- 
Juha Ylitalo       juha.o.ylitalo@nokia.com           <work e-mail>
+358 40 562 6152   http://linux.nokia.com/~jylitalo/  <work www>


From maikel@ladot.com  Fri Apr 11 13:59:32 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 11 Apr 2003 13:59:32 +0300 (EEST)
Return-Path: <maikel@ladot.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from nlladot05.freehosting (unknown [217.22.64.136])
	by danu.procontrol.fi (Postfix) with ESMTP id 53E2423845
	for <dovecot@procontrol.fi>; Fri, 11 Apr 2003 13:59:32 +0300 (EEST)
Received: by nlladot05.intern.ladot.com with Internet Mail Service (5.5.2653.19)
	id <2STP9K3P>; Fri, 11 Apr 2003 12:44:53 +0200
Message-ID: <410777FC7A66D511911500B0D0783455024C4FC9@nlladot05.intern.ladot.com>
From: Maikel Verheijen <maikel@ladot.com>
To: "Dovecot (E-mail)" <dovecot@procontrol.fi>
Subject: [dovecot] Maildir problem?
Date: Fri, 11 Apr 2003 12:44:44 +0200
MIME-Version: 1.0
X-Mailer: Internet Mail Service (5.5.2653.19)
Content-Type: multipart/alternative;
	boundary="----_=_NextPart_001_01C30017.5D379F40"
X-archive-position: 555
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: maikel@ladot.com
Precedence: bulk
X-list: dovecot
X-UID: 555                                                  
Status: O
Content-Length: 2250

This message is in MIME format. Since your mail reader does not understand
this format, some or all of this message may not be legible.

------_=_NextPart_001_01C30017.5D379F40
Content-Type: text/plain

Hey list,

Today I cvs updated to the most recent dovecot, to test with the recent
improvements on the dovecot-uidlist file, and came acros the following:

Apr 11 12:49:36 pc-5-046 imap(): Corrupted index file (in-memory index for
/var/mail/mounted/test.com/maikel/Maildir//.Sent Items): Filename mismatch
for UID 1: 1050058115.P3401Q0M675362.pc-5-046.test.nl:2,S vs
1050057888.P3371Q0M138398.pc-5-046.test.nl

I am using a front-end back-end construction, But I am testing on the
backend only (non-nfs), because the subscriptions file isn't nfs safe yet.

shouldn't the uidl files be leading over the indexes? And shouldn't the
indexes be updated as well?

Thank you,


Maikel Verheijen.


------_=_NextPart_001_01C30017.5D379F40
Content-Type: text/html
Content-Transfer-Encoding: quoted-printable

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV=3D"Content-Type" CONTENT=3D"text/html; =
charset=3Dus-ascii">
<META NAME=3D"Generator" CONTENT=3D"MS Exchange Server version =
5.5.2653.12">
<TITLE>Maildir problem?</TITLE>
</HEAD>
<BODY>

<P><FONT SIZE=3D2>Hey list,</FONT>
</P>

<P><FONT SIZE=3D2>Today I cvs updated to the most recent dovecot, to =
test with the recent improvements on the dovecot-uidlist file, and came =
acros the following:</FONT></P>

<P><FONT SIZE=3D2>Apr 11 12:49:36 pc-5-046 imap(): Corrupted index file =
(in-memory index for /var/mail/mounted/test.com/maikel/Maildir//.Sent =
Items): Filename mismatch for UID 1: =
1050058115.P3401Q0M675362.pc-5-046.test.nl:2,S vs =
1050057888.P3371Q0M138398.pc-5-046.test.nl</FONT></P>

<P><FONT SIZE=3D2>I am using a front-end back-end construction, But I =
am testing on the backend only (non-nfs), because the subscriptions =
file isn't nfs safe yet.</FONT></P>

<P><FONT SIZE=3D2>shouldn't the uidl files be leading over the indexes? =
And shouldn't the indexes be updated as well?</FONT>
</P>

<P><FONT SIZE=3D2>Thank you,</FONT>
</P>
<BR>

<P><FONT SIZE=3D2>Maikel Verheijen.</FONT>
</P>

</BODY>
</HTML>
------_=_NextPart_001_01C30017.5D379F40--

From tss@iki.fi  Sat Apr 12 18:04:32 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 12 Apr 2003 18:04:32 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id CB60423845
	for <dovecot@procontrol.fi>; Sat, 12 Apr 2003 18:04:32 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 7FE9A5E017F5; Sat, 12 Apr 2003 18:04:32 +0300 (EEST)
Subject: [dovecot] 0.99.9-test3
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1050159872.25107.483.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.3 
Date: 12 Apr 2003 18:04:32 +0300
X-archive-position: 556
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 556                                                  
Status: O

Expunging messages caused those "Corrupted index file" errors. That's
fixed now. There's probably still some problems, at least this fix
didn't fix any crashes..

test3 available from http://dovecot.procontrol.fi/test/


From tss@iki.fi  Sat Apr 12 18:14:54 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 12 Apr 2003 18:14:54 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 1B53623845
	for <dovecot@procontrol.fi>; Sat, 12 Apr 2003 18:14:54 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id DD0E35E017F5; Sat, 12 Apr 2003 18:14:53 +0300 (EEST)
Subject: [dovecot] Re: Something wrong in SSL ?
From: Timo Sirainen <tss@iki.fi>
To: Juha Ylitalo <juha.o.ylitalo@nokia.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <1050043266.5741.18.camel@jylitlap.lnx.nokia.com>
References: <1050043266.5741.18.camel@jylitlap.lnx.nokia.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1050160493.25107.493.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.3 
Date: 12 Apr 2003 18:14:53 +0300
X-archive-position: 557
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 557                                                  
Status: O

On Fri, 2003-04-11 at 09:41, Juha Ylitalo wrote:
> If I try same openssl s_client command on my web server, it gets
> everything correctly. As result from this one, I've even tried to use
> certificate from my web server with IMAP and even then openssl keeps on
> saying that there is bad record mac.
> 
> Is this bug in dovecot's SSL handling or have I managed to mess
> something in my setup?

Did you compile Dovecot with GNUTLS or OpenSSL? If GNUTLS, maybe there's
some problems with it. If OpenSSL .. well, I don't know really. I don't
have any problems with mutt, Evolution, Outlook or OE at least.


From eskimoe@ananzi.co.za  Sun Apr 13 19:19:33 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 13 Apr 2003 19:19:33 +0300 (EEST)
Return-Path: <eskimoe@ananzi.co.za>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from sun.com (port-212-202-171-244.reverse.qdsl-home.de [212.202.171.244])
	by danu.procontrol.fi (Postfix) with SMTP id 9BC6D23860
	for <dovecot@procontrol.fi>; Sun, 13 Apr 2003 19:19:32 +0300 (EEST)
Received: (qmail 923 invoked by uid 1000); 13 Apr 2003 16:20:53 -0000
Date: Sun, 13 Apr 2003 18:20:53 +0200
From: Moe Wibble <eskimoe@ananzi.co.za>
To: dovecot@procontrol.fi
Subject: [dovecot] a crashy message
Message-ID: <20030413162053.GA23316@woom.net>
Mail-Followup-To: Moe Wibble <eskimoe@ananzi.co.za>,
	dovecot@procontrol.fi
Mime-Version: 1.0
Content-Type: multipart/mixed; boundary="2fHTh5uZTiUOsy+g"
Content-Disposition: inline
X-archive-position: 558
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: eskimoe@ananzi.co.za
Precedence: bulk
X-list: dovecot
X-UID: 558                                                  
Status: O


--2fHTh5uZTiUOsy+g
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline

Hi everyone,

the attached message does reliably crash my dovecot when trying
to access a folder containing it.

Crash notice in mail.log:
Apr 13 17:36:12 rafter dovecot: child 23215 (imap) killed with signal 11

My `dovecot --version` says:
0.99.8

Has this problem been fixed in current dovecot?
For now I have just quarantined the offending message but obviously
I need to upgrade my dovecot soon because I don't like such kinda
things to happen.


best regards!
-- 
MW


--2fHTh5uZTiUOsy+g
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename="msg.yBEI"

From owner-ion@list.rt.fm Sun Apr 13 09:32:26 2003
Return-Path: <owner-ion@list.rt.fm>
Delivered-To: moe@localhost
Received: (qmail 31185 invoked from network); 13 Apr 2003 09:32:25 -0000
Received: from unknown (HELO localhost) (127.0.0.1)
  by localhost with SMTP; 13 Apr 2003 09:32:25 -0000
Received: from ananzi.mailgate.net [196.38.110.7]
	by localhost with POP3 (fetchmail-5.9.11)
	for moe@localhost (single-drop); Sun, 13 Apr 2003 11:32:25 +0200 (CEST)
Received: from rt.fm ([209.242.32.10] verified)
  by mail01.infosat.net (CommuniGate Pro SMTP 3.5.9)
  with ESMTP id 73760636 for eskimoe@ananzi.co.za; Sun, 13 Apr 2003 11:30:19 +0200
Received: by rt.fm (Postfix)
	id E9241436D; Sun, 13 Apr 2003 04:30:13 -0500 (CDT)
Delivered-To: ion-outgoing@rt.fm
Received: by rt.fm (Postfix, from userid 1013)
	id E71EE4367; Sun, 13 Apr 2003 04:30:13 -0500 (CDT)
X-Original-To: ion@list.rt.fm
Delivered-To: ion@list.rt.fm
Received: from tiger (c213-89-140-172.cm-upc.chello.se [213.89.140.172])
	by rt.fm (Postfix) with ESMTP id 6737D4360
	for <ion@list.rt.fm>; Sun, 13 Apr 2003 04:30:13 -0500 (CDT)
Received: from pelle by tiger with local (Exim 3.36 #1 (Debian))
	id 194dns-000093-00
	for <ion@list.rt.fm>; Sun, 13 Apr 2003 11:29:36 +0200
To: ion@list.rt.fm
Subject: [Daniel Silverstone <dsilvers@digital-scurf.org>] Re: lua 5.0
From: Per Olofsson <pelle@dsv.su.se>
Date: Sun, 13 Apr 2003 11:29:35 +0200
Message-ID: <87ptnqrbi8.fsf@dsv.su.se>
User-Agent: Gnus/5.090016 (Oort Gnus v0.16) Emacs/21.2 (gnu/linux)
MIME-Version: 1.0
Content-Type: multipart/mixed; boundary="=-=-="
Sender: owner-ion@list.rt.fm
Precedence: bulk
List-Post: <mailto:ion@list.rt.fm>
X-UID: 559                                                  
Status: O
Content-Length: 2935

--=-=-=

FYI.

/Pelle


--=-=-=
Content-Type: message/rfc822
Content-Disposition: inline

Received: from av-in1.su.se (av-in1.su.se [130.237.162.111])
	by unni.dsv.su.se (8.9.3/8.9.3) with ESMTP
	id SAA22051 for <pelle@dsv.su.se>;
	Sat, 12 Apr 2003 18:50:48 +0200 (MET DST)
Received: from localhost (av-in1.su.se [127.0.0.1])
	by av-in1.su.se (Postfix) with ESMTP id 8C8F41002A4
	for <pelle@dsv.su.se>; Sat, 12 Apr 2003 18:50:48 +0200 (CEST)
Received: from av-in1.su.se ([127.0.0.1])
 by localhost (av-in1.su.se [127.0.0.1:10024]) (amavisd-new) with ESMTP
 id 14463-13 for <pelle@dsv.su.se>; Sat, 12 Apr 2003 18:50:48 +0200 (CEST)
Received: from mx1.su.se (mx1.su.se [130.237.162.110])
	by av-in1.su.se (Postfix) with ESMTP id 2C410100033
	for <pelle@dsv.su.se>; Sat, 12 Apr 2003 18:50:48 +0200 (CEST)
Received: from anchor-post-34.mail.demon.net (anchor-post-34.mail.demon.net
 [194.217.242.92])
	by mx1.su.se (Postfix) with ESMTP id 021B534012
	for <pelle@dsv.su.se>; Sat, 12 Apr 2003 18:50:48 +0200 (CEST)
Received: from digital-scurf.demon.co.uk ([212.229.183.176]
 helo=ennui.i.digital-scurf.org)
	by anchor-post-34.mail.demon.net with esmtp (Exim 3.35 #1)
	id 194ODF-0005FS-0Y
	for pelle@dsv.su.se; Sat, 12 Apr 2003 17:50:45 +0100
Received: from dsilvers by ennui.i.digital-scurf.org with local (Exim 3.36
 #1 (Debian))
	id 194ODF-0002dE-00
	for <pelle@dsv.su.se>; Sat, 12 Apr 2003 17:50:45 +0100
Date: Sat, 12 Apr 2003 17:50:44 +0100
To: Per Olofsson <pelle@dsv.su.se>
Subject: Re: lua 5.0
Message-ID: <20030412165044.GD10058@digital-scurf.org>
References: <878yukyffb.fsf@dsv.su.se>
In-Reply-To: <878yukyffb.fsf@dsv.su.se>
User-Agent: Mutt/1.4i
From: Daniel Silverstone <dsilvers@digital-scurf.org>
X-Spam-Status: No, hits=-38.0 tagged_above=-99.0 required=7.0
 tests=BAYES_10,
 EMAIL_ATTRIBUTION, IN_REP_TO, QUOTED_EMAIL_TEXT, REFERENCES,
 REPLY_WITH_QUOTES, USER_AGENT_MUTT
X-Spam-Level: 
MIME-Version: 1.0

On Tue, Apr 08, 2003 at 09:09:28PM +0200, Per Olofsson wrote:
> I wonder if you're going to package lua 5.0 anytime soon. The new
> upstream version of my package (ion-devel) needs it. If you don't want
> to package it that's okay, I can package it myself if I have to.

Hi,

I was on holiday for a week, but as you can imagine, I have plans to
package Lua 5.0 for Debian.

I'm working with the Lua development team to discuss how to best package
Lua 5.0 for Debian, since we only want first-class packages. I expect
we'll be seeing packages (in pretty much the same configuration as for
lua 4.0) within a few weeks now.

Keep an eye out on debian-devel for any messages I post about it.

D.

-- 
Daniel Silverstone                               http://www.digital-scurf.org/
Hostmaster, Webmaster, and Chief Code Wibbler          Digital-Scurf Unlimited
GPG Public key available from keyring.debian.org               KeyId: 20687895
You will gain money by a speculation or lottery.

--=-=-=--


--2fHTh5uZTiUOsy+g--

From warren@togami.com  Mon Apr 14 04:42:27 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 14 Apr 2003 04:42:27 +0300 (EEST)
Return-Path: <warren@togami.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from hnlmail2.hawaii.rr.com (hnlmail2.hawaii.rr.com [24.25.227.35])
	by danu.procontrol.fi (Postfix) with ESMTP id EAC1723896
	for <dovecot@procontrol.fi>; Mon, 14 Apr 2003 04:42:26 +0300 (EEST)
Received: (apparently) from localhost.127.in-addr.arpa ([204.210.124.92]) by hnlmail2.hawaii.rr.com  with Microsoft SMTPSVC(5.5.1877.757.75);
	 Sun, 13 Apr 2003 15:42:21 -1000
Subject: [dovecot] dovecot RPM for Red Hat Linux
From: Warren Togami <warren@togami.com>
To: dovecot@procontrol.fi
Content-Type: text/plain
Organization: 
Message-Id: <1050284521.30823.13.camel@laptop>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 (1.2.2-5) 
Date: 13 Apr 2003 15:42:01 -1000
Content-Transfer-Encoding: 7bit
X-archive-position: 559
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: warren@togami.com
Precedence: bulk
X-list: dovecot
X-UID: 560                                                  
Status: O
Content-Length: 1070

http://bugzilla.fedora.us/show_bug.cgi?id=160

This .src.rpm is dovecot with RH-specific default settings.  I modified
Jeremy Katz' dovecot-0.99.8.1 package a bit.  When I upgraded from
0.99.8.1 it seemed to be broken until I looked at /var/log/maillog. 
There it indicated that the dovecot cache files were bad, so I erased
/home/*/mail/.imap/ and it seemed to work subsequently.

There are a few more RH specific tweaks that I plan on doing for this
package.  If you have any suggestions to default config tweaks for this
package please reply or post in that bugzilla entry above.  I would like
for this package to be a drop-in replacement for RHL's uw-imapd
eventually, but there are a number of migration issues that need to be
addressed first.  This package will eventually be included in the Fedora
tree after it goes through our QA.

http://www.fedora.us
Fedora Linux is a project of volunteer package developers making 3rd
party packages specifically for Red Hat Linux.

Warren Togami
warren@togami.com

p.s.
Keep up the good work.  I absolutely love dovecot!



From juha.o.ylitalo@nokia.com  Mon Apr 14 08:56:07 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 14 Apr 2003 08:56:07 +0300 (EEST)
Return-Path: <juha.o.ylitalo@nokia.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mgw-x4.nokia.com (mgw-x4.nokia.com [131.228.20.27])
	by danu.procontrol.fi (Postfix) with ESMTP id 1AA5023896
	for <dovecot@procontrol.fi>; Mon, 14 Apr 2003 08:56:07 +0300 (EEST)
Received: from esvir04nok.ntc.nokia.com (esvir04nokt.ntc.nokia.com [172.21.143.36])
	by mgw-x4.nokia.com (Switch-2.2.6/Switch-2.2.6) with ESMTP id h3E5u5H05015
	for <dovecot@procontrol.fi>; Mon, 14 Apr 2003 08:56:05 +0300 (EET DST)
Received: from esebh001.NOE.Nokia.com (unverified) by esvir04nok.ntc.nokia.com
 (Content Technologies SMTPRS 4.2.5) with ESMTP id <T6197cc228dac158f246f2@esvir04nok.ntc.nokia.com>;
 Mon, 14 Apr 2003 08:56:05 +0300
Received: from jylitlap.lnx.nokia.com ([172.21.200.174]) by esebh001.NOE.Nokia.com with Microsoft SMTPSVC(5.0.2195.6139);
	 Mon, 14 Apr 2003 08:56:04 +0300
Received: (from jylitalo@localhost)
	by jylitlap.lnx.nokia.com (8.11.6/8.11.6) id h3E5u4M18291;
	Mon, 14 Apr 2003 08:56:04 +0300
X-Authentication-Warning: jylitlap.lnx.nokia.com: jylitalo set sender to juha.o.ylitalo@nokia.com using -f
Subject: [dovecot] Re: Something wrong in SSL ?
From: Juha Ylitalo <juha.o.ylitalo@nokia.com>
To: ext Timo Sirainen <tss@iki.fi>
Cc: dovecot@procontrol.fi
In-Reply-To: <1050160493.25107.493.camel@hurina>
References: <1050043266.5741.18.camel@jylitlap.lnx.nokia.com> 
	<1050160493.25107.493.camel@hurina>
Content-Type: multipart/mixed; boundary="=-SBM1v00qdg3RjEobwu5S"
X-Mailer: Ximian Evolution 1.0.8 (1.0.8-9.7x.1) 
Date: 14 Apr 2003 08:56:04 +0300
Message-Id: <1050299764.18126.9.camel@jylitlap.lnx.nokia.com>
Mime-Version: 1.0
X-OriginalArrivalTime: 14 Apr 2003 05:56:04.0389 (UTC) FILETIME=[88E28D50:01C3024A]
X-archive-position: 560
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: juha.o.ylitalo@nokia.com
Precedence: bulk
X-list: dovecot
X-UID: 561                                                  
Status: O
Content-Length: 5949


--=-SBM1v00qdg3RjEobwu5S
Content-Type: text/plain
Content-Transfer-Encoding: 7bit

On Sat, 2003-04-12 at 18:14, ext Timo Sirainen wrote:
> On Fri, 2003-04-11 at 09:41, Juha Ylitalo wrote:
> > If I try same openssl s_client command on my web server, it gets
> > everything correctly. As result from this one, I've even tried to use
> > certificate from my web server with IMAP and even then openssl keeps on
> > saying that there is bad record mac.
> > 
> > Is this bug in dovecot's SSL handling or have I managed to mess
> > something in my setup?
> 
> Did you compile Dovecot with GNUTLS or OpenSSL? If GNUTLS, maybe there's
> some problems with it. If OpenSSL .. well, I don't know really. I don't
> have any problems with mutt, Evolution, Outlook or OE at least.

Its compiled with openssl, since that is default option for dovecot in
FreeBSD ports (and since openssl is pretty much in all Linux/BSD boxes
it would be silly to use something else on those).
Here is more concrete example on how things go wrong. This test is based
on instructions in http://mutt.sourceforge.net/imap/README.SSL and I
will first demonstrate how it works with Apache (which workds
beatifully) and then with imap (which doesn't work):
########
### WITH HTTPS
########
bash-2.05a$ openssl s_client -host localhost -port 443 -verify -debug
2>&1 > https.log
verify depth is 0
depth=0 /C=FI/ST=Finland/O=Juha Ylitalo/CN=jylitalo.homeip.net
verify error:num=20:unable to get local issuer certificate
verify return:1
depth=0 /C=FI/ST=Finland/O=Juha Ylitalo/CN=jylitalo.homeip.net
verify error:num=27:certificate not trusted
verify return:1
depth=0 /C=FI/ST=Finland/O=Juha Ylitalo/CN=jylitalo.homeip.net
verify error:num=21:unable to verify the first certificate
verify return:1
^]close
########
### WITH IMAPS
########
bash-2.05a$ openssl s_client -host localhost -port 993 -verify -debug
2>&1 > imaps.log
verify depth is 0
depth=0 /C=FI/ST=Finland/O=Juha Ylitalo/CN=jylitalo.homeip.net
verify error:num=20:unable to get local issuer certificate
verify return:1
depth=0 /C=FI/ST=Finland/O=Juha Ylitalo/CN=jylitalo.homeip.net
verify error:num=27:certificate not trusted
verify return:1
depth=0 /C=FI/ST=Finland/O=Juha Ylitalo/CN=jylitalo.homeip.net
verify error:num=21:unable to verify the first certificate
verify return:1
66460:error:140943FC:SSL routines:SSL3_READ_BYTES:sslv3 alert bad record
mac:/usr/src/secure/lib/libssl/../../../crypto/openssl/crypto/../ssl/s3_pkt.c:1046:SSL alert number 20
66460:error:140790E5:SSL routines:SSL23_WRITE:ssl handshake
failure:/usr/src/secure/lib/libssl/../../../crypto/openssl/crypto/../ssl/s23_lib.c:226:
bash-2.05a$ 

-- 
Juha Ylitalo       juha.o.ylitalo@nokia.com           <work e-mail>
+358 40 562 6152   http://linux.nokia.com/~jylitalo/  <work www>


--=-SBM1v00qdg3RjEobwu5S
Content-Disposition: attachment; filename=https.log
Content-Transfer-Encoding: quoted-printable
Content-Type: text/plain; name=https.log; charset=ISO-8859-1

CONNECTED(00000003)
---
Certificate chain
 0 s:/C=3DFI/ST=3DFinland/O=3DJuha Ylitalo/CN=3Djylitalo.homeip.net
   i:/C=3DFI/ST=3DFinland/L=3DHelsinki/O=3DJuha Ylitalo/CN=3DJuha Ylitalo/E=
mail=3Djylitalo@iki.fi
---
Server certificate
-----BEGIN CERTIFICATE-----
MIIEDzCCA7mgAwIBAgIBAjANBgkqhkiG9w0BAQQFADCBgDELMAkGA1UEBhMCRkkx
EDAOBgNVBAgTB0ZpbmxhbmQxETAPBgNVBAcTCEhlbHNpbmtpMRUwEwYDVQQKEwxK
dWhhIFlsaXRhbG8xFTATBgNVBAMTDEp1aGEgWWxpdGFsbzEeMBwGCSqGSIb3DQEJ
ARYPanlsaXRhbG9AaWtpLmZpMB4XDTAzMDMyNjIxNDA0OVoXDTA0MDMyNTIxNDA0
OVowVDELMAkGA1UEBhMCRkkxEDAOBgNVBAgTB0ZpbmxhbmQxFTATBgNVBAoTDEp1
aGEgWWxpdGFsbzEcMBoGA1UEAxMTanlsaXRhbG8uaG9tZWlwLm5ldDCBnzANBgkq
hkiG9w0BAQEFAAOBjQAwgYkCgYEAzpvc/kFQxlk6qjp5B+kTeoj2C5rQ13up7VF+
MCIUEVuro010m5W+rR/2chu2c05DkWATad1udBWss4kH57ac2jBEgc9Kvngkvy5m
YzZhyWt/xGaSdQcgoO7Uy8K0hYkTsUjyMw6OGo4KjhCIpI0vbrOtLQncSavLgTdl
4guupSsCAwEAAaOCAgMwggH/MAkGA1UdEwQCMAAwEQYJYIZIAYb4QgEBBAQDAgZA
MEAGCWCGSAGG+EIBDQQzFjFDZXJ0aWZpY2F0ZSBpc3N1ZWQgYnkgaHR0cDovL3d3
dy5pa2kuZmkvanlsaXRhbG8vMB0GA1UdDgQWBBQH1GMjDRQ/Rkns++h7NNmhubld
DjCBrQYDVR0jBIGlMIGigBT8l2HdIe3A4V8GM6o83EZ62vsHU6GBhqSBgzCBgDEL
MAkGA1UEBhMCRkkxEDAOBgNVBAgTB0ZpbmxhbmQxETAPBgNVBAcTCEhlbHNpbmtp
MRUwEwYDVQQKEwxKdWhhIFlsaXRhbG8xFTATBgNVBAMTDEp1aGEgWWxpdGFsbzEe
MBwGCSqGSIb3DQEJARYPanlsaXRhbG9AaWtpLmZpggEAMC4GCWCGSAGG+EIBAgQh
Fh9odHRwczovL2p5bGl0YWxvLmhvbWVpcC5uZXQvY2EvMDAGA1UdEgQpMCeGJWh0
dHBzOi8vanlsaXRhbG8uaG9tZWlwLm5ldC9jYS9jYS5jcnQwNgYDVR0fBC8wLTAr
oCmgJ4YlaHR0cHM6Ly9qeWxpdGFsby5ob21laXAubmV0L2NhL2NhLmNybDA0Bglg
hkgBhvhCAQQEJxYlaHR0cHM6Ly9qeWxpdGFsby5ob21laXAubmV0L2NhL2NhLmNy
bDANBgkqhkiG9w0BAQQFAANBAAlNhvDVOirSEtHiV8uRFfUdQnhCPjtk0Hm70sxE
gJzMke6ysra6BYrDL4mpMOS252U9JeqcGQyhqzlNHDXAV0M=3D
-----END CERTIFICATE-----
subject=3D/C=3DFI/ST=3DFinland/O=3DJuha Ylitalo/CN=3Djylitalo.homeip.net
issuer=3D/C=3DFI/ST=3DFinland/L=3DHelsinki/O=3DJuha Ylitalo/CN=3DJuha Ylita=
lo/Email=3Djylitalo@iki.fi
---
No client certificate CA names sent
---
SSL handshake has read 1599 bytes and written 314 bytes
---
New, TLSv1/SSLv3, Cipher is EDH-RSA-DES-CBC3-SHA
Server public key is 1024 bit
SSL-Session:
    Protocol  : TLSv1
    Cipher    : EDH-RSA-DES-CBC3-SHA
    Session-ID: 857DC023D37DF585E8E49EFA554634D68878AC3B776F43DFB3B9089DAB5=
8D026
    Session-ID-ctx:=20
    Master-Key: 1578B2EC2D10A14C074E9832CBEEFB92C2BFC9FC81E588889176AF89D46=
E1619F3592B02EA193CAC9AF0EEAFE6E112E9
    Key-Arg   : None
    Start Time: 1050299499
    Timeout   : 300 (sec)
    Verify return code: 21 (unable to verify the first certificate)
---
<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<HTML><HEAD>
<TITLE>501 Method Not Implemented</TITLE>
</HEAD><BODY>
<H1>Method Not Implemented</H1>
=1Dclose to /index.html not supported.<P>
Invalid method in request \x1dclose<P>
</BODY></HTML>
closed

--=-SBM1v00qdg3RjEobwu5S
Content-Disposition: attachment; filename=imaps.log
Content-Transfer-Encoding: quoted-printable
Content-Type: text/plain; name=imaps.log; charset=ISO-8859-1

CONNECTED(00000003)

--=-SBM1v00qdg3RjEobwu5S--

From warren@togami.com  Mon Apr 14 08:58:43 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 14 Apr 2003 08:58:43 +0300 (EEST)
Return-Path: <warren@togami.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from hnlmail3.hawaii.rr.com (hnlmail3.hawaii.rr.com [24.25.227.37])
	by danu.procontrol.fi (Postfix) with ESMTP id D6D9823896
	for <dovecot@procontrol.fi>; Mon, 14 Apr 2003 08:58:42 +0300 (EEST)
Received: (apparently) from localhost.127.in-addr.arpa ([204.210.124.92]) by hnlmail3.hawaii.rr.com  with Microsoft SMTPSVC(5.5.1877.757.75);
	 Sun, 13 Apr 2003 19:58:39 -1000
Subject: [dovecot] Re: dovecot RPM for Red Hat Linux
From: Warren Togami <warren@togami.com>
To: fedora-devel@fedora.us, dovecot@procontrol.fi
In-Reply-To: <1050284521.30823.13.camel@laptop>
References: <1050284521.30823.13.camel@laptop>
Content-Type: text/plain
Organization: 
Message-Id: <1050299914.32054.7.camel@laptop>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 (1.2.2-5) 
Date: 13 Apr 2003 19:58:34 -1000
Content-Transfer-Encoding: 7bit
X-archive-position: 561
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: warren@togami.com
Precedence: bulk
X-list: dovecot
X-UID: 562                                                  
Status: O
Content-Length: 2243

On Sun, 2003-04-13 at 15:42, Warren Togami wrote:
> http://bugzilla.fedora.us/show_bug.cgi?id=160
> 
> This .src.rpm is dovecot with RH-specific default settings.  I modified
> Jeremy Katz' dovecot-0.99.8.1 package a bit.

I ran into and fixed a few packaging problems listed below, but the last
two I'm not exactly sure how to fix.  Any suggestions?

One problem within /etc/init.d/dovecot
======================================
start() {
        # Check if pxe is already running
        if [ ! -f /var/lock/subsys/dovecot ]; then
            echo -n $"Starting $prog: "
            /usr/sbin/dovecot &
            [ -n "`pidofproc /usr/sbin/dovecot`" ] && success
            RETVAL=$?
            [ $RETVAL -eq 0 ] && touch /var/lock/subsys/dovecot
            echo
        fi
}

This line "/usr/sbin/dovecot &" executes in the background, but the next line "[
-n "`pidofproc /usr/sbin/dovecot`" ] && success" happens too soon, causing a non
zero return value and a FAILED message during bootup.  I confirmed this by
adding "sleep 5" between the two lines, giving it enough time to startup
completely before testing for the pid.  It no displays the fake FAILED message
during bootup.  What should be the proper fix for this?

RH init script problem
======================
Another problem happens during RH's init scripts after you reboot.  By default
dovecot uses /var/run/dovecot/login/ as a directory to create unix sockets for
login.  RH's init script displays an error messages when I tries to remove
/var/run/*/* files because it is a directory, not a file.  I changed dovecot's
default to /var/run/dovecot and it now avoids this error.

chkconfig problem
=================
[root@goku log]# chkconfig --list |grep dovecot
dovecot         0:off   1:off   2:off   3:off   4:off   5:off   6:off
[root@goku log]# chkconfig dovecot on
[root@goku log]# chkconfig --list |grep dovecot
dovecot         0:off   1:off   2:off   3:off   4:off   5:off   6:off
The init.d and rc.d stuff seems to have problems, I haven't analyzed this yet.

Service name problem
====================
During startup it says "5dovecot: Starting Dovecot Imap:"
I'm not sure why it says "5dovecot" rather than "dovecot".  Any ideas?

Warren Togami
warren@togami.com



From lfarkas@bnap.hu  Mon Apr 14 12:14:41 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 14 Apr 2003 12:14:41 +0300 (EEST)
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 5053523896
	for <dovecot@procontrol.fi>; Mon, 14 Apr 2003 12:14:41 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP
	id 14D45754024; Mon, 14 Apr 2003 11:14:58 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP
	id 921D83EFA; Mon, 14 Apr 2003 11:14:38 +0200 (CEST)
Received: from bnap.hu (garfield.int.bppiac.hu [192.168.0.50])
	by mail2.bppiac.hu (Postfix) with ESMTP
	id 41E403EF2; Mon, 14 Apr 2003 11:14:38 +0200 (CEST)
Message-ID: <3E9A7BFD.9050908@bnap.hu>
Date: Mon, 14 Apr 2003 11:14:37 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Warren Togami <warren@togami.com>,
	Dovecot List <dovecot@procontrol.fi>
Subject: [dovecot] Re: dovecot RPM for Red Hat Linux
References: <1050284521.30823.13.camel@laptop> <1050299914.32054.7.camel@laptop>
In-Reply-To: <1050299914.32054.7.camel@laptop>
Content-Type: multipart/mixed;
 boundary="------------080608090809030403070203"
X-archive-position: 562
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 563                                                  
Status: O
Content-Length: 8120

This is a multi-part message in MIME format.
--------------080608090809030403070203
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit

here is what we use to compile the cvs.

Warren Togami wrote:
> On Sun, 2003-04-13 at 15:42, Warren Togami wrote:
> 
>>http://bugzilla.fedora.us/show_bug.cgi?id=160
>>
>>This .src.rpm is dovecot with RH-specific default settings.  I modified
>>Jeremy Katz' dovecot-0.99.8.1 package a bit.
> 
> 
> I ran into and fixed a few packaging problems listed below, but the last
> two I'm not exactly sure how to fix.  Any suggestions?
> 
> One problem within /etc/init.d/dovecot
> ======================================
> start() {
>         # Check if pxe is already running
>         if [ ! -f /var/lock/subsys/dovecot ]; then
>             echo -n $"Starting $prog: "
>             /usr/sbin/dovecot &
>             [ -n "`pidofproc /usr/sbin/dovecot`" ] && success
>             RETVAL=$?
>             [ $RETVAL -eq 0 ] && touch /var/lock/subsys/dovecot
>             echo
>         fi
> }
> 
> This line "/usr/sbin/dovecot &" executes in the background, but the next line "[
> -n "`pidofproc /usr/sbin/dovecot`" ] && success" happens too soon, causing a non
> zero return value and a FAILED message during bootup.  I confirmed this by
> adding "sleep 5" between the two lines, giving it enough time to startup
> completely before testing for the pid.  It no displays the fake FAILED message
> during bootup.  What should be the proper fix for this?
> 
> RH init script problem
> ======================
> Another problem happens during RH's init scripts after you reboot.  By default
> dovecot uses /var/run/dovecot/login/ as a directory to create unix sockets for
> login.  RH's init script displays an error messages when I tries to remove
> /var/run/*/* files because it is a directory, not a file.  I changed dovecot's
> default to /var/run/dovecot and it now avoids this error.
> 
> chkconfig problem
> =================
> [root@goku log]# chkconfig --list |grep dovecot
> dovecot         0:off   1:off   2:off   3:off   4:off   5:off   6:off
> [root@goku log]# chkconfig dovecot on
> [root@goku log]# chkconfig --list |grep dovecot
> dovecot         0:off   1:off   2:off   3:off   4:off   5:off   6:off
> The init.d and rc.d stuff seems to have problems, I haven't analyzed this yet.
> 
> Service name problem
> ====================
> During startup it says "5dovecot: Starting Dovecot Imap:"
> I'm not sure why it says "5dovecot" rather than "dovecot".  Any ideas?
> 
> Warren Togami
> warren@togami.com
> 
> 
> 
> 


-- 
   Levente                               "Si vis pacem para bellum!"

--------------080608090809030403070203
Content-Type: text/plain;
 name="dovecot-doc.patch"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename="dovecot-doc.patch"

--- dovecot-0.99.8.1/doc/Makefile.in.lfarkas	2003-02-28 15:04:45.000000000 +0100
+++ dovecot-0.99.8.1/doc/Makefile.in	2003-02-28 15:05:46.000000000 +0100
@@ -82,7 +82,7 @@
 VPOPMAIL_LIBS = @VPOPMAIL_LIBS@
 ssldir = @ssldir@
 
-docdir = $(datadir)/doc/dovecot
+docdir = $(datadir)/doc/dovecot-0.99.8.1
 
 doc_DATA =  	auth.txt 	configuration.txt 	design.txt 	index.txt 	mail-storages.txt 	multiaccess.txt 	nfs.txt
 

--------------080608090809030403070203
Content-Type: text/plain;
 name="dovecot-libtool.patch"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename="dovecot-libtool.patch"

--- dovecot-1.0/configure.lfarkas	2003-03-20 15:53:04.000000000 +0100
+++ dovecot-1.0/configure	2003-03-20 15:54:37.000000000 +0100
@@ -8205,7 +8205,7 @@
 LIBTOOL_DEPS="$ac_aux_dir/ltmain.sh"
 
 # Always use our own libtool.
-LIBTOOL='$(SHELL) $(top_builddir)/libtool'
+LIBTOOL='$(SHELL) libtool'
 
 # Prevent multiple expansion
 

--------------080608090809030403070203
Content-Type: text/plain;
 name="dovecot.init"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename="dovecot.init"

#!/bin/bash
#
#	/etc/rc.d/init.d/dovecot
#
# Starts the dovecot daemon
#
# chkconfig: - 345 54 54
# description: Dovecot Imap Server
# processname: dovecot
# Source function library.
. /etc/init.d/functions

test -x /usr/sbin/dovecot || exit 0

RETVAL=0
prog="dovecot"

start() {
	echo -n $"Starting $prog: "
	# Check if dovecot is already running
	if [ ! -f /var/lock/subsys/dovecot ]; then
	    daemon /usr/sbin/dovecot
	    RETVAL=$?
	    [ $RETVAL -eq 0 ] && touch /var/lock/subsys/dovecot
	    echo
	else
	    failure $"dovecot start"
	    echo
	fi
	return $RETVAL
}

stop() {
	echo -n $"Stopping $prog: "
	killproc dovecot
	RETVAL=$?
	[ $RETVAL -eq 0 ] && rm -f /var/lock/subsys/dovecot
	echo
	return $RETVAL
}

#
#	See how we were called.
#
case "$1" in
  start)
	start
	;;
  stop)
	stop
	;;
  reload|restart)
	stop
	start
	;;
  condrestart)
	if [ -f /var/lock/subsys/dovecot ]; then
	    stop
	    start
	fi
	;;
  status)
	status /usr/sbin/dovecot
	;;
  *)
	echo $"Usage: $0 {condrestart|start|stop|restart|reload|status}"
	exit 1
esac

exit $?

--------------080608090809030403070203
Content-Type: text/plain;
 name="dovecot.pam"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename="dovecot.pam"

#%PAM-1.0
#
# $Id: system-auth.authpam,v 1.1 2001/02/02 05:42:57 mrsam Exp $
#
# Copyright 1998-2001 Double Precision, Inc.  See COPYING for
# distribution information.
#
# This is a sample authpam configuration file that uses pam_stack
# (circa linux-pam 0.72).

auth       required     pam_nologin.so
auth       required     pam_stack.so service=system-auth
account    required     pam_stack.so service=system-auth
session    required     pam_stack.so service=system-auth

--------------080608090809030403070203
Content-Type: text/plain;
 name="dovecot.spec"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename="dovecot.spec"

%define uid 96
%define gid 96

Summary: Dovecot Secure imap server
Name: dovecot
Version: 1.0
Release: cvs
License: GPL
Group: System Environment/Daemons
Source: %{name}-%{version}.tar.gz
Source2: dovecot.init
Source3: dovecot.pam
Patch: dovecot-libtool.patch
URL: http://dovecot.procontrol.fi/
Buildroot: %{_tmppath}/%{name}-%{version}-%{release}-root

%description
Dovecot IMAP server - compiled with openssl, pam and ldap support certs in /etc/ssl

%prep

%setup -q
%patch -p1

%build
#./autogen.sh
%configure --with-ldap --with-ssl=openssl --with-rawlog

make

%install
rm -rf $RPM_BUILD_ROOT
%makeinstall
rm -rf $RPM_BUILD_ROOT/%{_datadir}/%{name}
rm -rf $RPM_BUILD_ROOT/%{_datadir}/doc/%{name}
mv $RPM_BUILD_ROOT/%{_sysconfdir}/dovecot-example.conf $RPM_BUILD_ROOT/%{_sysconfdir}/dovecot.conf
mkdir -p $RPM_BUILD_ROOT/%{_sysconfdir}/rc.d/init.d
install -m 755 %{SOURCE2} $RPM_BUILD_ROOT/%{_sysconfdir}/rc.d/init.d/dovecot
mkdir -p $RPM_BUILD_ROOT/%{_sysconfdir}/pam.d
install -m 644 %{SOURCE3} $RPM_BUILD_ROOT/%{_sysconfdir}/pam.d/imap
install -m 644 %{SOURCE3} $RPM_BUILD_ROOT/%{_sysconfdir}/pam.d/imaps
install -m 644 %{SOURCE3} $RPM_BUILD_ROOT/%{_sysconfdir}/pam.d/pop3
install -m 644 %{SOURCE3} $RPM_BUILD_ROOT/%{_sysconfdir}/pam.d/pop3s

%post
/sbin/chkconfig --add dovecot

# Add the dovecot user and group if not found
groupadd -g %{gid} -r dovecot 2>/dev/null || :
useradd -d /var/run/dovecot -s /bin/false -g dovecot -M -r -u %{uid} dovecot 2>/dev/null || :

%preun
/sbin/chkconfig --del dovecot

%clean
rm -rf $RPM_BUILD_ROOT

%files
%defattr(-,root,root)
%config %{_sysconfdir}/dovecot.conf
%config %{_sysconfdir}/pam.d/*
%config %{_sysconfdir}/rc.d/init.d/dovecot
%dir %{_libexecdir}/%{name}
%{_libexecdir}/%{name}/*
%dir %{_sbindir}
%{_sbindir}/*
%doc doc/*.txt doc/dovecot-* doc/mkcert.sh INSTALL AUTHORS ChangeLog COPYING TODO README NEWS COPYING.LGPL

%changelog
* Mon Mar 24 2003 Levente Farkas <lfarkas@lfarkas.org>
- update a few things for the current cvs

* Sun Feb 28 2003 Zalavary Gabor <zgabor@bnap.hu>
- 0.99.8 rebuild:)

* Sun Dec  1 2002 Seth Vidal <skvidal@phy.duke.edu>
- 0.99.4 and fix startup so it starts imap-master not vsftpd :)

* Tue Nov 26 2002 Seth Vidal <skvidal@phy.duke.edu>
- first build

--------------080608090809030403070203--



From dag@wieers.com  Mon Apr 14 15:46:01 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 14 Apr 2003 18:10:58 +0300 (EEST)
Return-Path: <dag@wieers.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from horsea.3ti.be (horsea.3ti.be [212.204.244.41])
	by danu.procontrol.fi (Postfix) with ESMTP id 8A4D7238C7
	for <dovecot@procontrol.fi>; Mon, 14 Apr 2003 15:46:01 +0300 (EEST)
Received: from localhost (dag@localhost.localdomain [127.0.0.1])
	by horsea.3ti.be (8.11.6/8.11.6) with ESMTP id h3ECjwD10019;
	Mon, 14 Apr 2003 14:45:58 +0200
Date: Mon, 14 Apr 2003 14:45:58 +0200 (CEST)
From: Dag Wieers <dag@wieers.com>
X-X-Sender: dag@horsea.3ti.be
To: fedora-devel@fedora.us
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: dovecot RPM for Red Hat Linux
In-Reply-To: <Pine.LNX.4.44.0304141418550.22905-100000@horsea.3ti.be>
Message-ID: <Pine.LNX.4.44.0304141442270.22905-100000@horsea.3ti.be>
User-Agent: Mutt/1.2.5.1i
X-Mailer: Ximian Evolution 1.0.5
Organization: 3TI Web Hosting Services
X-Extra: We know Linux is the best. It can do infinite loops in five seconds. - Linus Torvalds
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset="ISO-8859-15; FORMAT=flowed"
Content-Transfer-Encoding: 8BIT
X-archive-position: 563
X-Approved-By: tss@iki.fi
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: dag@wieers.com
Precedence: bulk
X-list: dovecot
X-UID: 564                                                  
Status: O
Content-Length: 1896

On Mon, 14 Apr 2003, Dag Wieers wrote:

> On 13 Apr 2003, Warren Togami wrote:
> 
> > On Sun, 2003-04-13 at 15:42, Warren Togami wrote:
> > > http://bugzilla.fedora.us/show_bug.cgi?id=160
> > > 
> > > This .src.rpm is dovecot with RH-specific default settings.  I modified
> > > Jeremy Katz' dovecot-0.99.8.1 package a bit.
> > 
> > I ran into and fixed a few packaging problems listed below, but the last
> > two I'm not exactly sure how to fix.  Any suggestions?
> > 
> > One problem within /etc/init.d/dovecot
> > ======================================
> > start() {
> >         # Check if pxe is already running
> >         if [ ! -f /var/lock/subsys/dovecot ]; then
> >             echo -n $"Starting $prog: "
> >             /usr/sbin/dovecot &
> >             [ -n "`pidofproc /usr/sbin/dovecot`" ] && success
> >             RETVAL=$?
> >             [ $RETVAL -eq 0 ] && touch /var/lock/subsys/dovecot
> >             echo
> >         fi
> > }
> 
> Warren, why are you using pidofproc and success yourself ? Red Hat has the 
> infrastructure that takes care of this. I have never have to use these 
> myself.
> 
> You could take a look at my sysv-script in my SPEC file. I always embed 
> these files in the SPEC file so that the path-macros affect the 
> sysv-script too.
> 
> There I simply do:

-snip-

Make that:

	start() { 
	        echo -n \$"Starting \$prog: "
	        daemon \$prog
	        RETVAL=\$?
	        echo
	        [ \$RETVAL -eq 0 ] && touch %{_localstatedir}/lock/subsys/\$prog
	        return \$RETVAL
	} 

	stop() {
	        echo -n \$"Shutting down \$prog: "
	        killproc \$prog
	        RETVAL=\$?
	        echo
	        [ \$RETVAL -eq 0 ] && rm -f %{_localstatedir}/lock/subsys/\$prog
	        return \$RETVAL
	}

Kind regards,
--   dag wieers,  dag@wieers.com,  http://dag.wieers.com/   --
«Any errors in spelling, tact or fact are transmission errors»


From dag@wieers.com  Mon Apr 14 15:31:55 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 14 Apr 2003 18:11:10 +0300 (EEST)
Return-Path: <dag@wieers.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from horsea.3ti.be (horsea.3ti.be [212.204.244.41])
	by danu.procontrol.fi (Postfix) with ESMTP id E8BDE23896
	for <dovecot@procontrol.fi>; Mon, 14 Apr 2003 15:31:54 +0300 (EEST)
Received: from localhost (dag@localhost.localdomain [127.0.0.1])
	by horsea.3ti.be (8.11.6/8.11.6) with ESMTP id h3ECVpD07706;
	Mon, 14 Apr 2003 14:31:51 +0200
Date: Mon, 14 Apr 2003 14:31:51 +0200 (CEST)
From: Dag Wieers <dag@wieers.com>
X-X-Sender: dag@horsea.3ti.be
To: fedora-devel@fedora.us
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: dovecot RPM for Red Hat Linux
In-Reply-To: <1050299914.32054.7.camel@laptop>
Message-ID: <Pine.LNX.4.44.0304141427480.22905-100000@horsea.3ti.be>
User-Agent: Mutt/1.2.5.1i
X-Mailer: Ximian Evolution 1.0.5
Organization: 3TI Web Hosting Services
X-Extra: We know Linux is the best. It can do infinite loops in five seconds. - Linus Torvalds
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset="ISO-8859-15; FORMAT=flowed"
Content-Transfer-Encoding: 8BIT
X-archive-position: 564
X-Approved-By: tss@iki.fi
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: dag@wieers.com
Precedence: bulk
X-list: dovecot
X-UID: 565                                                  
Status: O
Content-Length: 1041

On 13 Apr 2003, Warren Togami wrote:

> On Sun, 2003-04-13 at 15:42, Warren Togami wrote:
>
> chkconfig problem
> =================
> [root@goku log]# chkconfig --list |grep dovecot
> dovecot         0:off   1:off   2:off   3:off   4:off   5:off   6:off
> [root@goku log]# chkconfig dovecot on
> [root@goku log]# chkconfig --list |grep dovecot
> dovecot         0:off   1:off   2:off   3:off   4:off   5:off   6:off
> The init.d and rc.d stuff seems to have problems, I haven't analyzed this yet.

It probably has to do with the chkconfig headers in your sysv-script.

[root@lisse SPECS]# rpm -q dovecot
dovecot-0.99.8.1-0.dag.rh90

[root@lisse SPECS]# chkconfig --list dovecot       
dovecot         0:off   1:off   2:off   3:off   4:off   5:off   6:off
[root@lisse SPECS]# chkconfig dovecot on 
[root@lisse SPECS]# chkconfig --list dovecot
dovecot         0:off   1:off   2:on    3:on    4:on    5:on    6:off

--   dag wieers,  dag@wieers.com,  http://dag.wieers.com/   --
«Any errors in spelling, tact or fact are transmission errors»



From dag@wieers.com  Mon Apr 14 15:24:51 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 14 Apr 2003 18:11:14 +0300 (EEST)
Return-Path: <dag@wieers.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from horsea.3ti.be (horsea.3ti.be [212.204.244.41])
	by danu.procontrol.fi (Postfix) with ESMTP id 19BC423896
	for <dovecot@procontrol.fi>; Mon, 14 Apr 2003 15:24:51 +0300 (EEST)
Received: from localhost (dag@localhost.localdomain [127.0.0.1])
	by horsea.3ti.be (8.11.6/8.11.6) with ESMTP id h3ECOWD06346;
	Mon, 14 Apr 2003 14:24:32 +0200
Date: Mon, 14 Apr 2003 14:24:32 +0200 (CEST)
From: Dag Wieers <dag@wieers.com>
X-X-Sender: dag@horsea.3ti.be
To: fedora-devel@fedora.us
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: dovecot RPM for Red Hat Linux
In-Reply-To: <1050299914.32054.7.camel@laptop>
Message-ID: <Pine.LNX.4.44.0304141418550.22905-100000@horsea.3ti.be>
User-Agent: Mutt/1.2.5.1i
X-Mailer: Ximian Evolution 1.0.5
Organization: 3TI Web Hosting Services
X-Extra: We know Linux is the best. It can do infinite loops in five seconds. - Linus Torvalds
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset="ISO-8859-15; FORMAT=flowed"
Content-Transfer-Encoding: 8BIT
X-archive-position: 565
X-Approved-By: tss@iki.fi
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: dag@wieers.com
Precedence: bulk
X-list: dovecot
X-UID: 566                                                  
Status: O
Content-Length: 1761

On 13 Apr 2003, Warren Togami wrote:

> On Sun, 2003-04-13 at 15:42, Warren Togami wrote:
> > http://bugzilla.fedora.us/show_bug.cgi?id=160
> > 
> > This .src.rpm is dovecot with RH-specific default settings.  I modified
> > Jeremy Katz' dovecot-0.99.8.1 package a bit.
> 
> I ran into and fixed a few packaging problems listed below, but the last
> two I'm not exactly sure how to fix.  Any suggestions?
> 
> One problem within /etc/init.d/dovecot
> ======================================
> start() {
>         # Check if pxe is already running
>         if [ ! -f /var/lock/subsys/dovecot ]; then
>             echo -n $"Starting $prog: "
>             /usr/sbin/dovecot &
>             [ -n "`pidofproc /usr/sbin/dovecot`" ] && success
>             RETVAL=$?
>             [ $RETVAL -eq 0 ] && touch /var/lock/subsys/dovecot
>             echo
>         fi
> }

Warren, why are you using pidofproc and success yourself ? Red Hat has the 
infrastructure that takes care of this. I have never have to use these 
myself.

You could take a look at my sysv-script in my SPEC file. I always embed 
these files in the SPEC file so that the path-macros affect the 
sysv-script too.

There I simply do:

	start() {
	        echo -n \$"Starting \$prog: "
	        daemon \$prog
	        RETVAL=\$?
	        echo
	        touch %{_localstatedir}/lock/subsys/\$prog
	        return \$RETVAL
	}

	stop() {
	        echo -n \$"Shutting down \$prog: "
	        killproc \$prog
	        RETVAL=\$?
	        echo
	        rm -f %{_localstatedir}/lock/subsys/\$prog
	        return \$RETVAL
	}

Any suggestions to this are welcomed.

Kind regards,
--   dag wieers,  dag@wieers.com,  http://dag.wieers.com/   --
«Any errors in spelling, tact or fact are transmission errors»


From tss@iki.fi  Mon Apr 14 18:22:19 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 14 Apr 2003 18:22:19 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id B93B62387F
	for <dovecot@procontrol.fi>; Mon, 14 Apr 2003 18:22:19 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 3D3685E017F5; Mon, 14 Apr 2003 18:22:19 +0300 (EEST)
Subject: [dovecot] Re: dovecot RPM for Red Hat Linux
From: Timo Sirainen <tss@iki.fi>
To: Warren Togami <warren@togami.com>
Cc: fedora-devel@fedora.us, dovecot@procontrol.fi
In-Reply-To: <1050299914.32054.7.camel@laptop>
References: <1050284521.30823.13.camel@laptop>
	 <1050299914.32054.7.camel@laptop>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1050333738.28255.367.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 14 Apr 2003 18:22:19 +0300
X-archive-position: 566
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 567                                                  
Status: O

On Mon, 2003-04-14 at 08:58, Warren Togami wrote:
> RH init script problem
> ======================
> Another problem happens during RH's init scripts after you reboot.  By default
> dovecot uses /var/run/dovecot/login/ as a directory to create unix sockets for
> login.  RH's init script displays an error messages when I tries to remove
> /var/run/*/* files because it is a directory, not a file.  I changed dovecot's
> default to /var/run/dovecot and it now avoids this error.

Rather make a new directory for it, eg. /var/run/dovecot-login.
Currently it's not that important, but it might change in future. Or
actually I think it breaks if Dovecot is started via inetd, because it
creates a socket in /var/run/dovecot which would conflict with auth
sockets.


From tss@iki.fi  Mon Apr 14 18:29:24 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 14 Apr 2003 18:29:24 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 427AF2387F
	for <dovecot@procontrol.fi>; Mon, 14 Apr 2003 18:29:24 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 07FFE5E017F5; Mon, 14 Apr 2003 18:29:24 +0300 (EEST)
Subject: [dovecot] Re: a crashy message
From: Timo Sirainen <tss@iki.fi>
To: Moe Wibble <eskimoe@ananzi.co.za>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030413162053.GA23316@woom.net>
References: <20030413162053.GA23316@woom.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1050334163.28254.375.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 14 Apr 2003 18:29:23 +0300
X-archive-position: 567
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 568                                                  
Status: O
Content-Length: 1125

On Sun, 2003-04-13 at 19:20, Moe Wibble wrote:
> Hi everyone,
> 
> the attached message does reliably crash my dovecot when trying
> to access a folder containing it.
> 
> Crash notice in mail.log:
> Apr 13 17:36:12 rafter dovecot: child 23215 (imap) killed with signal 11
> 
> My `dovecot --version` says:
> 0.99.8

Well, the version number isn't really up to date currently :) Is this
CVS or -test? I don't think 0.99.8.1 yet had --version.

> Has this problem been fixed in current dovecot?
> For now I have just quarantined the offending message but obviously
> I need to upgrade my dovecot soon because I don't like such kinda
> things to happen.

I couldn't get any crashes with it, neither with 0.99.8.1 nor current
CVS. It would help if you got gdb backtrace from the crash:

Set "mail_drop_priv_before_exec = yes" in config file, so it dumps core
to whatever directory you started dovecot in. Hmm. Actually I think I
should change to mail root dir so it's written there..

gdb /usr/local/dovecot/libexec/dovecot/imap core
bt

Or alternatively:

gdb /usr/.../imap <pid of running imap process>
c
<wait for crash>
bt


From keith@midnighthax.com  Mon Apr 14 21:33:56 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 15 Apr 2003 02:06:04 +0300 (EEST)
Return-Path: <keith@midnighthax.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mhlgengs001.rg2.midnighthax.com (unknown [217.158.167.69])
	by danu.procontrol.fi (Postfix) with ESMTP id DC436238C7
	for <dovecot@procontrol.fi>; Mon, 14 Apr 2003 21:33:55 +0300 (EEST)
Received: from zaphod.rg2.midnighthax.com (zaphod.rg2.midnighthax.com [10.0.2.1])
	by mhlgengs001.rg2.midnighthax.com (Postfix) with SMTP id 6C380224C6
	for <dovecot@procontrol.fi>; Mon, 14 Apr 2003 19:33:51 +0100 (BST)
Date: Mon, 14 Apr 2003 19:33:49 +0100
From: Keith Edmunds <keith@midnighthax.com>
To: dovecot@procontrol.fi
Subject: [dovecot] Folders with mail and subfolders
Message-Id: <20030414193349.4c4fe9ba.keith@midnighthax.com>
Organization: Midnight Hax Ltd
X-Mailer: Sylpheed version 0.8.11claws90 (GTK+ 1.2.10; i686-pc-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-archive-position: 568
X-Approved-By: tss@iki.fi
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: keith@midnighthax.com
Precedence: bulk
X-list: dovecot
X-UID: 569                                                  
Status: O

I have a maildir hierarchy (built originally with Courier-IMAP) where
some folders contain both email and subfolders. Using Dovecot I cannot
see the mail in the top folders: I can only see the subfolders.

Is this an RFC restriction or a Dovecot restriction? If the latter, is
it planned to change?

Otherwise: just started using Dovecot, and I'm very impressed with the
speed of it. Thanks!

Keith

From ianj@ian-justman.com  Tue Apr 15 05:04:32 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 15 Apr 2003 05:04:32 +0300 (EEST)
Return-Path: <ianj@ian-justman.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from narshe.chocobo.org (dsl-207-126-72-242.dsl.netasset.net [207.126.72.242])
	by danu.procontrol.fi (Postfix) with ESMTP id BC1F12387F
	for <dovecot@procontrol.fi>; Tue, 15 Apr 2003 05:04:31 +0300 (EEST)
Received: from ian-justman.com (jidoor.chocobo.org [207.126.72.253])
	by narshe.chocobo.org (Postfix) with ESMTP
	id 6FF4C311617; Mon, 14 Apr 2003 19:04:26 -0700 (PDT)
Message-ID: <3E9B68A9.4000701@ian-justman.com>
Date: Mon, 14 Apr 2003 19:04:25 -0700
From: "Ian R. Justman" <ianj@ian-justman.com>
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.0; en-US; rv:1.0.2) Gecko/20030208 Netscape/7.02
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Keith Edmunds <keith@midnighthax.com>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: Folders with mail and subfolders
References: <20030414193349.4c4fe9ba.keith@midnighthax.com>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 569
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: ianj@ian-justman.com
Precedence: bulk
X-list: dovecot
X-UID: 570                                                  
Status: O



Keith Edmunds wrote:
> I have a maildir hierarchy (built originally with Courier-IMAP) where
> some folders contain both email and subfolders. Using Dovecot I cannot
> see the mail in the top folders: I can only see the subfolders.
> 
> Is this an RFC restriction or a Dovecot restriction? If the latter, is
> it planned to change?

Far as I know, that's usually a client-side issue.  I had the same thing 
come up when I was using Cyrus where a folder can hold either messages or 
more folders.  Netscape has an option where you can have both or they're 
mutually exclusive.

Nowadays, I'm using mbox, so they're sorta mutually exclusive. ;)

--Ian.



From mem@mv.mv.com  Tue Apr 15 07:38:17 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 15 Apr 2003 07:38:17 +0300 (EEST)
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id 9B126238C8
	for <dovecot@procontrol.fi>; Tue, 15 Apr 2003 07:38:14 +0300 (EEST)
Received: (qmail 21974 invoked by uid 101); 15 Apr 2003 00:38:11 -0400
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Tue, 15 Apr 2003 00:38:11 -0400
To: dovecot@procontrol.fi
Subject: [dovecot] Re: 0.99.9-test3
Message-ID: <20030415043811.GA24366@iridium.mv.net>
References: <1050159872.25107.483.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1050159872.25107.483.camel@hurina>
User-Agent: Mutt/1.4.1i
X-archive-position: 570
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mem@mv.mv.com
Precedence: bulk
X-list: dovecot
X-UID: 571                                                  
Status: O
Content-Length: 1952

On Sat, Apr 12, 2003 at 06:04:32PM +0300, Timo Sirainen wrote:
> Expunging messages caused those "Corrupted index file" errors. That's
> fixed now. There's probably still some problems, at least this fix
> didn't fix any crashes..
> 
> test3 available from http://dovecot.procontrol.fi/test/

Hi-

Tried this- still get at least three varieties of the "Corrupted index
file" errors (very frequent as you can see by the timestamps):

Apr 14 23:48:03 mercury mem[11546]: pop3(user3): Corrupted index file
/users/1d/user3/Maildir/.INBOX/.imap.index:  Filename mismatch for UID
1366: 1050157920.28714.mercury.mv.net vs 1050168692.1692.mercury.mv.net

Apr 14 23:48:11 mercury mem[11880]: pop3(user4): Corrupted index file
(in-memory index for /users/2a/user4/Maildir): Filename mismatch for
UID 1:  1050378453.254 31.mercury.mv.net vs 1050378419.24825.mercury.mv.net

Apr 14 23:48:15 mercury mem[10327]: pop3(user1): Corrupted index file
/users/8f/user1/Maildir/.INBOX/.imap.index: index.next_uid (118) >
uidlist.next_uid (114)

Plus very rapid signal 11s:

Apr 14 23:48:12 mercury dovecot: child 25983 (imap) killed with signal 11
Apr 14 23:48:12 mercury dovecot: child 25992 (imap) killed with signal 11
Apr 14 23:48:14 mercury dovecot: child 26034 (imap) killed with signal 11

Pretty much the same as with test2.

All occurances of this last mesasge say "(imap)" -- no "pop3".  
However most accesses on this system are pop3, not imap.

In fact it appears that all examples of "Corrupted index" are pop3
instances, and all examples of "signal 11" are imap..

I tried setting

  mail_drop_priv_before_exec = yes

as you suggested, to generate a core dump, but if it's dumping core
I can't find it anywhere.  dovecot was started from /var/tmp and
I have verified that the running dovecot and dovecot-auth processes
have /var/tmp as a working directory.

I also continue to see sporadic "(imap) returned error 89" with this
version and with 0.99.8.1

-mm-

From warren@togami.com  Tue Apr 15 15:43:24 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 15 Apr 2003 15:43:24 +0300 (EEST)
Return-Path: <warren@togami.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from hnlmail2.hawaii.rr.com (hnlmail2.hawaii.rr.com [24.25.227.35])
	by danu.procontrol.fi (Postfix) with ESMTP id 10A99238C8
	for <dovecot@procontrol.fi>; Tue, 15 Apr 2003 15:43:23 +0300 (EEST)
Received: (apparently) from localhost.127.in-addr.arpa ([204.210.124.92]) by hnlmail2.hawaii.rr.com  with Microsoft SMTPSVC(5.5.1877.757.75);
	 Tue, 15 Apr 2003 02:43:20 -1000
Subject: [dovecot] Three *very* strange bugs
From: Warren Togami <warren@togami.com>
To: dovecot@procontrol.fi, fedora-devel@fedora.us,
	shrike-list@redhat.com
Content-Type: multipart/mixed; boundary="=-1kN4J0lqIIqLcGMke0AY"
Organization: 
Message-Id: <1050410599.20921.23.camel@laptop>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 (1.2.2-5) 
Date: 15 Apr 2003 02:43:19 -1000
X-archive-position: 571
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: warren@togami.com
Precedence: bulk
X-list: dovecot
X-UID: 572                                                  
Status: O
Content-Length: 2539


--=-1kN4J0lqIIqLcGMke0AY
Content-Type: text/plain
Content-Transfer-Encoding: 7bit

* Attached is a mbox file that triggers Bug #1 and #2.
* Go here if you want to test dovecot for RH9:
https://bugzilla.fedora.us/show_bug.cgi?id=160
* If somebody has a different IMAP server than dovecot, could you please
test how Evolution reacts to reading this message?

Bug #1 dovecot and #2 evolution-1.2.3
=====================================
I am using dovecot-0.99.9-test3 on RH9, reading mail with
evolution-1.2.2-5 on RH9.  Whenever I attempt to view this one
particular spam message, evolution pops up an error like:

Error while 'Retrieving message 4':
Server unexpectedly disconnected: No such file or directory

Simultaneously this appears in my /var/log/maillog:
Apr 15 01:44:50 server dovecot: child 20328 (imap) killed with signal 11

If I attempt to keep reading mail, it logs in again to dovecot and works
normally until I attempt to read that spam again.  Evolution displays
the error popup again though I don't see another signal 11 in maillog. 
After this point I am unable to log back into dovecot without restarting
the daemon.

Here's the strange part...
I browsed the same IMAP folder from KMail, and kmail has no problem
reading that spam message.  dovecot's [imap] process does not
segmentation fault.

Does this mean an evolution bug when reading this particular spam
exposed a dovecot segmentation fault?

Bug #3 kernel?
==============
This is an unrelated bug and perhaps not the fault of dovecot.  When I
attempted to use strace to get some debugging info on the [imap]
process, this happened:

[root@server /]# strace -p 20486
trace: ptrace(PTRACE_SYSCALL, ...): Operation not permitted
detach: ptrace(PTRACE_DETACH, ...): Operation not permitted
[root@server /]# 

This isn't normal right?  After doing this, dovecot stops working and I
need to restart the daemon in order to establish new connections.  That
[imap] process becomes unkillable, even kill -9 wont work.  Unkillable
process usually means kernel bug, right?

warren   20345     1  7 01:46 ?        00:00:34 [imap]

This is kernel-2.4.20-9 in Red Hat Linux 9.  Is dovecot exposing a Red
Hat kernel bug when I try to strace that process, or is strace supposed
to fail, the dovecot daemon ceases to function and [imap] process
becomes completely unkillable? =)

Warren Togami
warren@togami.com

--=-1kN4J0lqIIqLcGMke0AY
Content-Description: 
Content-Type: application/octet-stream
Content-Disposition: attachment; filename=TEMP
Content-Transfer-Encoding: 8bit

From MAILER-DAEMON Tue Apr 15 02:23:51 2003
Date: 15 Apr 2003 02:23:51 -1000
From: Mail System Internal Data <MAILER-DAEMON@localhost.localdomain>
Subject: DON'T DELETE THIS MESSAGE -- FOLDER INTERNAL DATA
Message-ID: <1050409431@localhost.localdomain>
Status: RO
Content-Length: 260
X-UID: 573                                                  

This text is part of the internal format of your mail folder, and is not
a real message.  It is created automatically by the mail system software.
If deleted, important folder data will be lost, and it will be re-created
with the data reset to initial values.

From warren@goku  Tue Apr 15 00:36:53 2003
Return-Path: <disc@ileadmarketing.com>
Received: from localhost (goku [127.0.0.1])
	by localhost.localdomain (8.12.8/8.12.8) with ESMTP id h3FAaRYm020172
	for <warren@localhost>; Tue, 15 Apr 2003 00:36:53 -1000
Message-Id: <200304151036.h3FAaRYm020172@localhost.localdomain>
Received: from mail.togami.com [209.15.46.61]
	by localhost with POP3 (fetchmail-6.2.0)
	for warren@localhost (single-drop); Tue, 15 Apr 2003 00:36:53 -1000 (HST)
Received: from cobra.ileadmarketing.com ([64.156.222.132]) by  ; Tue, 15 Apr 2003 05:18:04 -0500
Received: by cobra.ileadmarketing.com (PowerMTA(TM) v1.6a27); Tue, 15 Apr 2003 06:22:36 -0400 (envelope-from <disc-57366-1494139@ileadmarketing.com>)
Date: Tue, 15 Apr 2003 06:22:36 -0400
Reply-To: disc@ileadmarketing.com
Content-Type: multipart/alternative; boundary="=====1050402156.00938====="
Subject: The Discover(r) Platinum Wildlife Card - Go Wild
MIME-Version: 1.0
From: Wild Life <disc@ileadmarketing.com>
To: warren@togami.com
X-Rcpt-To: <warren@togami.com>
X-DPOP: Version number supressed
X-UIDL: 1050402982.1619
X-Spam-Status: No, hits=3.4 required=7.0
	tests=CLICK_BELOW,GREAT_OFFER,HTTP_WITH_EMAIL_IN_URL,
	      MIME_MISSING_BOUNDARY,MSG_ID_ADDED_BY_MTA_2,NO_FEE,OFFER,
	      OFFER_EXPIRE,SPAM_PHRASE_13_21,WEB_BUGS
	version=2.44
X-Spam-Level: ***
Content-Length: 3779
Status: RO
X-UID: 574                                                  

--=====1050402156.00938=====
Content-Type: text/plain; charset="iso-8859-1"

Offer Expires April 30, 2003
X-Rcpt-To: <warren@togami.com>

Get a 0% Intro APR* on Purchases and Balance Transfers

Youve been selected for a special No-Annual-Fee Discover® Card with all of these privileges:

· 0% Intro APR on Purchases and Balance Transfers*
· No Annual Fee
· Up to 2% Cashback Bonus® award*
· Up to $50,000 Credit Limit

Start Saving Today  APPLY NOW! It's fast, easy and secure. 
http://ileadmarketing.com/mkt/lead?&l=56217&a=16cc7b&z=57366 

To take advantage of this special offer, act by April 30, 2003! 

* Click here  to see information about the APR, fees and other Important Information 









 
....................................................................
ILeadMarketing never sends unsolicited email.  ILeadMarketing has 
been given the right to market to you through our Web site partners 
and their privacy policies. Specifically, you are receiving this  
correspondence because you have provided consent (via your 
registration and acceptance of the privacy policies for a newsletter, 
contest, web-based service or other activity on the web) to receive 
recurring promotions or offers from various third parties. If you  
feel that you are receiving this email in error or are not interested 
in receiving future offers please click here: 
http://www.ileadmarketing.com/mkt/seeya?email=warren@togami.com&c=57366 ,
or email us at seeya@ileadmarketing.com.  ILeadMarketing is not 
responsible for third party offers, services or products and makes 
no representations or warranties regarding them.
.....................................................................
--=====1050402156.00938=====
Content-Type: text/html; charset="iso-8859-1"

<HTML>
<HEAD>
<TITLE>Discover Wildlife Card</TITLE>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
</HEAD>


<MAP NAME="apply">
<AREA SHAPE=RECT COORDS="1,1,600,450" HREF="http://ileadmarketing.com/mkt/lead?&l=56217&a=16cc7b&z=57366">
<AREA SHAPE=RECT COORDS="10,473,67,490" HREF="https://secure.novuslink.net/terms.asp?type=wild&cbb=0">
</MAP>

<BODY BGCOLOR=#FFFFFF LEFTMARGIN=0 TOPMARGIN=0 MARGINWIDTH=0 MARGINHEIGHT=0>
<!-- A closed mouth fathers no foot. - Anonymous  The world is divided into people who get things done, and people who get the credit. - Anonymous A classic is something that everybody wants to have read and nobody  wants to read. - Mark Twain -->
<IMG SRC="http://img.freeze.com/100588.gif" WIDTH=600 HEIGHT=500 ALT="" USEMAP="#apply" BORDER="0">



<img src="http://ileadmarketing.com/images/56217.gif?16cc7b&z=57366" height=1 width=1 border=0>
<br>
<br>
<br>
<br>
<table bgcolor="#ffffff">
<tr><td>
<font face="arial" size="1" color="#000000">ILeadMarketing never sends unsolicited email.  ILeadMarketing has 
been given the right to market to you through our Web site partners and their privacy policies. 
 Specifically, you are receiving this correspondence because you have provided consent 
 (via your registration and acceptance of the privacy policies for a newsletter, contest, web-based 
 service or other activity on the web) to receive recurring promotions or offers from various third parties.  
 If you feel that you are receiving this email in error or are not interested in receiving future offers 
 please click here:  <a href="http://www.ileadmarketing.com/mkt/seeya?email=warren@togami.com&c=57366"><b>http://www.ileadmarketing.com/mkt/seeya?email=warren@togami.com&c=57366</b></a>
 , or email us at seeya@ileadmarketing.com.  ILeadMarketing is not responsible for third party offers, services 
 or products and makes no representations or warranties regarding them.<br></font>
</td></tr></table>
</body>
</html>
--=====1050402156.00938=====



--=-1kN4J0lqIIqLcGMke0AY--


From tss@iki.fi  Tue Apr 15 16:10:18 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 15 Apr 2003 16:10:18 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 54A2E238C8
	for <dovecot@procontrol.fi>; Tue, 15 Apr 2003 16:10:18 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 13CD05E017F5; Tue, 15 Apr 2003 16:10:18 +0300 (EEST)
Subject: [dovecot] Re: Three *very* strange bugs
From: Timo Sirainen <tss@iki.fi>
To: Warren Togami <warren@togami.com>
Cc: dovecot@procontrol.fi, fedora-devel@fedora.us,
	shrike-list@redhat.com
In-Reply-To: <1050410599.20921.23.camel@laptop>
References: <1050410599.20921.23.camel@laptop>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1050412217.28250.419.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 15 Apr 2003 16:10:17 +0300
X-archive-position: 572
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 575                                                  
Status: O
Content-Length: 1467

On Tue, 2003-04-15 at 15:43, Warren Togami wrote:
> Simultaneously this appears in my /var/log/maillog:
> Apr 15 01:44:50 server dovecot: child 20328 (imap) killed with signal 11
> 
> If I attempt to keep reading mail, it logs in again to dovecot and works
> normally until I attempt to read that spam again.  Evolution displays
> the error popup again though I don't see another signal 11 in maillog. 
> After this point I am unable to log back into dovecot without restarting
> the daemon.

OK, thanks, fixed. Dovecot crashed with "FETCH nnn BODY[n.MIME]", so
pretty much any multipart mail crashed with Evolution.

> Here's the strange part...
> I browsed the same IMAP folder from KMail, and kmail has no problem
> reading that spam message.  dovecot's [imap] process does not
> segmentation fault.

KMail doesn't fetch MIME headers separately. I think it fetches whole
message at once.

> Bug #3 kernel?
> ==============
> This is an unrelated bug and perhaps not the fault of dovecot.  When I
> attempted to use strace to get some debugging info on the [imap]
> process, this happened:
> 
> [root@server /]# strace -p 20486
> trace: ptrace(PTRACE_SYSCALL, ...): Operation not permitted
> detach: ptrace(PTRACE_DETACH, ...): Operation not permitted
> [root@server /]# 

I have no problem stracing. I don't think Dovecot does anything that
should prevent it. Or, well, it might be because it's thought of as
setuid process, but root should be able to strace it.


From tss@iki.fi  Tue Apr 15 16:13:12 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 15 Apr 2003 16:13:12 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 8BAE9238C8
	for <dovecot@procontrol.fi>; Tue, 15 Apr 2003 16:13:12 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 301975E017F5; Tue, 15 Apr 2003 16:13:12 +0300 (EEST)
Subject: [dovecot] 0.99.9-test4
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1050412392.28255.423.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 15 Apr 2003 16:13:12 +0300
X-archive-position: 573
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 576                                                  
Status: O

http://procontrol.fi/test/

- Crashfix for multipart messages
- More optimized mbox rewriting, should be "good enough" for most uses I
think. I've been using it for a while now, seems to work.

Still some problems:

imap(cras): Apr 15 01:48:48 Warning: Our dotlock file /home/cras/mail//full-disclosure.lock was overridden

And I'm sure it wasn't. Or at least shouldn't have been. Have to look
more into this..


From seba@iq.pl  Tue Apr 15 16:27:35 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 15 Apr 2003 16:27:35 +0300 (EEST)
Return-Path: <seba@iq.pl>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from serv.iq.pl (serv.iq.pl [213.76.165.9])
	by danu.procontrol.fi (Postfix) with ESMTP id 39F6C238C9
	for <dovecot@procontrol.fi>; Tue, 15 Apr 2003 16:27:35 +0300 (EEST)
Received: by serv.iq.pl (Postfix, from userid 1390)
	id 544846BDC1; Tue, 15 Apr 2003 15:26:26 +0200 (CEST)
Date: Tue, 15 Apr 2003 15:26:26 +0200
From: Sebastian Pachuta <seba@iq.pl>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: 0.99.9-test4
Message-ID: <20030415132626.GD6374@iq.pl>
References: <1050412392.28255.423.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1050412392.28255.423.camel@hurina>
X-archive-position: 574
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: seba@iq.pl
Precedence: bulk
X-list: dovecot
X-UID: 577                                                  
Status: O

On Tue, Apr 15, 2003 at 16:13:12 +0300, Timo Sirainen wrote:
> http://procontrol.fi/test/
> 
> - Crashfix for multipart messages
> - More optimized mbox rewriting, should be "good enough" for most uses I
> think. I've been using it for a while now, seems to work.
> 
> Still some problems:
> 
> imap(cras): Apr 15 01:48:48 Warning: Our dotlock file /home/cras/mail//full-disclosure.lock was overridden
> 
> And I'm sure it wasn't. Or at least shouldn't have been. Have to look
> more into this..
> 

Not Found

The requested URL /test was not found on this server.

From oskar@mail.solls.net  Tue Apr 15 16:41:54 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 15 Apr 2003 16:41:54 +0300 (EEST)
Return-Path: <oskar@mail.solls.net>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from chuck.solls.net (chuck.schaeps.de [213.217.108.83])
	by danu.procontrol.fi (Postfix) with SMTP id 39E7F238C9
	for <dovecot@procontrol.fi>; Tue, 15 Apr 2003 16:41:54 +0300 (EEST)
Received: (qmail 48560 invoked from network); 15 Apr 2003 13:41:54 -0000
Received: from unknown (HELO localhost) (127.0.0.1)
  by chuck.solls.net with SMTP; 15 Apr 2003 13:41:54 -0000
Received: from pD9E60985.dip.t-dialin.net (pD9E60985.dip.t-dialin.net [217.230.9.133]) 
	by www2.solls.net (IMP) with HTTP 
	for <oskar@mail.solls.net@127.0.0.1>; Tue, 15 Apr 2003 13:41:54 +0000
Message-ID: <1050414114.3e9c0c2298c90@www2.solls.net>
Date: Tue, 15 Apr 2003 13:41:54 +0000
From: Oskar Eyb <oskar@mail.solls.net>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: 0.99.9-test4
References: <1050412392.28255.423.camel@hurina> <20030415132626.GD6374@iq.pl>
In-Reply-To: <20030415132626.GD6374@iq.pl>
MIME-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 8bit
User-Agent: Internet Messaging Program (IMP) 3.2
X-archive-position: 575
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: oskar@mail.solls.net
Precedence: bulk
X-list: dovecot
X-UID: 578                                                  
Status: O



> On Tue, Apr 15, 2003 at 16:13:12 +0300, Timo Sirainen wrote:
> > http://procontrol.fi/test/

> Not Found
> 
> The requested URL /test was not found on this server.


Just try: http://dovecot.procontrol.fi/test/


From eskimoe@ananzi.co.za  Tue Apr 15 18:01:04 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 15 Apr 2003 18:01:04 +0300 (EEST)
Return-Path: <eskimoe@ananzi.co.za>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from sun.com (port-212-202-171-244.reverse.qdsl-home.de [212.202.171.244])
	by danu.procontrol.fi (Postfix) with SMTP id 55B3F238C8
	for <dovecot@procontrol.fi>; Tue, 15 Apr 2003 18:01:04 +0300 (EEST)
Received: (qmail 18936 invoked by uid 1000); 15 Apr 2003 15:02:26 -0000
Date: Tue, 15 Apr 2003 17:02:26 +0200
From: Moe Wibble <eskimoe@ananzi.co.za>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: a crashy message
Message-ID: <20030415150226.GB17461@woom.net>
Mail-Followup-To: Moe Wibble <eskimoe@ananzi.co.za>,
	dovecot@procontrol.fi
References: <20030413162053.GA23316@woom.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20030413162053.GA23316@woom.net>
X-archive-position: 576
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: eskimoe@ananzi.co.za
Precedence: bulk
X-list: dovecot
X-UID: 579                                                  
Status: O

FYI:
That bug was fixed a while ago.
After upgrading to latest CVS everything is fine now.


regards
-- 
MW


From cras@irccrew.org  Tue Apr 15 18:48:27 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 15 Apr 2003 18:48:27 +0300 (EEST)
Return-Path: <cras@irccrew.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from shodan.irccrew.org (shodan [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id 8C757238C9
	for <dovecot@procontrol.fi>; Tue, 15 Apr 2003 18:48:27 +0300 (EEST)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id 5B6412E030; Tue, 15 Apr 2003 18:48:27 +0300 (EEST)
Date: Tue, 15 Apr 2003 18:48:27 +0300
From: Timo Sirainen <tss@iki.fi>
To: "Mark E. Mallett" <mem@mv.mv.com>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: 0.99.9-test3
Message-ID: <20030415154827.GB18955@irccrew.org>
References: <1050159872.25107.483.camel@hurina> <20030415043811.GA24366@iridium.mv.net>
Mime-Version: 1.0
Content-Disposition: inline
In-Reply-To: <20030415043811.GA24366@iridium.mv.net>
User-Agent: Mutt/1.4i
Content-Type: text/plain; charset=us-ascii
X-archive-position: 577
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 580                                                  
Status: O
Content-Length: 1777

On Tue, Apr 15, 2003 at 12:38:11AM -0400, Mark E. Mallett wrote:
> Tried this- still get at least three varieties of the "Corrupted index
> file" errors (very frequent as you can see by the timestamps):
> 
> Apr 14 23:48:03 mercury mem[11546]: pop3(user3): Corrupted index file
> /users/1d/user3/Maildir/.INBOX/.imap.index:  Filename mismatch for UID
> 1366: 1050157920.28714.mercury.mv.net vs 1050168692.1692.mercury.mv.net

Humm. Well, have to keep looking more at that.

> Plus very rapid signal 11s:
> 
> Apr 14 23:48:12 mercury dovecot: child 25983 (imap) killed with signal 11
> Apr 14 23:48:12 mercury dovecot: child 25992 (imap) killed with signal 11
> Apr 14 23:48:14 mercury dovecot: child 26034 (imap) killed with signal 11

Could these be the FETCH MIME crashes that Evolution caused? What clients do
you mostly have anyway?

> In fact it appears that all examples of "Corrupted index" are pop3
> instances, and all examples of "signal 11" are imap..

Are you sure you rebuilt/reinstalled the pop3 binary? I haven't actually
tried pop3 at all for a long time, but it shares all the backend code with
imap.

> I tried setting
> 
>   mail_drop_priv_before_exec = yes
> 
> as you suggested, to generate a core dump, but if it's dumping core
> I can't find it anywhere.  dovecot was started from /var/tmp and
> I have verified that the running dovecot and dovecot-auth processes
> have /var/tmp as a working directory.

Does everyone have write access to that directory then? It's the imap
process that needs it.. Or maybe you have just disabled core dumping?
Dovecot uses the ulimit -c that was active when dovecot was started.

> I also continue to see sporadic "(imap) returned error 89" with this
> version and with 0.99.8.1

Without more specific error above it?


From mem@mv.mv.com  Tue Apr 15 18:56:55 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 15 Apr 2003 18:56:55 +0300 (EEST)
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id CA381238C9
	for <dovecot@procontrol.fi>; Tue, 15 Apr 2003 18:56:54 +0300 (EEST)
Received: (qmail 1764 invoked by uid 101); 15 Apr 2003 11:56:53 -0400
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Tue, 15 Apr 2003 11:56:53 -0400
To: Timo Sirainen <tss@iki.fi>
Cc: "Mark E. Mallett" <mem@mv.mv.com>, dovecot@procontrol.fi
Subject: [dovecot] Re: 0.99.9-test3
Message-ID: <20030415155653.GD16705@iridium.mv.net>
References: <1050159872.25107.483.camel@hurina> <20030415043811.GA24366@iridium.mv.net> <20030415154827.GB18955@irccrew.org>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20030415154827.GB18955@irccrew.org>
User-Agent: Mutt/1.4.1i
X-archive-position: 578
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mem@mv.mv.com
Precedence: bulk
X-list: dovecot
X-UID: 581                                                  
Status: O
Content-Length: 2205

> > 
> > Apr 14 23:48:12 mercury dovecot: child 25983 (imap) killed with signal 11
> > Apr 14 23:48:12 mercury dovecot: child 25992 (imap) killed with signal 11
> > Apr 14 23:48:14 mercury dovecot: child 26034 (imap) killed with signal 11
> 
> Could these be the FETCH MIME crashes that Evolution caused? What clients do
> you mostly have anyway?

It could be.  I'll try the test4 and see what it reports.
I generally stage the installation through a test machine and my
rather low-volume tests to that machine do not show these failures.
So there probably is some difference between my tests and other
user accesses.


> > In fact it appears that all examples of "Corrupted index" are pop3
> > instances, and all examples of "signal 11" are imap..
> 
> Are you sure you rebuilt/reinstalled the pop3 binary? I haven't actually
> tried pop3 at all for a long time, but it shares all the backend code with
> imap.

Very sure..

Another difference that occured to me: I built the recent -test versions
with the libiconv library, and the previous ones without.  This would
seem (from my naive perspective) to also be a difference between pop3
and imap code paths.


> > I tried setting
> > 
> >   mail_drop_priv_before_exec = yes
> > 
> > as you suggested, to generate a core dump, but if it's dumping core
> > I can't find it anywhere.  dovecot was started from /var/tmp and
> > I have verified that the running dovecot and dovecot-auth processes
> > have /var/tmp as a working directory.
> 
> Does everyone have write access to that directory then? It's the imap
> process that needs it.. Or maybe you have just disabled core dumping?
> Dovecot uses the ulimit -c that was active when dovecot was started.

I started it from /var/tmp to help with the core dumping (because that is
indeed a directory that everybody can write to).  I didn't mention it but
I did indeed look at the dovecot process limits (via "rlimit") to verify
that it did not have a restricted coredump limit.


> > I also continue to see sporadic "(imap) returned error 89" with this
> > version and with 0.99.8.1
> 
> Without more specific error above it?

Not that I have been able to find.. i.e. no correlation with the
pid given.

mm

From dom@cus.org.uk  Tue Apr 15 19:00:34 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 15 Apr 2003 19:00:34 +0300 (EEST)
Return-Path: <dom@cus.org.uk>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from cus.org.uk (host213-106-240-81.no-dns-yet.ntli.net [213.106.240.81])
	by danu.procontrol.fi (Postfix) with ESMTP id 71686238C9
	for <dovecot@procontrol.fi>; Tue, 15 Apr 2003 19:00:34 +0300 (EEST)
Received: from cus.org.uk (localhost.cus.org.uk [127.0.0.1])
	by cus.org.uk (8.12.6/8.11.3) with ESMTP id h3FG0XLX088990
	for <dovecot@procontrol.fi>; Tue, 15 Apr 2003 17:00:33 +0100 (BST)
	(envelope-from dom@cus.org.uk)
Received: (from dom@localhost)
	by cus.org.uk (8.12.6/8.12.6/Submit) id h3FG0WQZ088989
	for dovecot@procontrol.fi; Tue, 15 Apr 2003 17:00:32 +0100 (BST)
Date: Tue, 15 Apr 2003 17:00:32 +0100
From: Dominic Marks <dom@cus.org.uk>
To: dovecot@procontrol.fi
Subject: [dovecot] Group ID validation and FreeBSD
Message-ID: <20030415160032.GA88602@cus.org.uk>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.4i
X-archive-position: 579
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: dom@cus.org.uk
Precedence: bulk
X-list: dovecot
X-UID: 582                                                  
Status: O
Content-Length: 1139

Hey,

I've been working on making the Dovecot FreeBSD port resemble something
which actually works this weekend, it's now much improved - one thing
that I did notice is that Dovecot validates a users GID and will not
accept a group id of 0. In FreeBSD the group wheel has a the id 0 and
only members of the wheel group are allowed to use su and become root.
Consequently there are non-root users who have group id's of 0. When you
try and open the mailbox of such a user with Dovecot the connection is
killed immediately.

It would be excellent to have an option in dovecot.conf along the lines
of allow_zero_gid which would disable these checks. From a quick look at
the source I can see that the validation is being done in
src/master/mail-process.c and that src/lib/restrict-access.c is also
involved. If I can get a working patch ready quickly I'll pass it along.

If anyone would like to take a look at the port you can get a copy at
the following address:

 http://cus.org.uk/~dom/dovecot-0.99.8.1.shar.gz

Hopefully this will go into FreeBSD CVS quite soon.

Thanks,
--
Dominic
 <dom at cus.org.uk> <d.marks at student.umist.ac.uk>

From overflow@eurielec.etsit.upm.es  Tue Apr 15 19:25:23 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 15 Apr 2003 19:25:23 +0300 (EEST)
Return-Path: <overflow@eurielec.etsit.upm.es>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from eurielec.etsit.upm.es (uno.eurielec.etsit.upm.es [138.100.31.227])
	by danu.procontrol.fi (Postfix) with ESMTP id 80C2E238D2
	for <dovecot@procontrol.fi>; Tue, 15 Apr 2003 19:25:23 +0300 (EEST)
Received: from dos.eurielec.etsit.upm.es (dos.eurielec.etsit.upm.es [138.100.31.228])
	by eurielec.etsit.upm.es (Postfix) with SMTP id E0919DD8
	for <dovecot@procontrol.fi>; Tue, 15 Apr 2003 18:29:27 +0200 (CEST)
Received: by dos.eurielec.etsit.upm.es (sSMTP sendmail emulation); Tue, 15 Apr 2003 18:25:13 +0200
Date: Tue, 15 Apr 2003 18:25:13 +0200
From: Jaime Medrano <overflow@eurielec.etsit.upm.es>
To: dovecot@procontrol.fi
Subject: [dovecot] Shadow password file
Message-ID: <20030415162513.GA2068@eurielec.etsit.upm.es>
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-15
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
User-Agent: Mutt/1.5.4i
X-archive-position: 580
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: overflow@eurielec.etsit.upm.es
Precedence: bulk
X-list: dovecot
X-UID: 583                                                  
Status: O

¿Is there any way to make dovecot to take the passwords from a file with
a shadow password format?

I've tried with the passwd-file auth plugin, but it complains that users
have uid=0

Thanks in advance,
Jaime Medrano

From mem@mv.mv.com  Tue Apr 15 19:28:17 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 15 Apr 2003 19:28:17 +0300 (EEST)
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id 4025E238D2
	for <dovecot@procontrol.fi>; Tue, 15 Apr 2003 19:28:17 +0300 (EEST)
Received: (qmail 24117 invoked by uid 101); 15 Apr 2003 12:28:16 -0400
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Tue, 15 Apr 2003 12:28:16 -0400
To: Timo Sirainen <tss@iki.fi>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: 0.99.9-test4
Message-ID: <20030415162816.GF16705@iridium.mv.net>
References: <1050412392.28255.423.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1050412392.28255.423.camel@hurina>
User-Agent: Mutt/1.4.1i
X-archive-position: 581
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mem@mv.mv.com
Precedence: bulk
X-list: dovecot
X-UID: 584                                                  
Status: O


I tried installing test4, got the same problems as before (Corrupted
folder messages, continuous "child xxxx (imap) killed with signal 11"
messages coming fast and furious-- which is curious because there just
aren't that many imap connections coming in).

I put back *just* the pop3 and imap images from the 0.99.8.1
release (and left the newer dovecot, -auth, and -login images
installed)- this hybrid runs OK.  (I hope there are no issues mixing
them this way.)

Now here is an odd thing:

If I run with the new imap image and the older pop3 image (from 0.99.8.1),
I see none of these new errors.

If I run with the new pop3 image and the older imap image, I see
all of the new errors (including the rapid "imap killed with signal 11"
messages).

Still no coredumps..  are these phantom imap children?

mm

From mem@mv.mv.com  Tue Apr 15 19:45:45 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 15 Apr 2003 19:45:45 +0300 (EEST)
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id 8768D238D2
	for <dovecot@procontrol.fi>; Tue, 15 Apr 2003 19:45:45 +0300 (EEST)
Received: (qmail 6564 invoked by uid 101); 15 Apr 2003 12:45:44 -0400
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Tue, 15 Apr 2003 12:45:43 -0400
To: Timo Sirainen <tss@iki.fi>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: 0.99.9-test4
Message-ID: <20030415164543.GA5821@iridium.mv.net>
References: <1050412392.28255.423.camel@hurina> <20030415162816.GF16705@iridium.mv.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20030415162816.GF16705@iridium.mv.net>
User-Agent: Mutt/1.4.1i
X-archive-position: 582
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mem@mv.mv.com
Precedence: bulk
X-list: dovecot
X-UID: 585                                                  
Status: O

> 
> If I run with the new pop3 image and the older imap image, I see
> all of the new errors (including the rapid "imap killed with signal 11"
> messages).
> 
> Still no coredumps..  are these phantom imap children?

Oh-- I see that the "imap" process type name is generic for either
mail program.  So all this is likely pop3 stuff.

mm

From lfarkas@bnap.hu  Tue Apr 15 20:21:22 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 15 Apr 2003 20:21:22 +0300 (EEST)
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id EF26E238C9
	for <dovecot@procontrol.fi>; Tue, 15 Apr 2003 20:21:21 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id 13FBE754003
	for <dovecot@procontrol.fi>; Tue, 15 Apr 2003 19:21:51 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id 4E4093EEE
	for <dovecot@procontrol.fi>; Tue, 15 Apr 2003 19:21:20 +0200 (CEST)
Message-ID: <3E9C3F8F.2050006@bnap.hu>
Date: Tue, 15 Apr 2003 19:21:19 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: [dovecot] current cvs
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 583
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 586                                                  
Status: O
Content-Length: 3849

hi,
so after upgrade to the current cvs all of our problem disappear:-)
but we don't have time to test the ssl part...
although after I compile and install the new dovecot I stop it I do a
--------------------
find /home/*/Maildir -name '.imap*' -exec rm {} \;
find /home/*/Maildir -name 'dovecot-uidlist' -exec rm {} \;
find /home/*/Maildir -name 'msgid.cache' -exec rm {} \;
find /home/*/Maildir -name '.customflags' -exec rm {}\;
--------------------
just to be sure that we use a fresh version and no other problem can be 
caused by the old index or any other cached files.
this was a BIG mistake!!!
we've got about 300 users and about 100 online at the same time. after a 
two minutes break (while I reinstall and delete) every user check his 
mail which casue a load about 90!!! the cpu usage 1-2% but the avarage 
load was 90 (curently about 0.22)! the reason was IO. we have to stop 
imap and wait for a while...
I don't know the exact reason bu I assume dovecot is regenerate 
everybody's index a other cache at the same time. is there any way to 
reduce the possible number of IO load? this would be useful if never 
happend again!:-)

this happend around 4:40.
the output of sar -b:
--------------------
03:00:00 PM       tps      rtps      wtps   bread/s   bwrtn/s
03:10:00 PM     48.18     29.19     18.99   1456.53    771.29
03:20:00 PM     41.66     25.80     15.86   1054.88    830.05
03:30:00 PM     42.64     25.67     16.97   1223.03    759.77
03:40:00 PM     44.98     31.95     13.03   1959.15    467.40
03:50:00 PM     26.68     14.63     12.05    741.48    424.12
04:00:00 PM     25.80     11.70     14.10    516.21    450.04
04:10:00 PM     59.55     34.91     24.64   1755.07    939.11
04:20:00 PM     95.98     61.15     34.83   4453.24   1563.25
04:30:00 PM     95.08     55.45     39.63   2182.22   1591.56
04:40:00 PM    168.85    145.99     22.86  11155.73   1037.25
04:50:00 PM    135.98    106.50     29.48   7908.21   1604.76
05:00:00 PM    125.87     97.65     28.23   5876.03   1060.50
05:10:00 PM     80.83     62.92     17.90   4321.82    590.19
05:20:00 PM    102.04     77.65     24.40   4907.27   1076.92
05:30:00 PM    129.04    106.58     22.46   6387.18    883.13
05:40:00 PM     89.44     73.20     16.24   4905.64    782.94
05:50:00 PM     88.23     73.16     15.06   5539.93    965.34
06:00:00 PM     92.49     72.67     19.81   5486.25    692.18
06:10:00 PM     45.24     32.82     12.42   1711.35    618.31
06:20:00 PM     42.17     28.16     14.01    960.11    622.33
06:30:00 PM     29.90     20.24      9.66   1538.27    376.17
06:40:00 PM     25.89     12.14     13.74    796.73    833.25
06:50:00 PM     20.50      4.98     15.52    264.91    993.62
07:00:00 PM     15.08      7.57      7.52    453.41    282.63
--------------------
the output of sar -d
--------------------
04:10:00 PM   dev22-3      0.00      0.00
04:10:00 PM   dev33-0      1.76    109.55
04:10:00 PM   dev34-0      8.51    919.94
04:20:00 PM    dev3-0      8.56    183.93
04:20:00 PM   dev22-2     67.62   3798.02
04:20:00 PM   dev22-3      0.00      0.00
04:20:00 PM   dev33-0      4.80    463.81
04:20:00 PM   dev34-0     15.01   1570.73
04:30:00 PM    dev3-0      4.40    126.63
04:30:00 PM   dev22-2     77.02   2440.08
04:30:00 PM   dev22-3      0.00      0.00
04:30:00 PM   dev33-0      1.94    124.80
04:30:00 PM   dev34-0     11.73   1082.28
04:40:00 PM    dev3-0      4.78    124.56
04:40:00 PM   dev22-2    137.27  10306.18
04:40:00 PM   dev22-3      0.00      0.00
04:40:00 PM   dev33-0     13.50    410.44
04:40:00 PM   dev34-0     13.29   1351.80
04:50:00 PM    dev3-0      6.33    194.27
04:50:00 PM   dev22-2    111.50   7961.44
04:50:00 PM   dev22-3      0.00      0.00
04:50:00 PM   dev33-0      5.64    156.51
--------------------

-- 
   Levente                               "Si vis pacem para bellum!"



From tss@iki.fi  Tue Apr 15 20:42:23 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 15 Apr 2003 20:42:23 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 39BE9238C9
	for <dovecot@procontrol.fi>; Tue, 15 Apr 2003 20:42:23 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id A9A425E017F5; Tue, 15 Apr 2003 20:42:17 +0300 (EEST)
Subject: [dovecot] Re: current cvs
From: Timo Sirainen <tss@iki.fi>
To: Farkas Levente <lfarkas@bnap.hu>
Cc: Dovecot List <dovecot@procontrol.fi>
In-Reply-To: <3E9C3F8F.2050006@bnap.hu>
References: <3E9C3F8F.2050006@bnap.hu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1050428537.16120.8.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 15 Apr 2003 20:42:17 +0300
X-archive-position: 584
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 587                                                  
Status: O
Content-Length: 1316

On Tue, 2003-04-15 at 20:21, Farkas Levente wrote:
> hi,
> so after upgrade to the current cvs all of our problem disappear:-)
> but we don't have time to test the ssl part...
> although after I compile and install the new dovecot I stop it I do a
> --------------------
> find /home/*/Maildir -name '.imap*' -exec rm {} \;

This is fine, but as you noticed regenerating indexes isn't very fast :)
Also currently Dovecot doesn't behave too nicely if the index gets
deleted while it was open.

> find /home/*/Maildir -name 'dovecot-uidlist' -exec rm {} \;

There shouldn't be any need to do this. Point of it was that the UIDs
will be remembered if indexes are deleted so client doesn't have to
invalidate local cache.

> find /home/*/Maildir -name 'msgid.cache' -exec rm {} \;

Not created by Dovecot.

> find /home/*/Maildir -name '.customflags' -exec rm {}\;

Should never be deleted with maildir. This contains user-defined flag
names so it could cause some data loss.

> I don't know the exact reason bu I assume dovecot is regenerate 
> everybody's index a other cache at the same time. is there any way to 
> reduce the possible number of IO load? this would be useful if never 
> happend again!:-)

Currently it re-reads all the mails in the directory and indexes them.
I'll make this configurable some day.


From dom@cus.org.uk  Tue Apr 15 20:45:24 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 15 Apr 2003 20:45:24 +0300 (EEST)
Return-Path: <dom@cus.org.uk>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from cus.org.uk (host213-106-240-81.no-dns-yet.ntli.net [213.106.240.81])
	by danu.procontrol.fi (Postfix) with ESMTP id 7FEAD238C9
	for <dovecot@procontrol.fi>; Tue, 15 Apr 2003 20:45:22 +0300 (EEST)
Received: from cus.org.uk (localhost.cus.org.uk [127.0.0.1])
	by cus.org.uk (8.12.6/8.11.3) with ESMTP id h3FHjLLX091355
	for <dovecot@procontrol.fi>; Tue, 15 Apr 2003 18:45:21 +0100 (BST)
	(envelope-from dom@cus.org.uk)
Received: (from dom@localhost)
	by cus.org.uk (8.12.6/8.12.6/Submit) id h3FHjLah091354
	for dovecot@procontrol.fi; Tue, 15 Apr 2003 18:45:21 +0100 (BST)
Date: Tue, 15 Apr 2003 18:45:21 +0100
From: Dominic Marks <dom@cus.org.uk>
To: dovecot@procontrol.fi
Subject: [dovecot] PATCH allow_zero_gid option
Message-ID: <20030415174521.GA90876@cus.org.uk>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.4i
X-archive-position: 585
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: dom@cus.org.uk
Precedence: bulk
X-list: dovecot
X-UID: 588                                                  
Status: O
Content-Length: 7048

Hey,

Well, that was easy :-) Patch against CVS follows:

Summary:
 Created a boolean option allow_zero_gid, when set to yes it will allow
 logins from users whose group id is zero. Tested with KMail 3.1.1 on
 FreeBSD 4.8. I'm not sure if my method for passing the boolean via the
 environment is correct, it looks a little on the ugly side.

Index: src/lib/restrict-access.c
===================================================================
RCS file: /home/cvs/dovecot/src/lib/restrict-access.c,v
retrieving revision 1.10
diff -u -3 -p -r1.10 restrict-access.c
--- src/lib/restrict-access.c	4 Mar 2003 04:00:13 -0000	1.10
+++ src/lib/restrict-access.c	15 Apr 2003 17:37:26 -0000
@@ -31,12 +31,14 @@
 #include <grp.h>
 
 void restrict_access_set_env(const char *user, uid_t uid, gid_t gid,
-			     const char *chroot_dir)
+		 	     const char *chroot_dir, int allow_zg)
 {
 	if (user != NULL && *user != '\0')
 		env_put(t_strconcat("RESTRICT_USER=", user, NULL));
 	if (chroot_dir != NULL && *chroot_dir != '\0')
 		env_put(t_strconcat("RESTRICT_CHROOT=", chroot_dir, NULL));
+	if (allow_zg == TRUE)
+		env_put(t_strdup("ALLOW_ZERO_GID=TRUE"));
 
 	env_put(t_strdup_printf("RESTRICT_SETUID=%s", dec2str(uid)));
 	env_put(t_strdup_printf("RESTRICT_SETGID=%s", dec2str(gid)));
@@ -45,6 +47,7 @@ void restrict_access_set_env(const char 
 void restrict_access_by_env(int disallow_root)
 {
 	const char *env;
+	int allow_zero_gid;
 	gid_t gid;
 	uid_t uid;
 
@@ -97,8 +100,14 @@ void restrict_access_by_env(int disallow
 			i_fatal("We couldn't drop root privileges");
 	}
 
-	if ((gid != 0 && uid != 0) || disallow_root) {
+	/* allow users with zero group id permission for BSD */
+	env = getenv("ALLOW_ZERO_GID");
+	allow_zero_gid = env == NULL ? FALSE : TRUE;
+
+	if (allow_zero_gid == FALSE &&
+		((gid != 0 && uid != 0) || disallow_root)) {
 		if (getgid() == 0 || getegid() == 0 || setgid(0) == 0)
 			i_fatal("We couldn't drop root group privileges");
 	}
+
 }
Index: src/lib/restrict-access.h
===================================================================
RCS file: /home/cvs/dovecot/src/lib/restrict-access.h,v
retrieving revision 1.4
diff -u -3 -p -r1.4 restrict-access.h
--- src/lib/restrict-access.h	4 Mar 2003 04:00:13 -0000	1.4
+++ src/lib/restrict-access.h	15 Apr 2003 17:37:26 -0000
@@ -4,7 +4,7 @@
 /* set environment variables so they can be read with
    restrict_access_by_env() */
 void restrict_access_set_env(const char *user, uid_t uid, gid_t gid,
-			     const char *chroot_dir);
+			     const char *chroot_dir, int allow_zg);
 
 /* chroot, setuid() and setgid() based on environment variables.
    If disallow_roots is TRUE, we'll kill ourself if we didn't have the
Index: src/master/auth-process.c
===================================================================
RCS file: /home/cvs/dovecot/src/master/auth-process.c,v
retrieving revision 1.41
diff -u -3 -p -r1.41 auth-process.c
--- src/master/auth-process.c	2 Apr 2003 02:09:41 -0000	1.41
+++ src/master/auth-process.c	15 Apr 2003 17:37:27 -0000
@@ -307,7 +307,7 @@ static pid_t create_auth_process(struct 
 
 	/* setup access environment */
 	restrict_access_set_env(group->set->user, pwd->pw_uid, pwd->pw_gid,
-				group->set->chroot);
+				group->set->chroot, set->allow_zero_gid);
 
 	/* set other environment */
 	env_put(t_strconcat("AUTH_PROCESS=", dec2str(getpid()), NULL));
Index: src/master/login-process.c
===================================================================
RCS file: /home/cvs/dovecot/src/master/login-process.c,v
retrieving revision 1.40
diff -u -3 -p -r1.40 login-process.c
--- src/master/login-process.c	15 Apr 2003 16:58:48 -0000	1.40
+++ src/master/login-process.c	15 Apr 2003 17:37:27 -0000
@@ -384,7 +384,8 @@ static void login_process_init_env(struc
 	   clean_child_process() since it clears environment */
 	restrict_access_set_env(group->set->user,
 				group->set->uid, set->login_gid,
-				set->login_chroot ? set->login_dir : NULL);
+				set->login_chroot ? set->login_dir : NULL,
+				set->allow_zero_gid);
 
 	env_put("DOVECOT_MASTER=1");
 
Index: src/master/mail-process.c
===================================================================
RCS file: /home/cvs/dovecot/src/master/mail-process.c,v
retrieving revision 1.13
diff -u -3 -p -r1.13 mail-process.c
--- src/master/mail-process.c	15 Apr 2003 16:58:48 -0000	1.13
+++ src/master/mail-process.c	15 Apr 2003 17:37:28 -0000
@@ -25,7 +25,7 @@ static int validate_uid_gid(uid_t uid, g
 		return FALSE;
 	}
 
-	if (uid != 0 && gid == 0) {
+	if (set->allow_zero_gid == FALSE && uid != 0 && gid == 0) {
 		i_error("mail process isn't allowed to be in group 0");
 		return FALSE;
 	}
@@ -38,8 +38,9 @@ static int validate_uid_gid(uid_t uid, g
 		return FALSE;
 	}
 
-	if (gid < (gid_t)set->first_valid_gid ||
-	    (set->last_valid_gid != 0 && gid > (gid_t)set->last_valid_gid)) {
+	if (set->allow_zero_gid == FALSE &&
+	    (gid < (gid_t)set->first_valid_gid ||
+	    (set->last_valid_gid != 0 && gid > (gid_t)set->last_valid_gid))) {
 		i_error("mail process isn't allowed to use "
 			"GID %s (UID is %s)", dec2str(gid), dec2str(uid));
 		return FALSE;
@@ -150,7 +151,8 @@ int create_mail_process(int socket, stru
 	   (paranoia about filling up environment without noticing) */
 	restrict_access_set_env(data + reply->system_user_idx,
 				reply->uid, reply->gid,
-				reply->chroot ? data + reply->home_idx : NULL);
+				reply->chroot ? data + reply->home_idx : NULL,
+				set->allow_zero_gid);
 
 	restrict_process_size(process_size, (unsigned int)-1);
 
Index: src/master/master-settings.c
===================================================================
RCS file: /home/cvs/dovecot/src/master/master-settings.c,v
retrieving revision 1.16
diff -u -3 -p -r1.16 master-settings.c
--- src/master/master-settings.c	2 Apr 2003 02:09:41 -0000	1.16
+++ src/master/master-settings.c	15 Apr 2003 17:37:28 -0000
@@ -46,6 +46,7 @@ static struct setting_def setting_defs[]
 	DEF(SET_INT, max_mail_processes),
 	DEF(SET_BOOL, verbose_proctitle),
 
+	DEF(SET_BOOL, allow_zero_gid),
 	DEF(SET_INT, first_valid_uid),
 	DEF(SET_INT, last_valid_uid),
 	DEF(SET_INT, first_valid_gid),
@@ -153,6 +154,7 @@ struct settings default_settings = {
 	MEMBER(max_mail_processes) 1024,
 	MEMBER(verbose_proctitle) FALSE,
 
+	MEMBER(allow_zero_gid) FALSE,
 	MEMBER(first_valid_uid) 500,
 	MEMBER(last_valid_uid) 0,
 	MEMBER(first_valid_gid) 1,
Index: src/master/master-settings.h
===================================================================
RCS file: /home/cvs/dovecot/src/master/master-settings.h,v
retrieving revision 1.10
diff -u -3 -p -r1.10 master-settings.h
--- src/master/master-settings.h	2 Apr 2003 02:09:41 -0000	1.10
+++ src/master/master-settings.h	15 Apr 2003 17:37:29 -0000
@@ -32,6 +32,7 @@ struct settings {
 	unsigned int max_mail_processes;
 	int verbose_proctitle;
 
+	int allow_zero_gid;
 	unsigned int first_valid_uid, last_valid_uid;
 	unsigned int first_valid_gid, last_valid_gid;
 
Thanks,
-- 
Dominic
 <dom at cus.org.uk> <d.marks at student.umist.ac.uk>

From tss@iki.fi  Tue Apr 15 20:48:04 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 15 Apr 2003 20:48:04 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id B3017238C9
	for <dovecot@procontrol.fi>; Tue, 15 Apr 2003 20:48:04 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 437725E017F5; Tue, 15 Apr 2003 20:48:04 +0300 (EEST)
Subject: [dovecot] Re: Shadow password file
From: Timo Sirainen <tss@iki.fi>
To: Jaime Medrano <overflow@eurielec.etsit.upm.es>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030415162513.GA2068@eurielec.etsit.upm.es>
References: <20030415162513.GA2068@eurielec.etsit.upm.es>
Content-Type: text/plain; charset=ISO-8859-15
Content-Transfer-Encoding: quoted-printable
Organization: 
Message-Id: <1050428884.16120.15.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 15 Apr 2003 20:48:04 +0300
X-archive-position: 586
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 589                                                  
Status: O

On Tue, 2003-04-15 at 19:25, Jaime Medrano wrote:
> =BFIs there any way to make dovecot to take the passwords from a file wit=
h
> a shadow password format?
>=20
> I've tried with the passwd-file auth plugin, but it complains that users
> have uid=3D0

There's two separate authentication parts. "passdb" where dovecot gets
passwords and "userdb" where uid/gid/homedir/etc are stored.

You should be able to use shadow file with passwd-file for passdb, but
you have to use something else for userdb. "static" might be enough for
you.


From tss@iki.fi  Tue Apr 15 20:54:37 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 15 Apr 2003 20:54:37 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 70F80238D3
	for <dovecot@procontrol.fi>; Tue, 15 Apr 2003 20:54:37 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id E6CFF5E017F5; Tue, 15 Apr 2003 20:54:36 +0300 (EEST)
Subject: [dovecot] Re: PATCH allow_zero_gid option
From: Timo Sirainen <tss@iki.fi>
To: Dominic Marks <dom@cus.org.uk>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030415174521.GA90876@cus.org.uk>
References: <20030415174521.GA90876@cus.org.uk>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1050429276.16120.22.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 15 Apr 2003 20:54:36 +0300
X-archive-position: 587
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 590                                                  
Status: O

On Tue, 2003-04-15 at 20:45, Dominic Marks wrote:
> Hey,
> 
> Well, that was easy :-) Patch against CVS follows:
> 
> Summary:
>  Created a boolean option allow_zero_gid, when set to yes it will allow
>  logins from users whose group id is zero. Tested with KMail 3.1.1 on
>  FreeBSD 4.8. I'm not sure if my method for passing the boolean via the
>  environment is correct, it looks a little on the ugly side.

Well, almost fine, but I'll move the allow_zg only to
restrict_access_by_env() like disallow_root is done. So this setting
doesn't affect created auth or login processes.


From tss@iki.fi  Tue Apr 15 20:59:36 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 15 Apr 2003 20:59:36 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 70A08238D3
	for <dovecot@procontrol.fi>; Tue, 15 Apr 2003 20:59:36 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 116E45E017F5; Tue, 15 Apr 2003 20:59:36 +0300 (EEST)
Subject: [dovecot] Re: PATCH allow_zero_gid option
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <1050429276.16120.22.camel@hurina>
References: <20030415174521.GA90876@cus.org.uk>
	 <1050429276.16120.22.camel@hurina>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1050429575.16118.26.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 15 Apr 2003 20:59:35 +0300
X-archive-position: 588
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 591                                                  
Status: O

On Tue, 2003-04-15 at 20:54, Timo Sirainen wrote:
> Well, almost fine, but I'll move the allow_zg only to
> restrict_access_by_env() like disallow_root is done. So this setting
> doesn't affect created auth or login processes.

Uhm. No, you had done that too but .. anyway, a bit cleaner :) Also I
don't think you should have allow_zero_gid setting for login process.
That really should be run under fully nonprivileged UID.


From mem@mv.mv.com  Wed Apr 16 00:07:39 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 16 Apr 2003 00:07:39 +0300 (EEST)
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id BA9C4238D2
	for <dovecot@procontrol.fi>; Wed, 16 Apr 2003 00:07:30 +0300 (EEST)
Received: (qmail 21523 invoked by uid 101); 15 Apr 2003 17:07:29 -0400
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Tue, 15 Apr 2003 17:07:29 -0400
To: dovecot@procontrol.fi
Subject: [dovecot] pop3 coredump
Message-ID: <20030415210729.GA7000@iridium.mv.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.4.1i
X-archive-position: 589
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mem@mv.mv.com
Precedence: bulk
X-list: dovecot
X-UID: 592                                                  
Status: O
Content-Length: 9286

Hi-

I was able to get a coredump out of the new pop3 (from 0.99.9-test4)
by attempting to simulate the execution environment and simply running
the pop3 program.

Running the older pop3 from 0.99.8.1 works fine, repeatedly:

% /usr/local/libexec/dovecot/pop3
quit
+OK Logging out.

However running the new one:

% /usr/local/libexec/dovecot/pop3.new
pop3(user9): Error: Corrupted index file
/users/48/user9/Maildir/.INBOX/.imap.index:  index.next_uid (4539) >
uidlist.next_uid (4000)
Segmentation fault (core dumped)

It doesn't always dump core even with this message.  The error message
is not always the same, but it's usually what's above.  Simply
repeating the invocation a number of times I also saw:

pop3(user9): Error: Corrupted index file (in-memory index for
/users/48/user9/Maildir): Filename mismatch for UID 1:
1050440153.17005.mercury.mv.net vs 1050437948.5418.mercury.mv.net

Here's some gdb output corresponding to the coredump above.

-mm-


Script started on Tue Apr 15 16:51:28 2003
% gdb pop3/pop3 pop3.core
  ...
Program terminated with signal 11, Segmentation fault.
Reading symbols from /usr/local/lib/libiconv.so.2...done.
Reading symbols from /shlib/libgcc.so.1...done.
Reading symbols from /shlib/libc.so.2...done.
Reading symbols from /shlib/ld-bsdi.so...done.
#0  0x0 in ?? ()
(gdb) bt
#0  0x0 in ?? ()
#1  0x8053439 in index_storage_init (storage=0x808f000, box=0x8080658, 
    index=0x808c200, name=0x807660e "INBOX", readonly=0, fast=0)
    at index-storage.c:264
#2  0x804b8e0 in maildir_open (storage=0x808f000, name=0x807660e "INBOX", 
    readonly=0, fast=0) at maildir-storage.c:239
#3  0x804ba20 in maildir_open_mailbox (storage=0x808f000, 
    name=0x80765b1 "INBOX", readonly=0, fast=0) at maildir-storage.c:288
#4  0x804b1c7 in main_init () at main.c:98
#5  0x804b269 in main (argc=1, argv=0x8047d3c, envp=0x8047d44) at main.c:132
#6  0x8049cae in __start ()
(gdb) up 1
#1  0x8053439 in index_storage_init (storage=0x808f000, box=0x8080658, 
    index=0x808c200, name=0x807660e "INBOX", readonly=0, fast=0)
    at index-storage.c:264
264                                     storage->callbacks->notify_no(&ibox->box,
(gdb) l
259                             if (!index->open(index, flags))
260                                     break;
261     
262                             if (INDEX_IS_IN_MEMORY(index) &&
263                                 storage->index_dir != NULL) {
264                                     storage->callbacks->notify_no(&ibox->box,
265                                             "Couldn't use index files",
266                                             storage->callback_context);
267                             }
268                     }
(gdb) p index
$1 = (struct mail_index *) 0x808c200
(gdb) p *index
$2 = {open = 0x8054590 <maildir_index_open>, 
  free = 0x8054abc <maildir_index_free>, 
  set_lock = 0x805c874 <mail_index_set_lock>, 
  try_lock = 0x805c88c <mail_index_try_lock>, 
  set_lock_notify_callback = 0x805c8a4 <mail_index_set_lock_notify_callback>, 
  rebuild = 0x8054f20 <maildir_index_rebuild>, 
  fsck = 0x805de50 <mail_index_fsck>, 
  sync_and_lock = 0x8055db4 <maildir_index_sync>, 
  get_header = 0x805c928 <mail_index_get_header>, 
  lookup = 0x805c968 <mail_index_lookup>, next = 0x805cac0 <mail_index_next>, 
  lookup_uid_range = 0x805cb48 <mail_index_lookup_uid_range>, 
  lookup_field = 0x805cc58 <mail_index_lookup_field>, 
  lookup_field_raw = 0x805ccac <mail_index_lookup_field_raw>, 
  cache_fields_later = 0x805cd70 <mail_index_cache_fields_later>, 
  open_mail = 0x8054de0 <maildir_open_mail>, 
  get_internal_date = 0x8054afc <maildir_get_internal_date>, 
  expunge = 0x805d078 <mail_index_expunge>, 
  update_flags = 0x8054b6c <maildir_index_update_flags>, 
  append_begin = 0x805d3ec <mail_index_append_begin>, 
  append_end = 0x805d4e4 <mail_index_append_end>, 
  append_abort = 0x805d590 <mail_index_append_abort>, 
  update_begin = 0x805f9b0 <mail_index_update_begin>, 
  update_end = 0x805ff68 <mail_index_update_end>, 
  update_abort = 0x8060050 <mail_index_update_abort>, 
  update_field = 0x806022c <mail_index_update_field>, 
  update_field_raw = 0x806025c <mail_index_update_field_raw>, 
  get_last_error = 0x805d618 <mail_index_get_last_error>, 
  get_last_error_text = 0x805d678 <mail_index_get_last_error_text>, 
  data = 0x80821a0, tree = 0x80900c0, modifylog = 0x808d200, 
  custom_flags = 0x808d100, 
  dir = 0x8090000 "/users/48/user9/Maildir/.INBOX", 
  filepath = 0x8090040 "(in-memory index for /users/48/user9/Maildir)", 
  mailbox_path = 0x8082160 "/users/48/user9/Maildir", 
  custom_flags_dir = 0x0, default_cache_fields = 0, never_cache_fields = 0, 
  indexid = 1050439124, sync_id = 6, excl_lock_counter = 1, mbox_fd = 0, 
  mbox_stream = 0x0, mbox_lock_type = MAIL_LOCK_UNLOCK, mbox_dotlock = {
    dev = 0, ino = 0, mtime = 0}, mbox_lock_counter = 0, mbox_sync_counter = 0, 
  mbox_size = 0, mbox_dev = 0, mbox_ino = 0, uidlist_dev = 18875392, 
  uidlist_ino = 1835546, maildir_lock_fd = -1, fd = -1, error = 0x0, 
  mmap_base = 0x20073000, mmap_used_length = 264, mmap_full_length = 1608, 
  header = 0x20073000, lock_type = MAIL_LOCK_EXCLUSIVE, 
  file_sync_stamp = 1050438868, first_recent_uid = 1, 
  lock_notify_cb = 0x8053238 <lock_notify>, lock_notify_context = 0x808c400, 
  set_flags = 0, set_cache_fields = 0, anon_mmap = 1, opened = 0, 
  rebuilding = 0, mail_read_mmaped = 0, inconsistent = 0, nodiskspace = 0, 
  index_lock_timeout = 0, allow_new_custom_flags = 0, mailbox_readonly = 0, 
  mailbox_lock_timeout = 0}
(gdb) p storage
$3 = (struct mail_storage *) 0x808f000
(gdb) p *storage
$5 = {name = 0x8076805 "maildir", hierarchy_sep = 46 '.', 
  create = 0x804b2c0 <maildir_create>, free = 0x804b428 <maildir_free>, 
  autodetect = 0x804b480 <maildir_autodetect>, 
  set_callbacks = 0x80535e4 <index_storage_set_callbacks>, 
  open_mailbox = 0x804b940 <maildir_open_mailbox>, 
  create_mailbox = 0x804ba5c <maildir_create_mailbox>, 
  delete_mailbox = 0x804bb08 <maildir_delete_mailbox>, 
  rename_mailbox = 0x804bea4 <maildir_rename_mailbox>, 
  list_mailbox_init = 0x804c624 <maildir_list_mailbox_init>, 
  list_mailbox_deinit = 0x804c800 <maildir_list_mailbox_deinit>, 
  list_mailbox_next = 0x804cc48 <maildir_list_mailbox_next>, 
  set_subscribed = 0x8064594 <subsfile_set_subscribed>, 
  get_mailbox_name_status = 0x804bffc <maildir_get_mailbox_name_status>, 
  get_last_error = 0x805455c <mail_storage_get_last_error>, 
  dir = 0x8082100 "/users/48/user9/Maildir", inbox_file = 0x0, 
  index_dir = 0x8082120 "/users/48/user9/Maildir", 
  user = 0x808e050 "user9", error = 0x0, callbacks = 0x8082140, 
  callback_context = 0x0, syntax_error = 0}
(gdb) p ibox
$6 = (struct index_mailbox *) 0x808c400
(gdb) p *ibox
$7 = {box = {name = 0x808e070 "INBOX", storage = 0x808f000, 
    close = 0x805359c <index_storage_close>, 
    get_status = 0x8052ee4 <index_storage_get_status>, 
    sync = 0x8053b94 <index_storage_sync>, 
    auto_sync = 0x804c0c8 <maildir_storage_auto_sync>, 
    expunge = 0x804fa64 <index_storage_expunge>, 
    update_flags = 0x8053d58 <index_storage_update_flags>, 
    copy = 0x804c3e4 <maildir_storage_copy>, 
    fetch_init = 0x804fb00 <index_storage_fetch_init>, 
    fetch_deinit = 0x804fbe8 <index_storage_fetch_deinit>, 
    fetch_next = 0x804fc70 <index_storage_fetch_next>, 
    fetch_uid = 0x804fd5c <index_storage_fetch_uid>, 
    fetch_seq = 0x804fdc0 <index_storage_fetch_seq>, 
    search_get_sorting = 0x8052af4 <index_storage_search_get_sorting>, 
    search_init = 0x8052b08 <index_storage_search_init>, 
    search_deinit = 0x8052be0 <index_storage_search_deinit>, 
    search_next = 0x8052ca0 <index_storage_search_next>, 
    save_init = 0x804cf4c <maildir_storage_save_init>, 
    save_deinit = 0x804cfe0 <maildir_storage_save_deinit>, 
    save_next = 0x804ce04 <maildir_storage_save_next>, 
    is_inconsistency_error = 0x8054578 <mail_storage_is_inconsistency_error>, 
    readonly = 0, allow_custom_flags = 0, inconsistent = 0}, 
  expunge_locked = 0, index = 0x808c200, autosync_to = 0x0, 
  autosync_files = 0x0, autosync_type = MAILBOX_SYNC_NONE, sync_last_check = 0, 
  min_newmail_notify_interval = 0, fetch_mail = {mail = {seq = 0, uid = 0, 
      seen_updated = 0, get_flags = 0, get_parts = 0, get_received_date = 0, 
      get_date = 0, get_size = 0, get_header = 0, get_address = 0, 
      get_first_mailbox = 0, get_stream = 0, get_special = 0}, data = {flags = {
        flags = 0, custom_flags = 0x0, custom_flags_count = 0}, 
      received_date = 0, size = 0, sent_time = 0, sent_timezone = 0, 
      headers = 0x0, parts = 0x0, envelope = 0x0, body = 0x0, 
      bodystructure = 0x0, envelope_data = 0x0, rec = 0x0, stream = 0x0, 
      hdr_size = {physical_size = 0, virtual_size = 0, lines = 0}, body_size = {
        physical_size = 0, virtual_size = 0, lines = 0}, parse_header = 0, 
      save_sent_time = 0, save_envelope = 0, hdr_size_set = 0, 
      body_size_set = 0}, pool = 0x0, ibox = 0x0, header_buf = 0x0, 
    wanted_fields = 0, wanted_headers = 0x0}, synced_messages_count = 0, 
  next_lock_notify = 1050439154, 
  last_notify_type = MAIL_LOCK_NOTIFY_MAILBOX_ABORT, sent_diskspace_warning = 0}
(gdb) quit
% exit
Script done on Tue Apr 15 16:53:06 2003

From charlieb@e-smith.com  Wed Apr 16 00:58:21 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 16 Apr 2003 01:29:56 +0300 (EEST)
Return-Path: <charlieb@e-smith.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from nssg.mitel.com (mail.e-smith.com [216.191.234.126])
	by danu.procontrol.fi (Postfix) with SMTP id 8560A23993
	for <dovecot@procontrol.fi>; Wed, 16 Apr 2003 00:58:20 +0300 (EEST)
Received: (qmail 713 invoked by uid 404); 15 Apr 2003 21:58:19 -0000
Received: from charlieb@e-smith.com by tripe.nssg.mitel.com with qmail-scanner; 15 Apr 2003 17:58:19 -0000
Received: from allspice-core.nssg.mitel.com (HELO e-smith.com) (10.33.16.12)
  by tripe.nssg.mitel.com (10.33.17.11) with SMTP; 15 Apr 2003 21:58:19 -0000
Received: (qmail 6226 invoked from network); 15 Apr 2003 21:58:19 -0000
Received: from vegemite.nssg.mitel.com (10.33.15.70)
  by allspice.nssg.mitel.com with QMQP; 15 Apr 2003 21:58:19 -0000
Received: from localhost (sendmail-bs@127.0.0.1)
  by localhost with SMTP; 15 Apr 2003 22:03:27 -0000
Date: Tue, 15 Apr 2003 18:03:27 -0400 (EDT)
From: Charlie Brady <charlieb@e-smith.com>
X-X-Sender: charlieb@vegemite.nssg.mitel.com
To: dovecot@procontrol.fi
Subject: [dovecot] Changing hierarchy separator to '/'
Message-ID: <Pine.LNX.4.44.0304151754270.2004-100000@vegemite.nssg.mitel.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 590
X-Approved-By: tss@iki.fi
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: charlieb@e-smith.com
Precedence: bulk
X-list: dovecot
X-UID: 593                                                  
Status: O


From TODO:

...
    - maildir: change it to use '/' as hierarchy separator to allow '.'
      characters (for usernames in shared folders)
...

Now changing the separator in the maildir-storage.c is trivial (even 
though it "can't" be changed :-), but fixing the resultant breakage in 
maildir-list.c needs a little more understanding. Timo, could you give me 
some pointers? I can see that I need to work out what imap_match_init() 
does.

My motivation is to follow up on an earlier thread about reusing 
.mailboxlist files as .subscription files, preferably without rewriting 
them to replace the slashes with something else.

Thanks

--
Charlie




From tss@iki.fi  Wed Apr 16 02:17:21 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 16 Apr 2003 02:17:21 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 200B923993
	for <dovecot@procontrol.fi>; Wed, 16 Apr 2003 02:17:21 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 88F8A5E017F5; Wed, 16 Apr 2003 02:17:20 +0300 (EEST)
Subject: [dovecot] Re: pop3 coredump
From: Timo Sirainen <tss@iki.fi>
To: "Mark E. Mallett" <mem@mv.mv.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030415210729.GA7000@iridium.mv.net>
References: <20030415210729.GA7000@iridium.mv.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1050448640.16342.14.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 16 Apr 2003 02:17:20 +0300
X-archive-position: 591
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 594                                                  
Status: O

On Wed, 2003-04-16 at 00:07, Mark E. Mallett wrote:
> % /usr/local/libexec/dovecot/pop3.new
> pop3(user9): Error: Corrupted index file
> /users/48/user9/Maildir/.INBOX/.imap.index:  index.next_uid (4539) >
> uidlist.next_uid (4000)

What if you delete the dovecot-uidlist file? Or the index files? Does it
still do this?

> #0  0x0 in ?? ()
> #1  0x8053439 in index_storage_init (storage=0x808f000, box=0x8080658, 
>     index=0x808c200, name=0x807660e "INBOX", readonly=0, fast=0)
>     at index-storage.c:264

Thanks, this helps to fix the crash. It doesn't explain the "corrupted
index file" messages though, except that they never get fixed because of
this.


From mem@mv.mv.com  Wed Apr 16 02:35:09 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 16 Apr 2003 02:35:09 +0300 (EEST)
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id B82CE23845
	for <dovecot@procontrol.fi>; Wed, 16 Apr 2003 02:35:08 +0300 (EEST)
Received: (qmail 6449 invoked by uid 101); 15 Apr 2003 19:35:07 -0400
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Tue, 15 Apr 2003 19:35:07 -0400
To: Timo Sirainen <tss@iki.fi>
Cc: "Mark E. Mallett" <mem@mv.mv.com>, dovecot@procontrol.fi
Subject: [dovecot] Re: pop3 coredump
Message-ID: <20030415233507.GC20344@iridium.mv.net>
References: <20030415210729.GA7000@iridium.mv.net> <1050448640.16342.14.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1050448640.16342.14.camel@hurina>
User-Agent: Mutt/1.4.1i
X-archive-position: 592
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mem@mv.mv.com
Precedence: bulk
X-list: dovecot
X-UID: 595                                                  
Status: O
Content-Length: 1103

On Wed, Apr 16, 2003 at 02:17:20AM +0300, Timo Sirainen wrote:
> On Wed, 2003-04-16 at 00:07, Mark E. Mallett wrote:
> > % /usr/local/libexec/dovecot/pop3.new
> > pop3(user9): Error: Corrupted index file
> > /users/48/user9/Maildir/.INBOX/.imap.index:  index.next_uid (4539) >
> > uidlist.next_uid (4000)
> 
> What if you delete the dovecot-uidlist file? Or the index files? Does it
> still do this?

If I rename dovecot-uidlist out of the way, it successfully builds a
new one and no longer complains, and is happy on repeated invocations.
If I put back the dovecot-uidlist, it is not happy again.

However- the same is true of the .imap* files.  If I move them out of
the way (and leave the old dovecot-uidlist in place), the new pop3 is
happy to build a new set and use them (again, on repeated invocations).
If I move back the old .imap* files, the error is back.

So- moving either of those helps.
The older pop3 also seems happy to use the newly generated files.
(but again it's also happy with the old ones).

I don't know what happens if new mail comes in after the new files
are generated.

mm

From tss@iki.fi  Wed Apr 16 02:41:39 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 16 Apr 2003 02:41:39 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 7A72323845
	for <dovecot@procontrol.fi>; Wed, 16 Apr 2003 02:41:39 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 4A8695E017F5; Wed, 16 Apr 2003 02:41:39 +0300 (EEST)
Subject: [dovecot] Re: pop3 coredump
From: Timo Sirainen <tss@iki.fi>
To: "Mark E. Mallett" <mem@mv.mv.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030415233507.GC20344@iridium.mv.net>
References: <20030415210729.GA7000@iridium.mv.net>
	 <1050448640.16342.14.camel@hurina>  <20030415233507.GC20344@iridium.mv.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1050450098.16342.24.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 16 Apr 2003 02:41:39 +0300
X-archive-position: 593
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 596                                                  
Status: O

On Wed, 2003-04-16 at 02:35, Mark E. Mallett wrote:
> If I rename dovecot-uidlist out of the way, it successfully builds a
> new one and no longer complains, and is happy on repeated invocations.
> If I put back the dovecot-uidlist, it is not happy again.
> 
> However- the same is true of the .imap* files.  If I move them out of
> the way (and leave the old dovecot-uidlist in place), the new pop3 is
> happy to build a new set and use them (again, on repeated invocations).
> If I move back the old .imap* files, the error is back.
> 
> So- moving either of those helps.

OK, I think the problem is then just that Dovecot crashes before it has
time to rebuild index file. And it's broken because previous -test
releases broke it.

> The older pop3 also seems happy to use the newly generated files.
> (but again it's also happy with the old ones).

That's because older versions didn't use the uidlist file at all.

> I don't know what happens if new mail comes in after the new files
> are generated.

Probably works.


From overflow@eurielec.etsit.upm.es  Wed Apr 16 10:34:19 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 16 Apr 2003 10:34:19 +0300 (EEST)
Return-Path: <overflow@eurielec.etsit.upm.es>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from eurielec.etsit.upm.es (uno.eurielec.etsit.upm.es [138.100.31.227])
	by danu.procontrol.fi (Postfix) with ESMTP id 5768823845
	for <dovecot@procontrol.fi>; Wed, 16 Apr 2003 10:34:19 +0300 (EEST)
Received: from eurielec.etsit.upm.es (www.eurielec.etsit.upm.es [138.100.31.226])
	by eurielec.etsit.upm.es (Postfix) with SMTP
	id C1636B3C; Wed, 16 Apr 2003 09:38:34 +0200 (CEST)
Received: from 195.235.92.108
        (SquirrelMail authenticated user overflow)
        by www.eurielec.etsit.upm.es with HTTP;
        Wed, 16 Apr 2003 09:32:03 +0200 (CEST)
Message-ID: <54899.195.235.92.108.1050478323.squirrel@www.eurielec.etsit.upm.es>
Date: Wed, 16 Apr 2003 09:32:03 +0200 (CEST)
Subject: [dovecot] Re: Shadow password file
From: "Jaime Medrano" <overflow@eurielec.etsit.upm.es>
To: <tss@iki.fi>
In-Reply-To: <1050428884.16120.15.camel@hurina>
References: <20030415162513.GA2068@eurielec.etsit.upm.es>
        <1050428884.16120.15.camel@hurina>
X-Priority: 3
Importance: Normal
X-MSMail-Priority: Normal
Cc: <dovecot@procontrol.fi>
X-Mailer: SquirrelMail (version 1.2.6)
MIME-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-15
Content-Transfer-Encoding: 8bit
X-archive-position: 594
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: overflow@eurielec.etsit.upm.es
Precedence: bulk
X-list: dovecot
X-UID: 597                                                  
Status: O

> On Tue, 2003-04-15 at 19:25, Jaime Medrano wrote:
>> ¿Is there any way to make dovecot to take the passwords from a file
>> with a shadow password format?
>>
>> I've tried with the passwd-file auth plugin, but it complains that
>> users have uid=0
>
> There's two separate authentication parts. "passdb" where dovecot gets
> passwords and "userdb" where uid/gid/homedir/etc are stored.
>
> You should be able to use shadow file with passwd-file for passdb, but
> you have to use something else for userdb. "static" might be enough for
> you.

The thing is I've got a server where imap users are the same of local
users, but with different passwords. I've used for userdb, the passwd-file
module with the passwd  file, and the passwd module and both seem to work.
However, when I use passwd-file for passdb with the shadow file where the
imap passwords are stored I can see in the logs an error saying that every
user has uid=0.


From lfarkas@bnap.hu  Wed Apr 16 11:35:10 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 16 Apr 2003 11:35:10 +0300 (EEST)
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 003F02385F
	for <dovecot@procontrol.fi>; Wed, 16 Apr 2003 11:35:09 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP
	id BD863754014; Wed, 16 Apr 2003 10:35:38 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP
	id 093983EFA; Wed, 16 Apr 2003 10:34:50 +0200 (CEST)
Message-ID: <3E9D15A9.2000901@bnap.hu>
Date: Wed, 16 Apr 2003 10:34:49 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Timo Sirainen <tss@iki.fi>, Dovecot List <dovecot@procontrol.fi>
Subject: [dovecot] Re: current cvs
References: <3E9C3F8F.2050006@bnap.hu> <1050428537.16120.8.camel@hurina>
In-Reply-To: <1050428537.16120.8.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 595
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 598                                                  
Status: O
Content-Length: 1804

Timo Sirainen wrote:
> On Tue, 2003-04-15 at 20:21, Farkas Levente wrote:
> 
>>hi,
>>so after upgrade to the current cvs all of our problem disappear:-)
>>but we don't have time to test the ssl part...
>>although after I compile and install the new dovecot I stop it I do a
>>--------------------
>>find /home/*/Maildir -name '.imap*' -exec rm {} \;
> 
> 
> This is fine, but as you noticed regenerating indexes isn't very fast :)
> Also currently Dovecot doesn't behave too nicely if the index gets
> deleted while it was open.
> 
> 
>>find /home/*/Maildir -name 'dovecot-uidlist' -exec rm {} \;
> 
> 
> There shouldn't be any need to do this. Point of it was that the UIDs
> will be remembered if indexes are deleted so client doesn't have to
> invalidate local cache.
> 
> 
>>find /home/*/Maildir -name 'msgid.cache' -exec rm {} \;
> 
> 
> Not created by Dovecot.
> 
> 
>>find /home/*/Maildir -name '.customflags' -exec rm {}\;
> 
> 
> Should never be deleted with maildir. This contains user-defined flag
> names so it could cause some data loss.
> 
> 
>>I don't know the exact reason bu I assume dovecot is regenerate 
>>everybody's index a other cache at the same time. is there any way to 
>>reduce the possible number of IO load? this would be useful if never 
>>happend again!:-)
> 
> 
> Currently it re-reads all the mails in the directory and indexes them.
> I'll make this configurable some day.

the whole mails or just the headers?
as you know we've a lots of big mails so this makes a real different!

ok so what is the best way to be sure that no cached information can 
confuse the new version? just:
- stop dovecot
- kill all imap process
- find /home/*/Maildir -name '.imap*' -exec rm {} \;
- start dovecot
?

-- 
   Levente                               "Si vis pacem para bellum!"



From lfarkas@bnap.hu  Wed Apr 16 11:58:16 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 16 Apr 2003 11:58:16 +0300 (EEST)
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 3DF9E2385F
	for <dovecot@procontrol.fi>; Wed, 16 Apr 2003 11:58:16 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id 15A0075400C
	for <dovecot@procontrol.fi>; Wed, 16 Apr 2003 10:58:52 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id 772F33EFB
	for <dovecot@procontrol.fi>; Wed, 16 Apr 2003 10:58:15 +0200 (CEST)
Message-ID: <3E9D1B27.7090201@bnap.hu>
Date: Wed, 16 Apr 2003 10:58:15 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: [dovecot] errors
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 596
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 599                                                  
Status: O

hi,
in the yesterday cvs, an internal error in the imap message appear in 
the client side and in the maillog:
-------------------------
Apr 16 10:01:42 red imap(zgabor): Corrupted index file 
/home/zgabor/Maildir/.Lists.Bugtraq/.imap.index: Invalid seen messages 
count (284 < 285)
Apr 16 10:01:43 red imap(zgabor): Corrupted index file 
/home/zgabor/Maildir/.Lists.Linux/.imap.index: Invalid seen messages 
count (191 < 192)
Apr 16 10:01:44 red imap(zgabor): Corrupted index file (in-memory index 
for /home/zgabor/Maildir/.Lists.Linux): Filename mismatch for UID 1: 
1050448183.2238_1.red.int.bppiac.hu vs 1050321835.21498_1.red.int.bppiac.hu
-------------------------
and this version is _very_ slow!!!

-- 
   Levente                               "Si vis pacem para bellum!"



From lfarkas@bnap.hu  Wed Apr 16 12:20:28 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 16 Apr 2003 12:20:28 +0300 (EEST)
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 5208323845
	for <dovecot@procontrol.fi>; Wed, 16 Apr 2003 12:20:28 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id 4DDA5754014
	for <dovecot@procontrol.fi>; Wed, 16 Apr 2003 11:21:04 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id 8ECFD3F22
	for <dovecot@procontrol.fi>; Wed, 16 Apr 2003 11:20:27 +0200 (CEST)
Message-ID: <3E9D205B.30104@bnap.hu>
Date: Wed, 16 Apr 2003 11:20:27 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: [dovecot] it seems to unusable
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 597
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 600                                                  
Status: O

hi,
is there any way to turn off the whole indexing stuff? unfortunately the 
system getting totaly unusable beacuase of the high load and the mail 
index generation is so slow that every users call the helpdask that his 
mail is not working (what's more in this case just click on OE again and 
start another mailer process:-() we've got about 100k mails which is 
about 10-20GB!

-- 
   Levente                               "Si vis pacem para bellum!"



From tss@iki.fi  Wed Apr 16 16:39:00 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 16 Apr 2003 16:39:00 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id F189723845
	for <dovecot@procontrol.fi>; Wed, 16 Apr 2003 16:38:59 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id CF1FF5E017F5; Wed, 16 Apr 2003 16:38:59 +0300 (EEST)
Subject: [dovecot] Re: Shadow password file
From: Timo Sirainen <tss@iki.fi>
To: Jaime Medrano <overflow@eurielec.etsit.upm.es>
Cc: dovecot@procontrol.fi
In-Reply-To: <54899.195.235.92.108.1050478323.squirrel@www.eurielec.etsit.upm.es>
References: <20030415162513.GA2068@eurielec.etsit.upm.es>
	 <1050428884.16120.15.camel@hurina>
	 <54899.195.235.92.108.1050478323.squirrel@www.eurielec.etsit.upm.es>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1050500339.16342.32.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 16 Apr 2003 16:38:59 +0300
X-archive-position: 598
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 601                                                  
Status: O

On Wed, 2003-04-16 at 10:32, Jaime Medrano wrote:
> However, when I use passwd-file for passdb with the shadow file where the
> imap passwords are stored I can see in the logs an error saying that every
> user has uid=0.

So it seems. Fixed in CVS now.


From tss@iki.fi  Wed Apr 16 16:44:55 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 16 Apr 2003 16:44:55 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id AD6C223845
	for <dovecot@procontrol.fi>; Wed, 16 Apr 2003 16:44:55 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 745805E017F5; Wed, 16 Apr 2003 16:44:55 +0300 (EEST)
Subject: [dovecot] Re: current cvs
From: Timo Sirainen <tss@iki.fi>
To: Farkas Levente <lfarkas@bnap.hu>
Cc: Dovecot List <dovecot@procontrol.fi>
In-Reply-To: <3E9D15A9.2000901@bnap.hu>
References: <3E9C3F8F.2050006@bnap.hu> <1050428537.16120.8.camel@hurina>
	 <3E9D15A9.2000901@bnap.hu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1050500695.16341.39.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 16 Apr 2003 16:44:55 +0300
X-archive-position: 599
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 602                                                  
Status: O

On Wed, 2003-04-16 at 11:34, Farkas Levente wrote:
> > Currently it re-reads all the mails in the directory and indexes them.
> > I'll make this configurable some day.
> 
> the whole mails or just the headers?
> as you know we've a lots of big mails so this makes a real different!

The whole file, but you can disable that by removing MessagePart from
mail_cache_fields in config file. I think I'll fix this even more so
that the file isn't opened at all if nothing is wanted to be cached.

> ok so what is the best way to be sure that no cached information can 
> confuse the new version? just:
> - stop dovecot
> - kill all imap process
> - find /home/*/Maildir -name '.imap*' -exec rm {} \;
> - start dovecot

Well, yes, to be safe. But usually you shouldn't need to delete the
.imap* files at all. If there's any changes in format or whatever, it's
rebuilt automatically. It's needed only if it contains actually invalid
data that can't be detected, like there cached ENVELOPE texts were wrong
before.


From eskimoe@ananzi.co.za  Wed Apr 16 16:45:04 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 16 Apr 2003 16:45:04 +0300 (EEST)
Return-Path: <eskimoe@ananzi.co.za>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from sun.com (port-212-202-168-181.reverse.qdsl-home.de [212.202.168.181])
	by danu.procontrol.fi (Postfix) with SMTP id 373E823845
	for <dovecot@procontrol.fi>; Wed, 16 Apr 2003 16:45:04 +0300 (EEST)
Received: (qmail 18828 invoked by uid 1000); 16 Apr 2003 13:46:28 -0000
Date: Wed, 16 Apr 2003 15:46:28 +0200
From: Moe Wibble <eskimoe@ananzi.co.za>
To: Dovecot List <dovecot@procontrol.fi>
Subject: [dovecot] Re: errors
Message-ID: <20030416134628.GA13126@woom.net>
Mail-Followup-To: Moe Wibble <eskimoe@ananzi.co.za>,
	Dovecot List <dovecot@procontrol.fi>
References: <3E9D1B27.7090201@bnap.hu>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <3E9D1B27.7090201@bnap.hu>
X-archive-position: 600
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: eskimoe@ananzi.co.za
Precedence: bulk
X-list: dovecot
X-UID: 603                                                  
Status: O
Content-Length: 1097

On Wed, Apr 16, 2003 at 10:58:15AM +0200, Farkas Levente wrote:
> hi,
> in the yesterday cvs, an internal error in the imap message appear in 
> the client side and in the maillog:
> -------------------------
> Apr 16 10:01:42 red imap(zgabor): Corrupted index file 
> /home/zgabor/Maildir/.Lists.Bugtraq/.imap.index: Invalid seen messages 
> count (284 < 285)
> Apr 16 10:01:43 red imap(zgabor): Corrupted index file 
> /home/zgabor/Maildir/.Lists.Linux/.imap.index: Invalid seen messages 
> count (191 < 192)
> Apr 16 10:01:44 red imap(zgabor): Corrupted index file (in-memory index 
> for /home/zgabor/Maildir/.Lists.Linux): Filename mismatch for UID 1: 
> 1050448183.2238_1.red.int.bppiac.hu vs 1050321835.21498_1.red.int.bppiac.hu
> -------------------------

ACK.
I'm getting similar errors:
Apr 16 15:22:13 rafter imap(moe): Corrupted index file /<snipped>/.INBOX/.imap.index: index.next_uid (441) > uidlist.nex
t_uid (440)

Yesterday's CVS version running here.
Removing the '.imap.index'-file has stopped the errors so far.

Haven't noticed any other side effects, yet.


regards
-- 
MW


From lfarkas@bnap.hu  Wed Apr 16 16:53:16 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 16 Apr 2003 16:53:16 +0300 (EEST)
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 7B6F623845
	for <dovecot@procontrol.fi>; Wed, 16 Apr 2003 16:53:16 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP
	id 9548475400F; Wed, 16 Apr 2003 15:53:53 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP
	id 464003EEE; Wed, 16 Apr 2003 15:53:14 +0200 (CEST)
Message-ID: <3E9D6049.6080902@bnap.hu>
Date: Wed, 16 Apr 2003 15:53:13 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Moe Wibble <eskimoe@ananzi.co.za>
Cc: Dovecot List <dovecot@procontrol.fi>
Subject: [dovecot] Re: errors
References: <3E9D1B27.7090201@bnap.hu> <20030416134628.GA13126@woom.net>
In-Reply-To: <20030416134628.GA13126@woom.net>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 601
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 604                                                  
Status: O
Content-Length: 1251

Moe Wibble wrote:
> On Wed, Apr 16, 2003 at 10:58:15AM +0200, Farkas Levente wrote:
> 
>>hi,
>>in the yesterday cvs, an internal error in the imap message appear in 
>>the client side and in the maillog:
>>-------------------------
>>Apr 16 10:01:42 red imap(zgabor): Corrupted index file 
>>/home/zgabor/Maildir/.Lists.Bugtraq/.imap.index: Invalid seen messages 
>>count (284 < 285)
>>Apr 16 10:01:43 red imap(zgabor): Corrupted index file 
>>/home/zgabor/Maildir/.Lists.Linux/.imap.index: Invalid seen messages 
>>count (191 < 192)
>>Apr 16 10:01:44 red imap(zgabor): Corrupted index file (in-memory index 
>>for /home/zgabor/Maildir/.Lists.Linux): Filename mismatch for UID 1: 
>>1050448183.2238_1.red.int.bppiac.hu vs 1050321835.21498_1.red.int.bppiac.hu
>>-------------------------
> 
> 
> ACK.
> I'm getting similar errors:
> Apr 16 15:22:13 rafter imap(moe): Corrupted index file /<snipped>/.INBOX/.imap.index: index.next_uid (441) > uidlist.nex
> t_uid (440)
> 
> Yesterday's CVS version running here.
> Removing the '.imap.index'-file has stopped the errors so far.
> 
> Haven't noticed any other side effects, yet.

we still got these errors (after the delete)...


-- 
   Levente                               "Si vis pacem para bellum!"



From lfarkas@bnap.hu  Wed Apr 16 17:20:34 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 16 Apr 2003 17:20:34 +0300 (EEST)
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 022FB2385F
	for <dovecot@procontrol.fi>; Wed, 16 Apr 2003 17:20:33 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP
	id A0D1975400F; Wed, 16 Apr 2003 16:21:08 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP
	id DDCE43EEE; Wed, 16 Apr 2003 16:20:29 +0200 (CEST)
Message-ID: <3E9D66AD.1010503@bnap.hu>
Date: Wed, 16 Apr 2003 16:20:29 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Timo Sirainen <tss@iki.fi>
Cc: Dovecot List <dovecot@procontrol.fi>
Subject: [dovecot] Re: current cvs
References: <3E9C3F8F.2050006@bnap.hu> <1050428537.16120.8.camel@hurina>	 <3E9D15A9.2000901@bnap.hu> <1050500695.16341.39.camel@hurina>
In-Reply-To: <1050500695.16341.39.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 602
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 605                                                  
Status: O
Content-Length: 2191

Timo Sirainen wrote:
> On Wed, 2003-04-16 at 11:34, Farkas Levente wrote:
> 
>>>Currently it re-reads all the mails in the directory and indexes them.
>>>I'll make this configurable some day.
>>
>>the whole mails or just the headers?
>>as you know we've a lots of big mails so this makes a real different!
> 
> 
> The whole file, but you can disable that by removing MessagePart from
> mail_cache_fields in config file. I think I'll fix this even more so
> that the file isn't opened at all if nothing is wanted to be cached.

at noon we switch to
mail_cache_fields =
after that the the clients are usable again. BUT
what we can do? what would be the best choise for us?
the parameters:
- most people don't know anything about computer, mailer, internet!!
   - they use to write email in word's doc!
   - they attach pictures, exe, doc etc to their mails
   - they use OE6 which can't create rules on imap folder, can't delete
     mails one by one there is no thrash (only purge all deleted mails)
     which casue mailbox with a lots of mails (most od them already
     deleted, but wouldn't like to delete them since cant select them).

so:
- we've got about 300 mailbox
- most people just has mails in his inbox and sent folder
- this folder are real huge (a few thousend mails)
- 300 mailbox has 100000 mails which is about 16GB this means the
   avarage message size is about 160K (actualy the size are 5-10K
   or 1-5M)

so what extra (non default) parameters should I have to use (eg: 
mail_cache_fields etc.)

>>ok so what is the best way to be sure that no cached information can 
>>confuse the new version? just:
>>- stop dovecot
>>- kill all imap process
>>- find /home/*/Maildir -name '.imap*' -exec rm {} \;
>>- start dovecot
> 
> 
> Well, yes, to be safe. But usually you shouldn't need to delete the
> .imap* files at all. If there's any changes in format or whatever, it's
> rebuilt automatically. It's needed only if it contains actually invalid
> data that can't be detected, like there cached ENVELOPE texts were wrong
> before.

they were wrong in any previous version? or how can I know that?

-- 
   Levente                               "Si vis pacem para bellum!"



From lfarkas@bnap.hu  Wed Apr 16 17:22:18 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 16 Apr 2003 17:22:18 +0300 (EEST)
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 848D92385F
	for <dovecot@procontrol.fi>; Wed, 16 Apr 2003 17:22:18 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id 1069075400F
	for <dovecot@procontrol.fi>; Wed, 16 Apr 2003 16:22:56 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id 0C23A3EEE
	for <dovecot@procontrol.fi>; Wed, 16 Apr 2003 16:22:16 +0200 (CEST)
Message-ID: <3E9D6717.2@bnap.hu>
Date: Wed, 16 Apr 2003 16:22:15 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: [dovecot] Re: errors
References: <3E9D1B27.7090201@bnap.hu> <20030416134628.GA13126@woom.net> <3E9D6049.6080902@bnap.hu>
In-Reply-To: <3E9D6049.6080902@bnap.hu>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 603
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 606                                                  
Status: O
Content-Length: 1666

Farkas Levente wrote:
> Moe Wibble wrote:
> 
>> On Wed, Apr 16, 2003 at 10:58:15AM +0200, Farkas Levente wrote:
>>
>>> hi,
>>> in the yesterday cvs, an internal error in the imap message appear in 
>>> the client side and in the maillog:
>>> -------------------------
>>> Apr 16 10:01:42 red imap(zgabor): Corrupted index file 
>>> /home/zgabor/Maildir/.Lists.Bugtraq/.imap.index: Invalid seen 
>>> messages count (284 < 285)
>>> Apr 16 10:01:43 red imap(zgabor): Corrupted index file 
>>> /home/zgabor/Maildir/.Lists.Linux/.imap.index: Invalid seen messages 
>>> count (191 < 192)
>>> Apr 16 10:01:44 red imap(zgabor): Corrupted index file (in-memory 
>>> index for /home/zgabor/Maildir/.Lists.Linux): Filename mismatch for 
>>> UID 1: 1050448183.2238_1.red.int.bppiac.hu vs 
>>> 1050321835.21498_1.red.int.bppiac.hu
>>> -------------------------
>>
>>
>>
>> ACK.
>> I'm getting similar errors:
>> Apr 16 15:22:13 rafter imap(moe): Corrupted index file 
>> /<snipped>/.INBOX/.imap.index: index.next_uid (441) > uidlist.nex
>> t_uid (440)
>>
>> Yesterday's CVS version running here.
>> Removing the '.imap.index'-file has stopped the errors so far.
>>
>> Haven't noticed any other side effects, yet.
> 
> 
> we still got these errors (after the delete)...

another new messages (even after deleting the .imap*)
-----------------------------------
Apr 16 16:19:52 red imap(agodor): Corrupted index file 
/home/agodor/Maildir/.INBOX/.imap.index: Filename mismatch for UID 1: 
1050486664.4076_43.red.int.bppiac.hu vs 
1050417307.26676_43.red.int.bppiac.hu
-----------------------------------


-- 
   Levente                               "Si vis pacem para bellum!"



From tss@iki.fi  Wed Apr 16 18:42:38 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 16 Apr 2003 18:42:38 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id CE29C23845
	for <dovecot@procontrol.fi>; Wed, 16 Apr 2003 18:42:38 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 67AC05E0180C; Wed, 16 Apr 2003 18:42:38 +0300 (EEST)
Subject: [dovecot] 0.99.9-test5
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1050507758.16338.58.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 16 Apr 2003 18:42:38 +0300
X-archive-position: 604
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 607                                                  
Status: O

- Fixed startup crashing in POP3 server

- Several fixes to opening index file which needs to be rebuilt. Before
it didn't always rebuild the index but just fallbacked to using only
memory, and that could have been quite slow since all mails in the
mailbox were opened and parsed.

- If there's nothing in mail_cache_fields, index rebuilding doesn't open
the file anymore. This should make in-memory indexes a lot faster than
before, but it could also mean some performance hits later. If client
wants to fetch all mails from the mailbox, the same thing has to be done
anyway.. This needs more thinking actually what is the optimal
behaviour.

- Support /etc/shadow-like file for passdb.


From tss@iki.fi  Wed Apr 16 18:51:33 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 16 Apr 2003 18:51:33 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id BA3FA23845
	for <dovecot@procontrol.fi>; Wed, 16 Apr 2003 18:51:33 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 7B0FE5E0180C; Wed, 16 Apr 2003 18:51:33 +0300 (EEST)
Subject: [dovecot] Re: current cvs
From: Timo Sirainen <tss@iki.fi>
To: Farkas Levente <lfarkas@bnap.hu>
Cc: Dovecot List <dovecot@procontrol.fi>
In-Reply-To: <3E9D66AD.1010503@bnap.hu>
References: <3E9C3F8F.2050006@bnap.hu> <1050428537.16120.8.camel@hurina>
	 <3E9D15A9.2000901@bnap.hu> <1050500695.16341.39.camel@hurina>
	 <3E9D66AD.1010503@bnap.hu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1050508293.16341.68.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 16 Apr 2003 18:51:33 +0300
X-archive-position: 605
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 608                                                  
Status: O
Content-Length: 1430

On Wed, 2003-04-16 at 17:20, Farkas Levente wrote:
> at noon we switch to
> mail_cache_fields =
> after that the the clients are usable again.

test5 should be even more usable with this.

>  BUT
> what we can do? what would be the best choise for us?
> the parameters:
..
> - we've got about 300 mailbox
> - most people just has mails in his inbox and sent folder
> - this folder are real huge (a few thousend mails)
> - 300 mailbox has 100000 mails which is about 16GB this means the
>    avarage message size is about 160K (actualy the size are 5-10K
>    or 1-5M)
> 
> so what extra (non default) parameters should I have to use (eg: 
> mail_cache_fields etc.)

There's not really other settings that affect it. I've tried to make
Dovecot handle large mailboxes fast by default, but I haven't really
thought of the rebuild slowdown before.

> > Well, yes, to be safe. But usually you shouldn't need to delete the
> > .imap* files at all. If there's any changes in format or whatever, it's
> > rebuilt automatically. It's needed only if it contains actually invalid
> > data that can't be detected, like there cached ENVELOPE texts were wrong
> > before.
> 
> they were wrong in any previous version? or how can I know that?

NEWS file contains everything that's needed to know when upgrading,
including if index files should be deleted because of old bugs. Except I
forgot to update it for 0.99.8.1 which fixed one of these.


From tss@iki.fi  Wed Apr 16 18:55:04 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 16 Apr 2003 18:55:04 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 033F323845
	for <dovecot@procontrol.fi>; Wed, 16 Apr 2003 18:55:04 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id C0F195E0180C; Wed, 16 Apr 2003 18:55:03 +0300 (EEST)
Subject: [dovecot] Re: Changing hierarchy separator to '/'
From: Timo Sirainen <tss@iki.fi>
To: Charlie Brady <charlieb@e-smith.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.44.0304151754270.2004-100000@vegemite.nssg.mitel.com>
References:
	 <Pine.LNX.4.44.0304151754270.2004-100000@vegemite.nssg.mitel.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1050508503.16343.73.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 16 Apr 2003 18:55:03 +0300
X-archive-position: 606
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 609                                                  
Status: O

On Wed, 2003-04-16 at 01:03, Charlie Brady wrote:
> >From TODO:
> 
> ...
>     - maildir: change it to use '/' as hierarchy separator to allow '.'
>       characters (for usernames in shared folders)
> ...
> 
> Now changing the separator in the maildir-storage.c is trivial (even 
> though it "can't" be changed :-), but fixing the resultant breakage in 
> maildir-list.c needs a little more understanding. Timo, could you give me 
> some pointers? I can see that I need to work out what imap_match_init() 
> does.

Did you want to change the '.' separator in filenames too? If not, just
change all '/' chars in mask to '.' in maildir_list_mailbox_init(). 

imap_match_init() doesn't have to be touched, it gets the separator as
parameter. It just initializes the matching so you can later test with
imap_match() if the mask matches to mailbox name.


From mem@mv.mv.com  Wed Apr 16 19:32:23 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 16 Apr 2003 19:32:23 +0300 (EEST)
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id EB2722385F
	for <dovecot@procontrol.fi>; Wed, 16 Apr 2003 19:32:22 +0300 (EEST)
Received: (qmail 8973 invoked by uid 101); 16 Apr 2003 12:32:20 -0400
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Wed, 16 Apr 2003 12:32:20 -0400
To: Timo Sirainen <tss@iki.fi>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: 0.99.9-test5
Message-ID: <20030416163220.GJ21924@iridium.mv.net>
References: <1050507758.16338.58.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1050507758.16338.58.camel@hurina>
User-Agent: Mutt/1.4.1i
X-archive-position: 607
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mem@mv.mv.com
Precedence: bulk
X-list: dovecot
X-UID: 610                                                  
Status: O

My initial impression is that this is working a lot better than the
last few test releases.  I am still seeing "Corrupted index" messages
in the logs for some users, but on the next login for that user, there
is no such message (so it looks like the indexes are indeed getting
fixed).

Also-- no more signal 11s.  yay!

mm

From dom@cus.org.uk  Wed Apr 16 22:33:16 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 16 Apr 2003 22:33:16 +0300 (EEST)
Return-Path: <dom@cus.org.uk>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from cus.org.uk (host213-106-240-81.no-dns-yet.ntli.net [213.106.240.81])
	by danu.procontrol.fi (Postfix) with ESMTP id 5588823845
	for <dovecot@procontrol.fi>; Wed, 16 Apr 2003 22:33:16 +0300 (EEST)
Received: from cus.org.uk (localhost.cus.org.uk [127.0.0.1])
	by cus.org.uk (8.12.6/8.12.6) with ESMTP id h3GJXF7e005049
	for <dovecot@procontrol.fi>; Wed, 16 Apr 2003 20:33:15 +0100 (BST)
	(envelope-from dom@cus.org.uk)
Received: (from dom@localhost)
	by cus.org.uk (8.12.6/8.12.6/Submit) id h3GJXEL3005048
	for dovecot@procontrol.fi; Wed, 16 Apr 2003 20:33:14 +0100 (BST)
Date: Wed, 16 Apr 2003 20:33:14 +0100
From: Dominic Marks <dom@cus.org.uk>
To: dovecot@procontrol.fi
Subject: [dovecot] PATCH Add support for kqueue in ioloop subsystem
Message-ID: <20030416193314.GA4847@cus.org.uk>
Mime-Version: 1.0
Content-Type: multipart/mixed; boundary="pWyiEgJYm5f9v55/"
Content-Disposition: inline
User-Agent: Mutt/1.4i
X-archive-position: 608
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: dom@cus.org.uk
Precedence: bulk
X-list: dovecot
X-UID: 611                                                  
Status: O
Content-Length: 6073


--pWyiEgJYm5f9v55/
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline

Hey,

I noticed that there was an ioloop "module" (if we can call it that) for
select and poll and decided to add one for kqueue (aka kevent) BSDs high
performance descriptor multiplexing API. I haven't done any of the
configure glue stuff but the code is complete and works well. kqueue is
available on all recent versions of FreeBSD, NetBSD, OpenBSD and Darwin
(and therefore MacOS X). I've tested both pop3 and imap with no
problems.

To get it working: (bodge method)

> tar zxvf dovecot-0.99.8.1.tar.gz
> cp ioloop-kevent.c dovecot-0.99.8.1/src/lib/
> cd dovecot-0.99.8.1/
> ./configure
> vi config.h
   1. replace IOLOOP_POLL (or IOLOOP_SELECT) with IOLOOP_KEVENT
> vi src/lib/Makefile
   1. find liblib_a_SOURCES add ioloop-kevent.c to it
   2. find liblib_a_OBJECTS add ioloop-kevent.$(OBJEXT) to it
> make

There is a paper on kqueue which includes a performance evaulation here:

 http://people.freebsd.org/~jlemon/papers/kqueue.pdf

Thanks,
-- 
Dominic
 <dom at cus.org.uk> <d.marks at student.umist.ac.uk>

--pWyiEgJYm5f9v55/
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename="ioloop-kevent.c"

/*
 * ioloop-kevent.c : I/O loop handler using kevent(2)
 *
 *  Copyright (c) 2002, Dominic Marks <dom@cus.org.uk>
 *
 *  This code is placed in the public domain.
 */

#include "lib.h"
#include "ioloop-internal.h"

#ifdef IOLOOP_KEVENT

#include <sys/time.h>
#include <sys/types.h>
#include <sys/event.h>

#ifndef KEVENT_SET_SIZE
#  define KEVENT_SET_SIZE 16
#endif

struct ioloop_handler_data {
	int kq; /* kqueue descriptor */
	struct kevent event; /* a kevent struct which we pass around */
};

void io_loop_handler_init(struct ioloop *ioloop)
{
	struct ioloop_handler_data *data;

	ioloop->handler_data = data =
		p_new(ioloop->pool, struct ioloop_handler_data, 1);

	data->kq = kqueue();
	if (data->kq < 0) {
		i_fatal("couldn't initialise kqueue: %m");
	}

	memset(&data->event, 0, sizeof(struct kevent));
}

void io_loop_handler_deinit(struct ioloop *ioloop)
{
	p_free(ioloop->pool, ioloop->handler_data);
}

void io_loop_handle_add(struct ioloop *ioloop, int fd, int condition)
{
	short filter;
	struct ioloop_handler_data *data = ioloop->handler_data;

	i_assert(fd >= 0);

	if (condition & IO_READ)
		filter |= EVFILT_READ;
	if (condition & IO_WRITE)
		filter |= EVFILT_WRITE;

	EV_SET(&data->event, fd, filter, EV_ADD, 0, 0, NULL);
	if (kevent(data->kq, &data->event, 1, NULL, 0, NULL) < 0) {
		i_warning("couldn't add filter with kqueue: %m");
	}
}

void io_loop_handle_remove(struct ioloop *ioloop, int fd, int condition)
{
	short filter;
	struct ioloop_handler_data *data = ioloop->handler_data;

	i_assert(fd >= 0);

	if (condition & IO_READ)
		filter |= EVFILT_READ;
	if (condition & IO_WRITE)
		filter |= EVFILT_WRITE;

	EV_SET(&data->event, fd, filter, EV_DELETE, 0, 0,
		NULL);
	if (kevent(data->kq, &data->event, 1, NULL, 0, NULL) < 0) {
		/*
		 * changing this to i_fatal is debatable, however
		 * if you do so you will potentially expose the case
		 * where a process receives the client from a socket
		 * then closes the listening socket, experiences an
		 * error and calls exit, dropping the client we just
		 * picked up
		 */
		i_warning("couldn't remove filter with kqueue: %m");
	}
}

void io_loop_handler_run(struct ioloop *ioloop)
{
	struct ioloop_handler_data *data = ioloop->handler_data;
        struct timeval tv;
	struct timespec ts;
	struct io *io, *next;
	struct kevent kes[KEVENT_SET_SIZE], *kev;
	unsigned int t_id;
	int ret, id, mark;

        /* get the time left for next timeout task */
	io_loop_get_wait_time(ioloop->timeouts, &tv, NULL);

	/* convert struct timeval into struct timespec */
	TIMEVAL_TO_TIMESPEC(&tv, &ts);

	/* zero the event vector */
	memset(kes, 0, sizeof(struct kevent) * KEVENT_SET_SIZE);

	/* get any waiting kevents */
	ret = kevent(data->kq, NULL, 0, kes, KEVENT_SET_SIZE, &ts);
	if (ret < 0 && errno != EINTR)
		i_warning("kevent processing failed: %m");

	/* execute timeout handlers */
        io_loop_handle_timeouts(ioloop);

	if (ret <= 0 || !ioloop->running) {
                /* no I/O events */
		return;
	}

	/* execute the I/O handlers in prioritized order */
	for (io = ioloop->ios; io != NULL && ret > 0; io = next) {
		next = io->next;

		if (io->destroyed) {
			/* we were destroyed, and io->fd points to
			   -1 now, so we can't know if there was any
			   revents left. */
			io_destroy(ioloop, io);
			continue;
		}

		i_assert(io->fd >= 0);

		mark = 0;
		/*
		 * XXX
		 * This approach has its upsides and downsides. Because
		 * of the way kevent(2) works you can't interogate the
		 * kernel for the status of an arbitary descriptor, you
		 * can however retrieve all the waiting descriptors. This
		 * is great if you don't care what order they are processed
		 * in. However here we have to process them in io handler
		 * priority order, which means we then need to go through
		 * our events and see if we have a match.
		 *
		 * Removing processed events from the list would improve
		 * the situation, however for small values of KEVENT_SET_SIZE
		 * it would not be a significant optimization, and since we
		 * pass this routine regularly the number of returned events
		 * is typically going to be small.
		 */
		for (id = 0; id < ret; id++) {
			kev = &kes[id];
			if (kev->ident == io->fd) {
				if (io->condition & (IO_READ | IO_WRITE)) {
					if (!((kev->filter & EVFILT_READ) ||
						(kev->filter & EVFILT_WRITE))) {
						continue;
					}
				}
				if (io->condition & IO_READ) {
					if (!(kev->filter & EVFILT_READ))
						continue;
				}
				if (io->condition & IO_WRITE) {
					if (!(kev->filter & EVFILT_WRITE))
						continue;
				}
				mark = 1;
			}
		}
		if (mark == 0) continue; /* no condition was satisfied */

		t_id = t_push();
		io->callback(io->context);
		if (t_pop() != t_id)
			i_panic("Leaked a t_pop() call!");

		if (io->destroyed)
			io_destroy(ioloop, io);

		ret --;
	}
}

#endif

--pWyiEgJYm5f9v55/--

From tss@iki.fi  Wed Apr 16 23:16:37 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 16 Apr 2003 23:16:37 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id AD3BA23845
	for <dovecot@procontrol.fi>; Wed, 16 Apr 2003 23:16:37 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 8421F5E017F5; Wed, 16 Apr 2003 23:16:35 +0300 (EEST)
Subject: [dovecot] Re: PATCH Add support for kqueue in ioloop subsystem
From: Timo Sirainen <tss@iki.fi>
To: Dominic Marks <dom@cus.org.uk>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030416193314.GA4847@cus.org.uk>
References: <20030416193314.GA4847@cus.org.uk>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1050524195.16343.89.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 16 Apr 2003 23:16:35 +0300
X-archive-position: 609
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 612                                                  
Status: O
Content-Length: 2091

On Wed, 2003-04-16 at 22:33, Dominic Marks wrote:
> I noticed that there was an ioloop "module" (if we can call it that) for
> select and poll and decided to add one for kqueue (aka kevent) BSDs high
> performance descriptor multiplexing API. I haven't done any of the
> configure glue stuff but the code is complete and works well. kqueue is
> available on all recent versions of FreeBSD, NetBSD, OpenBSD and Darwin
> (and therefore MacOS X). I've tested both pop3 and imap with no
> problems.

Thanks. I'll add the configure stuff there. Some comments:

--
        if (kevent(data->kq, &data->event, 1, NULL, 0, NULL) < 0) {
                i_warning("couldn't add filter with kqueue: %m");
        }
--

Maybe that should be i_fatal() instead? Otherwise the socket would get
ignored and never closed.

--
        if (kevent(data->kq, &data->event, 1, NULL, 0, NULL) < 0) {
                /*
                 * changing this to i_fatal is debatable, however
                 * if you do so you will potentially expose the case
                 * where a process receives the client from a socket
                 * then closes the listening socket, experiences an
                 * error and calls exit, dropping the client we just
                 * picked up
                 */
                i_warning("couldn't remove filter with kqueue: %m");
        }
--

Can this error actually happen when removing it? What kind of error?

--
                 * in. However here we have to process them in io handler
                 * priority order, which means we then need to go through
                 * our events and see if we have a match.
--

Maybe I should remove the priorities. They're just slowing down things
and there's no real reason for them now.

Also I have in TODO:

    - send EXISTS immediately after new mail arrives.
        - linux: we can use dnotify for maildir (but not mbox I think, we'd
	  get interrupted all the time if we checked eg. large /var/spool/mail)
	- *bsd: kqueue() can notify changes in mbox and maildir

This would need some kind of API as well..


From charlieb-dovecot@e-smith.com  Thu Apr 17 00:11:56 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 17 Apr 2003 00:11:56 +0300 (EEST)
Return-Path: <charlieb-dovecot@e-smith.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from nssg.mitel.com (mail.e-smith.com [216.191.234.126])
	by danu.procontrol.fi (Postfix) with SMTP id 215602385F
	for <dovecot@procontrol.fi>; Thu, 17 Apr 2003 00:11:56 +0300 (EEST)
Received: (qmail 17708 invoked by uid 404); 16 Apr 2003 21:11:53 -0000
Received: from charlieb-dovecot@e-smith.com by tripe.nssg.mitel.com with qmail-scanner; 16 Apr 2003 17:11:53 -0000
Received: from allspice-core.nssg.mitel.com (HELO e-smith.com) (10.33.16.12)
  by tripe.nssg.mitel.com (10.33.17.11) with SMTP; 16 Apr 2003 21:11:53 -0000
Received: (qmail 19485 invoked from network); 16 Apr 2003 21:11:53 -0000
Received: from vegemite.nssg.mitel.com (10.33.15.70)
  by allspice.nssg.mitel.com with QMQP; 16 Apr 2003 21:11:53 -0000
Received: from localhost (sendmail-bs@127.0.0.1)
  by localhost with SMTP; 16 Apr 2003 21:17:00 -0000
Date: Wed, 16 Apr 2003 17:17:00 -0400 (EDT)
From: Charlie Brady <charlieb-dovecot@e-smith.com>
X-X-Sender: charlieb@vegemite.nssg.mitel.com
To: Timo Sirainen <tss@iki.fi>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: Changing hierarchy separator to '/'
In-Reply-To: <1050508503.16343.73.camel@hurina>
Message-ID: <Pine.LNX.4.44.0304161710370.3863-100000@vegemite.nssg.mitel.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 610
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: charlieb-dovecot@e-smith.com
Precedence: bulk
X-list: dovecot
X-UID: 613                                                  
Status: O
Content-Length: 1447


On 16 Apr 2003, Timo Sirainen wrote:

> On Wed, 2003-04-16 at 01:03, Charlie Brady wrote:
> > >From TODO:
> > 
> > ...
> >     - maildir: change it to use '/' as hierarchy separator to allow '.'
> >       characters (for usernames in shared folders)
> > ...
> > 
> > Now changing the separator in the maildir-storage.c is trivial (even 
> > though it "can't" be changed :-), but fixing the resultant breakage in 
> > maildir-list.c needs a little more understanding. Timo, could you give me 
> > some pointers? I can see that I need to work out what imap_match_init() 
> > does.
> 
> Did you want to change the '.' separator in filenames too?

Yes. AIUI, it's necessary to do so, otherwise there is confusion as to 
whether a . is literal or is a stand-in /.

To summarize:

- I'd like to use / as hierarchy separator, so that existing .mailboxlist 
files can be used (after moving them to ./Maildir/.subscriptions)
- I'd like to change the filename separator to ';' rather than '.', so 
that users can have folder names containing '.'.
- I don't care about Courier compatibility.

As an academic exercise, is there a reason other than Courier 
compatibility that subfolders can't be directories nested inside other 
directories? IOW, if we use / as the hierarchy separator, could we also 
use it in the filesystem paths of folders. (I realise that a reasonable 
amount of code would need to change to make this possible).

Regards

--
Charlie



From tss@iki.fi  Thu Apr 17 01:34:06 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 17 Apr 2003 01:34:06 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 744D02385F
	for <dovecot@procontrol.fi>; Thu, 17 Apr 2003 01:34:06 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 3A9385E017F5; Thu, 17 Apr 2003 01:34:06 +0300 (EEST)
Subject: [dovecot] Re: Changing hierarchy separator to '/'
From: Timo Sirainen <tss@iki.fi>
To: Charlie Brady <charlieb-dovecot@e-smith.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.44.0304161710370.3863-100000@vegemite.nssg.mitel.com>
References:
	 <Pine.LNX.4.44.0304161710370.3863-100000@vegemite.nssg.mitel.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1050532445.16342.102.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 17 Apr 2003 01:34:05 +0300
X-archive-position: 611
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 614                                                  
Status: O
Content-Length: 1164

On Thu, 2003-04-17 at 00:17, Charlie Brady wrote:
> To summarize:
> 
> - I'd like to use / as hierarchy separator, so that existing .mailboxlist 
> files can be used (after moving them to ./Maildir/.subscriptions)
> - I'd like to change the filename separator to ';' rather than '.', so 
> that users can have folder names containing '.'.
> - I don't care about Courier compatibility.

Then you mostly just have to change '.' to ';' everywhere. And in
maildir-list.c do the '/' -> ';' change in the search mask first to make
it easier.

> As an academic exercise, is there a reason other than Courier 
> compatibility that subfolders can't be directories nested inside other 
> directories? IOW, if we use / as the hierarchy separator, could we also 
> use it in the filesystem paths of folders.

I'm not sure. I did think of doing this before, but I think I figured
out some really good reason why the current way is better. Or maybe not,
I can't remember.

> (I realise that a reasonable 
> amount of code would need to change to make this possible).

It wouldn't need that much code changes, mbox works that way and most of
the code could be taken from there.


From lfarkas@bnap.hu  Thu Apr 17 12:50:00 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 17 Apr 2003 12:50:01 +0300 (EEST)
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id C57D423845
	for <dovecot@procontrol.fi>; Thu, 17 Apr 2003 12:50:00 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id 1B189754004
	for <dovecot@procontrol.fi>; Thu, 17 Apr 2003 11:50:44 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id E5B2D3EEE
	for <dovecot@procontrol.fi>; Thu, 17 Apr 2003 11:49:57 +0200 (CEST)
Message-ID: <3E9E78C5.4000501@bnap.hu>
Date: Thu, 17 Apr 2003 11:49:57 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: [dovecot] a few small bug
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 612
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 615                                                  
Status: O
Content-Length: 1382

during the ./autogen.sh there is a few problem:
-----------------------------------------
configure.in: installing `./install-sh'
configure.in: installing `./mkinstalldirs'
configure.in: installing `./missing'
Use of uninitialized value in concatenation (.) or string at 
/usr/bin/automake line 8449.
: installing `./config.guess'
Use of uninitialized value in concatenation (.) or string at 
/usr/bin/automake line 8449.
: installing `./config.sub'
configure.in:3: required file `./config.h.in' not found
aclocal.m4:916: required file `./ltmain.sh' not found
src/auth/Makefile.am: installing `./depcomp'
configure.in:13: warning: AC_ARG_PROGRAM invoked multiple times
autoheader: `config.h.in' is created
-----------------------------------------
would it be possible to not use your own libtool in the cvs?
in this case I can run autogen.sh during the rpm build and doesn't have 
to run manulay and patch the genereated makefile.

ps. this is the patch I use:
--- dovecot-1.0/configure.lfarkas       2003-03-20 15:53:04.000000000 +0100
+++ dovecot-1.0/configure       2003-03-20 15:54:37.000000000 +0100
@@ -8205,7 +8205,7 @@
  LIBTOOL_DEPS="$ac_aux_dir/ltmain.sh"

  # Always use our own libtool.
-LIBTOOL='$(SHELL) $(top_builddir)/libtool'
+LIBTOOL='$(SHELL) libtool'

  # Prevent multiple expansion



-- 
   Levente                               "Si vis pacem para bellum!"



From tss@iki.fi  Thu Apr 17 17:12:44 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 17 Apr 2003 17:12:44 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 7992423845
	for <dovecot@procontrol.fi>; Thu, 17 Apr 2003 17:12:44 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 47B465E017F5; Thu, 17 Apr 2003 17:12:41 +0300 (EEST)
Subject: [dovecot] Re: a few small bug
From: Timo Sirainen <tss@iki.fi>
To: Farkas Levente <lfarkas@bnap.hu>
Cc: Dovecot List <dovecot@procontrol.fi>
In-Reply-To: <3E9E78C5.4000501@bnap.hu>
References: <3E9E78C5.4000501@bnap.hu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1050588761.16342.146.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 17 Apr 2003 17:12:41 +0300
X-archive-position: 613
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 616                                                  
Status: O
Content-Length: 1089

On Thu, 2003-04-17 at 12:49, Farkas Levente wrote:
> during the ./autogen.sh there is a few problem:
> -----------------------------------------
> Use of uninitialized value in concatenation (.) or string at 
> /usr/bin/automake line 8449.
> : installing `./config.guess'
> Use of uninitialized value in concatenation (.) or string at 
> /usr/bin/automake line 8449.
> : installing `./config.sub'

Only these are actual problems, and they look like automake bugs to me.

> would it be possible to not use your own libtool in the cvs?
> in this case I can run autogen.sh during the rpm build and doesn't have 
> to run manulay and patch the genereated makefile.

Hmm. ltmain.sh is generated by autogen.sh (automake). libtool is
generated by configure. But they can also be generated by libtoolize
which isn't called in autogen.sh .. I'm not sure I should be calling
that. I think newer auto* tools worked a bit differently.

Anyway, libtool isn't included in CVS but it's generated by your system
as is the configure script. I can't change them without ugly (and mostly
unneeded) kludges.


From charlieb-dovecot@e-smith.com  Thu Apr 17 18:23:40 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 17 Apr 2003 18:23:40 +0300 (EEST)
Return-Path: <charlieb-dovecot@e-smith.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from nssg.mitel.com (mail.e-smith.com [216.191.234.126])
	by danu.procontrol.fi (Postfix) with SMTP id 46E0C23845
	for <dovecot@procontrol.fi>; Thu, 17 Apr 2003 18:23:40 +0300 (EEST)
Received: (qmail 30482 invoked by uid 404); 17 Apr 2003 15:23:36 -0000
Received: from charlieb-dovecot@e-smith.com by tripe.nssg.mitel.com with qmail-scanner; 17 Apr 2003 11:23:36 -0000
Received: from allspice-core.nssg.mitel.com (HELO e-smith.com) (10.33.16.12)
  by tripe.nssg.mitel.com (10.33.17.11) with SMTP; 17 Apr 2003 15:23:36 -0000
Received: (qmail 17616 invoked from network); 17 Apr 2003 15:23:36 -0000
Received: from vegemite.nssg.mitel.com (10.33.15.70)
  by allspice.nssg.mitel.com with QMQP; 17 Apr 2003 15:23:36 -0000
Received: from localhost (sendmail-bs@127.0.0.1)
  by localhost with SMTP; 17 Apr 2003 15:28:41 -0000
Date: Thu, 17 Apr 2003 11:28:41 -0400 (EDT)
From: Charlie Brady <charlieb-dovecot@e-smith.com>
X-X-Sender: charlieb@vegemite.nssg.mitel.com
To: dovecot@procontrol.fi
Subject: [dovecot] Using nested folders (was Re: Changing hierarchy separator to '/')
In-Reply-To: <1050532445.16342.102.camel@hurina>
Message-ID: <Pine.LNX.4.44.0304171125480.5165-100000@vegemite.nssg.mitel.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 614
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: charlieb-dovecot@e-smith.com
Precedence: bulk
X-list: dovecot
X-UID: 617                                                  
Status: O


On 17 Apr 2003, Timo Sirainen wrote:

> On Thu, 2003-04-17 at 00:17, Charlie Brady wrote:
> 
> > As an academic exercise, is there a reason other than Courier 
> > compatibility that subfolders can't be directories nested inside other 
> > directories? IOW, if we use / as the hierarchy separator, could we also 
> > use it in the filesystem paths of folders.
...
> > (I realise that a reasonable 
> > amount of code would need to change to make this possible).
> 
> It wouldn't need that much code changes, mbox works that way and most of
> the code could be taken from there.

There are significant differences from mbox, because a directory can be
both a maildir and a container of other maildirs. That makes deletion and
rename cases quite different. Or am I imagining these complications?

--
Charlie


From khoff@pc-intouch.com  Thu Apr 17 22:16:18 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 17 Apr 2003 22:16:18 +0300 (EEST)
Return-Path: <khoff@pc-intouch.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from luaren.pc-intouch.com (luaren.pc-intouch.com [66.42.86.8])
	by danu.procontrol.fi (Postfix) with ESMTP id A4FF92385F
	for <dovecot@procontrol.fi>; Thu, 17 Apr 2003 22:16:18 +0300 (EEST)
Received: from luaren.pc-intouch.com ([66.42.86.8])
	by luaren.pc-intouch.com with esmtp (Exim 3.34 #2)
	id 196Etd-0001Iv-00
	for dovecot@procontrol.fi; Thu, 17 Apr 2003 12:18:09 -0700
Date: Thu, 17 Apr 2003 12:18:09 -0700 (PDT)
From: Kristian Hoffmann <khoff@pc-intouch.com>
To: Dovecot List <dovecot@procontrol.fi>
Subject: [dovecot] Corrupt mbox handling
Message-ID: <Pine.LNX.4.44.0304171210040.1829-100000@luaren.pc-intouch.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 615
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: khoff@pc-intouch.com
Precedence: bulk
X-list: dovecot
X-UID: 618                                                  
Status: O

I've found that if an mbox file has two consecutive 'From' delimiters, I
get the error:

pop3(user): Error indexing mbox file /var/spool/mail/user: LF not found
where expected

UofW apparently ignores the second 'From' silently.  I've been trying to
run dovecot in gdb to get more details on exactly what is happening, but
I haven't quite mastered the art of attaching to the pop3 process between
the login process completing and it exiting.  Is there some trick to doing
that?

If I can't work around it in dovecot, I can just write something in perl
to fix all the duplicate 'From' lines.

Thanks,

Kristian Hoffmann
PC-InTOUCH/FireToWire System Administrator
khoff@pc-intouch.com
---


From tss@iki.fi  Thu Apr 17 22:42:29 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 17 Apr 2003 22:42:29 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 0A97D23845
	for <dovecot@procontrol.fi>; Thu, 17 Apr 2003 22:42:29 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id C12C95E017F5; Thu, 17 Apr 2003 22:42:28 +0300 (EEST)
Subject: [dovecot] Re: Corrupt mbox handling
From: Timo Sirainen <tss@iki.fi>
To: Kristian Hoffmann <khoff@pc-intouch.com>
Cc: Dovecot List <dovecot@procontrol.fi>
In-Reply-To: <Pine.LNX.4.44.0304171210040.1829-100000@luaren.pc-intouch.com>
References: <Pine.LNX.4.44.0304171210040.1829-100000@luaren.pc-intouch.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1050608548.16341.212.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 17 Apr 2003 22:42:28 +0300
X-archive-position: 616
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 619                                                  
Status: O
Content-Length: 1254

On Thu, 2003-04-17 at 22:18, Kristian Hoffmann wrote:
> I've found that if an mbox file has two consecutive 'From' delimiters, I
> get the error:
> 
> pop3(user): Error indexing mbox file /var/spool/mail/user: LF not found
> where expected

This is in TODO:

    - two adjacent From-lines breaks us. not too easy to fix though.

Problem is that two From-lines aren't really "possible", because the
line feed before and after belongs to the same From-line. And since the
newline between the two From-lines is shared between them, it breaks my
parsers. I guess the correct way to fix this would be to completely
ignore the first From-line if second one comes right after it. I'm not
sure how easily that is fixed.

I once tried fixing this but the code got too kludgy back then, but I
think I tried to keep the first one as empty message then. Ignoring it
might be easier.

> UofW apparently ignores the second 'From' silently.  I've been trying to
> run dovecot in gdb to get more details on exactly what is happening, but
> I haven't quite mastered the art of attaching to the pop3 process between
> the login process completing and it exiting.  Is there some trick to doing
> that?

Well, you can run the pop3 binary directly and talk to it via stdin.


From lfarkas@bnap.hu  Fri Apr 18 12:14:07 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 18 Apr 2003 12:14:07 +0300 (EEST)
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 76D742385F
	for <dovecot@procontrol.fi>; Fri, 18 Apr 2003 12:14:06 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP
	id 5410E754003; Fri, 18 Apr 2003 11:14:56 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP
	id 661E53EEE; Fri, 18 Apr 2003 11:14:01 +0200 (CEST)
From: "Farkas Levente" <lfarkas@bnap.hu>
To: "Timo Sirainen" <tss@iki.fi>
Cc: "Dovecot List" <dovecot@procontrol.fi>
References: <3E9E78C5.4000501@bnap.hu> <1050588761.16342.146.camel@hurina>
Subject: [dovecot] another bug
Date: Fri, 18 Apr 2003 11:14:01 +0200
MIME-Version: 1.0
Content-Type: multipart/mixed;
	boundary="----=_NextPart_000_0016_01C3059B.9D70C8F0"
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2800.1106
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2800.1106
Message-Id: <20030418091456.5410E754003@mail1.bppiac.hu>
X-archive-position: 617
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 620                                                  
Status: O
Content-Length: 133367

This is a multi-part message in MIME format.

------=_NextPart_000_0016_01C3059B.9D70C8F0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: 7bit

hi,
after I push the delete button on a long mail in mozilla the mail is not
deleted and after tha mozilla don't show any other messages in that folder.
I have to restart mozilla. but even after the restart I still can't remove
the message. this already happend earlier, but now here is the rawlog of the
session. from OE6 I can delete the same message.

-- Levente

------=_NextPart_000_0016_01C3059B.9D70C8F0
Content-Type: application/x-compressed;
	name="rawlog.tgz"
Content-Transfer-Encoding: base64
Content-Disposition: attachment;
	filename="rawlog.tgz"

H4sIAJHAnz4AA+xd/VPbxrrOr2Em/8MO0zsn6Q06+/2hIS0G2yktIVygJ+1pMx1hC1CxLY4kkyZ3
8r/fXdkGrbySRQA7uY2nU8B6Vx/P+7xfu6s3SfBuEJ/989FDfiCkUAimf0IouP1z+nmkv6BCECE4
fgQRxgw/AuxB72r6GadZkADwaHAaJBdBWim36PgX+kkm+scQEkiR3EAIMkY3FCLMi0b3cw2IIORG
xxX6J4RO9U/NES1POaSPALyfy9d//ub6/xa8/gn8dth6s/f6JTjefdU5Om69OngLDCE2IN1AEiDk
Q+YzukbAIEozsL4O1v9r/ckaLfz5T/MFu/lid3/79S/6Kw56SRhkIVg/ToL0XH8jQBoOwl52IyPB
z7ttcBpmvXOA/G/B0+5e6+XRsydrDe+N+4itKdAbxGn4ZA1BoAkdj7Mna6vG9kv41Nm/BvFerrHA
/glBrGT/zPz4av9L+HwL9naPjsHT338evdIPGPafgXVv/cZcr4/vnEeDfhKOQFlyd7+R2EEU9IqC
pcPtJDjN0qKAdfgoHGWNLrMXjcZ/VZ7mJOhdjC8rDx8k0ZV2VjW3eRwOLwdapP5OwW4WDtOa08xc
HzEebs84zV6sTxxmYd8zjtX17aJzMecoDvZfg1dBNDiJ/wLhX/pwmp8r97H6ZK1R+i5Mwj74vTsI
zs7ML+0wHwx+PwoNwLlmwDfdOHkXJH192ZljPugcvmrtd/aPP/1c4Pdvn70FRjoFl2EyjLLZs2IC
Or/o5z0yf0Bw2NnRF5pdWceLf7X2dtu7x78C7a+04xLaab01cSQFV8Eg6hck9zu/HANB3oIDfWtR
z9zNKPwrM8ImGuUhptNqb7w53D3uvAVHk+hkI49At3O88wN4aiIVugbPPNSzHA9cFMAOAVIUIA74
b0RpUZQ6zsWKAswhwIsCvPZioigqHOeSRQHpEFBFAeUQ0BG5iB6svR9kQ43qhS3YkQt3ZAGPiEvE
Ahy5EEcW5MiFObJAR/WoIwt25MIdWcAjF/LIgh65sMcW9rgee2xhj11wYgtx7jQFC3E+j7g0NtfN
072ilSnz9Y5J4krGt/1rB+zFZ2fR6AzkeZ2mkHF1eZZnya46mH6Bn8r8j5Jl1X+UCDxX/yH0Nf9b
xuee6j+vsv6bVXs3uZWoqvdkoTT0/gyugo3BNJtTxSPJ+UY/vAoH67knKBzox1dhLzZ5oo4bFdfQ
QaJ4BKPnWPkEPqfIp+Q5ZT5Vzxl6zqTP1MSDHXZ3JMbe0e6/O1NXtv26/at30On89NsPOnHoHHrd
3c5eW7u4bhIPwXEMdnrgaHzyp7mvtil+X4VpGpyFG/psGoY4ibL34JeN618Pw1Ptike9MAX74bv0
LInHlynYHW0chpeD9xvH8bO35s7JDZY6l/a291sH5lFp5aMy6wjSkp/XA3H7gdr7R+Z5KumB7IkC
wT+zx7khaV6EeGmYXIWJfiQddiseCds8/cwUpIP97ImuCycd3auehRZtcahLjsnDs8oBvHCEYPDU
POXR8eHPO8c/H3aMgCgJlMExA357uwk9BDGF35khstmQfEBhmGo2DEMq9TCMpTTDCGw2jGDBpadD
KuH5MNRsGBUIUg9xImk+DDcbxgmV+mqSEpwPI82GSaQw9PInzIfRWyCpx2GGJ5iwhuMwVVh6mDIx
AaXMhqpxVOmCz8Oc4wkqDUmCBEfmepKLCSwNmZIDAj0CBZ7g0pQqhDGNZ656M4425ArmUrPL0zpE
OS60IVkIJIYthEue40IbsoUQpTQ5iVQox4U2pAsRUmpboFDxHBfakC8UKUmL4xryhXJo9HA97jaT
w5TPZoep+Do7bH3q8v9lzP9ighgkfG7+F/Gv+f8yPl/nfz+/+d/qUV4SRP3KS+vj78fDusPpZTCs
vS0vfZ8G/QUy17ldjUw/CIfxqPZeguFJUH8SXekFo1E81onqgqtdV341QlZFWSN3FSXjeuV5J+Oz
LAn+s/DuZ3VqlVSxkKuXOTjYbe0sktpNs6tgtEhqL+4Fg2obMCL/OthfdJb9eNRAalLT1YocHO3W
iExKqV50cbFQaBGhSlVZvVg/TC+y+HL9fldjbr3ucvfFlsoVFiFvt8KCCK9dYVHuFRZ+pxUW5zT1
322txXWuilUX52LDvay/3M+qi/OSD7v+0mDVxXlXD7v+Urnq4lxSwYsXZizEsWudC1s4YxfO2MIZ
u3DGFs7YhTO2cMYupmMLXVzPdWzhjF04Ewtn4sKZWDiTeh9DLMSJ08vYbsaFOLEQJ7T+khb2xIU9
sbAnLuyJhT1xYU8s7ImL2cRCnNT7F2phT+v9C7W0QF1spxb2FNefz9ICXeDtbXdfrw9q6YO69EEt
fVCXPqilD+rSB7X0QV36oJY+aL0+mKUPVq8PZumDufTBLH0wly0wSwvMZQvMwp45Y60dbFn9jVvY
Mxf2zMKeubBnFvbMhT2zsGf12HMLe+7yQ9xC3LmEzu1V9noL4IvW27WIhT13Yc8t7Lkz07FTHRfi
3EKcuxDnFuLchTi3EOf1iAsLcVHPdmFhL1zYCwt74WK7sBAX9T5HWNgLF/bCwl64sBcW9mJBnmkn
mi4tCEsLYl4Lwr1J43MqYOCt6heuhKirX5C7fJHNypcvFxVZu2+uAhX1paGic69bwoLqYOEV2wkn
O5O+jP2EzqD6idXu1/2Et6tsncIPW+M2qGydd1VV4zoLtTtUu87z2WbgLLBtQ1iwwdE2Bafh2Vm/
s9S2s35nqW1n/fWZrF0L0/rYbtfCtH4Ow66KnZWFXRVTZ21t5/8u1Oxa2JlG27Uwm7+Qts2KlKPO
W1pLxZQqOlkvLm+TOXz9Chy/Bjs74Ojn7R87O8eg3TrugFedo6PWy06+TeZw9/WhiQC/bFz/etjp
dg47+zudI7DfeXP08vD1zwdHYHd/47BzsPfrxvFrHW3+Fyvy8cma2Yjjg/VuvkgI9sKrcJSF62Bz
umy4dTIKLr3z8XdP1o5jH2xOFyy2LpO4F4+yJB54p5E+eLMxRwvli7IEKYSIINTbbpGuFIxCzLbM
EgzyTi4vzQx6ftrp9h8f/DY991twGPogjYch0Fc5GYRD8C7KzsH08JM1s1HIB2/C/nNj16+CJF87
1z7NR1T/B/7brNs+WbvZNuQD8mTtemdRv3iHGHEoPbYDt7vmDhFx3OGTtYWhzdImhkosXZtEio+F
h2zrhyQd0eq0d7oeMavTkBZ0OYGwm0TPjSu7gRD5VPjaM0whnJDD5kYVNY6jYQyOoiSIRjqv2czS
dCu6iCbsuNax0eyNnodxUtKxWYQskUk/hZI7sONJs+UWquvLgk0EqUQSIsU9JjjzEOVeLxiGg63z
cRKNgu8eT4Z3W5BpEJjWuSgPV4oxbIZDDwtsD3+yVthZ5jcaMOVKsyynxBpGls4ayujHOoOi3NfR
2mKDPtwbp+BwHPYuwiQDm8n0t61odBonwyCLLrzxKNpI4jSLexdeP5wyZDGPdno+cHqYSgotcBWW
PdwYPeWIey9bCAqstqIkTSMvyM693l938GS3cioTLkEhEIWepNJDajH1asWnxGuWM9vEEysgHobc
4a7chj4j6PH5+LlJzm4ICn0ifZ1sfYK7ak8oMlnqrAxrjuBU5bSmCqirRGzYlUIriPnIBfsOQ9QT
UBngG8BOfbPrHC4VdmPod4sXZZOqEZzqsq5otHWJoFy6LhlUNb6b+RD6lP6/891U64p6L7c/Y9/d
LNLkBJRcQuzp80FSx1O32JSldTMXFksJVXwFjp668tLuNlaeMv1VIG+Ql2JNZe10lupxAnASZeAk
zLIweQ5Oxpnnedeg180GlVyDgssvBrCjGFCkvY2EdvNCgyjnQM9dCFSgdVmIrtQnBnS8hGLA/BWA
0/AdiLPzMJk5hTnvrl2AbDNPJxD6MVghnZ9sBYYCIYyJ0kanMJPa5nq9JHznxcnZnGU1GTHVd93k
nm1kjC+/lKdUOo2MkLbWN9FQNTMyrXL2ScXfIsff2Ol/qgd/fCsX/nixD5/4Xe14iWc4Igued1Z4
EjEpBHXhqViDyrF+wJRoTSeJbdIpoZbv2Qm6v/kjB1M+YQYI+4T5RNxqBqjJHNVMNw3n5Mt5/vID
AM3Lq9ub30Sbdd67xtrn0xan+dxlsvB2Zp7L38HQS5RpYMQTYhaLJQx9qHxEZlF0RqXaFRvbuCVd
weQwJI4Mwh16Z4/9Kh7pDEIUMghdJTKfiU/JIO6QtjlyiBnqDRfBShkcXv78CGHyY22qVFULN7Pg
ZuVcMx3MV9UV0wkNp3VrzzFvkDqfxXJqkEguNkjEfYJ9Xa+XDLLhkqdNDboCalC0gBpOC7gvXpS1
rUi3S01VwbWmeLW275S2P66pX3IaKO3AISMeZrrS9jCHZR48rr3XMqv06YQQMD+dvmdeQSurWqJ+
3pBB04oUaVW7OG77eY7Z8v0Mx64JwXZ7p+0Z2+OOSnF+QpD7WOgw94VNCNZ5mkbOxZHj1w+YkaJ2
O0SpnKSrWEt0kaIqR6pKxrkPsebF36CcfLDVnPpNMfYWAoZWkaXg6ynoo7HO/njBITLfzCggsKEZ
A8HTTvv42YwFO+dBMohCsJ0E/fdgszf582RjpvdwIx1GZpo0HtYzwmQpP0XDcRKA7vj9+CICm6f5
z63zoB8M3k/jR5X7mDAcxElfh8pEczJJdaCPR6AXX76PRmcOvSkmhA5iHsYKEtcKsGU2BzrOenv7
v3jUo9TLAx1HTEcqZpp4cEI3UN5KaisYDNLLqBd6ozQ98/TDh4Pp08+o0HDzk0UKzd7lz/gSzKvz
k885ba1YDGq6uuSoFWu2JjhTU2VqxZt6aab6hlvZ7MChibV81auHnHa40xqUY+a36STC8qYr5ihU
GyQmBLJiLjW1DYYlAtVvbyzRhuPl04ZAV77RMn12kH4SoZPQIMtOoqlLrMg4oMm/zX6VDdNxZcaq
H/VpQ3AQZtq5a8+++efl9FcsmHXWYjZqGs9+Wkr6AMnIJ25Xa7hh1c4isFy+19CR9KM1hyTssgr7
RM3Kqmae4k5FhbN8nl+MXlCyNit/HfV0leBMrbVbiy1lciKWr0ykmGPicEezu6sfipUK72lBOQ6f
m9r4RuvKx8hHaqkTh71xkpgeKL2r9Abthru07VkhuYpCHtHqrMt6tNWnWpV0KBtNlVwpTjKo/RYj
wkMcYR0tKwJlgWAY+lQXJ6I0W1O/z760ZRutIFBS5TCuNmItpVGCUEFUUZjz8ro+/STjqmbN87s5
XYuhzWjQRPPl8m2R/IwHtS9T2AkTJsufoEHKkTBpHmxjkc9k4YY8YNLXVrFMJxsmSZwU/GvtKyml
dVS0fK+KoWMmTLU1Fbc9ogP0/G7JeZiRTsgn82DLgznKQBqGwxRkMRiPxmmgs5gb0Bu+5GPDz8QK
gpok9Usdn1tgq3LF9+fRHtdeZy4w6gtwxUwvVoo8UlVCFunKzVY7xsqRseG7XrZvJGwF1UTOmSpj
ZOaVBixtY3wVh+BNdKJtBGyG6YUmULgVjILRB1Maeh+C+6gqZo7PUUhoTRPKda37soUIwnzrXRwP
vVGYOYhT5eMdTHQLzvTZ8HW88k6EFcwpMVdB0eaQKs+0VtUP2MAJM5+Rwi6M2zjhBuxo7jEWsKOZ
upsQx7XTsU5+9uJS7ZuXdgYsV7HTEbl2trY5b7U9ZCrmyqUp28eZkHzPGfA90OBBsuC6iNEoSMwn
0QsGzLhU+4quzSWyitlq17Sj5pJAwmviU7iZmlpy/vwQzqLWoc4HlgrBmdJrX7q2wwlcQUo52Sr9
JaWUFb5tOSllI3t/XHujjpxUYkWmZ6vaW2NZmvQZ8gkp5aT1L+/bVBNi+S9oIeWarekIucM80zCc
Oar0fG8NKu2hVKvZQ5kOg8EAnIzPbhCv7YVQqhdX0NKAYFht3HMP9RkYdxUZysZdJTdvW1IKjnLb
wtWLzhbBhNmnkb9bdWNcCH/+bbTMvwt0y95IqrZlFGIVzZHIwzZHcnZAcTcQWNgc6YtoiXSrZr8N
WiKtoBHS/bQ/+jz/icUGTY8qWx3dd4tfZyuhh232u7jVEXYh/sDNfqvaGn1t8evwjctq7FsQqWrn
WxCpauJbELlD617nsz1sE99CsLmX1r1O4ZU38S2IrLx1byF6P2zD3oLI36dNbyH1uZfmvE7hO7Tp
LYhUNed1XvIObXoLIvfQnFeLWNiL+pxQWlqQLo5LC3vp4ri0EJcuxKWFuHQhLi3EZT3i0kJcuhCX
FuLShbi0EJf1GYq0k3EX9tLCXrp4ryzElQtxZSGuXIgrC3HlQlxZiCsX4spCXNUjrizElQtxZSGu
XIgrC3Hl4riycFbOqscuexbVPaXCx1n5QLv0gc7aB9rFD3RWP9Auf+CC+gfaBRB0VkDQLoGgswaC
dhEEnU1goV38QGf1A+3yBy5oBAvtUgg6W/OWys+K+rNUgDq1UCpB3TVoqQhFLv6jUvHpqD4RvXPr
UWz+0fIV9I6Y6wqEiNnoDj0lPWJenkOeJidXAivBvPQ/4yhJwsHWu3fvvGE06g+DizCZe/lca2Q/
vjLzWhhAZN4/yzcyGKN6utMx7x/dTHZ23/V90H3jg85wEF6EH7Iwi99e97OYTfdNZv8K/SymP6e7
fPN5vPkZwVLjifoGorUv8EC1/MYehIjiLOrV5QhchWeX8SiLL243Af1DeBb2xymY/PtuYDM6n3xx
LfYcrLc8sB8Ow+x8skdfQ305yv8uCD1Ze7wXfQguQGs0CsBmMDB/FI7/GIziqyhLQSvLooGR+HP6
TUFoPzh7D/aCXgQ2RwP9YyschKO+zSJMbwhk+snCawLNzbUSiYiSTFMVU+zNOkGcBclpFA76XjTK
XLvy6+b1Su/z8RVoHorrli4vvo/SeENKpjbQ9//zfevs7I8fX3TJhzQ8/f6FRvjszPszNn9tmV+v
Vb7+D5sa/3D2gjFT5nN6Ls7cd3xwGSdZMADjy75Wjf3usSi88iJMy1pM57RkfEr+AjPq4VMq4Tey
L1FATuE3MIAokD241ddEKlsreLpvGuENns3P1kvc3RFdj0NVaqhU33tzXrdyFZ0fibXueRWPgsFF
3L+dPTcy1p/iobarAPyUROmHLDIGe3Ex+W5uuUtr8sbeqNEknNfkzN4opBJTjzHFPcR4Q4tr3JCT
Sr6CQIjVx7mo9O9gEFwFyXvwMjiJE7D54cz8vAbv7b0r7VodhfhpFoWITyrVIaRQOncwkVp6iDTU
RuOWmkqtYHt9vtXMWj40r1dpV7h79PrGFb7ooCxK9P9H71902pn+Jf3+xS1XZkNtGoMwAYdRpu0j
6U//rtx4AaE4NZ5MniD8DWIBOQkp/CagU09WRttaP7zl2OkSIbUsU2dTNVTAQkqlqSC0eSLckAqN
+1Zipq+w/OX7yXvM9n5NxDlp6cqKUN6mCClCOuY14C6nO23e4UgSCbtb5p+8Jd85AinW7GnnQTSw
gumPbR1JtXcsgDSJpSX2uIPpNWFLV+q+eUFaf2yP+8FlmGZ/mH+09o9/Hfxx9aKjptncH//H3tX2
tm1k688t0P9AFAL64TrCvHDIGaPZRLKtNLs3bQpn26LAwqAkyqb15pXo5FrA/e/3zFCUOMPheKR4
zezeoEFqK5JscYZnznnOc55nBl/n6brYxkLu4m+MN4F/Ezfp5iq7hi8WD7OXAzZL7uCl8skNqbdk
W275GrjC1/DWzKRh2MIBqUumTbJZ+mI5DdJ1kATrjTLfTacv0gV8O5e39vqwO14WLelimpUPW0Nu
eEpoRea0HnI5QwQKI0njEdjzPvNrwuplB2MoaiNHqU9bkDjuRqQLZaqkFnXlp0dhFBEexVwvC83D
TAlSEG26HuNTzBsKwkqQl/s+fZEnMv9czq/uIMLPINTjTZJnV8niIbnex/sfp/P70U1irLZ3Tehu
e+uLAp8atTDRSaMa5VZqMBd5dZR0khFGk2GEOinfnijz6bT4zNYA+CFZjYz4l6uHbvcvVNfwZr6c
LZKVUTY0S01WS/MTiGTf63nU97VECqrPPjxls862hSM8JcnzZJj4RNdPp1fv4DeAsLi+enF1uUlG
65eD3iqDTwapwXJdiZD1qoWp2hLZlCrx43qTlpDJW1AgJ1FNJHDQF9GF1L0O4/icwglJcE8yCkks
eoKfnSHS7w3g7Hy9SPPC0bw7W3S1SrzcNPf55AV/1X/127tf7kbz3+7fXuQPyR8/R+M3i/Pl7+FL
tXFkljN9nS5nh1agWqkpYaDe+eV/B4sH2AX5dAl3+nKq9J4rRxxhlVAdnSKoPLlxxB0g6xjHbcBu
FsYzi9AZi7uSz2sbaCt1ggfpcKeySiAhPErY6a8KMQh619d2BOHszLNe2S3fEPZOtsrvF9PtOT19
MdyPuh0n+MhbMMSgiH4Z0Isn7KLMllgj7IKK44ElnVgIKKyj42GXmF3wfr/LkFSyRnXYxc3R0laW
hS3MkBakVJMG3L84O4NiSdHoLTTgmiICPSW8AEcOpgEb5avPdtJq4Nt0tt7AQTot7q8AQu5YfpUu
aoUmbAY8gq1MR50xZZAljOrrbha2Pq85XE2RtCF9RdgeP/WVxDbTCvWcqw9Qks3TRJ1xtZeZFz1R
1T1low5OhiShCerIit9a3dvTmf6rv8//Hr198xFO2g93o08vX+6TF5VHQ2a6P/vwKaIVZb+GzNaT
9GhM07egqkCUatUzhF4t53DdVZUgsJMYVdcdb10wiC3mMtgGeDxJog6k4zwR9PiYi88FOcfKM41Y
Y66/MKHgX0YheYEFi4ToqmkWi7tUoV4dyV7SbvKiJMYfnOd4drU8sfLdvllki9E6WKfzebYDIR7T
B7QUkpxx+vzBESpGE11tyLk/43CDuCngFrraXlBZidnqBG2/Q6noWbfE5466pRqVn+gtLRARk5Zn
NHJARILhSKLyAv7ybUu66eJ6mwTxNgxOLDc0fE4GORRRKQSy39AyNJWFi8TWwkId7+Ab2u9Glbn1
+mGdjOflg14NbuOuMJAo2NHWP+s57O7VPL2GNU3yl4NoNU5n8ti2vIFqUJhpw0imDeNIjDshSknC
QtSJREPaUEvaDnnx4TKEWPAW2j/cojQQhTEPL5RVFbeZ48kzGtLyqichiwod8IM3mbFuf4OFu0vX
JZ4k49g0hQduXw/n2dRj45yJ1R7cX1/tPd6S7CqZJXdT+QM2W+DffPV6JaF+y74JVW2Xkhh3JkKM
8ZAjSNy3S7//zcwd4/myx9QLLXuFRm1oFlpmO6M45oMQMoyoabIT8osqc4FGlX73ITslMELISRBk
t8vF61GykvFe9Re0rSERrmSVZ6NZGoyTdL6s1244VQtEJ2EHTYbJSBDUIfCbqgU6++Xd+96vlmX1
e5VdvNAFj2HWhnhhbHMl5YL2Q8iFY3nQeAmfM16zXnzCXv1uYdfzJqVCc8jKMBoI29AntFxa0T/n
vT4E17qZTB0BIZLPd5wm5HMiIKMtmkE7SRKiYcI8EBCP11gVCpsH5QxAE7XgIERrnnSwjEW0wGzc
EXwEWQOkDRC+t4cArBlmuw7A973FeJUmkqoUDKDwmaaLdZ5mC9mkmVS+N7pGev5VNo2Mmyopbqq7
11ZoRMsgqSYwjLdeTg7gwz2eqAe5MGzBt01olCPICe7ny+lJMIGNdn8Lq9Uax7NhwZXAhL7kZrTA
Om8T4u8enrKxVWLEJVuFdTHyrJDcE6Vfj67PObo8J3GNmCYgzXj+myeuN8NJOCq6HbHoxGTMJgxS
24nY5kB5Ns+uIW23tcPlYfQWrulKig1cXUIR1xtncDDJQ2mVXkMhBY9XLrEHpGwoR3CKe6TXDZEU
hgmbKk4oIuWRls4koNTU8YlUYfMI6uselNZXkPA2SF22ZgwdDPA5XCQlsGG/TTSvJ3qK+JFqcs+Z
ingAwrVUxOM1VglBpxI5jiA8oeev6LF+1H3GJEM/W+VJ0E9lb1SeckP5/XAPKO68GKrHUEhPSTOZ
K0aCS0aTlBsTwnd+wCkhoBMMIOw//xXn/H/1EKJTiqVBA9UZWMUyPMJ5LlbBWBu32Q7BWP4hMRzH
XUxEJF6QwmxHcvu2iGvTZXbKMOhkfkqfv8FB66c9BCaq+oCCDTt0nMZDllYQFvODHphjG2f9oQcR
kl4m8pfDnHQwxBUCx2PTLyefztWRynmCOiRJoyQhcKSOED2gp/nrK4iXV+8+vL1aLmawNa4k3LXJ
pi8H0eLho4O+Cmm+1IcX7pPOLcOhh78Yt0HO0rSwkmCWXk9k5Fsnw+FTsnZOgrfzVRr0k9Vok0H+
D990h+qbChy1rcOMjHDX4eAas0o2OUTzGIiIGBVdTkNI33noGzidkihmE/r58ZEicBqJCUL9fi9U
ZiBho9Y4D87T0fbaQXUaF96mh0OKJkP5JAjGy9n1crOc7svkyo6awfvN0k26Xi1nDQpxzbIyho0q
b8HkMKxwNX5Ob9LNi/fL9XLxEAxU3JL1C+xzYxP7Rj8FOvzwE7z0dpxINoCCZ+U0SVde5v+xEAKa
YNoKDc9gkIodm7l2FkBtJIGWcBh2+DjhaQqBFJf83O0n8uYDsC7qki6kKt3CiAjFmMEPjeCMpTQU
kvErP5h2ocr94FQOMshZLciBEmV1+dzcDyvHriBacs3NK8SFwKyDY8fIpDNiKUlGn8H34GHIeSRZ
9jaxcLe2kzG2ilpAtGJtbssosRYPy7lqkNIpLKPxj1dlc/Qb8x/Klx0x3VWPpLZAaikZ8CnFUDU4
SgZcuE5i1OW+A5Bu2S1TsL/11dPL2i8kUTkJ9HrEmrhQNSXXWPDxEP4TuKukeCPf6R23IpqeZuJW
xqZsTXNCzwb9LX2sjjsqRiGqjubwU6Xxe0zeUs63ZcHPyV3wo3nv/eWxNKbcadfJZpxM99fdKTNn
8Knw86cvYVRzWf3/IdRgqtEfqMOglaUHv3rr+84qKXco25LwRcNdL5CgFHYKHLAQuD1vel8BQ9Ps
tw3uLK4DEWNWZCbhqJPwZELhuOpMIBQ4gAgj9/ppufoox6xvrrLZWJbsChLPbuDhRGsoHAuLh9E5
HnRjRb8XTbC4oidWsPF02pyrcQkJ74O/HTNwa03q2XDUQk1EInEwf/0ICOl4aOhzsR4rlx1XSL4N
6+YUADXYSKKFrpQu7rHe3C/S/Jgp5ac5B3bZUaR3ZaPTEDVmRxSzEKEuxpDYYl843C27qt9Q/PmH
unBsSY4YwRH8UnL0h1poqwXxhWvzdrL3dhSjsJi1LfPi3ZytJd7d3wajbL6/sE6xWqNup2EL9JI6
nwjhPuaiH/bPEFXqDGchKtQZeDi4CPuIXUBm+lpuImY7eGQYUTfAy8HZ+kreAiV9fH8bGAoNjavg
opWoFZa8kN0Kq7Y7MvUS3GrAOoJG4ZO3ULpFNVo2wpQXRE+OOiM0ChOOrETP8vJ/goR9+Wn9AhOG
XvVfXf7X7NOff7y7vrwf3A/pu5dW1mvDiH3lbDDe9eGPv6I//3ifj3+Zbd6+md3/ORcPw98HKPk9
v0ku+zfDN4NPCfzk9H62GX38bV0Z3ZaLFVQJvpDtiVMm9CZWuWSe6sxG3dbG7HZcm92WYz+xzFWL
uq0+IlNQWEVlRCaUk2DHkZ296onHCvrvvvWs6Xdbo7l/HuxX0SmbrXtsixYwS2Gj+jDBLiSfCc4U
iyNeOQxR5alTXDggP/EUt1oVC6BuxdM9B74h7bhUvL5sIcUYaxw/Az3KIVsPIIHZr6hT5fwre+sz
2FtudXhjJjdqYaqDWJj6jVJ+TeSnUI5f06MAqiMYP/KuqPdKtdrUaCGY1B+P+fsa9cfjNaWmnqfc
v54n4hYcoYh4JlmFY2Z7DXq7pMfs3ARtzR5JEY87XAwxGYbHN3usrPtyZT29GXSmEaJtnILPpFX6
2SsLGRItwG3rypJiZUPSSSmPxzJvPn5lG1QlytV1mmkYjbwWJPegiLEkpf3BOcRq+aFYk9cvJNDV
uW0iikGRg2N1XaVtt/o3y+uHYJEG03Q2u5UycIvFQxZk1+niRR7IZuEi219npyOJfibG9IuYXkNY
jIvZjGjUEcNhHD39bMYRtDGfgRHVcYK6pYeV/SXXQBXt0Gwa7JAoYNQgx7VHAd0mMoZ6aQvmhyz8
ql5adtWpRiijsLjNXXUIwBxTOTIviS6eqsJOtyCDTkbI80OPhNUaM56CBD7abLqgn5/mwjGKpqZA
hBb0CdKkM1lUESUrl8np2KTfsqQFxWES4R1d+jLJT6Rk3PYgU5C5tCmPSqTp3QX85Ms9ZVpbhn++
6i2gIHhJ0G/ZVJJdVplSD0rko92P8BjEs+T1+K6S/zx+t2vR5F1y/QARExZC+nTCQbjJplDef0yN
fXb+/k3397c/Q+GKujK7wQRTggjsLNh5gkSEdi9fj1fL/G65zhP9tnLaZ+m86xYESrHQJEzmmQQZ
gmQT3C/Su3QKqcFhgdSPDhvyU9LYX+ah4AyFBasE8iff+OU0ITNsulvI7lloywTJgIRyTkf1bRsy
QazBkwxO9qMywT/X6TBdZ/D/5SwPftysN8UDFUjKUPr47ttvfir608Fb2bReWhrW8knvk4+z5cds
tA5610t5fiZ35SPa8/rLcbJYTx+CNw/LFeSeP14/DLcPac/zgc+ahyubu7QuaYnb5fVyfT/L1xDs
r23aIiptG2I+7BDOCBmPUEdgX22RQ15c7menY56OQyDRQmdddWjL5NkDa1OnpcZt+t5CbnLI02ab
NC/JjVUR01ATcUSscn8YlSkrACE8gdw7TVIymtikHZpq01Lw3+lTaCgLkRbgwbDmRAQZ55bAgoed
8TDiw4h+6QOd/mOoBf2FnA/Ou2ar4LGZ0DrrhSgS+iPsCbcPpb4FKG7B9aZBoBMylS6GswZKSi95
ipCehtGXPhPqgSNageFHXlMutdNP1NA+aOFut9qtGJf/Z4iaMhhbyOLvlV3C6iU7P7RkttOHNfI3
UhhEs8lGJCKOQ0n+Jt5EQrd5q0EfbEGLAvP6rXd+TqLeOaR57OzioideW+3eiuaXXuWXM9mVXK9h
qtR4S+toqbFJir/lv/7jH/vL6zS+NQ63FnA+Glraig2zHs1DKEiK1T9j5+twxbxHmmEeHmC1mOfx
mnITOK2Nv4BB0Dh83tTzJ8h61tJlJs/UeM3VO6gSbu/XV3BMpdkVJBa3ElSS/5RO9+mp2nqQS+yP
1FiOi4fE3RJDdNKBE5rFfHxMeuo0nTbHK3hIWxhUjOqToef9kIQXYZcNECwvooYtZTXfx8Evo3wb
I7kiuyK/HKXudLllExr5rtPIQ87SGMHhJMhlEM5m22epGtZ4z9+gJE1n0p1oBW/7ISvsOz4Wj+b7
t9eigK3zUAsGRKX2cJjGnTEbiSFJbcYl5e5w+o3rRKAWBCuxPjk1y9Z58jQAVJW4W8gUNo81USjS
IVOmPOZd36kmt0u73iCLWhByL0gjHsPB5kSvX1WntvwPW9KaJLBJGHw4u59r7KgTNZX4e5XJ+Our
H6qn6A+Plgfzh/U/ZyfB3c0d/JaZxm+pDrGoFjWur3ERabEaJhYjyQwZRUJwXhkmnmX5TXY/9wi1
GkQTuSAaGtM2qCKR35rXB8I9eATFkm8HwgMJxiXr3Vy4napYOtN4DoRHMlFjdYL9diA83A6EDzso
RTwej48fCN9b+GngTuzHA4pIK1TlWMN5xpaxdsIxRdLNEpFxOEpH3DLW3pQl01MUnpLdqLbKIuuZ
VbG59E3g3AKK8QhhfZXkUL5c32fj1Hqm1hNYrpqm4/EQdzAepQmNIJMtm6amLmusITSxH+uHQkna
wrxpVKsY/fqaZ9G/1HPqsL7m4YZTUpSmOl1crpwGuMQuwIW2MaZaeImb48E0OusLuOsICpu4yohq
WhcsrAjyHCRrovvzGSnj3uXP7HA0mP7paOwx5oQGZ+uYtyjXXgN3Yie4A+VsC+COZe3ZWa8/6HU5
imHtG7T2pLpmZfqJ8SOnnw4kNRvCA+VV1jCe2E/RBkeiBcpHNWn1LvQ9WhBa2LJnIyqjjLRsBMKV
RYT1/ADV8EcSylgDXmIX8BLxFjIOBb5VtzWptKa5NCNFzCaF50nCkpbBu8m+23HhIFxfM9UbmCbj
PEiCaTJMZ/D/YTaD0y9/uN+k+VB2CVw6epATEQKpImMR6uKII/4CFzp6s+Uomd0s13lXfTVeQr60
qMQnDVuJXdgKa2F9cGwzQySEct6lkD5ARugxnKl88NBR4ak3TubB3+B4gRoOvpxaYI27ZPaQKN5T
eU1112wXIoExe/7CGdfNYh0itM1Ss5Sdouio8162WbdVedFrrVbD1Z5meUU1KCJ2QRGCtSCoqWju
u0/g4GA9hRs1JroaUXxK6wpjZUMKiThkohsLzg5wfddQgNjPj5ryNnyP62apB2oVfJbGZoOo3LHz
yhJ/cGU/xvs+LqVQwPVagUKr02d2S2OuIQbcRQfhUQvhS40LVYfiIfN+Wovb7Y2GK+gbVzpvjZ5e
AqoBKG2hNhBQKHjfaVwr6rmLdgGZ4/NHNsZsE8hfFsWv5ub13beBD8kv8CL5yXfzZPl5Owr+Z9P8
uAZ3cLcQSwvy15RZ0p9GM82mqfroVIWEf6Op+oNYSA6dgboPacMTy/2gQSDcOWgVshb4RqFFAEbg
iFCijEgJihvgr1gfIAwLCgZ5lNqib4fHNo3MCjw02Sor/UHO+uzWdpgGSZ5D+EzXsP7XD5ulykb3
66OBJ9xTDhi1MSjMalSZJzDwbHteRsOU63r86FT+CQ1MmWu4CnfrzoRtaJewuuwMooXiMaxSh40i
PpI24oRvIaVHRefkuvSTmcR719lVcSeo5mqeJ8PEDLKHYGbGD7lUG+VKWncazGwd8IbSCzE3r5Zr
+Ar/akn0dKIWXINZuJ8lEY3DFiznv1DzcrWQumcOYachbyJzqeHjScqTzojFE9kaOn4KvsnOp1xc
DfHhTjGYryRlC0k5bDa1kSTlwtQGec/Scg0S4m4joRbUFf/TIDihYTDCicG00DImmFQvd75czQ6V
sZwp3Pw62dftpln3iQ/1jWBZiJHGy89piAXiUttXeFPyhQbLCKe1EEYtHChI0xKFbS4FpbPgbrWU
vkn/OiV8Q0tdXnyHCQyPUCyKqVfufek19EB8tR9+uoRJaIW4cBfiLQC7cKfaJiGsY3COYTd8yo5S
zDPOaM8RweZ5vKceCqyhc96vK9dfK/SFX6EfEfZVN8o1UchQQaGwZsx4O5U36owprLqsdz9DN8o+
7FiuroYICCciwNsQA2Y1tQA/8Ib7iJ0cTwo8eJsciN9Ep0qY0MBvhIYLCKfoCWujr2rByAWOev0I
diCTks0emKgERAvl2YPHbR+Dvx/j5x4gcHriDaUfPvgGx29wDVfnU/KwX3oNtxBurx8cPj9HDYpy
U6TKwYX9jCPWE2Q1eO3fPAWZuHo4P9FbbjNkpnmp4mqaV8uQCaHwI7sYU/gr9s2QNWhEfNXJfcIM
WUM5hB/xJSS0BR7pv02GhGEVT1njgOhomyHRTpKEaJiwz8iQQjy4oIqyTm0ZkiRxVpZXfeuiW7TQ
NCEWugUjYtDrq1vHyswz6Y6EKMH3o+gWn2vUVfiZpNMgXQcSiVhOg0TtFQiY6TRdVNYC62vhwlgo
akH2gNnCWMR7cAjAFovlXIS9HkW6AyisxXHM+MdHkLyF2Xe67C5Z9iZvU62OrdmMRpjTmJGuBDpj
TOo2o75Ucv/nHfM7WOxRw1BQouxRMZ7Y5sgeNVh99B12m53om905AoTbiDwFkVLbC3l6k+QB7KVg
fj9db7Kp8qfe+gkftpW3bnHrzWzp4ReH0ASrYVY6oVA3T0axGMKpMIwKZ/HFbLhc5ve3f6lRnXxf
ts3UiCZNSYiD3heLGFMp3ocRFEDcM1ODF+rrTv24FSJsAXJhNQUD6ctT2MTEuDMRYoyH3GkTU2mi
P5lJjPaeT2kRg6QNdynlY1jEYBTqC+dSjcHy7b4MaxgR8zhWEKPNirwo0KMKiY3K1hVui8RWHGCP
2pnpswGqXZFdB4tsMVoH63Q+z4LSRW23ekxfPafcC+ctlEjcgnTji3Peo8rv0EarLbjcqLJ6TPpd
HGfI6tBQT5Ugtcr0l/KCf0xm+XKTJ3lSvcKRfoVd+BVvAcKwcvoYOosvUFdK1NftRErznepQo1S2
OSp1s899VQ4IufEvN8nw/9i79ue2cST982zV/g+slK9qshUreIPQJbN2bHknN4njjT2PullXSs9E
Y1vySnJymav9369BiTJBgk1QdkRnb+bpmCBFNRpAo/H1902j/7q5HHcTIdbf5vYXmdFTCWLO9Fp/
EI1n00wHabeD8CIksv31Rngru46U1gctAxZXZeE1y1Z2CUvoxzbKEuRg1OudzzvY+byDCe03C6Jc
knNGz3rXcK/95d7H8QJ2pTAYbjuyAEDPPXpJyfMO5eDBEN4HzzuHV++u4PbBdJ7ywXc9UG+R8EcM
RqS/MxjyLtMQ/2iaHEN0My8O0cqs25pfz8aT92UR2B0etXbB2HXBOCz44Q0IZHOXiN1HPFG9yXCx
4srRnRUs46VhtN61eSjK9m/5NAkMsfhItKSlTyvjMA2t/g1vufYK43oFqkUluaINKG/EhcUjLD2s
zAOCGec+6eXJ7k8nx++s6tr1h+Hl5+HFu/VpdcLydhsrF4n7YWvEM9wOaV9SN59GsXwahDwNoPTo
bbX9z8Pe6+4cLPsfB4cHP3de7PWng+G8P231p1dZ7PyH7uQi+jy9iUbTmS1UHdt7YHqLPo1hLXZu
8nJSOn7z5ojHkh7KI9l6QY8UOZJy983xAWVSHRjaIkQeHLLDTvZd1vPIKiRRmSI02LDwZS7V7Qc3
l0axXNofRwL1jgQodXM3FMvdMC0awOKZwnRFqEmhIWqnxzgs4yOyM+quJuXhR5Qc+4fxfP7u+YH5
mKDrofEmlNi2DvbRS3ufJdCajKbZh4RBY6rJrr1V6eAmFaB8St28DEWhUKqBPvXTXZedb2TrLrNw
7mSDmEgWP2i66wBYeaEuMeCedWe7uRyK5XJg19EA2MLb2YcQaZikqs6UFdnC2uAQscIaLR94Z9Ol
kp5g/R3dGw5pd1jd2SH3JJ1NZfTmB9gdLvp2ob66voSpftCyTlDceRxdwnexPxwOk2bLvQj8cdYd
LRLHgUf9etJ5+3r/uHN8VvMB0T/+Aj1rm8yj6+HsarxI30SrqPPLy9OzU/sHAg5yAE9PPw4c9Kf9
Vy8PretYmI2gmgh+HsHv59FH+KaDTMvjzi9nkdbn0Qm8z7hvX8HOsLYxmEIlzd6CF+/+DK7YOY9O
4T37i5xh3MihbIeW2MNZBxna1JleS5PeS2nabNPc0FyqhjiiIeizXJ5gz7NcYhZPA7fqBP0wFyrg
eVYuOia+JrnAzdfEDT+Yr4m7mnFfE3cO9NmZuklT3NLUzf/5bE3dDJTP2tTNEMS+Ju520Wdn5tiZ
+ezMHDszn52Z694+OzPHzsxnZ+bYmfnszBw7M9zOzLEzK9WqXzZ2LM58FmeOxZnP4syxOPNZnDsW
5z6Lc8fiHJ9ZuGN7XjG3uJOLrxe40wu8FOi8bOz0B8f7gzv9wX1+z51e4L5e4E4vcF8vcKcXuK8X
hNMLwtcLwukFgfeCcHpB4L0gnF4QFXO8O8n7RoVwekFIXxPH9sJne+HYXpSWhD5G9ea9jVEF9cd1
BLcfoxrOmSaoEHCAhm2AIGqATmaARiMuC+j9+qi0Ha4W5l35UQUrXOHI+7wyjRxv4zIBF2/jMjkS
b2NUtiJAHCGAIT+A6x2nBve9eCnpdKZJIJ9xAIUuzrTqfV4gYWgAhyVOo1h8HkRCJZuUsFg8l83j
DdA7M6f4czCZRxfwgvPhRb1t5+vuwpIvpbigq+5lt3/R3YM9zGx4NbxNI/lLnnNFFky0Wbl8cGwY
UxZozSw9ZqgCQtiOJ3eWahooB3U1JjbuENjJLrrzKWxf04xdUgK3mC9uBuPpbYdUd9yTauobD8ea
tqLwvFRG1SgGG2JuOdZoy/4b1othm1EX0q0aSJIzXoD0gFUSSFtXabnDhYxNoq2eIrAGaX+VZXIt
xOD5EX93aA+WwEY2m5OgDAbevq1CYx19akfWMWZX3f54mriYm4+KM51J2sS0BcczsdjuP6d8JhsA
RZpCIcyWJ7sn0cyS3a07ulWUEcgxATNqmYCNpJQT+AWlKRFw/3Mv6fCW85FOeu5uj1pNy9yhRmB8
mYD2178QoUzMW5RR0eKhqshB+aAcpDbePgSJc/Yv55yCsszogAVLrcFFLrX0ykVe75+9PDgt8ZQw
CIH1p5A5vdzDXVezc7AmSgje4lpCl1UqWWOc1YzavxWTYIGWUpLj7pUq1CA5vjyOevuhkeBs6zNG
dQ8HrMYVcwpMBTS2CGjS4kRwc5dJpd6zvFSs3LRpKeOHpWLlMrZhgj0sC1Vbx3LDucqgRuq9KDKb
aEs+mDL+fKnZpNYsQQnTqgXbEwP9fudJQnNqie2DJ4mwNL7Tqxp8Zvs1RqaAAyYx7SUhH+uxnd6I
jdSAQ8jH1kpeo2FvOr0olL7//a9vh+N5AsN797fnB/z5PoURviSsmI9Lw73a6tZ3mcSfETXSyy9H
BjtqNCCqH/u+3NKHGFExXfoQrRjFz4hekmF0Wdzb6XcVgV+UP9n+ZdcwAS5KK/wTukQPzfLZZrjT
JV1wRup79sr1Y2JiYh+ubWBT5fzloyoL++aZwS7bjGTEXv2BNXY6lautixuocxT8VgUlwAOXh9Sf
XJW9rL93Kp3dPYemg6VcHtW9Hd7vD/o9r7fkuufm/eerITy3nOwBlqYs03UJ/AQ9GMyBT3QDoii8
QN1JubHA+ZaJW1zCmLEKSFwZzW3k7iggeZWgl0i2LBE9zQpppytWjk7PVhyvR8T52l/SJWrpNxl/
KYqhelypDBGEHcS6A0awBnaiTG4wYO6SC8jjNkbLPIThO3QE0ZXy5yEscgWmXnNAWxaklKXSTmA7
evWU4Y7h/R7tkpJshgtq/tSOeik8P0dIVkQJ8nZSAF0xBNFT9QJ97vb7m5CcLlGWe5xYmk5mHubm
sQg459rsvzhs6UQvIMulXaVoZKiVAoaZR7M4KO7DkRA5lkq+fTyyoLR0e9jc5jCfX6/ML8XU2ApD
WBEEudNWsNajPAyExpZoeeRU0/ySJDE40JKBkNHQDBMOlnEnB6oaiJ4MkllitC3NutjkQewFmZAQ
aDNBWLX2dOVekFEZ29QBJUaFbQZDgU05Ws8mhAio9xin3sxwcvpyd35zfT2dwZhf/XBbSWLnhP+e
Ty/WiSD4+X16uTgVeMcciTMIa8+YgyBBrsYcCeUXxgFl+fxLAwuyLsTEsLAddQw7SCqpuKekNKk5
t6Xj63JFbY8pKdukgiFk7NpixM2WbGyatmGcPXcj9hiAxaQqB4MuH3UflroHCibMQ7i3P3QVKdBn
bJz3Xe9r87jskG1uDjsdmLko8qHdY5oHHnePmR77cqHJHtu2fr5n+Qmhhlvlp7MJGnvklZGbLOSn
a2aI0iGAgmXdIUDV9vk9BS+WIbFu0k8WfLHTBR8wwyGey/zx7GiLuczQNNAKQgKdxlYQkrg6aWhL
ppNnx3JHqlHcNaY0aaiNNMbmyxN6mVopw3xOalkjzxyabqkzi07JhhjFWecxRw3ERsSjt+BPEN3f
Bmo1tpWDapAiU4GZG9vCStwIqwDIYXkLpQnCAew52SXaAHNvfJuMOO0uEgqG7Ek2uJdQd9lvFGpo
y3bIeV12A5s7u69jYB8KUyrlsZVmpyTmSpRKs1fsMWBPqqS2e1Kb3awAPaRdiBYY5IaP2P6WEXZg
DyE+eXIbnsIqew8oMzx1sQHyz1kfNrjfSy0mZZuWYxON5hx8GOb+GiSweLlKzuHo9s8QBFH35nBb
hSU+EA+iJDPFCiu0Qcq1ZyU8X6kWt/8JhTvgxUx5QZ/tY1qFK3HyFTtQXdhq3oHq3u9FzBCGA2sV
RHUr8WISmifFi93yGl0NLHr/3mAsoe4PjBX4LD8YSyBiYxaMRWBvvwJjyVDXCiySzB2W8+0Hx7B2
o8AsdntA8dBO6nCYJ/QcBNVS8GrVrAAAFzWS1wBwhda9uqh9HW9/Y8ppQdYkFOVUAtqvh2vZOoir
GrJUHAYmYWWpgCzh5cu55SRugCROFA5vx++Hk8+XzaZ4aV+tclh6h2nGRG9QneKtcZun2ipO4tFS
WQubKltGvBS24zp4zkdr092R3kQKapngLEm+NdX7gVnGjfFv32yQ+0wS6MEv5tkx07bV1ULIuOtk
S1PvQmkNchrBDSTZuPQw1hIiOiJuWb2l2FHJLSu6ohYQwTc6YMz5Yi24WKK2NJhf7yYqA3uTcU4W
IkVxFYrHciiz4Gq3PEVQ8I1pTSDKYJGjL26AjJ0Kz2lzGYyqHCZmC7DkJs4QshOGLq8VdSYHzan9
A+lBnJ6QugEyUEGK8V3w8ePXB9EPj16jDY5u64PdCewtMxqz/sgxlD8mp7JgGtgtkNvdYpHek7UJ
TOB8i9At/zlafjtY81irajuoLKEbUxb/oUXYfhAn/XHlEptA5El1D8itkNzRHTkTXCAXOBwiTieJ
phDFx7Cg1sjchHIv5TD1TWiYF2d2G3HFHBZZSezfJCDiklbij28kOHw4v07ipejt9HIY7ff705sJ
9H0+jvqueO5dAoo/v+2FQFKr5oXkBbmHkXN/2dm0owl30heEtElp+jw2PE7ArQyC+BYLPcLDucRc
QI9uoDhRxYUglMKs0FLJRrBlK3+otOft3MSGUk3LztszyAHYWDlZIfiHltQAlaTrSzwgeMMcXF75
/7vqEYL71V81sHDrWzZAud1+XHAPlQSDKP9eHsnUhNJa4WT89+mk22AGEUKxVTJouMNJfwjeGZJD
Cr7Nn0HkmNxabAw3Ks0ghp5p47yKuV19A+eRtKjZtSGEqQyMJSw8jcQlU2phdS2bTL0LaOWpZJ24
PnfIXXOHsZ4s7vgWJTMIyr3pziC8gXNtGBD/cmoMICDNMeDT9ar6OnEBZ4AtBW1oDNOfav19f58K
qVfqles6kVWpaUa48VGq3Og2zOL3MgW4Wa+bwh23yq84bam7LWB6+8ATrgps7IT1l8lsxtUO7zLW
G1Yc6N2pVH2jpE9tpNEm4LOg/I2TypdtAdujipO/UJraXF1uvP2YmCudG3o5nJZuC/YQTvuf/PlP
31TiTOoAAmphzKoyQIQKpmHrZ+l5iA7KAIWyE7vTM0S8DfjI7fS8zBe4eBlwE/KFc3wN+UhNGFmV
l9RBJqVeEkhLnS/i3T5AlqsY8RJj6eEeRoX/F/CSWvRc1V5imGQG5hLOZJiToHTk7gTSSK2p8iRe
NPUnXoiBwVY/8aLWp8TexEuRbuNLbBg4lVKDhW2wUlXMXZWOqfOskigEpaDPleE0QAHHTQF/8gDg
rAHdXAP+V510C37UCquaQ2MKcP3ywsw6rHWp16CqBO52BkbrV12IcZ9Jp2CM5P0dbSe4pODPLfqP
pV2L26Qc61zvMDx1oEDNCncCEroBVAorrEvhMMJ72xljR9pZPGYZRZu2hzmiQiEwVBvEHd+yEbK2
YqeEsnVtjzUcp+/KZjC5VfSuggrjaixuBAcBUgNsIeXllvfH5vKknMnFDwIoxOJ1yVryGae69/tR
CAIpTbIoBJhXUhRCaEl1qBaPiyqG7WtDYhq5STUUnbuVSbWa9VJb1CmpGLO44lEuUGqAv4IThkKz
4Ct+ab72DaFZMYEhyLjSsPe5B2wWJ/WwWbhOlYtjYNvfNlHtAVbTAyKOFEwoisgyLC2JM1jaBJp3
S7p7f4RcvsO51LCoupd7nMkaUJ3xgpSPDjuxzf4RcM2iqHeREku1ebzOmT8skDIunebanzcAneLm
QUKnnPMf1aayLTHyA3sMuTx/4qHIKVywzkWDigaiP9/AoDCrGtbSxJDYMzCSFYcTp5RD6jb7QgOj
PDgthHg1wW3FGHMzdByuOJir+2zgmFgS/iDzKsG1CfdYEFonrfJN7UxJVI/yzUPIxqwUFS+dhOoi
41IPDRS8zJ01NXFqneQIyo7oTVuyNbvIlzxryktbPStoW9U7SarLrILHvrW0rlIXQGVM3TxErJoo
WS3nm/66GTDqIAiqZro6z/Ky8wiBEOIaycBRZYszC4QNLaMIVb91JxfdQK1iJdyBr1UA/+0Osu8f
7hCoipWKoaGyx80zlYONHuD8E0SwEwwqqObXCX6U58hSWQIZgYQuteT4UrcJlML+QyDrD4Gsf1eB
rFCFd3enSRtIJzAPw1Bw7cVWTghW9SvlxwOSrosSSvvDSXaqMOQeTK0N5N2SMo5y55PxHXdT5XS4
xWPUqqCiDiwq7Qkn7anCKniFakBtlfO4ePYdrDGVDo3NaU82pR2/BzWt2hJZbs0ykRkS65IB6SRZ
FQqH001kWb9eOFxwYu0ec3ReOJzdm5WzgtbiAEy9xtVnxtK2lJgGpgy5Xa/5aryBUaubxxBwZB0Z
p9QbnBSpwmpxoWOa0Gg3eW9ontItGP2xIaWbtxyXYwQH9fjfbnvfyY4qLDvKhGgifPBSrpWst2WL
qUUUZ0Ch26JcCwoANgs7ivRqwTemPe9kL1VY9pKaJrKXIlNLm+xcXHCaJbr8wrrqoUnz0GSlH+dX
i8un6qSkhmrjyiO0k6nUeKaSNwDDS2Dyy66d/z697M+7k8/j4d50PP89GUr4xiwzkhmM5GXJ87vZ
8D3cvpjBeO6PYWT/9Xm+rIcIKo3kgrb4kErd6w+IJDTem45G4/6wlTsby+w5Cc+Ak7ild2c5N00N
7+T6dGBtLfzUKDdaghNylfNghWLxQxiJQZK3ZTAoXPJ2I2087WSyNCoFYmgTQRZFTp+TBDd5EDXT
NSbUmril6pNnRY20wZVhJqyIUTv5Mh2WL1OqgUNoSYqECsGUQn/k8N1Ee1gSfyNYS/1EuyVpbpMK
ck7tpBN1WDpR0riBwn3hUTAMpbF+2AqGG23jUJ3BYprfwnjbtCLNr52sokaziqKJKoCE4CMAiL/1
RNHG7Ep3fJZHBJFZnhNahnipW5KQeoaTOdRhkh+Mygb0EDPUDUXcLkvI678wdUOgQGI56rji3Ahi
0EQJMVwDEQb+mx8gYF/0P0T96dX15XAxHLRsxxb78eiy+/69/QFiMtts2bPwx1l3tEicAR7160nn
7ev9487xWc0HRP/4C/SSbTKProezq/EifRMRdX55eXp2an8m0NcH8PD008Dpftp/9fLQegGFTRgE
4jBPnkfw+3n0sXs5HmRaHnd+OYvkeXQCbzPu2xeYgEVsWzCESVq9BX/c/RmcqnMencJb9hc5szj7
slw11FKxwBEs8DRwOZE9DVyei0IDRsq6DHu3HHGvbKCk3RXi+HUw/TjsTxfnyWD4543NgE0n6zKI
s/HVNDodz2BDDi7ybDGf740vxq3RuNbuYfUZe9ezaX86Wcyml/AEHyiMama1KRj8P4BQq6D1ZpM1
hMIwjC0dYKUU9uomu7jDZ8YxhHuWQHB524eb2XjSzTSr9WqFAwDYmcYaJnRiGQtV/jNWtLnKKeW1
dAuWGpnZZSIV4kDcOudbDXA0clVAzFb4V1gIgHmhx4kqOvRObhOlIPyqT/F06RJJX35IVM/FUr5F
ZB7LpaWa4HYnTjWP/abzYcypFqMWUWbv/adW77eb1nCQqXJLYmOdIWWU9nBNsGjXsoqv2RUPux/H
AxsdzqcTiPUPr5Kf9m4flzjEZD6/HHSv9667g8sWzNPZ5f/X1cXzaDadLqLL6fvxJOrNphfgZAPb
j+9hZVp8ms4uounNAr7AbQk9sjbkq6IbyAWKhzzF15qj7zjFF4dY2KiVDt+TUEu23duJGLZuDz5e
ozXjNUaxeI354zXG7iVeY/zh2xONf49PO53jiMOd49l8Ed1M5vDIVrm5ldEcMzcviY+Z2MDeTFYF
yLw6Ql4vLZ7o+FaoIulMWdaZ+c+0E+Pp2dsfD85+fNuJvn20gO/5KHp0fQlz0aPo+OWr9b+PdG8M
lzhsjyV8GqWcS55tkXywCv1gN1IiNE5L68+fke+i/4WNX6Ks8Ha4uJlNdk+6iw+WJB8Wib3578PZ
RZGaY3g5/mi9azd70pVw/TpN7SP7Q2gK89EIZt/INmG316NvbX17N3dX9KstkqAqbpEWPYcv+k3v
c1R8ePTtyXS+GI3/53H0abz4EHVOX5+dRLBGvjBCHsJeg+gXcO/Ilm4k3yWdwf9zlZ2Mo/3r1ZpL
RNsKN5jlrGc34qd2J557+9XLZt7gctrvXn6A14B3ZhreN/PGxdbu+6ave2BEh/LOEav5sjH+sp6e
i771/TJjbZ21NgswtThQLzjvdDo1312Vvjt8uPfN0xeAD4LP1bJDuMU1C1X6IQmRcPZDXK8tc+8a
L/Nkaemb+XAG70RW7yaUlDR5Nxn+bsvYpOydoNlsOokOu8Or6eTxMk4pf/91JJTclBnH30Wzm8nu
dXe2mEdPYdp42ocGrQH09WebgrXNdzuTjzD2T7/vvHr1/GlvPHna684/fJe7fLJ/9v3zp3O43H6a
/OdmPlv90f4EP+TveL3/8tXZm+f2XfKXvn/zuvP8af63r9787XgfLqzuKHKSCxoTSwtKWhmDl81X
mTOJ6r74859yxnlKyKdhD9YteHjbXj+9GMPTIV7udQfRDALB2SD6lgsjVPwYu2qwq5qgVyl6laFX
OXpVoFclelWhVzV6FbWVRm0Vo7aKUVvFqK1i1FYxaqsYtVWM2ipGbRWjtopRWxnUVga1lUFtZVBb
GdRWBrWVQW1lUFsZ1FYGsxXEDOhVzFaSYLaSBLMVhMjoVcxWkmC2kgSzlSSYrSRBbUVRW1HUVhS1
FUVtRVFbUdRWFLUVRW1FUVtR1FYMtRVDbcVQWzHUVgy1FUNtxVBbMdRWDLUVQ23FUVtx1FYctRVH
bcVRW3HUVhy1FUdtxVFbcdRWArWVQG0lUFsJ1FYCtZVAbSVQWwnUVgK1lUBtJVFbSdRWErWVRG0l
UVtJ1FYStZVEbSVRW0nUVgq1lUJtpVBbKdRWCrWVQm2lUFsp1FZo3C7RuF2icbtE43aJxu0Sjdsl
GrdLNG6XaNwu0bhdonG7RON2icbtEo3bJRq3SzRul2jcLtG4XaJxu0TjdonG7RKN2yUat0s0bpdo
3C7RuF2icbtE43aJxu0SjdslGrdLNG5XaNyu0LhdoXG7QuN2hcbtCo3bFRq3KzRuV2jcrtC4XaFx
u0LjdoXG7QqN2xUatys0bldo3K7QuF2hcbv6P/bupUUQ7LzztNcF9R1iaQStyfd2LmC0sKTCQgMC
Xxay8WKQivaAPDLT1cxC6LtPHFsDVrfqgQGthsmFnRX/wgFvpFW/U8qMh92+2O2L3b7Y7Yvdvtjt
i92+2O2L3b7Y7Yvdvtjti92+2O2L3b7Y7Yvdvtjti92+2O2L3b7Y7Yvdvtjti92+2O2L3b7Y7Yvd
vtjti92+2O2L3b7Y7Yvdvtjti92+2O2L3b7Y7Yvdvtjti92+2O2L3b7Y7Yvdvtjti92+2O2L3b7Y
7Yvdvtjti92+2O2L3b7Y7Yvdvtjti92+2O2L3b7Y7Yvdvtjti92+2O2L3b7Y7Yvdvtjti92+2O2L
3b7Y7Yvdvtjti92+2O2L3b7Z7Zvdvtntm92+2e2b3b7Z7Zvdvtntm92+2e2b3b7Z7Zvdvtntm92+
2e2b3b7Z7Zvdvtntm92+2e2b3b7Z7Zvdvtntm92+2e2b3b7Z7Zvdvtntm92+2e2b3b7Z7Zvdvtnt
m92+2e2b3b7Z7Zvdvtntm92+2e2b3b7Z7Zvdvtntm92+2e2b3b7Z7Zvdvtntm92+2e2b3b7Z7Zvd
vtntm92+/7jbP3+e+8/wewr//fcT/qffV/g/fVZ+Dfge2HwPbL4HNt8Dm++BzffA5ntg8z2w+R7Y
fA9svgc23wOb74HN98Dme2DzPbD5Hth8D2y+BzbfA5vvgc33wOZ7YPM9sPke2HwPbL4HNt8Dm++B
zffA5ntg8z2w+R7YfA8cvgcO3wOH74HD98Dhe+DwPXD4Hjh8Dxy+Bw7fA4fvgcP3wOF74PA9cPge
OHwPHL4HDt8Dh++Bw/fA4Xvg8D1w+B44fA8cvgcO3wOH74HD98Dhe+DwPXD4Hjh8Dxy+Bw7fA4fv
gcP3wOF74PA9cPgeOHwPHL4HDt8Dh++Bw/fA4Xvg8D1w+B44fA8cvgcO3wOH74HD98Dhe+DwPXD4
Hjh8Dxy+Bw7fA4fvgcP3wOF74PA9cPgeOHwPHP57/MNuP+z2w24/7PbDbj/s9sNuP+z2w24/7PbD
bj/s9sNuP+z2w24/7PbDbj/s9sNuP+z2w24/7PbDbj/s9sNuP+z2w24/7PbDbj/s9sNuP+z2w24/
7PbDbr/s9stuv+z2y26/7PbLbr/s9stuv+z2y26/7PbLbr/s9stuv+z2y26/7PbLbr/s9stuv+z2
y26/7PbLbr/s9stuv+z2y26/7PbLbr/s9stuv+z2y26/7PbLbr/s9stuv+z2y26/7PbLbr/s9stu
v+z2y26/7PbLbr/s9stuv+z2y26/7PbLbr/s9stuv+z2y26/7PbLbr/s9stuv+z2y26/7PbLbr/s
9stuv+z2y26/7PbLbr/s9stuv+z2y26/7PbLbr/s9stuv+z2y26/7PbLbr/s9stuv+z2y26/7PbL
br/s9stuv+z2y26/7PbLbr/s9stuv+z2i26f920auX7/rd76/bd66/ff6q3ff6u3fv+t3vr9t3rr
99/qrd9/q7fyVuj2t/JW6Pa38lbo9rfyVuj2t/JW6Pa38lbo9rfyVuj2t/JW6Pa38lbo9rfyVuj2
t/JW6Pa38lbo9rfyVuj2t/JW6Pa38lbo9rfyVuj2t/JW6Pa38lbo9rfyVuj2t/JW6Pa38lbo9rfy
Vuj2t/JW6Pa38lbo9rfyVuj2t/JW6Pa38lbo9rfyVuj2t/JW6Pa38lbo9rfyVuj2t/JW6Pa38lbo
9rfyVuj2t/JW6Pa38lbo9rfyVuj2t/JW6Pa38lbo9rfyVuj2t/JW6Pa38lbo9rfyVuj2t/JW6Pa3
8lbo9rfqVsFuD3Z7sNuD3R7s9vi+bv/8aH7vd3z/f/H7CvPzn4f//vsKM8/7rvp/+Kz6GgTfA8H3
QPA9EHwPBN8DwfdA8D0QfA8E3wPB90DwPRB8DwTfA8H3QPA9EHwPBN8DwfdA8D0QfA8E3wPB90Dw
PRB8DwTfA8H3QPA9EHwPBN8DwfdA8D0QfA8E3wPB90DwPRB8DwTfA8H3QPA9EHwPBN8DwfdA8D0Q
fA8E3wPB90DwPRB8DwTfA8H3QPA9EHwPBN8DwfdA8D0QfA8E3wPB90DwPRB8DwTfA8H3QPA9EHwP
BN8DwfdA8D0QfA8E3wPB90DwPRB8DwTfA8H3QPA9EHwPBN8DwfdA8D0QfA8E3wPB90DwPRB8DwTf
A8H3QPA9EHwPBN8DwfdA8D0QfA8E3wPJ90DyPZB8DyTfA8n3QPLf4ye7PdntyW5Pdnuy25Pdnuz2
ZLcnuz3Z7cluT3Z7stuT3Z7s9mS3J7s92e3Jbk92e7Lbk92e7PZktye7PdntyW5Pdnuy25Pdnuz2
ZLcnuz3Z7cluT3Z7stuT3Z7s9mS3J7s92e3Jbk92e7Lbk92e7PZktye7PdntyW5Pdnuy25Pdnuz2
ZLcnuz3Z7cluT3Z7stuT3Z7s9mS3J7s92e3Jbk92e7Lbk92e7PZktye7PdntyW5Pdnuy25Pdnuz2
ZLcnuz3Z7cluT3Z7stuT3Z7s9mS3J7s92e3Jbk92e7Lbk91e7PZitxe7vdjtxW4vdnux24vdXuz2
YrcXu73Y7cVuL3Z7sduL3V7s9mK3F7u92O3Fbi92e7Hbi91e7PZitxe7vdjtxW4vdnux24vdXuz2
YrcXu73Y7cVuL3Z7sduL3V7s9mK3F7u92O3Fbi92e7Hbi91e7PZitxe7vdjtxW4vdnux24vdXuz2
YrcXu73Y7cVuL3Z7sduL3V7s9mK3F7u92O3Fbi92e7Hbi91e7PZitxe7vdjtxW4vdnux24vdXuz2
YrcXu73Y7cVuL3Z7sduL3V7s9mK3F7u92O3Fbi92e7Hbi91e7PZitxe7vdjtzW5vdnuz25vd3uz2
Zrc3u73Z7c1ub3Z7s9ub3d7s9ma3N7u92e3Nbm92e7Pbm93e7PZmtze7vdntzW5vdnuz25vd3uz2
Zrc3u73Z7c1ub3Z7s9ub3d7s9ma3N7u92e3Nbm92e7Pbm93e7PZmtze7vdntzW5vdnuz25vd3uz2
Zrc3u73Z7c1ub3Z7s9ub3d7s9ma3N7u92e3Nbm92e7Pbm90u3/WtvBW7Xb7rW3krdrt817fyVux2
+a5v5a3Y7fJd38pbsdvlu76Vt2K3y3d9K2/Fbpfv+rmy2+W7vpW3YrfLd30rb8Vul+/6Vt6K3S7f
9a26lXzXt+pW8l3fqlvJd32rbiXf9a28FbtdvutbeSt2u3zXt/6nW33+LO+f4c8VVO513p8r+Cy/
9fuvv/oTn5VfA74H5Ma+lV8Dvgfkxr6VXwO+B+TGvpW/XvkekBv7Vt6K7wG5sW/lrfgekBv7Vt6K
7wG5sW/lrfgekBv7ufI9IDf2rbwV3wNyY9/KW/E9IDf2rbwV3wNyY9/KW/E9IDf2rbwV3wNyY9/K
W/E9IDf2c+V7QG7sW3krvgfkxr6Vt+J7QG7sW3krvgfkxr6Vt+J7QG7sW3krvgfkxr6Vt+J7QG7s
58r3gNzYt/JWfA/IjX0rb8X3gNzYt/JWfA/IjX0rb8X3gNzYt/JWfA/IjX0rb8X3gNzYz7Lme0Bu
7Ft1K7mxb9Wt5Ma+VbeSG/tW3Upu7OfK94Dc2LfyVnwPyI19K2/Fbpcb+1beit0uN/atvBW7XW7s
W3krdrvc2LfyVux2ubGfK7tdbuxbeSt2u9zYt/JW7Ha5sW/lrdjtcmPfylux2+XGvpW3YrfLjX0r
b8Vulxv7ubLb5ca+lbdit8uNfStvxW6XG/tW3ordLjf2rbwVu11u7Ft5K3a73Ni38lbsdrmxnyu7
XW7sW3krdrvc2LfyVux2ubFv5a3Y7XJj38pbsdvlxr6Vt2K3y419K2/Fbpcb+7my2+XGvpW3YrfL
jX0rb8Vulxv7Vt6K3S439q26ldzYt+pWcmPfqlvJjX2rbiU39q28FbtdbuxbeSt2u9zYt/JW7Ha5
sW/lrdjtcmPfylux2+XGvpW3YrfLjX0rb8Vulxv7ubLb5ca+lbdit8uNfStvxW6XG/tW3ordLjf2
rbwVu11u7Ft5K3a73Ni38lbsdrmxnyu7XW7sW3krdrvc2LfyVux2ubFv5a3Y7XJj38pbsdvlxr6V
t2K3y3d9K2/Fbpfv+rmy2+W7vpW3YrfLd30rb8Vul+/6Vt6K3S7f9a28FbtdvutbeSt2u3zXt/JW
7Hb5rp8ru12+61t5K3a7fNe38lbsdvmub+Wt2O3yXd+qW8l3fatuJd/1rbqVfNe36lbyXd/KW7Hb
5bu+lbdit8t3fStvxW6X7/pW3ordLt/1rbwVu12+61t5K3a7fNe38lbsdvmunyu7Xb7rW3krdrt8
17fyVux2+a5v5a3Y7fJd38pbsdvlu76Vt2K3y3d9K2/Fbpfv+rmy2+W7vpW3YrfLd30rb8Vul+/6
Vt6K3S7f9a28FbtdvutbeSt2u3zXt/JW7Hb5rp8ru12+61t5K3a7fNe38lbsdvmub+Wt2O3yXd/K
W7Hb5bu+lbdit8t3fStvxW6X7/q5stvlu76Vt2K3y3d9K2/Fbpfv+lbeit0u3/WtupV817fqVvJd
36pbyXd9q24l3/WtvBW7Xb7rW3krdrt817fyVux2+a5v5a3Y7fJd38pbsdvlu76Vt2K3y3d9K2/F
bpfv+rmy2+W7vpW3YrfLd30rb8Vul+/6Vt6K3S7f9a28FbtdvutbeSt2u3zXt/JW7Hb5rp8ru12+
61t5K3a7fNe38lbsdvmub+Wt2O3yXd/KW7Hb5bu+lbdit8t3fStvxW6X7/q5stvlu76Vt2K3y3d9
K2/Fbpfv+lbeit0u3/WtvBW7Xb7rW3krdrt817fyVux2+a6fK7tdvutbeav/p9s//2d9+TP8ucLe
8aXfnytcdfr3X3/1PZ+VXwO+B+TGvpVfA74H6MYG3digGxt0Y4NubNCNDbqxQTc26MYG3digGxt0
Y4NubNCNDbqxQTc26MYG3digGxt0Y4NubNCNDbqxQTc26MYG3digGxt0Y4NubNCNDbqxQTc26MYG
3digGxt0Y4NubNCNDbqxQTc26MYG3digGxt0Y4NubNCNDbqxQTc26MYG3digGxt0Y4NubNCNDbqx
QTc26MYG3digGxt0Y4NubNCNDbqxQTc26MYG3digGxt0Y4NubNCNDbqxQTc26MYG3digGxt0Y4Nu
bNCNDbqxQTc26MYG3digGxt0Y4NubNCNDbqxQTc26MYG3digGxt0Y4NubNCNDbqxQTc26MYG3dig
Gxt0Y4NubNCNDbqxQTc26MYG3dj4Xjf2D6tuRd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg
7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd81
6LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3
DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0
XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsG
fdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3Dfqu
Qd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+
a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg
7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd81
6LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3
DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0
XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdcodnux2+m7Bn3XoO8a9F2DvmvQ
dw36rkHfNei7Bn3XoO8a9F2DvmvQdw36rkHfNei7Bn3XoO8a9F2DvmvQdw36rkHfNei7Bn3XoO8a
9F2DvmvQdw36rkHfNei7Bn3XoO8a9F2DvmvQdw36rkHfNei7Bn3XoO8a9F2DvmvQdw36rkHfNei7
Bn3XoO8a9F2DvmvQdw36rkHfNei7Bn3XoO8a9F2DvmvQdw36rkHfNei7Bn3XoO8a9F2DvmvQdw36
rkHfNei7Bn3XoO8a9F2DvmvQdw36rkHfNei7Bn3XoO8a9F2DvmvQdw36rkHfNei7Bn3XoO8a9F2D
vmvQdw36rkHfNei7Bn3XoO8a9F2DvmvQdw36rkHfNei7Bn3XoO8a9F2DvmvQdw36rkHfNei7Bn3X
oO8a9F2DvmvQdw36rkHfNei7Bn3XoO8a9F2DvmvQdw36rkHfNei7Bn3XoO8a9F2DvmvQdw36rkHf
Nei7Bn3XoO8a9F2DvmvQdw36rkHfNei7Bn3XoO8a9F2DvmvQdw36rkHfNei7Bn3XoO8a9F2DvmvQ
dw36rkHfNei7Bn3XoO8aw26nwxp0WIMOa9BhDTqsQYc16LAGHdagwxp0WIMOa9BhDTqsQYc16LAG
Hdagwxp0WIMOa9BhDTqsQYc16LDGHzmsnz+r+DN8X4FVn/9Aed9X4Hw+dP6EVxz0XYO+a9B3Dfqu
Qd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+
a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg
7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd81
6LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3
DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0
XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsG
fdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3Dfqu
Qd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+
a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg
7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd81
6LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3
DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0
XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsG
fdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3Dfqu
Qd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+
a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg
7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd81
6LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3
DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0
XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd816LsG
fdeg7xr0XYO+a9B3DfquQd816LsGfdeg7xr0XYO+a9B3DfquQd81LrudDmvQYQ06rEGHNeiwBh3W
pMOadFiTDmvSYU06rEmHNemwJh3WpMOadFiTDmvSYU06rEmHNemwJh3WpMOadFiTDmvSYU06rEmH
NemwJh3WpMOadFiTDmvSYU06rEmHNemwJh3WpMOadFiTDmvSYU06rEmHNemwJh3WpMOadFiTDmvS
YU06rEmHNemwJh3WpMOadFiTDmvSYU06rEmHNemwJh3WpMOadFiTDmvSYU06rEmHNemwJh3WpMOa
dFiTDmvSYU06rEmHNemwJh3WpMOadFiTDmvSYU06rEmHNemwJh3WpMOadFiTDmvSYU06rEmHNemw
Jh3WpMOadFiTDmvSYU06rEmHNemwJh3WpMOadFiTDmvSYU06rEmHNemwJh3WpMOadFiTDmvSYU06
rEmHNemwJh3WpMOadFiTDmvSYU06rEmHNemwJh3WpMOadFiTDmvSYU06rEmHNemwJh3WpMOadFiT
DmvSYU06rEmHNemwJh3WpMOadFiTDmvSYU06rEmHNemwJh3WpMOadFiTDmvSYU06rEmHNemwJh3W
pMOa3+uwfn608s/wfYXO+y/sfvTxu/du+fL7r7/6w2fl14DvAfquSd816bsmfdek75r0XZO+a9J3
TfquSd816bsmfdek75r0XZO+a9J3TfquSd816bsmfdek75r0XZO+a9J3TfquSd816bsmfdek75r0
XZO+a9J3TfquSd816bsmfdek75r0XZO+a9J3TfquSd816bsmfdek75r0XZO+a9J3TfquSd816bsm
fdek75r0XZO+a9J3TfquSd816bsmfdek75r0XZO+a9J3TfquSd816bsmfdek75r0XZO+a9J3Tfqu
Sd816bsmfdek75r0XZO+a9J3TfquSd816bsmfdek75r0XZO+a9J3TfquSd816bsmfdek75r0XZO+
a9J3TfquSd816bsmfdek75r0XZO+a9J3TfquSd816bsmfdek75r0XZO+a9J3TfquSd816bsmfdek
75r0XZO+a9J3TfquSd816bsmfdek75r0XZO+a9J3TfquSd816bsmfdek75r0XZO+a9J3TfquSd81
6bsmfdek75r0XZO+a9J3TfquSd816bsmfdek75r0XZO+a9J3TfquSd816bsmfdek75r0XZO+a9J3
TfquSd816bsmfdek75r0XZO+a9J3TfquSd816bsmfdek75r0XZO+a9J3TfquSd816bsmfdek75r0
XZO+a9J3TfquSd816bsmfdek75r0XZO+a9J3TfquSd816bt+rrwVu52+a9J3TfquSd816bsmfdek
75r0XZO+a9J3TfquSd816bsmfdek75r0XZO+a9J3TfquSd816bsmfdek75r0XZO+a9J3TfquSd81
6bsmfdek75r0XZO+a9J3TfquSd816bsmfdek75r0XZO+a9J3TfquSd816bsmfdek75r0XZO+a9J3
TfquSd816bsmfdek75r0XZO+a9J3TfquSd816bsmfdek75r0XZO+a9J3TfquSd816bsmfdek75r0
XZO+a9J3TfquSd816bsmfdek75r0XZO+a9J3TfquSd816bsmfdek75r0XZO+a9J3TfquSd816bsm
fdek75r0XZO+a9J3TfquSd816bsmfdek75r0XZO+a9J3TfquSd816bsmfdek75r0XZO+a9J3Tfqu
Sd816bsmfdek75r0XZO+a9J3TfquSd816bsmfdek75r0XZO+a9J3TfquSd816bsmfdek75r0XZO+
a9J3TfquSd816bsmfdek75r0XZO+a9J3TfquSd816bsmfdek75r0XZO+a9J3TfquSd816bsmfdek
75r0XZO+a9J3TfquSd816bsmfdek75r0XZO+a9J3TfquSd816bsmfdek75r0XZO+a9J3TfquSd81
6bsmfdek75r0XZO+a9J3zWG302FNOqxJhzXpsCYd1qTDmnRYkw5r0mFNOqxJhzXpsCYd1qTDmnRY
kw5r0mFNOqxJhzXpsCYd1qTDmnRYkw5r0mFNOqxJhzXpsCYd1qTDmnRYkw5r0mFNOqxJhzXpsCYd
1qTDmnRYkw5r0mFNOqxJhzXpsCYd1qTDmnRYkw5r0mFNOqxJhzXpsCYd1qTDmnRYkw5r0mFNOqxJ
hzXpsCYd1qTDmnRYkw5r0mFNOqxJhzXpsCYd1qTDmnRYkw5r0mFNOqxJhzXpsCYd1qTDmnRYkw5r
0mFNOqxJhzXpsCYd1qTDmnRYkw5r0mFNOqxJhzXpsCYd1qTDmnRYkw5r0mFNOqxJhzXpsCYd1qTD
mnRYkw5r0mFNOqxJhzXpsCYd1qTDmnRYkw5r0mFNOqxJhzXpsCYd1qTDmnRYkw5r0mFNOqxJhzXp
sCYd1qTDmnRYkw5r0mFNOqxJhzXpsCYd1qTDmnRYkw5r0mFNOqxJhzXpsCYd1qTDmnRYkw5r0mFN
OqxJhzXpsCYd1qTDmnRYkw5r0mFNOqxJhzXpsCYd1qTDmnRYkw5r0mFNOqxJhzXpsCYd1qTDmnRY
kw5r0mFNOqxJhzXpsCYd1qTDmnRYkw5r0mFNOqxJhzXpsCYd1qTDmnRYkw5r0mFNOqxJhzXpsCYd
1qTDmnRYkw5r0mFNOqxJhzXpsCYd1qTDmnRYkw5r0mFNOqxJhzXpsCYd1qTDmnRYkw5r0mFNOqxJ
hzXpsCYd1qTDmnRYkw5r0mFNOqxJhzXpsCYd1qTDmnRYkw5r0mFNOqxJhzXpsCYd1qTDmnRYkw5r
0mFNOqxJhzXpsCYd1qTDmnRYkw5r0mFNOqxJhzXpsCYd1qTDmnRYkw5r0mFNOqxJhzXpsCYd1qTD
mnRYkw5r0mFNOqxJhzXpsCYd1qTDmnRYkw5r0mFNOqxJhzXpsCYd1qTDmnRYkw5r0mFNOqxJhzXp
sCYd1qTDmnRYkw5r0mFNOqxJhzXpsCYd1qTDmnRYkw5r0mFNOqxJhzXpsCYd1qTDmnRYkw5r/g8O
6+fPq/4M31cwvrw/cfO+seD7nUe///qr/+nT8ovABwGB1yTwmgRek8BrEnhNAq9J4DUJvCaB1yTw
mgRek8BrEnhNAq9J4DUJvCaB1yTwmgRek8BrEnhNAq9J4DUJvCaB1yTwmgRek8BrEnhNAq9J4DUJ
vCaB1yTwmgRek8BrEnhNAq9J4DUJvCaB1yTwmgRek8BrEnhNAq9J4DUJvCaB1yTwmgRek8BrEnhN
Aq9J4DUJvCaB1yTwmgRek8BrEnhNAq9J4DUJvCaB1yTwmgRek8BrEnhNAq9J4DUJvCaB1yTwmgRe
k8BrEnhNAq9J4DUJvCaB1yTwmgRek8BrEnhNAq9J4DUJvCaB1yTwmgRek8BrEnhNAq9J4DUJvCaB
1yTwmgRek8BrEnhNAq9J4DUJvCaB1yTwmgRek8BrEnhNAq9J4DUJvCaB1yTwmgRek8BrEnhNAq9J
4DUJvCaB1yTwmgRek8BrEnhNAq9J4DUJvCaB1yTwmgRek8BrEnhNAq9J4DUJvCaB1yTwmgRek8Br
EnhNAq9J4DUJvCaB1yTwmgRek8BrEnhNAq9J4DUJvCaB1yTwmgRek8BrEnhNAq9J4DUJvCaB1yLw
WgRei8BrEXgtAq9F4LUIvBaB1yLwWgRei8BrEXgtAq9F4LUIvBaB1yLwWgRei8BrEXgtAq9F4LUI
vBaB1yLwWgRei8BrEXgtAq9F4LUIvBaB1yLwWgRei8BrEXgtAq9F4LUIvBaB1yLwWgRei8BrEXgt
Aq9F4LUIvBaB1yLwWgRei8BrEXgtAq9F4LUIvBaB1yLwWgRei8BrEXgtAq9F4LUIvBaB1yLwWgRe
i8BrEXgtAq9F4LUIvBaB1yLwWgRei8BrEXgtAq9F4LUIvBaB1yLwWgRei8BrEXgtAq9F4LUIvBaB
1yLwWgRei8BrEXgtAq9F4LUIvBaB1yLwWgRei8BrEXgtAq9F4LUIvBaB1yLwWgRei8BrEXgtAq9F
4LUIvBaB1yLwWgRei8BrEXgtAq9F4LUIvBaB1yLwWgRei8BrEXgtAq9F4LUIvBaB1yLwWgRei8Br
EXgtAq9F4LUIvBaB1yLwWgRei8BrEXgtAq9F4LUIvBaB1yLwWgRei8BrEXgtAq9F4LUIvBaB1yLw
Wt8LvP5h5a3Y7YRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBr
EWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLE
WoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUI
sRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWIt
QqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRY
ixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh
1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxF
iLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBr
EWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLE
WoRYixBrEWItQqyfK2/FbifEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh
1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxF
iLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBr
EWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLE
WoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUI
sRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWIt
QqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRY
ixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh
1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxF
iLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBr
EWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLE
Wn8EsX7+rPrP8Y2F8zO8z/vGwp9P8/X7r7/6E5+WXwQ+CCi8FoXXovBaFF6LwmtReC0Kr0XhtSi8
FoXXovBaFF6LwmtReC0Kr0XhtSi8FoXXovBaFF6LwmtReC0Kr0XhtSi8FoXXovBaFF6LwmtReC0K
r0XhtSi8FoXXovBaFF6LwmtReC0Kr0XhtSi8FoXXovBaFF6LwmtReC0Kr0XhtSi8FoXXovBaFF6L
wmtReC0Kr0XhtSi8FoXXovBaFF6LwmtReC0Kr0XhtSi8FoXXovBaFF6LwmtReC0Kr0XhtSi8FoXX
ovBaFF6LwmtReC0Kr0XhtSi8FoXXovBaFF6LwmtReC0Kr0XhtSi8FoXXovBaFF6LwmtReC0Kr0Xh
tSi8FoXXovBaFF6LwmtReC0Kr0XhtSi8FoXXovBaFF6LwmtReC0Kr0XhtSi8FoXXovBaFF6LwmtR
eC0Kr0XhtSi8FoXXovBaFF6LwmtReC0Kr0XhtSi8FoXXovBaFF6LwmtReC0Kr0XhtSi8FoXXovBa
FF6LwmtReC0Kr0XhtSi8FoXXovBaFF6LwmtReC0Kr0XhtSi8FoXXovBaFF6LwmtReC0Kr0XhtSi8
FoXXovBaFF6LwmtReC0Kr0XhtSi8FoXXovBaFF6LwmtReC0Kr0XhtSi8FoXXovBaFF6LwmtReC0K
r0XhtSi8FoXXovBaFF6LwmtReC0Kr0XhtSi8FoXXovBaFF6LwmtReC0Kr0XhtSi8FoXXovBaFF6L
wmtReC0Kr0XhtSi8FoXXovBaFF6LwmtReC0Kr0XhtSi8FoXXovBaFF6LwmtReC0Kr0XhtSi8FoXX
ovBaFF6LwmtReC0Kr0XhtSi8FoXXovBaFF6LwmtReC0Kr0XhtSi8FoXXovBaFF6LwmtReK3DbifE
WoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUI
sRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWIt
QqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRY
ixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh
1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxF
iLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBr
EWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrEWItQqxFiLUIsRYh1iLE
WoRYixBrEWItQqxFiLUIsRYh1iLEWoRYixBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJ
sTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2Jt
QqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRY
mxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh
1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxN
iLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBr
E2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE
2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJ
sTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2Jt
QqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRY
mxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh
1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxN
iLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBr
E2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE
2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJ
sTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2Jt
QqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2L9XHkrdjsh1ibE2oRYmxBr
E2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE
2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJ
sTYh1ibE2oRY+09ArJ9/XfPngAX6zpd+sMBa2b//+qs/+rT6IlB4bQqvTeG1Kbw2hdem8NoUXpvC
a1N4bQqvTeG1Kbw2hdem8NoUXpvCa1N4bQqvTeG1Kbw2hdem8NoUXpvCa1N4bQqvTeG1Kbw2hdem
8NoUXpvCa1N4bQqvTeG1Kbw2hdem8NoUXpvCa1N4bQqvTeG1Kbw2hdem8NoUXpvCa1N4bQqvTeG1
Kbw2hdem8NoUXpvCa1N4bQqvTeG1Kbw2hdem8NoUXpvCa1N4bQqvTeG1Kbw2hdem8NoUXpvCa1N4
bQqvTeG1Kbw2hdem8NoUXpvCa1N4bQqvTeG1Kbw2hdem8NoUXpvCa1N4bQqvTeG1Kbw2hdem8NoU
XpvCa1N4bQqvTeG1Kbw2hdem8NoUXpvCa1N4bQqvTeG1Kbw2hdem8NoUXpvCa1N4bQqvTeG1Kbw2
hdem8NoUXpvCa1N4bQqvTeG1Kbw2hdem8NoUXpvCa1N4bQqvTeG1Kbw2hdem8NoUXpvCa1N4bQqv
TeG1Kbw2hdem8NoUXpvCa1N4bQqvTeG1Kbw2hdem8NoUXpvCa1N4bQqvTeG1Kbw2hdem8NoUXpvC
a1N4bQqvTeG1Kbw2hdem8NoUXpvCa1N4bQqvTeG1Kbw2hdem8NoUXpvCa1N4bQqvTeG1h91OiLUJ
sTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2Jt
QqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRY
mxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh
1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxN
iLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBr
E2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE
2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJ
sTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2Jt
QqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRY
mxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh
1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxN
iLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBr
E2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE
2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJ
sTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2Jt
QqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRY
mxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh
1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxN
iLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibE2oRYmxBrE2JtQqxNiLUJsTYh1ibEOoRYhxDr
EGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHE
OoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUI
sQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGId
QqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRY
hxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h
1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxD
iHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDr
EGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHE
OoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUI
sQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGId
QqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRY
hxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h
1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxD
iHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsc5/QKy1/hyw0F6R58FCZ+38/ddf8dPyi8AHAYXXofA6
FF6HwutQeB0Kr0PhdSi8DoXXofA6FF6HwutQeB0Kr0PhdSi8DoXXofA6FF6HwutQeB0Kr0PhdSi8
DoXXofA6FF6HwutQeB0Kr0PhdSi8DoXXofA6FF6HwutQeB0Kr0PhdSi8DoXXofA6FF6HwutQeB0K
r0PhdSi8DoXXofA6FF6HwutQeB0Kr0PhdSi8DoXXz5W34oOAwutQeB0Kr0PhdSi8DoXXofA6FF6H
wutQeB0Kr0PhdSi8DoXXofA6FF6HwutQeB0Kr0PhdSi8DoXXofA6FF6HwutQeB0Kr0PhdSi8DoXX
ofA6FF6HwutQeB0Kr0PhdSi8DoXXofA6FF6HwutQeB0Kr0PhdSi8DoXXofA6FF6HwutQeJ0/Ibz+
0apbEWIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h
1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxD
iHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDr
EGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHE
OoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUI
sQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGId
QqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRY
hxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h
1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxD
iHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDr
EGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHE
OoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUI
sQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGId
QqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRY
hxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h
1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxD
iHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDr
EGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHE
OoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUI
sQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGId
QqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRY
hxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h
1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxD
iHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDr
EGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHE
OoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUI
sQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGIdQqxDiHUIsQ4h1iHEOoRYhxDrEGId
QqxDiHUIsQ4h1iHEOoRYhxDrIsS6CLEuQqyLEOsixLoIsS5CrIsQ6yLEugixLkKsixDrIsS6CLEu
QqyLEOsixLoIsS5CrIsQ6yLEugixLkKsixDrIsS6CLEuQqyLEOsixLoIsS5CrIsQ6yLEugixLkKs
ixDrIsS6CLEuQqyLEOsixLoIsS5CrIsQ6yLEugixLkKsixDrIsS6CLEuQqyLEOsixLoIsS5CrIsQ
6yLEugixLkKsixDrIsS6CLEuQqyLEOsixLoIsS5CrIsQ6yLEugixLkKsixDrIsS6CLEuQqyLEOsi
xLoIsS5CrIsQ6yLEugixLkKsixDrIsS6CLEuQqyLEOsixLoIsS5CrIsQ6yLEugixLkKsixDrIsS6
CLEuQqyLEOsixLoIsS5CrIsQ6yLEugixLkKsixDrIsS6CLEuQqyLEOsixLoIsS5CrIsQ6yLEugix
LkKsixDrIsS6CLEuQqyLEOsixLoIsS5CrIsQ6yLEugixLkKsixDrIsS6CLEuQqyLEOsixLoIsS5C
rIsQ6yLEugixLkKsixDrIsS6CLEuQqyLEOsixLoIsS5CrIsQ6yLEugixLkKsixDrIsS6CLEuQqyL
EOsixLoIsS5CrIsQ6yLEugixLkKsixDrIsS6CLEuQqyLEOsixLoIsS5CrIsQ6yLEugixLkKsixDr
IsS6CLEuQqyLEOsixLoIsS5CrIsQ6yLEugixLkKsixDrIsS6CLEuQqyLEOsixLoIsS5CrIsQ6yLE
ugixLkKsixDrIsS6CLEuQqyLEOsixLoIsS5CrIsQ6yLEugixLkKsixDrIsS6CLEuQqyLEOsixLoI
sS5CrIsQ6yLEugixLkKsixDrIsS6CLEuQqyLEOsixLoIsS5CrIsQ6yLEugixLkKsixDrIsS6CLEu
QqyLEOsixLoIsS5CrIsQ6yLEur4XYv38aO0/Ayz4+R/T58uXH338rr7s/PL7r7/6j0/LBwGF10Xh
dVF4XRReF4XXReF1UXhdFF4XhddF4XVReF0UXheF10XhdVF4XRReF4XXReF1UXhdFF4XhddF4XVR
eF0UXheF10XhdVF4XRReF4XXReF1UXhdFF4XhddF4XVReF0UXheF10XhdVF4XRReF4XXReF1UXhd
yQcBIdZFiHURYl2EWBch1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZFiHURYl2EWBch1kWIdRFiXYRY
FyHWRYh1EWJdhFgXIdZFiHURYl2EWBch1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZFiHURYl2EWBch
1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZFiHURYl2EWBch1kWIdRFiXYRYFyHWRYh1EWJdhFg/V96K
3U6IdRFiXYRYFyHWRYh1EWJdhFgXIdZFiHURYl2EWBch1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZF
iHURYl2EWBch1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZFiHURYl2EWBch1kWIdRFiXYRYFyHWRYh1
EWJdhFgXIdZFiHURYl2EWBch1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZFiHURYl2EWBch1kWIdRFi
XYRYFyHWRYh1EWJdhFgXIdZFiHURYl2EWBch1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZFiHURYl2E
WBch1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZFiHURYl2EWBch1kWIdRFiXYRYFyHWRYh1EWJdhFgX
IdZFiHURYl2EWBch1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZFiHURYl2EWBch1kWIdRFiXYRYFyHW
RYh1EWJdhFgXIdZFiHURYl2EWBch1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZFiHURYl2EWBch1kWI
dRFiXYRYFyHWRYh1EWJdhFgXIdZFiHURYl2EWBch1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZFiHUR
Yl2EWBch1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZFiHURYl2EWBch1kWIdRFiXYRYFyHWRYh1EWJd
hFgXIdZFiHURYl2EWBch1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZFiHURYl2EWBch1kWIdRFiXYRY
FyHWRYh1EWJdhFgXIdZFiHURYl2EWBch1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZFiHURYl2EWBch
1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZFiHURYl2EWBch1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZF
iHURYl2EWBch1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZFiHURYl2EWBch1kWIdRFiXYRYFyHWRYh1
EWJdhFgXIdZFiHURYl2EWBch1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZFiHURYl2EWBch1kWIdRFi
XYRYFyHWRYh1EWJdhFgXIdZFiHURYl2EWBch1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZFiHURYl2E
WBch1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZFiHURYl2EWBch1kWIdRFiXYRYFyHWRYh1EWJdhFgX
IdZFiHURYl2EWBch1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZFiHURYl2EWBch1kWIdRFiXYRYFyHW
RYh1EWJdhFgXIdZFiHURYl2EWBch1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZFiHURYl2EWBch1kWI
dRFiXYRYFyHWRYh1EWJdhFgXIdZFiHURYl2EWBch1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZFiHUR
Yl2EWBch1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZFiHURYl2EWBch1kWIdRFiXYRYFyHWRYh1EWJd
hFgXIdZFiHURYl2EWBch1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZFiHURYl2EWBch1kWIdRFiXYRY
FyHWRYh1EWJdhFgXIdZFiHURYl2EWBch1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZFiHURYl2EWBch
1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZFiHURYl2EWBch1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZF
iHURYl2EWBch1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZFiHURYl2EWBch1kWIdRFiXYRYFyHWRYh1
EWJdhFgXIdZFiHURYl2EWBch1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZFiHURYl2EWBch1kWIdRFi
XYRYFyHWRYh1EWJdhFgXIdZFiHURYl2EWBch1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZFiHURYl2E
WBch1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZFiHURYl2EWBch1kWIdRFiXYRYFyHWRYh1EWJdhFgX
IdZFiHURYl2EWBch1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZFiHURYl2EWBch1kWIdRFiXYRYFyHW
RYh1EWJdhFgXIdZFiHURYl2EWBch1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZFiHURYl2EWBch1kWI
dRFiXYRYFyHWRYh1EWJdhFgXIdZFiHURYl2EWBch1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZFiHUR
Yl2EWBch1kWIdRFiXYRYFyHWRYh1EWJdhFgXIdZFiHURYl2EWBch1kWIdRFiXYRYFyHWRYh1EWJd
hFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRY
NyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch
1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZN
iHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1
E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi
3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2E
WDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3
IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHW
TYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2I
dRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUT
Yt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2Ld
hFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRY
NyHW/b0Q63+s7HZ6qZte6qaXuumlbnqpm17qppe66aVueqmbXuqml7rppW56qZte6qaXuumlbnqp
m17qppe66aVueqmbXur+Xi/186N1/hywcM3kv8PCudf5Ayy8CbFuQqybEOsmxLoJsW5CrJsQ6ybE
ugmxbkKsmxDrJsS6CbFuQqybEOsmxLoJsW5CrJsQ6ybEugmxbkKsmxDrJsS6CbFuQqybEOsmxLoJ
sW5CrJsQ6ybEugmxbkKsmxDrJsS6CbFuQqybEOsmxLoJsW5CrJsQ6ybEugmxbkKsmxDrJsS6CbFu
QqybEOsmxLoJsW5CrJsQ6ybEugmxbkKsmxDrJsS6CbFuQqybEOsmxLoJsW5CrJsQ6ybEugmxbkKs
mxDrJsS6CbFuQqybEOsmxLoJsW5CrJsQ6ybEugmxbkKsnytvxQcBIdZNiHUTYt2EWDch1k2IdRNi
3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2E
WDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3
IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHW
TYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2I
dRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUT
Yt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2Ld
hFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRY
NyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch
1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZN
iHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1
E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi
3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2E
WDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3
IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHW
TYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2I
dRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUT
Yt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2Ld
hFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRY
NyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch
1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZN
iHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1
E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi
3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2E
WDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3
IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHW
TYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2I
dRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUT
Yt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2Ld
hFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRY
NyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch
1k2IdRNi3YRYNyHWTYh1E2LdhFg3IdZNiHUTYt2EWDch1k2I9RBiPYRYDyHWQ4j1EGI9hFgPIdZD
iPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1
EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBi
PYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2E
WA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgP
IdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHW
Q4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI
9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQ
Yj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9
hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRY
DyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h
1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZD
iPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1
EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj3fC7H+YeWt2O30
Ug+91EMv9dBLPfRSD73UQy/10Es99FIPvdRDL/XQSz30Ug+91EMv9dBLPfRSD73UQy/10Es99FIP
vdRDL/XQSz30Ug+91EMv9dBLPfRSD73UQy/10Es99FIPvdRDL/XQSz30Ug+91EMv9dBLPfRSD73U
Qy/10Es99FIPvdRDL/XQSz30Ug+91EMv9dBLPfRSD73UQy/10Es99FIPvdRDL/XQSz30Ug+91EMv
9dBLPfRSD73UQy/10Es99FIPvdRDL/XQSz30Ug+91EMv9dBLPfRSD73UQy/10Es99FI/V96K3U4v
9dBLPfRSD73UQy/10Es99FLPf3ipdT9+8fOPb7797lf/8vGr3/7rv/3m2+++/fUPv/7qBx/58c1P
//7Hf/Pxl//ws598VH787Tc/Ppk//Luf/eNPPz7//yg+n8gff/2Ln/zyn/75rz4z/rO4fvTxu89f
b7F+//VX/LT8IvBBQIj1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZD
iPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1
EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBi
PYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2E
WA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgP
IdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHW
Q4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI
9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQ
Yj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9
hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRY
DyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h
1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZD
iPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1
EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBi
PYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2E
WA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgP
IdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHW
Q4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI
9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQ
Yj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9
hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRY
DyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h
1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZD
iPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1
EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBi
PYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2E
WA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgP
IdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHW
Q4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI
9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQ
Yj2EWA8h1kOI9RBiPYRYDyHWQ4j1EGI9hFgPIdZDiPUQYj2EWC8h1kuI9RJivYRYLyHWS4j1EmK9
hFgvIdZLiPUSYr2EWC8h1kuI9RJivYRYLyHWS4j1EmK9hFgvIdZLiPUSYr2EWC8h1kuI9RJivYRY
LyHWS4j1EmK9hFgvIdZLiPUSYr2EWC8h1kuI9RJivYRYLyHWS4j1EmK9hFgvIdZLiPUSYr2EWC8h
1kuI9RJivYRYLyHWS4j1EmK9hFgvIdZLiPUSYr2EWC8h1kuI9RJivYRYLyHWS4j1EmK9hFgvIdZL
iPUSYr2EWC8h1kuI9RJivYRYLyHWS4j1EmK9hFgvIdZLiPUSYr2EWC8h1kuI9RJivYRYLyHWS4j1
EmK9hFgvIdZLiPUSYr2EWC8h1kuI9RJivYRYLyHWS4j1EmK9hFgvIdZLiPUSYr2EWC8h1kuI9RJi
vYRYLyHWS4j1EmK9hFgvIdZLiPUSYr2EWC8h1kuI9RJivYRYLyHWS4j1EmK9hFgvIdZLiPUSYr2E
WC8h1kuI9RJivYRYLyHWS4j1EmK9hFgvIdZLiPUSYr2EWC8h1kuI9RJivYRYLyHWS4j1EmK9hFgv
IdZLiPUSYr2EWC8h1kuI9RJivYRYLyHWS4j1EmK9hFgvIdZLiPUSYr2EWC8h1kuI9RJivYRYLyHW
S4j1EmK9hFgvIdZLiPUSYr2EWC8h1kuI9RJivYRYLyHWS4j1EmK9hFgvIdZLiPUSYr2EWC8h1kuI
9RJivYRYLyHWS4j1EmK9hFgvIdZLiPUSYr2EWC8h1kuI9RJivYRYLyHWS4j1EmK9hFgvIdZLiPUS
Yr2EWC8h1kuI9RJivYRYLyHWS4j1EmK9hFgvIdZLiPUSYr2EWC8h1kuI9RJivYRYLyHWS4j1EmK9
hFgvIdZLiPUSYr2EWC8h1kuI9RJivYRYLyHWS4j1EmK9hFgvIdZLiPUSYr2EWC8h1kuI9RJivYRY
LyHWS4j1EmK9hFgvIdZLiPUSYr2EWC8h1kuI9RJivYRYLyHWS4j1EmK9hFgvIdZLiPUSYr2EWC8h
1kuI9RJivYRYLyHWS4j1EmK9hFgvIdZLiPUSYr2EWC8h1kuI9RJivYRYLyHWS4j1EmK9hFgvIdZL
iPUSYr2EWC8h1kuI9RJivYRYLyHWS4j1EmK9hFgvIdZLiPUSYr2EWC8h1kuI9RJivYRYLyHWS4j1
EmK9hFgvIdZLiPUSYr2EWC8h1kuI9RJivYRYLyHWS4j1EmK9hFgvIdZLiPUSYr2EWC8h1kuI9RJi
vYRYLyHWS4j1EmK9hFgvIdZLiPUSYr2EWC8h1kuI9RJivYRYLyHWS4j1EmK9hFgvIdZLiPVz5a3Y
7YRYLyHWS4j1EmK9hFgvIdZb7HZ6qZde6qWXeumlXnqpl17qpZd66aVeeqmXXuqll3rppV56qZde
6qWXeumlXnqpl17qpZd66aVeeqmXXuqll3rppV56qZde6qWXeumlXnqpl17qpZd66aVeeqmXXuql
l3rppV56qZde6qWXeumlXnqpl17qpZd66aVeeqmXXuqll3rppV56qZde6qWXeumlXnqpl17qpZd6
6aVeeqmXXuqll3rppV56qZde6qWXeumlXnqpl17qpZd66aVeeqmXXuqll3rppV56qZde6qWXeuml
Xnqpl17qpZd66aVeeqmXXuqll3rppV56qZde6qWXeumlXnqpl17qpZd66aVeeqmXXuqll3rppV56
qZde6qWXeumlXnqpl17qpZd66aVeeqmXXuqll3rppV56qZde6qWXeumlXnqpl17qpZd66aVeeqmX
Xuqll3rppV56qZde6qWXeumlXnqpl17qpZd66aVeeqmXXuqll3rppV56qZde6qWXeumlXnqpl17q
pZd66aVeeqmXXuqll3rppV56qZde6qWXeumlXnqpl17qpZd66aVeeqmXXuqll3rppV56qZde6qWX
ev+El/r51/3l4xc///jm2+9+9S8fv/rtv/7bb7797ttf//Drr37wkR/f/PTvf/w3H3/5Dz/7yUfl
x99+8+OT+cO/+9k//vSjPp+8J+vjr3/xk1/+0z//VX2p+NI/+vhdrbP6919/9Uefll8EPggIsV5C
rJcQ6yXEegmxXkKslxDrJcR6CbFeQqyXEOslxHoJsV5CrJcQ6yXEegmxXkKslxDrJcR6CbFeQqyX
EOslxHoJsV5CrJcQ6yXEegmxXkKslxDrJcR6CbFeQqyXEOslxHoJsV5CrJcQ6yXEegmxXkKslxDr
JcR6CbFeQqyXEOslxHoJsV5CrJcQ6yXEegmxXkKslxDrJcR6CbFeQqyXEOslxHoJsV5CrJcQ6yXE
egmxXkKslxDrJcR6CbFeQqyXEOslxHoJsV5CrJcQ6yXEegmxXkKslxDrJcR6CbFeQqyXEOslxHoJ
sV5CrJcQ6yXEegmxXkKslxDrJcR6CbFeQqyXEOslxHoJsV5CrJcQ6yXEegmxXkKslxDrJcR6CbFe
QqyXEOslxHoJsV5CrJcQ6yXEegmxXkKslxDrJcR6CbFeQqyXEOslxHoJsV5CrJcQ6yXEegmxXkKs
lxDrJcR6CbFeQqyXEOslxHoJsV5CrJcQ6yXEegmxXkKslxDrJcR6CbFeQqyXEOslxHoJsV5CrJcQ
6yXEegmxXkKslxDrJcR6CbFeQqyXEOslxHoJsV5CrJcQ6yXEegmxXkKslxDrJcR6CbFeQqyXEOsl
xHoJsV5CrJcQ6yXEegmxXkKslxDrJcR6CbFeQqyXEOslxHoJsV5CrJcQ6yXEegmxXkKslxDrJcR6
CbFeQqyXEOslxHoJsV5CrJcQ6yXEegmxXkKslxDrJcR6CbFeQqyXEOslxHoJsV5CrJcQ6yXEegmx
XkKslxDrJcR6CbFeQqyXEOslxHoJsV5CrJcQ6yXEegmxXkKslxDrJcR6CbFeQqyXEOslxHoJsV5C
rJcQ6yXEegmxXkKslxDrJcR6CbFeQqyXEOslxHoJsV5CrJcQ6yXEegmxXkKslxDrJcR6CbFeQqyX
EOslxHoJsV5CrJcQ6yXEegmxXkKslxDrJcR6CbFeQqyXEOslxHoJsV5CrJcQ6yXEegmxXkKslxDr
JcR6CbFeQqyXEOslxHoJsV5CrJcQ6yXEegmxXkKslxDrJcR6CbFeQqyXEOslxHoJsV5CrJcQ6yXE
egmxXkKslxDrJcR6CbFeQqyXEOslxHoJsV5CrJcQ6yXEegmxXkKslxDrJcR6CbFeQqyXEOslxHoJ
sV5CrJcQ6yXEegmxXkKslxDrJcR6CbFeQqyXEOslxHoJsV5CrJcQ6yXEegmxXkKslxDrJcR6CbFe
QqyXEOslxHoJsV5CrJcQ6yXEegmxXkKslxDrJcR6CbFeQqyXEOslxHoJsV5CrJcQ6yXEegmxXkKs
lxDrJcR6CbFeQqyXEOslxHoJsV5CrJcQ6yXEegmxXkKslxDrJcR6CbFeQqyXEOslxHoJsV5CrJcQ
6yXEegmxXkKslxDrJcR6CbFeQqyXEOslxHoJsV5CrJcQ6yXEegmxXkKslxDrJcR6CbFeQqyXEOsl
xHoJsV5CrJcQ6yXEegmxXkKslxDrJcR6CbFeQqyXEOslxHoJsV5CrJcQ6yXEegmxXkKslxDrJcR6
CbFeQqyXEOslxHoJsV5CrJcQ6yXEegmxXkKslxDrJcR6CbFeQqyXEOslxHoJsV5CrJcQ6yXEegmx
XkKslxDrJcR6CbFeQqyXEOslxHoJsV5CrJcQ6yXEegmxXkKslxDrJcR6CbFeQqyXEOslxHoJsV5C
rJcQ6yXEegmxXkKslxDrJcR6CbFeQqyXEOslxHoJsV5CrFcQ6/oiiPWt33+rt37/rd76/bd66/ff
6q3ff6u3fv+t3vr9t3rr99/qrbwVuv2tvBW6/a28Fbr9rbwVuv2tvBW6/a28Fbr9rbwVuv2tvBW6
/a28Fbr9rbwVuv2tvBW6/a28Fbr9rbwVuv2tvBW6/a28Fbr9rbwVuv2tvBW6/a28Fbr9rbwVuv2t
vBW6/a28Fbr9rbwVuv2tvBW6/a28Fbr9rbwVuv2tvBW6/a28Fbr9rbwVuv2tvBW6/a28Fbr9rbwV
uv2tvBW6/a28Fbr9rbwVuv2tvBW6/a28Fbr9rbwVuv2tvBW6/a28Fbr9rbwVuv2tvBW6/a28Fbr9
rbwVuv2tvBW6/a28Fbr9rbqVINa36laCWN+qWwlifatuJYj1rbqVINa38lbsdkGsb+Wt2O2CWN/K
W7HbBbG+lbditwtifStvxW4XxPpW3ordLoj1rbwVu10Q6+fKbhfE+lbeit0uiPWtvBW7XRDrW3kr
drsg1rfyVux2Qaxv5a3Y7YJY38pbsdsFsX6u7HZBrG/lrdjtgljfylux2wWxvpW3YrcLYn0rb8Vu
F8T6Vt6K3S6I9a28FbtdEOvnym4XxPpW3ordLoj1rbwVu10Q61t5K3a7INa38lbsdkGsb+Wt2O2C
WN/KW7HbBbF+rux2Qaxv5a3Y7YJY38pbsdsFsb6Vt2K3C2J9q24liPWtupUg1rfqVoJY36pbCWJ9
K2/FbhfE+lbeit0uiPWtvBW7XRDrW3krdrsg1rfyVux2Qaxv5a3Y7YJY38pbsdsFsX6u7HZBrG/l
rdjtgljfylux2wWxvpW3YrcLYn0rb8VuF8T6Vt6K3S6I9a28FbtdEOvnym4XxPpW3ordLoj1rbwV
u10Q61t5K3a7INa38lbsdkGsb+Wt2O2CWN/KW7HbBbF+rux2Qaxv5a3Y7YJY38pbsdsFsb6Vt2K3
C2J9K2/FbhfE+lbeit0uiPWtvBW7XRDr58puF8T6Vt6K3S6I9a28FbtdEOtbeSt2uyDWt+pWgljf
qlsJYn2rbiWI9a26lSDWt/JW7HZBrG/lrdjtgljfylux2wWxvpW3YrcLYn0rb8VuF8T6Vt6K3S6I
9a28FbtdEOvnym4XxPpW3ordLoj1rbwVu10Q61t5K3a7INa38lbsdkGsb+Wt2O2CWN/KW7HbBbF+
rux2Qaxv5a3Y7YJY38pbsdsFsb6Vt2K3F7tdEOtbeSt2uyDWt/JW7HZBrG/lrdjtgljfylux2wWx
vpW3YrcLYn0rb8VuF8T6ubLbBbG+lbditwtifStvxW4XxPpW3ordLoj1rbwVu10Q61t5K3a7INa3
8lbsdkGs64sg1rfqVoJY36pbCWJ9q24liPWtupUg1rfyVux2Qaxv5a3Y7YJY38pbsdsFsb6Vt2K3
C2J9K2/FbhfE+lbeit0uiPWtvBW7XRDr58puF8T6Vt6K3S6I9a28FbtdEOtbeSt2uyDWt/JW7HZB
rG/lrdjtgljfylux2wWxfq7sdkGsb+Wt2O2CWN/KW7HbBbG+lbditwtifStvxW4XxPpW3ordLoj1
rbwVu10Q6+fKbhfE+lbeit0uiPWtvBW7XRDrW3krdrsg1rfyVux2Qaxv5a3Y7YJY38pbsdsFsX6u
7HZBrG/lrdjtgljfylux2wWxvpW3YrcLYn2rbiWI9a26lSDWt+pWgljfqlsJYn0rb8VuF8T6Vt6K
3S6I9a28FbtdEOtbeSt2uyDWt/JW7HZBrG/lrdjtfwJi/aOVt2K3y0v9XNnt8lLfylux2+WlvpW3
YrfLS30rb8Vul5f6Vt6K3S4v9a28FbtdXupbeSt2u7zUz5XdLi/1rbwVu11e6lt5K3a7vNS38lbs
dnmpb+Wt2O3yUt/KW7Hb5aW+lbdit8tL/VzZ7fJS38pbsdvlpb6Vt2K3y0t9K2/FbpeX+lbeit0u
L/WtvBW7XV7qW3krdru81M+V3S4v9a28FbtdXupbeSt2u7zUt/JW7HZ5qW/VreSlvlW3kpf6Vt1K
XupbdSt5qW/lrdjt8lLfylux2+WlvpW3YrfLS30rb8Vul5f6Vt6K3S4v9a28FbtdXupbeSt2u7zU
z5XdLi/1rbwVu11e6lt5K3a7vNS38lbsdnmpb+Wt2O3yUt/KW7Hb5aW+lbdit8tL/VzZ7fJS38pb
sdvlpb6Vt2K3y0t9K2/FbpeX+lbeit0uL/WtvBW7XV7qW3krdru81M+V3S4v9a28FbtdXupbeSt2
u7zUt/JW7HZ5qW/lrdjt8lLfylux2+WlvpW3YrfLS/1c2e3yUt/KW7Hb5aW+lbdit8tLfStvxW6X
l/pW3Upe6lt1K3mpb9Wt5KW+VbeSl/pW3ordLi/1rbwVu11e6lt5K3a7vNS38lbsdnmpb+Wt2O3y
Ut/KW7Hb5aW+lbdit8tL/VzZ7fJS38pbsdvlpb6Vt2K3y0t9K2/FbpeX+lbeit0uL/WtvBW7XV7q
W3krdru81M+V3S4v9a28FbtdXupb/9OtPn/W8fGLn3988+13v/qXj1/99l//7Tfffvftr3/49Vc/
+MiPb3769z/+m4+//Ief/eSj8uNvv/nxyfzh3/3sH3/6Uf2+3UZ9/PUvfvLLf/rnv6p635H8Rx+/
q3Mjf//1V3/i0/KLwAeBINa38ovAB4Eg1rfyi8AHgSDWt/IXLB8EgljfylvxQSCI9a28FR8Egljf
ylvxQSCI9a28FR8Eglg/Vz4IBLG+lbfig0AQ61t5Kz4IBLG+lbfig0AQ61t5Kz4IBLG+lbfig0AQ
61t5Kz4IBLGuL4JY36pbCWJ9q24liPWtupUg1rfqVoJY38pb8UEgiPWtvBUfBIJY38pb8UEgiPWt
vBUfBIJY38pb8UEgiPWtvBUfBIJY38pb8UEgiPVz5YNAEOtbeSs+CASxvpW34oNAEOtbeSs+CASx
vpW34oNAEOtbeSs+CASxvpW34oNAEOvnygeBINa38lZ8EAhifStvxW4XxPpW3ordLoj1rbwVu10Q
61t5K3a7INa38lbsdkGsnyu7XRDrW3krdrsg1rfyVux2Qaxv5a3Y7YJY38pbsdsFsb6Vt2K3C2J9
K2/FbhfE+rmy2wWxvpW3YrcLYn0rb8VuF8T6Vt6K3S6I9a26lSDWt+pWgljfqlsJYn2rbiWI9a28
FbtdEOtbeSt2uyDWt/JW7HZBrG/lrdjtgljfylux2wWxvpW3YrcLYn0rb8VuF8T6ubLbBbG+lbdi
twtifStvxW4XxPpW3ordLoj1rbwVu10Q61t5K3a7INa38lbsdkGsnyu7XRDrW3krdrsg1rfyVux2
Qaxv5a3Y7YJY38pbsdsFsb6Vt2K3C2J9K2/FbhfE+rmy2wWxvpW3YrcLYn0rb8VuF8T6Vt6K3S6I
9a28FbtdEOtbeSt2uyDWt/JW7HZBrJ8ru10Q61t5K3a7INa38lbsdkGsb+Wt1O1BiDUIsQYh1iDE
GoRYgxBrEGINQqxBiDUIsQYh1iDEGoRYgxBrEGINQqxBiDUIsQYh1iDEGoRYgxBrEGINQqxBiDUI
sQYh1iDEGoRYgxBrEGINQqxBiDUIsQYh1iDEGoRYgxBrEGINQqxBiDUIsQYh1iDEGoRYgxBrEGIN
QqxBiDUIsQYh1iDEGoRYgxBrEGINQqxBiDUIsQYh1iDEGoRYgxBrEGINQqxBiDUIsQYh1iDEGoRY
gxBrEGINQqxBiDUIsQYh1iDEGoRYgxBrEGINQqxBiDUIsQYh1iDEGoRYgxBrEGINQqxBiDUIsQYh
1iDEGoRYgxBrEGINQqxBiDUIsQYh1iDEGoRYgxBrEGINQqxBiDUIsQYh1iDEGoRYgxBrEGINQqxB
iDUIsQYh1iDEGoRYgxBrEGINQqxBiDUIsQYh1iDEGoRYgxBrEGINQqxBiDUIsQYh1iDEGoRYgxBr
EGINQqxBiDUIsQYh1iDEGoRYgxBrEGINQqxBiDUIsQYh1iDEGoRYgxBrEGINQqxBiDUIsQYh1iDE
GoRYgxBrEGINQqxBiDUIsQYh1iDEGoRYgxBrEGINQqxBiDUIsQYh1iDEGoRYgxBrEGINQqxBiDUI
sQYh1iDEGoRYgxBrEGINQqxBiDUIsQYh1iDEGoRYgxBrEGINQqxBiDUIsQYh1iDEGoRYgxBrEGIN
QqxBiDUIsQYh1iDEGoRYgxBrEGINQqxBiDUIsQYh1iDEGoRYgxBrEGINQqxBiDUIsQYh1iDEGoRY
gxBrEGINQqxBiDUIsQYh1iDEGoRYgxBrEGINQqxBiDUIsQYh1iDEGoRYgxBrEGINQqxBiDUIsQYh
1iDEGoRYgxBrEGINQqxBiDUIsQYh1iDEGoRYgxBrEGINQqxBiDUIsQYh1iDEGoRYgxBrEGINQqxB
iDUIsQYh1iDEGoRYgxBrEGINQqxBiDUIsQYh1iDEGoRYgxBrEGINQqxBiDUIsQYh1iDEGoRYgxBr
EGINQqxBiDUIsQYh1iDEGoRYgxBrEGINQqxBiDUIsQYh1iDEGoRYgxBrEGINQqxBiDUIsQYh1iDE
GoRYgxBrEGINQqxBiDUIsQYh1iDEGoRYgxBrEGINQqxBiDUIsQYh1iDEGoRYgxBrEGINQqxBiDUI
sQYh1iDEGoRYgxBrEGINQqxBiDUIsQYh1iDEGoRYgxBrEGINQqxBiDUIsQYh1iDEGoRYgxBrEGIN
QqxBiDUIsQYh1iDEGoRYgxBrEGINQqxR7PZitxNiDUKsQYg1CLEGIdYgxBqEWIMQaxBiDUKsQYg1
CLEGIdYgxBqEWIMQaxBiDUKsQYg1CLEGIdYgxBqEWIMQaxBiDUKsQYg1CLEGIdYgxBqEWIMQaxBi
DUKsQYg1CLEGIdYgxBqEWIMQaxBiDUKsQYg1CLEGIdYgxBqEWIMQaxBiDUKsQYg1CLEGIdYgxBqE
WIMQaxBiDUKsQYg1CLEGIdYgxBqEWIMQaxBiDUKsQYg1CLEGIdYgxBqEWIMQaxBiDUKsQYg1CLEG
IdYgxBqEWIMQaxBiDUKsQYg1CLEGIdYgxBqEWIMQaxBiDUKsQYg1CLEGIdYgxBqEWIMQaxBiDUKs
QYg1CLEGIdYgxBqEWIMQaxBiDUKsQYg1CLEGIdYgxBqEWIMQaxBiDUKsQYg1CLEGIdYgxBqEWIMQ
axBiDUKsQYg1CLEGIdYgxBqEWIMQaxBiDUKsQYg1CLEGIdYgxBqEWIMQaxBiDUKsQYg1CLEGIdYg
xBqEWIMQaxBiDUKsQYg1CLEGIdYgxBqEWIMQaxBiDUKsQYg1CLEGIdYgxBqEWIMQaxBiDUKsQYg1
CLEGIdYgxBqEWIMQaxBiDUKsQYg1CLEGIdYgxBqEWIMQaxBiDUKsQYg1CLEGIdYgxBqEWIMQaxBi
DUKsQYg1CLEGIdYgxBqEWIMQaxBiDUKsQYg1CLEGIdYgxBqEWIMQaxBiDUKsQYg1CLEGIdYgxBqE
WIMQaxBiDUKsQYg1CLEGIdYgxBqEWIMQaxBiDUKsQYg1CLEGIdYgxBqEWIMQaxBiDUKsQYg1CLEG
IdYgxBqEWIMQaxBiDUKsQYg1CLEGIdYgxBqEWIMQaxBiDUKsQYg1CLEGIdYgxBqEWIMQaxBiDUKs
QYg1CLEGIdYgxBqEWIMQaxBiDUKsQYg1CLEGIdYgxBqEWIMQaxBiDUKsQYg1CLEGIdYgxBqEWIMQ
axBiDUKsQYg1CLEGIdYgxBqEWIMQaxBiDUKsQYg1CLEGIdYgxBqEWIMQaxBiDUKsQYg1CLEGIdYg
xBqEWIMQaxBiDUKsQYg1CLEGIdYgxBqEWIMQaxBiDUKsQYg1CLEGIdYgxBqEWIMQaxBiDUKsQYg1
CLEGIdYgxBqEWIMQaxBiDUKsQYg1CLEGIdYgxBqEWIMQaxBiDUKsQYg1CLEGIdYgxBqEWIMQaxBi
DUKsQYg1CLEGIdYgxBqEWIMQaxBiDUKsQYg1CLEGIdYgxBqEWIMQaxBiDUKsQYg1CLEGIdYgxBqE
WIMQaxBiDUKsQYg1CLEGIdYgxBqEWIMQaxBiDUKsQYg1CLEGIdYgxBqEWIMQaxBiDUKsQYg1CLEG
IdYgxBqEWIMQaxBiDUKsQYg1CLEGIdYgxBqEWIMQaxBijc1up5ca9FKDXmrQSw16qUEvNeilBr3U
oJca9FKDXmrQSw16qUEvNeilBr3UoJca9FKDXmrQSw16qUEvNeilBr3UoJca9FKDXmrQSw16qUEv
NeilBr3UoJca9FKDXmrQSw16qUEvNeilBr3UoJca9FKDXmrQSw16qUEvNeilBr3UoJca9FKDXmrQ
Sw16qUEvNeilBr3UoJca9FKDXmrQSw16qUEvNeilBr3UoJca9FKDXmrQSw16qUEvNeilBr3UoJca
9FKDXmrQSw16qUEvNeilBr3UoJca9FKDXmrQSw16qUEvNeilBr3UoJca9FKDXmrQSw16qUEvNeil
Br3UoJca9FKDXmrQSw16qUEvNeilBr3UoJca9FKDXmrQSw16qUEvNeilBr3UoJca9FKDXmrQSw16
qUEvNeilBr3UoJca9FKDXmrQSw16qUEvNeilBr3UoJca9FKDXmrQSw16qUEvNeilBr3UoJca9FKD
XmrQSw16qUEvNeilBr3UoJca9FKDXmrQSw16qUEvNeilBr3UoJca9FKDXmrQSw16qUEvNeilBr3U
oJca9FKDXmrQSw16qUEvNeilBr3UoJca9FKDXmrQSw16qUEvNeilBr3UoJca9FKDXmrQSw16qUEv
NeilBr3UoJca9FKDXmrQSw16qUEvNeilBr3UoJca9FKDXmrQSw16qUEvNeilBr3UoJca9FKDXmrQ
Sw16qUEvNeilBr3UoJca9FKDXmrQSw16qUEvNeilBr3UoJca9FKDXmrQSw16qUEvNeilBr3UoJca
9FKDXmrQSw16qUEvNeilBr3UoJca9FKDXmrQSw16qUEvNeilBr3UoJca9FKDXmrQS016qUkvNeml
Jr3UpJea9FKTXmrSS016qUkvNemlJr3UpJea9FKTXmrSS016qUkvNemlJr3UpJea9FKTXmrSS016
qUkvNemlJr3UpJea9FKTXmrSS016qUkvNemlJr3UpJea9FKTXmrSS016qUkvNemlJr3UpJea9FKT
XmrSS016qUkvNemlJr3U/B+81M+fd3784ucf33z73a/+5eNXv/3Xf/vNt999++sffv3VDz7y45uf
/v2P/+bjL//hZz/5qPz4229+fDJ/+Hc/+8efflR/ef8N2cdf/+Inv/ynf/6r2uecLz/6+F1/+Szl
33/91f/0aflF0IMgCbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEm
IdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKs
SYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQ
axJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYk
xJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1
CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJi
TUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqE
WJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEm
IdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKs
SYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQ
axJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYk
xJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1
CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJi
TUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqE
WJMQaxJiTUKsSYg1CbEmIdbPlbditxNiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYk
xJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1
CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJi
TUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqE
WJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEm
IdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKs
SYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQ
axJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYk
xJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1
CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJi
TUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqE
WJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEm
IdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKs
SYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQ
axJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYk
xJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1
CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJi
TUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqE
WJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEm
IdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKs
SYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQ
axJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYk
xJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1
CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJi
TUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqE
WJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEm
IdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKs
SYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQ
axJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYk
xJqEWJMQaxJiTUKsSYg1CbEmIdYkxJqEWJMQaxJiTUKsSYg1CbEmIdYixFqEWIsQaxFiLUKsRYi1
CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFi
LUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqE
WIsQaxFirS/q9qKXWvRSi15q0UsteqlFL7XopRa91KKXWvRSi15q0UsteqlFL7XopRa91KKXWvRS
i15q0UsteqlFL7XopRa91KKXWvRSi15q0UsteqlFL7XopRa91KKXWvRSi15q0UsteqlFL7XopRa9
1KKXWvRSi15q0UsteqlFL7XopRa91KKXWvRSi15q0UsteqlFL7XopRa91KKXWvRSi15q0UsteqlF
L7XopRa91KKXWvRSi15q0UsteqlFL7XopRa91KKXWvRSi15q0UsteqlFL7XopRa91KKXWvRSi15q
0UsteqlFL7XopRa91KKXWvRSi15q0UsteqlFL7XopRa91KKXWvRSi15q0UsteqlFL7XopRa91KKX
WvRSi15q0UsteqlFL7XopRa91KKXWvRSi15q0UsteqlFL7XopRa91KKXWvRSi15q0UsteqlFL7Xo
pRa91KKXWvRSi15q0UsteqlFL7XopRa91KKXWvRSi15q0UsteqlFL7XopRa91KKXWvRSi15q0Ust
eqlFL7XopRa91KKXWvRSi15q0UsteqlFL7XopRa91KKXWvRSi15q0UsteqlFL7XopRa91KKXWvRS
i15q0UsteqlFL7XopRa91KKXWvRSi15q0UsteqlFL7XopRa91KKXWvRSi15q0UsteqlFL7XopRa9
1KKXWvRSi15q0UsteqlFL7XopRa91KKXWvRSi15q0UsteqlFL7XopRa91KKXWvRSi15q0UsteqlF
L7XopRa91KKXWvRSi15q0UsteqlFL7XopRa91KKXWvRSi15q0UsteqlFL7XopRa91KKXWvRSi15q
0UsteqlFL7XopRa91KKXWvRSi15q0UsteqlFL7XopRa91KKXWvRSi15q0UsteqlFL7XopRa91KKX
WvRSi15q0UsteqlFL7XopRa91KKXWvRSi15q0UsteqlFL7XopRa91KKXWvRSi15q0UsteqlFL7Xo
pRa91KKXWvRSi15q0UsteqlFL7XopRa91KKXWvRSi15q0UsteqlFL7XopRa91KKXWvRSi15q0Ust
eqlFL7XopRa91KKXWvRSi15q0UsteqmfK2/FbqeXWvRSi15q0UsteqlFL7XopRa91KKXWvRSi15q
0UsteqlFL7XopRa91KKXWvRSi15q0UsteqlFL7XopRa91KKXWvRSi15q0UsteqlFL7XopRa91KKX
WvRSi15q0UsteqlFL7XopRa91KKXWvRSi15q0UsteqlFL7XopRa91KKXWvRSi15q0Usteqn1vV7q
50e7Pn7x849vvv3uV//y8avf/uu//ebb77799Q+//uoHH/nxzU///sd/8/GX//Czn3xUfvztNz8+
mT/8u5/9408/3i+Zk/Xx17/4yS//6Z//quOe/vKjj999XnZ9+f3XX/3h0/KLwAcBIdYixFqEWIsQ
axFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYi
xFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1
CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFi
LUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqE
WIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEW
IdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKs
RYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQ
axFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYi
xFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1
CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFi
LUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqE
WIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEW
IdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKs
RYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQ
axFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYi
xFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1
CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFi
LUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqE
WIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEW
IdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKs
RYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQ
axFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYi
xFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1
CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFi
LUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqE
WIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxFiLUKsRYi1CLEW
IdYixFqEWIsQaxFiLUKsRYi1CLEWIdYixFqEWIsQaxNibUKsTYi1CbE2IdYmxNqEWJsQaxNibUKs
TYi1CbE2IdYmxNqEWJsQaxNibUKsTYi1CbE2IdYmxNqEWJsQaxNibUKsTYi1CbE2IdYmxNqEWJsQ
axNibUKsTYi1CbE2IdYmxNqEWJsQaxNibUKsTYi1CbE2IdYmxNqEWJsQaxNibUKsTYi1CbE2IdYm
xNqEWJsQaxNibUKsTYi1CbE2IdYmxNqEWJsQaxNibUKsTYi1CbE2IdYmxNqEWJsQaxNibUKsTYi1
CbE2IdYmxNqEWJsQaxNibUKsTYi1CbE2IdYmxNqEWJsQaxNibUKsTYi1CbE2IdYmxNqEWJsQaxNi
bUKsTYi1CbE2IdYmxNqEWJsQaxNibUKsTYi1CbE2IdYmxNqEWJsQaxNibUKsTYi1CbE2IdYmxNqE
WJsQaxNibUKsTYi1CbE2IdYmxNqEWJsQaxNibUKsTYi1CbE2IdYmxNqEWJsQaxNibUKsTYi1CbE2
IdYmxNqEWJsQaxNibUKsTYi1CbE2IdYmxNqEWJsQaxNibUKsTYi1CbE2IdYmxNqEWJsQaxNibUKs
TYi1CbE2IdYmxNqEWJsQaxNibUKsTYi1CbE2IdYmxNqEWJsQaxNibUKsTYi1CbE2IdYmxNqEWJsQ
axNibUKsTYi1CbE2IdYmxNqEWJsQaxNibUKsTYi1CbE2IdYmxNqEWJsQaxNibUKsTYi1CbE2IdYm
xNqEWJsQaxNibUKsTYi1CbE2IdYmxNqEWJsQaxNibUKsTYi1CbE2IdYmxNqEWJsQaxNibUKsTYi1
CbE2IdYmxNqEWJsQaxNibUKsTYi1CbE2IdYmxNqEWJsQaxNibUKsTYi1CbE2IdYmxNqEWJsQaxNi
bUKsTYi1CbE2IdYmxNqEWJsQaxNibUKsTYi1CbE2IdYmxNqEWJsQaxNibUKsTYi1CbE2IdYmxNqE
WJsQaxNibUKsTYi1CbE2IdYmxNqEWJsQaxNibUKsTYi1CbE2IdYmxNqEWJsQaxNibUKsTYi1CbE2
IdYmxNqEWJsQaxNibUKsTYi1CbE2IdYmxNqEWJsQaxNibUKsTYi1CbE2IdYmxNqEWJsQaxNibUKs
TYi1CbE2IdYmxNqEWJsQaxNibUKsTYi1CbE2IdYmxNqEWJsQaxNibUKsTYi1CbE2IdYmxNqEWJsQ
axNibUKsTYi1CbE2IdYmxNqEWJsQaxNibUKsTYi1CbE2IdYmxNqEWJsQaxNibUKsTYi1CbE2IdYm
xNqEWJsQaxNibUKsTYj1c+Wt2O2EWJsQaxNibUKsTYi1CbE2IdYmxNqEWJsQaxNibUKsTYi1CbE2
IdYmxNqEWJsQaxNibUKsTYi1CbE2IdYmxNqEWJsQaxNibUKsTYi1CbE2IdYmxNqEWJsQaxNibUKs
TYi1CbE2IdYmxNqEWJsQaxNibUKsTYi1CbE2IdYmxNqEWJsQaxNibUKs/b0Q6x9W3ordTi+16aU2
vdSml9r0UpteatNLbXqpTS+16aU2vdSml9r0UpteatNLbXqpTS+16aU2vdSml9r0UpteatNLbXqp
TS+16aU2vdSml9r0UpteatNLbXqpTS+16aU2vdSml9r0UpteatNLbXqpTS+16aU2vdSml9r0Upte
atNLbXqpTS+16aU2vdSml9r0UpteatNLbXqpTS+16aU2vdSml9r0UpteatNLbXqpTS+16aU2vdSm
l9r0UpteatNLbXqpTS+16aU2vdSml9r0UpteatNLbXqpTS+16aU2vdSml9r0UpteatNLbXqpTS+1
6aU2vdSml9r0UpteatNLbXqpTS+16aU2vdSml9r0UpteatNLbXqpTS+16aU2vdSml9r0UpteatNL
bXqpTS+16aU2vdSml9r0UpteatNLbXqpTS+16aU2vdSml9r0UpteatNLbXqpTS+16aU2vdSml9r0
UpteatNLbXqpTS+16aU2vdSml9r0UpteatNLbXqpTS+16aU2vdSml9r0UpteatNLbXqpTS+16aU2
vdSml9r0UpteatNLbXqpTS+16aU2vdSml9r0UpteatNLbXqpTS+16aU2vdSml9r0UpteatNLbXqp
TS+16aU2vdSml9r0UpteatNLbXqpTS+16aU2vdSml9r0UpteatNLbXqpTS+16aU2vdSml9r0Upte
atNLbXqpTS+16aU2vdSml9r0UpteatNLbXqpTS+16aU2vdSml9r0UpteatNLbXqpTS+16aU2vdSm
l9r0UpteatNLbXqpTS+16aU2vdSml9r0UpteatNLbXqpTS+16aU2vdSml9r0UpteatNLbXqpTS+1
6aU2vdSml9r0UpteatNLbXqpTS+16aU2vdSml9r0UpteatNLbXqpTS+16aU2vdSml9r0UpteatNL
bXqpTS+16aU2vdSml9r0UpteatNLbXqpTS+16aU2vdSml9r0UpteatNLbXqpTS+16aU2vdSml9r0
UpteatNLbXqpTS+16aU2vdSml9r0UpteatNLbXqpTS+16aU2vdSml9r0UpteatNLbXqpTS+16aU2
vdSml9r0UpteatNLbXqpTS+16aU2vdSml9r0UpteatNLbXqpTS+16aU2vdSml9r0UpteatNLbXqp
TS+16aU2vdSml9r0UpteatNLbXqpTS+16aU2vdSml9r0UpteatNLbXqpTS+16aU2vdSml9r0Upte
atNLbXqpTS+16aU2vdSml9r0UpteatNLbXqpTS+16aU2vdT+dy/1c+/++MXPP7759rtf/cvHr377
r//2m2+/+/bXP/z6qx985Mc3P/37H//Nx1/+w89+8lH58bff/Phk/vDvfvaPP/2o912esz7++hc/
+eU//fNfvX+f+eXLjz5+976x4Zfff/2VPi+/CnwRUGJtSqxNibUpsTYl1qbE2pRYmxJrU2JtSqxN
ibUpsTYl1qbE2pRYmxJrU2JtSqxNibUpsTYl1qbE2pRYmxJrU2JtSqxNibUpsTYl1qbE2pRYmxJr
U2JtSqxNibUpsTYl1qbE2pRYmxJrU2JtSqxNibUpsTYl1qbE2pRYmxJrU2JtSqxNibUpsTYl1qbE
2pRYmxJrU2JtSqxNibUpsTYl1qbE2pRYmxJrU2JtSqxNibUpsTYl1qbE2pRYmxJrU2JtSqxNibUp
sTYl1qbE2pRYmxJrU2JtSqxNibUpsTYl1qbE2pRYmxJrU2JtSqxNibUpsTYl1qbE2pRYmxJrU2Jt
SqxNibUpsTYl1qbE2pRYmxJrU2JtSqxNibUpsTYl1qbE2pRYmxJrU2JtSqxNibUpsTYl1qbE2pRY
mxJrU2JtSqxNibUpsTYl1qbE2pRYmxJrU2JtSqxNibUpsTYl1qbE2pRYmxJrU2JtSqxNibUpsTYl
1qbE2pRYmxJrU2JtSqxNibUpsTYl1qbE2pRYmxJrU2JtSqxNibUpsTYl1qbE2pRYmxJrU2JtSqxN
ibUpsTYl1qbE2pRYmxJrU2JtSqxNibUpsTYl1qbE2pRYmxJrU2JtSqxNibUpsTYl1qbE2pRYmxJr
U2JtSqxNibUpsTYl1qbE2pRYmxJrU2JtSqxNibUpsTYl1qbE2pRYmxJrU2JtSqxNibUpsTYl1qbE
2pRYmxJrU2JtSqxNibUpsTYl1qbEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUo
sQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGId
SqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRY
hxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l
1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxD
iXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLr
UGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHE
OpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUo
sQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGId
SqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRY
hxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l
1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxD
iXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLr
UGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHE
OpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUo
sQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGId
SqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRY
hxLrUGIdSqyfK2/FbqfEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHE
OpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUo
sQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGId
SqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRY
hxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l
1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxD
iXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLr
UGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHE
OpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUo
sQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGId
SqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRY
hxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l
1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxD
iXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLr
UGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHE
OpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUo
sQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGId
SqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRY
hxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpRYhxLrUGIdSqxDiXUosQ4l
1qHEOpRYhxLrUGIdSqxDiXUosQ4l1qHEOpvdTi916KUOvdShlzr0Uode6tBLHXqpQy916KUOvdSh
lzr0Uode6tBLHXqpQy916KUOvdShlzr0Uode6tBLHXqpQy916KUOvdShlzr0Uode6tBLHXqpQy91
6KUOvdShlzr0Uode6tBLHXqpQy916KUOvdShlzr0Uode6tBLHXqpQy916KUOvdShlzr0Uode6tBL
HXqpQy916KUOvdShlzr0Uode6tBLHXqpQy916KUOvdShlzr0Uode6tBLHXqpQy916KUOvdShlzr0
Uode6tBLHXqpQy916KUOvdShlzr0Uode6tBLHXqpQy916KUOvdShlzr0Uode6tBLHXqpQy916KUO
vdShlzr0Uode6tBLHXqpQy916KUOvdShlzr0Uode6tBLHXqpQy916KUOvdShlzr0Uode6tBLHXqp
Qy916KUOvdShlzr0Uode6tBLHXqpQy916KUOvdShlzr0Uode6tBLHXqpQy916KUOvdShlzr0Uode
6tBLHXqpQy916KUOvdShlzr0Uode6tBLHXqpQy916KUOvdShlzr0Uode6tBLHXqpQy916KUOvdSh
lzr0Uode6tBLHXqpQy916KUOvdShlzr0Uode6tBLHXqpQy916KUOvdShlzr0Uode6tBLHXqpQy91
6KUOvdShlzr0Uode6tBLHXqpQy916KUOvdShlzr0Uode6tBLHXqpQy916KUOvdShlzr0Uode6tBL
HXqpQy916KUOvdShlzr0Uode6tBLHXqpi17qope66KUueqmLXuqil7ropS56qYte6qKXuuilLnqp
i17qope66KUueqmLXuqil7ropS56qYte6qKXuuilLnqpi17qope66KUueqmLXuqil7ropS56qYte
6qKXuuilLnqpi17qope66KUueqmLXuqil7ropS56qYte6qKXuuilLnqpi17qope66KUueqmLXuqi
l7ropS56qYte6qKXuuilLnqpi17qope66KUueqmLXuqil7ropS56qYte6qKXuuilLnqpi17qope6
6KUueqmLXuqil7ropS56qYte6qKXuuilLnqpi17qope66KUueqmLXuqil7ropS56qYte6qKXuuil
Lnqpi17qope66KUueqmLXuqil7ropS56qYte6qKXuuilLnqpi17qope66KUueqmLXuqil7ropS56
qYte6qKXuuilLnqpi17qope66KUueqmLXuqil7ropS56qYte6qKXuuilLnqpi17qope66KUueqmL
Xuqil7ropS56qYte6qKXuuilLnqpi17qope66KUueqnrj73Uz5/2fPzi5x/ffPvdr/7l41e//dd/
+82333376x9+fny9j//4N7/9b9/+0cd/8PHXv/zpx//62//6X9//9d/+9+8+/9b9/tbPD33+1R/9
vX/x///4//iP//N/+79+89v/+r/kly/1+cY9/+XzH2kz/V/u5y/vH/7v/8ef53N8+WyK9eXLX3z5
/LHX/NH//vyRn//B8hefH+i9+y2ff39/Pqr+4uPLn+fT+8d//2//N3tX39y2zeTv32Qm3wHjyc0k
PZuHVxLU2Y1liUrd2o5ruUmaNpOhJVpmJJE+knJq3zzf/QC9WaBAiEpsyZ7HaadRxSVE7v72BYvF
IvMTAP6jd+4nXT8tpFt0/ZH++Ulq/l8n1Q8H796C0/1Dr3laPTz+DCQgtiDdQhwgVIGswuhzAnph
moGNDbDxnxvCasz8ryW/YLdf7B/tvfsovrJBGvSClvjyNPHTC/GNM/1m/8hq+0E/jsS3fPbb60Ff
fOWCP/br4Hxo11DlJ/CqcVB92xQGD0HlCoabmFQw3ySkQtgmcTaJW2EEvJJEJ40ax9hq7n/ywPB+
sPeu/qd17Hm//fWLV617J1Zj3zuoN8XwSdwHpzGotUBzcPZVPkzdzwJwGKSp3wm2xGjHSRgnYXYN
Pm5NP54E50ESRK0gBUfBt7STxIPLFOxHWyfBZe966zR+/Vk+M5p9wbNBJ0v8/xUvifD0++PQb1l7
x8f71Zq8QApfnypX3Af2okx9offHR/Jt7MK3cZQrnD2w17kFZjOIMvkqhbjEcEp7EEaDf6x2kHaz
+FLchFHhTXj2ysN6+ZK2wa4g9hwT0JKhhngjYReGkcRT+PAI/pj8v5DhnfyG0f9jShyH5Pw/g/jJ
/6/kz0/gYL95Cl79/Ud0KF4waL8GG9bGrbueXq9dhL22sBkgT7l/VIpMeoNZwtzleuKfZ+ksgXJ5
bHwX/8zQ8hYOc+a3uoPLwsvCPl4J62l4zNNATI4EiflJwX4W9FPDMJPwiAznXTJoUmdoRXdZiR+2
C396GjoVXk4v/b7xsaz0OvXbC2j6ftgLEjPNNLIrfha/f+abB0kutvwoigfCUS34tfhKzJAzM9FX
/8rf6uXxMU93FSYDs/BmAjjz07eDq6BnoBrFfEfV44U0k7jQSLWfZld+tIjqIG75vWIduI3ajKMc
xVEJqvpRcxHJcXPfQDKKpFpht7uQaBGgxlRBcmUEbz52o0vq6EizWcFdo3ju1d/VKP0mQrA2+LvR
8zsd+aEeDMnA381AGrahRQQvG3HyzU/a4gcmAdmxd3JYPfKOTr9/LPD3T68/A0mdgssg6YfZ5Pkg
8D6KF2uOPp94NfE7kx8Wsen76sF+ff/0TyDCBBEv2K7tfJYBbAqu/F7YnqE88j6eAuK4n0UAGrTD
lnyaKPgnk9RyXjgMLUUwu/XhZP/U+wyao9D5h7j14yy6M744xMQXTPVscR4bWygz8eWo6XlHgGBx
b5gIVRhEqRjUMuKJm/jGCvjGy/ENgYZ3WvtlNMtCUzbKN309ZBKeJcAaAjJLQDQEdJaAaiR1S8pm
SZmR1J4ltY2kziypo3lCPkvANQTuLIGrIUBQ4SPUkaisRsZHRgrbkY7vSGE80nEeKaxHVEeisBwx
HYnCamTmNVKYjXTcRgq7kY7fSGE40nEcKxzHOo5jheNYxyGswtuMTqxwHOt4hRWOYzOvsMJ7rOMV
VniPuXk8hfdE+74K74kOEVjhPdG9JVF4TxzjUxFFCkQnS6JIgU5lOb6qsJ2i3FXVvODcVYXFlOSu
KtylNHdVYSdluasKJ6mdu6owkTrqVarwj/LcVYVh1M1dVXjFcryiCq9YjldU4RXL8Yqq1lfhlatf
UDP7DyVrx5BQY5m0m8vXnbw7BKfvQK0Gmn/s/erVTkG9euqBQ6/ZrL71hvm6k/13J9Ilftyafjzx
Gt6Jd1TzmuDI+9B8e/Luj+Mm2D/aOvGOD/7cOn0n3PP/EY7/9eL5beavAraJ57Iq86DlCvcKd88i
/9K6GPz84rnMG1ZAY5jSAAdilhJlAdge5zhm6E7jCkiD7AJchW2/B7bT7vDD7uXFtdUedAMraEuy
WqsCxNRzV+b/U3GhN+hML794Ps5MVsBJUAF//TnofwYX8TfQ8iPQSgKZrkyCyzgNszgJg/TF89vs
5PgVcM1pWAi64h9n+nBgG0HqutymnFhI7p+wxL8tvx/0duPLQWrlnnEmu1lZ9l6ZU62A04vBpnR3
1ctkmAMVtrqCcAVC8F9Q/P+L5y+eL4wiVJgQd/UwEUDQwsRrMItDAm3IHxBQjpP4rBf0QRilmd/r
ySXr/qCXhUIrQXLZz6PlOIwC6+Doo0UtSq1hThNCDl1EhQ5wB2+hYdJx109CPxKkPTkdtISW//xs
jAmXUuyOMYEwLwQFGLONc9ciEMkcZx6ariwsnAxlw+WwWf7mYnAyWBF2TgWnKYJVwIkdm64BnGgJ
cJZ887vGcK0CnkB8xyAeo7Pc9EnFqStkv2qcUpf/a3nHNgJiCYhJDi7GqzSm4ke3hqvu20WInJPM
UOK1RsNiQj0IxDMjlvO8L54/W86BAkMkMoUsQzabQIXihWPpX2BqOdpTCHLmwsm4nC60o4ohoRVk
V8QEYAvSGRNabuKugJRw11m9MXWhHqSL7dE9ILXYYs7D08MIWdIckSJwfr+NnIHcHVjJmdFK2jpg
dGnT0RzKp+pgO4tG0zIspwxC7yjCjEm1Ef9xx2OehVG3F1zfKgC6VQAoolunImaOqgKUS0epCsCY
vXoFwAVW+sErQAE6/i1UQGPDSyqD1oaTCuMVmIewKU2qAJcysvrwwsaOJgy29wiEFhbvgRRvPHrp
RhJuKsorvBeGwoE9hcE/gu67xPbdGfdS9jwfkC+8YawbphUC1ajbePVGnTr6/IU+ICyeIlJcweQe
daNUZH4/qbE7C8+XjM31c8DSN4/hZ1p/UtNnNkUPJn2m94z3kD777ZeD9Apsd/3kYhBd+P2+GOhg
avo2hTfeaPbD7GITeEnYAu+tDbAdiE+p/HL3Wxi10zgZ0T5Q872k9dajrvTNxRZClpWjXPrMvPap
wNNGDK8ennrrqJ0f3Ck4HyqYHmossHRoqwP5knHxHMiHGycq1M2DvOTqvZqHE2JYfTDAHmuKo8Bh
PNAZnmZOtuT6RG5ORqj4NzcnM9eB5BYn4BpWzijV2laKHTErY5AtjjuFwhGnQp/iTnPceZdJ4aXz
wDpDW/rmCZSN9UrqJAquA8pQC+UC7S8ZIt0DmBcEu+DFc1A62hW0DzRGWW3AO4GosV5OzYFhsnqI
UiiTt0t56dO4D+phcCGosrb8ezeJO4NAgGDsFJdx0jpxIoKQCDksh3A2EWcWdjpBYuV+aSEyyg+l
8b2y1+RE1swU901RPUK0xPZiVOsdNqmIQDDnsI31lLlSF7qGBbAlHPY9zNSfPPE6PXHJCGwC5ZJ1
vznXTcga7KLzMEoPlprt6Jb+11BtoLOlZdOTWrMoYyCWN4vGsvDcsqiwmqvPEWmLrLQ5opKJgztO
JT3QOO0plzQbPxp3NqizdcpXX0pIOCldDl2yvnftK6iPrGx6ghTjBhc1Z47tNSQRl1pRfAoUH8BS
Ycll3UlBvnH7lAJARzzBGso97CXKPZ5K8p/KOErU8S2sB5ooh3HjYD5aXb11RtzVKEed1Gl9aM0o
pN+pHMuZ3bHJ9QXcwwi49oTPH4L2ppwwzs4KRHjMnDyfS+6+VCMnjNewkQzZBTPMmZd/MLXsRUjI
+78iurkqWepSm2OL2ja1ptZmrkp2RuCQVyCVKQV1GmjeQatmxyjlqxcz02XH6pS7njB5ssG4e2/F
AmJS/91BzwwIy8m4lFjnrWwpHMxrP5VzBkTz2l9yr3TO3uI1wIKjx6T9BXC9Q2Q8M/6QxnzIMxBG
oxFUznxgpyIMQM58GDfMq+szENmrBwpFWsfMvL3qkE/ufUetD8qCmFBSChg6A1QCSfMGiFWoLYsr
cgaoZHMFBVhIzMjWkOFmjyr+KAD8iixQKag8Mz7pnAljUDgBMUsSEy/XchenxGfRByvErrB8aY+5
W4dqzNZR1YtcZ9nFZomR/Gx5npM2po4UiUvEZHdOLrnJRXYhrsj5tH8mO7FnFwE4H2SDJAB+xw+j
Kb8dZYcW05RSmVufqEEGWsMGFwzxffHbpnjEbwTxIoZfBL1L8C3Mho0++n7U7oVRAOLLLIwjEPl9
IYsipjsyzZRjurGZjMJ0TtDqM+LY1QX8XhUxNspLQPs7HbZONhr7vRDfis0soT/zPnPBDbN5Q0cJ
2impwHyxd9nWP2oG0Warr3QgdsGi8EKW39PC8MIl4SLYLQcBYBxr3jy48mgBC1NCmcVLeDZH8WxC
6Wm+Bsbc8UlFhrsGz0ZcXW7Zq8Mqsxwoq2BWkz67NytggsCyUtfYkyURM29ahskhll+SKOwClouF
1pD+w1S3HObVCaqL4NEVDOa77cTvxFGaJWE7SMZ1aiPs/BqnweUFOJULUttfM/GXlngMIHDoh8MV
hIMl87DeP61g5KaziyT+FoFvF0EERs1dQRRn4DweRO1iqeCKmCfNVW4Udl9TIyaXrmGRcpiUHfH4
MGxd+EEPNLMgisT7bvfT0Sedzf4+Lt+qa1lOK4AZ95N3EGZCda2qg3H+2fLzo8UAm/chC275H3Au
z0coQCEQrzQEhkQFcjZHyPCzKTiODyfwKEYRwxXq5FFU1KVP1W3CVu8NKNYVRXj1OpUVkVy8hnM3
ul0aouOJ90oguizkSuFYRWWJGwxg4howFTV1VMEkfmf1YOL8MZokAl3CrL07MEklxF1SvzSmzXzL
95u2IcgWmzYxHXIrZM5BFjURVVctkUNXn1Ngw3z044MjoQRaVe44DwWOpXSlwOwV3TDGq1YMhWiF
aATCMmiVGwrzjboKm9qq4Zyzho2rjGiD7IZ8KvFK4jXIkyNeB7JLaWYR+AtvKM47MVIRrjuH26J2
y7lpCF5D+wv3UU5DKBPSsaoIuY/JypaAVkmzMR9fLLjlO+MLmRmXgF5ssanMpqH8ukVhK/Hc1Amu
PsVqa7fMeo0GphaFtpATerLYj1lLypmLAtNvuKNIA5gsE0T5xnSF7fJVDXDZ6hODtv0oA2xGORL4
E/j5d7T9ZTBa0pJpnIj5lu91ImSkGYudCKtQXkH5lEnhmRK5HcnOGorrilryllqJXmqtrpWGwQXY
Hv61ex75PasTX5VeodNU7TtIntWNoYVcQtEWHpXtp5F/eXltzfzAour/suPMrd7ZiFDOx2sxiLPl
lu+cYZFuvsqu8IQRFSvOGg5qIPjW3BYJ83uRJISdDIWdxcszd8mNJUVFG2G7CB+2eBo2wQcqwkeR
UbArCFagNAoMQvCqVj99fSvuoiNjVO9K19C57XGbhnIiW2wayo2jMQ2MsckyrfBvy5oG4s53tyg8
QCjXHxiuPtXpUK6ZizRETEIsW56hLLi2yrnIuJ7/aSbywGK2MlHwCDrIdV3LhfKgbts8kEPc4RPJ
HXHl5kaGOwxFE2y+wK7w0K5cNby7+pplTpjeepeF9VIGvKQGS3t+Xxo8NxlYbH2WX/F/dncrbM/u
Kvf77A6TCc/uTIsnY92NIj8rKdF5PywCexfKSi1qFe59cdQOC7TCVNeLYNEBfA/n4NtlzwPm2HhO
Mtafaytikkd2ILC7LF+M50cjWMAX/NAP/F14zO/Cw31//Ehf3QGlCw73ReSHz75EaA3VcUjdtNgL
rgQcusvVs7bjXie+ibu7Z5eX8mD6i8HEYmEHHMVX0mLh4VKziE5kPSeSFitnAgkXdszmxGJMzEL4
ZAdCx0/Ow6DXtsIos6bj/7z8kZEE0dUHN4TMNYwaOgXUwmcB5i8FX+wz4XBetloQ+bwFd/vd7mxB
8cbOmzCNtzhn7hZ+s/emiV1MPxzdnA26nT9Igs/e3oixup1m9L7rf/x9583Ohoh/buJeL07Dr7ej
STFtqNLc0IlTiTQgROfDR20z9vLcOYectuYfVXo8bNdrpCY8Hs01B1TiuuMk/hp0szhROy044Fc/
uj1zxhm1IRliRPA7CeMkzK4rgHzHSYw2X0M6gs/VjQsxc8nIFsbOyzOEWrSF4EvxHRwyMg/tkegV
yf/+Zs/v7XjoJg2/VLMs7PlvdsC2n2X+mZ/Txo3DsCulvylC0qQLXolQOTiLYymr10Lm/b74dnfm
y3G4uzQ6huEQwlioro25VcW1RtVhQokbu30RC6OZVxpCxHMazLFkXgJBS3ZmsUWA05k8SB4rvwXX
Z7GftJXdmhjPQMUelodzM1RMTiZnHhyXrv5MFkyVg7Zy2v7pww361O/Znz6eIr+5dxP0318HV++7
9sfDztmH95H/3/+kn971bj79viM0fzopHASbYFapUAVCWR+ZN7wSmi7f81i14TYY3BNBsscZt/dI
1XXrLqw3BD3iQqa7WVvK1MqEc2j7ma+YqNMgkBcFYrLRp11JtnVLN5zozKPJfCigrnX5Gs6GxvOn
lkieDM0i4mcvIfX5+bkjtBmPtTnqCTxng6+3DDryO9fgwE9verFgUtTzW+Gu4FAkpwO3DEqvU7/d
19lO6T63ghSIK+AyiTuhuoV5RtJY7sYizKwTprBJZThbC8OVgOSvxre21Iv95ruRXiBhCy/CM2EL
uzusLlG/TKhyk8bdzm4Q92aCFERnghRbBinMLQpSHMw5Ia6FHCwbGJUMUkqfmYZtZw02yGYaiBMJ
8bZD4Utinwc0OL83h7U98QHf6ZWmWGl8m/cbQ2MoeywGZ1MdkU2GkFlHyk0MclVla1j7wHiulUS5
qO0+AkyDCZsL/UaZS1uxXYzI/e9GuZQ+4oq6DuJ89evUWJ1P5XSienT65bfzbAd7X3bq1a+dIAoS
oSStcKdB0i++cJlXO57bFs6hn/PnsqnJFML2sO8J0jp0Qvd43asxuyYX42iNswavO55ds909G5Ea
Ed59r757EwzSLxBbv/hR59o/i3vXVi9u+b0ibf4tvpIPmn55HyRxFHaH6iy+9FupNflq1xd2YaHH
F+b2wSepOFsyG+PapmwMtwuyMezRZ2N0qZJ7y8uUzsYsOm5sqcOaShyxU+LokhJHR5iPBtA+VVHz
9RkSY0/tEg2JS3SiLdErVNcxUYtkFcrY+Pq5RnHETKw2EtPxPtc5SpdzzHUD0nFcbdmS7z+l6TKC
dRxXe2JgHcdzXRZ0HM9tsjdjXN1aTbR2RDUkZo6r2znzvVQ0m/TynT80O6eIjuPqdhWi47i6M4Do
OK6WUOcbEuhqTHUcz9XQ6TCulk5RHZ/Vchtq5rNab0ELG2RqloKpjuNU3atW2HJvRKxuFdLxnqq7
Msx5dqoWsuukwBQp3JaeacdjijyYWQOYWtSmkwxTC6F0Vp6p9S9meTDVserkwRR5MJ0GMEUKTCcF
pkiBmaXAFCkwnRRsRQq2WQq2IgXbLAVbkYKtk4KtSMHWScFWpGDrrI+t8N7WrjGpwYyO97bCe1vH
e1vhvW3mva3w3tbx3lF47+jskKNw3DFz3FE47pi9rqPw3tHx3lF475g1wFGk4Oik4ChScLQxpRpU
FrYcGhEr8nB03sBRpODopMAVKXCzBnBFHlznF7giBW6WAlekwHVS4IoUuFkKXJECn5eCiC5/eIXT
dVbfI55izYZR2OANxiwCuezkM3egxWEcbcqAqh60RnlBiIYHWkwzq8vkHD+lcRdUO3GaxRF4K+ba
CdiezUPmlz4uAjFjHaQgTLMrPwJJPMiEsOaqgKBDa3v1Yb92ohxTASFsyQSQ77fcl4S3XMwYfAkn
+emOfIKbdLIuA/cg9OTSHRK8sJVhxB1ymIDxl8EZdIlMBorf0g/jkT3oDJvui7tmOJAvdyokXHZB
F+M1nI0iWJkHU2PPtT0XYUodp04QcjGqQuhC7LhVl9dq4kMdk73qbhRko+o1qxdZSv5/LuMik9yf
0p0G6X7Zqf0/e1fbnDiSpOfrTcT8B11HX+zORFtXb1KVuN4YgwG3d7ptb9v9utcxIUA2NBjRSNht
//qrEmBUpVIh1Ayi58a7M2NQIazKrKyszCefhHPV+f34Hy3I51wEXhT1SdJ+f5O18W/mWOnrVs2a
ffY7Hes2uJ6E41gOzKGV6guQr1PD7lL1N03CQgdXICck0bq9PT9dPme4IbghWb26VfvMagymsW81
Av7vEV+ozzvidWclFg0Ggoq+V4TlYyAg9hgTGAhXgPIK5hcKZzkhdSpgpfUyrLRKPofreOz3wjjm
uq1c+l0ERBPBbZrqUW60wXISiQfl05f8r+C29/ffpoPoIR7wj47FB4VhHg9Xn5SM3U8//kdB49AE
BuOQNvtbuuUi74VTi5xvbrTGf8lRTI9S6nIt4nuAa0NYFJ1TLGgop1FYBdTtKIvZWD/NjXqbknYB
sz6Lrw7Yr41f3746m3Rv3s5OWvG9//7U7R2Pm+E78g+dJpUw6asvejN84560O80v73p3HeSADoqn
H97dXfuoffcBn952jtvgw017tsoxJEgcV9UHtDD6VoncMa6AshE5mWzYWjFi6LI2Ivu3O0/DKHqw
bifjzA6dpDSptEOLvDVVdujCWWdCK+DDIETultD6pl3624x93kY+m4aTwJ5EA10db2FbjOrOts27
+ZYLv4Ol/A4iNIS4+X4H8whwbZZUgRFQ0Lyb0jSy3+FWAG3FHt0LDSurNaatpaTWmG6p0RqnhtC8
V2mO1ngYu95CaygsqDWFc/gOIm4FjNCEZuMFsNVoOS2bAKI0QUoDWYEEZMXpBbeTE8czrgqWjMFQ
/G4BzLsKx8PwQSwBi//tt5qOh7DJ6k1ki36HKHVEX1xqMcDnASuNQNVjfu7AZWtLY35W9giRu/sD
JIGaQlFG2xSBJFbiSa0t01EjKHC3j8zXwK05bpk2qOUOIKIzansa3FvtRKDW8yv+4mqlILm6pZbg
JbA7P+4Ho/vgIYg+KUpSyDsWzTLy7I2YTipqsmiCGqdSXw1VmXIHLpWpYCZf9lAZq8BDdTNqVcxD
bZnOcxV5qNw3FbDUxYZqjYMb62Y2DHuDYS4UWYD7H5FLq2OFGV0hbwqAVQCRLHew8Fw3fwVUJjbN
2s6zXzCpJlYbX5qBLsrRwq2A/yPpkbKptOoYNuFaaeUb103kMY8wSXIvaOC/QZIg1d83ja6EK8Ea
4UmyR0/Q7l0zkkW7ck+DbzS0mXgaTEoopEwQoFLhiOPNu4xu7Jp9wzHzqPgxU9qJTUZ2sy052Uea
pkiHvO9u4YZLvSqIaZM1DOHdG3oMMgV7Bl82lTEBnlyatOgXvDvnf5uevtad1w9cStgIRFQ61VfQ
pYxpcsAuhcJwwKRPeJ5YXcmbJ6xGSuWATdvGo9w6/Pootm7DsT+y/Km/ml0jhlM5LOEKIi108w0X
NjwE6NHaDbeo0Sy6+Qq+jjUuV5KFkkZsKX74rd4zE9lDnPWejfhdpcDI3T0CA7mZ3hmFzo+sgD9W
zosqlV2Rvojf+dHtUtIoiKREBmoA1TBWQvNmOLUkMc+pQGBYE/zADnRRIzmEu1KzsJTLiahU0INg
DZaHzJQOgZ1fnBxEs8kknMbW88UvGnO78ptX4BMjhl2BNdAKYpNZQ4tbfAkBwpKeZF6eYESA7bF8
iB8E3BpGu3WAVac2HYff2I/1kNfYqh+75oZL9TDWL6jUAxW0rGOlokseabl7EKYQO7Np6RbYudfs
083wIfKtf/J/B1fW88898fIwnaGQNujP83HDcDqLB0JlJStPU45hEtUCRN2Xi9ayqA7c7g0+puVg
bcjbeIf+gxRney6duFsph05JLqZOEemkGvBqxEsVby51pWApk2xk+Hm0AnbdEliZtdlHFSvzbnze
jFB0fUfa4w4+BR1Erl+zs/6HG+/+m1Vl3Zck2rIclPONJUQvmuXSrDNoLkxT3fcqgt+Z/g3FBN4o
gqr5gwVeTlBODXMniaiCMpYHKq2RKutRKD2v4q+9XYIpw+HQH/FpHfqTbhSO/Ljjj3eRnyyBhVgL
s9scC7H2lnO9ADIgDqWZqTIASdG5jWAbQYps7BZlLzNWkypw9yqoQUrD3U3e9N7D3V3RX0dZ+8ai
XllSxNv9yZB/aTlJtdH+SUqR0fwEm16MkB9fHx3ulYyMVdWyfXYrIPvSsAHm1t/Ie1P62UnSY5eU
Ob1//fooIWPOaXcVSOpZfZNPLqVuLJRXCK0qILjGSXfNNGEXSh0dWeISLkO6fz9qiZ4LW88srJLF
4rfWAZ+l5Ovr4x4/5dyH496nElGTOgbG85+k6ZmmBRgiyAhBBNiIUUqXTQvEkd8f6XZLM9+BSl1W
QaELdmVJAyglBUWnTSUp+K0rMtGAtXoiNQ7hRsSf09f5naekQ5iDcN4SU0iYiq3/n37cUg3i/EZb
qUI01nwu1asgV4aiaG4F5SpeBqJaLFnfxnuw2ZcOsCyUXyTOPgfSQmMS2yUBNQjUYJyZ3ERBHlRw
eMMs42on2JZ207EpcLnSZsuUs9gWKk4pAFYb2t8mXsWIeyyDVzHecKkrBVluFHpSRr0qap7KxPzX
bd3bBLtt5oXISSsJwEb5ytbRA64AbGbGIXmRA7cCukaSyYTjlucwhtxkG0UA608AfCqkhmzO3MJt
jCr/tsRqIV9TkzZZSsdI9qSUD4IKPPUcE9z0XO6bUP6/bOWHzgTDVeXkn8EEN03UBaUgg6YbLnXF
yPol60oVfRMQ1kFRG4g263wlUy77ArqCgNCVclVCLwcP/pCbzrFvPfdH4kUqk/nMerE4MJzMfabn
g8UJQmeXVzY5X3M+rSRjJFtTtsQK0EYYbZ6uEElwCPcBq1/cOX5WFOciBJvGuqQDS1g6oHJ9XFFf
L8VtJM5T/GZWAVYJaMr1sAMpOLI9fg708uh9VKySUwNgC0Z7Uxy/BsOvbemu8hEqoAFQQXIAarin
waLRBbx6yhcU9dxAnNYZMfCGqxTUlzftcXDReEXen7qd81dzyul1rPmTrFmrx7eDOBjld5DgEsep
iExOBwkj5aNS5exUEfgvFQvwYHvPUjSLLgndgQSzwXJ7A+ClEIX6rtVGVBasIDWTB9ojR9gWBY26
mgIdaI84Nex936A9U861FGjPdENto2qVbVU2o6QCT5IQoGbt/6xEGMaQQzlKA+MtNZQGKMkcZnvh
rIgwMER0TmmAi/b3KMrWq5AhVlLIWhbLUyRyvKdYHtHvQ3Vri3ImK8F+TCsor0Fs8/KaOcZlfXlN
BexUb6OzyUfcuO2MX9/6KO53jhrTD+8bn7vIiz68fz34kHxpLjMVP6OgxyqsVXzfzGutBJe8ClZe
WYoxpwg2+3ukGCO1hJYoI8iC7OOKSFEFkQZcYl2uJefbneu9hSp0tSpqSeQo0zamSXKwBOMhMBX+
WiqAkVFeCeKD3VPDQCb17HsEK20lDv9IzijDnZBTg3lOC+HnA4IhsxHGwC7MzViUlV8hTXEriMsn
WZP5vFz4cbK/pycHcCVSqpnyOZd3ArAoCFmoHmCx1AVj0wWlS3EFS04T5MAtlzUYq9ssh40pMTcg
XabjJuWzrMwR2liXZFrNgveheNlRfu6saM8LpSVdBVyqJYvQ1jBJ/D+rJSpRHO4IhnqccaeK9j9R
4slOFX0oyyrOHnKrl+LGWqb1ZQEae9IotrmK2sGcrHnLIbYDXL4lFcuaI5BBR37XWfPmtrPmphsu
dcXYnEhJVlTBzEV09DoNROuIOycOl70GAa/Lmrs1ZxvJupeDB9FI+HeRRk/606qJdKOO8E2fv/CX
XDu2oicANiDzGqTBBdgkXKxHApVKQNtlpN0iDeC2MQGH4qucLBB+sw8v5V+w85Rs7HEVENYylUUJ
p+TGZ+c/jhNkPQeblGQmgg0UMOW4a24AJrPpYVbB6QtoyECg0z5q0ORA4WpI1+a+dwpcgFAtaby8
ZTIQMwLClNFY+WdrkTLP8jl1TXvGUrzG5m1KEKsKr4tsvhCT/DE2UZBX53XlU/E4YvkhNdpk7pyn
dE/BFWyZuuwxdlDLAbYAjDKNe6U1PaQkI9034lu2xibM2lvMHq+/4VI9CnZN/D5bU61nvqluIWdz
exlQhODScLKECubmlYqkvAp8H1QSsl+ALu8PgOxnaQlTqdY0PyKpEcyPcZmeMQUbhcpOKWAVQDGy
CR0D+fgiID2bFyenp8GB/P+7srVrkPncxdkf1vdSdtp8w6WSFWwwq3CJ4wr4c2iGi3QLPV++O/6c
0ryZBWEfWFTCEfWwZW4trDBckwoOW993zxojSqgcwMt4S33PGrfm5DayEz1rXIhs5mBqC7teLFlq
7jet4LoqQAEThNb0WPxuqX9MPk9J6h/TLTXUP3w3BzWSixn0IIWM0AX1T1GFMnYnlxSKod1vUtCT
qKQU6pztIh0U8h3Ej+n5bSghoMi1oUOwXbQ7qrnLu5L3qgCTSbIVLAVhRN6fzSEoB2TLg6e9Omv0
jtvDDn4NTl6soGomRBJXPpYlf3LltpemGB4ju8/AQc9LL1ZN48jtLth060lXuFk4b8ESADHfJ1wb
uYCvWlwUm+RKQTnXWGOIYAVMe1DXUz6PfCR1UESe1FMegBQW/a+e8kZiqOKfXCqRFLpzi4XusEsr
AHiXToZtXLK6N8kwVySEiNqz1pVCd64pdMeqaDAMMiBukb9ut488m/I1ks1ez3mgZH4a7NXAbmnx
U2JSSHSWvYKlGB01VjniCkog+KFK18CFAcBsmCTGNSCTTAMXJjJA5bIghagv1pKbLGdbClbRgkxT
VUREy2OyTGiV7wmTxZUGITWkTaUwEi3G7I48uPv0YdmtxZwc2++tBdccN5sVolIIhxpDOIxW4VNq
cXTNVgNwh0xwirACODpHgAh3i6NLEhD70NvOy4/rJHPpkWaD2qJ9jbxTZ5qd5Q1capIUu6HFUFaO
Qzyvgqww1Hksed3c8hraOTVCargU5+w2fJacZnZLcUjxHWqK70Dm7T6WVr7n7z4019jGHopBDWa6
llEpqELNDE/OXjS1E8AbfvRv2Iyfa0Eh4I2gan58+O8TeGOGXJZK6BbgYKRSCIjSYqd36FbAwFIa
eLOxi7UvwBsIaphmCdipFHGhJq6oKqB0SMe/jiHBLRG1g9pDZBZGmDRxgaWIWHbS1i5dNUalcAo1
I6HcCrZGr2TDsqPWXiwdkbNY8BZFD6NQS1MlLS9dXCAXT0UFug0xdeNkUqyGFcNTIa+KBUfKUPHV
MSqQ2foDgG65Dd/mtP1uioIViiPmunbqTArzMCMxVRU1GJhozgZeEzWBwz0cB3gaYqrsVCBB44C8
Mmy0xXoXBFrJbHo+XKdVJbofmG+4VAIpVMQKNgFkrAJjjDZvITOfhkpgqRusViQwQeSRMHkpGSkg
xEwBIcyqoBfRL0+MQd0WrHEUeIWW55IOf++Xp0mNSi1P0w2XSiDFcljBWA6uoM62/PJc7ytVuzxF
79Q5DYy0PKWwDjPWxXlsb3ZPyppzLndXw0mRfXYqDlIO+x6Wp0mNSi1P0w0TJYDUOvuNP2Lc7Vvd
8GYyCuKgZwvlyK7S9si/vha/NINk2Hzd8pdT/ypOFIrf6t/nrdev6qet08sNb2D97y9c5mJIZE2C
6c0gXv4lGFqt9ycXlxfiBeCqc8Tvvvw6rrlv6y9PmkKpIDfZBFLA3E8Wfz+ybv3RoJcaedp6f2m5
6JN1zv+eQVf8CePgaywG86lgybDXXL8P3nElbX2yLvjf2Y2ViZFcTsXjnLfLkrplaQbIXIaaAXKN
sWaAjLfTDJAjf5oBUuyHaQZIgQaoe07p5At1DwqlcxTEuiHydOpmA0oTCnXzAaUphbrngdKkQk83
RO4+CnRD5HaSummBch9D7UPLbfS0Dy33XNM9NJJmV21tqWunrlMEuYW2Skyk6Zysch5oOuw6uidC
xipsTbNOtZJX0yVSLSbVNCl0dMqAjPVrmlZork4ZcF5FzHIIF+LeW9cNjSvfakzGNce2clXdhm3l
6pwzn6YPKvkpUEH8GmSiNLgFmh6ot/k5Q/QYdw7j+2kwklCgWSI2VHNwJjBaH4aRCGmF99bzHvdi
gvtAulkxfrVHd+Yo7AXvAp97DJF1wIUZ9mbdWPx6JFCvZ/z9hevADYdWGNxa8PePRmEUKEJqfGhZ
L8Pr68H42gpnMR9KxFD+Fn8ljf1B/Ez9u1F4/d/Ci+Oaxw4gV0GHHHiQOPZg/MNWfsREugD8IPoi
UteR/st/BOnlD/wNwSUurvDxxOX/scB2vt78M4tif2pZPyyklTtu3fXv9GduWV7X3708O7YuT/hC
vKy/Ov+UuPUHgBzwXVRQEzo1h/yIrdEgiq0nT6wn//Xkpx9J6qUt3nBWb5ycNs7e87dcK5qbIP4O
f0lTL+1o4t/w95iwXtZVouKw9gs3EsKucN33UhdQ0nMyMTxpQzM3QcLS2Oet1m8Zc8PXrnUZWkdd
a7H0LLHqrZWRsJYBT2sV+7RWpwrrNLiLrqfhbBJZqbPBz5/EvgOkh/FvOj5/Gu5q5TwO97DSV/jR
e78eBz8+zrnAsc95RMQTkdwncqQrkI/cr0dy5Uc6vzh5kpzG8p5HVkWK9uxxvMfHeTkYz74+6hzf
+HOeCMnayGW8V0/Ed7flE10GfGPiN46eLL2dtTbJrUFHbIRdsQsm+9wo2eQWO9tfP0V+TPs/n8ut
fIdx/8cUO4go+78D+Ft/7f87+PnFeskPJtyLfzN+Jfza3s/WE5tv4JdTP+ona3Fx/ag/GPWm4qyj
jEw29vXDhAVOD1QuJweoKD1AunzBXepCX5NYxtzbdPzucDbJvczN1y23QYY/UzZTeX+pdRIHN5Hh
Nkv3KPHiXwqnSXbi8z5lT/1BL/er+fX72Y3p8sLlMnzBnCPMPObGH4yCqXlMzw9uwrHxb1nsXqan
7R/443E44/vImm8Lb4NuGJsHffZv/YORqh/ZcbeD6cwsPLszu46n/pe1f32PnwVHhlGJW9I4rZ+v
HXN+flI/Wjfq0WczjnoZdv1R/hoQQ96en667y2k4LjCqeXqxbsjcK8sbMvd0uoPhcO2gdQq1GJUE
6tcO6wXRMA4nyTFnszU6X9lOzqf2JyYFNopJuZ5LTTEpqI9JucVCUvszK9xFNkzL6UWrdSqetT2Y
ctHOxhG/p22aNYpNs4apftpoiUjeKsKty5A48kWsj2prMiOreLYmK4KYfFEO3HvyRbnhKpAvyu05
oXxR7iCJ5Ity/mPV5VyX+sDKHMlZD6xMkpzwwNIssUJB0pRM5EyvQ3af6Z0XHy6aVZ70poPIupwN
w+kT6/lAvIrFC4RZks7s+pPA5r/I1RT87PyY80X8CIb4EWwe/FwGO8N+1LdnB9GDqNS2JZbRf1+c
11/x1TC9DkQxv1Rj34Ke2xo4BwKOfnbM/3OYbNS2ersV4iFPvWWEA/N2T36EXPg4z82BPw74/N73
xC/Icw+74TiajWJ/HC9KiTabvdbXiT/uWffhbGqdB2Muw4vBQ8BnIw75uj0Zd/v8yJ13Oyvu3XY9
QoljzfrTXMmK9hKirtk6ADTDhiAkddw4SSTVOSsiqTxboxLlVSAplOE/oNDtdsEtgrMZJs7XQx9/
Yfbd1/gRY/LkIhx/9q2Lbt+/ugrE4uldPzDC+ve37uG93w9DjVyjcGR3u2bJnk/DWJh4IdooGF1x
ifb8+/+0hr1Z52p8o5PWnJEYM4FbPH51mdv7NceeK5wxVRSie+7KJL0Orgdj3/rod/ujsMcntjH1
HwbBNHdW16+WVO0J/rXxa+f4Y797E/e791/f+8dtcNLu3XbeCXaW16MuGt1/vKhfnxzp/3mD2sB/
f3rz4d0p8N95/DM9+OH9P0ed8evRx3f/6q/oWLLoGCJIAoAzl1FmNb0A7WQ1DfpFVlPe/ivbPY9W
QPGLxP6S4KzOJvHBYJykA5wnWu1fyPyoLzaecNJPVpJ/FfW+fnmPPx764iNypeVCpAIJdOUPRdpr
ElnxdNAdilRXzB2xyBqMuRnk/wqm3WQVWaufv/Pl/eZV48X5z5llcjI+mD6ifh6u7nr3+RomGYvW
hR2ffDgcUMBOh/CYsTsafQX5WyZ0BS8UokuYVBq+5LGnfOt9M6qvSCRynCml3gFXwfwKVsv27u7O
jsJ+J4i5uyCEJgQZjQaH/TAWkYIcOYqPXYQvGsHlaXBpH4U3MpsRW80agKJ6PcG9Yk2D6+x6GozF
eoIjT6ynrPItrMhs3BtESey4x8XfHUwG3C3hgvifVdlJjsMqCcDFFfAZYJCp1RI1vhB2qN9D+Gk3
CCDGjvMUEhcjxNzDSXcY+92OPY4+P25lz2/86f1w1glj//568EURWAKBy1sIGoG2w6n1IrwJrM4s
GowDcbAKuV9sbfhDKEJvzq//5R04GP123OgiDJ2vLy4iyKWJ4wPk5SuKI7qvIMz9Fp2iLAGZOScN
BYoJd7+sNHRMvftg8kAJgQceHV7378lT1L29oofg+rZjY7DySuqDqO9bR+GUr8NYePTU9a+uR1+c
Gcjsn8NwHE99rVkWlUDPh9GD3wl1K+cZ1wj/81B/TTAX5js8yWevAm7o9UtSVaezaS+YWv9H3dPt
to2sd70HOO9ABEY3ixPPmeEMOaTh3VC/jrOxncbZzaJFsRiJI4kWRWpJyrYC9KHOZYHzBL3qVfsC
veoj9KozpGRpqBladhbRFgkgUqIo+vv//36O2Dhjr4QdzQvrfRTH+StL2r9pIW5kzTOeD7NoXkRp
Ys14OGTyKLfSRGhRbt1FxcRKUnGZoALlYh0JSQKSPa5S0jQYUyZftNbASb/+AD5EyYNUZh6Lf/VJ
wLM0ziXqn2o5XbQuz4yMVo48qiSyp3UQLqN/kiLYuWvvY9IYPfjaVih0iL0SJU9qqQXhcmy7bf3n
f/zb//7tf/7r7//+t7//9xoBszQRsjAL5osBuGcVQT4HD61Q2hFcZlE3dUJR1cSpAfzV9E4C3m0v
9gK8KTiiGpP0EG0Cu7IwPp5OPI4xPHaOj24+w/HE8wKbObP8t+lGqb14y1kSDbksKU+EqOCfhTQc
LSZRkQa3bDaPhBjIwefPyTPV3DiaWZMoHE5MMoTKtU7Cl2qQIcaw0+HbAWxvZ4oncY6PaTwcurf2
7Ng7QvhOqOQjN6D+YrmgFC/sDfDPMpYUQg3lBRNgd91Bmo1I4s3yzxrrYhAN82gPHuizvLDeXbUu
xYPDT3vYEMDaeo7Ve6Yf07O2feKQE3HQhERTdFA1Dz37UKt9VUOCEwxte8AJoUchE+IjdIdHLhli
f0hIcBvlg3sw3ZiGg0UYLl3qkGG0DIMZSxiYj1Z4m6UZ3yukYY4dlu1cBK8ViA7C/w/KegXn/q7J
As9uTLFg19BU8UWFv039FJpkAW7IFZCGVIHTkClwGxIFtCFP4DWkCfymLAGCTVkChJqyBKief1Db
Iur5B7Ujop5/UECE6vkHBUioBiW1BQLV4KR2P6AapNTGB1SDVa3noQarWrtDnY5UQqrBSm1ysGuw
UvsbdvJZauSrBiu1q6Ge0VIbGuopLbWXoZ7TUtsY6kkttYOhntVSmxfqaS2smgF1rlPZrgYrrMCq
ntfCCqzUvBZ6Yn1/zShBB9gJhR1SXwvwz9cy2/8vVmRN2K3FhHeXDmI+W+uvMq5ofczYMpZTSoZF
dRTMJ3IuyfJ+ywopywYCGarMqxICkGbjeivge2m+v7v8BRBACKhq5SDCEDsQeBSiY1QWswWfowUD
EcsjkIW5jIdlaW2+/xfeqjaZ2oEu8qkcdEB9Aly4Gkz97vzyp18gmIkrOeChMvR648V5J8Q7EYx0
LEc9GxJrBpcAH2IAGbI3Ucf5SGJM2JjVQTAfRckoXWUsG9BqisyWDayErGGhgHlVHEnFAzg2BBdI
4Er9wS3DpyLL6yKKY2vIkm8La8wLa7a0spTNZKRaUOooirlM2N2l2VSfJjP4wD4mBwg2eqi+zGX9
Z8rjNzyeV6GWsnDqrxM2nPIsfwYnljcti2Zy61SLv50W3YoDIHF9YDuO7T0srpileXRfZ73OZe/i
/P37Vu9dv3/VfnN+dvXu6sfeuzed81YLlD8VDIVtG93ny1xW8MlnA0xyzzeP/5KGMxGBHvA8hAB9
EmO6ctQc9GuMaTC1VPHseQfovCqzeA1MV1HCWz4aWW9YFi6t04l8uZkF87TIQzZTQLHLnFh6C9De
YU7p2AzoLP1teOSHN0dI+ClRAsbCW+EraqkNhvd7PsJeOYdUDoYPWTJlIOSa4ZnmK3d4XaqjMItu
eWaF6V0SpyxcqyPrWHBGYvme9RdruJjn+iyeyf9HB5iegsvdcWa3zUZyjvCxIG9ovex0P363cf15
xuLQevmWZ9nyO6vDsqJM6t3I82CbhSWIy6sENcRFOrNO71jOBlEQs0x4PsJnH/O6YN3W+e+6rfdW
O0pCq8+ieCEXAOxKBUeILbmxQTAEQP6K/cStZfj3GP1QoyKNUqa2jTxMIZCOmb/Wyr8teJ6CeSwI
7SZdU5mMmhtIX5fLM4QKiI2+Pr6JhzXjH3pd3/GBXGSOqiGHWcrDMV/JagN1yDWW9glE67KRii7e
T6I4mlu9kMeDLB1OhcYW7+zcs6SJdJJYb6yPPJvnQk0I0pkUCuFoqaE1FybsRxZPX4p7skIcfPeX
8qMa9+fc55Q4AwAdO7jovjk++4TAhAsKnABJFxzMErDIS2G/RQ7CKqvIARFhoREIsLCAnTU5hPMG
5fTcu0hyevExS5egVcIkTxPBR4V846Y6DbTP/TgZGjxrdSEBPkDzLsE7C+OeYGNcsKKQFTnC5hIW
lpDDp7O8Ogtu8xyMHsY2S7TsaZBo7Azo29CuLG3brM9/F4vDejA59vtRjRHhrAaalbJaa540GDOS
lPYyx3RJVUNRCnacA2wiJJphmX4fuW0KvDZuIdRuBaM8j46HrFm8yeXTWC5EVcRbOx1YF8N3TPai
nIqT1XHtlqV0Y3LMTRIzwb/W6Wh1FGQ8nLBCN1b8wZco8WAL9HsCHSwbc6svHYjr1RDN8zxfyDnS
O7ZO36YtgOye8C5pu/ZE3zx4NciHHvbB2VvbFQpPfZ7HJYoh5lardqUHUGy6ieEC8T3SEVadsA+g
HbAZmy6yxSN1rnhVDanMNuqy2yi0LgTvxnIigDgBMiwe1+4pEb8fiXwt1K8+79py7zqBPkS1R/6m
gpMHO8BFpIVpv047O7Zy49WP05AxNquKD+x8/Zo25G9qeV+MMz6OhSYuX4WvMU5YPuc8fH7UwT9B
UI4M0zk2d3xwjGyb2MRxnUB2rgkhPSmt6llkjDtctD8KwhA2sXA9ZIDCkOtFpvCeYIwDBHY0kzua
xZcJoMI7ETB1niujDejbBfOefKnN9yJDUI3gA4wuxmW+1+zvYST3CH65v3dx3nkjrCCr/eHq06V1
elG+BjOeC0dq2CQC2z+dvX4tiFkB+eViNhBmXjqyfsrlDBXhYzPrTDaZC1vw/s9/evC/X8ovUFZG
2vJX1iS948JP/64uw6Rv4PkhBdBGtYfaw03EEKHfx0005pJqXQ32AQoD4Ka66Lrg84lgpuuYycV9
p3n5Kk1ZkN9xXoC7ZeWRPEMkQpl5L81W1xiIRa5DbB90W57t9/y22wryu+GquKD2BDusm/F5mhcb
iJvyc2rtETzIWHF3x4SxcbfV7ROXClrr9gjyO70uxbBPW37HbjsdQYk+7mJfmnFyPDj3EAYsBOtT
wLLZEsyieKufYcJC/sr6JN0lNrMurLPWhw/n11eXgpfvqjdBLq9BwSLf/v5TBOZdlAyiJAytoewr
F07aX2XV91wcmCnBkXsl18JngzBTylQ1FoQiO0DsbKd25jHjqMHX8GVp2TP12J7W6R/G5txDMppy
4bUmFvsAy+Wg96+bGLcMa17HqVx+UGnC0bzgw8mWjbjxq81utcZbd3ziAEqo3Pe+8tZHxdwGyv21
yQTiVDZmyUYGW0aI8as5T35KonvL20DdVGNQGyt9iL02u8JRMhsmvgOEbyf+ecFomYNFNABJ+kNj
d4H4T1X3rhdl0VTwZZrlspT9lMtzUKzO1RtLnH5Y5Ln1huVTXhSl6T5jeSHLP/NlnsaLsiy5ycrp
pMkoGi+yMkHI8lzYK6HF7+dRVgasq9jXdeui3aoxXkUbmDqCLHBJG2viCKOsMOTLGi7fgxNNlSUq
TVDvAB1Ivk4A9/ouxkLwUGFR0D19fiiZBtJn+/w/LoSkfD/i0UhIztPpvDrSppG2yWDvNNKeea3q
o37LAZIhIHS2n6B09HudlmuXy56x+uluQsx05R4kYyo3quls9wBLxyls8H/QCSZVvsvbkMEslcFn
67R6DVgs2J7txAC2oLAmyOhBmBMCXQx8z9kEXgXoDA69rPuWVLDxJ40FWrX8oX2Ajk6Km3PBCnde
9R2/1245vgu67b4gUZ8eX112kO24XdgGgmD7NnLosfKO2/dxwGchGPAfao2EkVC7l2yQTyNhvA7X
b4GkfGvzHXM4RmY4yZrrDapS9p+cty8sITHFp6nQ99VMEcsByGJFkUWDRSH7n3bQZqqcq8W5DhCC
wbvRUvFEuNVB3Tbx/a6DULtNOxC2YRf2oUNJx/Fwp+cG1d8e8ji2BdBA1XwZc7aur98Wne0sDQdc
5gDL83ZQ+mw7X5HU8209p/OtManz9KyRuT3Tdk5stA7HlXm4b2vsLHcG1N7aGkpgqn6sJUL8Aywx
sumDlfoEa2VjsBptVa3NKdwX8Y4599Rgguyw3VOMozUiTIWmKiLcA2TcbRtpO4rW1ijBJw6tel2t
l73e9Sbkdr3MW+FMGAKnw2Q5NRQINmogUxDrCQWIO9jZqcBco8BUzasqKXgIO5Fgs9KXm7LhA/F+
UdDzPVvEwr4TMmtpnc6Fry6PgmIYgshoAsqZ0JKo8yFLEp691hYVXF33Jfbwu4eyAkQI8qV77coh
jhUCBWPb4OHXHg1kIk/8/TKQ6Xiu+4WBTGOxds3igwewUNQozVZc0YPUpmCCz+mHs9mPEDlCUAXz
yTI/ZnN+f4yEpgojBvJFokRvdO2RjuwCE0zsYEFB51s83I6mGZtZbzkX2k0ItIl1Wr0FyrPgWty8
c3XxxPBaL8vKDtdUOAT5r4Msvcv5r3Op7jaRTmOFvBpbdg9Q/eGUseXG6j8Bx1IrC5G4xY8fltLg
S2/TPOKxMPGs06Q8yW6CxSxMblbVEVpG+2k+zljIrZGccFupOAR8gLw5kbW5VQBsazhEIbmPUFeW
k9kAuR6AQLqVjhCcro0wyH9bRJl0B+VogzHLB4vxeAkm6Ywvkuh+y0F4zwtunXGeTBbRZxnLm48f
ToJ5Okjv699SPIiSd9+8L8uK8Jp3MSYCdcBGLkRBcjPLGdiGgOIvfvEfsakOuRAGnFTLzdEsef2E
J9lyGBXBQJiKebooypDVhjpNHRrqulUEv762IM5W3XmnrNaRqliW6wjHvIyYHVvl1ECrK+c9pvOZ
nAH6D9a5NGzFHymTTxJIvWQsUCfku1w71VRtXM5Q+ZEnyVIAOJHFX+XJTBwHw1Do2XS3YORptu+u
4YFlqg/bOy3d3S+qm1Ya+6yXl2k2Y/F3da6ino996Lk92nPsLmn5nW6712rTliscQg/ZEPVdr/QW
kjy7BSoInlqqZOz2UeWgfYAcG8E7Tc9NgZeGXgZvZ1fei+2Q1At9TGoflXPAcNVD+s/BFBCH2hCY
o3Cq1fSkr0qK2jPWt6YpU4+YauvSg6zD3JrV048ybuWyRra0WkeyGb46Q5r+7B03wpyps72qX8HZ
kR192+u17J9/6yef4PTH8/YvvTfSsHSHpP6Tu+GW5Uwol2leRlw+CeNLmDVWnApJKhtoEuEzbmIr
xj68WqaCHKA9otx4+Gh7xAXLhqnQINbPURFJMVawLBaQDPLFXDDPrfDFmqvUbFJtWbZ3cHDx/kzo
eyiE7Ihgx4YDbyCLFVxf1nbf5UrHxA4WWonsFyzS1JothhPrTib+5bMVUqXls0EZ/YqGfIMKU9Nj
zfa3v/40D1wGQfaPTpKu71DUc4F4cbuu21Wjk7TT6vTJsfJOr0v83yM6uauh4QkhQkkbo5N//tMz
A5TWycnmbVk8cxfOFnkxnLBkzC0WZ5yFS1ljE/FiJIQ+G23sNmMPqyr53ANMQbCx2xjal6uv4SMN
f44LWi1MiU0pFs5gfjNbCf518cQwLQrrQvj1kyiPS6EqrpFkJYG2dX1VZmSwTHZQKYSdPV2ts7D4
/ZBXI4546eZV4a6HLD1mx0iY8huMmPqGa5lydIB5mwjXXW9ZecVcAoHwvWuVV2Z/EJYhspW2WWFC
KTB7YagwexoWyj4jWfYgmERY9Eww0lm1yCRJC0vwVjpOopyHG9CbmrJrfT4HqCUiyG9wscs8F8Ra
Bf5Fxvna9tzHlym9nrIHqC0c81GayRmgsuElEI76QB6UF8o5Yy9asZClnfRezhoUh0F8L3C4mILF
dLGQ6BQHK0PuJuXWIIvGY6FSb6qDoHqZcRnNebRIWX6UpWkRCHmY5oAlTPBlNKyGOckPyylLx1Pp
6sXB7ZhnoDo2xGoavbM1IZn691VvmKID9OLTP2438PP91N+pTXg30fEF7TsOrmYZbnqAkWEb4B9p
Jo7cAva0xQJ+44h8hBzD1Bt8kFXCusWs+s7s+u71hsZf01Jh3XJWfQ+f9sf0XVmm7cJ+471MTRrm
NcOo+X6GmnjzwmHcfD9DIa9x9bB+x7GhzNC4ehjpluOaSqSMq4e1m5JNVR7m1cNa6jakpI2rh7XL
lE3JPOPqYf0yZUMKwrh6WL9M2RDAM64etpsp2xQ6MC4hxs2UbXKJti8x2OjblxhsSf1PGuyF7UsU
2G/G1envp44+1mEBq3N0dVjA6qzUZiwQBQsENl+s4IPo6J6oK7d1WCDqjnitZFdFu3aPvAJ7ooM9
UWBPdHRPFIgTHcSJAnGigzhRIK7dM+4ocHZ01O4o0HV00HUU6Do66DqPLzR3TAvNtZrTtNpce/Hj
S86dx5ecO6Yl59qfNK07113sPr743H1s8bm4RMGCq8OCq2DBbdahroIPtxkfroIPV2vLqMaMDguu
ggW32Z5xFXy4Og5wFSy4Og6gCuypDvZUgT3VwZ4qsKc62FMF9lTHAVSBOG2GOFUgTnUQpwrEqdZ+
VA1IHd1TBc5UB2eqwJnq4OwpcPaaJbqnQNzTQdxTIO7pIO4pEPd0EPcUiHvNEPcUiHs6iHsKxD0d
xD0F4p4O4p5qqusg7ikQ93QQ9xWI+zrK9hU4+82WjK9A3NdB3Fcg7usg7isQ95sh7isQ93UQ9xWI
+zqI+wrEfR3EfQXivtY7Ut0jHcQRrLlFzVSOoOoiwUd8JKg6SVDrJUHVTYKP+ElQdZRgMz6Ek65e
rvWaoOo2Qa3fBFXHCWo9J6i6TlDrO0HVeYJazNQcVoPHWnNZdXIH1VzVLV9VC7Ga24p0PIFq7qrG
X0XkaXM6qy+qy2EQ/frpTuw59WGdozRbzNLpK2vE4mhxk7OHpGe/nLtuveO3PCn4ZhD7IGHzzaqW
N3LC9CK3qv2m1mk0qd7YukwNBEJIXIiGtjcIR0cu8vAIEXhEBb8xbwiDKCnAYD6X20cnO9E/wUDU
ph6FHkDUdgBaD9Ucs2wU8TgE6tfLUT1P/MFVvI/I2jUZ77PLNj164siJ2EhTMi0eyfM8iuUjESD+
Nz7SI7M8NZTiO1+/2gXb9m61i237yOkDH7oQQ38LwRXILtLklYwEvWXJQ+oClVN5VnB7ClltbQez
X//j65LKvu938l8lnX3fQ8nr77W0ptJ2zPJJjYQghExSw4B5/hFkIzbkCB5B28NaaqjT7pO+3Dg9
VINp9wB5P0T9XUzTtk3sHrBLTOMdTJf5bxvJsoiHiDiWE+aeg+k9BMgDUucsXrLPbJPi3i+6qwpe
5xCNBe6msaDkExtbXT6s5Es1uhHV+OT+3jr9nKfTccAXWTrnYK7pquGyeLOCX1TBL0sXBZdjFyVs
H8eAUr0qyHsoyZuxoX+EvaFvO44kb0H1krzHbJBmn/Pqi7W1ALUqMkhJp90FWPxBsops83uNMzY1
2BLa9wC5cKzpX0Zt6Lu9svpNJ/0+LvgrS9hNG+nnnUChNbzn8MS76DObWq0kYTKHKk+CbbnS6TyN
bW7nyTHPrVs+nqdJkU4tccKsgsd8lMqtB42DMP+Pu6v/ceO2tj/3Ae9/mBQCkj7YAj+HpGCjXn2l
bZqkqAv0IX0PxkgzWsvSShtJG8ML9H9/JEdakTMkNSNrxcVrUzfraNabIXl577nnnOs8QmkEuyfu
uJKwQIMB6TK5KNC1KKqbjoGxKKRHUuUl/cyBalJsH4vNY7EtjibSzZpDFREUj2D5hGq7H8A+5KJP
+gOAhwRCMSBqKiYYp5yMR6QP6Gggbt6pHUqfmAUtr3BjfwdDl/G5p9c9/mcvWWb3u/W9TdEygqy6
onBpFQcNy5JQG85mhpA0gpECdc0SZDpGz9CsU8DpVFAQSEFqSwHbZFOa9mGvxO9dx6Ma/ftifMO6
ao+gp0+pHx1B/aPnhbxesIAFLbw/uv4+8nwz0E21163wZXnZ4c7LD4v//kHdsMJYfKSOvaZdQ//0
wWYd10oVF0Eih2jNF1ifRpWYYso7uaCzIp002BXz7fqMHLvprnhaJesP6v8x/178Sv77x7fHsbz6
tBqVA9Dme6fWK9z2ttMIiiNU28xxY8EBRDCVZyMF1MqMjAHFgBs3VilYA19ZRKlj/8v27RgvPrwd
wNu1cpz68L1cZJnSqWXeZ5rrpeOA7TNLlUV8KiqHfdyXSZGAiBDGhljeDAjeACAAYuJG8IG8L2DK
x2OsB9drpmt3uerKzGOVy791lFgX+IYnXBVPVAckhv67VoPJqFUe6DybdmCWFVOZmr+YA22zFdPj
bkVYHVwsThzcIL/ELokBi2BMDB1eNYgNSApkqinkf1N3TQyZFcOovHbOyv8vgn7UgI9WO6oKfLR6
+IRlYvAEQgojhGriQEFkcTEcjWT6oVAQ0qi4oPBMFOTcDM1a8YV8p3VFl0y0buSNo8pWZbxl5mNY
p5JTTmedFBUTBDLQyQlAjXZEq4dPWDq6K/8IugTXySe43+egK/QL9Jx81TEpJsd9wEuvmssXma+S
4fpxmyV/kb8Ws+TNp1x96S6L7rPdl3mS3c6T2Tw76dLoWAMaxdbZkTUJSEkfKgsFLT10Qs+AWTJ/
nMqCz9ZZXr7OXxV3SbbINstskay+ZLe32W41P2mM6NrtIIazkAvlp308xKk2g4SuqKdwLsUgfNrt
QLGhz8O5LoPyz5cKZalcdrBQ0Smf8mkH52zCJrjFZdfq4RN+jM4rLoa3hhBm7++p3ffq0AK8eKD6
/U03+am4K3Yfta2CEmDdr/TXxof+8z9+d7PKN0WW/LZeJeP5arooVttdMV/Jf5K8yWbG79Q2I+JG
lw71oAh06TjhCAvc5ZjQ49ShU126MF3YXlUMIrRvhDV+8QCCXTjelW8bCBtOY2rul+dtC6IAM9Ql
lIsubfqyg8RrW18TBYF2eOFDwYf9tMtlUcAd9Xx5MxkVkrJOZj16Vj3f5mbCyW1xn2TJ8MfXk6P+
N8xbtythwBFFMeDnmtFCA/h5BFANfm5VDH8t/GzdjwpseLofqWIPHAGcE4aDrsDCcAzo2TF8DKDR
aERkJqw6w/U0rOwLAyNKQOXXhS4BXp2XG5Tx8PW6mh/IfxVwkwo1/IvIc2tXRbBsgrKCdhjMCE1T
0JkxSJqlDm0ePmFN6CKD4AjwFHO0QxEecwZk3ONyabk7TZT1nYljEtqjZxXHvzxM1jK7nieDbabc
Dqfbx/3vvJuu5fL7qB+q6SnvnXVt8REayrit24ZU/vC7L5tiuXStZ/CjJ/wMXf08TK9vrICMsZEa
XpYln8nRIejphCbfDUZHB6/6a5f/13169bNNUWiLkEow/Fx5+8l3s8/5H9oSEvQ2e/ojtOofQAoh
QcqpXsji5N3sDoKu/VOc8Dd0Fl7s+sHVmUkQMOLkRp4oLM8Uqp2osjNgFl7KE+oKpBs13ujhfu9T
cdJF0PWKUxyBwVZvncraFgE1nITr+6v+isugxa1XDPS031j3F349XySyZFoqO7ZKEKNwPBqpzBOq
3NO+wXJdv8q8oTMrMjFFuAWu1+rhEwaGjt3AyfVrX8i4i87YxwOoO3HcQXKr0xlLs0N8zmZIittl
sX3sZrrUfTf9KC+RtfzHZkGuYqYMmZ+LyXqZZ8uT9nuunB1FKEGxcKUHY4TQjQbsPE1OmeaYbSPK
zyyKLnLO9lyoZFnMN9m2li7WLFkhQlD9CkAXE/Zky+ujIav+iT5VU0RZB0wzJEir5kubh0946Tnv
QBzhTApHgGaE3QDRxRp8rG8cTeyAqUE8JarAOC9At7kDxz//9I+f33/zzTdPFNTkbp7tDI/Mhqpm
+7imNEJ9Ler19Z73OWNyX80mIgcT1qbZfA1OEedQ3t46O6IWLG2d49/mu2wp/7ddbxX+oXBhI5pj
g7KMUA+kaoTVvkPg7lSH9ed2p1qQGGAJNuE/uVKbbFXsku1u87DYPWwyZf6937Ef14/tDkiWZ3eL
d3eLhb6olJ1OdTmfcFhm4LC0p8J56sdhAQM47VI1WUIGgYbYYFOZv10tkxhcb+cBS8tmqZh1Jiif
FVPx0g4YFlSmkbLQtZMh63jJj+eK2KpMBidzfdC83XA1oEX0MAlTQcKGDNUWWYxRVg7bVyrGAN7o
V0V8mK8qOo0yAp5bqV0ovdH+dMtk95DLAPnHei3BhiOk/o3UzQusWkIBPLIcmHDYQYLOiLwdWshl
2jx8wiTPeYHK5Ov6B5xYNlub4nYur5sHWSAXl26ilWH3T+vNbzJ+J39e5vPFWn2s/I3azpOpkcl5
pTIU++KwXGYsGEq7CGPQJY3DcEPrE3uZGIywSnW9QCsCcqQw7OROexnPiQ29M0NUBFXbgcAT4Tdo
TlPpQkQgwCPqAMrkwg3RuKtqLtpI9KELd0jPCb8Ne9gN2uHyQ82ZO/n6Y7b68ngcEd7UIsheMiEi
pKTcoVkouyITOmWdgmSEFeilnTtvH9fG4+yuqnHfmyRYpEYsIXri6AV9nOzSIoY3OaD/9uI1yuc1
fUpo7K5Bs3NVrySOePP9XoYenopTQjAUIw3BkBMQzPG1B72xKuKOGBNrXcdnj//kNO9MZ4Ig3IoL
fo3j421eWMen0kowdpfR11CT7UFpph06Pg0NzCr4KIvQPq2XEE0IDWPuJzQ0WdEKocG8xJI3WXmH
3Rsf096931YW+tuwDsAkPtQQFgh6gBsjGw+S7YZmcpXkI8JwGSQcOiuKNFKWp9MOkxmR6gq/sKPo
5cpaR9HDXDUaYfYEGjWAEYbBsrDzX6UlmMYY9pCadZsCMpTzfpbcb+evV8Vu1bZ8q67Zq6SSG75K
DkleBS8zeYu694FDvEWOIe5yNR5F3ngNC7Wwx6IdFUmM/iyAjjQR6PIMgKKTTybTQh2u6QTE1DxV
/WfaERsdZCS72WyQpVRGBXv0hHYqbIxpHzIiIgBmLgUFGPM+UEoaNf3dA5hh81WUnPKv7QdeUDtF
01J0zWmH4DTnM94CBWv18GGdg+6mlTw1wsxaTF3iVkH4aNhFsojyyzRMMqwsy0l5r8QBRovlqngs
tnVyBaQDyEddCpjqVtiAaKmEIznqTHkGcFBpXQNE2zx82ApBF9vKkecRxHMuxQ7spxSNSgJAE50z
ULJRA668+la4W293yZ1MXte73cf1Kplvk4fbLzJPekwWc5kkqHZintzJNUom8oepY+iwL9cRdYUW
iEJryxANO05SMenk09kUsjYYequHD1sm6GpsgwuYR+CMpK4qV+xBIt5J1UukLyy1biZNFwOvNH0f
Iod9pllHwBIT2n1sy7FHJ+t3D4t1Pl8EQCeF+OMT2UPQyto2PKE4giKNObJCTvfS46KDeJ6pV/7C
DE8QxaM+0LeFaVSiVbIT/cPLXLbDKJ/NSNjyBNHhiAC5PdR8Eu7bHh6O7f+GdPmI9hA6sTuCLuaV
ZqyIIHZKHd0AT8PE0xYBmjSLzyIMhUBLqyVzeJ1Bx/eK2CZCbxsxh8QDC0x4qlN1WHud9dYK1aK7
sxL1pq0VjzzQrw1sa492t5u/3iaLki50MKgLWvHba4djDNBzwcSglK0CJstnziGevDyY2Celt8Jb
RbducP+EBRMDYuAm7pAWnpdghzSeRljHeiKERylhPO3LM0jkW/JIsAGxkFaaGsjBc7Eg/zX+nNcK
7LcDsdkV27ej4e7tSGw/zFczNUl6N19k8w/ZMrtfyN++f1RmT7VH5ec3b8d0+ZYO1T8/rFlwgEWl
3okxNBbXkhQlLUCkP+y6mOR1WQFWUfM81uqJHvKrVgsqaxuFgsrQIBNMmajeJjNlELlNlsXHYvfN
cUWC80JsiRON4qAEXE1nWto+F6gzIWg2wTJvRHxv+6zeBoQ+GPH9Yzbdvh3fbOYf/qKi4Hqr4uCn
rfrth818T4rcL0lzpyTTVFrGLloOdQ+Fr4ZTWCoKixijrB1nAo4G/dGNjPYK9vMkZ9A20MHEoAxe
2I9ABqAGOYeppi9uv2wf578Zs6ybTrqp2HiK6wPsSNSA2FbVSKQMwVNKtSyAajpHmS1Q+dcJNmp4
NFGlAIrgQICRI1sgIzoYM/nGVE4FaqfsfbbTr+J4+6Q9JK6QLah1ql/4MldYFI/LYqcufBtkx0jv
zpxg3KEMsiKV+avAHp/+CkzW7uHDegfnTFWopiDCTPTUEVW5oDepUJJYBSd7skNoTRCWu5+Ic7yQ
LoKsOkQZzcQdrZUpNbS9zcOHPdFwsFiVKhThzsU1OKTlgIIr20bu5zGYWi5bBKhqOnYiRDcc5WZf
wDDC4UXUcQHD8gIuKOvMUqhGdINOMeM0L3L6Llvl86dV+X1xm8nX6RGOfsUF65O91v0TLDWqx+ZS
FjIEGEM+3KsWnqlnX6wIRqgfMDCpITJeZctddqfGHmd3813y9+H7v34tN6RKBdFzzb9ss/yuSg+B
BmApb2vMyujtpvFDLIi6DuT91IUENqSHhCcY2lZLIoZg26Ep9hhZhnjfyPSoeq5EZ2+7eXizwcGP
la0uro9eQO5QNBHMhlzlkGq4Tx33rVtcKiH8FXLIh09PuprD6204NLPC+4xREruu51bOgte+nksj
RY/Po1LLAhnrTwT6hmNKK9kTiIGgu2SabegZcXQKbmKKl9diFIHEyrXA6VwrPEbWzrBYBIP9sh+4
T5cavEpdFXg0dkE5jgxDMvH6YushgAHmgR6gPXjqdQZH7trCZRQBXCAuCE8M+XjQTQGySC1eRpey
exM9EI+5V/kmu/Un+eS2Dja0G5jhoXE1e/iw/A3HKVckXBGI0thhwdiOhhSFheEhYH01z8u4EJld
rqY9ckLlFR6LXZ3zGGGpXQgTFiIdKwWBckes0zjrUn9tvUvOElheBGFy+hI08Tdobc1QCwRtHj7s
ieAc9GpmFOFaZcwsho9DF883D9nXtdiyBqXEsEWtGQgzlnIKu5gRbUbesK4ND5CPb6UJHcWXd1ii
Z14k5D0iDEiglZXmdr1IvleDHP0zf3wTJc0IB5PvPs5vP8oU8w/Hd29hCiyEKWAUYayjk7LunTHm
GSVWShMiWtqa486eYe6aw3yszcOHrWCBICwEghAeYRC2c8gEHN4Mh7SrqUk+8hsQ1oRPJd5izw2C
ZPJmU35jSb5e3q4fH1aLbvc4tZNZgAgLCoKAiGE/S8JCcvLE+r+MkHwqq7kq1npEdmtGf01U5k2N
/o6LYsEgrCEMAiLo8FDdhu+gN89lqtRhkMrkpglN4Kq5PsH9ARvKbI7K5fDCIHfF7eqLPDwPC8MH
bb0LUAohPanAYxYqwoJyHByB+OHQVuCRQHzE+vJ9EeeYgrJpbCh+FaVQGblFaxp79MnNtM6thdo1
xV6bhw/7woJ3WHCAMuMR9gWsz/XdG7OIjE86KJ8Wk4l4cYrbtgJoaxu5Rd7GpseWABfKiv4Eisfs
Oc7hOT9phOHlyCGSQEOKQV+72xDHCLMS7If2lBJkdHWjjTCTWY9i4RUrlffuq/zjUljgCgt7uUQY
Zeak4CFtiVdMCezQyaSAk1YEjWvcrV4TXpuC57XENf2z2ZGlDqiq+Omp42WBIywMjqAIRaRrZhpn
4xEEXTWE3q9vt61R1Hg6dIXb1RcYx//sVSHxdqY0lSuz3cOH6esWWsObecGkFEbQSrm8YIgG/yYc
TTqzjHDYiGt1XUjcV9LakIK7wDTKXlEd8XtKaMotLIiHsCCaXr8ohcwx75XCcX9A5SWpbEs9xEpL
xgF66Fz3glb6tPkqL1aL41xJbqErPISucHr9zjrkDgsQj8Os1aBWk4+eajHYw/Kvs8ZKtnm5dWvc
w0u2cBUexFV4DMkLdCnH+AhAhZdjed7raOaBx3O8iIT26HoeilS7UbWGSflhBSwQhTcEUSiKYWZU
my8ig4gGUUQ6JZ1shgoNory00grL+hmALoQ8bTATs1JZPchy6k79WbYJuGVuBfQo5BPsUG4hKjyE
qDARw/DZNa7J45fu4yIyhafgs+xNLiZtauRBq9TTNV6qYXbt6LQeltECQHgQACEkgjWVcA15v6HD
AesK32BvDK0ZdogbrKk2i/jDWh6VPEt+2My3j7v5KkveLBbl7521jg02xZ/Wy+V6q358+eubTx/1
l/6K4NcH+XMn95v1ZFncZYuk2Goe9EqhqIoDXm+pywz4hvf1bcMsfV91iJ73g4edY2EqPIipCB5B
h1PXXQEAS0KMjO2daV6QYpYF5mRFiO+ttCClMkBAOlZHQa6TV3pniTjqQ7KUg10Pngr4FnDDQ8AN
hjHWO3XNC/NZs/gkh7JQ4gZh9uoQul8k+Sz2NXUUvdXDh61h4T88hP8IGKFwFK7Jjb5mlI89r9FV
/OyNY2/7a/+uhQW/iBBZhqcR0i7oeNdciMGInfDGMNWPqbIqx/AcqK1fTB/X8tdsJ2/ryUR99RU2
M3/tJ5NsszPwa2GBJKLZTCMaYymoaym8VmZ+t0dMjP7KVwTEX7Zvx3jx4e0A3q63u/Xqw/cyKE7W
GxUWK7QmRe7+2/s/v94+3N+vN7vkzf5vDp9Qvtf9+UYucV8eFZ3wvJmoryfviofN+r7o3m/n3en6
Tn+yQdrlzZ1PGbtd1myuGo4v8A0P29aCn0QIfsIsguE6xo62C5lpoiZOpx1O8zRXbZevEF6erbNM
9v9ppAVN3iDGcBdB1KWwC+VbRYoLiQGgmNPu9teH+WYjK/bPnz93zxFyIkMSIqMkBQbg5s7chIWK
ibD9MH8RBoLKqk6/QijLdaR6yBSotwhSDtMU+96ih3ypsjpSEiMMxpL1yn38yXJ7+XQp+7BlhxwH
4VijSlk2FR2cQTUJVOVUMtVXOdWtInY+bp370csyNXZk82/u2R0WYicaInZpDCIuqmEBLX2aryzO
8xJSlbMJOwmxCQtiE0EpV4qvL5aUBacjwaDjQZ9pbq5flYqrHqjorAnNXmL0q2D2UKaBvvzh8B2a
IXjexCGUNBzW18LeRNC5hsawC3cSbgcAMijrTsW9rtdNNY9oCHskjTmO/f+VR7SwQDcRNL8BMXiM
LtCNaWJenlPSmUFCJhMSPURXQLcWCm/dF+3jIdYKF7mnvXONLWl2yaJOLWk2aHAFWKCbCLr7YhBj
vWv8RIhklpvKzE1mbwgSmblxBSILLgCWSVwwcyt9r4ghm1Ez2Z68ap2Zm5pndJjSEc7WnASb1pSY
gbh5osS05eKYz3oW3ILSRAhKgzzCJHJMa5yac8od005IWEpkgnuABpa7XhuFF91fElbjcRObn6a+
PK0qRt9eUK/A2Az6yybyY84iMFiZo5uOWSm0pLNOiooJAq26LdcZoO2xp7H23N4sxm9Zo9onJ1xB
5WVvL2Yz5DBK4odcrRRvP9BspXBLLKr9UmM3XtuDvpWmqrGEyF7CoE9QGuEU4tTB4iLpkN0Mugwo
Q4h6xq6DMDAVNVi53KKzHF0vk7H7WiDN9EStxVA18WSbh5/2Brb3RjOTIyro9ZM2wmpJ+gWAZmf8
boH56wj+rb3NXKMsFaJ/4k+R373yCe+fq77bCaxg6scKLtxrGJ0zRAaIHiHHnMnYkcTekU25eDyG
R65LdFEO0EUycQLTDClk80WJLr5ad2oFvbrI1SO/VUPiiRGefekGtVc/hB6KCMMwIHeASxSORyM1
0Buqkd6N2NzKaPHZ3QLx6/kikWnFstgZbzi133CQO0cjGDKW3LkAAfQaN7u7F9KQYftV3FcZCn/X
9g90jHrV+CX0eXkqpaOsc0SXY0K7vKHjiXKIsfZO2MWaxBCeOrQzgO2Fp1lnSshMMPby2NGEIyxw
uRwt2dGzbDnXY+xfJbP15uFuHVSdmrNOfTGY26scdJKKECBQ6nBsRahPxmooimrh1Ou8OnsQ9wg9
09mmrTW9OdyhitL75lZUea3eDz6tmrBXLYjB0SgO8w4ViVw2ypBcNtZ82eTVGW92p0fA1kwM11rJ
V2u+tHn4sDOgjcfBIPkuxnC4etBWuM1NKkiXahcJHwXWxG2Y2hjwuVQPzeVFJaj/em0AMNDG0GBw
NBjBEVaAOI4mFjLUqNFg3O3j4dCd6EV4pgF97QGx35Saf1csZPzVnVT5ZbKYb2XNsvkoc+KtkRRD
GyKDqFnRCUgMM2EHnQRopX8+4bCDBJ0R0cQx86qQtVeUWSknqxJJk4qCbf8cfjqVgTa8BUMkMiST
R3D91pRnLN8IYxX9gHPWaH0sH9ezRp8n+l1/LB+ENggEQzPpYQwZpnMImWe2jN+bAaleA03PIYxf
9M5yjM3RKwFp8vMP8tDtph+T6frufinDad5VK1QPj+Nldnur/mZY6I+VAVN+uclmO72q8lv962+j
v/9489Pop3+0/AbJ//zX/7F37c1tG0k+f6fqvgPWla3apCzcPDEAL7sRJVK21pasteRYyZ7LBZEU
BYskdABlW/701wMQIgaP4RDmCpTLqqRMgsMBON3Tr/l1Nyy7HBJbN6NoGsyzJxHE6p8fnp6dyjcI
qLcPs2e3A+75vfvysCfpmtSYxQJx950F12PZcSMY5kYe98/PLEHfWSfwPMFAPsJs9HkuB8NSOMmw
18BiO2+BT/rvrFN4zsG8sDCqqlfZNlkFRdPU6plkqCK8aMVcyi6pDZSmzWyUXjbaoWrt8IrbqmWJ
KgaoOVfam6nAgYq5CtZr7WHyQnCocqNqPlXV6ylQ0B9VNCiIKlY1RA1q6lcfq/G5qvXHahimigJY
9eH1NMCq61jb6CjlX4UeRE8PotCD1B4ep4PVraGnDFEoQ6ooQxTKkCrKEIUyhFcNUehBquhBFHqQ
KnoQhR5ETw+i0INU7QqqUIHqqUAVKtCqXUGVtaekaogqjqpWnCorTvUSiSprT/W7gipUoFVUoAoV
aBUVqEIFqqcCVahA9buCKfRgenowhR6sih5MoQerogdT6MEq9YOqIPT0YAo9mJ4eTKEHq6IHU+jB
qujBFHowt2qItrO9QQN1g97cBq2gDXoT67vo5obU9XXNDdE2BzXoJ6lvL5gbUtfiLmcNaPup6Tt8
VVoXdU2rKgfXtWDKDTFsA2TQZsagdcpa7TX0bRkqB2vr9RuUnddXR6+6pb5+tnQCRJ0ToLN1C1HF
Fvq6JWXU7l2cgSxJMQCnNJxtrIz94tgN547dkoa3tS30qHA9iVSwMcaujR1qePBm5jOoqTWItwCn
LAO5VkJ0iOgRIrgBROd2frnj/rb329vZSS8m8fgTO5hd0GN0Qdj4tfvq6o+pd/cVCJ0CpGUeXo8s
6Vr71nQ0u/Pj+Es4u5v5139RMQ5iSX2JackX7F9QT+fGqfXpuYdbCCgmyQ/5BlTXQRh/ScrtbCit
SZ+0lK0nyjeeILJALma159ewUlgwGxPKuU1Me1GaOcxqWNBro39EFSIS99we6dlclgysqqxbahqQ
VEFtVvvh77+9OTtosttKJZGBEqNpg4xzeKcTCutnnK+YMGv6axQnUbUbcUULOQ2NhC3lPWGAhzyI
Rneg8iXBrF8v4c1lUZ4W2GaFQC3gKfrpHd8fAm9E8Czvfdk6bTbxk1btNdIVM9n6iVamHuFlxyNN
8KqAdG6h3xFNarooeqaxvG1ep0LZOxJuZKSkKSIavsnv7w1NudAK+bwq1KEol31W1goeI6AMMGOO
Y68s357VgdaEM9WNLnALsGdMiyyTtoq2LvwPCwNF5v2HEzBR/MlftpyJPLZxJtJOuWgHhnNMxDso
X32i1A7MwRwmBaPCo2BfCEMuMot5qzY6Ey2cXPFSXzAz7Yn3ts5Gz9kX1RWkwYwEWmd9uZcoc92p
Q6EYVQtoDF6Bb8P7VDgsKUaF6/AwSgK7LAHasHnYf7BAgVoyTGavj8PZMBFjwcIYmI8mOVSb2eFP
AXnaRgUxXjoQXi29erRPqbtudsopyOTLSBpMd+/3/Am8+BLLPRX7l5E/u7v4OlNN7qvhLK7IHsQk
ByX1ZMN7zguurv78TaUSvHp4ZcrcIrZc8h+wu//lngGta/9mEIM+nc+XibpfHSzSJeSY7K6nOZCU
zP6phUmpnpEMOnnCw1jYWPa2BG95hT4rYpPX/PoiKMZzhjtNirE5tVYbIcKRyHhMQcCZxsRMz3HV
ms7EaSHAIko5I2ZRMb59UbGVuyVfyyrPA0LWRkS0KC+05+uqJgb2aCOneH1rKXGyu70NONlrkWfJ
Cm+u3ziH/d/jP9/y6z/PD8enbzn68/yft3+e/2v8x9uoF77l8R/n//r70tkuV1NPnO0lnDajlxbs
UCgeSVqo7eSJorO0iDVYWayh6PIooYd1ZL2OfA2cI8k0Pd2GX985WjllRdw16Tm7jBmWPWwE9xGL
uCt2TIW1IQJGdY/gZg/PQazZEQYVJu7RQ2QZbyoveL2gQz7VEamwfNzBblGOaEFO6qEI9R4+/s6x
u5VBl5UVZo1pW7ISPe4JxJxF2GMdI9E8UiPqI8/JLGs/RkV0B8u8LlwrwDwHUaCunD9p5mkqwLSQ
u0LI4OGDOmmTqXt+7R2fZv7bOnypMtO9KU8Us4Dns2xK59ueoEzWGJO+AjENwJqCFQtw/TZg3+U2
i2amPO1vgXb4CumvwCdqbHwZE8AdhIuy3hBdqnbeA0GwDQWEDB01sRXUXRO/kLZidVQC5vvtZegT
Q8Sv6mk79OGDcAw3IyD1UPuedlohZtVNkiIx2aCaO26uDn0TGzBNzcyrZJlznut1nrGVITZctQZb
Qcg0hjV57bPV18Oa0s5qtBjrNYXrq/QTsGItBOdLGcYbOJ9uSbArgIEcyZgSnZf9gFjx2EufNFFo
m9ZCpBSU/iOGR2w2eLNyygp4BFhfXi7IWgGPcDijEh4hsE2JKfpUm0dTyF7nLaDlmFuK+n3L3voa
yAidWdMQbKGbssIdZ7LrK9OBLQgm3sIdX135JmNJbd5WwU9so/+jWF/hJCAL7Y5/nLUKv8LrLOE7
EkWXRzkkLbe4W1J02qS9Ag6wBYuyBt/LCZJBKeAC4IPV+F7cYaRxj4L28b140/he7YQZZ2hzNQvd
SVqAZ1VzRn/vgO7bDAlZDqe6OwlWazsz1CGNOppvA2dQZ8OcoZ0w4wzDFN3221UQvn6YA/e6+8hd
7Y9mx6VvvkxG80CWtJ7ezoJrfxCE1pvx3eVoAg7jZAxCPGfPgPiGeb/Kq6mGHClH0l5Smbt4JK1P
li6UmHdaOFB0S8TC1HOre02AMmrQa4I5ml4T6trquw6UEWRrbrbViLb1pMHq+QqFf6SpsTSzK3a5
aeK8GrVwSQteTbkwkGE02iSY+e3akKvOwPNAOktTbmwzuCcmNfGyy0LGhdqKDGogHbVghTBcylPZ
KE7yoYMzeihdI09YP2UFClKAQaZFQTIsiIRZUscWpo6wvm5HoZ29aKHxjucUAbePCZClTZVrBsjS
Trlgm3zwXfJMLuutXMgZezJ24ngOsh3TPFh9LRdV98FTf8fxrcc23e7G2UY7ZUX9b/AAPX39byG4
Z7tcdqk1jruZFvgpcJDbhgZreBSswSh9Pwr+2qNg5CWpAEU4oGkpqEITmjaai7JSbpYZW7kmAKD/
+FHwlrEDJsALHVKyjrXFvordBFvIIqIl7dS4vMzXnS79Z8+P9Ki1ZlazdsqFHnMUq5nzHCSppMco
AbOW2tR1kb0yNynjL22lODUGjNnDh4wIUtDHOsjGZisZqVgwhHNbs+yueMJxZQwLDAgPm2ZtmVbg
K7jALUDAG2f+9FcnAmxT5k+hR4jsfwj/lfpymVZDVKHQXgv93YloQLiVdQTaQWs1VKsy27KsVk1r
VBbTdFvIuuPNMib1gJl2SGgA15JlTXiHouKe09cJVcnUSmkSVMqS2ZSuevAAobYCXTNTRztlRaQH
uIDmQsVlU8f1uEdszj3HNnXY9XVkVS3L2+g8IpT44AZhW82LWKxM1L8HOuUT3RyZ/FBvL3mcUmkv
UcKETZkp+bQ1fgvFZHALgpoonlDaHmKl4nq3JiVhro9+dHdPzbH8t4SCUKjhSthZ/V7yZD8+jy6o
YbyZDMspF/BnLSRCNKlGkuLPdGHGlgDPq1FgQlKblGxW04rWarQSt5C/17gok7ak4bYWZWLyJAyV
QHv6muIF0F4LtSBAZBTNnRKywkyifTXIZn0jZzX+Z20jZ/WUFecSHviWunMJjgSVPXRkI0yCTTNI
9bXmC/Vc8cP3PmxcHcoxySBSamu2UB0q7dLoKA6N7D4rig6ottx/IZGAteB3ggW8pbCHNeAvK1IO
YGuX8S9wcWUpqTWQERtPO9BPWQG2kCUAtNFLSl22iF4K0xKP+l4UhZBlK+mv31E7m0ftUNIh9fqK
gNvFvBS145pmVOk7lhSgh1y04D+4JX2FmcdtF9mea1MuGxhIyKrjCYYJVyGr02A2nPrX6qKmOiLX
KiE5XeggXoNbLXgZiWf5fu/GPoG1fD8FxhuGScfBcD5/f3jyfgCvp2mcDZgwDt7PR++WQJAnGWOn
fJ5TcYt/7TAaZyDYMu9XN5fU95RRiYhEC0fV5WTK7xialemURM1d8zqk/uxRGqkOszFzhG0a0dG3
GVItVY4fHnnFXKfINd9zKVfW92pYDkk3ZW1Qq1YXpUEtLw1qMWNdpG1qpRZlcR9eimFXOWM4Om/i
b688+YZFzcfhMQatX1vjCJQe8ohNBLinpqajvi9YYZXZwyv8Ik73kSkL7Zl7M2WhnbIy/i/b/9Q2
rPHAt/RcZlPZmYCYwiX0veJUOJxDHz6PtTnK8qD9uOU3i7IECQbWdanYrr6roCqDHNQCrO4bOk7W
VgRr6LnqpqxAzhFZwZfXd9CiyOOe7KAFRDc2FrRdJ9UIHmjKFlBbjcE/JiXcHgX4R4bXO4gVN7+2
Gajqd2DRxub3vpnNry371RBLYnDMkseS4A5GWiyJh128wJJg492v7RarohG8FnyF5rCx7avTZgIb
I1LN4xJsTN+xt6DnWzjrRiWbMWlv0+3L+CJFCDGj9jYc506YNtWkY50GNrmD7mzlDRshF6B7ThsV
8Zp2gXqMgAOwh1mHidJGMWxFXQjIuy1Upm1KLm3hky0hV7l8TZIWxIuFhPXNwNU9RXgLZUIbl2VZ
DbramrIsCbFILlyGXNlijRXLspi2ZVd9BsFbEIWOcmr6kP2g1DCBaZ9kpSC7zA3v8Npy92s2b8qI
p4SdHF3YSTDewkF3g52W+tAm9VwfVdjpMdZE4R3qlWuiOGrrXl14yuXsMbXxMunwt5VtvCorxOMO
KQK7HCUs5Aiz5DCHPqKsPu3Z8fZl9ZWKpyFZh4iXtLQSFXLM0jFdD1bp8VBO2wFr6yiXSksFhAA6
nuGS76LEYhxdLIa4pIUKp7hZ9TIqtiMD4eH7ZElTrhi1FUooR+hCOdQlD49rZm4JY/QdLbKyiszG
m2dVVd4GVc1Fh9TWG1uv0VbGj0qASxgGuOgjCXAl1to2tnxYol7yLTqQYpdxdJ9SsySXEuASOrAZ
cEML8IHvhfsbVAtqJj60U1YU7qdJcXFeKz4cjDjhC/FhWP8Du9arF2BozQdXFqzPzQQczaEtObUs
Rw4m/ngsX/RGybBUssDbyL+cJ9wNU/37pP/6qHvcPz5bcwLrf38BBpRDYutmFE2DefYkmFr988PT
s1P5BgFP7sPs2e1gG/3efXnYkxwOvx8xLJDnvbPgeixZNxjmRh73z8/AfntnncDzBAP5CLPR57kc
DEvhJcNew2bbeQs7pv/OOoXnHMwLC6M2VFc3cFr/WCl/XDFALfVXMUDNaq0YoIKQKgaonnvFAMU/
FBUDFD/ErRigmLtexQCsmEoYVQ3RdqfXdxXPDdH2rIYhIJhruFxHzIIx10LhFIYkBjCVsP8Mr2bW
c+tsFN3E88i3fv1wNd+N/emFn4PKJ4NeTQKQKDAgTF7sfoCLO+lrGwROFumUX11OUCgJ+u9T+cE7
620wuwhmQ8u/nV+BZA8Gvtw0tyC0YmvHmoXWVTgdWcMggm+G0V2xPLU8PEAYc4yZy6i9j4XjgDaP
7XgYB/PRFYj9YDZePJViGpwEs5H98vjcZjZHdjoLQczFDrKxwx2xI7syILQ7vLHzq6BUs17r9nn0
Bl8efcj+e4toOpJZEc+OZFZEVupcs9UL+QZtFG1BJYuL9jHzqNu1PcRAIeU7F6zVlzRhnkkQz2O7
ioUy9vl05c8t4Byr28tC61Yws6iNrOnIn8W/qa00iLLsFFcUotOITnW/0hbaHpGkDF26kG8mUTC4
sl+EV5MrPx7tznfC2UQy9XAET598aGUf/nxf7b1iWf9RszWnwTjyJf9a8zAlyH1F+lsZsaDWkR8t
ju88aTqQ8pmEZAkEnIDwgFxi5+KnS8HckSDoJxjo+O4A7d5eF/NtrL8dh9HUnyy3gU5fFbZBCyhG
EAHFbSAhDfI3X/DBxU/+xWDoEYZ+cjzEk98czAbSQJj6wWRhNS6ylrqT0WfrReRP/Sj8CF6CD+8r
RmuJqUgo7Had/T7BIB8OvB6jsFLwEu8Jsd/bx32PcXDo3d3nJy/6589wHSsk01sSNCh8ywdx/SkV
26VEqVxEy8ntNdqhTsoeJA9Q0xgZ6iEhbyFujMutYWV29gHe79oYuUDfMmgljZ7nQCuESFTWMsiz
lgy8i/3hNLuYo8zpaJ5sy9sb6zTdllmEUGOUFVy/Ngr/8FKuasZf3aX2lz/MH/vBLJ6DKwjmwTD8
FMvFRFZv/7cCQVhvnx/w/b7Y67rA3WiPOAcHPa8rPJcc9AlH2O2xg91k54xHsxHsotlA3XH7V1EQ
Wyf+ZJocgA3kW/smebubfsVkz+U6dbAcqsHrEFlU0doBfsn56BrTuFC4oIVC3NjzKvledjBhYO6Q
inZElXzv5rqGr5UsUjOqkGS63A6JcIJv+FYvBFLPrKPR9GIU3a+3ztMoQBhbsMGp6y1tcP/OOovB
svbvduF/YLLB58WqzG8vr/2J9Wv6724cXs6laVwyuOttJsXsDj9ZwdQa3k4vCrROTVokCAWzFtld
jMHv35WVbifSnC3pF3CIPY8TClaz57FlVmT6nDIzGJ6xhKw1/t7/WJewMlbFr7bCWcp3kumQeJoy
HpiDso6p6CB6cgT7zpHcl2NSoWgliZxGMErkdqfO7SwUOUctWIBJ+o3GRF4wEhD31w+DCRiE43h3
Ht/O/GkAcmxa5QqBzS66CFNQazLCgSvGlwzv7nBovQEvzTqLwtuLyUhS4/Roz3rZ655YJ7391FjY
wTaeDq8V+YhUAYlwh3oFAal37FU4ayu9ClApdW61paQsuUB03xVICOF2GWGOt4/pAeofHHisiw9o
F8H2E2J3djeQumt6gZgthWF0A9ppBAopuvGH9jyYjpb6bGmHzRLrOWOFoT8LRhP7gx9dhKPdwW2c
RATll1I+qjIxn1Zz11PrRuJEpruxdLTC4TBOp6neX5jI4wgutR/PE1cbkinkRaKHP0agaCmPe9Ng
Ht2BvxNdhx+tX68QY0wWJom+gA7aAR0D+wv8rYWInvi3IBfnsGU+xbsgriZ3cvdohXM5JPHs9BXI
QsaSkARysUMEF8j2CPWyiIQ/DSO7/AilPfochDy4bqPZZRgNRombPJgE8ITyKphVs0noD5PLN1F4
GcAmTmUtXEiDxpoenBTdQ7Gtvx31cyELfTxNhRUw0C2tV0nIqcWT7tHTRHrJnfs227kLXghG49B6
LaNcPhglUfJiN/IHsQ+7wB5ECy4YXPlAk5E1HEUR2JPyn904mIazeCcKB9f2aHirV9iqoqS9gz4j
vZ4tZItQ8DnKcxUUMvU8l4MFbGNXeEKW7kg1KzDK7Wc7fW4bBMnHfyRnCQY3KJwEgGcrMPdAczMq
G/mK2hvcHzMIJaddFj1FmXLO2EYbY1XFQguFb7FTbRU/mDe4tjtI8PafvKD1Dl4wdbQHL9XnLoSY
nLsQKkftT8J4VFiuvT/61stwPJZrHN6CPCdMDoVL8E4Z+8Mj+ov8T5Nw/N+Juc+wu4NhjTnb8TBz
7GC2mXtILoc9/oPUWsLhyr/wJ7MOf4ALTAgmP4HxzMHoBwtt5vb6PzCE/Miyflhst9pxqz5/pH/p
1nndffvy1TPr7BBk5Fn36ORdIqh2ENsBGYtxB/EOZz9SSyop68kT68lfn/zXjyz31pYX+PLC4fHe
q3O45IAJkewxuGJHfjCEayJ/7WMQ3cZw0VUGXu34s1l4C7oMPvLyH0nTNClbB5pDaojLRLDhzi8g
96U4kmfNOPcJ4U8pkbI20Sd59ZFKL6lA7JN+/0VJi0gb6Cy09gfWQsRaUpxbS9lvZaa2tYx+Wksl
bB2D/TcGt+gmtnK6/Od38hHJ/W+SZa3kz6G1P4cpY+2X0geX3+C133CUT7buxwv1Bx2Hs99Pjp8k
IIG6X+TlP9mun0PQ/c9J1JzkZlC62bWX0hp6kqgf5ZI9CK6vnyQKp+ZHg37Jf+Jt1882FBxOB/Mf
CQePAzQq/CbHmiQK83FpyW/3T6f/gUwbuYde/zsOZ7ig/zki9Lv+f4i/X6yXYHmDEf9mdgQ/cDT8
2XpigwI/i/z46onc5ovP96+CyTCSxnxh5OGx0bCFnqu7373ovB+gfHwKPpHRbTJxWz3NhT+4vr2p
/RhE4EcQkJrHPBuBmQ9D9E9qHc5H01gzTWYeJc7GS2k0qb5G3bcyE6r61vD53e1U93F840+1j2Wn
7qV+zL0Nphkz9EfTcKZ9Fumk6idR7UDd3cKPo0E41w/64H/0dyZF/iiPy0xSzZCL2/E88v9v5dMP
wZmfaEYl9s/ecfdk5ZiTk8Pu/qpRh/H8oz9bNSozIGv2gByS2mPaWe6tNu2o3vHpqiEnp4eaIYqt
pB+0iqEWo5KQ5sphw1F8PQ9vEjdnvT2a7mxe863HGnRxPMfVBV0IrY66OGZg18e7LC5qEIsS3/qq
CNFgVdzHtipMtyrHp/3+sQXb4iCIQAzczmKY0tYuGtUtGuXVq9YETk6qsNzKgQ1dDSi/j81XgMmX
DcLlh9gMF118KsXXhdXx2mjfQRbn7BfTHRnd8nf9aBzOktB75kcH8jzk+Nke3Ptk78XLo97zZ73n
vePD7lH/+VGv1+3aN/DNgKJd/zOQJgoriovnwI7pcUB2v53/b+9qe9s2kvDnFuh/IHoBeh8idmff
uBSSRu/tXYPiejkUwR0Cg5Iph5EsuiSdnA3cj72P/Re3S+qFSy5pUnbNOieiqB2IoqzZ2d2ZnWee
R4ZjwWYw9zYrL7q8lsFnqJ/7/yv/0jtdFGT06pfLNZqTv0b0bfR+cTN9/5efXxa7hcGxhlc7BCf0
ichQyHmIXq1rFMTIEAjcASCCon25NgrDZKDIZlZ6M4r153EUbqxJGppusbBV9+YMnL7pxeHG76zo
etO78qIktr6VPv3tQt4gA95gfVOoke2yaqR6ZZBNOWOAZSZMmekjv9NpccRhVBBVzH6pTCTOGPPf
5CqtVbOyIKvShUgcYfqgpMCCZmNSvtU8JHJFPGZACCBuD0GMXcoQckaGz6sdD6LOtszjUbUQFjgQ
uhiP4iSZr2VC3HBADPeaRyS98YgxcRgiYAMdYUH4kI6Gpo+sGZS0E5KAaVDgCRRB23WfycCzNsSq
aj5rVAR9hOYzIE9gRGrjO8OQuPSYAA7ovcak0ID9+7YGmj6sAr9vuvWptwuavtNDNA7KWzSDg6kZ
EzRDgymEB83AYLIwaCYGk41BMzKYrAyamaFSFD7zRs3i2GRxrCcCxhVHd2qTnbFmZ2yyM9bsjE12
xpqdzamSZmfM67++ZnFssjjWLI5NFseaxXG9xYlmcWKyONEsTkwWJw0yworgM39LRTxk+MOBteyf
raXrJB2ACjErkVmnvYnnoR+niEoVZs7Df1vrYOFvYr/QnpjRO+QJTFX3RNYyRUoddVM0Y0OHT8Zk
yIRLYTQV4xlmwxknbDicjfFITBEbeB+vzrbd//JXOzo0YX79oxfLLS9e3Vivvbn1Juuc/PrAerDa
vZ5rfvlaB6oZOSzatq1ipwsMvQ7fVsjXXriyfNVBotIzaTB/1fO3LORJW+kZ1afib1bBAaq3JXHM
SaEpQVyy53gykDjKPF4mjzYARrbblKulcfMqp+7jN7rgVGpzr74z8+d7rl6iqCesnqoK5w848Ozv
4TxMrD8xqk5bD0473CRB7xdVrrGKeNko6am7B9v3VvTS7UXiAjk3g0tr5P838ZT/e2s/HuDlapls
PV8bme3De+C4ql2C20g4DBwFY3YFzX1mfd9q7erFcQfUObSkgrryPmalPGvhbb5JrDgJrzRgK82N
IO0z3mfkyMUK2FB0uFg1C2MLrT+4iy2G7ucPyXEnq/xXqE724vxJke37OUSFK9413JRKU0q9uTCl
Cvbcj9bkt4+/bW4C65dglYRRbpjqZpV6fg+4XAttEDblAgNzkMOFy8qzqnGbK/AO+vlAl9P79dqP
kyDctNxEtoXtwVUULsJNEoVrexnsJQuZpkLFeM1O4irtBwQ2pQIr2zZk/WraogpuBxpUWBdtPg/i
1eK9v1i1M7FMyRUplDWKwk8b68XVXP1Ux4pyimx1lYdrfxX7N3LfvgjkLd7NBg8WYbTx1+tta0RZ
hQeDUsIm1RqShBKlwkO5OvRqurU37mEF6MTniaE7wkUUpjZHLpKxTLk7QpUg8usYgNxC+iCO6Y7I
7+RexU6+95dL/yJSTFhrFdm17fokXWj1YUdrWSrQnG1uwsvESxTXWcohrb149nLqxqrw80Xxhd3b
phC31fMrhrjP5Xq1vghvw9Ugd0ZsEFoEdX5OK+eG4yBwEcmEFgVvODdatIsy5nRQS7xndMVV11DK
y3ZkdOV2GF01PVLT8xPHfXpBMFdhWLp8HZexQ5dBcIuuTcI6kEMhRjYWZzacIrnDYEQNrBTlQxUn
bTc/ipXCaP9q82tBeLOgW2vjvMcRjx683+NBR3RmCt5BcdMp0y8BTimnFnKzewbIo1yGwc/AxcuU
fikfFRj5XXfRxNnIl9tj4inC0LkKLOz19hXtGRk1THrEoBAbuR1KtfkeHGr/wnPrxe2F0gjRbt77
zI+KmzxYH9hfy7GSDJRITgTErFdfX1vQUTZdyLBgLarJCc+0CuNrWFuzAbhbCxp0yW3UJ6KaBRVz
GcRnLKjyHU1jlNoajq6vwjo4AQJR7m+eTCfj4WhsEyRUDD9IbiKV+JRE2qimQ4uF/E9fYYerMFZk
ceGN9eJcgWZvfO1hdaw/Bn7kQFBmvZ1Fvi+4JbPjZXBxsHNtIUxfrFzagRQeL5HkA5ZpuUC2K1Sv
PsiUULoZdx15K7LjX6+DSFpq8OnTJ7vAgJQjW4Pc2bJ0X+ZkoCHI8BAKDnE4VZ19Os+fC2EH44qz
1beR9+Gt0vt+lzsxzcYnG65cRLH9meMKNQxhxTJVW5ksnI6KDhhBjLGHQM5YrQBMzo5ydmuKPRjv
E/a5xB78oWIP84N2rlFbkS6Epc7jT2dS1h+VrjEbITmlAcmNArlmWgiUzxxIHyuxlsd2DXN209IV
Kg/v27pC5YN2rtAQeaCj7ToJSO+ZSDqKLVN+waMTyS7z/XrMR4HWs4MqCrjclEhOgSsiaGQkcikv
5qyv2K3wcUQuJkPn/KXZir0zdy1+pnCo0oUoB4f74CLKiY86CetT8+QYMUGFnAsUodmEAwynCnRN
FKs3YuCMEZ6gGXfGXU6PWjBTURqzg5NmSvLj9T6jEIs/BQqaI3+7CGTeGiSv2vl82nzZ28SCCIwG
q48K3ZtyXaWaS/7mgydDW2nwH7xAusCL+SJa5wsx+7oX1uSTMDFRTu/KLIJyjBwbKGd207JXPY6s
MDoO7eAYzBxvyGQBbBVtCAQN4g1FDdJH7lONNx4m9Kx80M4XagGDui+QLlJ27JTY94FSbkoliYPp
UakkKIpUTCtSycKpWZpZnu095OyQSZ69nILMJeX/02zyUG76XfLJehxnQVbU6YCAsCxURaYUTYcj
kXLJladwds7CtClMSR8dxSTX+RSujFDbZ48VD9o5QkO0rl4idKALtfcHho8qtd0+huPho+a18ZGC
pFrgtH4gxOjjJ3hVWf8MHJsoslvEGuzCVC6sivv4KU7hR8v66wHy+i4sOgjIQBjrklOYUrkRO9Wr
eTGdZH101AGQdYDX6Y157dLIhk0GBSgMdADexsKIggQl5qNClTtQkC4S7/IIIBOAWN3UEO14BIJY
PV1hHeViIdMTrjieZYpKBOO8jHWsb+gooB27qGcA+h3yxSz3y1h00m74XDa4TwapJl1IcB+qQZBy
RYa0x5RybhO3KZ6+tlWmcJbldoCDxKXKt9qHhAvySyIsbdEkG1SMxH04kpQ4v/g8bx8Y7B3HvCvt
xqE5DQGW3/rx4wFaCugRPhcKgeDSOX6GBPGJ46NnaM5JikDYyMU4TK4/HEKqn7wLZbT4dh1Ke8k0
aREMNMHOpjGUtpMjtIT0zyBL8uycLBeOOzf9GRn6znWAELkmqRb5u6HC2gqb+Gq72fiX1uX1Kr4N
VpZnrdX09W8PMIZM6Zzl8IBuSiSP62EM9b1mBVU29/G3pIpwcDghYxujtELYqAiEypXzUzioh4NN
ewp1p+BuFwep9ysCSXcgfXosmrDycOsxEjjgf/wWf2gp+Ytr2b5wRYN/Q7qvO0gXqjWUG6vLMsoc
6IJFqYQqQkqnWu5I3nLJn82FTzxfboxYILRVRtQ3mRI8D7/6+dXIW7+cwm0cnA2TJFin8DwvSby5
V2wL+EE5aGD9TcnWSIe9ep/+O3dXCtDTuwPzK+Rw8ua13NvW/lWQFPYxGYsf4k+shN4I1O1jmfzz
H3tWtNRjkHFN3ayooL3IxJKfEt1bW7PcoQ9eYRZ4amZxW6p3AK41C7qPfMdJNv0OHpQy6QKuZOJp
vK0AEV3UqFEJQ0mmCMYYMxlvKxkjbu42k0tw/siAOUcWQQudVP+Iws352TT4GMgf36/Dyzh6ORPn
aldK/Au9kK0dz30TW9dXuUO4pqwJHHWwlzNUznImM4aHs6HNpdVdRAwI4TSuhdxWiVCf0j47AiFc
OoJTe/ebW28erhex+mXlLeIgieV+rn4fzHpv/MV15Ge9nF99+cU/vbX30Ytu9ljwLQR/O7bPLRlX
eDKqsLKowhBTaJnTZeArtfHYkh8XqXRXgRwMalyUUeKATYBjVY6tT6ut3KXsSycyj0xPkokSZtyb
JKVPw4CRizFBRD55OJug6Wg0NhPa6YlYu/e2ZZcAmZR0AMXkB467kquob13vY1ZLf7Lu703385Sv
vmzqKwZJuUq3aubjbWXZAaCD2kwBe5Z9F/VFWp5Gt1lj7lrIlI8ZIA77Q223uFKiymZZV/X2U2JT
B1G71EdumMAt9NZPE/j/YgI3ZtIglD++Q8ic4T+VcYSK31BWtsBbDVJrz6Fc4wTLXnxwgqatR8qx
6r3vbneSi8ODxBdFHe3WXlfWnH3909ut5qyMCgABpizTnBV7zdllDAR6GFO7YMC2hCGOcLuATerw
Gn979u0rKo/ee98796PYiq4urcPWsA6jYGMNN+eRH1gvluk/B/FFkHOc+jJlYc5O5UQdTya2MqiQ
Gcri5iqSI7F9nLaU5ISACUmFgGWc5spRAWRjh1C0G5XkerWSf9DC/nBzbS+DraBr/ScVxVwJYcgh
8sHAqHKirfvEibdJblOpafvwrbd0J0SruxMhp2JBwrs5X4mL0ONXTilSXEp/zPX76B2wdUZkNVi0
rIfJinIHp/kYBxNVACT7AmA9G0tdkQe4wx+f+IaSMvynzg8qzACuTgf4kG2zn2OW/AC7YKaRTM1H
YJg1FwPmn4EY8Ok6XafrdJ2u03W6TtfpOl2n63SdrtN1uk7X6frsrv8BfbV21QCYDQA=

------=_NextPart_000_0016_01C3059B.9D70C8F0--



From tss@iki.fi  Fri Apr 18 14:24:27 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 18 Apr 2003 14:24:27 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id A30A323845
	for <dovecot@procontrol.fi>; Fri, 18 Apr 2003 14:24:27 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 5A9555E017F5; Fri, 18 Apr 2003 14:24:27 +0300 (EEST)
Subject: [dovecot] Re: another bug
From: Timo Sirainen <tss@iki.fi>
To: Farkas Levente <lfarkas@bnap.hu>
Cc: Dovecot List <dovecot@procontrol.fi>
In-Reply-To: <20030418091456.5410E754003@mail1.bppiac.hu>
References: <3E9E78C5.4000501@bnap.hu> <1050588761.16342.146.camel@hurina>
	 <20030418091456.5410E754003@mail1.bppiac.hu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1050665067.16342.269.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 18 Apr 2003 14:24:27 +0300
X-archive-position: 618
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 621                                                  
Status: O

On Fri, 2003-04-18 at 12:14, Farkas Levente wrote:
> hi,
> after I push the delete button on a long mail in mozilla the mail is not
> deleted and after tha mozilla don't show any other messages in that folder.
> I have to restart mozilla. but even after the restart I still can't remove
> the message. this already happend earlier, but now here is the rawlog of the
> session. from OE6 I can delete the same message.

I didn't notice anything wrong in the rawlog. Except that it didn't
contain any tries to delete the message, no \Deleted flag change and no
EXPUNGE command.


From overflow@eurielec.etsit.upm.es  Fri Apr 18 15:00:36 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 18 Apr 2003 15:00:36 +0300 (EEST)
Return-Path: <overflow@eurielec.etsit.upm.es>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from eurielec.etsit.upm.es (uno.eurielec.etsit.upm.es [138.100.31.227])
	by danu.procontrol.fi (Postfix) with ESMTP id D234E23845
	for <dovecot@procontrol.fi>; Fri, 18 Apr 2003 15:00:35 +0300 (EEST)
Received: from dos.eurielec.etsit.upm.es (dos.eurielec.etsit.upm.es [138.100.31.228])
	by eurielec.etsit.upm.es (Postfix) with SMTP
	id E05921A73; Fri, 18 Apr 2003 14:04:56 +0200 (CEST)
Received: by dos.eurielec.etsit.upm.es (sSMTP sendmail emulation); Fri, 18 Apr 2003 14:00:34 +0200
Date: Fri, 18 Apr 2003 14:00:34 +0200
From: Jaime Medrano <overflow@eurielec.etsit.upm.es>
To: Timo Sirainen <tss@iki.fi>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: 0.99.9-test5
Message-ID: <20030418120034.GA8148@eurielec.etsit.upm.es>
References: <1050507758.16338.58.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-15
Content-Disposition: inline
In-Reply-To: <1050507758.16338.58.camel@hurina>
User-Agent: Mutt/1.5.4i
X-archive-position: 619
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: overflow@eurielec.etsit.upm.es
Precedence: bulk
X-list: dovecot
X-UID: 622                                                  
Status: O

It seems to have problems when calculating recent messages. When a mail
comes to a mailbox the recent count is sometimes an arbitrary number,
bigger than the actual messages that have arriven.

Regards,
Jaime.

From eskimoe@ananzi.co.za  Sun Apr 20 03:10:03 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 20 Apr 2003 03:10:03 +0300 (EEST)
Return-Path: <eskimoe@ananzi.co.za>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from sun.com (port-212-202-171-144.reverse.qdsl-home.de [212.202.171.144])
	by danu.procontrol.fi (Postfix) with SMTP id C8BB423845
	for <dovecot@procontrol.fi>; Sun, 20 Apr 2003 03:10:02 +0300 (EEST)
Received: (qmail 19674 invoked by uid 1000); 20 Apr 2003 00:11:28 -0000
Date: Sun, 20 Apr 2003 02:11:28 +0200
From: Moe Wibble <eskimoe@ananzi.co.za>
To: Dovecot List <dovecot@procontrol.fi>
Subject: [dovecot] Re: errors
Message-ID: <20030420001128.GA18878@woom.net>
Mail-Followup-To: Moe Wibble <eskimoe@ananzi.co.za>,
	Dovecot List <dovecot@procontrol.fi>
References: <3E9D1B27.7090201@bnap.hu> <20030416134628.GA13126@woom.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20030416134628.GA13126@woom.net>
X-archive-position: 620
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: eskimoe@ananzi.co.za
Precedence: bulk
X-list: dovecot
X-UID: 623                                                  
Status: O
Content-Length: 1454

On Wed, Apr 16, 2003 at 03:46:28PM +0200, Moe Wibble wrote:
> On Wed, Apr 16, 2003 at 10:58:15AM +0200, Farkas Levente wrote:
> > hi,
> > in the yesterday cvs, an internal error in the imap message appear in 
> > the client side and in the maillog:
> > -------------------------
> > Apr 16 10:01:42 red imap(zgabor): Corrupted index file 
> > /home/zgabor/Maildir/.Lists.Bugtraq/.imap.index: Invalid seen messages 
> > count (284 < 285)
> > Apr 16 10:01:43 red imap(zgabor): Corrupted index file 
> > /home/zgabor/Maildir/.Lists.Linux/.imap.index: Invalid seen messages 
> > count (191 < 192)
> > Apr 16 10:01:44 red imap(zgabor): Corrupted index file (in-memory index 
> > for /home/zgabor/Maildir/.Lists.Linux): Filename mismatch for UID 1: 
> > 1050448183.2238_1.red.int.bppiac.hu vs 1050321835.21498_1.red.int.bppiac.hu
> > -------------------------
> 
> ACK.
> I'm getting similar errors:
> Apr 16 15:22:13 rafter imap(moe): Corrupted index file /<snipped>/.INBOX/.imap.index: index.next_uid (441) > uidlist.nex
> t_uid (440)
> 
> Yesterday's CVS version running here.
> Removing the '.imap.index'-file has stopped the errors so far.
> 
> Haven't noticed any other side effects, yet.

The bug has just hit me again:

Apr 20 02:08:00 rafter imap(moe): Corrupted index file /<snipped>/.INBOX/.imap.index: index.next_uid (495) > uidlist.nex
t_uid (494)

Removing .imap.index has muted it once again.

Is this problem being worked on?


regards
-- 
MW


From timhunt@users.sf.net  Mon Apr 21 04:25:43 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 21 Apr 2003 04:25:43 +0300 (EEST)
Return-Path: <timhunt@users.sf.net>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from timhunt.net (ns1.timhunt.net [216.27.147.130])
	by danu.procontrol.fi (Postfix) with ESMTP id 99F4B23845
	for <dovecot@procontrol.fi>; Mon, 21 Apr 2003 04:25:42 +0300 (EEST)
Received: from users.sf.net (sun [192.168.10.100])
	(authenticated)
	by timhunt.net (8.11.6/8.11.6) with ESMTP id h3L1PdC01464;
	Sun, 20 Apr 2003 21:25:39 -0400
Message-ID: <3EA34893.3070604@users.sf.net>
Date: Sun, 20 Apr 2003 21:25:39 -0400
From: Tim Hunt <timhunt@users.sf.net>
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.3) Gecko/20030312
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: dovecot@procontrol.fi
Subject: [dovecot] Patch for zero content-length
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-MailScanner: Found to be clean
X-archive-position: 621
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: timhunt@users.sf.net
Precedence: bulk
X-list: dovecot
X-UID: 624                                                  
Status: O
Content-Length: 3016

mbox-index.c uses a zero content length as a flag for an invalid 
Content-Length: header. Unfortunately zero is also a valid value for 
Content-Length. The patch below attempts to address the problem.


*** mbox-index.h.orig   Tue Apr 15 09:04:02 2003
--- mbox-index.h        Sun Apr 20 11:42:12 2003
***************
*** 19,24 ****
--- 19,25 ----
         struct istream *input;
         uoff_t content_length;
         int set_read_limit;
+       unsigned int content_length_good:1;
   };

   int mbox_set_syscall_error(struct mail_index *index, const char 
*function);

*** mbox-index.c.orig   Mon Mar 24 05:52:44 2003
--- mbox-index.c        Sun Apr 20 12:41:16 2003
***************
*** 264,277 ****
                 start_offset = ctx->input->v_offset;
                 i_stream_set_read_limit(ctx->input, 0);

!               end_offset = start_offset + ctx->content_length;
!               if (ctx->content_length == 0 ||
                     !mbox_verify_end_of_body(ctx->input, end_offset)) {
!                       if (ctx->content_length != 0)
                                 i_stream_seek(ctx->input, start_offset);
                         mbox_skip_message(ctx->input);
                         end_offset = ctx->input->v_offset;
                         ctx->content_length = end_offset - start_offset;
                 }

                 i_stream_seek(ctx->input, start_offset);
--- 264,280 ----
                 start_offset = ctx->input->v_offset;
                 i_stream_set_read_limit(ctx->input, 0);

!               end_offset = start_offset;
!               if ( ctx->content_length_good )
!                       end_offset += ctx->content_length;
!               if (!ctx->content_length_good ||
                     !mbox_verify_end_of_body(ctx->input, end_offset)) {
!                       if (ctx->content_length_good )
                                 i_stream_seek(ctx->input, start_offset);
                         mbox_skip_message(ctx->input);
                         end_offset = ctx->input->v_offset;
                         ctx->content_length = end_offset - start_offset;
+                       ctx->content_length_good = TRUE;
                 }

                 i_stream_seek(ctx->input, start_offset);
***************
*** 301,311 ****
--- 304,316 ----
                     strcasecmp(hdr->name, "Content-Length") == 0) {
                         /* manual parsing, so we can deal with uoff_t */
                         ctx->content_length = 0;
+                       ctx->content_length_good = TRUE;
                         for (i = 0; i < hdr->value_len; i++) {
                                 if (hdr->value[i] < '0' ||
                                     hdr->value[i] > '9') {
                                         /* invalid */
                                         ctx->content_length = 0;
+                                       ctx->content_length_good = FALSE;
                                         break;
                                 }



From timhunt@users.sf.net  Mon Apr 21 04:37:34 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 21 Apr 2003 04:37:34 +0300 (EEST)
Return-Path: <timhunt@users.sf.net>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from timhunt.net (ns1.timhunt.net [216.27.147.130])
	by danu.procontrol.fi (Postfix) with ESMTP id F286123845
	for <dovecot@procontrol.fi>; Mon, 21 Apr 2003 04:37:33 +0300 (EEST)
Received: from users.sf.net (sun [192.168.10.100])
	(authenticated)
	by timhunt.net (8.11.6/8.11.6) with ESMTP id h3L1bVC01705;
	Sun, 20 Apr 2003 21:37:31 -0400
Message-ID: <3EA34B5A.8060004@users.sf.net>
Date: Sun, 20 Apr 2003 21:37:30 -0400
From: Tim Hunt <timhunt@users.sf.net>
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.3) Gecko/20030312
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: dovecot@procontrol.fi
Subject: [dovecot] Message with lots of attachments breaks Dovecot
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-MailScanner: Found to be clean
X-archive-position: 622
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: timhunt@users.sf.net
Precedence: bulk
X-list: dovecot
X-UID: 625                                                  
Status: O
Content-Length: 1296

I have a message with over a 1000 embedded attachments(!), and it breaks
Dovecot. The issue appears to be buffer management. There is some logic
in the function message_part_deserialize_part that seems to assume that
the message part structure is in a contiguous array, but that doesn't
seem to be the case. I haven't been able to figure out enough about the
memory management in Dovecot to fix the problem.

Below is a horrible workaround that just allocates a lot more memory for
the message part array, so that it remains contiguous.

*** mail-index-update.c.orig    Wed Mar 26 10:41:55 2003
--- mail-index-update.c Sun Apr 20 16:53:45 2003
***************
*** 498,504 ****

                 if (cache_fields & DATA_FIELD_MESSAGEPART) {
                         t_push();
!                       buf = buffer_create_dynamic(data_stack_pool, 2048,
                                                     (size_t)-1);
                         message_part_serialize(part, buf);

--- 498,504 ----

                 if (cache_fields & DATA_FIELD_MESSAGEPART) {
                         t_push();
!                       buf = buffer_create_dynamic(data_stack_pool, 51200,
                                                     (size_t)-1);
                         message_part_serialize(part, buf);



From keith@midnighthax.com  Mon Apr 21 16:46:36 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 21 Apr 2003 16:46:36 +0300 (EEST)
Return-Path: <keith@midnighthax.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mhlgengs001.rg2.midnighthax.com (unknown [217.158.167.69])
	by danu.procontrol.fi (Postfix) with ESMTP id 9206B23845
	for <dovecot@procontrol.fi>; Mon, 21 Apr 2003 16:46:35 +0300 (EEST)
Received: from zaphod.rg2.midnighthax.com (zaphod.rg2.midnighthax.com [10.0.2.1])
	by mhlgengs001.rg2.midnighthax.com (Postfix) with SMTP
	id 18D49224C6; Mon, 21 Apr 2003 14:46:30 +0100 (BST)
Date: Mon, 21 Apr 2003 14:46:39 +0100
From: Keith Edmunds <keith@midnighthax.com>
To: "Ian R. Justman" <ianj@ian-justman.com>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: Folders with mail and subfolders
Message-Id: <20030421144639.1b30a6a4.keith@midnighthax.com>
In-Reply-To: <3E9B68A9.4000701@ian-justman.com>
References: <20030414193349.4c4fe9ba.keith@midnighthax.com>
	<3E9B68A9.4000701@ian-justman.com>
Organization: Midnight Hax Ltd
X-Mailer: Sylpheed version 0.8.11claws90 (GTK+ 1.2.10; i686-pc-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-archive-position: 623
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: keith@midnighthax.com
Precedence: bulk
X-list: dovecot
X-UID: 626                                                  
Status: O

On Mon, 14 Apr 2003 19:04:25 -0700
"Ian R. Justman" <ianj@ian-justman.com> wrote:
 
> Keith Edmunds wrote:
> > I have a maildir hierarchy (built originally with Courier-IMAP)
> > where some folders contain both email and subfolders. Using Dovecot
> > I cannot see the mail in the top folders: I can only see the
> > subfolders.
> > 
> > Is this an RFC restriction or a Dovecot restriction? If the latter,
> > is it planned to change?
> 
> Far as I know, that's usually a client-side issue.  I had the same
> thing come up when I was using Cyrus where a folder can hold either
> messages or more folders.  Netscape has an option where you can have
> both or they're mutually exclusive.

I'm using the same client (sylpheed-claws) with both Dovecot and
Courier-IMAP. Dovecot does not seem to allow both messages and folders
within folders whereas Courier-IMAP does. Is there some setup I can
change to allow both?

-- 
Keith Edmunds

From tss@iki.fi  Mon Apr 21 16:47:40 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 21 Apr 2003 16:47:40 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 6818323845
	for <dovecot@procontrol.fi>; Mon, 21 Apr 2003 16:47:40 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 68E235E017F5; Mon, 21 Apr 2003 16:47:38 +0300 (EEST)
Subject: [dovecot] Re: Message with lots of attachments breaks Dovecot
From: Timo Sirainen <tss@iki.fi>
To: Tim Hunt <timhunt@users.sf.net>
Cc: dovecot@procontrol.fi
In-Reply-To: <3EA34B5A.8060004@users.sf.net>
References: <3EA34B5A.8060004@users.sf.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1050932857.32160.2.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 21 Apr 2003 16:47:38 +0300
X-archive-position: 624
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 627                                                  
Status: O
Content-Length: 1200

On Mon, 2003-04-21 at 04:37, Tim Hunt wrote:
> I have a message with over a 1000 embedded attachments(!), and it breaks
> Dovecot. The issue appears to be buffer management.

I think it crashes because of bug in data-stack.c. This should fix it:

Index: data-stack.c
===================================================================
RCS file: /home/cvs/dovecot/src/lib/data-stack.c,v
retrieving revision 1.17
retrieving revision 1.18
diff -u -r1.17 -r1.18
--- data-stack.c        27 Jan 2003 00:46:29 -0000      1.17
+++ data-stack.c        26 Mar 2003 14:58:33 -0000      1.18
@@ -121,9 +121,13 @@
 
 static void free_blocks(struct stack_block *block)
 {
+       struct stack_block *next;
+
        /* free all the blocks, except if any of them is bigger than
           unused_block, replace it */
        while (block != NULL) {
+               next = block->next;
+
                if (unused_block == NULL || block->size > unused_block->size) {
                        free(unused_block);
                        unused_block = block;
@@ -131,7 +135,7 @@
                        free(block);
                }
 
-               block = block->next;
+               block = next;
        }
 }


From tss@iki.fi  Mon Apr 21 16:49:34 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 21 Apr 2003 16:49:34 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 66E5D23845
	for <dovecot@procontrol.fi>; Mon, 21 Apr 2003 16:49:34 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 1D23C5E017F5; Mon, 21 Apr 2003 16:49:34 +0300 (EEST)
Subject: [dovecot] Re: errors
From: Timo Sirainen <tss@iki.fi>
To: Moe Wibble <eskimoe@ananzi.co.za>
Cc: Dovecot List <dovecot@procontrol.fi>
In-Reply-To: <20030420001128.GA18878@woom.net>
References: <3E9D1B27.7090201@bnap.hu> <20030416134628.GA13126@woom.net>
	 <20030420001128.GA18878@woom.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1050932973.32157.5.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 21 Apr 2003 16:49:34 +0300
X-archive-position: 625
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 628                                                  
Status: O

On Sun, 2003-04-20 at 03:11, Moe Wibble wrote:
> The bug has just hit me again:
> 
> Apr 20 02:08:00 rafter imap(moe): Corrupted index file /<snipped>/.INBOX/.imap.index: index.next_uid (495) > uidlist.nex
> t_uid (494)
> 
> Removing .imap.index has muted it once again.
> 
> Is this problem being worked on?

I think it should be fixing itself now. The index is rebuilt
automatically next time the mailbox is opened.

I also found a few more potential problems with it, -test6 should come
out soon.


From tss@iki.fi  Mon Apr 21 16:50:45 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 21 Apr 2003 16:50:45 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 8FD5823845
	for <dovecot@procontrol.fi>; Mon, 21 Apr 2003 16:50:45 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 799E05E017F5; Mon, 21 Apr 2003 16:50:45 +0300 (EEST)
Subject: [dovecot] Re: 0.99.9-test5
From: Timo Sirainen <tss@iki.fi>
To: Jaime Medrano <overflow@eurielec.etsit.upm.es>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030418120034.GA8148@eurielec.etsit.upm.es>
References: <1050507758.16338.58.camel@hurina>
	 <20030418120034.GA8148@eurielec.etsit.upm.es>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1050933045.32161.8.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 21 Apr 2003 16:50:45 +0300
X-archive-position: 626
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 629                                                  
Status: O

On Fri, 2003-04-18 at 15:00, Jaime Medrano wrote:
> It seems to have problems when calculating recent messages. When a mail
> comes to a mailbox the recent count is sometimes an arbitrary number,
> bigger than the actual messages that have arriven.

Hmm. Have to look. Recent counts are pretty much broken in any case
currently.


From tss@iki.fi  Mon Apr 21 17:04:02 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 21 Apr 2003 17:04:02 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 1FDC823845
	for <dovecot@procontrol.fi>; Mon, 21 Apr 2003 17:04:02 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id AF3C65E017F5; Mon, 21 Apr 2003 17:04:01 +0300 (EEST)
Subject: [dovecot] Re: Folders with mail and subfolders
From: Timo Sirainen <tss@iki.fi>
To: Keith Edmunds <keith@midnighthax.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030421144639.1b30a6a4.keith@midnighthax.com>
References: <20030414193349.4c4fe9ba.keith@midnighthax.com>
	 <3E9B68A9.4000701@ian-justman.com>
	 <20030421144639.1b30a6a4.keith@midnighthax.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1050933841.32157.12.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 21 Apr 2003 17:04:01 +0300
X-archive-position: 627
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 630                                                  
Status: O

On Mon, 2003-04-21 at 16:46, Keith Edmunds wrote:
> I'm using the same client (sylpheed-claws) with both Dovecot and
> Courier-IMAP. Dovecot does not seem to allow both messages and folders
> within folders whereas Courier-IMAP does. Is there some setup I can
> change to allow both?

I didn't notice problems with Sylpheed-claws + CVS Dovecot. Subfolders
were somewhat broken in 0.99.8.1 though, there's a patch for it at
http://dovecot.procontrol.fi/list.patch


From mem@mv.mv.com  Mon Apr 21 17:47:22 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 21 Apr 2003 17:47:22 +0300 (EEST)
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id 65C622385F
	for <dovecot@procontrol.fi>; Mon, 21 Apr 2003 17:47:22 +0300 (EEST)
Received: (qmail 8769 invoked by uid 101); 21 Apr 2003 10:47:20 -0400
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Mon, 21 Apr 2003 10:47:20 -0400
To: dovecot@procontrol.fi
Subject: [dovecot] quotas again
Message-ID: <20030421144720.GE7629@iridium.mv.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.4.1i
X-archive-position: 628
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mem@mv.mv.com
Precedence: bulk
X-list: dovecot
X-UID: 631                                                  
Status: O
Content-Length: 1274

A couple of notes about quotas-- I know this has been brought up
before but the negative effects that occur when a user is over quota
are still disconcerting.

Ideally it would be best if a user could at least delete mail when in
an over-quota condition.  One would think it would be enough to simply
ignore errors creating the index files (and use an in-memory index).
However, another problem is that the mere renaming of a file from the
new/ directory to the cur/ directory can cause an over-quota error if
the cur/ directory has to be expanded.  We see these errors in the
maillog followed by an "I/O leak" message, e.g.:

Apr 21 07:42:26 mercury mem[10059]: pop3(someuser): maildir build: rename(/users/3a/someuser/Maildir/new/1049919998.23875.mercury.mv.net, /users/3a/someuser/Maildir/cur/1049919998.23875.mercury.mv.net) failed: Disc quota exceeded
Apr 21 07:42:26 mercury mem[10059]: pop3(someuser): I/O leak: 0x807361c (1)
Apr 21 07:42:26 mercury mem[10059]: pop3(someuser): I/O leak: 0x804a1b8 (0)

and then we get a report about the server dropping the connection.

BTW we seem to see quite a lot of these "I/O leak" messages in other
situations too, and I think it started with the test5 release (but I am
not absolutely sure).  What does this mean?

Yours,
mm

From amyzing@talsever.com  Mon Apr 21 18:38:18 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 21 Apr 2003 18:38:18 +0300 (EEST)
Return-Path: <amyzing@talsever.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from granger.mail.mindspring.net (granger.mail.mindspring.net [207.69.200.148])
	by danu.procontrol.fi (Postfix) with ESMTP id 4EAC623845
	for <dovecot@procontrol.fi>; Mon, 21 Apr 2003 18:38:18 +0300 (EEST)
Received: from user-2ivf46j.dialup.mindspring.com ([165.247.144.211] helo=marajen.talsever.com)
	by granger.mail.mindspring.net with esmtp (Exim 3.33 #1)
	id 197dMq-0008Vl-00; Mon, 21 Apr 2003 11:38:04 -0400
Received: by marajen.talsever.com (Postfix, from userid 1000)
	id 18317809B; Mon, 21 Apr 2003 11:37:59 -0400 (EDT)
Date: Mon, 21 Apr 2003 11:37:59 -0400
From: Amelia A Lewis <amyzing@talsever.com>
To: Keith Edmunds <keith@midnighthax.com>
Cc: "Ian R. Justman" <ianj@ian-justman.com>, dovecot@procontrol.fi
Subject: [dovecot] Re: Folders with mail and subfolders
Message-ID: <20030421153759.GB28811@talsever.com>
References: <20030414193349.4c4fe9ba.keith@midnighthax.com> <3E9B68A9.4000701@ian-justman.com> <20030421144639.1b30a6a4.keith@midnighthax.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20030421144639.1b30a6a4.keith@midnighthax.com>
User-Agent: Mutt/1.5.3i
X-archive-position: 629
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: amyzing@talsever.com
Precedence: bulk
X-list: dovecot
X-UID: 632                                                  
Status: O
Content-Length: 1771

On Mon, Apr 21, 2003 at 02:46:39PM +0100, Keith Edmunds wrote:
>On Mon, 14 Apr 2003 19:04:25 -0700
>"Ian R. Justman" <ianj@ian-justman.com> wrote:
> 
>> Keith Edmunds wrote:
>> > I have a maildir hierarchy (built originally with Courier-IMAP)
>> > where some folders contain both email and subfolders. Using Dovecot
>> > I cannot see the mail in the top folders: I can only see the
>> > subfolders.
>> > 
>> > Is this an RFC restriction or a Dovecot restriction? If the latter,
>> > is it planned to change?
>> 
>> Far as I know, that's usually a client-side issue.  I had the same
>> thing come up when I was using Cyrus where a folder can hold either
>> messages or more folders.  Netscape has an option where you can have
>> both or they're mutually exclusive.
>
>I'm using the same client (sylpheed-claws) with both Dovecot and
>Courier-IMAP. Dovecot does not seem to allow both messages and folders
>within folders whereas Courier-IMAP does. Is there some setup I can
>change to allow both?

If you connected, using sylpheed, to an older version of dovecot that wasn't
permitting this (0.99.7, f'rinstance), then you might need to edit the
folderlist.xml (for sylpheed).  There's a flag on a folder ("nomail"?) that
gets set, and rebuilding the folder tree won't fix it, but you can remove
the flag by hand and then it's fine (with the Debian 0.99.8.1 updates, at
any rate, and prolly with current cvs).

Amy!
-- 
Amelia A. Lewis                    amyzing {at} talsever.com
  Light is the left hand of darkness
  and darkness the right hand of light.
    Two are one, life and death, lying
    together like lovers in kemmer,
      like hands joined together,
      like the end and the way.
        -- Tormer's Lay [Ursula K. Le Guin, "The Left Hand of Darkness"]

From tss@iki.fi  Mon Apr 21 18:53:54 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 21 Apr 2003 18:53:54 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id D25F623845
	for <dovecot@procontrol.fi>; Mon, 21 Apr 2003 18:53:53 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 382CD5E017F5; Mon, 21 Apr 2003 18:53:53 +0300 (EEST)
Subject: [dovecot] Re: quotas again
From: Timo Sirainen <tss@iki.fi>
To: "Mark E. Mallett" <mem@mv.mv.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030421144720.GE7629@iridium.mv.net>
References: <20030421144720.GE7629@iridium.mv.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1050940432.32161.24.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 21 Apr 2003 18:53:53 +0300
X-archive-position: 630
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 633                                                  
Status: O
Content-Length: 1462

On Mon, 2003-04-21 at 17:47, Mark E. Mallett wrote:
> A couple of notes about quotas-- I know this has been brought up
> before but the negative effects that occur when a user is over quota
> are still disconcerting.
> 
> Ideally it would be best if a user could at least delete mail when in
> an over-quota condition.  One would think it would be enough to simply
> ignore errors creating the index files (and use an in-memory index).
> However, another problem is that the mere renaming of a file from the
> new/ directory to the cur/ directory can cause an over-quota error if
> the cur/ directory has to be expanded.  We see these errors in the
> maillog followed by an "I/O leak" message, e.g.:

Hmm. I'm not sure how to fix this properly. I can of course just ignore
those files in new/, but then user can't delete those messages. Maybe I
should allow keeping the files in new/ in out-of-disk-space conditions..

uidlist file is also problematic. If there's no disk space to build new
one, the UIDs can't be permanently saved. Or worse, they could be reused
for different messages breaking client's cache.

> BTW we seem to see quite a lot of these "I/O leak" messages in other
> situations too, and I think it started with the test5 release (but I am
> not absolutely sure).  What does this mean?

It's mostly debugging. Some file descriptor was added to poll() (or
similiar) list, but wasn't removed from there. I'm not sure why you're
seeing them now.


From tss@iki.fi  Mon Apr 21 19:08:38 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 21 Apr 2003 19:08:38 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id BD8D323845
	for <dovecot@procontrol.fi>; Mon, 21 Apr 2003 19:08:38 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 6ACD95E017F5; Mon, 21 Apr 2003 19:08:38 +0300 (EEST)
Subject: [dovecot] 0.99.9-test6
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1050941318.32160.38.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 21 Apr 2003 19:08:38 +0300
X-archive-position: 631
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 634                                                  
Status: O

Just two fixes:

- dovecot-uidlist file is now assumed to be changed if it's modify time
is changed. before we relied on inode changing which isn't fully
reliable.
- mbox dotlocks sometimes incorrectly thought someone else had
overridden them

Known problems that I should fix:

- mbox: we don't necessarily notice message flag changes by external
programs (or another dovecot without index files). It's because we don't
always reparse the whole mbox file when it has changed. I think I'll
have to add some X-IMAP-Changelog header which describes what changes
were made by other Dovecot processes. If the change isn't listed in that
header, we'll fallback to reparsing the whole file. Although that's
still a bit annoying since MTA just appends the new mails, we wouldn't
really need to reparse the whole file then, just the new mails.
- I should use link() instead of relying on O_EXCL which doesn't work
with NFSv2 (or Linux's NFSv3 client).
- .subscriptions and .customflags files still aren't NFS-safe


From mem@mv.mv.com  Mon Apr 21 20:03:10 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 21 Apr 2003 20:03:10 +0300 (EEST)
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id 44E412385F
	for <dovecot@procontrol.fi>; Mon, 21 Apr 2003 20:03:10 +0300 (EEST)
Received: (qmail 15288 invoked by uid 101); 21 Apr 2003 13:03:09 -0400
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Mon, 21 Apr 2003 13:03:09 -0400
To: dovecot@procontrol.fi
Subject: [dovecot] Re: quotas again
Message-ID: <20030421170309.GI7629@iridium.mv.net>
References: <20030421144720.GE7629@iridium.mv.net> <1050940432.32161.24.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1050940432.32161.24.camel@hurina>
User-Agent: Mutt/1.4.1i
X-archive-position: 632
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mem@mv.mv.com
Precedence: bulk
X-list: dovecot
X-UID: 635                                                  
Status: O
Content-Length: 2314

On Mon, Apr 21, 2003 at 06:53:53PM +0300, Timo Sirainen wrote:
> On Mon, 2003-04-21 at 17:47, Mark E. Mallett wrote:
> > A couple of notes about quotas-- I know this has been brought up
> > before but the negative effects that occur when a user is over quota
> > are still disconcerting.
> > 
> > Ideally it would be best if a user could at least delete mail when in
> > an over-quota condition.  One would think it would be enough to simply
> > ignore errors creating the index files (and use an in-memory index).
> > However, another problem is that the mere renaming of a file from the
> > new/ directory to the cur/ directory can cause an over-quota error if
> > the cur/ directory has to be expanded.  We see these errors in the
> > maillog followed by an "I/O leak" message, e.g.:
> 
> Hmm. I'm not sure how to fix this properly. I can of course just ignore
> those files in new/, but then user can't delete those messages. Maybe I
> should allow keeping the files in new/ in out-of-disk-space conditions..

I would think so.  If a file can't be renamed to cur/ because of
expanding the directory, there are already a bunch of files in cur/ .
Allowing some deletion would help before they have to pick up the phone
and have somebody intervene.


> uidlist file is also problematic. If there's no disk space to build new
> one, the UIDs can't be permanently saved. Or worse, they could be reused
> for different messages breaking client's cache.

Yeah- trouble is if there are quotas enabled at all, people are going
to hit them.  The first time a person gets over quota they are either
going to learn to manage the mailbox, or they are going to request (and
probably get) more space if they have a real need for it.  However
it's likely to keep happening.

Unfortunately using filesystem quotas for mailboxes has problems.  At
one point we had a mail delivery quota system here that was not related
to filesystem quotas (i.e. the mail delivery agent would arrange not to
deliver mail to a mailbox that was at its limit, and would in fact
insert a single warning note instead)-- however filesystem quotas were
not in effect, so it was possible to manipulate the mailbox via the
POP or IMAP interface.  This was under sendmail, though, and I have
not yet thought about doing something similar under qmail.

mm

From mike@innercite.com  Mon Apr 21 20:16:02 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 21 Apr 2003 20:16:02 +0300 (EEST)
Return-Path: <mike@innercite.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from knight.innercite.com (knight.innercite.com [158.222.3.8])
	by danu.procontrol.fi (Postfix) with ESMTP id 0E52E2385F
	for <dovecot@procontrol.fi>; Mon, 21 Apr 2003 20:16:01 +0300 (EEST)
Received: from localhost.localdomain (rocket.innercite.com [158.222.7.10])
	by knight.innercite.com (8.12.3/8.12.3/Debian -4) with ESMTP id h3LH8ppB020593
	for <dovecot@procontrol.fi>; Mon, 21 Apr 2003 10:08:52 -0700
Subject: [dovecot] Re: quotas again
From: Mike Machado <mike@innercite.com>
To: dovecot@procontrol.fi
In-Reply-To: <20030421170309.GI7629@iridium.mv.net>
References: <20030421144720.GE7629@iridium.mv.net>
	<1050940432.32161.24.camel@hurina>  <20030421170309.GI7629@iridium.mv.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
X-Mailer: Ximian Evolution 1.0.8 
Date: 21 Apr 2003 10:15:56 -0700
Message-Id: <1050945356.1834.212.camel@rocket>
Mime-Version: 1.0
X-archive-position: 633
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mike@innercite.com
Precedence: bulk
X-list: dovecot
X-UID: 636                                                  
Status: O

On Mon, 2003-04-21 at 10:03, Mark E. Mallett wrote:
> 
> Unfortunately using filesystem quotas for mailboxes has problems.  At
> one point we had a mail delivery quota system here that was not related
> to filesystem quotas (i.e. the mail delivery agent would arrange not to
> deliver mail to a mailbox that was at its limit, and would in fact
> insert a single warning note instead)-- however filesystem quotas were
> not in effect, so it was possible to manipulate the mailbox via the
> POP or IMAP interface.  This was under sendmail, though, and I have
> not yet thought about doing something similar under qmail.

I don't suppose you could share how you built or where you found the
system that could do mail quotas with sendmail? Thanks!
 

-- 
Mike Machado
mike@innercite.com
InnerCite Inc.
Engineering Director / CTO


From mem@mv.mv.com  Mon Apr 21 21:29:53 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 21 Apr 2003 21:29:53 +0300 (EEST)
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id CEB2D2385F
	for <dovecot@procontrol.fi>; Mon, 21 Apr 2003 21:29:52 +0300 (EEST)
Received: (qmail 21248 invoked by uid 101); 21 Apr 2003 14:29:51 -0400
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Mon, 21 Apr 2003 14:29:51 -0400
To: Mike Machado <mike@innercite.com>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: quotas again
Message-ID: <20030421182951.GA11272@iridium.mv.net>
References: <20030421144720.GE7629@iridium.mv.net> <1050940432.32161.24.camel@hurina> <20030421170309.GI7629@iridium.mv.net> <1050945356.1834.212.camel@rocket>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1050945356.1834.212.camel@rocket>
User-Agent: Mutt/1.4.1i
X-archive-position: 634
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mem@mv.mv.com
Precedence: bulk
X-list: dovecot
X-UID: 637                                                  
Status: O
Content-Length: 1493

On Mon, Apr 21, 2003 at 10:15:56AM -0700, Mike Machado wrote:
> On Mon, 2003-04-21 at 10:03, Mark E. Mallett wrote:
> > 
> > Unfortunately using filesystem quotas for mailboxes has problems.  At
> > one point we had a mail delivery quota system here that was not related
> > to filesystem quotas (i.e. the mail delivery agent would arrange not to
> > deliver mail to a mailbox that was at its limit, and would in fact
> > insert a single warning note instead)-- however filesystem quotas were
> > not in effect, so it was possible to manipulate the mailbox via the
> > POP or IMAP interface.  This was under sendmail, though, and I have
> > not yet thought about doing something similar under qmail.
> 
> I don't suppose you could share how you built or where you found the
> system that could do mail quotas with sendmail? Thanks!

It was some hackery that I performed on mail.local under bsdi.
I regret that it's no longer available.

"not related to filesystem quotas" was a simplification- it would
actually look at filesystem quotas and use the user's soft limit if
one was set, but otherwise would impose a default maximum.  Most
users were left with quota not set.

It also required some minimal hacking to sendmail to recognize a
special return code from mail.local .

Considering that sendmail and mail.local used /var/spool/mail mailboxes,
it was pretty easy to understand and manage this kind of quota.  With
maildirs integrated into home directories, it's not quite as simple.

mm

From adam@os.inf.tu-dresden.de  Mon Apr 21 21:54:35 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 21 Apr 2003 21:54:35 +0300 (EEST)
Return-Path: <adam@os.inf.tu-dresden.de>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from os.inf.tu-dresden.de (os.inf.tu-dresden.de [141.76.48.99])
	by danu.procontrol.fi (Postfix) with ESMTP id 996562385F
	for <dovecot@procontrol.fi>; Mon, 21 Apr 2003 21:54:35 +0300 (EEST)
Received: from erwin.inf.tu-dresden.de ([141.76.48.80])
	by os.inf.tu-dresden.de with esmtp (Exim 3.36)
	id 197gR0-000SCG-00
	for dovecot@procontrol.fi; Mon, 21 Apr 2003 20:54:34 +0200
Received: from adam by erwin.inf.tu-dresden.de with local (Exim 3.35 #1 (Debian))
	id 197gR0-0008Sj-00
	for <dovecot@procontrol.fi>; Mon, 21 Apr 2003 20:54:34 +0200
Date: Mon, 21 Apr 2003 20:54:34 +0200
From: Adam Lackorzynski <adam@os.inf.tu-dresden.de>
To: dovecot@procontrol.fi
Subject: [dovecot] Using on AIX
Message-ID: <20030421185434.GJ21753@os.inf.tu-dresden.de>
Mail-Followup-To: dovecot@procontrol.fi
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
User-Agent: Mutt/1.4i
X-archive-position: 635
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: adam@os.inf.tu-dresden.de
Precedence: bulk
X-list: dovecot
X-UID: 638                                                  
Status: O
Content-Length: 1289

Hi,

I'm trying to install dovecot-0.99.9-test6 with gcc-3.2.2 under AIX (4.3.3) and
found some problems.

First, I need to define _XOPEN_SOURCE_EXTENDED to 1 in src/lib/fdpass.c
and src/auth/mycrypt.c or undefine it to compile successfully.

When I define _XOPEN_SOURCE_EXTENDED to 1, I get the following error
while connecting:

dovecot: Apr 21 17:56:44 Info: Dovecot starting up
imap-login: Apr 21 17:57:19 Fatal: fd_send(5) failed: Bad file number
dovecot: Apr 21 17:57:19 Error: child 39504 (login) returned error 89

This happens after a successful authentication (i.e. wrong authentications are
correctly denied).
Something similar happens if I define _XOPEN_SOURCE to 500 in both
files.

When I undefine the _XOPEN_SOURCE_EXTENDEDs without modifying the
original _XOPEN_SOURCE defines, it seems to come further:

imap-login: Apr 21 18:24:23 Info: Login: xxx [xxx.xxx.xxx.xxx]
imap(xxx): Apr 21 18:24:23 Panic: file mail-index-data.c: line 439 (mail_index_data_append): assertion failed: ((size & (MEM_ALIGN_SIZE-1)) == 0)
dovecot: Apr 21 18:24:23 Error: child 95800 (imap) killed with signal 6

but this doesn't work either.


Anything other I could try?




Thanks,
Adam
-- 
Adam                 adam@os.inf.tu-dresden.de
  Lackorzynski         http://os.inf.tu-dresden.de/~adam/

From tss@iki.fi  Mon Apr 21 23:02:13 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 21 Apr 2003 23:02:13 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id B6D8723845
	for <dovecot@procontrol.fi>; Mon, 21 Apr 2003 23:02:13 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 4C17E5E017F5; Mon, 21 Apr 2003 23:02:13 +0300 (EEST)
Subject: [dovecot] Re: Using on AIX
From: Timo Sirainen <tss@iki.fi>
To: Adam Lackorzynski <adam@os.inf.tu-dresden.de>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030421185434.GJ21753@os.inf.tu-dresden.de>
References: <20030421185434.GJ21753@os.inf.tu-dresden.de>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1050955333.32157.61.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 21 Apr 2003 23:02:13 +0300
X-archive-position: 636
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 639                                                  
Status: O
Content-Length: 1729

On Mon, 2003-04-21 at 21:54, Adam Lackorzynski wrote:
> Hi,
> 
> I'm trying to install dovecot-0.99.9-test6 with gcc-3.2.2 under AIX (4.3.3) and
> found some problems.
> 
> First, I need to define _XOPEN_SOURCE_EXTENDED to 1 in src/lib/fdpass.c
> and src/auth/mycrypt.c or undefine it to compile successfully.
..
> When I undefine the _XOPEN_SOURCE_EXTENDEDs without modifying the
> original _XOPEN_SOURCE defines, it seems to come further:

I guess leaving it 1 for mycrypt.c is fine. Does AIX have some "AIX"
macro defined? So I could change fdpass.c to have:

#ifndef AIX
#  define _XOPEN_SOURCE_EXTENDED /* for Tru64, breaks AIX */
#endif

> imap(xxx): Apr 21 18:24:23 Panic: file mail-index-data.c: line 439 (mail_index_data_append): assertion failed: ((size & (MEM_ALIGN_SIZE-1)) == 0)

Hmm.. This is quite likely because struct mail_index_data_record_header
isn't padded to take 8 bytes with 32bit off_t. Has all systems until now
really had 64bit off_t? This should fix it:

Index: mail-index.h
===================================================================
RCS file: /home/cvs/dovecot/src/lib-index/mail-index.h,v
retrieving revision 1.73
diff -u -r1.73 mail-index.h
--- mail-index.h        21 Apr 2003 13:42:00 -0000      1.73
+++ mail-index.h        21 Apr 2003 19:58:55 -0000
@@ -167,6 +167,7 @@
        unsigned int data_size; /* including this header */
 
        time_t internal_date;
+       time_t filler;
        uoff_t virtual_size;
 
        uoff_t header_size;


But I'm not sure if I want to commit this change. Maybe some systems
have added the padding elsewhere? Changing the location could break
things. After next release I'll break the index files anyway, I think
I'll leave this fix until then.


From adam@os.inf.tu-dresden.de  Mon Apr 21 23:57:35 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 21 Apr 2003 23:57:35 +0300 (EEST)
Return-Path: <adam@os.inf.tu-dresden.de>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from os.inf.tu-dresden.de (os.inf.tu-dresden.de [141.76.48.99])
	by danu.procontrol.fi (Postfix) with ESMTP id 4FF1B2385F
	for <dovecot@procontrol.fi>; Mon, 21 Apr 2003 23:57:35 +0300 (EEST)
Received: from erwin.inf.tu-dresden.de ([141.76.48.80])
	by os.inf.tu-dresden.de with esmtp (Exim 3.36)
	id 197iM2-00072w-00
	for dovecot@procontrol.fi; Mon, 21 Apr 2003 22:57:34 +0200
Received: from adam by erwin.inf.tu-dresden.de with local (Exim 3.35 #1 (Debian))
	id 197iM2-0005Rp-00
	for <dovecot@procontrol.fi>; Mon, 21 Apr 2003 22:57:34 +0200
Date: Mon, 21 Apr 2003 22:57:34 +0200
From: Adam Lackorzynski <adam@os.inf.tu-dresden.de>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Using on AIX
Message-ID: <20030421205734.GK21753@os.inf.tu-dresden.de>
Mail-Followup-To: dovecot@procontrol.fi
References: <20030421185434.GJ21753@os.inf.tu-dresden.de> <1050955333.32157.61.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
In-Reply-To: <1050955333.32157.61.camel@hurina>
User-Agent: Mutt/1.4i
X-archive-position: 637
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: adam@os.inf.tu-dresden.de
Precedence: bulk
X-list: dovecot
X-UID: 640                                                  
Status: O
Content-Length: 2768

On Mon Apr 21, 2003 at 23:02:13 +0300, Timo Sirainen wrote:
> Hmm.. This is quite likely because struct mail_index_data_record_header
> isn't padded to take 8 bytes with 32bit off_t. Has all systems until now
> really had 64bit off_t? This should fix it:
>
> +       time_t filler;

Now, the error message is different:

imap(xxx): Apr 21 20:42:14 Error: Corrupted index data file .../Mail/.imap/INBOX/.imap.index.data: Invalid location field for record 1
imap(xxx): Apr 21 20:42:14 Error: Corrupted index data file .../Mail/.imap/INBOX/.imap.index.data: Invalid location field for record 1
dovecot: Apr 21 20:42:14 Error: child 73232 (imap) killed with signal 11

I deleted the .imap dir before connecting and the mbox file is empty in
this case here.

If the mbox contains some mails (7 in this case), I'm getting this
(.imap dir also didn't exist before):

imap(xxx): Apr 21 20:52:52 Error: Corrupted index data file .../Mail/test/.imap/box2/.imap.index.data: Invalid location field for record 7



That's what I have for now. The AC_AIX is probably not needed...

diff -ur dovecot-0.99.9-test6.orig/configure.in dovecot-0.99.9-test6/configure.in
--- dovecot-0.99.9-test6.orig/configure.in	Mon Apr 21 17:54:11 2003
+++ dovecot-0.99.9-test6/configure.in	Mon Apr 21 22:06:09 2003
@@ -5,6 +5,7 @@
 
 AM_MAINTAINER_MODE
 
+AC_AIX
 AC_ISC_POSIX
 AC_PROG_CC
 AC_PROG_CPP
diff -ur dovecot-0.99.9-test6.orig/src/auth/mycrypt.c dovecot-0.99.9-test6/src/auth/mycrypt.c
--- dovecot-0.99.9-test6.orig/src/auth/mycrypt.c	Tue Nov 26 19:39:57 2002
+++ dovecot-0.99.9-test6/src/auth/mycrypt.c	Mon Apr 21 22:15:16 2003
@@ -1,5 +1,5 @@
 #define _XOPEN_SOURCE 4
-#define _XOPEN_SOURCE_EXTENDED
+#define _XOPEN_SOURCE_EXTENDED 1
 #define _XOPEN_VERSION 4
 #define _XPG4_2
 #include <unistd.h>
diff -ur dovecot-0.99.9-test6.orig/src/lib/fdpass.c dovecot-0.99.9-test6/src/lib/fdpass.c
--- dovecot-0.99.9-test6.orig/src/lib/fdpass.c	Wed Apr  9 00:58:30 2003
+++ dovecot-0.99.9-test6/src/lib/fdpass.c	Mon Apr 21 22:20:28 2003
@@ -32,7 +32,9 @@
 */
 
 #define _XPG4_2
-#define _XOPEN_SOURCE_EXTENDED /* for Tru64 */
+#ifndef _AIX
+#  define _XOPEN_SOURCE_EXTENDED /* for Tru64, breaks AIX */
+#endif
 
 #include "lib.h"
 #include "fdpass.h"
diff -ur dovecot-0.99.9-test6.orig/src/lib-index/mail-index.h dovecot-0.99.9-test6/src/lib-index/mail-index.h
--- dovecot-0.99.9-test6.orig/src/lib-index/mail-index.h	Mon Apr 21 17:45:52 2003
+++ dovecot-0.99.9-test6/src/lib-index/mail-index.h	Mon Apr 21 22:40:04 2003
@@ -167,6 +167,7 @@
 	unsigned int data_size; /* including this header */
 
 	time_t internal_date;
+	time_t filler;
 	uoff_t virtual_size;
 
 	uoff_t header_size;


Adam
-- 
Adam                 adam@os.inf.tu-dresden.de
  Lackorzynski         http://os.inf.tu-dresden.de/~adam/

From lfarkas@bnap.hu  Tue Apr 22 13:30:20 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 22 Apr 2003 13:30:20 +0300 (EEST)
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 3E68E2385F
	for <dovecot@procontrol.fi>; Tue, 22 Apr 2003 13:30:20 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id D42A0754003
	for <dovecot@procontrol.fi>; Tue, 22 Apr 2003 12:31:48 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id 581DB3F04
	for <dovecot@procontrol.fi>; Tue, 22 Apr 2003 12:30:15 +0200 (CEST)
Message-ID: <3EA519B4.4020105@bnap.hu>
Date: Tue, 22 Apr 2003 12:30:12 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: [dovecot] index files
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 638
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 641                                                  
Status: O

hi,
what's happend if I change the index type ie. change it back to the default
# mail_cache_fields
while before I use
mail_cache_fields =
and restart dovecot? in this case at the next login the index files are 
regenerated?

-- 
   Levente                               "Si vis pacem para bellum!"



From tss@iki.fi  Tue Apr 22 22:47:10 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 22 Apr 2003 22:47:10 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 156FC23845
	for <dovecot@procontrol.fi>; Tue, 22 Apr 2003 22:47:10 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id D8A925E017F5; Tue, 22 Apr 2003 22:47:09 +0300 (EEST)
Subject: [dovecot] Re: index files
From: Timo Sirainen <tss@iki.fi>
To: Farkas Levente <lfarkas@bnap.hu>
Cc: Dovecot List <dovecot@procontrol.fi>
In-Reply-To: <3EA519B4.4020105@bnap.hu>
References: <3EA519B4.4020105@bnap.hu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1051040829.32159.114.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 22 Apr 2003 22:47:09 +0300
X-archive-position: 639
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 642                                                  
Status: O

On Tue, 2003-04-22 at 13:30, Farkas Levente wrote:
> hi,
> what's happend if I change the index type ie. change it back to the default
> # mail_cache_fields
> while before I use
> mail_cache_fields =
> and restart dovecot? in this case at the next login the index files are 
> regenerated?

No, that setting is used only when the index is created or rebuilt for
some reason.


From tss@iki.fi  Tue Apr 22 22:50:01 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 22 Apr 2003 22:50:01 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 8F66623845
	for <dovecot@procontrol.fi>; Tue, 22 Apr 2003 22:50:01 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 4E2AC5E017F5; Tue, 22 Apr 2003 22:50:01 +0300 (EEST)
Subject: [dovecot] Re: Using on AIX
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030421205734.GK21753@os.inf.tu-dresden.de>
References: <20030421185434.GJ21753@os.inf.tu-dresden.de>
	 <1050955333.32157.61.camel@hurina>
	 <20030421205734.GK21753@os.inf.tu-dresden.de>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1051041001.32159.118.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 22 Apr 2003 22:50:01 +0300
X-archive-position: 640
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 643                                                  
Status: O

On Mon, 2003-04-21 at 23:57, Adam Lackorzynski wrote:
> On Mon Apr 21, 2003 at 23:02:13 +0300, Timo Sirainen wrote:
> > Hmm.. This is quite likely because struct mail_index_data_record_header
> > isn't padded to take 8 bytes with 32bit off_t. Has all systems until now
> > really had 64bit off_t? This should fix it:
> >
> > +       time_t filler;
> 
> Now, the error message is different:
> 
> imap(xxx): Apr 21 20:42:14 Error: Corrupted index data file .../Mail/.imap/INBOX/.imap.index.data: Invalid location field for record 1

Umm. Are you sure the sources got fully rebuilt after you added the
filler? That looks like it..


From lfarkas@bnap.hu  Wed Apr 23 00:10:42 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 23 Apr 2003 00:10:43 +0300 (EEST)
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id C349F2385F
	for <dovecot@procontrol.fi>; Wed, 23 Apr 2003 00:10:42 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP
	id 2C510754003; Tue, 22 Apr 2003 23:12:16 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP
	id CCC1A3EF5; Tue, 22 Apr 2003 23:10:40 +0200 (CEST)
Message-ID: <3EA5AFD0.9070601@bnap.hu>
Date: Tue, 22 Apr 2003 23:10:40 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20021218
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Timo Sirainen <tss@iki.fi>
Cc: Dovecot List <dovecot@procontrol.fi>
Subject: [dovecot] Re: index files
References: <3EA519B4.4020105@bnap.hu> <1051040829.32159.114.camel@hurina>
In-Reply-To: <1051040829.32159.114.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 641
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 644                                                  
Status: O

Timo Sirainen wrote:
> On Tue, 2003-04-22 at 13:30, Farkas Levente wrote:
> 
>>hi,
>>what's happend if I change the index type ie. change it back to the default
>># mail_cache_fields
>>while before I use
>>mail_cache_fields =
>>and restart dovecot? in this case at the next login the index files are 
>>regenerated?
> 
> 
> No, that setting is used only when the index is created or rebuilt for
> some reason.

so I've to delete everyone's index files?


-- 
   Levente                               "Si vis pacem para bellum!"



From adam@os.inf.tu-dresden.de  Wed Apr 23 01:45:44 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 23 Apr 2003 01:45:44 +0300 (EEST)
Return-Path: <adam@os.inf.tu-dresden.de>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from os.inf.tu-dresden.de (os.inf.tu-dresden.de [141.76.48.99])
	by danu.procontrol.fi (Postfix) with ESMTP id 169762385F
	for <dovecot@procontrol.fi>; Wed, 23 Apr 2003 01:45:44 +0300 (EEST)
Received: from erwin.inf.tu-dresden.de ([141.76.48.80])
	by os.inf.tu-dresden.de with esmtp (Exim 3.36)
	id 1986WE-000HYm-00
	for dovecot@procontrol.fi; Wed, 23 Apr 2003 00:45:42 +0200
Received: from adam by erwin.inf.tu-dresden.de with local (Exim 3.35 #1 (Debian))
	id 1986WE-0002NA-00
	for <dovecot@procontrol.fi>; Wed, 23 Apr 2003 00:45:42 +0200
Date: Wed, 23 Apr 2003 00:45:42 +0200
From: Adam Lackorzynski <adam@os.inf.tu-dresden.de>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Using on AIX
Message-ID: <20030422224542.GO21753@os.inf.tu-dresden.de>
Mail-Followup-To: dovecot@procontrol.fi
References: <20030421185434.GJ21753@os.inf.tu-dresden.de> <1050955333.32157.61.camel@hurina> <20030421205734.GK21753@os.inf.tu-dresden.de> <1051041001.32159.118.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
In-Reply-To: <1051041001.32159.118.camel@hurina>
User-Agent: Mutt/1.4i
X-archive-position: 642
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: adam@os.inf.tu-dresden.de
Precedence: bulk
X-list: dovecot
X-UID: 645                                                  
Status: O

On Tue Apr 22, 2003 at 22:50:01 +0300, Timo Sirainen wrote:
> > imap(xxx): Apr 21 20:42:14 Error: Corrupted index data file .../Mail/.imap/INBOX/.imap.index.data: Invalid location field for record 1
> 
> Umm. Are you sure the sources got fully rebuilt after you added the
> filler? That looks like it..

Yes, "make clean"'ed it before.




Adam
-- 
Adam                 adam@os.inf.tu-dresden.de
  Lackorzynski         http://os.inf.tu-dresden.de/~adam/

From eskimoe@ananzi.co.za  Wed Apr 23 02:00:01 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 23 Apr 2003 02:00:01 +0300 (EEST)
Return-Path: <eskimoe@ananzi.co.za>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from sun.com (port-212-202-174-30.reverse.qdsl-home.de [212.202.174.30])
	by danu.procontrol.fi (Postfix) with SMTP id 40E2D2385F
	for <dovecot@procontrol.fi>; Wed, 23 Apr 2003 01:59:59 +0300 (EEST)
Received: (qmail 30858 invoked by uid 1000); 22 Apr 2003 23:01:27 -0000
Date: Wed, 23 Apr 2003 01:01:27 +0200
From: Moe Wibble <eskimoe@ananzi.co.za>
To: Dovecot List <dovecot@procontrol.fi>
Subject: [dovecot] Re: errors
Message-ID: <20030422230127.GC17665@woom.net>
Mail-Followup-To: Moe Wibble <eskimoe@ananzi.co.za>,
	Dovecot List <dovecot@procontrol.fi>
References: <3E9D1B27.7090201@bnap.hu> <20030416134628.GA13126@woom.net> <20030420001128.GA18878@woom.net> <1050932973.32157.5.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1050932973.32157.5.camel@hurina>
X-archive-position: 643
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: eskimoe@ananzi.co.za
Precedence: bulk
X-list: dovecot
X-UID: 646                                                  
Status: O

On Mon, Apr 21, 2003 at 04:49:34PM +0300, Timo Sirainen wrote:
> On Sun, 2003-04-20 at 03:11, Moe Wibble wrote:
> > The bug has just hit me again:
> > 
> > Apr 20 02:08:00 rafter imap(moe): Corrupted index file /<snipped>/.INBOX/.imap.index: index.next_uid (495) > uidlist.nex
> > t_uid (494)
> > 
> > Removing .imap.index has muted it once again.
> > 
> > Is this problem being worked on?
> 
> I think it should be fixing itself now. The index is rebuilt
> automatically next time the mailbox is opened.

I have just updated and the problem has not appeared again since then.
Hope it stays that way.

> I also found a few more potential problems with it, -test6 should come
> out soon.

What kind of problems?


regards!
-- 
MW


From tss@iki.fi  Wed Apr 23 02:33:46 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 23 Apr 2003 02:33:46 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 3E45223845
	for <dovecot@procontrol.fi>; Wed, 23 Apr 2003 02:33:46 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 9F4315E017F5; Wed, 23 Apr 2003 02:33:45 +0300 (EEST)
Subject: [dovecot] Re: index files
From: Timo Sirainen <tss@iki.fi>
To: Farkas Levente <lfarkas@bnap.hu>
Cc: Dovecot List <dovecot@procontrol.fi>
In-Reply-To: <3EA5AFD0.9070601@bnap.hu>
References: <3EA519B4.4020105@bnap.hu> <1051040829.32159.114.camel@hurina>
	 <3EA5AFD0.9070601@bnap.hu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1051054425.32159.123.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 23 Apr 2003 02:33:45 +0300
X-archive-position: 644
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 647                                                  
Status: O

On Wed, 2003-04-23 at 00:10, Farkas Levente wrote:
> >>what's happend if I change the index type ie. change it back to the default
> >># mail_cache_fields
> >>while before I use
> >>mail_cache_fields =
> >>and restart dovecot? in this case at the next login the index files are 
> >>regenerated?
> > 
> > 
> > No, that setting is used only when the index is created or rebuilt for
> > some reason.
> 
> so I've to delete everyone's index files?

No, just leave them the way they are. Dovecot starts automatically
caching the fields that the client uses.

Or is there some reason you thought you wanted this? It's slower?


From tss@iki.fi  Wed Apr 23 02:50:55 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 23 Apr 2003 02:50:55 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 392FB23845
	for <dovecot@procontrol.fi>; Wed, 23 Apr 2003 02:50:55 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 92D045E017F5; Wed, 23 Apr 2003 02:50:54 +0300 (EEST)
Subject: [dovecot] Re: Using on AIX
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030422224542.GO21753@os.inf.tu-dresden.de>
References: <20030421185434.GJ21753@os.inf.tu-dresden.de>
	 <1050955333.32157.61.camel@hurina>
	 <20030421205734.GK21753@os.inf.tu-dresden.de>
	 <1051041001.32159.118.camel@hurina>
	 <20030422224542.GO21753@os.inf.tu-dresden.de>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1051055454.32157.126.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 23 Apr 2003 02:50:54 +0300
X-archive-position: 645
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 648                                                  
Status: O

On Wed, 2003-04-23 at 01:45, Adam Lackorzynski wrote:
> On Tue Apr 22, 2003 at 22:50:01 +0300, Timo Sirainen wrote:
> > > imap(xxx): Apr 21 20:42:14 Error: Corrupted index data file .../Mail/.imap/INBOX/.imap.index.data: Invalid location field for record 1
> > 
> > Umm. Are you sure the sources got fully rebuilt after you added the
> > filler? That looks like it..
> 
> Yes, "make clean"'ed it before.

Something's really messed up then. Maybe there's some mmap() problems,
try if setting "default_mail_env = mbox:~/Mail:INDEX=MEMORY" helps?


From lfarkas@bnap.hu  Wed Apr 23 11:27:01 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 23 Apr 2003 11:27:01 +0300 (EEST)
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 903122385F
	for <dovecot@procontrol.fi>; Wed, 23 Apr 2003 11:27:01 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP
	id 9D66F754004; Wed, 23 Apr 2003 10:28:39 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP
	id E3CAF3EF5; Wed, 23 Apr 2003 10:26:59 +0200 (CEST)
Message-ID: <3EA64E53.7010806@bnap.hu>
Date: Wed, 23 Apr 2003 10:26:59 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Timo Sirainen <tss@iki.fi>
Cc: Dovecot List <dovecot@procontrol.fi>
Subject: [dovecot] Re: index files
References: <3EA519B4.4020105@bnap.hu> <1051040829.32159.114.camel@hurina>	 <3EA5AFD0.9070601@bnap.hu> <1051054425.32159.123.camel@hurina>
In-Reply-To: <1051054425.32159.123.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 646
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 649                                                  
Status: O
Content-Length: 1472

Timo Sirainen wrote:
> On Wed, 2003-04-23 at 00:10, Farkas Levente wrote:
> 
>>>>what's happend if I change the index type ie. change it back to the default
>>>># mail_cache_fields
>>>>while before I use
>>>>mail_cache_fields =
>>>>and restart dovecot? in this case at the next login the index files are 
>>>>regenerated?
>>>
>>>
>>>No, that setting is used only when the index is created or rebuilt for
>>>some reason.
>>
>>so I've to delete everyone's index files?
> 
> 
> No, just leave them the way they are. Dovecot starts automatically
> caching the fields that the client uses.
> 
> Or is there some reason you thought you wanted this? It's slower?

ok the whole story:
- once (one of the cvs version) we got a few corrupted index file.
- then I delete all index file
- after that (as I wrote it) the load goes so high I've to stop dovecot.
- delete all index file and modify dovecot.conf :
   mail_cache_fields =
- but now I assume the index and high load problem may be solved so I'd
   like to put back the default cache schema.
and my question is:
should I delete the old index files (which contains no fileds) in
order to create new index files (which contains the default fields) or
it will happned automaticaly?
from you first answer it seems to me if the index is not corrupted than 
it never will recreated. but from the second it seems it will regenerate 
it automatically?
so?


-- 
   Levente                               "Si vis pacem para bellum!"



From tss@iki.fi  Wed Apr 23 14:13:10 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 23 Apr 2003 14:13:10 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 6F1812385F
	for <dovecot@procontrol.fi>; Wed, 23 Apr 2003 14:13:10 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 7473E5E017F5; Wed, 23 Apr 2003 14:13:09 +0300 (EEST)
Subject: [dovecot] Re: index files
From: Timo Sirainen <tss@iki.fi>
To: Farkas Levente <lfarkas@bnap.hu>
Cc: Dovecot List <dovecot@procontrol.fi>
In-Reply-To: <3EA64E53.7010806@bnap.hu>
References: <3EA519B4.4020105@bnap.hu> <1051040829.32159.114.camel@hurina>
	 <3EA5AFD0.9070601@bnap.hu> <1051054425.32159.123.camel@hurina>
	 <3EA64E53.7010806@bnap.hu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1051096388.32159.140.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 23 Apr 2003 14:13:09 +0300
X-archive-position: 647
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 650                                                  
Status: O
Content-Length: 2060

On Wed, 2003-04-23 at 11:26, Farkas Levente wrote:
> ok the whole story:
> - once (one of the cvs version) we got a few corrupted index file.
> - then I delete all index file
> - after that (as I wrote it) the load goes so high I've to stop dovecot.
> - delete all index file and modify dovecot.conf :
>    mail_cache_fields =
> - but now I assume the index and high load problem may be solved so I'd
>    like to put back the default cache schema.

But currently there's no real high load problems with empty
mail_cache_fields?

> and my question is:
> should I delete the old index files (which contains no fileds) in
> order to create new index files (which contains the default fields) or
> it will happned automaticaly?
> from you first answer it seems to me if the index is not corrupted than 
> it never will recreated. but from the second it seems it will regenerate 
> it automatically?
> so?

It goes like this:

- When index is first created, mail_cache_fields setting is saved into
header.cache_fields. All existing mails are indexed with those fields
cached
- If client does something where a cached field would have been a
speedup, but the field isn't cached, header.cache_fields is updated to
include that field
- All new mails that are indexed will have the new field cached as well,
but the old ones aren't changed
- If client again does it with an old mail where it wasn't indexed, then
Dovecot will rebuild the cache for all mails in the index so they all
contain the wanted cached fields

So even if you don't cache anything initially, they should get
automatically cached if client wants them. Clients behave very
differently so we don't automatically cache everything, if cached field
is not needed it just slows down things.

This still isn't the optimal caching behaviour, some clients cache
everything locally and fetch data for only new mails. In that case
cached fields would be mostly useless. Even if that client or some other
occationally fetches some data again, it's likely better for overall
performance if nothing is cached.


From lfarkas@bnap.hu  Wed Apr 23 14:18:19 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 23 Apr 2003 14:18:19 +0300 (EEST)
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 474A423845
	for <dovecot@procontrol.fi>; Wed, 23 Apr 2003 14:18:19 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP
	id C218D754003; Wed, 23 Apr 2003 13:19:53 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP
	id D44BD3EF5; Wed, 23 Apr 2003 13:18:12 +0200 (CEST)
Message-ID: <3EA67674.5040902@bnap.hu>
Date: Wed, 23 Apr 2003 13:18:12 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Timo Sirainen <tss@iki.fi>, Dovecot List <dovecot@procontrol.fi>
Subject: [dovecot] Re: index files
References: <3EA519B4.4020105@bnap.hu> <1051040829.32159.114.camel@hurina>	 <3EA5AFD0.9070601@bnap.hu> <1051054425.32159.123.camel@hurina>	 <3EA64E53.7010806@bnap.hu> <1051096388.32159.140.camel@hurina>
In-Reply-To: <1051096388.32159.140.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 648
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 651                                                  
Status: O
Content-Length: 2376

Timo Sirainen wrote:
> On Wed, 2003-04-23 at 11:26, Farkas Levente wrote:
> 
>>ok the whole story:
>>- once (one of the cvs version) we got a few corrupted index file.
>>- then I delete all index file
>>- after that (as I wrote it) the load goes so high I've to stop dovecot.
>>- delete all index file and modify dovecot.conf :
>>   mail_cache_fields =
>>- but now I assume the index and high load problem may be solved so I'd
>>   like to put back the default cache schema.
> 
> 
> But currently there's no real high load problems with empty
> mail_cache_fields?

no currently ther is not. that's why I'd like to test what happens if I 
trun it back.

>>and my question is:
>>should I delete the old index files (which contains no fileds) in
>>order to create new index files (which contains the default fields) or
>>it will happned automaticaly?
>>from you first answer it seems to me if the index is not corrupted than 
>>it never will recreated. but from the second it seems it will regenerate 
>>it automatically?
>>so?
> 
> 
> It goes like this:
> 
> - When index is first created, mail_cache_fields setting is saved into
> header.cache_fields. All existing mails are indexed with those fields
> cached
> - If client does something where a cached field would have been a
> speedup, but the field isn't cached, header.cache_fields is updated to
> include that field
> - All new mails that are indexed will have the new field cached as well,
> but the old ones aren't changed
> - If client again does it with an old mail where it wasn't indexed, then
> Dovecot will rebuild the cache for all mails in the index so they all
> contain the wanted cached fields
> 
> So even if you don't cache anything initially, they should get
> automatically cached if client wants them. Clients behave very
> differently so we don't automatically cache everything, if cached field
> is not needed it just slows down things.
> 
> This still isn't the optimal caching behaviour, some clients cache
> everything locally and fetch data for only new mails. In that case
> cached fields would be mostly useless. Even if that client or some other
> occationally fetches some data again, it's likely better for overall
> performance if nothing is cached.

ok. so I don't have to delete them and force the regeneration.


-- 
   Levente                               "Si vis pacem para bellum!"



From adam@os.inf.tu-dresden.de  Wed Apr 23 14:43:14 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 23 Apr 2003 14:43:14 +0300 (EEST)
Return-Path: <adam@os.inf.tu-dresden.de>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from os.inf.tu-dresden.de (os.inf.tu-dresden.de [141.76.48.99])
	by danu.procontrol.fi (Postfix) with ESMTP id 85CDA23845
	for <dovecot@procontrol.fi>; Wed, 23 Apr 2003 14:43:14 +0300 (EEST)
Received: from erwin.inf.tu-dresden.de ([141.76.48.80])
	by os.inf.tu-dresden.de with esmtp (Exim 3.36)
	id 198Ief-000Nim-00
	for dovecot@procontrol.fi; Wed, 23 Apr 2003 13:43:13 +0200
Received: from adam by erwin.inf.tu-dresden.de with local (Exim 3.35 #1 (Debian))
	id 198Ief-00077U-00
	for <dovecot@procontrol.fi>; Wed, 23 Apr 2003 13:43:13 +0200
Date: Wed, 23 Apr 2003 13:43:13 +0200
From: Adam Lackorzynski <adam@os.inf.tu-dresden.de>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Using on AIX
Message-ID: <20030423114312.GQ21753@os.inf.tu-dresden.de>
Mail-Followup-To: dovecot@procontrol.fi
References: <20030421185434.GJ21753@os.inf.tu-dresden.de> <1050955333.32157.61.camel@hurina> <20030421205734.GK21753@os.inf.tu-dresden.de> <1051041001.32159.118.camel@hurina> <20030422224542.GO21753@os.inf.tu-dresden.de> <1051055454.32157.126.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
In-Reply-To: <1051055454.32157.126.camel@hurina>
User-Agent: Mutt/1.4i
X-archive-position: 649
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: adam@os.inf.tu-dresden.de
Precedence: bulk
X-list: dovecot
X-UID: 652                                                  
Status: O

On Wed Apr 23, 2003 at 02:50:54 +0300, Timo Sirainen wrote:
> On Wed, 2003-04-23 at 01:45, Adam Lackorzynski wrote:
> > On Tue Apr 22, 2003 at 22:50:01 +0300, Timo Sirainen wrote:
> > > > imap(xxx): Apr 21 20:42:14 Error: Corrupted index data file .../Mail/.imap/INBOX/.imap.index.data: Invalid location field for record 1
> > > 
> > > Umm. Are you sure the sources got fully rebuilt after you added the
> > > filler? That looks like it..
> > 
> > Yes, "make clean"'ed it before.
> 
> Something's really messed up then. Maybe there's some mmap() problems,
> try if setting "default_mail_env = mbox:~/Mail:INDEX=MEMORY" helps?

This results in

dovecot: Apr 23 11:16:05 Error: child 86116 (imap) killed with signal 11

Is it worth finding out where the sigsegv in imap happens?



Adam
-- 
Adam                 adam@os.inf.tu-dresden.de
  Lackorzynski         http://os.inf.tu-dresden.de/~adam/

From tss@iki.fi  Wed Apr 23 15:13:28 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 23 Apr 2003 15:13:28 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 63E0A23845
	for <dovecot@procontrol.fi>; Wed, 23 Apr 2003 15:13:28 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id D47E75E017F5; Wed, 23 Apr 2003 15:13:27 +0300 (EEST)
Subject: [dovecot] Re: Using on AIX
From: Timo Sirainen <tss@iki.fi>
To: Adam Lackorzynski <adam@os.inf.tu-dresden.de>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030423114312.GQ21753@os.inf.tu-dresden.de>
References: <20030421185434.GJ21753@os.inf.tu-dresden.de>
	 <1050955333.32157.61.camel@hurina>
	 <20030421205734.GK21753@os.inf.tu-dresden.de>
	 <1051041001.32159.118.camel@hurina>
	 <20030422224542.GO21753@os.inf.tu-dresden.de>
	 <1051055454.32157.126.camel@hurina>
	 <20030423114312.GQ21753@os.inf.tu-dresden.de>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1051100007.32157.162.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 23 Apr 2003 15:13:27 +0300
X-archive-position: 650
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 653                                                  
Status: O

On Wed, 2003-04-23 at 14:43, Adam Lackorzynski wrote:
> > Something's really messed up then. Maybe there's some mmap() problems,
> > try if setting "default_mail_env = mbox:~/Mail:INDEX=MEMORY" helps?
> 
> This results in
> 
> dovecot: Apr 23 11:16:05 Error: child 86116 (imap) killed with signal 11
> 
> Is it worth finding out where the sigsegv in imap happens?

Yes, I'd like to know why it crashes. I've tried to prevent that
everywhere. Two ways to do this:

a) Run the imap binary directly:
MAIL=mbox:~/Mail:INDEX=MEMORY gdb /usr/local/libexec/dovecot/imap
r
x select inbox
.. crash?
bt

b) Set mail_drop_priv_before_exec = yes in config file, and core dump
should be written to your home directory.

I think I should write this down somewhere in web :)


From adam@os.inf.tu-dresden.de  Wed Apr 23 15:56:12 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 23 Apr 2003 15:56:12 +0300 (EEST)
Return-Path: <adam@os.inf.tu-dresden.de>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from os.inf.tu-dresden.de (os.inf.tu-dresden.de [141.76.48.99])
	by danu.procontrol.fi (Postfix) with ESMTP id D78D72385F
	for <dovecot@procontrol.fi>; Wed, 23 Apr 2003 15:56:11 +0300 (EEST)
Received: from erwin.inf.tu-dresden.de ([141.76.48.80])
	by os.inf.tu-dresden.de with esmtp (Exim 3.36)
	id 198JnG-000Zl2-00
	for dovecot@procontrol.fi; Wed, 23 Apr 2003 14:56:10 +0200
Received: from adam by erwin.inf.tu-dresden.de with local (Exim 3.35 #1 (Debian))
	id 198JnG-0000e4-00
	for <dovecot@procontrol.fi>; Wed, 23 Apr 2003 14:56:10 +0200
Date: Wed, 23 Apr 2003 14:56:10 +0200
From: Adam Lackorzynski <adam@os.inf.tu-dresden.de>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Using on AIX
Message-ID: <20030423125610.GR21753@os.inf.tu-dresden.de>
Mail-Followup-To: dovecot@procontrol.fi
References: <20030421185434.GJ21753@os.inf.tu-dresden.de> <1050955333.32157.61.camel@hurina> <20030421205734.GK21753@os.inf.tu-dresden.de> <1051041001.32159.118.camel@hurina> <20030422224542.GO21753@os.inf.tu-dresden.de> <1051055454.32157.126.camel@hurina> <20030423114312.GQ21753@os.inf.tu-dresden.de> <1051100007.32157.162.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
In-Reply-To: <1051100007.32157.162.camel@hurina>
User-Agent: Mutt/1.4i
X-archive-position: 651
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: adam@os.inf.tu-dresden.de
Precedence: bulk
X-list: dovecot
X-UID: 654                                                  
Status: O
Content-Length: 2174

On Wed Apr 23, 2003 at 15:13:27 +0300, Timo Sirainen wrote:
> Yes, I'd like to know why it crashes. I've tried to prevent that
> everywhere. Two ways to do this:

Program received signal SIGSEGV, Segmentation fault.
0xd017f528 in memset () from /usr/lib/libc.a(shr.o)
(gdb) bt
#0  0xd017f528 in memset () from /usr/lib/libc.a(shr.o)
#1  0x1001e5a4 in mail_index_init_header (index=0x2000ef58, hdr=0xffffffff)
    at mail-index-open.c:231
#2  0x1001e820 in mail_index_create_memory (index=0x2000ef58, flags=19)
    at mail-index-open.c:289
#3  0x1001ec24 in mail_index_open (index=0x2000ef58, flags=3)
    at mail-index-open.c:411
#4  0x1000ded0 in index_storage_init (storage=0x200096a8, box=0x20000cb0, 
    index=0x2000ef58, name=0x10065ae8 "INBOX", readonly=0, fast=0)
    at index-storage.c:259
#5  0x100401e0 in mbox_open (storage=0x200096a8, name=0x10065ae8 "INBOX", 
    readonly=0, fast=0) at mbox-storage.c:360
#6  0x100402f0 in mbox_open_mailbox (storage=0x200096a8, 
    name=0x20009a78 "inbox", readonly=0, fast=0) at mbox-storage.c:380
#7  0x1004e23c in _cmd_select_full (client=0x200097a8, readonly=0)
    at cmd-select.c:23
#8  0x1004e4c4 in cmd_select (client=0xffffffff) at cmd-select.c:87
#9  0x1004b9ec in client_handle_input (client=0x200097a8) at client.c:306
#10 0x1004bb5c in _client_input (context=0x200097a8) at client.c:342
#11 0x10001ec0 in io_loop_handler_run (ioloop=0x20008fe8) at ioloop-poll.c:212
#12 0x1000148c in io_loop_run (ioloop=0x20008fe8) at ioloop.c:295
#13 0x10000964 in main (argc=-1, argv=0x20004de4, envp=0x2ff22b80)
    at main.c:166
---Type <return> to continue, or q <return> to quit---
#14 0x100001dc in __start ()
(gdb) 


The problem seems to be that

  index->mmap_base = mmap_anon(index->mmap_full_length);

in lib-index/mail-index-open.c(287) returns -1 (MAP_FAILED) which is
then fed to mail_index_init_header(..., 0xffffffff) without being
checked.

The mmap in anon_mmap_fixed in lib/mmap-anon.c returns
"Not enough space" in errno. The parameter values are
"address=0x00002000 length=0x00002000".





Adam
-- 
Adam                 adam@os.inf.tu-dresden.de
  Lackorzynski         http://os.inf.tu-dresden.de/~adam/

From tss@iki.fi  Wed Apr 23 16:29:55 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 23 Apr 2003 16:29:55 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id B1BFA23845
	for <dovecot@procontrol.fi>; Wed, 23 Apr 2003 16:29:55 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 55F155E017F5; Wed, 23 Apr 2003 16:29:55 +0300 (EEST)
Subject: [dovecot] Re: Using on AIX
From: Timo Sirainen <tss@iki.fi>
To: Adam Lackorzynski <adam@os.inf.tu-dresden.de>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030423125610.GR21753@os.inf.tu-dresden.de>
References: <20030421185434.GJ21753@os.inf.tu-dresden.de>
	 <1050955333.32157.61.camel@hurina>
	 <20030421205734.GK21753@os.inf.tu-dresden.de>
	 <1051041001.32159.118.camel@hurina>
	 <20030422224542.GO21753@os.inf.tu-dresden.de>
	 <1051055454.32157.126.camel@hurina>
	 <20030423114312.GQ21753@os.inf.tu-dresden.de>
	 <1051100007.32157.162.camel@hurina>
	 <20030423125610.GR21753@os.inf.tu-dresden.de>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1051104595.32157.176.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 23 Apr 2003 16:29:55 +0300
X-archive-position: 652
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 655                                                  
Status: O
Content-Length: 1674

On Wed, 2003-04-23 at 15:56, Adam Lackorzynski wrote:
> The problem seems to be that
> 
>   index->mmap_base = mmap_anon(index->mmap_full_length);
> 
> in lib-index/mail-index-open.c(287) returns -1 (MAP_FAILED) which is
> then fed to mail_index_init_header(..., 0xffffffff) without being
> checked.

Right, I've missed all of them for some reason. Added to CVS.

> The mmap in anon_mmap_fixed in lib/mmap-anon.c returns
> "Not enough space" in errno. The parameter values are
> "address=0x00002000 length=0x00002000".

Linux and *BSD returns only EINVAL if address and/or length is invalid,
but UNIX98 said ENOMEM can be returned too then. This is a bit annoying
in that I can't now know if the mmap() failed because there's really no
memory or because the address was just invalid. If it's because there's
no memory, Dovecot will try a bit too long before failing. This should
anyway fix:

RCS file: /home/cvs/dovecot/src/lib/mmap-anon.c,v
retrieving revision 1.10
diff -u -r1.10 mmap-anon.c
--- mmap-anon.c 29 Dec 2002 19:33:04 -0000      1.10
+++ mmap-anon.c 23 Apr 2003 13:23:41 -0000
@@ -176,7 +176,7 @@
                if (ret == 0)
                        break;
 
-               if (ret < 0 && errno != EINVAL)
+               if (ret < 0 && errno != EINVAL && errno != ENOMEM)
                        return MAP_FAILED;
        }
 
@@ -200,7 +200,7 @@
        }
 
        if (anon_mmap_fixed(grow_base, new_size - hdr->size) < 0) {
-               if (errno == EINVAL) {
+               if (errno == EINVAL || errno == ENOMEM) {
                        /* can't grow, wanted address space is already in use */
                        return 0;
                }


From adam@os.inf.tu-dresden.de  Wed Apr 23 18:03:23 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 23 Apr 2003 18:03:23 +0300 (EEST)
Return-Path: <adam@os.inf.tu-dresden.de>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from os.inf.tu-dresden.de (os.inf.tu-dresden.de [141.76.48.99])
	by danu.procontrol.fi (Postfix) with ESMTP id AD3CC2385F
	for <dovecot@procontrol.fi>; Wed, 23 Apr 2003 18:03:23 +0300 (EEST)
Received: from erwin.inf.tu-dresden.de ([141.76.48.80])
	by os.inf.tu-dresden.de with esmtp (Exim 3.36)
	id 198LmM-000CY0-00
	for dovecot@procontrol.fi; Wed, 23 Apr 2003 17:03:22 +0200
Received: from adam by erwin.inf.tu-dresden.de with local (Exim 3.35 #1 (Debian))
	id 198LmM-00017h-00
	for <dovecot@procontrol.fi>; Wed, 23 Apr 2003 17:03:22 +0200
Date: Wed, 23 Apr 2003 17:03:22 +0200
From: Adam Lackorzynski <adam@os.inf.tu-dresden.de>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Using on AIX
Message-ID: <20030423150322.GT21753@os.inf.tu-dresden.de>
Mail-Followup-To: dovecot@procontrol.fi
References: <20030421185434.GJ21753@os.inf.tu-dresden.de> <1050955333.32157.61.camel@hurina> <20030421205734.GK21753@os.inf.tu-dresden.de> <1051041001.32159.118.camel@hurina> <20030422224542.GO21753@os.inf.tu-dresden.de> <1051055454.32157.126.camel@hurina> <20030423114312.GQ21753@os.inf.tu-dresden.de> <1051100007.32157.162.camel@hurina> <20030423125610.GR21753@os.inf.tu-dresden.de> <1051104595.32157.176.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
In-Reply-To: <1051104595.32157.176.camel@hurina>
User-Agent: Mutt/1.4i
X-archive-position: 653
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: adam@os.inf.tu-dresden.de
Precedence: bulk
X-list: dovecot
X-UID: 656                                                  
Status: O
Content-Length: 2012

On Wed Apr 23, 2003 at 16:29:55 +0300, Timo Sirainen wrote:
> Linux and *BSD returns only EINVAL if address and/or length is invalid,
> but UNIX98 said ENOMEM can be returned too then. This is a bit annoying
> in that I can't now know if the mmap() failed because there's really no
> memory or because the address was just invalid. If it's because there's
> no memory, Dovecot will try a bit too long before failing. This should
> anyway fix:

Hmm, mmap seems broken somehow or something:

x select inbox
address=00002000 length=00002000
mmap: : Not enough space
address=04002000 length=00002000
mmap: : Not enough space
address=08002000 length=00002000
mmap: : Not enough space
address=0c002000 length=00002000
mmap: : Not enough space
address=10002000 length=00002000
mmap: : Not enough space
address=14002000 length=00002000
mmap: : Not enough space
address=18002000 length=00002000
mmap: : Not enough space
address=1c002000 length=00002000
mmap: : Not enough space
address=00002000 length=00002000
mmap: : Not enough space
....

address=1fed2000 length=00002000
mmap: : Not enough space
address=1fee2000 length=00002000
mmap: : Not enough space
address=1fef2000 length=00002000
mmap: : Not enough space
address=1ff02000 length=00002000
mmap: : Not enough space
address=1ff12000 length=00002000
mmap: : Not enough space

Program received signal SIGSEGV, Segmentation fault.
0xd017f528 in memset () from /usr/lib/libc.a(shr.o)
(gdb) bt
#0  0xd017f528 in memset () from /usr/lib/libc.a(shr.o)
#1  0x1001e64c in mail_index_init_header (index=0x2000f038, hdr=0xffffffff)
    at mail-index-open.c:231
#2  0x1001e8c8 in mail_index_create_memory (index=0x2000f038, flags=19)
    at mail-index-open.c:289
#3  0x1001eccc in mail_index_open (index=0x2000f038, flags=3)
    at mail-index-open.c:411
...

The output is from anon_mmap_fixed.

I don't have the return checks in yet, that's why the sigsegv.


Adam
-- 
Adam                 adam@os.inf.tu-dresden.de
  Lackorzynski         http://os.inf.tu-dresden.de/~adam/

From tss@iki.fi  Wed Apr 23 18:58:44 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 23 Apr 2003 18:58:44 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id E606E23845
	for <dovecot@procontrol.fi>; Wed, 23 Apr 2003 18:58:43 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id AF3365E017F5; Wed, 23 Apr 2003 18:58:43 +0300 (EEST)
Subject: [dovecot] Re: Using on AIX
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030423150322.GT21753@os.inf.tu-dresden.de>
References: <20030421185434.GJ21753@os.inf.tu-dresden.de>
	 <1050955333.32157.61.camel@hurina>
	 <20030421205734.GK21753@os.inf.tu-dresden.de>
	 <1051041001.32159.118.camel@hurina>
	 <20030422224542.GO21753@os.inf.tu-dresden.de>
	 <1051055454.32157.126.camel@hurina>
	 <20030423114312.GQ21753@os.inf.tu-dresden.de>
	 <1051100007.32157.162.camel@hurina>
	 <20030423125610.GR21753@os.inf.tu-dresden.de>
	 <1051104595.32157.176.camel@hurina>
	 <20030423150322.GT21753@os.inf.tu-dresden.de>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1051113523.32157.202.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 23 Apr 2003 18:58:43 +0300
X-archive-position: 654
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 657                                                  
Status: O

On Wed, 2003-04-23 at 18:03, Adam Lackorzynski wrote:
> Hmm, mmap seems broken somehow or something:
> 
> x select inbox
> address=00002000 length=00002000
..
> address=00002000 length=00002000
> mmap: : Not enough space

Hmm. It wraps around to original location? It shouldn't do that. Or
maybe that's just different mmap_anon() call.

Anyway, I changed it now so that it fallbacks to non-fixed mmap() after
100 tries. mremap_anon() was also somewhat broken. I put 0.99.9-test7 to
web page which fixes these and other stuff.


From adam@os.inf.tu-dresden.de  Wed Apr 23 19:32:50 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 23 Apr 2003 19:32:50 +0300 (EEST)
Return-Path: <adam@os.inf.tu-dresden.de>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from os.inf.tu-dresden.de (os.inf.tu-dresden.de [141.76.48.99])
	by danu.procontrol.fi (Postfix) with ESMTP id 04E2E2385F
	for <dovecot@procontrol.fi>; Wed, 23 Apr 2003 19:32:50 +0300 (EEST)
Received: from erwin.inf.tu-dresden.de ([141.76.48.80])
	by os.inf.tu-dresden.de with esmtp (Exim 3.36)
	id 198NAu-000Xta-00
	for dovecot@procontrol.fi; Wed, 23 Apr 2003 18:32:48 +0200
Received: from adam by erwin.inf.tu-dresden.de with local (Exim 3.35 #1 (Debian))
	id 198NAu-0006Zi-00
	for <dovecot@procontrol.fi>; Wed, 23 Apr 2003 18:32:48 +0200
Date: Wed, 23 Apr 2003 18:32:48 +0200
From: Adam Lackorzynski <adam@os.inf.tu-dresden.de>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Using on AIX
Message-ID: <20030423163248.GU21753@os.inf.tu-dresden.de>
Mail-Followup-To: dovecot@procontrol.fi
References: <20030421205734.GK21753@os.inf.tu-dresden.de> <1051041001.32159.118.camel@hurina> <20030422224542.GO21753@os.inf.tu-dresden.de> <1051055454.32157.126.camel@hurina> <20030423114312.GQ21753@os.inf.tu-dresden.de> <1051100007.32157.162.camel@hurina> <20030423125610.GR21753@os.inf.tu-dresden.de> <1051104595.32157.176.camel@hurina> <20030423150322.GT21753@os.inf.tu-dresden.de> <1051113523.32157.202.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
In-Reply-To: <1051113523.32157.202.camel@hurina>
User-Agent: Mutt/1.4i
X-archive-position: 655
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: adam@os.inf.tu-dresden.de
Precedence: bulk
X-list: dovecot
X-UID: 658                                                  
Status: O
Content-Length: 1065

On Wed Apr 23, 2003 at 18:58:43 +0300, Timo Sirainen wrote:
> Anyway, I changed it now so that it fallbacks to non-fixed mmap() after
> 100 tries. mremap_anon() was also somewhat broken. I put 0.99.9-test7 to
> web page which fixes these and other stuff.

The define in fdpass.c has to be _AIX not just AIX.

In mail-index-open.c:289(mail_index_create_memory) you use a path
variable which is undefined.


Now, with the filler still in, it works for an empty inbox. If a mailbox
contains something (7 mails in this case), I get:

imap-login: Apr 23 16:22:16 Info: Login: xxx [x.x.x.x]
imap(xxx): Apr 23 16:22:16 Error: Corrupted index data file HOME/Mail/f/.imap/sf1/.imap.index.data: Invalid location field for record 7

I deleted the .imap dirs before.


And for "default_mail_env = mbox:~/Mail:INDEX=MEMORY", I'm getting:

imap(xxx): Apr 23 16:16:54 Error: msync() failed with index file (in-memory index for HOME/Mail/f/sf1): Invalid argument




Adam
-- 
Adam                 adam@os.inf.tu-dresden.de
  Lackorzynski         http://os.inf.tu-dresden.de/~adam/

From eskimoe@ananzi.co.za  Wed Apr 23 20:02:33 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 23 Apr 2003 20:02:33 +0300 (EEST)
Return-Path: <eskimoe@ananzi.co.za>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from sun.com (port-212-202-174-30.reverse.qdsl-home.de [212.202.174.30])
	by danu.procontrol.fi (Postfix) with SMTP id C99262385F
	for <dovecot@procontrol.fi>; Wed, 23 Apr 2003 20:02:32 +0300 (EEST)
Received: (qmail 18009 invoked by uid 1000); 23 Apr 2003 17:04:02 -0000
Date: Wed, 23 Apr 2003 19:04:02 +0200
From: Moe Wibble <eskimoe@ananzi.co.za>
To: Dovecot List <dovecot@procontrol.fi>
Subject: [dovecot] shared folders?
Message-ID: <20030423170402.GA14185@woom.net>
Mail-Followup-To: Moe Wibble <eskimoe@ananzi.co.za>,
	Dovecot List <dovecot@procontrol.fi>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
X-archive-position: 656
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: eskimoe@ananzi.co.za
Precedence: bulk
X-list: dovecot
X-UID: 659                                                  
Status: O

Any plans to implement shared folders anytime soon?


greetinx
-- 
MW


From tss@iki.fi  Wed Apr 23 20:10:27 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 23 Apr 2003 20:10:28 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id D62492385F
	for <dovecot@procontrol.fi>; Wed, 23 Apr 2003 20:10:27 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 9C3CC5E017F5; Wed, 23 Apr 2003 20:10:20 +0300 (EEST)
Subject: [dovecot] Re: Using on AIX
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030423163248.GU21753@os.inf.tu-dresden.de>
References: <20030421205734.GK21753@os.inf.tu-dresden.de>
	 <1051041001.32159.118.camel@hurina>
	 <20030422224542.GO21753@os.inf.tu-dresden.de>
	 <1051055454.32157.126.camel@hurina>
	 <20030423114312.GQ21753@os.inf.tu-dresden.de>
	 <1051100007.32157.162.camel@hurina>
	 <20030423125610.GR21753@os.inf.tu-dresden.de>
	 <1051104595.32157.176.camel@hurina>
	 <20030423150322.GT21753@os.inf.tu-dresden.de>
	 <1051113523.32157.202.camel@hurina>
	 <20030423163248.GU21753@os.inf.tu-dresden.de>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1051117820.32159.206.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 23 Apr 2003 20:10:20 +0300
X-archive-position: 657
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 660                                                  
Status: O

On Wed, 2003-04-23 at 19:32, Adam Lackorzynski wrote:
> In mail-index-open.c:289(mail_index_create_memory) you use a path
> variable which is undefined.

Whops. Should have compiled it first :)

> Now, with the filler still in, it works for an empty inbox. If a mailbox
> contains something (7 mails in this case), I get:
> 
> imap-login: Apr 23 16:22:16 Info: Login: xxx [x.x.x.x]
> imap(xxx): Apr 23 16:22:16 Error: Corrupted index data file HOME/Mail/f/.imap/sf1/.imap.index.data: Invalid location field for record 7

Yes, what I'd like to know is if INDEX=MEMORY gives the same error once
it actually works.

> And for "default_mail_env = mbox:~/Mail:INDEX=MEMORY", I'm getting:
> 
> imap(xxx): Apr 23 16:16:54 Error: msync() failed with index file (in-memory index for HOME/Mail/f/sf1): Invalid argument

OK, 0.99.9-test8 now doesn't call msync() for anon-mmaped memory.


From tss@iki.fi  Wed Apr 23 20:11:39 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 23 Apr 2003 20:11:39 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 225252385F
	for <dovecot@procontrol.fi>; Wed, 23 Apr 2003 20:11:39 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 022FB5E017F5; Wed, 23 Apr 2003 20:11:38 +0300 (EEST)
Subject: [dovecot] Re: shared folders?
From: Timo Sirainen <tss@iki.fi>
To: Dovecot List <dovecot@procontrol.fi>
In-Reply-To: <20030423170402.GA14185@woom.net>
References: <20030423170402.GA14185@woom.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1051117898.32159.209.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 23 Apr 2003 20:11:38 +0300
X-archive-position: 658
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 661                                                  
Status: O

On Wed, 2003-04-23 at 20:04, Moe Wibble wrote:
> Any plans to implement shared folders anytime soon?

Very likely after 1.0. And 1.0 doesn't seem to be very near yet.


From adam@os.inf.tu-dresden.de  Wed Apr 23 21:53:48 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 23 Apr 2003 21:53:48 +0300 (EEST)
Return-Path: <adam@os.inf.tu-dresden.de>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from os.inf.tu-dresden.de (os.inf.tu-dresden.de [141.76.48.99])
	by danu.procontrol.fi (Postfix) with ESMTP id 1AE2F2385F
	for <dovecot@procontrol.fi>; Wed, 23 Apr 2003 21:53:48 +0300 (EEST)
Received: from erwin.inf.tu-dresden.de ([141.76.48.80])
	by os.inf.tu-dresden.de with esmtp (Exim 3.36)
	id 198PNL-000KVc-00
	for dovecot@procontrol.fi; Wed, 23 Apr 2003 20:53:47 +0200
Received: from adam by erwin.inf.tu-dresden.de with local (Exim 3.35 #1 (Debian))
	id 198PNK-0001Ts-00
	for <dovecot@procontrol.fi>; Wed, 23 Apr 2003 20:53:46 +0200
Date: Wed, 23 Apr 2003 20:53:46 +0200
From: Adam Lackorzynski <adam@os.inf.tu-dresden.de>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Using on AIX
Message-ID: <20030423185346.GV21753@os.inf.tu-dresden.de>
Mail-Followup-To: dovecot@procontrol.fi
References: <20030422224542.GO21753@os.inf.tu-dresden.de> <1051055454.32157.126.camel@hurina> <20030423114312.GQ21753@os.inf.tu-dresden.de> <1051100007.32157.162.camel@hurina> <20030423125610.GR21753@os.inf.tu-dresden.de> <1051104595.32157.176.camel@hurina> <20030423150322.GT21753@os.inf.tu-dresden.de> <1051113523.32157.202.camel@hurina> <20030423163248.GU21753@os.inf.tu-dresden.de> <1051117820.32159.206.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
In-Reply-To: <1051117820.32159.206.camel@hurina>
User-Agent: Mutt/1.4i
X-archive-position: 659
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: adam@os.inf.tu-dresden.de
Precedence: bulk
X-list: dovecot
X-UID: 662                                                  
Status: O
Content-Length: 1468

On Wed Apr 23, 2003 at 20:10:20 +0300, Timo Sirainen wrote:
> On Wed, 2003-04-23 at 19:32, Adam Lackorzynski wrote:
> > Now, with the filler still in, it works for an empty inbox. If a mailbox
> > contains something (7 mails in this case), I get:
> > 
> > imap-login: Apr 23 16:22:16 Info: Login: xxx [x.x.x.x]
> > imap(xxx): Apr 23 16:22:16 Error: Corrupted index data file HOME/Mail/f/.imap/sf1/.imap.index.data: Invalid location field for record 7
> 
> Yes, what I'd like to know is if INDEX=MEMORY gives the same error once
> it actually works.

Without "INDEX=MEMORY", I'm getting the
"Corrupted index data file...Invalid location field for record 7"
error as above.

With "INDEX=MEMORY", I'm now getting:

imap-login: Apr 23 18:46:44 Info: Login: xxx [x.x.x.x]
imap(xxx): Apr 23 18:46:44 Error: Corrupted index data file (in-memory index data index for HOME/Mail/f/sf1): Invalid location field for record 7
imap(xxx): Apr 23 18:46:44 Error: Corrupted index data file (in-memory index data index for HOME/Mail/f/sf1): Invalid location field for record 1
imap(xxx): Apr 23 18:46:44 Error: Corrupted index data file (in-memory index data index for HOME/Mail/f/sf1): Invalid location field for record 7
imap(xxx): Apr 23 18:46:44 Error: Corrupted index data file (in-memory index data index for HOME/Mail/f/sf1): Invalid location field for record 1



Adam
-- 
Adam                 adam@os.inf.tu-dresden.de
  Lackorzynski         http://os.inf.tu-dresden.de/~adam/

From tss@iki.fi  Fri Apr 25 04:34:58 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 25 Apr 2003 04:34:58 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 68A9E23845
	for <dovecot@procontrol.fi>; Fri, 25 Apr 2003 04:34:58 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 12D905E017F5; Fri, 25 Apr 2003 04:34:56 +0300 (EEST)
Subject: [dovecot] Re: Using on AIX
From: Timo Sirainen <tss@iki.fi>
To: Adam Lackorzynski <adam@os.inf.tu-dresden.de>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030423185346.GV21753@os.inf.tu-dresden.de>
References: <20030422224542.GO21753@os.inf.tu-dresden.de>
	 <1051055454.32157.126.camel@hurina>
	 <20030423114312.GQ21753@os.inf.tu-dresden.de>
	 <1051100007.32157.162.camel@hurina>
	 <20030423125610.GR21753@os.inf.tu-dresden.de>
	 <1051104595.32157.176.camel@hurina>
	 <20030423150322.GT21753@os.inf.tu-dresden.de>
	 <1051113523.32157.202.camel@hurina>
	 <20030423163248.GU21753@os.inf.tu-dresden.de>
	 <1051117820.32159.206.camel@hurina>
	 <20030423185346.GV21753@os.inf.tu-dresden.de>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1051234495.32161.267.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 25 Apr 2003 04:34:56 +0300
X-archive-position: 660
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 663                                                  
Status: O

On Wed, 2003-04-23 at 21:53, Adam Lackorzynski wrote:
> imap(xxx): Apr 23 18:46:44 Error: Corrupted index data file (in-memory index data index for HOME/Mail/f/sf1): Invalid location field for record 7

Got it, the struct sizes aren't padded to 8 bytes but Dovecot wants
that. So it pads them while writing, but the reading part is a bit too
pedantic and wants exact sizes. For now the easiest fix is to configure
--with-mem-align=4. I changed configure to do this automatically now
with 32bit file offsets. Have to fix this properly later..

I just compiled and tested Dovecot under AIX 4.3, compiled with xlc.
Seems to be working.


From tss@iki.fi  Fri Apr 25 04:43:48 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 25 Apr 2003 04:43:48 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 8567323845
	for <dovecot@procontrol.fi>; Fri, 25 Apr 2003 04:43:48 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 19A685E017F5; Fri, 25 Apr 2003 04:43:48 +0300 (EEST)
Subject: [dovecot] Re: Using on AIX
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <1051234495.32161.267.camel@hurina>
References: <20030422224542.GO21753@os.inf.tu-dresden.de>
	 <1051055454.32157.126.camel@hurina>
	 <20030423114312.GQ21753@os.inf.tu-dresden.de>
	 <1051100007.32157.162.camel@hurina>
	 <20030423125610.GR21753@os.inf.tu-dresden.de>
	 <1051104595.32157.176.camel@hurina>
	 <20030423150322.GT21753@os.inf.tu-dresden.de>
	 <1051113523.32157.202.camel@hurina>
	 <20030423163248.GU21753@os.inf.tu-dresden.de>
	 <1051117820.32159.206.camel@hurina>
	 <20030423185346.GV21753@os.inf.tu-dresden.de>
	 <1051234495.32161.267.camel@hurina>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1051235027.32161.272.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 25 Apr 2003 04:43:48 +0300
X-archive-position: 661
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 664                                                  
Status: O

On Fri, 2003-04-25 at 04:34, Timo Sirainen wrote:
> Got it, the struct sizes aren't padded to 8 bytes but Dovecot wants
> that. So it pads them while writing, but the reading part is a bit too
> pedantic and wants exact sizes. For now the easiest fix is to configure
> --with-mem-align=4. I changed configure to do this automatically now
> with 32bit file offsets. Have to fix this properly later..

Or actually maybe I should fix it properly now. This breaks if pointers
are 64bit but off_t is 32bit, and CPU doesn't want to do unaligned
memory accesses..

Index files should probably have separate alignment behaviour since it
can't contain pointers. off_t is likely to be the only possible 64bit
value in it.


From jpeterson275@attbi.com  Fri Apr 25 05:26:32 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 25 Apr 2003 05:26:32 +0300 (EEST)
Return-Path: <jpeterson275@attbi.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from sccrmhc01.attbi.com (sccrmhc01.attbi.com [204.127.202.61])
	by danu.procontrol.fi (Postfix) with ESMTP id F2C582385F
	for <dovecot@procontrol.fi>; Fri, 25 Apr 2003 05:26:31 +0300 (EEST)
Received: from attbi.com (12-228-143-121.client.attbi.com[12.228.143.121])
          by sccrmhc01.attbi.com (sccrmhc01) with SMTP
          id <2003042502262400100e4mkee>; Fri, 25 Apr 2003 02:26:24 +0000
Message-ID: <3EA89CDE.9000906@attbi.com>
Date: Thu, 24 Apr 2003 19:26:38 -0700
From: Jesse Peterson <jpeterson275@attbi.com>
User-Agent: Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.1) Gecko/20020901
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Re: shared folders?
References: <20030423170402.GA14185@woom.net> <1051117898.32159.209.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 662
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jpeterson275@attbi.com
Precedence: bulk
X-list: dovecot
X-UID: 665                                                  
Status: O



Timo Sirainen wrote:
> On Wed, 2003-04-23 at 20:04, Moe Wibble wrote:
> 
>>Any plans to implement shared folders anytime soon?
> 
> 
> Very likely after 1.0. And 1.0 doesn't seem to be very near yet.
> 
> 
> 

With maildir oes dovecot support multiple logins from the same user?  If 
so, can't you just symlink any maildir dir to .SharedFolder in a users dir?


From tss@iki.fi  Fri Apr 25 13:19:51 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 25 Apr 2003 13:19:51 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 6173A2385F
	for <dovecot@procontrol.fi>; Fri, 25 Apr 2003 13:19:51 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 2EBA95E017F5; Fri, 25 Apr 2003 13:19:51 +0300 (EEST)
Subject: [dovecot] Re: shared folders?
From: Timo Sirainen <tss@iki.fi>
To: Dovecot Mail List <dovecot@procontrol.fi>
In-Reply-To: <3EA89CDE.9000906@attbi.com>
References: <20030423170402.GA14185@woom.net>
	 <1051117898.32159.209.camel@hurina>  <3EA89CDE.9000906@attbi.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1051265990.32159.279.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 25 Apr 2003 13:19:51 +0300
X-archive-position: 663
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 666                                                  
Status: O

On Fri, 2003-04-25 at 05:26, Jesse Peterson wrote:
> With maildir oes dovecot support multiple logins from the same user? 

Yes. With mbox too.

> If so, can't you just symlink any maildir dir to .SharedFolder in a users dir?

Well, you could.. If you did it manually, set up permissions correctly
and preferrably didn't use shared index files (not so secure). That
would also mean that message flags were shared between users.


From eskimoe@ananzi.co.za  Fri Apr 25 14:35:43 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 25 Apr 2003 14:35:43 +0300 (EEST)
Return-Path: <eskimoe@ananzi.co.za>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from sun.com (port-212-202-174-30.reverse.qdsl-home.de [212.202.174.30])
	by danu.procontrol.fi (Postfix) with SMTP id 2F2F523845
	for <dovecot@procontrol.fi>; Fri, 25 Apr 2003 14:35:43 +0300 (EEST)
Received: (qmail 26503 invoked by uid 1000); 25 Apr 2003 11:37:13 -0000
Date: Fri, 25 Apr 2003 13:37:13 +0200
From: Moe Wibble <eskimoe@ananzi.co.za>
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Re: shared folders?
Message-ID: <20030425113712.GA23447@woom.net>
Mail-Followup-To: Moe Wibble <eskimoe@ananzi.co.za>,
	Dovecot Mail List <dovecot@procontrol.fi>
References: <20030423170402.GA14185@woom.net> <1051117898.32159.209.camel@hurina> <3EA89CDE.9000906@attbi.com> <1051265990.32159.279.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1051265990.32159.279.camel@hurina>
X-archive-position: 664
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: eskimoe@ananzi.co.za
Precedence: bulk
X-list: dovecot
X-UID: 667                                                  
Status: O

On Fri, Apr 25, 2003 at 01:19:51PM +0300, Timo Sirainen wrote:
> On Fri, 2003-04-25 at 05:26, Jesse Peterson wrote:
> > With maildir oes dovecot support multiple logins from the same user? 
> 
> Yes. With mbox too.
> 
> > If so, can't you just symlink any maildir dir to .SharedFolder in a users dir?
> 
> Well, you could.. If you did it manually, set up permissions correctly
> and preferrably didn't use shared index files (not so secure). That
> would also mean that message flags were shared between users.

Oh, really now?
Last time I tried (some versions ago) this didn't work out.

I can't exactly remember what the problem was, though.
Maybe I'll give it one more shot today.

What negative side effects could sharing the index have?
Is there a way to safely disable the index only for the shared folders?


thanks
-- 
MW


From adam@os.inf.tu-dresden.de  Fri Apr 25 15:49:11 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 25 Apr 2003 15:49:11 +0300 (EEST)
Return-Path: <adam@os.inf.tu-dresden.de>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from os.inf.tu-dresden.de (os.inf.tu-dresden.de [141.76.48.99])
	by danu.procontrol.fi (Postfix) with ESMTP id 2A3D12385F
	for <dovecot@procontrol.fi>; Fri, 25 Apr 2003 15:49:11 +0300 (EEST)
Received: from erwin.inf.tu-dresden.de ([141.76.48.80])
	by os.inf.tu-dresden.de with esmtp (Exim 3.36)
	id 1992dZ-000YYM-00
	for dovecot@procontrol.fi; Fri, 25 Apr 2003 14:49:09 +0200
Received: from adam by erwin.inf.tu-dresden.de with local (Exim 3.35 #1 (Debian))
	id 1992dZ-0001Wb-00
	for <dovecot@procontrol.fi>; Fri, 25 Apr 2003 14:49:09 +0200
Date: Fri, 25 Apr 2003 14:49:09 +0200
From: Adam Lackorzynski <adam@os.inf.tu-dresden.de>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: Using on AIX
Message-ID: <20030425124909.GJ21753@os.inf.tu-dresden.de>
Mail-Followup-To: dovecot@procontrol.fi
References: <20030423114312.GQ21753@os.inf.tu-dresden.de> <1051100007.32157.162.camel@hurina> <20030423125610.GR21753@os.inf.tu-dresden.de> <1051104595.32157.176.camel@hurina> <20030423150322.GT21753@os.inf.tu-dresden.de> <1051113523.32157.202.camel@hurina> <20030423163248.GU21753@os.inf.tu-dresden.de> <1051117820.32159.206.camel@hurina> <20030423185346.GV21753@os.inf.tu-dresden.de> <1051234495.32161.267.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
In-Reply-To: <1051234495.32161.267.camel@hurina>
User-Agent: Mutt/1.4i
X-archive-position: 665
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: adam@os.inf.tu-dresden.de
Precedence: bulk
X-list: dovecot
X-UID: 668                                                  
Status: O

On Fri Apr 25, 2003 at 04:34:56 +0300, Timo Sirainen wrote:
> Got it, the struct sizes aren't padded to 8 bytes but Dovecot wants
> that. So it pads them while writing, but the reading part is a bit too
> pedantic and wants exact sizes. For now the easiest fix is to configure
> --with-mem-align=4. I changed configure to do this automatically now
> with 32bit file offsets. Have to fix this properly later..
> 
> I just compiled and tested Dovecot under AIX 4.3, compiled with xlc.
> Seems to be working.

Works for me as well now (with the filler still in and with gcc).
Thanks a lot!  



Adam
-- 
Adam                 adam@os.inf.tu-dresden.de
  Lackorzynski         http://os.inf.tu-dresden.de/~adam/

From tss@iki.fi  Fri Apr 25 16:39:51 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 25 Apr 2003 16:39:51 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 5C91323845
	for <dovecot@procontrol.fi>; Fri, 25 Apr 2003 16:39:51 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 2515E5E017F5; Fri, 25 Apr 2003 16:39:51 +0300 (EEST)
Subject: [dovecot] Re: shared folders?
From: Timo Sirainen <tss@iki.fi>
To: Dovecot Mail List <dovecot@procontrol.fi>
In-Reply-To: <20030425113712.GA23447@woom.net>
References: <20030423170402.GA14185@woom.net>
	 <1051117898.32159.209.camel@hurina> <3EA89CDE.9000906@attbi.com>
	 <1051265990.32159.279.camel@hurina>  <20030425113712.GA23447@woom.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1051277990.32157.296.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 25 Apr 2003 16:39:51 +0300
X-archive-position: 666
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 669                                                  
Status: O
Content-Length: 1098

On Fri, 2003-04-25 at 14:37, Moe Wibble wrote:
> > > If so, can't you just symlink any maildir dir to .SharedFolder in a users dir?
> > 
> > Well, you could.. If you did it manually, set up permissions correctly
> > and preferrably didn't use shared index files (not so secure). That
> > would also mean that message flags were shared between users.
> 
> Oh, really now?
> Last time I tried (some versions ago) this didn't work out.
> 
> I can't exactly remember what the problem was, though.
> Maybe I'll give it one more shot today.

Well, I can't now think of why it wouldn't work :) At least as
read-write, read-only wouldn't work now.

> What negative side effects could sharing the index have?

If user can directly modify it, he could at least make Dovecot display
wrong data about the mails, hide mails or possibly cause a buffer
overflow.

> Is there a way to safely disable the index only for the shared folders?

Easiest would be to specify different index location so it won't follow
symlink to the shared directory, eg.:

default_mail_env = maildir:~/Maildir:INDEX=~/Maildir/indexes/


From lfarkas@bnap.hu  Fri Apr 25 17:46:58 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 25 Apr 2003 17:46:58 +0300 (EEST)
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 5782E2385F
	for <dovecot@procontrol.fi>; Fri, 25 Apr 2003 17:46:58 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id AF44975400C
	for <dovecot@procontrol.fi>; Fri, 25 Apr 2003 16:48:55 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id C1BB23EB2
	for <dovecot@procontrol.fi>; Fri, 25 Apr 2003 16:46:55 +0200 (CEST)
Received: from bnap.hu (garfield.int.bppiac.hu [192.168.0.50])
	by mail2.bppiac.hu (Postfix) with ESMTP id AB2E73EB1
	for <dovecot@procontrol.fi>; Fri, 25 Apr 2003 16:46:55 +0200 (CEST)
Message-ID: <3EA94A5D.2000307@bnap.hu>
Date: Fri, 25 Apr 2003 16:46:53 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: [dovecot] today cvs
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 667
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 670                                                  
Status: O

hi,
the today cvs has a new bug during configure (both on rh 8.0 and rh 9):
-----------------------------------
checking size of long long... 8
checking type of off_t... long long
./configure: line 12009: syntax error near unexpected token `else'
./configure: line 12009: `else'
-----------------------------------

-- 
   Levente                               "Si vis pacem para bellum!"



From lfarkas@bnap.hu  Fri Apr 25 17:59:20 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 25 Apr 2003 17:59:20 +0300 (EEST)
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 5D5A22385F
	for <dovecot@procontrol.fi>; Fri, 25 Apr 2003 17:59:20 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id 9EA8375400C
	for <dovecot@procontrol.fi>; Fri, 25 Apr 2003 17:01:19 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id 9392C3EB1
	for <dovecot@procontrol.fi>; Fri, 25 Apr 2003 16:59:19 +0200 (CEST)
Received: from bnap.hu (garfield.int.bppiac.hu [192.168.0.50])
	by mail2.bppiac.hu (Postfix) with ESMTP id 61BC03EAD
	for <dovecot@procontrol.fi>; Fri, 25 Apr 2003 16:59:19 +0200 (CEST)
Message-ID: <3EA94D45.8030907@bnap.hu>
Date: Fri, 25 Apr 2003 16:59:17 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: [dovecot] Re: today cvs
References: <3EA94A5D.2000307@bnap.hu>
In-Reply-To: <3EA94A5D.2000307@bnap.hu>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 668
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 671                                                  
Status: O
Content-Length: 3224

Farkas Levente wrote:
> hi,
> the today cvs has a new bug during configure (both on rh 8.0 and rh 9):
> -----------------------------------
> checking size of long long... 8
> checking type of off_t... long long
> ./configure: line 12009: syntax error near unexpected token `else'
> ./configure: line 12009: `else'
> -----------------------------------

so after I go back top the 0.99.9-test8 version I've got another error 
on rh9, and I still know the solution, since the problem is the same 
since the following article:
https://listman.redhat.com/mailman/private/redhat-devel-list/2003-April/005427.html
our error is:
-----------------------------------
gcc -DHAVE_CONFIG_H -I. -I. -I../.. -I../../src/lib 
-DPKG_RUNDIR=\""/var/run/dovecot"\"     -DSBINDIR=\""/usr/sbin"\"    -O2 
-g -march=i386 -mcpu=i686 -Wall -W -Wmissing-prototypes 
-Wmissing-declarations -Wpointer-arith -Wchar-subscripts -Wformat=2 
-Wbad-function-cast  -c ssl-proxy-openssl.c
In file included from /usr/include/openssl/ssl.h:179,
                  from ssl-proxy-openssl.c:14:
/usr/include/openssl/kssl.h:72:18: krb5.h: No such file or directory
In file included from /usr/include/openssl/ssl.h:179,
                  from ssl-proxy-openssl.c:14:
/usr/include/openssl/kssl.h:132: parse error before "krb5_enctype"
/usr/include/openssl/kssl.h:134: parse error before "FAR"
/usr/include/openssl/kssl.h:135: parse error before '}' token
/usr/include/openssl/kssl.h:147: parse error before "kssl_ctx_setstring"
/usr/include/openssl/kssl.h:147: parse error before '*' token
/usr/include/openssl/kssl.h:148: parse error before '*' token
/usr/include/openssl/kssl.h:149: parse error before '*' token
/usr/include/openssl/kssl.h:149: parse error before '*' token
/usr/include/openssl/kssl.h:150: parse error before '*' token
/usr/include/openssl/kssl.h:151: parse error before "kssl_ctx_setprinc"
/usr/include/openssl/kssl.h:151: parse error before '*' token
/usr/include/openssl/kssl.h:153: parse error before "kssl_cget_tkt"
/usr/include/openssl/kssl.h:153: parse error before '*' token
/usr/include/openssl/kssl.h:155: parse error before "kssl_sget_tkt"
/usr/include/openssl/kssl.h:155: parse error before '*' token
/usr/include/openssl/kssl.h:157: parse error before "kssl_ctx_setkey"
/usr/include/openssl/kssl.h:157: parse error before '*' token
/usr/include/openssl/kssl.h:159: parse error before "context"
/usr/include/openssl/kssl.h:160: parse error before "kssl_build_principal_2"
/usr/include/openssl/kssl.h:160: parse error before "context"
/usr/include/openssl/kssl.h:163: parse error before "kssl_validate_times"
/usr/include/openssl/kssl.h:163: parse error before "atime"
/usr/include/openssl/kssl.h:165: parse error before "kssl_check_authent"
/usr/include/openssl/kssl.h:165: parse error before '*' token
/usr/include/openssl/kssl.h:167: parse error before "enctype"
In file included from ssl-proxy-openssl.c:14:
/usr/include/openssl/ssl.h:909: parse error before "KSSL_CTX"
/usr/include/openssl/ssl.h:931: parse error before '}' token
make[3]: *** [ssl-proxy-openssl.o] Error 1
-----------------------------------
I'm waiting for the next cumulative patch:-)

-- 
   Levente                               "Si vis pacem para bellum!"



From tss@iki.fi  Fri Apr 25 18:27:16 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 25 Apr 2003 18:27:16 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 393B923845
	for <dovecot@procontrol.fi>; Fri, 25 Apr 2003 18:27:16 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 012765E017F5; Fri, 25 Apr 2003 18:27:15 +0300 (EEST)
Subject: [dovecot] Re: today cvs
From: Timo Sirainen <tss@iki.fi>
To: Dovecot List <dovecot@procontrol.fi>
In-Reply-To: <3EA94D45.8030907@bnap.hu>
References: <3EA94A5D.2000307@bnap.hu>  <3EA94D45.8030907@bnap.hu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1051284435.32161.302.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 25 Apr 2003 18:27:15 +0300
X-archive-position: 669
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 672                                                  
Status: O
Content-Length: 1134

On Fri, 2003-04-25 at 17:59, Farkas Levente wrote:
> Farkas Levente wrote:
> > hi,
> > the today cvs has a new bug during configure (both on rh 8.0 and rh 9):
> > -----------------------------------
> > checking size of long long... 8
> > checking type of off_t... long long
> > ./configure: line 12009: syntax error near unexpected token `else'
> > ./configure: line 12009: `else'
> > -----------------------------------

Testing before committing could be useful I guess :) Fixed.

> so after I go back top the 0.99.9-test8 version I've got another error 
> on rh9, and I still know the solution, since the problem is the same 
> since the following article:
> https://listman.redhat.com/mailman/private/redhat-devel-list/2003-April/005427.html

I'm not subscribed there, can't look.

> our error is:
> -----------------------------------
> In file included from /usr/include/openssl/ssl.h:179,
>                   from ssl-proxy-openssl.c:14:
> /usr/include/openssl/kssl.h:72:18: krb5.h: No such file or directory

Can I do something about this? Define OPENSSL_NO_KRB5 maybe? Should I?
How is Kerberos useful with OpenSSL anyway?


From eskimoe@ananzi.co.za  Fri Apr 25 20:04:46 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 25 Apr 2003 20:04:46 +0300 (EEST)
Return-Path: <eskimoe@ananzi.co.za>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from sun.com (port-212-202-174-30.reverse.qdsl-home.de [212.202.174.30])
	by danu.procontrol.fi (Postfix) with SMTP id 824BC2385F
	for <dovecot@procontrol.fi>; Fri, 25 Apr 2003 20:04:45 +0300 (EEST)
Received: (qmail 13982 invoked by uid 1000); 25 Apr 2003 17:06:17 -0000
Date: Fri, 25 Apr 2003 19:06:17 +0200
From: Moe Wibble <eskimoe@ananzi.co.za>
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Re: shared folders?
Message-ID: <20030425170617.GA19484@woom.net>
Mail-Followup-To: Moe Wibble <eskimoe@ananzi.co.za>,
	Dovecot Mail List <dovecot@procontrol.fi>
References: <20030423170402.GA14185@woom.net> <1051117898.32159.209.camel@hurina> <3EA89CDE.9000906@attbi.com> <1051265990.32159.279.camel@hurina> <20030425113712.GA23447@woom.net> <1051277990.32157.296.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1051277990.32157.296.camel@hurina>
X-archive-position: 670
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: eskimoe@ananzi.co.za
Precedence: bulk
X-list: dovecot
X-UID: 673                                                  
Status: O
Content-Length: 3079

On Fri, Apr 25, 2003 at 04:39:51PM +0300, Timo Sirainen wrote:
> On Fri, 2003-04-25 at 14:37, Moe Wibble wrote:
> > > > If so, can't you just symlink any maildir dir to .SharedFolder in a users dir?
> > > 
> > > Well, you could.. If you did it manually, set up permissions correctly
> > > and preferrably didn't use shared index files (not so secure). That
> > > would also mean that message flags were shared between users.
> > 
> > Oh, really now?
> > Last time I tried (some versions ago) this didn't work out.
> > 
> > I can't exactly remember what the problem was, though.
> > Maybe I'll give it one more shot today.
> 
> Well, I can't now think of why it wouldn't work :) At least as
> read-write, read-only wouldn't work now.

Ah yes, I think that was the point where it failed when I tried.
Very unfornationate because ro-access for some users to shared folders 
where others can write is a must for us.

> > What negative side effects could sharing the index have?
> 
> If user can directly modify it, he could at least make Dovecot display
> wrong data about the mails, hide mails or possibly cause a buffer
> overflow.

Okay, doesn't sound so healthy. ;)

> > Is there a way to safely disable the index only for the shared folders?
> 
> Easiest would be to specify different index location so it won't follow
> symlink to the shared directory, eg.:
> 
> default_mail_env = maildir:~/Maildir:INDEX=~/Maildir/indexes/

That is my setup anyways.
I remember now; shared folders kind of worked up to the point where I tried
to restrict write access for single users through unix (group-)permissions.
I think users without write-privileges couldn't even SELECT the folder.

Well, anyways.
I'm really looking forward to "completed" sf-support in dovecot.
As said, it's the one missing feature that still forces us to
stick with cyrus. 

I say "completed sf-support" because I figure that what
can be done with symlinks now is already half of what we need.
The method of having a separate Maildir (that doesn't need to belong
to any dovecot user) and symlinking the folders that a user may
see into his/her Maildir actually feels much better to me than
most other approaches that I have come across. So if we can agree on
that being an acceptable way of dealing w/ shared folders then
all that's left to add would be: access control.

Since simplicity is my friend I'd vote against ACLs or similar
overcomplex bloat for that matter.
Instead I imagine an optional ".ro-users"-textfile in every Maildir.
That file would simply contain a list of (dovecot) login-names that are to be
restricted to r/o-access for that folder.  Everybody else who can see the
folder (= has it or a symlink to it in his/her Md) and is not listed in
".ro-users" would get r/w-permission.

That would allow to assign three levels of permission (n/a, r/o, r/w)
to any user for any shared (or not shared..) folder in an, umm, I'm tempted to
say "almost natural" way.

Ofcourse some may say that they need finer granularity of access control.
Don't listen to them. ;)


Any opinions? :)

regards
-- 
MW


From tss@iki.fi  Fri Apr 25 20:21:36 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 25 Apr 2003 20:21:36 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 0715F23845
	for <dovecot@procontrol.fi>; Fri, 25 Apr 2003 20:21:36 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id AC61D5E017F5; Fri, 25 Apr 2003 20:21:35 +0300 (EEST)
Subject: [dovecot] Re: shared folders?
From: Timo Sirainen <tss@iki.fi>
To: Dovecot Mail List <dovecot@procontrol.fi>
In-Reply-To: <20030425170617.GA19484@woom.net>
References: <20030423170402.GA14185@woom.net>
	 <1051117898.32159.209.camel@hurina> <3EA89CDE.9000906@attbi.com>
	 <1051265990.32159.279.camel@hurina> <20030425113712.GA23447@woom.net>
	 <1051277990.32157.296.camel@hurina>  <20030425170617.GA19484@woom.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1051291295.32159.381.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 25 Apr 2003 20:21:35 +0300
X-archive-position: 671
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 674                                                  
Status: O
Content-Length: 3180

On Fri, 2003-04-25 at 20:06, Moe Wibble wrote:
> > Well, I can't now think of why it wouldn't work :) At least as
> > read-write, read-only wouldn't work now.
> 
> Ah yes, I think that was the point where it failed when I tried.
> Very unfornationate because ro-access for some users to shared folders 
> where others can write is a must for us.

There's mostly just one problem with this. Mails in new/ couldn't be
accessed since they couldn't be moved to cur/ and their UID couldn't be
saved into uidlist file.

This is actually somewhat related to quota full situation when there's
no space to rewrite uidlist file.. Solution should be the same for both,
but I'm not sure yet what it is :)

> I'm really looking forward to "completed" sf-support in dovecot.

Courier-like shared maildir folders would probably be best way to do it.
It'd use symlinks to message files, so flags can still be changed
separately because it's only the user's symlink that gets renamed.

I wrote some kind of plan for shared folder + ACL support a few months
ago when there was a possibility of getting paid to do it: (anyone still
want to? :)

- Change maildir hierarchy separator from '.' to '/', so that usernames
could be used in mailboxes names without ugly mangling. 

- Namespace configuration:
   - namespace_[private|user|shared]_prefix
   - MAIL environment (or default_mail_env) additions:
      - USER_SHARED=.__my_shared_store__
      - SHARED=/somewhere for globally shared
   - NAMESPACE command

- Support for multiple namespaces
   - struct mail_storage == one namespace
   - fix all IMAP commands handling mailbox names to support other
mail_storages based on the mailbox name prefix

- mail_storage implementation for shared maildir folders
   - SUBSCRIBE shared/timo.sirainen/folder would create
.shared/timo.sirainen/folder/ and build indexes there
   - UNSUBSCRIBE would delete it
   - ..or should SELECT shared/user/folder work before being subscribed?
(Later at least yes, but that would need special handling)
   - LSUB could simply return all the folders in .shared/ dir
   - LIST could use user-defined plugins
       - getgroups() plugin
   - (Courier compatibility? It used some extra files)

- Separate per-mail symlinks to allow per-user mail flags
   - mostly just about syncing symlink directory with real directory

- ACL API design
   - Needs to support stackable implementations, so that eg. filesystem
ACL is at the bottom, on top of that an .aclrights file for more fine
grained non-OS forced ACLs.
   - compatible with ACL2 (currently draft), just a few issues

- Filesystem ACL implementation for the ACL API

- ACL IMAP commands

- Make existing commands play nicely with ACLs and shared folders
   - Say "permission denied" rather than "internal error" if some
syscall returns EACCES (mostly when opening folders)
   - When trying to expunge a message that wasn't ours, ignore or give
human readable error message (which one?), but don't give "internal
error"
   - In general Dovecot doesn't currently like having read-only access
to mailboxes
   - Ask ACL if operation is permitted before doing that, so it can
force the soft checks (.aclaccess file etc)


From eskimoe@ananzi.co.za  Fri Apr 25 21:47:14 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 25 Apr 2003 21:47:14 +0300 (EEST)
Return-Path: <eskimoe@ananzi.co.za>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from sun.com (port-212-202-174-30.reverse.qdsl-home.de [212.202.174.30])
	by danu.procontrol.fi (Postfix) with SMTP id 0B3E42385F
	for <dovecot@procontrol.fi>; Fri, 25 Apr 2003 21:47:14 +0300 (EEST)
Received: (qmail 7769 invoked by uid 1000); 25 Apr 2003 18:48:42 -0000
Date: Fri, 25 Apr 2003 20:48:42 +0200
From: Moe Wibble <eskimoe@ananzi.co.za>
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Re: shared folders?
Message-ID: <20030425184842.GA25545@woom.net>
Mail-Followup-To: Moe Wibble <eskimoe@ananzi.co.za>,
	Dovecot Mail List <dovecot@procontrol.fi>
References: <20030423170402.GA14185@woom.net> <1051117898.32159.209.camel@hurina> <3EA89CDE.9000906@attbi.com> <1051265990.32159.279.camel@hurina> <20030425113712.GA23447@woom.net> <1051277990.32157.296.camel@hurina> <20030425170617.GA19484@woom.net> <1051291295.32159.381.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1051291295.32159.381.camel@hurina>
X-archive-position: 672
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: eskimoe@ananzi.co.za
Precedence: bulk
X-list: dovecot
X-UID: 675                                                  
Status: O
Content-Length: 4997

On Fri, Apr 25, 2003 at 08:21:35PM +0300, Timo Sirainen wrote:
> On Fri, 2003-04-25 at 20:06, Moe Wibble wrote:
> > > Well, I can't now think of why it wouldn't work :) At least as
> > > read-write, read-only wouldn't work now.
> > 
> > Ah yes, I think that was the point where it failed when I tried.
> > Very unfornationate because ro-access for some users to shared folders 
> > where others can write is a must for us.
> 
> There's mostly just one problem with this. Mails in new/ couldn't be
> accessed since they couldn't be moved to cur/ and their UID couldn't be
> saved into uidlist file.
> 
> This is actually somewhat related to quota full situation when there's
> no space to rewrite uidlist file.. Solution should be the same for both,
> but I'm not sure yet what it is :)

I'd have some ideas for this but I'm not familar with the dovecot code
so they might not be applicable.

> > I'm really looking forward to "completed" sf-support in dovecot.
> 
> Courier-like shared maildir folders would probably be best way to do it.
> It'd use symlinks to message files, so flags can still be changed
> separately because it's only the user's symlink that gets renamed.
> 
> I wrote some kind of plan for shared folder + ACL support a few months
> ago when there was a possibility of getting paid to do it: (anyone still
> want to? :)

Uh oh.

> - Change maildir hierarchy separator from '.' to '/', so that usernames
> could be used in mailboxes names without ugly mangling. 

Huh?

> - Namespace configuration:
>    - namespace_[private|user|shared]_prefix
>    - MAIL environment (or default_mail_env) additions:
>       - USER_SHARED=.__my_shared_store__
>       - SHARED=/somewhere for globally shared
>    - NAMESPACE command

What for?

> - Support for multiple namespaces
>    - struct mail_storage == one namespace
>    - fix all IMAP commands handling mailbox names to support other
> mail_storages based on the mailbox name prefix

Ugh.

> - mail_storage implementation for shared maildir folders
>    - SUBSCRIBE shared/timo.sirainen/folder would create
> .shared/timo.sirainen/folder/ and build indexes there
>    - UNSUBSCRIBE would delete it

Why!?

>    - ..or should SELECT shared/user/folder work before being subscribed?
> (Later at least yes, but that would need special handling)
>    - LSUB could simply return all the folders in .shared/ dir
>    - LIST could use user-defined plugins

Why why why!?

>        - getgroups() plugin
>    - (Courier compatibility? It used some extra files)

Why not treat shared folders like any other folders?
Why the heck do you want to be "compatible" to inconveniences of other
software? Wouldn't a one-shot-convert-courier-mailstore-to-dovecot-mailstore-
utility be more reasonable than bloating the code with compatiblity-
workarounds?
Who in the world would want to run dovecot and courier in parallel?

> - Separate per-mail symlinks to allow per-user mail flags
>    - mostly just about syncing symlink directory with real directory

Ummm.  per-mail symlinks?  Okay, there are a number of reasons why people
want to get rid of courier imap.  I'm convinced that would be one of them!
Why not store per-user mailflags for a shared folder (shared folder = a folder
that is a symlink not directory) in a separate (single?) meta-file?
So dovecot sees: "oh a symlink.  well, we'd better read the flags from our
meta file then, rather than parse the name".

> - ACL API design
>    - Needs to support stackable implementations, so that eg. filesystem
> ACL is at the bottom, on top of that an .aclrights file for more fine
> grained non-OS forced ACLs.
>    - compatible with ACL2 (currently draft), just a few issues

Okay, you're kidding. You are. Aren't you? You are. (*hides under desk*)

> - Filesystem ACL implementation for the ACL API

Argh.

> - ACL IMAP commands

Mercy!!

> - Make existing commands play nicely with ACLs and shared folders
>    - Say "permission denied" rather than "internal error" if some
> syscall returns EACCES (mostly when opening folders)

Hm. Ah, that's what we get out of all the effort?

>    - When trying to expunge a message that wasn't ours, ignore or give
> human readable error message (which one?), but don't give "internal
> error"

Umm. Does anyone really care about that?

>    - In general Dovecot doesn't currently like having read-only access
> to mailboxes

I noticed that.

>    - Ask ACL if operation is permitted before doing that, so it can
> force the soft checks (.aclaccess file etc)

Okay, you got me really scared by now.

I mean... I don't even know where to start...
Maybe: What kind of expired fish did you have for breakfast? (j/k;))

The positive point was that you said you're not going to actually
do it.  Can you promise that, please? ;)

Would you probably take a simpler approach like the one I briefly outlined
in my previous mail into consideration or do you really think of ACLs as a
must-have? If so, why?

PS: no personal offense intended!


greetinx
-- 
MW


From dovecot@andreas.hanssen.name  Fri Apr 25 21:52:41 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 25 Apr 2003 21:52:41 +0300 (EEST)
Return-Path: <dovecot@andreas.hanssen.name>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from lexx.infeline.org (unknown [217.144.230.27])
	by danu.procontrol.fi (Postfix) with SMTP id C64AE2385F
	for <dovecot@procontrol.fi>; Fri, 25 Apr 2003 21:52:40 +0300 (EEST)
Received: (qmail 18688 invoked from network); 25 Apr 2003 18:52:40 -0000
Received: from localhost (HELO krs-dhcp299.studby.uio.no) (andreaha@127.0.0.1)
  by localhost with SMTP; 25 Apr 2003 18:52:40 -0000
Date: Fri, 25 Apr 2003 20:49:49 +0200 (CEST)
From: Andreas Aardal Hanssen <dovecot@andreas.hanssen.name>
To: Dovecot List <dovecot@procontrol.fi>
Subject: [dovecot] Re: today cvs
In-Reply-To: <1051284435.32161.302.camel@hurina>
Message-ID: <Pine.LNX.4.44.0304252048180.2154-100000@localhost.localdomain>
X-Sent-From-Infeline: Yes
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 673
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: dovecot@andreas.hanssen.name
Precedence: bulk
X-list: dovecot
X-UID: 676                                                  
Status: O

On 25 Apr 2003, Timo Sirainen wrote:
>On Fri, 2003-04-25 at 17:59, Farkas Levente wrote:
>> our error is:
>> -----------------------------------
>> In file included from /usr/include/openssl/ssl.h:179,
>>                   from ssl-proxy-openssl.c:14:
>> /usr/include/openssl/kssl.h:72:18: krb5.h: No such file or directory
>Can I do something about this? Define OPENSSL_NO_KRB5 maybe? Should I?
>How is Kerberos useful with OpenSSL anyway?

It's included from your ssl.h file. The kerberos include files are 
naturally(?) located under /usr/kerberos/include in RH9, so try compiling 
with CXXFLAGS="-I/usr/kerberos/include" and see what happens.

Andy

-- 
Andreas Aardal Hanssen
http://www.andreas.hanssen.name/gpg


From tss@iki.fi  Fri Apr 25 22:52:46 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 25 Apr 2003 22:52:46 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id B2EA023845
	for <dovecot@procontrol.fi>; Fri, 25 Apr 2003 22:52:45 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 741545E017F5; Fri, 25 Apr 2003 22:52:45 +0300 (EEST)
Subject: [dovecot] Re: shared folders?
From: Timo Sirainen <tss@iki.fi>
To: Dovecot Mail List <dovecot@procontrol.fi>
In-Reply-To: <20030425184842.GA25545@woom.net>
References: <20030423170402.GA14185@woom.net>
	 <1051117898.32159.209.camel@hurina> <3EA89CDE.9000906@attbi.com>
	 <1051265990.32159.279.camel@hurina> <20030425113712.GA23447@woom.net>
	 <1051277990.32157.296.camel@hurina> <20030425170617.GA19484@woom.net>
	 <1051291295.32159.381.camel@hurina>  <20030425184842.GA25545@woom.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1051300365.32157.400.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 25 Apr 2003 22:52:45 +0300
X-archive-position: 674
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 677                                                  
Status: O
Content-Length: 4751

On Fri, 2003-04-25 at 21:48, Moe Wibble wrote:
> > - Change maildir hierarchy separator from '.' to '/', so that usernames
> > could be used in mailboxes names without ugly mangling. 
> Huh?

So that if you have a login name of "first.last@domain.com", LIST could
show that directly under "Other users/" namespace.

> > - Namespace configuration:
> >    - namespace_[private|user|shared]_prefix
> >    - MAIL environment (or default_mail_env) additions:
> >       - USER_SHARED=.__my_shared_store__
> >       - SHARED=/somewhere for globally shared
> >    - NAMESPACE command
> 
> What for?

I'll do this in any case. Namespaces are good for clients and people
want multiple locations for their mailboxes (mixed mboxes and maildir
most commonly).

> > - Support for multiple namespaces
> >    - struct mail_storage == one namespace
> >    - fix all IMAP commands handling mailbox names to support other
> > mail_storages based on the mailbox name prefix
> 
> Ugh.

Same as above.

> > - mail_storage implementation for shared maildir folders
> >    - SUBSCRIBE shared/timo.sirainen/folder would create
> > .shared/timo.sirainen/folder/ and build indexes there
> >    - UNSUBSCRIBE would delete it
> 
> Why!?

Point was to be able to share your folders with other users. How else
would you do that with IMAP protocol?

> >    - ..or should SELECT shared/user/folder work before being subscribed?
> > (Later at least yes, but that would need special handling)
> >    - LSUB could simply return all the folders in .shared/ dir
> >    - LIST could use user-defined plugins
> 
> Why why why!?

How would you list the possible folders that other people have shared?

> >    - (Courier compatibility? It used some extra files)
> 
> Why not treat shared folders like any other folders?

Because they're not like other folders. Unless you want to manually
create the symlink and delete it when you don't want that folder
anymore.

> Why the heck do you want to be "compatible" to inconveniences of other
> software?

That was in paranthesis :) And it's not a big deal, maybe creating a
0-byte file.

>  Wouldn't a one-shot-convert-courier-mailstore-to-dovecot-mailstore-
> utility be more reasonable than bloating the code with compatiblity-
> workarounds?
> Who in the world would want to run dovecot and courier in parallel?

There may be other programs that access Maildir++ than Courier. Maybe
not shared folders, but for quota there's several others.

> > - Separate per-mail symlinks to allow per-user mail flags
> >    - mostly just about syncing symlink directory with real directory
> 
> Ummm.  per-mail symlinks?  Okay, there are a number of reasons why people
> want to get rid of courier imap.  I'm convinced that would be one of them!
> Why not store per-user mailflags for a shared folder (shared folder = a folder
> that is a symlink not directory) in a separate (single?) meta-file?
> So dovecot sees: "oh a symlink.  well, we'd better read the flags from our
> meta file then, rather than parse the name".

I think the symlinking is quite simple way to do this and plays very
nicely with how maildir works internally. If I do some separate
meta-file for flags (I've thought about that too) it wouldn't be maildir
anymore. I might just as well implement another mail storage format
then.

> > - ACL API design
> >    - Needs to support stackable implementations, so that eg. filesystem
> > ACL is at the bottom, on top of that an .aclrights file for more fine
> > grained non-OS forced ACLs.
> >    - compatible with ACL2 (currently draft), just a few issues
> 
> Okay, you're kidding. You are. Aren't you? You are. (*hides under desk*)
> 
> > - Filesystem ACL implementation for the ACL API
> 
> Argh.
> 
> > - ACL IMAP commands
> 
> Mercy!!

So, you don't want IMAP ACL support at all? I do, but I'll of course
leave it optional.

> > - Make existing commands play nicely with ACLs and shared folders
> >    - Say "permission denied" rather than "internal error" if some
> > syscall returns EACCES (mostly when opening folders)
> 
> Hm. Ah, that's what we get out of all the effort?

It's not nice to let users fill your error log files.

> >    - When trying to expunge a message that wasn't ours, ignore or give
> > human readable error message (which one?), but don't give "internal
> > error"
> 
> Umm. Does anyone really care about that?

Depends on how you want the shared folder to behave. Yes, the guy who I
wrote this mail first wanted such behaviour.

> Would you probably take a simpler approach like the one I briefly outlined
> in my previous mail into consideration or do you really think of ACLs as a
> must-have? If so, why?

If you can't give shell access to IMAP users, that's the only way to let
them share their folders.


From eskimoe@ananzi.co.za  Sat Apr 26 06:50:49 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 26 Apr 2003 06:50:49 +0300 (EEST)
Return-Path: <eskimoe@ananzi.co.za>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from sun.com (port-212-202-174-30.reverse.qdsl-home.de [212.202.174.30])
	by danu.procontrol.fi (Postfix) with SMTP id 9AF2823845
	for <dovecot@procontrol.fi>; Sat, 26 Apr 2003 06:50:48 +0300 (EEST)
Received: (qmail 17284 invoked by uid 1000); 26 Apr 2003 03:52:20 -0000
Date: Sat, 26 Apr 2003 05:52:20 +0200
From: Moe Wibble <eskimoe@ananzi.co.za>
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Re: shared folders?
Message-ID: <20030426035220.GA26817@woom.net>
Mail-Followup-To: Moe Wibble <eskimoe@ananzi.co.za>,
	Dovecot Mail List <dovecot@procontrol.fi>
References: <20030423170402.GA14185@woom.net> <1051117898.32159.209.camel@hurina> <3EA89CDE.9000906@attbi.com> <1051265990.32159.279.camel@hurina> <20030425113712.GA23447@woom.net> <1051277990.32157.296.camel@hurina> <20030425170617.GA19484@woom.net> <1051291295.32159.381.camel@hurina> <20030425184842.GA25545@woom.net> <1051300365.32157.400.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
In-Reply-To: <1051300365.32157.400.camel@hurina>
X-archive-position: 675
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: eskimoe@ananzi.co.za
Precedence: bulk
X-list: dovecot
X-UID: 678                                                  
Status: O
Content-Length: 6757

On Fri, Apr 25, 2003 at 10:52:45PM +0300, Timo Sirainen wrote:
> On Fri, 2003-04-25 at 21:48, Moe Wibble wrote:
> > > - Change maildir hierarchy separator from '.' to '/', so that usernames
> > > could be used in mailboxes names without ugly mangling. 
> > Huh?
> 
> So that if you have a login name of "first.last@domain.com", LIST could
> show that directly under "Other users/" namespace.

Okay, I get it. (i think)

> > > - Namespace configuration:
> > >    - namespace_[private|user|shared]_prefix
> > >    - MAIL environment (or default_mail_env) additions:
> > >       - USER_SHARED=.__my_shared_store__
> > >       - SHARED=/somewhere for globally shared
> > >    - NAMESPACE command
> > 
> > What for?
> 
> I'll do this in any case. Namespaces are good for clients and people
> want multiple locations for their mailboxes (mixed mboxes and maildir
> most commonly).

I must admit that I have never really understood (and only very briefly
browsed over) the idea of imap namespaces. With the little bit I know I'm
basically considering them mainly as a convenience for a person willing to
implement an imap server because they make it easier to have the imapd emulate
"virtual" folders to the client.

But why not just let the user arrange his folder hierarchy the way he likes
when what we are dealing with actually is a folder anyways?
I don't see the connection to shared folders.
And I don't see a reason why shared folders should be separated in a
different namespace?

Your maildir/mbox example makes a bit sense to me even though I don't
see the big advantage there either.

But then again, maybe I'm just missing the whole point
about namespaces..?

> > > - mail_storage implementation for shared maildir folders
> > >    - SUBSCRIBE shared/timo.sirainen/folder would create
> > > .shared/timo.sirainen/folder/ and build indexes there
> > >    - UNSUBSCRIBE would delete it
> > 
> > Why!?
> 
> Point was to be able to share your folders with other users. How else
> would you do that with IMAP protocol?

Well, I wouldn't do it with the IMAP protocol but with symlinks. ;)

> > >    - ..or should SELECT shared/user/folder work before being subscribed?
> > > (Later at least yes, but that would need special handling)
> > >    - LSUB could simply return all the folders in .shared/ dir
> > >    - LIST could use user-defined plugins
> > 
> > Why why why!?
> 
> How would you list the possible folders that other people have shared?

Not at all, I symlink shared folders to the Maildirs of the users
that should see them.

> > >    - (Courier compatibility? It used some extra files)
> > 
> > Why not treat shared folders like any other folders?
> 
> Because they're not like other folders. Unless you want to manually
> create the symlink and delete it when you don't want that folder
> anymore.

Yes, that's what I had in mind. :)

> > Why the heck do you want to be "compatible" to inconveniences of other
> > software?
> 
> That was in paranthesis :) And it's not a big deal, maybe creating a
> 0-byte file.

Hum. 

> >  Wouldn't a one-shot-convert-courier-mailstore-to-dovecot-mailstore-
> > utility be more reasonable than bloating the code with compatiblity-
> > workarounds?
> > Who in the world would want to run dovecot and courier in parallel?
> 
> There may be other programs that access Maildir++ than Courier. Maybe
> not shared folders, but for quota there's several others.

Hum².

> > > - Separate per-mail symlinks to allow per-user mail flags
> > >    - mostly just about syncing symlink directory with real directory
> > 
> > Ummm.  per-mail symlinks?  Okay, there are a number of reasons why people
> > want to get rid of courier imap.  I'm convinced that would be one of them!
> > Why not store per-user mailflags for a shared folder (shared folder = a folder
> > that is a symlink not directory) in a separate (single?) meta-file?
> > So dovecot sees: "oh a symlink.  well, we'd better read the flags from our
> > meta file then, rather than parse the name".
> 
> I think the symlinking is quite simple way to do this and plays very
> nicely with how maildir works internally. If I do some separate
> meta-file for flags (I've thought about that too) it wouldn't be maildir
> anymore. I might just as well implement another mail storage format
> then.

The major problem I see is the extensive use of inodes. Also keeping the
symlink-copies in sync with the main folder seems like an expensive
task to me.
And you already have meta files (the index), why not add one?

> > > [ ACL stuff ]
> > [ Moe doesn't like ACL ]
> 
> So, you don't want IMAP ACL support at all? I do, but I'll of course
> leave it optional.

I'd really prefer a simpler approach, at least for a start.
The "simple" shared folders should be fairly easy to implement.
At least compared to full blown ACL support. Also they wouldn't bloat
the code nearly as much as the latter and could easily co-exist with
upcoming ACL support while it's under developement.

How good is client support for ACLs nowadays anyways?

> > > - Make existing commands play nicely with ACLs and shared folders
> > >    - Say "permission denied" rather than "internal error" if some
> > > syscall returns EACCES (mostly when opening folders)
> > 
> > Hm. Ah, that's what we get out of all the effort?
> 
> It's not nice to let users fill your error log files.

Yes, you're right ofcourse.
But it shouldn't be too hard to issue proper error messages even
without ACLs. ;)

> > >    - When trying to expunge a message that wasn't ours, ignore or give
> > > human readable error message (which one?), but don't give "internal
> > > error"
> > 
> > Umm. Does anyone really care about that?
> 
> Depends on how you want the shared folder to behave. Yes, the guy who I
> wrote this mail first wanted such behaviour.

Well, that's where we have a different view on shared folders. :)
"My" shared folders can be read-only or read-write.
Trying to delete a message from a read-only shared folder would cause
a "Permission denied."-message. I didn't quite understand in first place
why that is worth mentioning?

> > Would you probably take a simpler approach like the one I briefly outlined
> > in my previous mail into consideration or do you really think of ACLs as a
> > must-have? If so, why?
> 
> If you can't give shell access to IMAP users, that's the only way to let
> them share their folders.

Ah, there we go. :)
I don't need users to be able to share/unshare their folders with their
mail client and all the other extras ACL makes possible. Thus my call for
"simple" shared folders. You on the other hand have the real deal in
mind, with ACLs, bells and whistles. Well, whatever it will be, shared
folders would definately be a nice thing to have. ;)


greetinx
-- 
MW


From dovecot@andreas.hanssen.name  Sat Apr 26 13:12:41 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 26 Apr 2003 13:12:41 +0300 (EEST)
Return-Path: <dovecot@andreas.hanssen.name>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from lexx.infeline.org (unknown [217.144.230.27])
	by danu.procontrol.fi (Postfix) with SMTP id 50A7223845
	for <dovecot@procontrol.fi>; Sat, 26 Apr 2003 13:12:41 +0300 (EEST)
Received: (qmail 17642 invoked from network); 26 Apr 2003 10:12:39 -0000
Received: from localhost (HELO krs-dhcp299.studby.uio.no) (andreaha@127.0.0.1)
  by localhost with SMTP; 26 Apr 2003 10:12:39 -0000
Date: Sat, 26 Apr 2003 12:09:33 +0200 (CEST)
From: Andreas Aardal Hanssen <dovecot@andreas.hanssen.name>
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Re: shared folders?
In-Reply-To: <20030426035220.GA26817@woom.net>
Message-ID: <Pine.LNX.4.44.0304261203290.2057-100000@localhost.localdomain>
X-Sent-From-Infeline: Yes
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 676
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: dovecot@andreas.hanssen.name
Precedence: bulk
X-list: dovecot
X-UID: 679                                                  
Status: O
Content-Length: 1479

On Sat, 26 Apr 2003, Moe Wibble wrote:
>I must admit that I have never really understood (and only very briefly
>browsed over) the idea of imap namespaces. With the little bit I know I'm
>basically considering them mainly as a convenience for a person willing to
>implement an imap server because they make it easier to have the imapd emulate
>"virtual" folders to the client.
>But why not just let the user arrange his folder hierarchy the way he likes
>when what we are dealing with actually is a folder anyways?
>I don't see the connection to shared folders.
>And I don't see a reason why shared folders should be separated in a
>different namespace?

The reason for this comes naturally from one of the main applications of
shared folders, which is companies that share announcement and news
folders across their employees. One shared folder may be called "finance",
another may be "news".

Now, I personally have a mailbox called "news" which is a superior to
"CNN.com", "Freshmeat.net" and so on. So I can't subscribe to the shared
folder "news" unless it's in a different namespace. The namespace name
usually starts with a character that is disallowed in regular mailboxes.  

So perhaps the company's namespace is "#thecompany". Now you can subscribe
to two mailboxes whose names are both "news", one is just "news" or within
some personal namespace "#personal/news", and one is "#thecompany/news".

Andy

-- 
Andreas Aardal Hanssen
http://www.andreas.hanssen.name/gpg


From eskimoe@ananzi.co.za  Sat Apr 26 16:42:26 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 26 Apr 2003 16:42:26 +0300 (EEST)
Return-Path: <eskimoe@ananzi.co.za>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from sun.com (port-212-202-174-30.reverse.qdsl-home.de [212.202.174.30])
	by danu.procontrol.fi (Postfix) with SMTP id 79EE923845
	for <dovecot@procontrol.fi>; Sat, 26 Apr 2003 16:42:25 +0300 (EEST)
Received: (qmail 7112 invoked by uid 1000); 26 Apr 2003 13:43:56 -0000
Date: Sat, 26 Apr 2003 15:43:56 +0200
From: Moe Wibble <eskimoe@ananzi.co.za>
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Re: shared folders?
Message-ID: <20030426134356.GA31067@woom.net>
Mail-Followup-To: Moe Wibble <eskimoe@ananzi.co.za>,
	Dovecot Mail List <dovecot@procontrol.fi>
References: <20030426035220.GA26817@woom.net> <Pine.LNX.4.44.0304261203290.2057-100000@localhost.localdomain>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <Pine.LNX.4.44.0304261203290.2057-100000@localhost.localdomain>
X-archive-position: 677
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: eskimoe@ananzi.co.za
Precedence: bulk
X-list: dovecot
X-UID: 680                                                  
Status: O
Content-Length: 2491

On Sat, Apr 26, 2003 at 12:09:33PM +0200, Andreas Aardal Hanssen wrote:
> On Sat, 26 Apr 2003, Moe Wibble wrote:
> >I must admit that I have never really understood (and only very briefly
> >browsed over) the idea of imap namespaces. With the little bit I know I'm
> >basically considering them mainly as a convenience for a person willing to
> >implement an imap server because they make it easier to have the imapd emulate
> >"virtual" folders to the client.
> >But why not just let the user arrange his folder hierarchy the way he likes
> >when what we are dealing with actually is a folder anyways?
> >I don't see the connection to shared folders.
> >And I don't see a reason why shared folders should be separated in a
> >different namespace?
> 
> The reason for this comes naturally from one of the main applications of
> shared folders, which is companies that share announcement and news
> folders across their employees. One shared folder may be called "finance",
> another may be "news".
> 
> Now, I personally have a mailbox called "news" which is a superior to
> "CNN.com", "Freshmeat.net" and so on. So I can't subscribe to the shared
> folder "news" unless it's in a different namespace. The namespace name
> usually starts with a character that is disallowed in regular mailboxes.  
> 
> So perhaps the company's namespace is "#thecompany". Now you can subscribe
> to two mailboxes whose names are both "news", one is just "news" or within
> some personal namespace "#personal/news", and one is "#thecompany/news".

So namespaces help to enforce corporate policies on folder names? ;)
No seriously, if you'd work with symlinks it'd be up to the user how to
name his folder and where to put it.
Aren't namespaces represented as folders in most clients anyways?
So what's the point about enforcing a folders name (or even worse
part of the structure of the folder tree) on the client side?

As said, it might be more convinient for the imapd because it only has
to prepend "#news" to the folder name instead of internally maintaining
a "virtual" folder that can be renamed and everything.
I'm not sure but I think at least mozilla displays namespaces as
toplevel folders. And I guess moving folders between namespaces
is not so easy, unless the client remembers some kind of mapping.
So what if a user prefers to have "CNN.com" under
#personal/news_n_stuff/web rather than #news?

I still don't see why shared folders need to exist in
a dedicated namespace...


regards
-- 
MW


From andreas@hanssen.name  Sat Apr 26 17:26:22 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 26 Apr 2003 22:55:08 +0300 (EEST)
Return-Path: <andreas@hanssen.name>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from lexx.infeline.org (unknown [217.144.230.27])
	by danu.procontrol.fi (Postfix) with SMTP id 31A852385F
	for <dovecot@procontrol.fi>; Sat, 26 Apr 2003 17:26:22 +0300 (EEST)
Received: (qmail 25842 invoked from network); 26 Apr 2003 14:26:21 -0000
Received: from localhost (HELO krs-dhcp299.studby.uio.no) (andreaha@127.0.0.1)
  by localhost with SMTP; 26 Apr 2003 14:26:21 -0000
Date: Sat, 26 Apr 2003 16:23:14 +0200 (CEST)
From: Andreas Aardal Hanssen <andreas@hanssen.name>
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Re: shared folders?
In-Reply-To: <20030426134356.GA31067@woom.net>
Message-ID: <Pine.LNX.4.44.0304261614310.2057-100000@localhost.localdomain>
X-Sent-From-Infeline: Yes
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 678
X-Approved-By: tss@iki.fi
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: andreas@hanssen.name
Precedence: bulk
X-list: dovecot
X-UID: 681                                                  
Status: O
Content-Length: 2437

On Sat, 26 Apr 2003, Moe Wibble wrote:
>On Sat, Apr 26, 2003 at 12:09:33PM +0200, Andreas Aardal Hanssen wrote:
>> On Sat, 26 Apr 2003, Moe Wibble wrote:
>> Now, I personally have a mailbox called "news" which is a superior to
>> "CNN.com", "Freshmeat.net" and so on. So I can't subscribe to the shared
>> folder "news" unless it's in a different namespace. The namespace name
>> usually starts with a character that is disallowed in regular mailboxes.  
>> So perhaps the company's namespace is "#thecompany". Now you can subscribe
>> to two mailboxes whose names are both "news", one is just "news" or within
>> some personal namespace "#personal/news", and one is "#thecompany/news".
>So namespaces help to enforce corporate policies on folder names? ;)
>No seriously, if you'd work with symlinks it'd be up to the user how to
>name his folder and where to put it.

Now you're talking about a specific implementation. The shared folders
concept needs to fit into the IMAP protocol, and it therefore needs to be
completely platform independent. Sure, one solution is to use symlinks and
that one feature allows a user to have a "local" name that can be
different from the remote name. But in most cases, it makes little sense
to mount a shared folder under another name.

>Aren't namespaces represented as folders in most clients anyways?
>So what's the point about enforcing a folders name (or even worse
>part of the structure of the folder tree) on the client side?

The client is not an issue here. The client can assign that folder any
name that it wants. The question is what the server should do, and the
server represents shared folders' names exactly the way the source
presents them.  The client needs to access the folder using the server's
folder name. To avoid name clashes, you need namespaces. That's what the
entire purpose of a namespace is for.

>As said, it might be more convinient for the imapd because it only has
>to prepend "#news" to the folder name instead of internally maintaining
>a "virtual" folder that can be renamed and everything.

If there is a source that presents a structure of shared mailboxes, and
several of the names clash with your own mailboxes names, you can not
easily mount / subscribe / access those mailboxes without namespaces.

I can see no reason whatsoever to _not_ use a seperate namespace for
shared folders.

Andy

-- 
Andreas Aardal Hanssen
http://www.andreas.hanssen.name/gpg


From heiko@zuerker.org  Sun Apr 27 03:40:14 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 27 Apr 2003 03:40:14 +0300 (EEST)
Return-Path: <heiko@zuerker.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from twister.ispgateway.de (twister.ispgateway.de [62.67.200.3])
	by danu.procontrol.fi (Postfix) with SMTP id F27832385F
	for <dovecot@procontrol.fi>; Sun, 27 Apr 2003 03:40:13 +0300 (EEST)
Received: (qmail 29907 invoked from network); 27 Apr 2003 00:40:13 -0000
Received: from unknown (HELO gate.home.zuerker.org) (451874@[68.18.18.185]) (envelope-sender <heiko@zuerker.org>)
          by twister.ispgateway.de (qmail-ldap-1.03) with SMTP
          for <dovecot@procontrol.fi>; 27 Apr 2003 00:40:13 -0000
Received: from zuerker.org (unknown [192.168.0.14])
	by gate.home.zuerker.org (Postfix on Devil-Linux) with ESMTP id B7F5FBA
	for <dovecot@procontrol.fi>; Sat, 26 Apr 2003 20:05:51 -0400 (EDT)
Message-ID: <3EAB1EDF.8060807@zuerker.org>
Date: Sat, 26 Apr 2003 20:05:51 -0400
From: Heiko Zuerker <heiko@zuerker.org>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:0.9.8) Gecko/20020204
X-Accept-Language: en-us
MIME-Version: 1.0
To: dovecot@procontrol.fi
Subject: [dovecot] dovecot and grsecurity (problem with resource limits)
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 679
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: heiko@zuerker.org
Precedence: bulk
X-list: dovecot
X-UID: 682                                                  
Status: O
Content-Length: 1172

Howdy folks !

I just added Dovecot as a standard package to Devil-Linux and ran into a 
problem with resource limits.
Grsecurity (http://www.grsecurity.net) is used in DL to prevent problems 
with common exploits, it also reports violations of rlimits.

The following messages show up in the log, but it seems that the IMAP 
Server works fine:

Apr 26 19:20:04 src@gate imap-login: Login: hz [192.168.0.11]
Apr 26 19:20:05 src@gate kernel: grsec: attempted resource overstep by 
requesting 37 for RLIMIT_NPROC against limit 0 by (dovecot:10246) UID(0) 
EUID(0), parent (dovecot:634) UID(0) EUID(0)
Apr 26 19:22:18 src@gate kernel: grsec: attempted resource overstep by 
requesting 37 for RLIMIT_NPROC against limit 0 by (dovecot:19802) UID(0) 
EUID(0), parent (dovecot:634) UID(0) EUID(0)
Apr 26 19:22:18 src@gate imap-login: Login: hz [192.168.0.11]
Apr 26 19:26:36 src@gate syslog-ng[606]: STATS: dropped 0
Apr 26 19:28:19 src@gate kernel: grsec: attempted resource overstep by 
requesting 33 for RLIMIT_NPROC against limit 0 by (dovecot:16011) UID(0) 
EUID(0), parent (dovecot:634) UID(0) EUID(0)

How should we proceed to analyze/fix this problem?

Thanks!
   Heiko


From tss@iki.fi  Sun Apr 27 04:19:32 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 27 Apr 2003 04:19:32 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 3F3AF23845
	for <dovecot@procontrol.fi>; Sun, 27 Apr 2003 04:19:32 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id DFAC95E017F5; Sun, 27 Apr 2003 04:19:31 +0300 (EEST)
Subject: [dovecot] Re: dovecot and grsecurity (problem with resource limits)
From: Timo Sirainen <tss@iki.fi>
To: Heiko Zuerker <heiko@zuerker.org>
Cc: dovecot@procontrol.fi
In-Reply-To: <3EAB1EDF.8060807@zuerker.org>
References: <3EAB1EDF.8060807@zuerker.org>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1051406371.26178.22.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 27 Apr 2003 04:19:31 +0300
X-archive-position: 680
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 683                                                  
Status: O
Content-Length: 2084

On Sun, 2003-04-27 at 03:05, Heiko Zuerker wrote:
> Apr 26 19:20:04 src@gate imap-login: Login: hz [192.168.0.11]
> Apr 26 19:20:05 src@gate kernel: grsec: attempted resource overstep by 
> requesting 37 for RLIMIT_NPROC against limit 0 by (dovecot:10246) UID(0) 
> EUID(0), parent (dovecot:634) UID(0) EUID(0)

Openwall kernel had the same problem. Hmm. I'd like to make sure that
imap-login can't fork(), but RLIMIT_NPROC seems to be total number of
processes. When does it get enforced? Immediately at setrlimit() or at
exec()? Does this work:

Index: src/login-common/main.c
===================================================================
RCS file: /home/cvs/dovecot/src/login-common/main.c,v
retrieving revision 1.9
diff -u -r1.9 main.c
--- src/login-common/main.c     6 Mar 2003 21:44:31 -0000       1.9
+++ src/login-common/main.c     27 Apr 2003 01:17:46 -0000
@@ -4,6 +4,7 @@
 #include "ioloop.h"
 #include "lib-signals.h"
 #include "restrict-access.h"
+#include "restrict-process-size.h"
 #include "process-title.h"
 #include "fd-close-on-exec.h"
 #include "auth-connection.h"
@@ -129,6 +130,9 @@
 
 static void drop_privileges(const char *name)
 {
+       /* make sure we can't fork() */
+       restrict_process_size((unsigned int)-1, 0);
+
        /* Log file or syslog opening probably requires roots */
        open_logfile(name);
 
cvs server: Diffing src/master
Index: src/master/login-process.c
===================================================================
RCS file: /home/cvs/dovecot/src/master/login-process.c,v
retrieving revision 1.40
diff -u -r1.40 login-process.c
--- src/master/login-process.c  15 Apr 2003 16:58:48 -0000      1.40
+++ src/master/login-process.c  27 Apr 2003 01:17:47 -0000
@@ -479,7 +479,7 @@
                        i_fatal("chdir(%s) failed: %m", set->login_dir);
        }
 
-       restrict_process_size(group->set->process_size, 0);
+       restrict_process_size(group->set->process_size, (unsigned int)-1);
 
        /* make sure we don't leak syslog fd, but do it last so that
           any errors above will be logged */


From tss@iki.fi  Sun Apr 27 05:00:26 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 27 Apr 2003 05:00:26 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 9126323845
	for <dovecot@procontrol.fi>; Sun, 27 Apr 2003 05:00:26 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 1F7B45E017F5; Sun, 27 Apr 2003 05:00:24 +0300 (EEST)
Subject: [dovecot] Re: shared folders?
From: Timo Sirainen <tss@iki.fi>
To: Dovecot Mail List <dovecot@procontrol.fi>
In-Reply-To: <20030426035220.GA26817@woom.net>
References: <20030423170402.GA14185@woom.net>
	 <1051117898.32159.209.camel@hurina> <3EA89CDE.9000906@attbi.com>
	 <1051265990.32159.279.camel@hurina> <20030425113712.GA23447@woom.net>
	 <1051277990.32157.296.camel@hurina> <20030425170617.GA19484@woom.net>
	 <1051291295.32159.381.camel@hurina> <20030425184842.GA25545@woom.net>
	 <1051300365.32157.400.camel@hurina>  <20030426035220.GA26817@woom.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1051408823.26180.75.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 27 Apr 2003 05:00:24 +0300
X-archive-position: 681
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 684                                                  
Status: O
Content-Length: 3702

On Sat, 2003-04-26 at 06:52, Moe Wibble wrote:
> I must admit that I have never really understood (and only very briefly
> browsed over) the idea of imap namespaces. With the little bit I know I'm
> basically considering them mainly as a convenience for a person willing to
> implement an imap server because they make it easier to have the imapd emulate
> "virtual" folders to the client.

Namespaces also tell client if a folder is user's own, other user's or
public (eg. news). Client might want to do things differently depending
on the type.

> Your maildir/mbox example makes a bit sense to me even though I don't
> see the big advantage there either.
> 
> But then again, maybe I'm just missing the whole point
> about namespaces..?

Like Andreas said, the whole point is that you don't get naming 
collisions between folders.

You can of course always just create symlinks manually, but I'd like to
support some more user friendly ways.

> > I think the symlinking is quite simple way to do this and plays very
> > nicely with how maildir works internally. If I do some separate
> > meta-file for flags (I've thought about that too) it wouldn't be maildir
> > anymore. I might just as well implement another mail storage format
> > then.
> 
> The major problem I see is the extensive use of inodes.

Why use maildir at all then? :) XFS at least doesn't have inode limits,
I'd guess other file systems nowadays would neither.

> Also keeping the
> symlink-copies in sync with the main folder seems like an expensive
> task to me.

Hmm. Well, it would require that symlink is updated when flags are
updated in original folder.

> And you already have meta files (the index), why not add one?

Such flag file would preferrably have to be NFS safe. That makes it a
bit more difficult.

> > So, you don't want IMAP ACL support at all? I do, but I'll of course
> > leave it optional.
> 
> I'd really prefer a simpler approach, at least for a start.

Sure. I'm not going to add shared folder or ACL support anytime soon.
It's still scheduled post-1.0

> The "simple" shared folders should be fairly easy to implement.

You have read-write already :)

> How good is client support for ACLs nowadays anyways?

Probably not very good. Bynari's InsightConnector is one which could be
useful. Makes it possible to replace MS Excenge with IMAP server for
Outlook.

> > > > - Make existing commands play nicely with ACLs and shared folders
> > > >    - Say "permission denied" rather than "internal error" if some
> > > > syscall returns EACCES (mostly when opening folders)
> > > 
> > > Hm. Ah, that's what we get out of all the effort?
> > 
> > It's not nice to let users fill your error log files.
> 
> Yes, you're right ofcourse.
> But it shouldn't be too hard to issue proper error messages even
> without ACLs. ;)

Sure. That was just a related TODO item.

> > > >    - When trying to expunge a message that wasn't ours, ignore or give
> > > > human readable error message (which one?), but don't give "internal
> > > > error"
> > > 
> > > Umm. Does anyone really care about that?
> > 
> > Depends on how you want the shared folder to behave. Yes, the guy who I
> > wrote this mail first wanted such behaviour.
> 
> Well, that's where we have a different view on shared folders. :)
> "My" shared folders can be read-only or read-write.
> Trying to delete a message from a read-only shared folder would cause
> a "Permission denied."-message. I didn't quite understand in first place
> why that is worth mentioning?

That meant a folder where each message was owned by a user, and only he
could delete the message. ie. unlink() fails for a file in sticky
maildir directory because we're not the owner.


From eskimoe@ananzi.co.za  Sun Apr 27 17:54:17 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 27 Apr 2003 17:54:18 +0300 (EEST)
Return-Path: <eskimoe@ananzi.co.za>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from sun.com (port-212-202-174-173.reverse.qdsl-home.de [212.202.174.173])
	by danu.procontrol.fi (Postfix) with SMTP id 109642385F
	for <dovecot@procontrol.fi>; Sun, 27 Apr 2003 17:54:17 +0300 (EEST)
Received: (qmail 8521 invoked by uid 1000); 27 Apr 2003 14:55:48 -0000
Date: Sun, 27 Apr 2003 16:55:48 +0200
From: Moe Wibble <eskimoe@ananzi.co.za>
To: Dovecot Mail List <dovecot@procontrol.fi>
Subject: [dovecot] Re: shared folders?
Message-ID: <20030427145548.GA22383@woom.net>
Mail-Followup-To: Moe Wibble <eskimoe@ananzi.co.za>,
	Dovecot Mail List <dovecot@procontrol.fi>
References: <3EA89CDE.9000906@attbi.com> <1051265990.32159.279.camel@hurina> <20030425113712.GA23447@woom.net> <1051277990.32157.296.camel@hurina> <20030425170617.GA19484@woom.net> <1051291295.32159.381.camel@hurina> <20030425184842.GA25545@woom.net> <1051300365.32157.400.camel@hurina> <20030426035220.GA26817@woom.net> <1051408823.26180.75.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1051408823.26180.75.camel@hurina>
X-archive-position: 682
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: eskimoe@ananzi.co.za
Precedence: bulk
X-list: dovecot
X-UID: 685                                                  
Status: O
Content-Length: 3739

On Sun, Apr 27, 2003 at 05:00:24AM +0300, Timo Sirainen wrote:
> On Sat, 2003-04-26 at 06:52, Moe Wibble wrote:
> > I must admit that I have never really understood (and only very briefly
> > browsed over) the idea of imap namespaces. With the little bit I know I'm
> > basically considering them mainly as a convenience for a person willing to
> > implement an imap server because they make it easier to have the imapd emulate
> > "virtual" folders to the client.
> 
> Namespaces also tell client if a folder is user's own, other user's or
> public (eg. news). Client might want to do things differently depending
> on the type.

Ah okay, that's the part I missed when reading about them.
So "inbox", "public" and "shared" are not randomly chosen but actually
tell the client (by definition) something about the nature of the
folder?
Okay, if clients deal properly with that then I'm fine. :)

> > Your maildir/mbox example makes a bit sense to me even though I don't
> > see the big advantage there either.
> > 
> > But then again, maybe I'm just missing the whole point
> > about namespaces..?
> 
> Like Andreas said, the whole point is that you don't get naming 
> collisions between folders.

Yes, and I thought about solving them by having one of them renamed.
But it doesn't matter anyways. My only concern was about how current
MUAs handle (visualize) namespaces. If they don't tend to introduce any
inconveniences for the user then my previous arguments are void. :)

> You can of course always just create symlinks manually, but I'd like to
> support some more user friendly ways.

I like symlinks but I'm not religious about them! ;)

> > > I think the symlinking is quite simple way to do this and plays very
> > > nicely with how maildir works internally. If I do some separate
> > > meta-file for flags (I've thought about that too) it wouldn't be maildir
> > > anymore. I might just as well implement another mail storage format
> > > then.
> > 
> > The major problem I see is the extensive use of inodes.
> 
> Why use maildir at all then? :) XFS at least doesn't have inode limits,
> I'd guess other file systems nowadays would neither.

Well, AFAIK most other filesystems do have inode limits.
Adding a variable multiplier to the amount of inodes used doesn't
seem very elegant to me.

> > Also keeping the
> > symlink-copies in sync with the main folder seems like an expensive
> > task to me.
> 
> Hmm. Well, it would require that symlink is updated when flags are
> updated in original folder.

So dovecot better be the only one making changes to the the original folder?

> > And you already have meta files (the index), why not add one?
> 
> Such flag file would preferrably have to be NFS safe. That makes it a
> bit more difficult.

I keep reading "NFS safe".
To me that's an oxymoron...

> > > So, you don't want IMAP ACL support at all? I do, but I'll of course
> > > leave it optional.
> > 
> > I'd really prefer a simpler approach, at least for a start.
> 
> Sure. I'm not going to add shared folder or ACL support anytime soon.
> It's still scheduled post-1.0

Well, looking forward to it. I'm a bit worried that dovecot won't be
"slim" at all anymore by then, though.

> > The "simple" shared folders should be fairly easy to implement.
> 
> You have read-write already :)

Yes and adding not more but a per-user r/o-option to that would be
perfectly sufficient for most of _my_ applications.
I ofcourse can't speak for other users...

> > How good is client support for ACLs nowadays anyways?
> 
> Probably not very good. Bynari's InsightConnector is one which could be
> useful. Makes it possible to replace MS Excenge with IMAP server for
> Outlook.

I'll pretend I've not have read that last sentence...


From tss@iki.fi  Sun Apr 27 19:33:26 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 27 Apr 2003 19:33:26 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id EA5182385F
	for <dovecot@procontrol.fi>; Sun, 27 Apr 2003 19:33:25 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 66AAF5E017F5; Sun, 27 Apr 2003 19:33:25 +0300 (EEST)
Subject: [dovecot] Re: shared folders?
From: Timo Sirainen <tss@iki.fi>
To: Dovecot Mail List <dovecot@procontrol.fi>
In-Reply-To: <20030427145548.GA22383@woom.net>
References: <3EA89CDE.9000906@attbi.com> <1051265990.32159.279.camel@hurina>
	 <20030425113712.GA23447@woom.net> <1051277990.32157.296.camel@hurina>
	 <20030425170617.GA19484@woom.net> <1051291295.32159.381.camel@hurina>
	 <20030425184842.GA25545@woom.net> <1051300365.32157.400.camel@hurina>
	 <20030426035220.GA26817@woom.net> <1051408823.26180.75.camel@hurina>
	 <20030427145548.GA22383@woom.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1051461197.26181.101.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 27 Apr 2003 19:33:23 +0300
X-archive-position: 683
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 686                                                  
Status: O
Content-Length: 1503

On Sun, 2003-04-27 at 17:55, Moe Wibble wrote:
> > Namespaces also tell client if a folder is user's own, other user's or
> > public (eg. news). Client might want to do things differently depending
> > on the type.
> 
> Ah okay, that's the part I missed when reading about them.
> So "inbox", "public" and "shared" are not randomly chosen but actually
> tell the client (by definition) something about the nature of the
> folder?

The actual names don't matter, but just how they're liststed in
NAMESPACE reply. For example:

* NAMESPACE (("INBOX." ".")("#mbox/" "/")) (("Other users/", "/")) (("#news." ".")("Mailing lists/" "/"))

> > > Also keeping the
> > > symlink-copies in sync with the main folder seems like an expensive
> > > task to me.
> > 
> > Hmm. Well, it would require that symlink is updated when flags are
> > updated in original folder.
> 
> So dovecot better be the only one making changes to the the original folder?

No, it doesn't matter who does the change in the original folder.
Dovecot will just have to notice that symlink destination doesn't exist
and fix it.

> > Sure. I'm not going to add shared folder or ACL support anytime soon.
> > It's still scheduled post-1.0
> 
> Well, looking forward to it. I'm a bit worried that dovecot won't be
> "slim" at all anymore by then, though.

I try to keep it unbloated :) Preferrably all IMAP extensions should be
possible to leave out at compile time, but some just are a bit too
invasive to be left out without tons of #ifdefs.


From tss@iki.fi  Sun Apr 27 19:56:21 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 27 Apr 2003 19:56:21 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 34FF12385F
	for <dovecot@procontrol.fi>; Sun, 27 Apr 2003 19:56:21 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id E07BB5E017F5; Sun, 27 Apr 2003 19:56:20 +0300 (EEST)
Subject: [dovecot] 0.99.9 release candidate 1
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1051462580.26180.113.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 27 Apr 2003 19:56:20 +0300
X-archive-position: 684
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 687                                                  
Status: O
Content-Length: 2185

0.99.9 should really be released soon. There's been quite a lot of
important fixes since 0.99.8.1.

There's still some recent counter strangeness, but it wasn't perfect
before either.

mbox still doesn't necessarily notice flag changes unless they're
written into index file (ie. non-Dovecots and Dovecot without index
files). But it wasn't perfect before either.

dovecot-uidlist file works perfectly now as far as I know.

I just noticed that mbox syncing has been somewhat broken for past
month. It sometimes assigned new UIDs to messages without any reason, so
it was mostly just slowdown.

So unless there's something really broken, I'll release 0.99.9 tomorrow.
Please get 0.99.9-rc1 from http://dovecot.procontrol.fi/rc/ and see if
you can break it.

NEWS file:

v0.99.9 2003-04-28  Timo Sirainen <tss@iki.fi>

	* WARNING: mbox rewriting works now faster, but it's less likely to
	  notice external message flag changes (it wasn't perfect before
	  either). This also means that if you're not using index files,
	  Dovecot may not notice changes made by another process. This will be
	  fixed later.

	+ Message UIDs are now permanently stored outside index files.
	  Deleting indexes is now possible without any kind of data loss and
	  in-memory indexes are now usable.
	+ mbox rewriting leaves extra space into X-Keywords header. It's
	  shrinked or grown when updating message flag headers to avoid
	  rewriting the rest of the file.
	+ imap-login and pop3-login can now be started from inetd. Privilege
	  separation is still used, so it executes dovecot and dovecot-auth
	  processes which are left on the background.
	+ PostgreSQL authentication support, patch by Alex Howansky
	- Large multiline headers (over 8kB) broke Dovecot before. Now they're
	  parsed one line at a time and we try to avoid reading them fully into
	  memory.
	- SEARCH OR was broken
	- Partial BODY[] fetches were broken
	- Timezones were still set wrong when parsing dates
	- Using non-synchronized literals (LITERAL+) broke APPEND
	- Renaming maildir subfolders inserted extra "." in the middle.
	- Subfolders were a bit broken with maildir
	- Invalid PLAIN auth request crashed auth process.


From seba@iq.pl  Sun Apr 27 22:00:46 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 27 Apr 2003 22:00:46 +0300 (EEST)
Return-Path: <seba@iq.pl>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from serv.iq.pl (serv.iq.pl [213.76.165.9])
	by danu.procontrol.fi (Postfix) with ESMTP id 140412385F
	for <dovecot@procontrol.fi>; Sun, 27 Apr 2003 22:00:46 +0300 (EEST)
Received: by serv.iq.pl (Postfix, from userid 1390)
	id 4103B6BCEC; Sun, 27 Apr 2003 21:01:32 +0200 (CEST)
Date: Sun, 27 Apr 2003 21:01:32 +0200
From: Sebastian Pachuta <seba@iq.pl>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: 0.99.9 release candidate 1
Message-ID: <20030427190132.GB19048@iq.pl>
References: <1051462580.26180.113.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1051462580.26180.113.camel@hurina>
X-archive-position: 685
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: seba@iq.pl
Precedence: bulk
X-list: dovecot
X-UID: 688                                                  
Status: O

On Sun, Apr 27, 2003 at 19:56:20 +0300, Timo Sirainen wrote:

> Please get 0.99.9-rc1 from http://dovecot.procontrol.fi/rc/ and see if
> you can break it.

Works with openwall by default, great!

Is there any way to drop unused stuff like --without-mbox?

From tss@iki.fi  Sun Apr 27 22:18:51 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 27 Apr 2003 22:18:51 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id EDB6223845
	for <dovecot@procontrol.fi>; Sun, 27 Apr 2003 22:18:50 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 41AFE5EC9737; Sun, 27 Apr 2003 22:18:49 +0300 (EEST)
Subject: [dovecot] Re: 0.99.9 release candidate 1
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030427190132.GB19048@iq.pl>
References: <1051462580.26180.113.camel@hurina>
	 <20030427190132.GB19048@iq.pl>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1051471128.26181.120.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 27 Apr 2003 22:18:48 +0300
X-archive-position: 686
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 689                                                  
Status: O

On Sun, 2003-04-27 at 22:01, Sebastian Pachuta wrote:
> Is there any way to drop unused stuff like --without-mbox?

Nothing that easy, but:

In configure edit line:
STORAGE="maildir mbox"

In src/imap/Makefile edit line:
imap_LDADD = ... ../lib-storage/index/mbox/libstorage_mbox.a ../lib-index/mbox/libstorage_index_mbox.a ...

I guess I could add --with-storages=maildir option to configure.


From seba@iq.pl  Sun Apr 27 22:59:43 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 27 Apr 2003 22:59:43 +0300 (EEST)
Return-Path: <seba@iq.pl>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from serv.iq.pl (serv.iq.pl [213.76.165.9])
	by danu.procontrol.fi (Postfix) with ESMTP id D362D23845
	for <dovecot@procontrol.fi>; Sun, 27 Apr 2003 22:59:42 +0300 (EEST)
Received: by serv.iq.pl (Postfix, from userid 1390)
	id 2CD9B6BD2B; Sun, 27 Apr 2003 22:00:29 +0200 (CEST)
Date: Sun, 27 Apr 2003 22:00:29 +0200
From: Sebastian Pachuta <seba@iq.pl>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: 0.99.9 release candidate 1
Message-ID: <20030427200029.GC19048@iq.pl>
References: <1051462580.26180.113.camel@hurina> <20030427190132.GB19048@iq.pl> <1051471128.26181.120.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1051471128.26181.120.camel@hurina>
X-archive-position: 687
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: seba@iq.pl
Precedence: bulk
X-list: dovecot
X-UID: 690                                                  
Status: O

On Sun, Apr 27, 2003 at 22:18:48 +0300, Timo Sirainen wrote:
> On Sun, 2003-04-27 at 22:01, Sebastian Pachuta wrote:
> > Is there any way to drop unused stuff like --without-mbox?
> 
> Nothing that easy, but:
> 
> In configure edit line:
> STORAGE="maildir mbox"
> 
> In src/imap/Makefile edit line:
> imap_LDADD = ... ../lib-storage/index/mbox/libstorage_mbox.a ../lib-index/mbox/libstorage_index_mbox.a ...

so far runs ok - tx

> I guess I could add --with-storages=maildir option to configure.

That will be very nice.

From adam@os.inf.tu-dresden.de  Mon Apr 28 00:05:58 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 28 Apr 2003 00:05:58 +0300 (EEST)
Return-Path: <adam@os.inf.tu-dresden.de>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from os.inf.tu-dresden.de (os.inf.tu-dresden.de [141.76.48.99])
	by danu.procontrol.fi (Postfix) with ESMTP id A4DED2385F
	for <dovecot@procontrol.fi>; Mon, 28 Apr 2003 00:05:58 +0300 (EEST)
Received: from erwin.inf.tu-dresden.de ([141.76.48.80])
	by os.inf.tu-dresden.de with esmtp (Exim 3.36)
	id 199tLQ-000OQa-00
	for dovecot@procontrol.fi; Sun, 27 Apr 2003 23:05:56 +0200
Received: from adam by erwin.inf.tu-dresden.de with local (Exim 3.35 #1 (Debian))
	id 199tLQ-0004um-00
	for <dovecot@procontrol.fi>; Sun, 27 Apr 2003 23:05:56 +0200
Date: Sun, 27 Apr 2003 23:05:56 +0200
From: Adam Lackorzynski <adam@os.inf.tu-dresden.de>
To: dovecot@procontrol.fi
Subject: [dovecot] Re: 0.99.9 release candidate 1
Message-ID: <20030427210555.GD21753@os.inf.tu-dresden.de>
Mail-Followup-To: dovecot@procontrol.fi
References: <1051462580.26180.113.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
In-Reply-To: <1051462580.26180.113.camel@hurina>
User-Agent: Mutt/1.4i
X-archive-position: 688
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: adam@os.inf.tu-dresden.de
Precedence: bulk
X-list: dovecot
X-UID: 691                                                  
Status: O

On Sun Apr 27, 2003 at 19:56:20 +0300, Timo Sirainen wrote:
> Please get 0.99.9-rc1 from http://dovecot.procontrol.fi/rc/ and see if
> you can break it.

I need this little patch to compile on AIX. Except this it seems to work
now without further modifications.

--- dovecot-0.99.9-rc1.orig/src/lib/fdpass.c	Sun Apr 27 22:12:44 2003
+++ dovecot-0.99.9-rc1/src/lib/fdpass.c	Sun Apr 27 22:12:44 2003
@@ -32,9 +32,9 @@
 */
 
 #define _XPG4_2
-#define _XOPEN_SOURCE /* for IRIX */
 
 #ifndef _AIX
+#  define _XOPEN_SOURCE /* for IRIX */
 #  define _XOPEN_SOURCE_EXTENDED /* for Tru64, breaks AIX */
 #endif
 




Adam
-- 
Adam                 adam@os.inf.tu-dresden.de
  Lackorzynski         http://os.inf.tu-dresden.de/~adam/

From lfarkas@bnap.hu  Mon Apr 28 13:02:29 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 28 Apr 2003 13:02:29 +0300 (EEST)
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 1728323845
	for <dovecot@procontrol.fi>; Mon, 28 Apr 2003 13:02:29 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id 5AD3975400C
	for <dovecot@procontrol.fi>; Mon, 28 Apr 2003 12:04:50 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id 1F25C3EBF
	for <dovecot@procontrol.fi>; Mon, 28 Apr 2003 12:02:20 +0200 (CEST)
Received: from bnap.hu (garfield.int.bppiac.hu [192.168.0.50])
	by mail2.bppiac.hu (Postfix) with ESMTP id 0763E3EAD
	for <dovecot@procontrol.fi>; Mon, 28 Apr 2003 12:02:20 +0200 (CEST)
Message-ID: <3EACFC2B.9090605@bnap.hu>
Date: Mon, 28 Apr 2003 12:02:19 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: [dovecot] current cvs (04.28)
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 689
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 692                                                  
Status: O
Content-Length: 1070

hi,
after the current cvs compile:
-----------------------
gcc -DHAVE_CONFIG_H -I. -I. -I../.. -I../../src/lib -I../../src/lib-mail 
-I../../src/lib-imap -I../../src/lib-storage    -O2 -g -pipe -march=i386 
-mcpu=i686
-Wall -W -Wmissing-prototypes -Wmissing-declarations -Wpointer-arith 
-Wchar-subscripts -Wformat=2 -Wbad-function-cast  -c `test -f 
'mail-storage-callbacks.c' || echo './'`mail-storage-callbacks.c
source='main.c' object='main.o' libtool=no \
depfile='.deps/main.Po' tmpdepfile='.deps/main.TPo' \
depmode=gcc3 /bin/sh ../../depcomp \
gcc -DHAVE_CONFIG_H -I. -I. -I../.. -I../../src/lib -I../../src/lib-mail 
-I../../src/lib-imap -I../../src/lib-storage    -O2 -g -pipe -march=i386 
-mcpu=i686
-Wall -W -Wmissing-prototypes -Wmissing-declarations -Wpointer-arith 
-Wchar-subscripts -Wformat=2 -Wbad-function-cast  -c `test -f 'main.c' 
|| echo './'`main.c
make[3]: *** No rule to make target `../lib-index/libstorage_index.a', 
needed by `pop3'.  Stop.
-----------------------

-- 
   Levente                               "Si vis pacem para bellum!"



From tss@iki.fi  Mon Apr 28 19:43:10 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 28 Apr 2003 19:43:10 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id C025A2385F
	for <dovecot@procontrol.fi>; Mon, 28 Apr 2003 19:43:10 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 59C075E107F8; Mon, 28 Apr 2003 19:43:10 +0300 (EEST)
Subject: [dovecot] 0.99.9 released
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1051548190.26178.156.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 28 Apr 2003 19:43:10 +0300
X-archive-position: 690
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 693                                                  
Status: O
Content-Length: 1626

As promised yesterday :)

BTW. I just found libsqlora8 library yesterday and I've been playing
with Oracle mail storage support. Shouldn't take too long to get it
working.

And the NEWS file once more:

v0.99.9 2003-04-28  Timo Sirainen <tss@iki.fi>

	* WARNING: mbox rewriting works now faster, but it's less likely to
	  notice external message flag changes (it wasn't perfect before
	  either). This also means that if you're not using index files,
	  Dovecot may not notice changes made by another Dovecot process.
	  This will be fixed later.

	+ Message UIDs are now permanently stored outside index files.
	  Deleting indexes is now possible without any kind of data loss and
	  in-memory indexes are now usable.
	+ mbox rewriting leaves extra space into X-Keywords header. It's
	  shrinked or grown when updating message flag headers to avoid
	  rewriting the rest of the file.
	+ imap-login and pop3-login can now be started from inetd. Privilege
	  separation is still used, so it executes dovecot and dovecot-auth
	  processes which are left on the background.
	+ PostgreSQL authentication support, patch by Alex Howansky
	- Large multiline headers (over 8kB) broke Dovecot before. Now they're
	  parsed one line at a time and we try to avoid reading them fully into
	  memory.
	- SEARCH OR was broken
	- Partial BODY[] fetches were broken
	- Timezones were still set wrong when parsing dates
	- Using non-synchronized literals (LITERAL+) broke APPEND
	- Renaming maildir subfolders inserted extra "." in the middle.
	- Subfolders were a bit broken with maildir
	- Invalid PLAIN auth request crashed auth process.


From dag@wieers.com  Tue Apr 29 03:41:27 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 29 Apr 2003 05:18:53 +0300 (EEST)
Return-Path: <dag@wieers.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from horsea.3ti.be (horsea.3ti.be [212.204.244.41])
	by danu.procontrol.fi (Postfix) with ESMTP id 3DAE02385F
	for <dovecot@procontrol.fi>; Tue, 29 Apr 2003 03:41:27 +0300 (EEST)
Received: from localhost (dag@localhost.localdomain [127.0.0.1])
	by horsea.3ti.be (8.11.6/8.11.6) with ESMTP id h3T0fPE31748
	for <dovecot@procontrol.fi>; Tue, 29 Apr 2003 02:41:25 +0200
Date: Tue, 29 Apr 2003 02:39:23 +0200 (CEST)
From: Dag Wieers <dag@wieers.com>
X-X-Sender: dag@horsea.3ti.be
To: Timo Sirainen <tss@iki.fi>
Subject: [dovecot] Dovecot RH RPM packages
Message-ID: <Pine.LNX.4.44.0304290235310.22905-100000@horsea.3ti.be>
User-Agent: Mutt/1.2.5.1i
X-Mailer: Ximian Evolution 1.0.5
Organization: 3TI Web Hosting Services
X-Extra: We know Linux is the best. It can do infinite loops in five seconds. - Linus Torvalds
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset="ISO-8859-15; FORMAT=flowed"
Content-Transfer-Encoding: 8BIT
ReSent-Date: Tue, 29 Apr 2003 02:41:18 +0200 (CEST)
Resent-From: Dag Wieers <dag@wieers.com>
Resent-To: dovecot@procontrol.fi
ReSent-Subject: Dovecot RH RPM packages
ReSent-Message-ID: <Pine.LNX.4.44.0304290241180.22905@horsea.3ti.be>
X-archive-position: 691
X-Approved-By: tss@iki.fi
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: dag@wieers.com
Precedence: bulk
X-list: dovecot
X-UID: 694                                                  
Status: O

Hi,

I can't remember if I already told you, but I'm building RPM packages of 
dovecot for RH73, RH80 and RH9. You can find these at:

	http://dag.wieers.com/packages/dovecot/

Or use apt as described on:

	http://dag.wieers.com/apt/

I also added a sysv file to the SPEC-file for use with Red Hat.

If you add this SPEC-file to your tarball (probably with some custom 
changes) everyone can build an RPM package by issuing:

	rpmbuild -ta <tarball>

Kind regards,
--   dag wieers,  dag@wieers.com,  http://dag.wieers.com/   --
«Any errors in spelling, tact or fact are transmission errors»



From jaldhar@debian.org  Wed Apr 30 17:40:16 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 30 Apr 2003 17:40:16 +0300 (EEST)
Return-Path: <jaldhar@debian.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail.braincells.com (samadhi.braincells.com [216.162.42.100])
	by danu.procontrol.fi (Postfix) with ESMTP id E0BF92385F
	for <dovecot@procontrol.fi>; Wed, 30 Apr 2003 17:40:15 +0300 (EEST)
Received: from localhost (localhost [127.0.0.1])
	by mail.braincells.com (Postfix) with ESMTP id CD9D27FB3
	for <dovecot@procontrol.fi>; Wed, 30 Apr 2003 10:40:10 -0400 (EDT)
Date: Wed, 30 Apr 2003 10:40:10 -0400 (EDT)
From: "Jaldhar H. Vyas" <jaldhar@debian.org>
X-X-Sender: jaldhar@samadhi.braincells.com
Reply-To: "Jaldhar H. Vyas" <jaldhar@debian.org>
To: dovecot@procontrol.fi
Subject: [dovecot] Debian packages for 0.99.9
Message-ID: <Pine.LNX.4.53.0304301029320.23210@samadhi.braincells.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 692
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jaldhar@debian.org
Precedence: bulk
X-list: dovecot
X-UID: 695                                                  
Status: O
Content-Length: 1276

I uploaded the new version to sid today.  Apart from the new version a big
change is that it has now been split into 4 pieces.  dovecot-imapd and
dovecot-pop3d are the imap server and the pop3 server rspectively.  They
are seperate so you can install one without the other.  dovecot-common
contains the files they both use.  dovecot is just a dummy to ensure
smooth upgrades for users of older versions.  As there are new packages,
they will take a while to show up i the archive so I'm temporarily making
them available from http://src.braincells.com/debian/sid/dovecot/ or

deb http://src.braincells.com/debian sid/
deb-src http://src.braincells.com/debian sid/

via apt-get.

but unless you have a burning need to upgrade, I recommend you just wait a
few days.

A backport to woody is also available, add

deb http://src.braincells.com/debian woody/
deb-src http://src.braincells.com/debian woody/

to your sources.list.  One problem I found with installing on woody is
that the first time you do apt-get install dovecot, it gives you an error
because /etc/dovecot.conf is no owned by dovect-common instead of dovecot.
It will work correctly the second time you run the command.

-- 
Jaldhar H. Vyas <jaldhar@debian.org>
La Salle Debain - http://www.braincells.com/debian/

From jaldhar@debian.org  Wed Apr 30 17:41:15 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 30 Apr 2003 17:41:15 +0300 (EEST)
Return-Path: <jaldhar@debian.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail.braincells.com (samadhi.braincells.com [216.162.42.100])
	by danu.procontrol.fi (Postfix) with ESMTP id 8B8132385F
	for <dovecot@procontrol.fi>; Wed, 30 Apr 2003 17:41:15 +0300 (EEST)
Received: from localhost (localhost [127.0.0.1])
	by mail.braincells.com (Postfix) with ESMTP
	id 1DC377FBB; Wed, 30 Apr 2003 10:41:09 -0400 (EDT)
Date: Wed, 30 Apr 2003 10:41:09 -0400 (EDT)
From: "Jaldhar H. Vyas" <jaldhar@debian.org>
X-X-Sender: jaldhar@samadhi.braincells.com
Reply-To: "Jaldhar H. Vyas" <jaldhar@debian.org>
To: Timo Sirainen <tss@iki.fi>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: 0.99.9 released
In-Reply-To: <1051548190.26178.156.camel@hurina>
Message-ID: <Pine.LNX.4.53.0304301040200.23210@samadhi.braincells.com>
References: <1051548190.26178.156.camel@hurina>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 693
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jaldhar@debian.org
Precedence: bulk
X-list: dovecot
X-UID: 696                                                  
Status: O

On Mon, 28 Apr 2003, Timo Sirainen wrote:

> As promised yesterday :)
>

Any ETA on getting dotlocking fixed?

-- 
Jaldhar H. Vyas <jaldhar@debian.org>
La Salle Debain - http://www.braincells.com/debian/

From mem@mv.mv.com  Wed Apr 30 21:00:08 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 30 Apr 2003 21:00:08 +0300 (EEST)
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id D12F3238C5
	for <dovecot@procontrol.fi>; Wed, 30 Apr 2003 21:00:07 +0300 (EEST)
Received: (qmail 19470 invoked by uid 101); 30 Apr 2003 14:00:06 -0400
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Wed, 30 Apr 2003 14:00:06 -0400
To: dovecot@procontrol.fi
Subject: [dovecot] Corrupted index
Message-ID: <20030430180006.GA5132@iridium.mv.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.4.1i
X-archive-position: 694
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mem@mv.mv.com
Precedence: bulk
X-list: dovecot
X-UID: 697                                                  
Status: O

Hi-

Still getting a bunch of these:

Apr 30 13:45:23 mercury mem[11056]: pop3(user1): Corrupted index file
/users/78/user1/Maildir/.INBOX/.imap.index: used_file_size larger than
real file size (4032 vs 1608)

and the occasional:

Apr 30 13:08:53 mercury mem[13507]: pop3(user2): Corrupted index file
(in-memory index for /users/e0/user2/Maildir): Filename mismatch for
UID 1: 1051720748.28556.mercury.mv.net vs 1051715695.29601.mercury.mv.net

Most of the time (but not always) the .imap* files are relatively
old and apparently created by the test5 or older recent release.
The errors persist in the logs until I manually remove the .imap*
files, which are subsequently recreated upon the next access (without
the error being logged, at least not right away).

I had the impression that a "Corrupted index file" would cause the
index files not to be used, and in fact recreated.  Apparently not?
If there is an error that causes the .imap* files to be ignored,
shouldn't those files be removed?

mm

From mem@mv.mv.com  Thu May  1 02:51:54 2003
Received: with ECARTIS (v1.0.0; list dovecot); Thu, 01 May 2003 02:51:54 +0300 (EEST)
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id 0DC28238C5
	for <dovecot@procontrol.fi>; Thu,  1 May 2003 02:51:54 +0300 (EEST)
Received: (qmail 23229 invoked by uid 101); 30 Apr 2003 19:51:53 -0400
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Wed, 30 Apr 2003 19:51:53 -0400
To: dovecot@procontrol.fi
Subject: [dovecot] Message causing pop3 crash
Message-ID: <20030430235153.GJ22255@iridium.mv.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.4.1i
X-archive-position: 695
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mem@mv.mv.com
Precedence: bulk
X-list: dovecot
X-UID: 698                                                  
Status: O
Content-Length: 1045

Hi-

Found a message that will generate a pop3 coredump when using
mbox format.  It seems to do with the fact that it has a mime
part with a line that's 10,000 bytes long.  However, that doesn't
seem to be the only factor.

Adjusting the size of the mail header seems to cause different kinds
of crashes.  I'll avoid attaching the message here but I've
put it at http://www.mv.com/users/mem/x/badmail

Reproducing it here on a BSD/OS system involves something like:

(login to a virgin account or one you don't care about)

    % wget http://www.mv.com/users/mem/x/badmail
    % rm -rf .imap
    % MAIL=mbox:`pwd`/badmail
    % limit coredump 10m
    % /usr/local/libexec/dovecot/pop3
    quit

at which point you should get some errors and/or a coredump.  You
may need to do it twice (i.e. let it create the .imap/ index
structure first).

If you can't make it happen I can send along more info.

-mm-

(and yes, this was a real mail message, albeit a spam, except that I
simplified it some and replaced all of the content with "x" characters)

From pomac@vapor.com  Fri May  2 01:25:52 2003
Received: with ECARTIS (v1.0.0; list dovecot); Fri, 02 May 2003 01:25:52 +0300 (EEST)
Return-Path: <pomac@vapor.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from pomac.netswarm.net (c-180372d5.012-136-6c756e2.cust.bredbandsbolaget.se [213.114.3.24])
	by danu.procontrol.fi (Postfix) with ESMTP id 3E4892385F
	for <dovecot@procontrol.fi>; Fri,  2 May 2003 01:25:52 +0300 (EEST)
Received: from [10.0.0.254] (unknown [10.0.0.254])
	by pomac.netswarm.net (Postfix) with ESMTP
	id C3FC5AD4D1; Fri,  2 May 2003 00:25:50 +0200 (CEST)
Subject: [dovecot] Problems fetching messages.
From: Ian Kumlien <pomac@vapor.com>
To: dovecot@procontrol.fi
Cc: Timo Sirainen <tss@iki.fi>
Content-Type: multipart/signed; micalg=pgp-sha1; protocol="application/pgp-signature"; boundary="=-vQu3WJqUd+BApnAcUipB"
Organization: 
Message-Id: <1051827950.12768.29.camel@big.pomac.com>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 02 May 2003 00:25:50 +0200
X-archive-position: 696
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: pomac@vapor.com
Precedence: bulk
X-list: dovecot
X-UID: 699                                                  
Status: O
Content-Length: 1333


--=-vQu3WJqUd+BApnAcUipB
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Hi,=20

I have problems reading some mail with the latest version of dovecot.
I use maildir etc but it all worked before...

It seems like dovecot sends something that throws Evolution off the
track since the actual information is sent, but in a broken form it
seems.

I also get some odd chars (this is raw tcp packet decoding):
"=EF=EAa-=E8
"=EF=EAc-=E8* FLAGS (\Answered \Flagged \Deleted \Seen \Draft)
* OK [PERMANENTFLAGS (\Answered \Flagged \Deleted \Seen \Draft \*)]
Flags permitted.
* 609 EXISTS
* 0 RECENT
* OK [UIDVALIDITY 1049995962] UIDs valid
* OK [UIDNEXT 1044] Predicted next UID
A10891 OK [READ-WRITE] Select completed.

"=EF=EAc-=EE
"=EF=EAc-=EE* 609 FETCH (UID 1043)
A10892 OK Fetch completed.

"=EF=EAg-=EE* 498 FETCH (UID 646 BODY[] {3434}
eturn-Path: <-----email------->
etc...=20

Any clues?

--=20
Ian Kumlien <pomac@vapor.com>

--=-vQu3WJqUd+BApnAcUipB
Content-Type: application/pgp-signature; name=signature.asc
Content-Description: This is a digitally signed message part

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.0.7 (GNU/Linux)

iD8DBQA+sZ7u7F3Euyc51N8RAjHAAKCbHxTJxcCGeCwen0YA5dX1uqMirQCfYPZq
piD2hwlpzQkVRvKCfVbmRec=
=SVnN
-----END PGP SIGNATURE-----

--=-vQu3WJqUd+BApnAcUipB--


From tss@iki.fi  Sat May  3 20:41:39 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 03 May 2003 20:41:39 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id EDA752387F
	for <dovecot@procontrol.fi>; Sat,  3 May 2003 20:41:38 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 7C8805E107F8; Sat,  3 May 2003 20:41:37 +0300 (EEST)
Subject: [dovecot] Re: Message causing pop3 crash
From: Timo Sirainen <tss@iki.fi>
To: "Mark E. Mallett" <mem@mv.mv.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030430235153.GJ22255@iridium.mv.net>
References: <20030430235153.GJ22255@iridium.mv.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1051983694.26178.1039.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 03 May 2003 20:41:37 +0300
X-archive-position: 697
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 700                                                  
Status: O
Content-Length: 1051

On Thu, 2003-05-01 at 02:51, Mark E. Mallett wrote:
> Hi-
> 
> Found a message that will generate a pop3 coredump when using
> mbox format.  It seems to do with the fact that it has a mime
> part with a line that's 10,000 bytes long.  However, that doesn't
> seem to be the only factor.

There were 3 problems actually:

1) Dovecot stopped parsing messages that had lines longer than 8192
bytes (or 256k if mail_read_mmaped = yes). RFC-(2)822 says maximum line
length is 1000 bytes, do MTAs actually allow longer? Fixed anyway.

2) Dovecot thought UIDVALIDITY changed whenever mailbox had been empty.
Or in this case, when it thought the whole mailbox was changed because
the first message's length was different than it thought. This caused
"mailbox inconsistency" error.

3) pop3 server didn't handle inconsistency error separately and tried to
print NULL error message. Some sprintf() implementations (GLIBC at
least) print it as "(null)", but looks like it crashed with you. Fixed
this, and also it now prints NULL error as "BUG: Unknown error".


From tss@iki.fi  Sat May  3 20:45:30 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 03 May 2003 20:45:30 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 0AD982387F
	for <dovecot@procontrol.fi>; Sat,  3 May 2003 20:45:30 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id BBA015E107F8; Sat,  3 May 2003 20:45:29 +0300 (EEST)
Subject: [dovecot] Re: Corrupted index
From: Timo Sirainen <tss@iki.fi>
To: "Mark E. Mallett" <mem@mv.mv.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030430180006.GA5132@iridium.mv.net>
References: <20030430180006.GA5132@iridium.mv.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1051983928.26178.1043.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 03 May 2003 20:45:29 +0300
X-archive-position: 698
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 701                                                  
Status: O

On Wed, 2003-04-30 at 21:00, Mark E. Mallett wrote:
> I had the impression that a "Corrupted index file" would cause the
> index files not to be used, and in fact recreated.  Apparently not?
> If there is an error that causes the .imap* files to be ignored,
> shouldn't those files be removed?

Yes, if it says "corrupted index file" it sets them to be recreated when
they're tried to be opened next time. I guess there could be some bugs
left when the recreate flag doesn't actually get written into the file.
I fixed at least one of these in -test series..


From tss@iki.fi  Sat May  3 20:46:53 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 03 May 2003 20:46:53 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 655F92387F
	for <dovecot@procontrol.fi>; Sat,  3 May 2003 20:46:53 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 37C885E107F8; Sat,  3 May 2003 20:46:53 +0300 (EEST)
Subject: [dovecot] Re: 0.99.9 released
From: Timo Sirainen <tss@iki.fi>
To: "Jaldhar H. Vyas" <jaldhar@debian.org>
Cc: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.53.0304301040200.23210@samadhi.braincells.com>
References: <1051548190.26178.156.camel@hurina>
	 <Pine.LNX.4.53.0304301040200.23210@samadhi.braincells.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1051984012.26178.1046.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 03 May 2003 20:46:53 +0300
X-archive-position: 699
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 702                                                  
Status: O

On Wed, 2003-04-30 at 17:41, Jaldhar H. Vyas wrote:
> Any ETA on getting dotlocking fixed?

It's not very high priority to me now. mbox has several other problems
that should be fixed.


From tss@iki.fi  Sat May  3 20:56:26 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 03 May 2003 20:56:26 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id E3F972387F
	for <dovecot@procontrol.fi>; Sat,  3 May 2003 20:56:25 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 9D38B5E107F8; Sat,  3 May 2003 20:56:25 +0300 (EEST)
Subject: [dovecot] Re: Problems fetching messages.
From: Timo Sirainen <tss@iki.fi>
To: Ian Kumlien <pomac@vapor.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <1051827950.12768.29.camel@big.pomac.com>
References: <1051827950.12768.29.camel@big.pomac.com>
Content-Type: text/plain; charset=ISO-8859-15
Content-Transfer-Encoding: quoted-printable
Organization: 
Message-Id: <1051984584.26181.1055.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 03 May 2003 20:56:25 +0300
X-archive-position: 700
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 703                                                  
Status: O

On Fri, 2003-05-02 at 01:25, Ian Kumlien wrote:
> It seems like dovecot sends something that throws Evolution off the
> track since the actual information is sent, but in a broken form it
> seems.

I'm using Evolution with two Dovecot 0.99.9 servers. Solaris+mbox and
Linux+maildir. Don't see any problems.

> I also get some odd chars (this is raw tcp packet decoding):
> "=EF=EAa-=E8
> "=EF=EAc-=E8

Are these actually in the TCP stream or are these just TCP headers that
you decoded as well? If they're in the stream, something's really wrong.
What OS?

> "=EF=EAg-=EE* 498 FETCH (UID 646 BODY[] {3434}
> eturn-Path: <-----email------->
> etc...=20

It's missing 'R' there? With mbox it could be possible with broken
indexes, but maildir?..


From tss@iki.fi  Sat May  3 21:52:57 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 03 May 2003 21:52:57 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id B42F12385F
	for <dovecot@procontrol.fi>; Sat,  3 May 2003 21:52:56 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 2CEE95E107F8; Sat,  3 May 2003 21:52:53 +0300 (EEST)
Subject: [dovecot] 0.99.9.1
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1051987972.26181.1091.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 03 May 2003 21:52:53 +0300
X-archive-position: 701
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 704                                                  
Status: O

Some bugfixes:

v0.99.9.1 2003-05-03  Timo Sirainen <tss@iki.fi>

	- Messages having lines longer than 8192 bytes caused problems.
	- There was some problems when opening a mbox first time that had been
	  empty for a while.
	- Didn't compile with OpenBSD.
	- POP3 server crashed sometimes instead of printing error message.
	- If cached IMAP envelope contained literals, SEARCHing in it wrote
	  errors to log file. For example if subject contained highascii, '"'
	  or '\' characters this happened.


From alvarolists@aycuens.com  Sat May  3 22:08:28 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 03 May 2003 22:08:28 +0300 (EEST)
Return-Path: <alvarolists@aycuens.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from blackice.aycuens.com (193-107-ADSL.red.retevision.es [80.224.107.193])
	by danu.procontrol.fi (Postfix) with ESMTP id 499F22385F
	for <dovecot@procontrol.fi>; Sat,  3 May 2003 22:08:27 +0300 (EEST)
Received: (from firewall@localhost)
	by blackice.aycuens.com (8.9.3/AYCUENSøSMAP) id VAA15273
	( Zombificad0}:| ) for <dovecot@procontrol.fi>; Sat, 3 May 2003 21:08:56 +0200
X-Complaints-To: abuse@aycuens.com
X-Url: http://www.aycuens.com
Received: from devastator.aycuens.com(192.168.2.10) by blackice.aycuens.com via smap (V2.1)
	id sma015271; Sat, 3 May 03 21:08:15 +0200
Message-ID: <3EB41388.4020706@aycuens.com>
Date: Sat, 03 May 2003 21:07:52 +0200
From: "Alvaro Munoz-Aycuens Mtnz." <alvarolists@aycuens.com>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.4b) Gecko/20030503
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: dovecot@procontrol.fi
Subject: [dovecot] Re: 0.99.9.1
References: <1051987972.26181.1091.camel@hurina>
In-Reply-To: <1051987972.26181.1091.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 702
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: alvarolists@aycuens.com
Precedence: bulk
X-list: dovecot
X-UID: 705                                                  
Status: O


Nice let's give it a try


Timo Sirainen wrote:
> Some bugfixes:
> 
> v0.99.9.1 2003-05-03  Timo Sirainen <tss@iki.fi>
> 
> 	- Messages having lines longer than 8192 bytes caused problems.
> 	- There was some problems when opening a mbox first time that had been
> 	  empty for a while.
> 	- Didn't compile with OpenBSD.
> 	- POP3 server crashed sometimes instead of printing error message.
> 	- If cached IMAP envelope contained literals, SEARCHing in it wrote
> 	  errors to log file. For example if subject contained highascii, '"'
> 	  or '\' characters this happened.
> 
> 
> 


From alvarolists@aycuens.com  Sat May  3 23:38:44 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 03 May 2003 23:38:44 +0300 (EEST)
Return-Path: <alvarolists@aycuens.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from blackice.aycuens.com (193-107-ADSL.red.retevision.es [80.224.107.193])
	by danu.procontrol.fi (Postfix) with ESMTP id 171242385F
	for <dovecot@procontrol.fi>; Sat,  3 May 2003 23:38:43 +0300 (EEST)
Received: (from firewall@localhost)
	by blackice.aycuens.com (8.9.3/AYCUENSøSMAP) id VAA15472
	( Zombificad0}:| ) for <dovecot@procontrol.fi>; Sat, 3 May 2003 21:47:56 +0200
X-Complaints-To: abuse@aycuens.com
X-Url: http://www.aycuens.com
Received: from devastator.aycuens.com(192.168.2.10) by blackice.aycuens.com via smap (V2.1)
	id sma015469; Sat, 3 May 03 21:47:50 +0200
Message-ID: <3EB41CCE.8040700@aycuens.com>
Date: Sat, 03 May 2003 21:47:26 +0200
From: "Alvaro Munoz-Aycuens Mtnz." <alvarolists@aycuens.com>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.4b) Gecko/20030503
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: dovecot@procontrol.fi
Subject: [dovecot] 0.99.9.1 OpenBSD and mbox
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 703
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: alvarolists@aycuens.com
Precedence: bulk
X-list: dovecot
X-UID: 706                                                  
Status: O

Hi, compiled perfectly, so the patch of course work ;), but seems that I 
had the conf a bit broken, because he doesn't read the new messages in 
/var/mail/user, does the line:

#default_mail_env = mbox:~/Mail:INBOX=/var/mail/username

look good?, I also tryed with %h instead of username, the rest of the 
conf is pretty standard, I can create folders and so on.

Regards

Alvaro


From tss@iki.fi  Sat May  3 23:51:44 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 03 May 2003 23:51:44 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 2DD4C2385F
	for <dovecot@procontrol.fi>; Sat,  3 May 2003 23:51:44 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id EC2BA5E107F8; Sat,  3 May 2003 23:51:43 +0300 (EEST)
Subject: [dovecot] Re: 0.99.9.1 OpenBSD and mbox
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <3EB41CCE.8040700@aycuens.com>
References: <3EB41CCE.8040700@aycuens.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1051995103.26181.1093.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 03 May 2003 23:51:43 +0300
X-archive-position: 704
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 707                                                  
Status: O

On Sat, 2003-05-03 at 22:47, Alvaro Munoz-Aycuens Mtnz. wrote:
> Hi, compiled perfectly, so the patch of course work ;), but seems that I 
> had the conf a bit broken, because he doesn't read the new messages in 
> /var/mail/user, does the line:
> 
> #default_mail_env = mbox:~/Mail:INBOX=/var/mail/username
> 
> look good?, I also tryed with %h instead of username, the rest of the 
> conf is pretty standard, I can create folders and so on.

%h is host name. You probably wanted /var/mail/%u


From dom@cus.org.uk  Sat May  3 23:58:39 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sat, 03 May 2003 23:58:39 +0300 (EEST)
Return-Path: <dom@cus.org.uk>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from cus.org.uk (host213-106-240-81.no-dns-yet.ntli.net [213.106.240.81])
	by danu.procontrol.fi (Postfix) with ESMTP id C66A62385F
	for <dovecot@procontrol.fi>; Sat,  3 May 2003 23:58:38 +0300 (EEST)
Received: from cus.org.uk (localhost.cus.org.uk [127.0.0.1])
	by cus.org.uk (8.12.6/8.12.6) with ESMTP id h43KwY5h026538;
	Sat, 3 May 2003 21:58:34 +0100 (BST)
	(envelope-from dom@cus.org.uk)
Received: (from dom@localhost)
	by cus.org.uk (8.12.6/8.12.6/Submit) id h43KwYQu026537;
	Sat, 3 May 2003 21:58:34 +0100 (BST)
Date: Sat, 3 May 2003 21:58:34 +0100
From: Dominic Marks <dom@cus.org.uk>
To: Timo Sirainen <tss@iki.fi>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: 0.99.9.1 OpenBSD and mbox
Message-ID: <20030503205834.GA26378@cus.org.uk>
References: <3EB41CCE.8040700@aycuens.com> <1051995103.26181.1093.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1051995103.26181.1093.camel@hurina>
User-Agent: Mutt/1.4i
X-archive-position: 705
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: dom@cus.org.uk
Precedence: bulk
X-list: dovecot
X-UID: 708                                                  
Status: O

On 03/05/2003 23:51, Timo Sirainen wrote:
> On Sat, 2003-05-03 at 22:47, Alvaro Munoz-Aycuens Mtnz. wrote:
> > Hi, compiled perfectly, so the patch of course work ;), but seems that I 
> > had the conf a bit broken, because he doesn't read the new messages in 
> > /var/mail/user, does the line:
> > 
> > #default_mail_env = mbox:~/Mail:INBOX=/var/mail/username
> > 
> > look good?, I also tryed with %h instead of username, the rest of the 
> > conf is pretty standard, I can create folders and so on.
> 
> %h is host name. You probably wanted /var/mail/%u
> 

I think dovecot-example.conf needs to be updated to reflect reality
because at the moment the comments above the default_mail_env line state
that %h means home directory.

Thanks,
-- 
Dominic
 <dom at cus.org.uk> <d.marks at student.umist.ac.uk>

From tss@iki.fi  Sun May  4 00:02:01 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 04 May 2003 00:02:01 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 600F92385F
	for <dovecot@procontrol.fi>; Sun,  4 May 2003 00:02:01 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 28ECD5E107F8; Sun,  4 May 2003 00:02:01 +0300 (EEST)
Subject: [dovecot] Re: 0.99.9.1 OpenBSD and mbox
From: Timo Sirainen <tss@iki.fi>
To: Dominic Marks <dom@cus.org.uk>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030503205834.GA26378@cus.org.uk>
References: <3EB41CCE.8040700@aycuens.com>
	 <1051995103.26181.1093.camel@hurina>  <20030503205834.GA26378@cus.org.uk>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1051995720.26181.1095.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 04 May 2003 00:02:01 +0300
X-archive-position: 706
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 709                                                  
Status: O

On Sat, 2003-05-03 at 23:58, Dominic Marks wrote:
> > %h is host name. You probably wanted /var/mail/%u
> I think dovecot-example.conf needs to be updated to reflect reality
> because at the moment the comments above the default_mail_env line state
> that %h means home directory.

No, I just said wrong :) .conf is right.


From alvarolists@aycuens.com  Sun May  4 22:57:42 2003
Received: with ECARTIS (v1.0.0; list dovecot); Sun, 04 May 2003 22:57:42 +0300 (EEST)
Return-Path: <alvarolists@aycuens.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from blackice.aycuens.com (193-107-ADSL.red.retevision.es [80.224.107.193])
	by danu.procontrol.fi (Postfix) with ESMTP id 64FDF23860
	for <dovecot@procontrol.fi>; Sun,  4 May 2003 22:57:41 +0300 (EEST)
Received: (from firewall@localhost)
	by blackice.aycuens.com (8.9.3/AYCUENSøSMAP) id VAA22193
	( Zombificad0}:| ) for <dovecot@procontrol.fi>; Sun, 4 May 2003 21:58:12 +0200
X-Complaints-To: abuse@aycuens.com
X-Url: http://www.aycuens.com
Received: from devastator.aycuens.com(192.168.2.10) by blackice.aycuens.com via smap (V2.1)
	id sma022191; Sun, 4 May 03 21:57:36 +0200
Message-ID: <3EB5709A.8@aycuens.com>
Date: Sun, 04 May 2003 21:57:14 +0200
From: "Alvaro Munoz-Aycuens Mtnz." <alvarolists@aycuens.com>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.4b) Gecko/20030503
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: dovecot@procontrol.fi
Subject: [dovecot] Re: 0.99.9.1 OpenBSD and mbox
References: <3EB41CCE.8040700@aycuens.com>	 <1051995103.26181.1093.camel@hurina>  <20030503205834.GA26378@cus.org.uk>	 <1051995720.26181.1095.camel@hurina>  <3EB43397.3080902@aycuens.com> <1052071212.26180.1111.camel@hurina>
In-Reply-To: <1052071212.26180.1111.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-archive-position: 707
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: alvarolists@aycuens.com
Precedence: bulk
X-list: dovecot
X-UID: 710                                                  
Status: O

Hi all,

Now it works, these are the parameters I touched, the rest remains
pretty the same as the example conf:

#default_mail_env =mbox:~/mail/:INBOX=/var/mail/%u
#mailbox_check_interval = 1
#mbox_locks = fcntl

Anyway seems that HUP doesn't fully gets dovecot to reread conf file and
restart, better to use SIGUSR1?, by the way how I disable dotlocking in
case I want to try.

Regards

Alvaro

Timo Sirainen wrote:
> 
> Right. You'd have to either disable dotlocking or make /var/mail
> world-writable and sticky. Currently there's no other ways around this.
> 
> 



From jaldhar@debian.org  Mon May  5 05:07:40 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 05 May 2003 05:07:40 +0300 (EEST)
Return-Path: <jaldhar@debian.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail.braincells.com (samadhi.braincells.com [216.162.42.100])
	by danu.procontrol.fi (Postfix) with ESMTP id CDA7223860
	for <dovecot@procontrol.fi>; Mon,  5 May 2003 05:07:39 +0300 (EEST)
Received: from localhost (localhost [127.0.0.1])
	by mail.braincells.com (Postfix) with ESMTP
	id 1384B7F4D; Sun,  4 May 2003 22:07:41 -0400 (EDT)
Date: Sun, 4 May 2003 22:07:41 -0400 (EDT)
From: "Jaldhar H. Vyas" <jaldhar@debian.org>
X-X-Sender: jaldhar@samadhi.braincells.com
Reply-To: "Jaldhar H. Vyas" <jaldhar@debian.org>
To: Timo Sirainen <tss@iki.fi>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: 0.99.9 released
In-Reply-To: <1051984012.26178.1046.camel@hurina>
Message-ID: <Pine.LNX.4.53.0305042202150.9706@samadhi.braincells.com>
References: <1051548190.26178.156.camel@hurina> 
 <Pine.LNX.4.53.0304301040200.23210@samadhi.braincells.com>
 <1051984012.26178.1046.camel@hurina>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-archive-position: 708
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jaldhar@debian.org
Precedence: bulk
X-list: dovecot
X-UID: 711                                                  
Status: O

On Sat, 3 May 2003, Timo Sirainen wrote:

> On Wed, 2003-04-30 at 17:41, Jaldhar H. Vyas wrote:
> > Any ETA on getting dotlocking fixed?
>
> It's not very high priority to me now. mbox has several other problems
> that should be fixed.
>

No problem.  There's an open bug about it so I may check up with you about
it from time to time.

btw, 0.99.1 was just uploaded.

-- 
Jaldhar H. Vyas <jaldhar@debian.org>
La Salle Debain - http://www.braincells.com/debian/

From warren@togami.com  Mon May  5 15:47:37 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 05 May 2003 15:47:37 +0300 (EEST)
Return-Path: <warren@togami.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from pan.mplug.org (unknown [66.139.75.105])
	by danu.procontrol.fi (Postfix) with ESMTP id 5A6B02385F
	for <dovecot@procontrol.fi>; Mon,  5 May 2003 15:47:37 +0300 (EEST)
Received: from localhost.127.in-addr.arpa (unknown [127.0.0.1])
	by pan.mplug.org (Postfix) with ESMTP id 3AD9F5D805B
	for <dovecot@procontrol.fi>; Mon,  5 May 2003 02:47:30 -1000 (HST)
Subject: [dovecot] 0.99.9.1 - Runaway imap-login process
From: Warren Togami <warren@togami.com>
To: dovecot@procontrol.fi
Content-Type: text/plain
Organization: 
Message-Id: <1052138847.17312.1.camel@laptop>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 (1.2.2-5) 
Date: 05 May 2003 02:47:27 -1000
Content-Transfer-Encoding: 7bit
X-archive-position: 709
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: warren@togami.com
Precedence: bulk
X-list: dovecot
X-UID: 712                                                  
Status: O

PID USER     PRI  NI  SIZE  RSS SHARE STAT %CPU %MEM   TIME CPU COMMAND
32116 dovecot   19   0  1464 1464  1212 R    99.9  0.1  60:58   0
imap-login

service dovecot stop
ps -ef |grep imap-login |grep -v grep
dovecot  32116     1 98 01:27 ?        01:01:33 imap-login


/etc/dovecot.conf:
auth_userdb = passwd
uth_passdb = pam

I think this was triggered while I attempted to login to IMAP with the
this dovecot configuration without adding an "imap" entry to /etc/pam.d/
(auth fails).  When I attempt to strace -p this runaway process, it
strangely displays nothing.  kill was able to get rid of it.  After I
added an appropriate /etc/pam.d/imap entry, auth works and I didn't see
this runaway process.

This is a RH9 chroot server instance running within Linux virtual server
with security contexts kernel.  (Think of it as a theoretically
unbreakable chroot.)

Any tips on what I can do to get some debugging information out of this?

Thanks,
Warren Togami
warren@togami.com



From mem@mv.mv.com  Mon May  5 16:37:20 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 05 May 2003 16:37:20 +0300 (EEST)
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id E7D3323860
	for <dovecot@procontrol.fi>; Mon,  5 May 2003 16:37:19 +0300 (EEST)
Received: (qmail 14159 invoked by uid 101); 5 May 2003 09:37:17 -0400
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Mon, 5 May 2003 09:37:17 -0400
To: Timo Sirainen <tss@iki.fi>
Cc: dovecot@procontrol.fi
Subject: [dovecot] Re: 0.99.9.1
Message-ID: <20030505133717.GB3343@iridium.mv.net>
References: <1051987972.26181.1091.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1051987972.26181.1091.camel@hurina>
User-Agent: Mutt/1.4.1i
X-archive-position: 710
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mem@mv.mv.com
Precedence: bulk
X-list: dovecot
X-UID: 713                                                  
Status: O

On Sat, May 03, 2003 at 09:52:53PM +0300, Timo Sirainen wrote:
> Some bugfixes:
> 
> v0.99.9.1 2003-05-03  Timo Sirainen <tss@iki.fi>
> 
> 	- Messages having lines longer than 8192 bytes caused problems.

Seems to have fixed the problem I saw.  Thanks!

mm

From lfarkas@bnap.hu  Mon May  5 18:17:10 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 05 May 2003 18:17:10 +0300 (EEST)
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id ECF512385F
	for <dovecot@procontrol.fi>; Mon,  5 May 2003 18:17:09 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id 87FE575400D
	for <dovecot@procontrol.fi>; Mon,  5 May 2003 17:17:55 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id 767F53EB5
	for <dovecot@procontrol.fi>; Mon,  5 May 2003 17:17:07 +0200 (CEST)
Received: from bnap.hu (garfield.int.bppiac.hu [192.168.0.50])
	by mail2.bppiac.hu (Postfix) with ESMTP id 5415A3EB3
	for <dovecot@procontrol.fi>; Mon,  5 May 2003 17:17:07 +0200 (CEST)
Message-ID: <3EB68071.3020409@bnap.hu>
Date: Mon, 05 May 2003 17:17:05 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: [dovecot] dovecot.spec
Content-Type: multipart/mixed;
 boundary="------------050302070001010605000105"
X-archive-position: 711
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 714                                                  
Status: O
Content-Length: 4640

This is a multi-part message in MIME format.
--------------050302070001010605000105
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit

hi,
I'm just recoginze that dovecot contains an rpm spec file. unfortunately 
it's not too useful since an
rpm -ta dovecot-.x.y.tar.gz
can't be used since just the dovecot.spec.in is in the tarbar and not 
the actual spec file (which is in this from not useful in the above 
form). anyway here is my patch to the spec.in.

-- 
   Levente                               "Si vis pacem para bellum!"

--------------050302070001010605000105
Content-Type: text/plain;
 name="spec.patch"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename="spec.patch"

--- dovecot/dovecot.spec.in.lfarkas	2003-05-05 16:36:16.000000000 +0200
+++ dovecot/dovecot.spec.in	2003-05-05 17:04:30.000000000 +0200
@@ -1,9 +1,11 @@
 # DarContact: Timo Sirainen <tss@iki.fi>
+%define uid 96
+%define gid 96
 
 Summary: Dovecot secure IMAP server.
 Name: dovecot
 Version: @VERSION@
-Release: 0
+Release: 1
 License: GPL
 Group: System Environment/Daemons
 URL: http://dovecot.procontrol.fi/
@@ -16,14 +18,12 @@
 Prefix: %{_prefix}
 
 Prereq: /usr/sbin/useradd, /usr/sbin/usermod
-BuildRequires: openssl-devel %{!?rh62:, pam-devel} %{?rh62: pam}
+BuildRequires: openssl-devel %{!?rh62:, pam-devel} %{?rh62: pam} gettext
 
 %description
 Dovecot is an IMAP server for Linux/UNIX-like systems, written with
 security primarily in mind. Although it's written with C, it uses
-several coding techniques to avoid most of the common pitfalls. Next
-release will also contain a small POP3 server.
-
+several coding techniques to avoid most of the common pitfalls.
 Dovecot can work with standard mbox and maildir formats and it's fully
 compatible with UW-IMAP and Courier IMAP servers as well as mail
 clients accessing the mailboxes directly.
@@ -36,7 +36,7 @@
 #
 # Init file for Dovecot IMAP daemon
 #
-# chkconfig: - 54 46
+# chkconfig: 345 54 46
 # description: Dovecot IMAP Daemon
 #
 # processname: dovecot
@@ -101,8 +101,17 @@
 exit \$RETVAL
 EOF
 
+%{__cat} <<EOF >dovecot.pam
+#%PAM-1.0
+auth       required     pam_nologin.so
+auth       required     pam_stack.so service=system-auth
+account    required     pam_stack.so service=system-auth
+session    required     pam_stack.so service=system-auth
+EOF
+
 %build
-export CPPFLAGS="-I/usr/kerberos/include"
+export CPPFLAGS="`pkg-config --cflags-only-I openssl`"
+export LDFLAGS="`pkg-config --libs-only-L openssl`"
 %configure \
 	--with-ssl="openssl" \
 	--with-ssldir="%{_sysconfdir}/ssl"
@@ -112,27 +121,32 @@
 %{__rm} -rf %{buildroot}
 %makeinstall
 %{__install} -d -m0755 %{buildroot}%{_initrddir}
-%{__install} -m0755 dovecot.sysv %{buildroot}%{_initrddir}/dovecot
+%{__install} -m0755 dovecot.sysv %{buildroot}%{_initrddir}/%{name}
+%{__install} -m644 dovecot.pam %{buildroot}%{_sysconfdir}/pam.d/imap
+%{__install} -m644 dovecot.pam %{buildroot}%{_sysconfdir}/pam.d/imaps
+%{__install} -m644 dovecot.pam %{buildroot}%{_sysconfdir}/pam.d/pop3
+%{__install} -m644 dovecot.pam %{buildroot}%{_sysconfdir}/pam.d/pop3s
 %{__mv} -f %{buildroot}%{_sysconfdir}/dovecot-example.conf %{buildroot}%{_sysconfdir}/dovecot.conf
 
 ### Clean up buildroot
-%{__rm} -rf %{buildroot}%{_datadir}/doc/dovecot/
+%{__rm} -rf %{buildroot}%{_datadir}/doc/%{name}/
 
 %pre
-/usr/sbin/useradd -M -s /sbin/nologin -r dovecot &>/dev/null || :
-/usr/sbin/usermod -s /sbin/nologin dovecot &>/dev/null || :
+# Add the dovecot user and group if not found
+/usr/sbin/groupadd -g %{gid} -r %{name} &>/dev/null || :
+/usr/sbin/useradd -d /var/run/%{name} -s /bin/false -g %{name} -M -r -u %{uid} %{name} &>/dev/null || :
 
 %post
 /sbin/chkconfig --add dovecot
 
 %preun
 if [ $1 -eq 0 ]; then
-	/sbin/service dovecot stop &>/dev/null || :
+	/sbin/service %{name} stop &>/dev/null || :
 	/sbin/chkconfig --del dovecot
 fi
 
 %postun
-/sbin/service dovecot condrestart &>/dev/null || :
+/sbin/service %{name} condrestart &>/dev/null || :
 
 %clean
 %{__rm} -rf %{buildroot}
@@ -142,11 +156,16 @@
 %doc AUTHORS ChangeLog COPYING* NEWS README TODO
 %doc doc/*.conf doc/*.sh doc/*.txt
 %config %{_sysconfdir}/dovecot.conf
-%config %{_initrddir}/dovecot
+%config %{_initrddir}/%{name}
+%config %{_sysconfdir}/pam.d/*
 %{_sbindir}/*
-%{_libexecdir}/dovecot/
+%dir %{_libexecdir}/%{name}
+%{_libexecdir}/%{name}/
 
 %changelog
+* Mon May 5 2003 Levente Farkas <lfarkas@lfarkas.org>
+- update a few things in the spec file
+
 * Tue Apr 29 2003 Dag Wieers <dag@wieers.com> - 0.99.9-0
 - Updated to release 0.99.9.
 

--------------050302070001010605000105--



From tss@iki.fi  Mon May  5 19:50:30 2003
Received: with ECARTIS (v1.0.0; list dovecot); Mon, 05 May 2003 19:50:30 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id F0DE02385F
	for <dovecot@procontrol.fi>; Mon,  5 May 2003 19:50:29 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 5020C5E107FA; Mon,  5 May 2003 19:50:29 +0300 (EEST)
Subject: [dovecot] Re: dovecot.spec
From: Timo Sirainen <tss@iki.fi>
To: Dovecot List <dovecot@procontrol.fi>
In-Reply-To: <3EB68071.3020409@bnap.hu>
References: <3EB68071.3020409@bnap.hu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1052153427.26180.1137.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 05 May 2003 19:50:29 +0300
X-archive-position: 712
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 715                                                  
Status: O

On Mon, 2003-05-05 at 18:17, Farkas Levente wrote:
> hi,
> I'm just recoginze that dovecot contains an rpm spec file. unfortunately 
> it's not too useful since an
> rpm -ta dovecot-.x.y.tar.gz
> can't be used since just the dovecot.spec.in is in the tarbar and not 
> the actual spec file (which is in this from not useful in the above 
> form). anyway here is my patch to the spec.in.

Oh, right. I should have included .spec in tarball too (but not in cvs).

-BuildRequires: openssl-devel %{!?rh62:, pam-devel} %{?rh62: pam}
+BuildRequires: openssl-devel %{!?rh62:, pam-devel} %{?rh62: pam} gettext

Why is gettext needed? Dovecot itself doesn't use it.


From seba@iq.pl  Tue May  6 16:50:08 2003
Received: with ECARTIS (v1.0.0; list dovecot); Tue, 06 May 2003 16:50:08 +0300 (EEST)
Return-Path: <seba@iq.pl>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from serv.iq.pl (serv.iq.pl [213.76.165.9])
	by danu.procontrol.fi (Postfix) with ESMTP id 5CEE623860
	for <dovecot@procontrol.fi>; Tue,  6 May 2003 16:50:08 +0300 (EEST)
Received: by serv.iq.pl (Postfix, from userid 1390)
	id 8046A6BD01; Tue,  6 May 2003 15:50:33 +0200 (CEST)
Date: Tue, 6 May 2003 15:50:33 +0200
From: Sebastian Pachuta <seba@iq.pl>
To: dovecot@procontrol.fi
Subject: [dovecot] quota
Message-ID: <20030506135033.GD11876@iq.pl>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
X-archive-position: 713
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: seba@iq.pl
Precedence: bulk
X-list: dovecot
X-UID: 716                                                  
Status: O


first, thx for --with-storages=maildir

second, there is a problem when user exceed their quota

< status INBOX (messages)
> NO Internal error [2003-05-06 15:35:56]

in logfile:
imap(user): Can't create directory /var/mail/user/.INBOX: Disk quota exceeded

'user' is not able to get list of messages and delete some of them :(

third,

in logfile:

imap(user2): maildir flags update:
rename(/var/mail/user2/cur/1049405360.18375_0.asd,
       /var/mail/user2/cur/1049405360.18375_0.asd:2,T)
failed: Disk quota exceeded

is there any way to rename files when quota exceed?

From tss@iki.fi  Wed May  7 05:56:15 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 07 May 2003 05:56:15 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 41C5D2385F
	for <dovecot@procontrol.fi>; Wed,  7 May 2003 05:56:15 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id E2F615E01701; Wed,  7 May 2003 05:56:14 +0300 (EEST)
Subject: [dovecot] Re: quota
From: Timo Sirainen <tss@iki.fi>
To: Sebastian Pachuta <seba@iq.pl>
Cc: dovecot@procontrol.fi
In-Reply-To: <20030506135033.GD11876@iq.pl>
References: <20030506135033.GD11876@iq.pl>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1052276174.26178.1178.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 07 May 2003 05:56:14 +0300
X-archive-position: 714
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 717                                                  
Status: O
Content-Length: 1059

On Tue, 2003-05-06 at 16:50, Sebastian Pachuta wrote:
> second, there is a problem when user exceed their quota

Yes, there's several problems. Biggest one is what to do if we can't
update dovecot-uidlist file.

If we continued normally but without storing the UIDs permanently, then
expunged some messages, logged out and logged in again, the UIDs are
different from last time and that breaks client's cache.

If we just overwrote next-UID field in dovecot-uidlist we'd get new UIDs
next time which is fine, except if client selects the mailbox multiple
times it gets different UIDs for the messages. That probably breaks some
clients (OE I think).

One kludgy solution is to overwrite next-UID field only when messages
are expunged and then force all clients that have selected the mailbox
to log out.

Overwriting next-UID isn't too safe either since readers don't do any
kind of locking for the file, but I'd hope writing 1-10 bytes is usually
atomic? Well, we could use fcntl() locking in out-of-diskspace
conditions but I'm not sure if it's worth it..


From tss@iki.fi  Wed May  7 05:59:00 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 07 May 2003 05:59:00 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 1E6132385F
	for <dovecot@procontrol.fi>; Wed,  7 May 2003 05:59:00 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id D361A5E01701; Wed,  7 May 2003 05:58:59 +0300 (EEST)
Subject: [dovecot] Re: 0.99.9.1 OpenBSD and mbox
From: Timo Sirainen <tss@iki.fi>
To: Alvaro "Munoz-Aycuens Mtnz." <alvarolists@aycuens.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <3EB5709A.8@aycuens.com>
References: <3EB41CCE.8040700@aycuens.com>
	 <1051995103.26181.1093.camel@hurina>  <20030503205834.GA26378@cus.org.uk>
	 <1051995720.26181.1095.camel@hurina>  <3EB43397.3080902@aycuens.com>
	 <1052071212.26180.1111.camel@hurina>  <3EB5709A.8@aycuens.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1052276339.26180.1182.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 07 May 2003 05:58:59 +0300
X-archive-position: 715
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 718                                                  
Status: O

On Sun, 2003-05-04 at 22:57, Alvaro Munoz-Aycuens Mtnz. wrote:
> Hi all,
> 
> Now it works, these are the parameters I touched, the rest remains
> pretty the same as the example conf:
> 
> #default_mail_env =mbox:~/mail/:INBOX=/var/mail/%u
> #mailbox_check_interval = 1
> #mbox_locks = fcntl

And you did remove the '#' chars, right?

> Anyway seems that HUP doesn't fully gets dovecot to reread conf file and
> restart, better to use SIGUSR1?,

SIGHUP rereads config file and uses them for new connections, but
existing connections are left like they were. Dovecot doesn't catch
SIGUSR1 so rather use the normal SIGTERM.

> by the way how I disable dotlocking in
> case I want to try.

You just did by removing dotlock from mbox_locks.


From tss@iki.fi  Wed May  7 06:03:24 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 07 May 2003 06:03:24 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id C45EB2385F
	for <dovecot@procontrol.fi>; Wed,  7 May 2003 06:03:24 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 892ED5E01701; Wed,  7 May 2003 06:03:24 +0300 (EEST)
Subject: [dovecot] Re: 0.99.9.1 - Runaway imap-login process
From: Timo Sirainen <tss@iki.fi>
To: Warren Togami <warren@togami.com>
Cc: dovecot@procontrol.fi
In-Reply-To: <1052138847.17312.1.camel@laptop>
References: <1052138847.17312.1.camel@laptop>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1052276604.26180.1185.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 07 May 2003 06:03:24 +0300
X-archive-position: 716
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 719                                                  
Status: O

On Mon, 2003-05-05 at 15:47, Warren Togami wrote:
> PID USER     PRI  NI  SIZE  RSS SHARE STAT %CPU %MEM   TIME CPU COMMAND
> 32116 dovecot   19   0  1464 1464  1212 R    99.9  0.1  60:58   0
> imap-login
> 
> Any tips on what I can do to get some debugging information out of this?

If strace didn't show anything, I guess it got stuck to infinite loop
somewhere.

gdb /usr/local/libexec/dovecot/imap-login 32116
bt

would show where it's stuck at.


From jo@our-own.net  Wed May  7 11:30:30 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 07 May 2003 11:30:30 +0300 (EEST)
Return-Path: <jo@our-own.net>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from thebox.our-own.net (thebox.our-own.net [64.81.83.87])
	by danu.procontrol.fi (Postfix) with ESMTP id 03F9C2385F
	for <dovecot@procontrol.fi>; Wed,  7 May 2003 11:30:30 +0300 (EEST)
Received: from [10.0.0.19] ([10.0.0.19])
	(authenticated bits=0)
	by thebox.our-own.net (8.12.8/8.12.8) with ESMTP id h478UPA7016746
	for <dovecot@procontrol.fi>; Wed, 7 May 2003 01:30:26 -0700
Subject: [dovecot] KMail?
From: Joakim Ryden <jo@our-own.net>
To: dovecot@procontrol.fi
Content-Type: text/plain
Message-Id: <1052296224.8864.5.camel@redtop>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.3.3 (Preview Release)
Date: 07 May 2003 01:30:25 -0700
Content-Transfer-Encoding: 7bit
X-Spam-Status: No, hits=0.0 required=5.0
	tests=none
	version=2.53
X-Spam-Checker-Version: SpamAssassin 2.53 (1.174.2.15-2003-03-30-exp)
X-Virus-Scanned: clamdscan / ClamAV version 20030424
X-archive-position: 717
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: jo@our-own.net
Precedence: bulk
X-list: dovecot
X-UID: 720                                                  
Status: O

Hey everyone -

is anyone else having problems with Dovecot and KMail? I'm having
trouble seeing my INBOX using KMail (Maildir format on the server),
though all subfolders show up as normal. I suspect the problem is with
KMail as all the other mail clients I've tested seem to have no such
problems, they see INBOX *and* subfolders just fine, just wanted to see
if anyone could confirm this behaviour?

--Jo


From warren@togami.com  Wed May  7 13:11:33 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 07 May 2003 13:11:33 +0300 (EEST)
Return-Path: <warren@togami.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from hnlmail1.hawaii.rr.com (unknown [24.25.227.32])
	by danu.procontrol.fi (Postfix) with ESMTP id 2541623860
	for <dovecot@procontrol.fi>; Wed,  7 May 2003 13:11:33 +0300 (EEST)
Received: (apparently) from [192.168.0.4] ([204.210.124.92]) by hnlmail1.hawaii.rr.com  with Microsoft SMTPSVC(5.5.1877.757.75);
	 Wed, 7 May 2003 00:11:27 -1000
Subject: [dovecot] dovecot and squirrelmail
From: Warren Togami <warren@togami.com>
To: dovecot@procontrol.fi
Content-Type: text/plain
Organization: 
Message-Id: <1052302286.18560.309.camel@laptop>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.2 (1.2.2-5) 
Date: 07 May 2003 00:11:26 -1000
Content-Transfer-Encoding: 7bit
X-archive-position: 718
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: warren@togami.com
Precedence: bulk
X-list: dovecot
X-UID: 721                                                  
Status: O

Is anyone using squirrelmail with dovecot?  After a few minor tweaks
squirrelmail seems to work great, but I can't seem to get rid of the
"./" folder.

SquirrelMail implements some workaround hacks for specific IMAP server
quirks.  The default setting is:
$imap_server_type       = 'uw';

What settings do you folks use?

Thanks,
Warren Togami
warren@togami.com


From tss@iki.fi  Wed May  7 13:17:24 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 07 May 2003 13:17:24 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 21CF423860
	for <dovecot@procontrol.fi>; Wed,  7 May 2003 13:17:24 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id A7AD25E01701; Wed,  7 May 2003 13:17:23 +0300 (EEST)
Subject: [dovecot] Re: dovecot and squirrelmail
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <1052302286.18560.309.camel@laptop>
References: <1052302286.18560.309.camel@laptop>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1052302643.12258.10.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 07 May 2003 13:17:23 +0300
X-archive-position: 719
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 722                                                  
Status: O

On Wed, 2003-05-07 at 13:11, Warren Togami wrote:
> Is anyone using squirrelmail with dovecot?  After a few minor tweaks
> squirrelmail seems to work great, but I can't seem to get rid of the
> "./" folder.

I don't see it. You use mbox?

> SquirrelMail implements some workaround hacks for specific IMAP server
> quirks.  The default setting is:
> $imap_server_type       = 'uw';
> 
> What settings do you folks use?

I use 'other' which seems to work fine. Squirrelmail 1.4.0rc1 with
maildir.


From tss@iki.fi  Wed May  7 14:43:46 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 07 May 2003 14:43:46 +0300 (EEST)
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi [213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id F2A4323860
	for <dovecot@procontrol.fi>; Wed,  7 May 2003 14:43:45 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id C09245E01701; Wed,  7 May 2003 14:43:45 +0300 (EEST)
Subject: [dovecot] Re: KMail?
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <1052296224.8864.5.camel@redtop>
References: <1052296224.8864.5.camel@redtop>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1052307825.12254.85.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 07 May 2003 14:43:45 +0300
X-archive-position: 720
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: tss@iki.fi
Precedence: bulk
X-list: dovecot
X-UID: 723                                                  
Status: O

On Wed, 2003-05-07 at 11:30, Joakim Ryden wrote:
> is anyone else having problems with Dovecot and KMail? I'm having
> trouble seeing my INBOX using KMail (Maildir format on the server),
> though all subfolders show up as normal. I suspect the problem is with
> KMail as all the other mail clients I've tested seem to have no such
> problems, they see INBOX *and* subfolders just fine, just wanted to see
> if anyone could confirm this behaviour?

kmail 3.1.1 in Debian unstable seems to be working. Maybe you should
look at what kmail is talking to Dovecot.

http://dovecot.procontrol.fi/bugreport.html#sniffing


From lfarkas@bnap.hu  Wed May  7 18:06:01 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 07 May 2003 18:06:01 +0300 (EEST)
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 662A223860
	for <dovecot@procontrol.fi>; Wed,  7 May 2003 18:06:01 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP
	id C340F75400D; Wed,  7 May 2003 17:07:03 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP
	id D23E43EB5; Wed,  7 May 2003 17:05:57 +0200 (CEST)
Received: from bnap.hu (garfield.int.bppiac.hu [192.168.0.50])
	by mail2.bppiac.hu (Postfix) with ESMTP
	id A1B513EB3; Wed,  7 May 2003 17:05:57 +0200 (CEST)
Message-ID: <3EB920D5.4090708@bnap.hu>
Date: Wed, 07 May 2003 17:05:57 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Timo Sirainen <tss@iki.fi>
Cc: Dovecot List <dovecot@procontrol.fi>
Subject: [dovecot] Re: dovecot.spec
References: <3EB68071.3020409@bnap.hu> <1052153427.26180.1137.camel@hurina>
In-Reply-To: <1052153427.26180.1137.camel@hurina>
Content-Type: multipart/mixed;
 boundary="------------030506080806070906080701"
X-archive-position: 721
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: lfarkas@bnap.hu
Precedence: bulk
X-list: dovecot
X-UID: 724                                                  
Status: O
Content-Length: 5183

This is a multi-part message in MIME format.
--------------030506080806070906080701
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit

since (AFAIS) you don't apply the previous patch, here is a better one 
which can compile:-)

Timo Sirainen wrote:
> On Mon, 2003-05-05 at 18:17, Farkas Levente wrote:
> 
>>hi,
>>I'm just recoginze that dovecot contains an rpm spec file. unfortunately 
>>it's not too useful since an
>>rpm -ta dovecot-.x.y.tar.gz
>>can't be used since just the dovecot.spec.in is in the tarbar and not 
>>the actual spec file (which is in this from not useful in the above 
>>form). anyway here is my patch to the spec.in.
> 
> 
> Oh, right. I should have included .spec in tarball too (but not in cvs).
> 
> -BuildRequires: openssl-devel %{!?rh62:, pam-devel} %{?rh62: pam}
> +BuildRequires: openssl-devel %{!?rh62:, pam-devel} %{?rh62: pam} gettext
> 
> Why is gettext needed? Dovecot itself doesn't use it.
> 
> 
> 


-- 
   Levente                               "Si vis pacem para bellum!"

--------------030506080806070906080701
Content-Type: text/plain;
 name="spec.patch"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename="spec.patch"

--- dovecot/dovecot.spec.in.lfarkas	2003-05-07 17:00:24.000000000 +0200
+++ dovecot/dovecot.spec.in	2003-05-07 17:03:08.000000000 +0200
@@ -1,9 +1,11 @@
 # DarContact: Timo Sirainen <tss@iki.fi>
+%define uid 96
+%define gid 96
 
 Summary: Dovecot secure IMAP server.
 Name: dovecot
 Version: @VERSION@
-Release: 0
+Release: 1
 License: GPL
 Group: System Environment/Daemons
 URL: http://dovecot.procontrol.fi/
@@ -16,14 +18,12 @@
 Prefix: %{_prefix}
 
 Prereq: /usr/sbin/useradd, /usr/sbin/usermod
-BuildRequires: openssl-devel %{!?rh62:, pam-devel} %{?rh62: pam}
+BuildRequires: openssl-devel %{!?rh62:, pam-devel} %{?rh62: pam} gettext
 
 %description
 Dovecot is an IMAP server for Linux/UNIX-like systems, written with
 security primarily in mind. Although it's written with C, it uses
-several coding techniques to avoid most of the common pitfalls. Next
-release will also contain a small POP3 server.
-
+several coding techniques to avoid most of the common pitfalls.
 Dovecot can work with standard mbox and maildir formats and it's fully
 compatible with UW-IMAP and Courier IMAP servers as well as mail
 clients accessing the mailboxes directly.
@@ -36,7 +36,7 @@
 #
 # Init file for Dovecot IMAP daemon
 #
-# chkconfig: - 54 46
+# chkconfig: 345 54 46
 # description: Dovecot IMAP Daemon
 #
 # processname: dovecot
@@ -101,8 +101,17 @@
 exit \$RETVAL
 EOF
 
+%{__cat} <<EOF >dovecot.pam
+#%PAM-1.0
+auth       required     pam_nologin.so
+auth       required     pam_stack.so service=system-auth
+account    required     pam_stack.so service=system-auth
+session    required     pam_stack.so service=system-auth
+EOF
+
 %build
-export CPPFLAGS="-I/usr/kerberos/include"
+export CPPFLAGS="`pkg-config --cflags-only-I openssl`"
+export LDFLAGS="`pkg-config --libs-only-L openssl`"
 %configure \
 	--with-ssl="openssl" \
 	--with-ssldir="%{_sysconfdir}/ssl"
@@ -112,27 +121,33 @@
 %{__rm} -rf %{buildroot}
 %makeinstall
 %{__install} -d -m0755 %{buildroot}%{_initrddir}
-%{__install} -m0755 dovecot.sysv %{buildroot}%{_initrddir}/dovecot
+%{__install} -m0755 dovecot.sysv %{buildroot}%{_initrddir}/%{name}
+%{__install} -d -m0755 %{buildroot}%{_sysconfdir}/pam.d
+%{__install} -m0644 dovecot.pam %{buildroot}%{_sysconfdir}/pam.d/imap
+%{__install} -m0644 dovecot.pam %{buildroot}%{_sysconfdir}/pam.d/imaps
+%{__install} -m0644 dovecot.pam %{buildroot}%{_sysconfdir}/pam.d/pop3
+%{__install} -m0644 dovecot.pam %{buildroot}%{_sysconfdir}/pam.d/pop3s
 %{__mv} -f %{buildroot}%{_sysconfdir}/dovecot-example.conf %{buildroot}%{_sysconfdir}/dovecot.conf
 
 ### Clean up buildroot
-%{__rm} -rf %{buildroot}%{_datadir}/doc/dovecot/
+%{__rm} -rf %{buildroot}%{_datadir}/doc/%{name}/
 
 %pre
-/usr/sbin/useradd -M -s /sbin/nologin -r dovecot &>/dev/null || :
-/usr/sbin/usermod -s /sbin/nologin dovecot &>/dev/null || :
+# Add the dovecot user and group if not found
+/usr/sbin/groupadd -g %{gid} -r %{name} &>/dev/null || :
+/usr/sbin/useradd -d /var/run/%{name} -s /bin/false -g %{name} -M -r -u %{uid} %{name} &>/dev/null || :
 
 %post
 /sbin/chkconfig --add dovecot
 
 %preun
 if [ $1 -eq 0 ]; then
-	/sbin/service dovecot stop &>/dev/null || :
+	/sbin/service %{name} stop &>/dev/null || :
 	/sbin/chkconfig --del dovecot
 fi
 
 %postun
-/sbin/service dovecot condrestart &>/dev/null || :
+/sbin/service %{name} condrestart &>/dev/null || :
 
 %clean
 %{__rm} -rf %{buildroot}
@@ -142,11 +157,16 @@
 %doc AUTHORS ChangeLog COPYING* NEWS README TODO
 %doc doc/*.conf doc/*.sh doc/*.txt
 %config %{_sysconfdir}/dovecot.conf
-%config %{_initrddir}/dovecot
+%config %{_initrddir}/%{name}
+%config %{_sysconfdir}/pam.d/*
 %{_sbindir}/*
-%{_libexecdir}/dovecot/
+%dir %{_libexecdir}/%{name}
+%{_libexecdir}/%{name}/
 
 %changelog
+* Mon May 5 2003 Levente Farkas <lfarkas@lfarkas.org>
+- update a few things in the spec file
+
 * Tue Apr 29 2003 Dag Wieers <dag@wieers.com> - 0.99.9-0
 - Updated to release 0.99.9.
 

--------------030506080806070906080701--



From mike@innercite.com  Wed May  7 19:04:18 2003
Received: with ECARTIS (v1.0.0; list dovecot); Wed, 07 May 2003 19:04:18 +0300 (EEST)
Return-Path: <mike@innercite.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from knight.innercite.com (knight.innercite.com [158.222.3.8])
	by danu.procontrol.fi (Postfix) with ESMTP id 9210D2387A
	for <dovecot@procontrol.fi>; Wed,  7 May 2003 19:04:17 +0300 (EEST)
Received: from [158.222.117.13] ([158.222.117.13])
	by knight.innercite.com (8.12.3/8.12.3/Debian -4) with ESMTP id h47Fu6pB018343
	for <dovecot@procontrol.fi>; Wed, 7 May 2003 08:56:06 -0700
Subject: [dovecot] Re: quota
From: Mike Machado <mike@innercite.com>
To: dovecot@procontrol.fi
In-Reply-To: <1052276174.26178.1178.camel@hurina>
References: <20030506135033.GD11876@iq.pl>
	 <1052276174.26178.1178.camel@hurina>
Content-Type: text/plain
Organization: 
Message-Id: <1052323452.661.4.camel@woodstock.innercite.com>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 07 May 2003 09:04:12 -0700
Content-Transfer-Encoding: 7bit
X-archive-position: 722
X-ecartis-version: Ecartis v1.0.0
Sender: dovecot-bounce@procontrol.fi
Errors-to: dovecot-bounce@procontrol.fi
X-original-sender: mike@innercite.com
Precedence: bulk
X-list: dovecot
X-UID: 725                                                  
Status: O
Content-Length: 4582

Believe me, over quota conditions is a major source of ISP support
headaches. Entire systems have been designed around trying to manage
this very issue.

I think doing something special under this unique condition to at least
allow some messages to be deleted is acceptable as long as it does not
corrupt mail, even if it includes forcing a client logout.

As a side thought, couldn't you delete the message from the mailbox,
THEN update the UID list, because at that point you would be able to
write to the file?


On Tue, 2003-05-06 at 19:56, Timo Sirainen wrote:
> On Tue, 2003-05-06 at 16:50, Sebastian Pachuta wrote:
> > second, there is a problem when user exceed their quota
> 
> Yes, there's several problems. Biggest one is what to do if we can't
> update dovecot-uidlist file.
> 
> If we continued normally but without storing the UIDs permanently, then
> expunged some messages, logged out and logged in again, the UIDs are
> different from last time and that breaks client's cache.
> 
> If we just overwrote next-UID field in dovecot-uidlist we'd get new UIDs
> next time which is fine, except if client selects the mailbox multiple
> times it gets different UIDs for the messages. That probably breaks some
> clients (OE I think).
> 
> One kludgy solution is to overwrite next-UID field only when messages
> are expunged and then force all clients that have selected the mailbox
> to log out.
> 
> Overwriting next-UID isn't too safe either since readers don't do any
> kind of locking for the file, but I'd hope writing 1-10 bytes is usually
> atomic? Well, we could use fcntl() locking in out-of-diskspace
> conditions but I'm not sure if it's worth it..
-- 
Mike Machado
mike@innercite.com
InnerCite Inc.
Engineering Director / CTO


Return-Path: dovecot-bounces@procontrol.fi
Received: from danu.procontrol.fi (localhost [127.0.0.1])
	by danu.procontrol.fi (Postfix) with ESMTP
	id 5980E239A8; Mon, 12 May 2003 17:56:53 +0300 (EEST)
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from nssg.mitel.com (mail.e-smith.com [216.191.234.126])
	by danu.procontrol.fi (Postfix) with SMTP id 57BCC238D1
	for <dovecot@procontrol.fi>; Mon, 12 May 2003 17:56:52 +0300 (EEST)
Received: (qmail 21878 invoked by uid 404); 12 May 2003 14:56:51 -0000
Received: from charlieb-dovecot@e-smith.com by tripe.nssg.mitel.com with
	qmail-scanner; 12 May 2003 10:56:50 -0000
Received: from allspice-core.nssg.mitel.com (HELO e-smith.com) (10.33.16.12)
  by tripe.nssg.mitel.com (10.33.17.11) with SMTP; 12 May 2003 14:56:50 -0000
Received: (qmail 11560 invoked from network); 12 May 2003 14:56:50 -0000
Received: from vegemite.nssg.mitel.com (10.33.15.70)
  by allspice.nssg.mitel.com with QMQP; 12 May 2003 14:56:50 -0000
Received: from localhost (sendmail-bs@127.0.0.1)
  by localhost with SMTP; 12 May 2003 15:01:14 -0000
Date: Mon, 12 May 2003 11:01:14 -0400 (EDT)
From: Charlie Brady <charlieb-dovecot@e-smith.com>
X-X-Sender: charlieb@vegemite.nssg.mitel.com
To: Timo Sirainen <tss@iki.fi>
Subject: Re: [dovecot] Re: Design thought - Retention of reworked mbox files
In-Reply-To: <1052701549.5227.415.camel@hurina>
Message-ID: <Pine.LNX.4.44.0305121100120.18840-100000@vegemite.nssg.mitel.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
Cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
Sender: dovecot-bounces@procontrol.fi
Errors-To: dovecot-bounces@procontrol.fi


On 12 May 2003, Timo Sirainen wrote:

> On Mon, 2003-05-12 at 02:05, Tim Hunt wrote:
> > Would it be possible to keep a backup copy of an mbox mail file any time it 
> > needs to be substantionally rebuilt - for an example before an expunge. This 
> > behaviour could be controlled by the config file, since it would most likely 
> > only be used in development and testing environments.
> 
> If it's only for debugging, I guess I could then just save a copy of it.

Presumably the other reason you'd want it would be for mailbox integrity. 
But if you are concerned about that, you'd be using maildir, wouldn't you?

--
Charlie

From timhunt@users.sourceforge.net  Tue May 13 04:38:08 2003
Return-Path: <timhunt@users.sourceforge.net>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from timhunt.net (ns1.timhunt.net [216.27.147.130])
	by danu.procontrol.fi (Postfix) with ESMTP id B4DA723998
	for <dovecot@procontrol.fi>; Tue, 13 May 2003 04:38:07 +0300 (EEST)
Received: from phobos.internal (phobos.internal [192.168.10.174])
	(authenticated)
	by timhunt.net (8.11.6/8.11.6) with ESMTP id h4D1c2B06833
	for <dovecot@procontrol.fi>; Mon, 12 May 2003 21:38:02 -0400
Subject: Re: [dovecot] Re: Design thought - Retention of reworked mbox files
From: Tim Hunt <timhunt@users.sourceforge.net>
To: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.44.0305121100120.18840-100000@vegemite.nssg.mitel.com>
References: 
	 <Pine.LNX.4.44.0305121100120.18840-100000@vegemite.nssg.mitel.com>
Content-Type: multipart/alternative; boundary="=-TiKkSTQmkwvajjD1yK3F"
Organization: 
Message-Id: <1052789879.1188.12.camel@phobos.internal>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 12 May 2003 21:38:00 -0400
X-MailScanner-Information: Please contact the ISP for more information
X-MailScanner: Found to be clean
X-Mailman-Approved-At: Tue, 13 May 2003 04:46:51 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Tue, 13 May 2003 01:38:08 -0000
X-UID: 726                                                  
Status: O
Content-Length: 2984


--=-TiKkSTQmkwvajjD1yK3F
Content-Type: text/plain
Content-Transfer-Encoding: 7bit

It's primarily for debugging, and I don't see it being used in a high
volume environment.

What triggered the thought is that I suspect I may have lost the bodies
of a couple of messages during an expunge, but because I don't have the
previous state of the mbox file, I have no way of verifying my concern,
and certainly no way to try and recreate it.

And yes, I'm using mbox files, because I have many years of mail stored
in them, and I'm not quite ready to convert them to another format.

Tim

On Mon, 2003-05-12 at 11:01, Charlie Brady wrote:

> On 12 May 2003, Timo Sirainen wrote:
> 
> > On Mon, 2003-05-12 at 02:05, Tim Hunt wrote:
> > > Would it be possible to keep a backup copy of an mbox mail file any time it 
> > > needs to be substantionally rebuilt - for an example before an expunge. This 
> > > behaviour could be controlled by the config file, since it would most likely 
> > > only be used in development and testing environments.
> > 
> > If it's only for debugging, I guess I could then just save a copy of it.
> 
> Presumably the other reason you'd want it would be for mailbox integrity. 
> But if you are concerned about that, you'd be using maildir, wouldn't you?
> 
> --
> Charlie

--=-TiKkSTQmkwvajjD1yK3F
Content-Type: text/html; charset=utf-8
Content-Transfer-Encoding: 7bit

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 TRANSITIONAL//EN">
<HTML>
<HEAD>
  <META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=UTF-8">
  <META NAME="GENERATOR" CONTENT="GtkHTML/1.1.10">
</HEAD>
<BODY>
It's primarily for debugging, and I don't see it being used in a high volume environment.<BR>
<BR>
What triggered the thought is that I suspect I may have lost the bodies of a couple of messages during an expunge, but because I don't have the previous state of the mbox file, I have no way of verifying my concern, and certainly no way to try and recreate it.<BR>
<BR>
And yes, I'm using mbox files, because I have many years of mail stored in them, and I'm not quite ready to convert them to another format.<BR>
<BR>
Tim<BR>
<BR>
On Mon, 2003-05-12 at 11:01, Charlie Brady wrote:
<BLOCKQUOTE TYPE=CITE>
<PRE><FONT COLOR="#737373" SIZE="3"><I>On 12 May 2003, Timo Sirainen wrote:

&gt; On Mon, 2003-05-12 at 02:05, Tim Hunt wrote:
&gt; &gt; Would it be possible to keep a backup copy of an mbox mail file any time it 
&gt; &gt; needs to be substantionally rebuilt - for an example before an expunge. This 
&gt; &gt; behaviour could be controlled by the config file, since it would most likely 
&gt; &gt; only be used in development and testing environments.
&gt; 
&gt; If it's only for debugging, I guess I could then just save a copy of it.

Presumably the other reason you'd want it would be for mailbox integrity. 
But if you are concerned about that, you'd be using maildir, wouldn't you?

--
Charlie</I></FONT></PRE>
</BLOCKQUOTE>
</BODY>
</HTML>

--=-TiKkSTQmkwvajjD1yK3F--

From eskimoe@ananzi.co.za  Tue May 13 15:21:54 2003
Return-Path: <eskimoe@ananzi.co.za>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from sun.com (port-212-202-201-192.reverse.qdsl-home.de
	[212.202.201.192])
	by danu.procontrol.fi (Postfix) with SMTP id 5D33F238D4
	for <dovecot@procontrol.fi>; Tue, 13 May 2003 15:21:53 +0300 (EEST)
Received: (qmail 17505 invoked by uid 1000); 13 May 2003 12:24:06 -0000
Date: Tue, 13 May 2003 14:24:06 +0200
From: Moe Wibble <eskimoe@ananzi.co.za>
To: dovecot@procontrol.fi
Subject: Re: [dovecot] Re: List-id test
Message-ID: <20030513122405.GA16248@woom.net>
Mail-Followup-To: Moe Wibble <eskimoe@ananzi.co.za>,
	dovecot@procontrol.fi
References: <1052702494.5228.418.camel@hurina>
	<1052711046.5228.449.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1052711046.5228.449.camel@hurina>
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Tue, 13 May 2003 12:21:54 -0000
X-UID: 727                                                  
Status: O

On Mon, May 12, 2003 at 06:44:06AM +0300, Timo Sirainen wrote:
> On Mon, 2003-05-12 at 04:21, Timo Sirainen wrote:
> > Just enabled List-* headers, testing if this still works..
> 
> Hmm. Wondered about why List-Id header used wrong host name and started
> looking at Ecartis' sources .. Wasn't it written in Perl? I had believed
> so for quite a long time for some reason. So since it's C, I figured I'd
> audit the code for security flaws.
> 
> .. I think I'll switch switch the list manager. Mailman looks nice.

tried ezmlm? :)

From tss@iki.fi  Tue May 13 15:38:26 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id BA437239AC
	for <dovecot@procontrol.fi>; Tue, 13 May 2003 15:38:26 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id B6BD15E01F80; Tue, 13 May 2003 15:38:25 +0300 (EEST)
Subject: Re: [dovecot] Re: List-id test
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030513122405.GA16248@woom.net>
References: <1052702494.5228.418.camel@hurina>
	 <1052711046.5228.449.camel@hurina>  <20030513122405.GA16248@woom.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1052829505.1757.11.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 13 May 2003 15:38:25 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Tue, 13 May 2003 12:38:27 -0000
X-UID: 728                                                  
Status: O
Content-Length: 1162

On Tue, 2003-05-13 at 15:24, Moe Wibble wrote:
> > .. I think I'll switch switch the list manager. Mailman looks nice.
> tried ezmlm? :)

Nope, but it looked like it was qmail-only.

Only problem with Mailman now is handling spams that went into
moderation queue. Ecartis didn't have a queue, it just sent the mails to
me so I could either delete them or approvove them by replying. Mailman
wants me to go to some web page to approve them. Or there was something
about replying to the message which would delete it, but I couldn't get
that to work. It probably wanted to reply to attached message/rfc822
which Evolution doesn't handle. Still, too difficult compared to just
deleting the mail and forgetting about it.

Also that means I can't use spamassassin to just delete those mails at
my personal mail account. They'd have to be deleted before passed to
Mailman. Last time I tried installing spamassassin directly to Postfix
it required me to install and configure all kind of weird software and I
got tired of trying.

Anyway, good thing is that now I configured Evolution to do list-reply
with Ctrl-R and that works great because we have List-* headers :)

From eskimoe@ananzi.co.za  Tue May 13 18:03:30 2003
Return-Path: <eskimoe@ananzi.co.za>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from sun.com (port-212-202-201-192.reverse.qdsl-home.de
	[212.202.201.192])
	by danu.procontrol.fi (Postfix) with SMTP id 75FB3239AF
	for <dovecot@procontrol.fi>; Tue, 13 May 2003 18:03:29 +0300 (EEST)
Received: (qmail 26403 invoked by uid 1000); 13 May 2003 15:05:44 -0000
Date: Tue, 13 May 2003 17:05:44 +0200
From: Moe Wibble <eskimoe@ananzi.co.za>
To: dovecot@procontrol.fi
Subject: Re: [dovecot] Re: List-id test
Message-ID: <20030513150544.GA22511@woom.net>
Mail-Followup-To: Moe Wibble <eskimoe@ananzi.co.za>,
	dovecot@procontrol.fi
References: <1052702494.5228.418.camel@hurina>
	<1052711046.5228.449.camel@hurina> <20030513122405.GA16248@woom.net>
	<1052829505.1757.11.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1052829505.1757.11.camel@hurina>
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Tue, 13 May 2003 15:03:30 -0000
X-UID: 729                                                  
Status: O
Content-Length: 1743

On Tue, May 13, 2003 at 03:38:25PM +0300, Timo Sirainen wrote:
> On Tue, 2003-05-13 at 15:24, Moe Wibble wrote:
> > > .. I think I'll switch switch the list manager. Mailman looks nice.
> > tried ezmlm? :)
> 
> Nope, but it looked like it was qmail-only.

Yup.

> Only problem with Mailman now is handling spams that went into
> moderation queue. Ecartis didn't have a queue, it just sent the mails to
> me so I could either delete them or approvove them by replying. Mailman
> wants me to go to some web page to approve them. Or there was something
> about replying to the message which would delete it, but I couldn't get
> that to work. It probably wanted to reply to attached message/rfc822
> which Evolution doesn't handle. Still, too difficult compared to just
> deleting the mail and forgetting about it.

Sounds strange. But is moderation really needed?
Unless spam gets out of hand ofcourse.

> Also that means I can't use spamassassin to just delete those mails at
> my personal mail account. They'd have to be deleted before passed to
> Mailman. Last time I tried installing spamassassin directly to Postfix
> it required me to install and configure all kind of weird software and I
> got tired of trying.

Yea, I have a very similar memory of spamassasin. ;)

> Anyway, good thing is that now I configured Evolution to do list-reply
> with Ctrl-R and that works great because we have List-* headers :)

List-Header is good.
I noticed the change right away because my old filter rule for the list
didn't match anymore. But that's okay, List-Id is much better. :)
I only wondered that after the change there was no ezmlm in the header.
Whenever a mailing list that I was on had switched in the past
it always was from X to ezmlm. ;)

From charlie@rubberduck.com  Wed May 14 11:51:48 2003
Return-Path: <charlie@rubberduck.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from lazy.spodder.com (lazy.spodder.com [203.18.242.30])
	by danu.procontrol.fi (Postfix) with ESMTP id 2991E23995
	for <dovecot@procontrol.fi>; Wed, 14 May 2003 11:51:48 +0300 (EEST)
Received: by lazy.spodder.com (Postfix, from userid 501)
	id 2581B8FFD; Wed, 14 May 2003 18:52:27 +1000 (EST)
Date: Wed, 14 May 2003 18:52:27 +1000
From: Charlie Allom <charlie@rubberduck.com>
To: dovecot@procontrol.fi
Message-ID: <20030514085227.GA7325@lazy.spodder.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.5.4i
Subject: [Dovecot] DRAC support?
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 14 May 2003 08:51:48 -0000
X-UID: 730                                                  
Status: O

Hi,

	I was hoping someone had a quick and dirty (is there any other
kind) of patch for DRAC support for dovecot.

This daemon is very slick, and I wish to replace my complex
courier-imap setup.

Regards,
  C.
-- 
 charlie@rubberduck.com - Melbourne, Australia
 http://rubberduck.com/~yeled/
 PGP: 0x14AA7941 || finger yeled@lazy.spodder.com
 > http://groups.google.com/groups?selm=3266D499.342E%40student.uq.edu.au <
From Robert.Evans@cs.cardiff.ac.uk  Wed May 14 18:37:47 2003
Return-Path: <Robert.Evans@cs.cardiff.ac.uk>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from sentinel.cs.cf.ac.uk (sentinel.cs.cf.ac.uk [131.251.42.18])
	by danu.procontrol.fi (Postfix) with ESMTP id 2230923999
	for <dovecot@procontrol.fi>; Wed, 14 May 2003 18:37:47 +0300 (EEST)
Received: from magnesium.cs.cf.ac.uk ([131.251.49.69])
	by sentinel.cs.cf.ac.uk with esmtp (Exim 4.12 #6)
	id 19FyK7-0000g2-00
	for dovecot@procontrol.fi; Wed, 14 May 2003 16:37:43 +0100
From: Robert Evans <Robert.Evans@cs.cardiff.ac.uk>
To: dovecot@procontrol.fi
X-Mailer: Ximian Evolution 1.0.8 (1.0.8-11) 
Date: 14 May 2003 16:37:42 +0100
Message-Id: <1052926663.2853.28.camel@magnesium>
Mime-Version: 1.0
X-SA-Exim-Rcpt-To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
X-Spam-Status: No, hits=-18.0 required=5.0
	tests=AWL,BAYES_01,USER_AGENT_XIMIAN
	autolearn=ham version=2.52
X-Spam-Level: 
X-Spam-Checker-Version: SpamAssassin 2.52 (1.174.2.8-2003-03-24-exp)
X-SA-Exim-Scanned: Yes
Subject: [Dovecot] 
	Creating and renaming mbox folders on NFS auto-installed partitions
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 14 May 2003 15:37:47 -0000
X-UID: 731                                                  
Status: O
Content-Length: 1790

I'm trying dovecot-0.99.9.1 in place of uw-imap which ground to a halt
on a 500MHz SunBlade 100 Solaris 8 system which acts as our Departmental
mail server.  INBOXes are mbox files on the servers's local SCSI disk.
But user directories are auto mounted from other Sun NFS servers and
these may contain other mbox mailboxes in a ~/Mail directory.

There's a problem with creating (and with renaming) mailboxes in the NFS
mounted ~/Mail directory.  For an arbitrary mailbox "newbox", say,
dovecot tries to create the parent directory path /home/username/Mail
before creating the newbox file.

But /home/username is automounted and so creating directory /home or
/home/username fails with errno 89 ENOSYS - unsupported file system
operation. 

The solution is to check for the existence of the directory before
trying to create it.  This will work since /home and /home/username will
always exist for any valid user.

I've amended mbox-storage.c in src/lib-storage/index/mbox to call
"access" to do this....

*** src/lib-storage/index/mbox/mbox-storage.c.orig	Tue Apr 15 14:04:02 2003
--- src/lib-storage/index/mbox/mbox-storage.c	Wed May 14 16:04:39 2003
***************
*** 38,44 ****
  			p++;
  		}
  
! 		if (mkdir(dir, CREATE_MODE) < 0 && errno != EEXIST) {
  			t_pop();
  			return -1;
  		}
--- 38,44 ----
  			p++;
  		}
  
! 		if ( (access(dir,F_OK) != 0) && mkdir(dir, CREATE_MODE) < 0 && errno != EEXIST) {
  			t_pop();
  			return -1;
  		}

- - -
(Could also remove the && errno == EEXIST part - it's redundant 
when access(dir,F_OK) is checking for existence).

Robert
-- 
Robert.Evans@cs.cf.ac.uk Tel:+44(0)29 2087 5518 Fax:+44(0)29 2087 4598
http://www.cs.cf.ac.uk/department/staff/Robert.Evans.shtml
Computer Science, Cardiff University, PO Box 916, Cardiff, CF24 3XF, UK


From tss@iki.fi  Wed May 14 18:55:26 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 5A196239B5
	for <dovecot@procontrol.fi>; Wed, 14 May 2003 18:55:26 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 29B8D5C896C6; Wed, 14 May 2003 18:55:26 +0300 (EEST)
Subject: Re: [Dovecot]  Creating and renaming mbox folders on NFS
	auto-installed partitions
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <1052926663.2853.28.camel@magnesium>
References: <1052926663.2853.28.camel@magnesium>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1052927726.6886.129.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 14 May 2003 18:55:26 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 14 May 2003 15:55:26 -0000
X-UID: 732                                                  
Status: O

On Wed, 2003-05-14 at 18:37, Robert Evans wrote:
> There's a problem with creating (and with renaming) mailboxes in the NFS
> mounted ~/Mail directory.  For an arbitrary mailbox "newbox", say,
> dovecot tries to create the parent directory path /home/username/Mail
> before creating the newbox file.

Yes, I think I'll actually change a bit how that function works. It
almost always needs to create only the last directory, so I'll just
start checking the existence from the second-last directory in it and
start going down until one is found.

> (Could also remove the && errno == EEXIST part - it's redundant 
> when access(dir,F_OK) is checking for existence).

Not really, there could be race condition when two sessions try to
create it at the same time (however unlikely that is).

From tss@iki.fi  Wed May 14 19:18:46 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 296852399E
	for <dovecot@procontrol.fi>; Wed, 14 May 2003 19:18:46 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id ED9CF5C896C6; Wed, 14 May 2003 19:18:45 +0300 (EEST)
Subject: Re: [Dovecot] DRAC support?
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030514085227.GA7325@lazy.spodder.com>
References: <20030514085227.GA7325@lazy.spodder.com>
Content-Type: multipart/mixed; boundary="=-vQmUofRE9gF0A1VRbOCV"
Organization: 
Message-Id: <1052929125.6886.154.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 14 May 2003 19:18:45 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 14 May 2003 16:18:46 -0000
X-UID: 733                                                  
Status: O
Content-Length: 2467


--=-vQmUofRE9gF0A1VRbOCV
Content-Type: text/plain
Content-Transfer-Encoding: 7bit

On Wed, 2003-05-14 at 11:52, Charlie Allom wrote:
> Hi,
> 
> 	I was hoping someone had a quick and dirty (is there any other
> kind) of patch for DRAC support for dovecot.

Doesn't look too difficult to implement. You'll just have to tell DRAC
once in a while to keep the relay open. Um. I was just going to give a
few ideas how to do it, but I ended up writing the thing. Try if the
included patch works. You'll still need to add the needed libraries to
Makefile.

Hmm .. Maybe it's time to add support for runtime loadable IMAP/POP3
modules.


--=-vQmUofRE9gF0A1VRbOCV
Content-Disposition: attachment; filename=drac.diff
Content-Type: text/x-patch; name=drac.diff; charset=ISO-8859-15
Content-Transfer-Encoding: quoted-printable

Index: client.c
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
RCS file: /home/cvs/dovecot/src/imap/client.c,v
retrieving revision 1.27
diff -u -r1.27 client.c
--- client.c	20 Feb 2003 00:46:17 -0000	1.27
+++ client.c	14 May 2003 16:13:16 -0000
@@ -347,6 +347,39 @@
 		client_destroy(client);
 }
=20
+#define HAVE_DRAC
+#define DRAC_TIMEOUT_SECS 60
+#define DRAC_HOST "localhost"
+
+#ifdef HAVE_DRAC
+struct timeout *to_drac;
+
+static void drac_timeout(void *context __attr_unused__)
+{
+	struct ip_addr ip;
+	char *err;
+
+	if (my_client =3D=3D NULL)
+		return;
+
+	if (net_getsockname(my_client->socket, &ip, NULL) < 0) {
+		i_error("DRAC: net_getsockname() failed: %m");
+		return;
+	}
+
+	if (!IPADDR_IS_V4(&ip)) {
+		i_error("DRAC is supported only for IPv4 clients");
+		timeout_remove(to_drac);
+		to_drac =3D NULL;
+	} else {
+		struct in_addr *in_ip =3D (struct in_addr *) &ip.ip;
+
+		if (dracauth(DRAC_HOST, in_ip->s_addr, &err) !=3D 0)
+			i_error("dracauth() failed: %s", err);
+	}
+}
+#endif
+
 static void idle_timeout(void *context __attr_unused__)
 {
 	if (my_client =3D=3D NULL)
@@ -363,6 +396,9 @@
 {
 	my_client =3D NULL;
 	to_idle =3D timeout_add(10000, idle_timeout, NULL);
+#ifdef HAVE_DRAC
+	to_drac =3D timeout_add(1000*DRAC_TIMEOUT_SECS, drac_timeout, NULL);
+#endif
 }
=20
 void clients_deinit(void)
@@ -373,4 +409,8 @@
 	}
=20
 	timeout_remove(to_idle);
+#ifdef HAVE_DRAC
+	if (to_drac !=3D NULL)
+		timeout_remove(to_drac);
+#endif
 }

--=-vQmUofRE9gF0A1VRbOCV--
From charlie@rubberduck.com  Thu May 15 04:12:26 2003
Return-Path: <charlie@rubberduck.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from lazy.spodder.com (lazy.spodder.com [203.18.242.30])
	by danu.procontrol.fi (Postfix) with ESMTP id 5F15C238B6
	for <dovecot@procontrol.fi>; Thu, 15 May 2003 04:12:26 +0300 (EEST)
Received: by lazy.spodder.com (Postfix, from userid 501)
	id 237309000; Thu, 15 May 2003 11:13:06 +1000 (EST)
Date: Thu, 15 May 2003 11:13:06 +1000
From: Charlie Allom <charlie@rubberduck.com>
To: Timo Sirainen <tss@iki.fi>
Subject: Re: [Dovecot] DRAC support?
Message-ID: <20030515011306.GA3731@lazy.spodder.com>
References: <20030514085227.GA7325@lazy.spodder.com>
	<1052929125.6886.154.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1052929125.6886.154.camel@hurina>
User-Agent: Mutt/1.5.4i
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Thu, 15 May 2003 01:12:26 -0000
X-UID: 734                                                  
Status: O

On Wed, May 14, 2003 at 07:18:45PM +0300, Timo Sirainen wrote:
> On Wed, 2003-05-14 at 11:52, Charlie Allom wrote:
> > Hi,
> > 
> > 	I was hoping someone had a quick and dirty (is there any other
> > kind) of patch for DRAC support for dovecot.
> 
> Doesn't look too difficult to implement. You'll just have to tell DRAC
> once in a while to keep the relay open. 

Which relay? I assumed by calling drac, drac kept it's own DB with
IPs.

> Um. I was just going to give a
> few ideas how to do it, but I ended up writing the thing. 

Wow thanks!

> Try if the
> included patch works. You'll still need to add the needed libraries to
> Makefile.

Done. But doesn't update the dracdb.

hrmm what can I do to help you debug it? btw if you wouldlike to test
yourself I am using drac 1.12

Regards,
  C.
-- 
 charlie@rubberduck.com - Melbourne, Australia
 http://rubberduck.com/~yeled/
 PGP: 0x14AA7941 || finger yeled@lazy.spodder.com
 > http://groups.google.com/groups?selm=3266D499.342E%40student.uq.edu.au <
From charlie@rubberduck.com  Thu May 15 07:29:54 2003
Return-Path: <charlie@rubberduck.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from lazy.spodder.com (lazy.spodder.com [203.18.242.30])
	by danu.procontrol.fi (Postfix) with ESMTP id 35EDB239CC
	for <dovecot@procontrol.fi>; Thu, 15 May 2003 07:29:54 +0300 (EEST)
Received: by lazy.spodder.com (Postfix, from userid 501)
	id 22D5A8FFF; Thu, 15 May 2003 14:30:29 +1000 (EST)
Date: Thu, 15 May 2003 14:30:29 +1000
From: Charlie Allom <charlie@rubberduck.com>
To: Timo Sirainen <tss@iki.fi>
Subject: Re: [Dovecot] DRAC support?
Message-ID: <20030515043029.GA18617@lazy.spodder.com>
References: <20030514085227.GA7325@lazy.spodder.com>
	<1052929125.6886.154.camel@hurina> <20030515011306.GA3731@lazy.spodder.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20030515011306.GA3731@lazy.spodder.com>
User-Agent: Mutt/1.5.4i
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Thu, 15 May 2003 04:29:54 -0000
X-UID: 735                                                  
Status: O

On Thu, May 15, 2003 at 11:13:06AM +1000, Charlie Allom wrote:
> 
> Which relay? I assumed by calling drac, drac kept it's own DB with
> IPs.
> 

Here are some examples of other patches:

http://mail.cc.umanitoba.ca/drac/pop.html

-- 
 charlie@rubberduck.com - Melbourne, Australia
 http://rubberduck.com/~yeled/
 PGP: 0x14AA7941 || finger yeled@lazy.spodder.com
 > http://groups.google.com/groups?selm=3266D499.342E%40student.uq.edu.au <
From jryden@thebox.our-own.net  Thu May 15 07:37:16 2003
Return-Path: <jryden@thebox.our-own.net>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from thebox.our-own.net (thebox.our-own.net [64.81.83.87])
	by danu.procontrol.fi (Postfix) with ESMTP id 485FD239CE
	for <dovecot@procontrol.fi>; Thu, 15 May 2003 07:37:16 +0300 (EEST)
Received: from 10.0.0.19 ([10.0.0.19])
	(authenticated bits=0)
	by thebox.our-own.net (8.12.8/8.12.8) with ESMTP id h4F4bCA6013714
	for <dovecot@procontrol.fi>; Wed, 14 May 2003 21:37:13 -0700
From: Joakim Ryden <jryden@thebox.our-own.net>
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] DRAC support?
Date: Wed, 14 May 2003 21:37:11 -0700
User-Agent: KMail/1.5
References: <20030514085227.GA7325@lazy.spodder.com>
	<20030515011306.GA3731@lazy.spodder.com>
	<20030515043029.GA18617@lazy.spodder.com>
In-Reply-To: <20030515043029.GA18617@lazy.spodder.com>
X-Powered-By: GNU/Linux
MIME-Version: 1.0
Content-Type: text/plain;
  charset="iso-8859-1"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline
Message-Id: <200305142137.11186.jryden@thebox.our-own.net>
X-Spam-Status: No, hits=-9.9 required=5.0
	tests=IN_REP_TO,REFERENCES,USER_AGENT
	version=2.53
X-Spam-Checker-Version: SpamAssassin 2.53 (1.174.2.15-2003-03-30-exp)
X-Mailman-Approved-At: Thu, 15 May 2003 09:22:57 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Thu, 15 May 2003 04:37:17 -0000
X-UID: 736                                                  
Status: O

On Wednesday 14 May 2003 21:30, Charlie Allom wrote:
=> On Thu, May 15, 2003 at 11:13:06AM +1000, Charlie Allom wrote:
=> >
=> > Which relay? I assumed by calling drac, drac kept it's own DB with
=> > IPs.
=> >
=>
=> Here are some examples of other patches:
=>
=> http://mail.cc.umanitoba.ca/drac/pop.html

DRAC, pop-before-smtp and other such implementations really is a "broken" way 
of implementing the desired result, IMHO, and I would much prefer this code 
stays out of dovecot. You should be using SMTP auth. Really.

--Jo
From tss@iki.fi  Thu May 15 09:25:47 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 7711F239D3
	for <dovecot@procontrol.fi>; Thu, 15 May 2003 09:25:47 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 532005C896C6; Thu, 15 May 2003 09:25:47 +0300 (EEST)
Subject: Re: [Dovecot] DRAC support?
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030515011306.GA3731@lazy.spodder.com>
References: <20030514085227.GA7325@lazy.spodder.com>
	<20030515011306.GA3731@lazy.spodder.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1052979947.6886.196.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 15 May 2003 09:25:47 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Thu, 15 May 2003 06:25:47 -0000
X-UID: 737                                                  
Status: O

On Thu, 2003-05-15 at 04:13, Charlie Allom wrote:
> > Doesn't look too difficult to implement. You'll just have to tell DRAC
> > once in a while to keep the relay open. 
> 
> Which relay? I assumed by calling drac, drac kept it's own DB with
> IPs.

Yea, that's what I meant :)

> > Try if the
> > included patch works. You'll still need to add the needed libraries to
> > Makefile.
> 
> Done. But doesn't update the dracdb.

Hmm. Probably because it called it the first time after one minute. Try
adding drac_timeout(NULL); at the end of client_create() function?

From tss@iki.fi  Thu May 15 09:28:49 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id A83EB239DA
	for <dovecot@procontrol.fi>; Thu, 15 May 2003 09:28:49 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 7E1F05C896C6; Thu, 15 May 2003 09:28:49 +0300 (EEST)
Subject: Re: [Dovecot] DRAC support?
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <200305142137.11186.jryden@thebox.our-own.net>
References: <20030514085227.GA7325@lazy.spodder.com>
	 <20030515011306.GA3731@lazy.spodder.com>
	 <20030515043029.GA18617@lazy.spodder.com>
	 <200305142137.11186.jryden@thebox.our-own.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1052980129.23300.200.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 15 May 2003 09:28:49 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Thu, 15 May 2003 06:28:49 -0000
X-UID: 738                                                  
Status: O

On Thu, 2003-05-15 at 07:37, Joakim Ryden wrote:
> DRAC, pop-before-smtp and other such implementations really is a "broken" way 
> of implementing the desired result, IMHO, and I would much prefer this code 
> stays out of dovecot. You should be using SMTP auth. Really.

CVS has now support for dynamically loadable modules (disabled by
default). Support for things like this could then be distributed
completely separately from rest of Dovecot.

From lfarkas@bnap.hu  Thu May 15 14:25:12 2003
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 39B6023887
	for <dovecot@procontrol.fi>; Thu, 15 May 2003 14:25:12 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id 9E57975400F
	for <dovecot@procontrol.fi>; Thu, 15 May 2003 13:27:25 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id 4FC4A3ED5
	for <dovecot@procontrol.fi>; Thu, 15 May 2003 13:25:02 +0200 (CEST)
Received: from bnap.hu (garfield.int.bppiac.hu [192.168.0.50])
	by mail2.bppiac.hu (Postfix) with ESMTP id 2AF033ECA
	for <dovecot@procontrol.fi>; Thu, 15 May 2003 13:25:02 +0200 (CEST)
Message-ID: <3EC3790D.2090602@bnap.hu>
Date: Thu, 15 May 2003 13:25:01 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
Subject: [Dovecot] ssl still not working
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Thu, 15 May 2003 11:25:12 -0000
X-UID: 739                                                  
Status: O

hi,
I'm just download the latest cvs and try to use imaps. in mozilla I've 
got the following message window:
-----------------------------
mail.int.bppiac.hu received a message with incorrect Message 
Authentication Code. If the error occurs frequently, contact the website 
administrator.
-----------------------------
and there is only one OK button:-)
and this happens always. what can be the reason and what can I do?
thanks.

-- 
   Levente                               "Si vis pacem para bellum!"


From BrandonHoult@netscape.net  Thu May 15 21:19:24 2003
Return-Path: <BrandonHoult@netscape.net>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from server (dsl-64-91-5-173.spt.customer.centurytel.net
	[64.91.5.173])
	by danu.procontrol.fi (Postfix) with ESMTP id 3FA572399B
	for <dovecot@procontrol.fi>; Thu, 15 May 2003 21:19:24 +0300 (EEST)
Received: from wombat ([192.168.0.20] helo=netscape.net)
	by server with esmtp (Exim 3.35 #1 (Debian))
	id 19GNJu-0007Hn-00
	for <dovecot@procontrol.fi>; Thu, 15 May 2003 13:19:10 -0500
Message-ID: <3EC3DBDC.1010701@netscape.net>
Date: Thu, 15 May 2003 13:26:36 -0500
From: Brandon Hoult <BrandonHoult@netscape.net>
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.0; en-US;
	rv:1.3) Gecko/20030312
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: dovecot@procontrol.fi
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-Mailman-Approved-At: Thu, 15 May 2003 21:21:53 +0300
Subject: [Dovecot] help: The current command did not succeed. The mail server
 responded: Invalid mask.
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Thu, 15 May 2003 18:19:24 -0000
X-UID: 740                                                  
Status: O

Am tryin to move from uw-imapd to dovecot, using dovecot ver 0.99.9.1-1 
on debian.  Using Mozilla Mail v 1.3 currently using mbox format.

I made some test accounts and they seem to be working fine, but my older 
existing accounts give error messages whenever I connect or subscribe to 
  mailboxes within them.  The message that appears on the client is:

"The current command did not succeed. The mail server responded: Invalid 
mask."

it appears three times in an alert box (on windows) then everything 
seems to work.  There are no messages in any of the mail logs in 
/var/log which would indicate a problem.

The test accounts I created don't have this problem so I tried renameing 
the home directory, deleting the user, then recreating the user. 
However even with a new homedir the problem remains unchanged.  I have 
verified that the permissions in ~/mail and /var/mail are set 
identically for working and non-working users.

Thanks in advance for any advice,
Brandon Hoult
dolt@lmistudios.homeip.net

From tss@iki.fi  Thu May 15 21:33:22 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id C2BE2239CF
	for <dovecot@procontrol.fi>; Thu, 15 May 2003 21:33:22 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 68EEB5C896C6; Thu, 15 May 2003 21:33:22 +0300 (EEST)
Subject: Re: [Dovecot] help: The current command did not succeed. The mail
	server responded: Invalid mask.
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <3EC3DBDC.1010701@netscape.net>
References: <3EC3DBDC.1010701@netscape.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1053023602.23300.253.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 15 May 2003 21:33:22 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Thu, 15 May 2003 18:33:23 -0000
X-UID: 741                                                  
Status: O
Content-Length: 1068

On Thu, 2003-05-15 at 21:26, Brandon Hoult wrote:
> Am tryin to move from uw-imapd to dovecot, using dovecot ver 0.99.9.1-1 
> on debian.  Using Mozilla Mail v 1.3 currently using mbox format.
> 
> I made some test accounts and they seem to be working fine, but my older 
> existing accounts give error messages whenever I connect or subscribe to 
>   mailboxes within them.  The message that appears on the client is:
> 
> "The current command did not succeed. The mail server responded: Invalid 
> mask."

Mozilla is probably remembering some old settings from uw-imapd. I'm not
sure what exactly, since they should have pretty similiar settings.
Maybe anyway related to handling ~/mail or namespaces in general.

That error happens anyway if client tries to use absolute file paths
(/path, \path, ~/path/) or tries to use ../ or ..\ in the path. '\'
checking isn't actually really needed, but I thought I might as well
prepare for future VMS/Windows port :)

Instead of giving the error, I could also just make Dovecot ignore that.
I'm not sure if it'd be better..

From warren@togami.com  Thu May 15 23:50:53 2003
Return-Path: <warren@togami.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from pan.mplug.org (unknown [66.139.75.105])
	by danu.procontrol.fi (Postfix) with ESMTP id 8D1182399C
	for <dovecot@procontrol.fi>; Thu, 15 May 2003 23:50:53 +0300 (EEST)
Received: from localhost.127.in-addr.arpa (unknown [127.0.0.1])
	by pan.mplug.org (Postfix) with ESMTP id 734335D805C
	for <dovecot@procontrol.fi>; Thu, 15 May 2003 10:53:39 -1000 (HST)
Subject: Re: [Dovecot] ssl still not working
From: Warren Togami <warren@togami.com>
To: dovecot@procontrol.fi
In-Reply-To: <3EC3790D.2090602@bnap.hu>
References: <3EC3790D.2090602@bnap.hu>
Content-Type: text/plain
Message-Id: <1053031846.15567.10.camel@laptop>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.3.3 (1.3.3-2) (Preview Release)
Date: 15 May 2003 10:50:47 -1000
Content-Transfer-Encoding: 7bit
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Thu, 15 May 2003 20:50:54 -0000
X-UID: 742                                                  
Status: O

On Thu, 2003-05-15 at 01:25, Farkas Levente wrote:
> hi,
> I'm just download the latest cvs and try to use imaps. in mozilla I've 
> got the following message window:
> -----------------------------
> mail.int.bppiac.hu received a message with incorrect Message 
> Authentication Code. If the error occurs frequently, contact the website 
> administrator.
> -----------------------------
> and there is only one OK button:-)
> and this happens always. what can be the reason and what can I do?
> thanks.

I can say that I too have never been able to get IMAPS working with
dovecot, with both self-signed generated .pem files and my apache SSL
keys.  I have that same error message with Mozilla Mail 1.2.1 and 1.4b.

Warren


From mem@mv.mv.com  Fri May 16 05:18:08 2003
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id 2F8FD23997
	for <dovecot@procontrol.fi>; Fri, 16 May 2003 05:18:08 +0300 (EEST)
Received: (qmail 18013 invoked by uid 101); 15 May 2003 22:18:06 -0400
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Thu, 15 May 2003 22:18:06 -0400
To: dovecot@procontrol.fi
Message-ID: <20030516021806.GB26613@iridium.mv.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.4.1i
Subject: [Dovecot] rawlog fails
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 16 May 2003 02:18:09 -0000
X-UID: 743                                                  
Status: O


You mentioned --with-rawlog earlier, so I tried it.  It fails with
a select error.  I believe it's because in some cases the timeval
struct is not initialized in io_loop_get_wait_time (e.g. see sample
diff below).  

-mm-


diff -c src/lib/ioloop.c.orig src/lib/ioloop.c
*** src/lib/ioloop.c.orig       Sat Apr 12 11:00:10 2003
--- src/lib/ioloop.c    Thu May 15 22:10:12 2003
***************
*** 223,230 ****
--- 223,238 ----
  int io_loop_get_wait_time(struct timeout *timeout, struct timeval *tv,
                          struct timeval *tv_now)
  {
+ #if 0         /* mem 20030515 make sure tv contains valid data here */
        if (timeout == NULL)
                return INT_MAX;
+ #else
+       if (timeout == NULL) {
+               tv->tv_sec = INT_MAX / 1000;
+               tv->tv_usec = 0;
+               return INT_MAX;
+       }
+ #endif

        if (tv_now == NULL) {
                if (gettimeofday(tv, NULL) < 0)


From leslie_viljoen@icoc.org  Fri May 16 10:00:57 2003
Return-Path: <leslie_viljoen@icoc.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from acesonline.org.za (unknown [196.37.98.115])
	by danu.procontrol.fi (Postfix) with ESMTP id D1AD1238C9
	for <dovecot@procontrol.fi>; Fri, 16 May 2003 10:00:55 +0300 (EEST)
Received: from localhost.localdomain (unknown [196.37.98.116])
	by acesonline.org.za (Postfix) with ESMTP id BD6F86156
	for <dovecot@procontrol.fi>; Fri, 16 May 2003 10:03:14 -0700 (PDT)
In-Reply-To: <1053031846.15567.10.camel@laptop>
From: leslie_viljoen@icoc.org
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] ssl still not working
MIME-Version: 1.0
X-Mailer: Lotus Notes Release 6.0 September 26, 2002
Message-ID: <OF13CF810E.8D3F2B92-ON42256D28.0025E6D0-42256D28.0026D06A@localdomain>
Date: Fri, 16 May 2003 09:03:57 +0200
X-MIMETrack: Serialize by Notes Client on Leslie Viljoen/JOBURG/ICC(Release
	6.0|September 26, 2002) at 2003-05-16 09:03:57 AM,
	Serialize complete at 2003-05-16 09:03:57 AM
Content-Type: multipart/alternative;
	boundary="=_alternative 0026D03E42256D28_="
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 16 May 2003 07:00:57 -0000
X-UID: 744                                                  
Status: O
Content-Length: 5959

This is a multipart message in MIME format.
--=_alternative 0026D03E42256D28_=
Content-Type: text/plain; charset="US-ASCII"

SSL is working very well for me. I used the mkcert.sh script that comes 
with Dovecot - although I changed
it a bit to make a certificate that lasts a year instead of one month.

Mozilla, Outlook Express, Lotus Notes - all using SSL on port 993 to 
communicate with Dovecot and
working fine.

It _did_ take some work to get Dovecot to compile with SSL support, but it 
turns out that my SSL_dev
package was not installed properly. (I had such a problem finding the 
header files that were needed
that I completely upgraded the whole of Linux on that machine and then 
installed the DEV code
from a package).
Once that was done, I could coax Dovecot into compiling with SSL.

Now it works very well. Mozilla in particular immediately asks me if I 
want to accept the certificate
permanently or temorarily - Outlook and Notes use IE's certificate store - 
for that I needed to tell
my users to surf to https://server.com:993 - and then IE would pick up the 
certificate and let them add it
to their trusted store.

I don't know about the Mozilla error below, I didn't get that.

Les

______________________________________
Leslie Viljoen 
Africa Missions Systems Administrator
Cell: 0836186100 Work: 011 6991700
Fax: 011 7945522




Warren Togami <warren@togami.com>
Sent by: dovecot-bounces@procontrol.fi
2003-05-15 10:50 PM
 
        To:     dovecot@procontrol.fi
        cc: 
        Subject:        Re: [Dovecot] ssl still not working


On Thu, 2003-05-15 at 01:25, Farkas Levente wrote:
> hi,
> I'm just download the latest cvs and try to use imaps. in mozilla I've 
> got the following message window:
> -----------------------------
> mail.int.bppiac.hu received a message with incorrect Message 
> Authentication Code. If the error occurs frequently, contact the website 

> administrator.
> -----------------------------
> and there is only one OK button:-)
> and this happens always. what can be the reason and what can I do?
> thanks.

I can say that I too have never been able to get IMAPS working with
dovecot, with both self-signed generated .pem files and my apache SSL
keys.  I have that same error message with Mozilla Mail 1.2.1 and 1.4b.

Warren




--=_alternative 0026D03E42256D28_=
Content-Type: text/html; charset="US-ASCII"


<br><font size=2 face="sans-serif">SSL is working very well for me. I used
the mkcert.sh script that comes with Dovecot - although I changed</font>
<br><font size=2 face="sans-serif">it a bit to make a certificate that
lasts a year instead of one month.</font>
<br>
<br><font size=2 face="sans-serif">Mozilla, Outlook Express, Lotus Notes
- all using SSL on port 993 to communicate with Dovecot and</font>
<br><font size=2 face="sans-serif">working fine.</font>
<br>
<br><font size=2 face="sans-serif">It _did_ take some work to get Dovecot
to compile with SSL support, but it turns out that my SSL_dev</font>
<br><font size=2 face="sans-serif">package was not installed properly.
(I had such a problem finding the header files that were needed</font>
<br><font size=2 face="sans-serif">that I completely upgraded the whole
of Linux on that machine and then installed the DEV code</font>
<br><font size=2 face="sans-serif">from a package).</font>
<br><font size=2 face="sans-serif">Once that was done, I could coax Dovecot
into compiling with SSL.</font>
<br>
<br><font size=2 face="sans-serif">Now it works very well. Mozilla in particular
immediately asks me if I want to accept the certificate</font>
<br><font size=2 face="sans-serif">permanently or temorarily - Outlook
and Notes use IE's certificate store - for that I needed to tell</font>
<br><font size=2 face="sans-serif">my users to surf to https://server.com:993
- and then IE would pick up the certificate and let them add it</font>
<br><font size=2 face="sans-serif">to their trusted store.</font>
<br>
<br><font size=2 face="sans-serif">I don't know about the Mozilla error
below, I didn't get that.</font>
<br>
<br><font size=2 face="sans-serif">Les</font>
<br>
<br><font size=2 face="sans-serif">______________________________________<br>
Leslie Viljoen <br>
Africa Missions Systems Administrator<br>
Cell: 0836186100 Work: 011 6991700<br>
Fax: 011 7945522</font>
<br>
<br>
<br>
<table width=100%>
<tr valign=top>
<td>
<td><font size=1 face="sans-serif"><b>Warren Togami &lt;warren@togami.com&gt;</b></font>
<br><font size=1 face="sans-serif">Sent by: dovecot-bounces@procontrol.fi</font>
<p><font size=1 face="sans-serif">2003-05-15 10:50 PM</font>
<td><font size=1 face="Arial">&nbsp; &nbsp; &nbsp; &nbsp; </font>
<br><font size=1 face="sans-serif">&nbsp; &nbsp; &nbsp; &nbsp; To:
&nbsp; &nbsp; &nbsp; &nbsp;dovecot@procontrol.fi</font>
<br><font size=1 face="sans-serif">&nbsp; &nbsp; &nbsp; &nbsp; cc:
&nbsp; &nbsp; &nbsp; &nbsp;</font>
<br><font size=1 face="sans-serif">&nbsp; &nbsp; &nbsp; &nbsp; Subject:
&nbsp; &nbsp; &nbsp; &nbsp;Re: [Dovecot] ssl still not working</font></table>
<br>
<br>
<br><font size=2><tt>On Thu, 2003-05-15 at 01:25, Farkas Levente wrote:<br>
&gt; hi,<br>
&gt; I'm just download the latest cvs and try to use imaps. in mozilla
I've <br>
&gt; got the following message window:<br>
&gt; -----------------------------<br>
&gt; mail.int.bppiac.hu received a message with incorrect Message <br>
&gt; Authentication Code. If the error occurs frequently, contact the website
<br>
&gt; administrator.<br>
&gt; -----------------------------<br>
&gt; and there is only one OK button:-)<br>
&gt; and this happens always. what can be the reason and what can I do?<br>
&gt; thanks.<br>
<br>
I can say that I too have never been able to get IMAPS working with<br>
dovecot, with both self-signed generated .pem files and my apache SSL<br>
keys. &nbsp;I have that same error message with Mozilla Mail 1.2.1 and
1.4b.<br>
<br>
Warren<br>
<br>
<br>
</tt></font>
<br>
--=_alternative 0026D03E42256D28_=--
From ruud@duticg.twi.tudelft.nl  Fri May 16 10:27:49 2003
Return-Path: <ruud@duticg.twi.tudelft.nl>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from dutids.twi.tudelft.nl (dutids.twi.tudelft.nl [130.161.157.71])
	by danu.procontrol.fi (Postfix) with ESMTP id 7FCD6239DE
	for <dovecot@procontrol.fi>; Fri, 16 May 2003 10:27:49 +0300 (EEST)
Received: from ruud by dutids.twi.tudelft.nl with local (Exim 3.35 #1
	(Debian))	id 19GZd6-0007WY-00; Fri, 16 May 2003 09:27:48 +0200
Date: Fri, 16 May 2003 09:27:48 +0200
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] ssl still not working
Message-ID: <20030516072748.GA28822@dutids.twi.tudelft.nl>
References: <3EC3790D.2090602@bnap.hu>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <3EC3790D.2090602@bnap.hu>
User-Agent: Mutt/1.3.28i
From: Ruud de Jong <ruud@duticg.twi.tudelft.nl>
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 16 May 2003 07:27:49 -0000
X-UID: 745                                                  
Status: O
Content-Length: 1196

Hi,

I'm running a stable debian version and had the same problem after
installing the debian package.
When I downloaded the latest version of openssl (openssl-0.9.7b), compiled
dovecot and linked it with this openssl version the problem was solved.

regards,

Ruud


On Thu, May 15, 2003 at 01:25:01PM +0200, Farkas Levente wrote:
> hi,
> I'm just download the latest cvs and try to use imaps. in mozilla I've 
> got the following message window:
> -----------------------------
> mail.int.bppiac.hu received a message with incorrect Message 
> Authentication Code. If the error occurs frequently, contact the website 
> administrator.
> -----------------------------
> and there is only one OK button:-)
> and this happens always. what can be the reason and what can I do?
> thanks.
> 
> -- 
>   Levente                               "Si vis pacem para bellum!"
> 

-- 
Ruud de Jong
Delft Universitiy of Technology
Faculty of Information Technology and Systems
Computer Graphics and CAD/CAM Group
Mekelweg 4, room 12.070, 2628 CD  Delft, The Netherlands
E-mail	: R.deJong@its.tudelft.nl
pgp key : http://graphics.tudelft.nl/~ruud/ruud.pgp
Phone	: +31 (0)15 278 1437  
Fax	: +31 (0)15 278 7141 

From lfarkas@bnap.hu  Fri May 16 12:38:51 2003
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id E8DAE239E7
	for <dovecot@procontrol.fi>; Fri, 16 May 2003 12:38:50 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id D6A4D75401A
	for <dovecot@procontrol.fi>; Fri, 16 May 2003 11:38:46 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id 244F33EC4
	for <dovecot@procontrol.fi>; Fri, 16 May 2003 11:38:49 +0200 (CEST)
Received: from bnap.hu (garfield.int.bppiac.hu [192.168.0.50])
	by mail2.bppiac.hu (Postfix) with ESMTP id 104FC3EAD
	for <dovecot@procontrol.fi>; Fri, 16 May 2003 11:38:49 +0200 (CEST)
Message-ID: <3EC4B1A7.3030000@bnap.hu>
Date: Fri, 16 May 2003 11:38:47 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] ssl still not working
References: <3EC3790D.2090602@bnap.hu>
	<20030516072748.GA28822@dutids.twi.tudelft.nl>
In-Reply-To: <20030516072748.GA28822@dutids.twi.tudelft.nl>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 16 May 2003 09:38:51 -0000
X-UID: 746                                                  
Status: O
Content-Length: 1075

that may be the reason since I use:
openssl-0.9.7a-5
openssl-devel-0.9.7a-5

Ruud de Jong wrote:
> Hi,
> 
> I'm running a stable debian version and had the same problem after
> installing the debian package.
> When I downloaded the latest version of openssl (openssl-0.9.7b), compiled
> dovecot and linked it with this openssl version the problem was solved.
> 
> regards,
> 
> Ruud
> 
> 
> On Thu, May 15, 2003 at 01:25:01PM +0200, Farkas Levente wrote:
> 
>>hi,
>>I'm just download the latest cvs and try to use imaps. in mozilla I've 
>>got the following message window:
>>-----------------------------
>>mail.int.bppiac.hu received a message with incorrect Message 
>>Authentication Code. If the error occurs frequently, contact the website 
>>administrator.
>>-----------------------------
>>and there is only one OK button:-)
>>and this happens always. what can be the reason and what can I do?
>>thanks.
>>
>>-- 
>>  Levente                               "Si vis pacem para bellum!"
>>
> 
> 


-- 
   Levente                               "Si vis pacem para bellum!"


From lfarkas@bnap.hu  Fri May 16 13:13:38 2003
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 62DEB239E9
	for <dovecot@procontrol.fi>; Fri, 16 May 2003 13:13:38 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id D2E4D754013
	for <dovecot@procontrol.fi>; Fri, 16 May 2003 12:13:33 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id D46363EC4
	for <dovecot@procontrol.fi>; Fri, 16 May 2003 12:13:30 +0200 (CEST)
Received: from bnap.hu (garfield.int.bppiac.hu [192.168.0.50])
	by mail2.bppiac.hu (Postfix) with ESMTP id BD3723ED3
	for <dovecot@procontrol.fi>; Fri, 16 May 2003 12:13:30 +0200 (CEST)
Message-ID: <3EC4B9C7.7010000@bnap.hu>
Date: Fri, 16 May 2003 12:13:27 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: Re: [Dovecot] ssl still not working
References: <3EC3790D.2090602@bnap.hu>
	<20030516072748.GA28822@dutids.twi.tudelft.nl> <3EC4B1A7.3030000@bnap.hu>
In-Reply-To: <3EC4B1A7.3030000@bnap.hu>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 16 May 2003 10:13:38 -0000
X-UID: 747                                                  
Status: O
Content-Length: 1255

but as I look into the source it seems redhat already include all patch 
for 7b:-( any other tipp?

Farkas Levente wrote:
> that may be the reason since I use:
> openssl-0.9.7a-5
> openssl-devel-0.9.7a-5
> 
> Ruud de Jong wrote:
> 
>> Hi,
>>
>> I'm running a stable debian version and had the same problem after
>> installing the debian package.
>> When I downloaded the latest version of openssl (openssl-0.9.7b), 
>> compiled
>> dovecot and linked it with this openssl version the problem was solved.
>>
>> regards,
>>
>> Ruud
>>
>>
>> On Thu, May 15, 2003 at 01:25:01PM +0200, Farkas Levente wrote:
>>
>>> hi,
>>> I'm just download the latest cvs and try to use imaps. in mozilla 
>>> I've got the following message window:
>>> -----------------------------
>>> mail.int.bppiac.hu received a message with incorrect Message 
>>> Authentication Code. If the error occurs frequently, contact the 
>>> website administrator.
>>> -----------------------------
>>> and there is only one OK button:-)
>>> and this happens always. what can be the reason and what can I do?
>>> thanks.
>>>
>>> -- 
>>>  Levente                               "Si vis pacem para bellum!"
>>>
>>
>>
> 
> 


-- 
   Levente                               "Si vis pacem para bellum!"


From warren@togami.com  Fri May 16 13:46:02 2003
Return-Path: <warren@togami.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from pan.mplug.org (unknown [66.139.75.105])
	by danu.procontrol.fi (Postfix) with ESMTP id E9D55239E3
	for <dovecot@procontrol.fi>; Fri, 16 May 2003 13:46:01 +0300 (EEST)
Received: from localhost.127.in-addr.arpa (unknown [127.0.0.1])
	by pan.mplug.org (Postfix) with ESMTP id 63E7B5D803F
	for <dovecot@procontrol.fi>; Fri, 16 May 2003 00:48:59 -1000 (HST)
Subject: Re: [Dovecot] ssl still not working
From: Warren Togami <warren@togami.com>
To: dovecot@procontrol.fi
In-Reply-To: <3EC4B9C7.7010000@bnap.hu>
References: <3EC3790D.2090602@bnap.hu><3EC4B1A7.3030000@bnap.hu>
	<3EC4B9C7.7010000@bnap.hu>
Content-Type: text/plain
Message-Id: <1053081958.31529.9.camel@laptop>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.3.3 (1.3.3-2) (Preview Release)
Date: 16 May 2003 00:45:58 -1000
Content-Transfer-Encoding: 7bit
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 16 May 2003 10:46:02 -0000
X-UID: 748                                                  
Status: O

Did you folks have to create a pam.d file for dovecot?  I'm not quite
sure what to put in my pam.d dovecot file.  Could this be effecting my
SSL ability?

Warren


From lfarkas@bnap.hu  Fri May 16 13:52:24 2003
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 5C802239EF
	for <dovecot@procontrol.fi>; Fri, 16 May 2003 13:52:24 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id ABC2675401B
	for <dovecot@procontrol.fi>; Fri, 16 May 2003 12:52:19 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id 1D3953ECA
	for <dovecot@procontrol.fi>; Fri, 16 May 2003 12:52:22 +0200 (CEST)
Received: from bnap.hu (garfield.int.bppiac.hu [192.168.0.50])
	by mail2.bppiac.hu (Postfix) with ESMTP id 04C4B3EC4
	for <dovecot@procontrol.fi>; Fri, 16 May 2003 12:52:22 +0200 (CEST)
Message-ID: <3EC4C2E5.7080409@bnap.hu>
Date: Fri, 16 May 2003 12:52:21 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: Re: [Dovecot] ssl still not working
References: <3EC3790D.2090602@bnap.hu><3EC4B1A7.3030000@bnap.hu>
	<3EC4B9C7.7010000@bnap.hu> <1053081958.31529.9.camel@laptop>
In-Reply-To: <1053081958.31529.9.camel@laptop>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 16 May 2003 10:52:24 -0000
X-UID: 749                                                  
Status: O

Warren Togami wrote:
> Did you folks have to create a pam.d file for dovecot?  I'm not quite
> sure what to put in my pam.d dovecot file.  Could this be effecting my
> SSL ability?
> 
> Warren
put the same to all imap, imaps, pop3, pop3s:
---------------------
#%PAM-1.0
auth       required     pam_nologin.so
auth       required     pam_stack.so service=system-auth
account    required     pam_stack.so service=system-auth
session    required     pam_stack.so service=system-auth
---------------------


-- 
   Levente                               "Si vis pacem para bellum!"


From leslie_viljoen@icoc.org  Fri May 16 13:57:26 2003
Return-Path: <leslie_viljoen@icoc.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from acesonline.org.za (unknown [196.37.98.115])
	by danu.procontrol.fi (Postfix) with ESMTP id 07261239F2
	for <dovecot@procontrol.fi>; Fri, 16 May 2003 13:57:24 +0300 (EEST)
Received: from localhost.localdomain (unknown [196.37.98.116])
	by acesonline.org.za (Postfix) with ESMTP id 2C82C6157
	for <dovecot@procontrol.fi>; Fri, 16 May 2003 13:59:47 -0700 (PDT)
In-Reply-To: <1053081958.31529.9.camel@laptop>
From: leslie_viljoen@icoc.org
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] ssl still not working
MIME-Version: 1.0
X-Mailer: Lotus Notes Release 6.0 September 26, 2002
Message-ID: <OF787E7C26.8C2064A4-ON42256D28.003BE758-42256D28.0052DE53@localdomain>
Date: Fri, 16 May 2003 17:05:08 +0200
X-MIMETrack: Serialize by Notes Client on Leslie Viljoen/JOBURG/ICC(Release
	6.0|September 26, 2002) at 2003-05-16 05:05:09 PM,
	Serialize complete at 2003-05-16 05:05:09 PM
Content-Type: multipart/alternative;
	boundary="=_alternative 0052DE1842256D28_="
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 16 May 2003 10:57:26 -0000
X-UID: 750                                                  
Status: O
Content-Length: 2502

This is a multipart message in MIME format.
--=_alternative 0052DE1842256D28_=
Content-Type: text/plain; charset="US-ASCII"

I am using shadow authentication, not Pam, so I don't know.

Here are my /usr/local/etc/dovecot.conf entries:

auth_userdb = passwd
auth_passdb = shadow



Les

______________________________________
Leslie Viljoen 
Africa Missions Systems Administrator
Cell: 0836186100 Work: 011 6991700
Fax: 011 7945522




Warren Togami <warren@togami.com>
Sent by: dovecot-bounces@procontrol.fi
2003-05-16 12:45 PM
 
        To:     dovecot@procontrol.fi
        cc: 
        Subject:        Re: [Dovecot] ssl still not working


Did you folks have to create a pam.d file for dovecot?  I'm not quite
sure what to put in my pam.d dovecot file.  Could this be effecting my
SSL ability?

Warren




--=_alternative 0052DE1842256D28_=
Content-Type: text/html; charset="US-ASCII"


<br><font size=2 face="sans-serif">I am using shadow authentication, not
Pam, so I don't know.</font>
<br>
<br><font size=2 face="sans-serif">Here are my /usr/local/etc/dovecot.conf
entries:</font>
<br>
<br><font size=2 face="sans-serif">auth_userdb = passwd</font>
<br><font size=2 face="sans-serif">auth_passdb = shadow</font>
<br>
<br>
<br>
<br><font size=2 face="sans-serif">Les</font>
<br>
<br><font size=2 face="sans-serif">______________________________________<br>
Leslie Viljoen <br>
Africa Missions Systems Administrator<br>
Cell: 0836186100 Work: 011 6991700<br>
Fax: 011 7945522</font>
<br>
<br>
<br>
<table width=100%>
<tr valign=top>
<td>
<td><font size=1 face="sans-serif"><b>Warren Togami &lt;warren@togami.com&gt;</b></font>
<br><font size=1 face="sans-serif">Sent by: dovecot-bounces@procontrol.fi</font>
<p><font size=1 face="sans-serif">2003-05-16 12:45 PM</font>
<td><font size=1 face="Arial">&nbsp; &nbsp; &nbsp; &nbsp; </font>
<br><font size=1 face="sans-serif">&nbsp; &nbsp; &nbsp; &nbsp; To:
&nbsp; &nbsp; &nbsp; &nbsp;dovecot@procontrol.fi</font>
<br><font size=1 face="sans-serif">&nbsp; &nbsp; &nbsp; &nbsp; cc:
&nbsp; &nbsp; &nbsp; &nbsp;</font>
<br><font size=1 face="sans-serif">&nbsp; &nbsp; &nbsp; &nbsp; Subject:
&nbsp; &nbsp; &nbsp; &nbsp;Re: [Dovecot] ssl still not working</font></table>
<br>
<br>
<br><font size=2><tt>Did you folks have to create a pam.d file for dovecot?
&nbsp;I'm not quite<br>
sure what to put in my pam.d dovecot file. &nbsp;Could this be effecting
my<br>
SSL ability?<br>
<br>
Warren<br>
<br>
<br>
</tt></font>
<br>
--=_alternative 0052DE1842256D28_=--
From tss@iki.fi  Fri May 16 20:15:14 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 079E6238CE
	for <dovecot@procontrol.fi>; Fri, 16 May 2003 20:15:14 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 1C04A5C896C6; Fri, 16 May 2003 20:15:12 +0300 (EEST)
Subject: Re: [Dovecot] rawlog fails
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030516021806.GB26613@iridium.mv.net>
References: <20030516021806.GB26613@iridium.mv.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1053105311.1212.26.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 16 May 2003 20:15:11 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 16 May 2003 17:15:14 -0000
X-UID: 751                                                  
Status: O

On Fri, 2003-05-16 at 05:18, Mark E. Mallett wrote:
> You mentioned --with-rawlog earlier, so I tried it.  It fails with
> a select error.  I believe it's because in some cases the timeval
> struct is not initialized in io_loop_get_wait_time (e.g. see sample
> diff below).  

Yes, thanks, committed to CVS.

From tss@iki.fi  Fri May 16 20:19:12 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id D0553239EC
	for <dovecot@procontrol.fi>; Fri, 16 May 2003 20:19:11 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 691D65C896C6; Fri, 16 May 2003 20:19:11 +0300 (EEST)
Subject: [Fwd: Re: [Dovecot] help: The current command did not succeed. The
	mail server responded: Invalid mask.]
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: multipart/mixed; boundary="=-IsnW+ZNhrqJ6wjmRliAO"
Organization: 
Message-Id: <1053105551.1218.28.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 16 May 2003 20:19:11 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 16 May 2003 17:19:12 -0000
X-UID: 752                                                  
Status: O
Content-Length: 6115


--=-IsnW+ZNhrqJ6wjmRliAO
Content-Type: text/plain
Content-Transfer-Encoding: 7bit

Just FYI, I guess this message was meant here :)


--=-IsnW+ZNhrqJ6wjmRliAO
Content-Disposition: inline
Content-Description: Forwarded message - Re: [Dovecot] help: The current
	command did not succeed. The mail server responded: Invalid mask.
Content-Type: message/rfc822

Return-Path: <dolt@lmistudios.homeip.net>
Delivered-To: cras@irccrew.org
Received: from jokotaas.iki.fi (jokotaas.iki.fi [212.16.100.2]) by
	shodan.irccrew.org (Postfix) with ESMTP id CE3042E003 for
	<cras@irccrew.org>; Thu, 15 May 2003 22:05:20 +0300 (EEST)
Received: from server (dsl-64-91-5-173.spt.customer.centurytel.net
	[64.91.5.173]) by jokotaas.iki.fi (8.11.6p2/8.11.6) with ESMTP id
	h4FJ5JW11273 for <tss@iki.fi>; Thu, 15 May 2003 22:05:19 +0300 (EEST)
Received: from wombat ([192.168.0.20] helo=lmistudios.homeip.net) by server
	<tss@iki.fi>;	Thu, 15 May 2003 14:05:06 -0500
Message-ID: <3EC3E6A0.3020603@lmistudios.homeip.net>
Date: Thu, 15 May 2003 14:12:32 -0500
From: dolt <dolt@lmistudios.homeip.net>
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.0; en-US; rv:1.3)
	Gecko/20030312
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Timo Sirainen <tss@iki.fi>
Subject: Re: [Dovecot] help: The current command did not succeed. The mail
	server responded: Invalid mask.
References: <3EC3DBDC.1010701@netscape.net>
	 <1053023602.23300.253.camel@hurina>
In-Reply-To: <1053023602.23300.253.camel@hurina>
Content-Type: multipart/alternative;
	boundary="------------070506070803030608090705"
X-Spam-Status: No, hits=-29.4 required=4.0
	tests=EMAIL_ATTRIBUTION,HTML_10_20,HTML_MESSAGE,IN_REP_TO,
	QUOTED_EMAIL_TEXT,REFERENCES,REPLY_WITH_QUOTES, USER_AGENT_MOZILLA_UA
	autolearn=ham version=2.53
X-Spam-Level: 
X-Spam-Checker-Version: SpamAssassin 2.53 (1.174.2.15-2003-03-30-exp)
Status: O
X-UID: 13814
Content-Length: 4195
X-Keywords: 


--------------070506070803030608090705
Content-Transfer-Encoding: 7bit
Content-Type: text/plain; charset=us-ascii; format=flowed

Yes, that was the problem... tried an old version of netscape and 
everything was ok.

I eventually found where the problems was in mozilla and thought I would 
post the solution if anyone else was experiencing the same trouble.

I started looking around in the mozilla mail settings and found under 
the [ edit - maiil and newsgroup account settings - (appropriate 
account) - server settings ] there is a line at the bottom labled "local 
directory" where it specifies the location it keeps all the settings 
in.  I deleted all the files in that directory and the problems went away.

Thanks,
Brandon.

Timo Sirainen wrote:

>On Thu, 2003-05-15 at 21:26, Brandon Hoult wrote:
>  
>
>>Am tryin to move from uw-imapd to dovecot, using dovecot ver 0.99.9.1-1 
>>on debian.  Using Mozilla Mail v 1.3 currently using mbox format.
>>
>>I made some test accounts and they seem to be working fine, but my older 
>>existing accounts give error messages whenever I connect or subscribe to 
>>  mailboxes within them.  The message that appears on the client is:
>>
>>"The current command did not succeed. The mail server responded: Invalid 
>>mask."
>>    
>>
>
>Mozilla is probably remembering some old settings from uw-imapd. I'm not
>sure what exactly, since they should have pretty similiar settings.
>Maybe anyway related to handling ~/mail or namespaces in general.
>
>That error happens anyway if client tries to use absolute file paths
>(/path, \path, ~/path/) or tries to use ../ or ..\ in the path. '\'
>checking isn't actually really needed, but I thought I might as well
>prepare for future VMS/Windows port :)
>
>Instead of giving the error, I could also just make Dovecot ignore that.
>I'm not sure if it'd be better..
>  
>


--------------070506070803030608090705
Content-Transfer-Encoding: 7bit
Content-Type: text/html; charset=us-ascii

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=ISO-8859-1">
  <title></title>
</head>
<body>
Yes, that was the problem... tried an old version of netscape and
everything was ok. <br>
<br>
I eventually found where the problems was in mozilla and thought I
would post the solution if anyone else was experiencing the same
trouble.<br>
<br>
I started looking around in the mozilla mail settings and found under
the [ edit - maiil and newsgroup account settings - (appropriate
account) - server settings ] there is a line at the bottom labled
"local directory" where it specifies the location it keeps all the
settings in.&nbsp; I deleted all the files in that directory and the
problems went away.<br>
<br>
Thanks, <br>
Brandon.<br>
<br>
Timo Sirainen wrote:<br>
<blockquote type="cite" cite="mid1053023602.23300.253.camel@hurina">
  <pre wrap="">On Thu, 2003-05-15 at 21:26, Brandon Hoult wrote:
  </pre>
  <blockquote type="cite">
    <pre wrap="">Am tryin to move from uw-imapd to dovecot, using dovecot ver 0.99.9.1-1 
on debian.  Using Mozilla Mail v 1.3 currently using mbox format.

I made some test accounts and they seem to be working fine, but my older 
existing accounts give error messages whenever I connect or subscribe to 
  mailboxes within them.  The message that appears on the client is:

"The current command did not succeed. The mail server responded: Invalid 
mask."
    </pre>
  </blockquote>
  <pre wrap=""><!---->
Mozilla is probably remembering some old settings from uw-imapd. I'm not
sure what exactly, since they should have pretty similiar settings.
Maybe anyway related to handling ~/mail or namespaces in general.

That error happens anyway if client tries to use absolute file paths
(/path, \path, ~/path/) or tries to use ../ or ..\ in the path. '\'
checking isn't actually really needed, but I thought I might as well
prepare for future VMS/Windows port :)

Instead of giving the error, I could also just make Dovecot ignore that.
I'm not sure if it'd be better..
  </pre>
</blockquote>
<br>
</body>
</html>

--------------070506070803030608090705--


--=-IsnW+ZNhrqJ6wjmRliAO--

--=-IsnW+ZNhrqJ6wjmRliAO--
From dgc@uchicago.edu  Fri May 16 22:13:44 2003
Return-Path: <dgc@uchicago.edu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 3A9B7239F0; Fri, 16 May 2003 22:13:44 +0300 (EEST)
Received: from dust.uchicago.edu (dust.uchicago.edu [128.135.0.35])
	by danu.procontrol.fi (Postfix) with ESMTP id 110B52399F
	for <dovecot@procontrol.fi>; Fri, 16 May 2003 22:13:39 +0300 (EEST)
Received: (from dgc@localhost)
	by dust.uchicago.edu (8.11.6/8.11.6) id h4GJDZd00243;
	Fri, 16 May 2003 14:13:35 -0500 (CDT)
X-Authentication-Warning: dust.uchicago.edu: dgc set sender to
	dgc@uchicago.edu using -f
Date: Fri, 16 May 2003 14:13:35 -0500
From: David Champion <dgc@uchicago.edu>
To: Joakim Ryden <jryden@thebox.our-own.net>
Subject: Re: [Dovecot] DRAC support?
Message-ID: <20030516191335.GA196@dust.uchicago.edu>
Mail-Followup-To: Joakim Ryden <jryden@thebox.our-own.net>,
	dovecot@procontrol.fi
References: <20030514085227.GA7325@lazy.spodder.com>
	<20030515011306.GA3731@lazy.spodder.com>
	<20030515043029.GA18617@lazy.spodder.com>
	<200305142137.11186.jryden@thebox.our-own.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <200305142137.11186.jryden@thebox.our-own.net>
User-Agent: Mutt/1.5.2i
X-Spam-Status: No, hits=-27.5 required=5.0
	tests=IN_REP_TO,QUOTED_EMAIL_TEXT,REFERENCES,REPLY_WITH_QUOTES,
	      USER_AGENT_MUTT,X_AUTH_WARNING
	autolearn=ham	version=2.50
X-Spam-Level: 
X-Spam-Checker-Version: SpamAssassin 2.50 (1.173-2003-02-20-exp)
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 16 May 2003 19:13:44 -0000
X-UID: 753                                                  
Status: O

* On 2003.05.14, in <200305142137.11186.jryden@thebox.our-own.net>,
*	"Joakim Ryden" <jryden@thebox.our-own.net> wrote:
> 
> DRAC, pop-before-smtp and other such implementations really is a "broken" way 
> of implementing the desired result, IMHO, and I would much prefer this code 
> stays out of dovecot. You should be using SMTP auth. Really.

I agree that it's not as good an answer as SMTP auth, but SMTP auth
isn't always an option. *-before-SMTP is. That's why it's popular,
and that's why it will exist for dovecot whether Timo puts it in the
distribution or not. It just makes things easier if he does.

-- 
 -D.    dgc@uchicago.edu        NSIT    University of Chicago
      When using any driving directions or map, it's a good idea to do a
      reality check and make sure the road still exists, watch out for
      construction, and follow all traffic safety precautions.
From charlie@rubberduck.com  Sat May 17 09:30:53 2003
Return-Path: <charlie@rubberduck.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 38DB12399F; Sat, 17 May 2003 09:30:53 +0300 (EEST)
Received: from lazy.spodder.com (unknown [203.18.242.30])
	by danu.procontrol.fi (Postfix) with ESMTP id AF07F2387F
	for <dovecot@procontrol.fi>; Sat, 17 May 2003 09:30:49 +0300 (EEST)
Received: by lazy.spodder.com (Postfix, from userid 501)
	id 7F2B09007; Sat, 17 May 2003 16:31:25 +1000 (EST)
Date: Sat, 17 May 2003 16:31:25 +1000
From: Charlie Allom <charlie@rubberduck.com>
To: Joakim Ryden <jryden@thebox.our-own.net>, dovecot@procontrol.fi
Subject: Re: [Dovecot] DRAC support?
Message-ID: <20030517063125.GA23270@lazy.spodder.com>
References: <20030514085227.GA7325@lazy.spodder.com>
	<20030515011306.GA3731@lazy.spodder.com>
	<20030515043029.GA18617@lazy.spodder.com>
	<200305142137.11186.jryden@thebox.our-own.net>
	<20030516191335.GA196@dust.uchicago.edu>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20030516191335.GA196@dust.uchicago.edu>
User-Agent: Mutt/1.5.4i
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Sat, 17 May 2003 06:30:53 -0000
X-UID: 754                                                  
Status: O
Content-Length: 1269

On Fri, May 16, 2003 at 02:13:35PM -0500, David Champion wrote:
> * On 2003.05.14, in <200305142137.11186.jryden@thebox.our-own.net>,
> *	"Joakim Ryden" <jryden@thebox.our-own.net> wrote:
> > 
> > DRAC, pop-before-smtp and other such implementations really is a "broken" way 
> > of implementing the desired result, IMHO, and I would much prefer this code 
> > stays out of dovecot. You should be using SMTP auth. Really.
> 
> I agree that it's not as good an answer as SMTP auth, but SMTP auth
> isn't always an option. *-before-SMTP is. That's why it's popular,
> and that's why it will exist for dovecot whether Timo puts it in the
> distribution or not. It just makes things easier if he does.

On this note,

has anyone else tried this patch ? with Timo's modifications to his
original patch I got it updating the DRAC db, but only able to use the
local interfaces.

I'm not sure dovecot is structured, but maybe the patch should be in
the auth parts of the code?

don't shoot me :) Just seeing if someone else is interested in DRAC
atm with dovecot.

  C.
-- 
 charlie@rubberduck.com - Melbourne, Australia
 http://rubberduck.com/~yeled/
 PGP: 0x14AA7941 || finger yeled@lazy.spodder.com
 > http://groups.google.com/groups?selm=3266D499.342E%40student.uq.edu.au <
From warren@togami.com  Sat May 17 11:34:09 2003
Return-Path: <warren@togami.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 182E12387F; Sat, 17 May 2003 11:34:09 +0300 (EEST)
Received: from pan.mplug.org (unknown [66.139.75.105])
	by danu.procontrol.fi (Postfix) with ESMTP id 6984A2387A
	for <dovecot@procontrol.fi>; Sat, 17 May 2003 11:34:06 +0300 (EEST)
Received: from localhost.127.in-addr.arpa (unknown [127.0.0.1])
	by pan.mplug.org (Postfix) with ESMTP id CB1035D805F
	for <dovecot@procontrol.fi>; Fri, 16 May 2003 22:37:10 -1000 (HST)
From: Warren Togami <warren@togami.com>
To: dovecot@procontrol.fi
Content-Type: text/plain
Message-Id: <1053160434.8705.58.camel@laptop>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.3.3 (1.3.3-2) (Preview Release)
Date: 16 May 2003 22:33:55 -1000
Content-Transfer-Encoding: 7bit
X-Spam-Status: No, hits=-2.4 required=5.0
	tests=USER_AGENT_XIMIAN
	autolearn=ham version=2.54
X-Spam-Level: 
X-Spam-Checker-Version: SpamAssassin 2.54 (1.174.2.17-2003-05-11-exp)
Subject: [Dovecot] Postfix locking equivalence?
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Sat, 17 May 2003 08:34:09 -0000
X-UID: 755                                                  
Status: O

/etc/postfix/main.cf.default:
mailbox_delivery_lock = flock, dotlock

Is flock equivalent to dovecot's fnctl locking?  For mbox what type of
locking settings should I be using?  (No NFS, only local filesystem.)

Warren Togami
warren@togami.com


From tss@iki.fi  Sat May 17 12:59:08 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 5BE3E2387F; Sat, 17 May 2003 12:59:08 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id F205C23845
	for <dovecot@procontrol.fi>; Sat, 17 May 2003 12:59:06 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id C783E5C896C6; Sat, 17 May 2003 12:59:06 +0300 (EEST)
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1053165546.1212.57.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 17 May 2003 12:59:06 +0300
Subject: [Dovecot] test
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Sat, 17 May 2003 09:59:08 -0000
X-UID: 756                                                  
Status: O

..is this thing working.. I messed up a bit when adding spamassassin to
postfix filter.

From warren@togami.com  Sat May 17 13:04:04 2003
Return-Path: <warren@togami.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 01F83239FE; Sat, 17 May 2003 13:04:03 +0300 (EEST)
Received: from pan.mplug.org (unknown [66.139.75.105])
	by danu.procontrol.fi (Postfix) with ESMTP id A4AFF2387F
	for <dovecot@procontrol.fi>; Sat, 17 May 2003 13:03:58 +0300 (EEST)
Received: from localhost.127.in-addr.arpa (unknown [127.0.0.1])
	by pan.mplug.org (Postfix) with ESMTP id C46015D805F
	for <dovecot@procontrol.fi>; Sat, 17 May 2003 00:07:11 -1000 (HST)
From: Warren Togami <warren@togami.com>
To: dovecot@procontrol.fi
Content-Type: text/plain
Message-Id: <1053165834.8705.76.camel@laptop>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.3.3 (1.3.3-2) (Preview Release)
Date: 17 May 2003 00:03:55 -1000
Content-Transfer-Encoding: 7bit
Subject: [Dovecot] Postfix locking equivalence?
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Sat, 17 May 2003 10:04:04 -0000
X-UID: 757                                                  
Status: O

/etc/postfix/main.cf.default:
mailbox_delivery_lock = flock, dotlock

Is flock equivalent to dovecot's fnctl locking?  For mbox what type of
locking settings should I be using?  (No NFS, only local filesystem.)

I'm using procmail to deliver mail to my mboxes.  Does the above postfix
setting effect procmail's locking method?  I use rules like this:

:0
* ^X-BeenThere: dovecot@procontrol.fi
DOVECOT

If I understand this correctly, :0: in procmailrc would explicitly use
dotlocks instead of "kernel-locks" as procmail calls it.  I'm not fully
understanding all this locking stuff.

Warren Togami
warren@togami.com

p.s.
Timo, I received your test message after my prior posting attempt
bounced.  I had this error message:

Reporting-MTA: dns; danu.procontrol.fi
Arrival-Date: Sat, 17 May 2003 12:52:08 +0300 (EEST)

Final-Recipient: rfc822; dovecot@procontrol.fi
Action: failed
Status: 5.0.0
Diagnostic-Code: X-Postfix; mail forwarding loop for
dovecot@procontrol.fi

From tss@iki.fi  Sat May 17 13:23:48 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 93696239FE; Sat, 17 May 2003 13:23:48 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id F12A62387A
	for <dovecot@procontrol.fi>; Sat, 17 May 2003 13:23:46 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id B66C15C896C6; Sat, 17 May 2003 13:23:46 +0300 (EEST)
Subject: Re: [Dovecot] Postfix locking equivalence?
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <1053165834.8705.76.camel@laptop>
References: <1053165834.8705.76.camel@laptop>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1053167026.1218.76.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 17 May 2003 13:23:46 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Sat, 17 May 2003 10:23:48 -0000
X-UID: 758                                                  
Status: O
Content-Length: 1654

On Sat, 2003-05-17 at 13:03, Warren Togami wrote:
> /etc/postfix/main.cf.default:
> mailbox_delivery_lock = flock, dotlock
> 
> Is flock equivalent to dovecot's fnctl locking?  For mbox what type of
> locking settings should I be using?  (No NFS, only local filesystem.)

Well.. flock isn't the same as fcntl. Dovecot supports flock too, so you
could set Dovecot to use that too.

Dotlock can do only exclusive mbox locking, ie. no-one else should
read/write the mbox at the time. It's the oldest locking method and
pretty much everyone uses at least that. If mail is only being appened
to mbox, it's enough alone (if everyone else uses dotlocking too).

fcntl and flock can do both exclusive and shared locks. That provides
read consistency when mails are being deleted from the middle of the
mailbox. Whenever you want to read mbox, you get a shared lock so no-one
can modify it while you're reading it, but that still allows others to
read the mbox at the same time.

It doesn't really matter if you use flock or fcntl, as long as everyone
uses the same. I think flock is more generally in client's defaults, but
I used fcntl because it's more standard and might work over NFS.

> If I understand this correctly, :0: in procmailrc would explicitly use
> dotlocks instead of "kernel-locks" as procmail calls it.  I'm not fully
> understanding all this locking stuff.

I don't know much about procmail, but if it does dotlocking it's enough.

> p.s.
> Timo, I received your test message after my prior posting attempt
> bounced.  I had this error message:

Yeah, sorry. The mail got into archives and I tried to resend it, but it
didn't seem to work :)

From jaldhar@debian.org  Sat May 17 18:25:04 2003
Return-Path: <jaldhar@debian.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 3B7DD238D2; Sat, 17 May 2003 18:25:04 +0300 (EEST)
Received: from mail.braincells.com (samadhi.braincells.com [216.162.42.100])
	by danu.procontrol.fi (Postfix) with ESMTP id 3DFF72387F
	for <dovecot@procontrol.fi>; Sat, 17 May 2003 18:25:01 +0300 (EEST)
Received: from localhost (localhost [127.0.0.1])
	by mail.braincells.com (Postfix) with ESMTP
	id 20C717FE7; Sat, 17 May 2003 11:25:00 -0400 (EDT)
Date: Sat, 17 May 2003 11:24:59 -0400 (EDT)
From: "Jaldhar H. Vyas" <jaldhar@debian.org>
X-X-Sender: jaldhar@samadhi.braincells.com
To: Ruud de Jong <ruud@duticg.twi.tudelft.nl>
Subject: Re: [Dovecot] ssl still not working
In-Reply-To: <20030516072748.GA28822@dutids.twi.tudelft.nl>
Message-ID: <Pine.LNX.4.55.0305171122570.23292@samadhi.braincells.com>
References: <3EC3790D.2090602@bnap.hu>
	<20030516072748.GA28822@dutids.twi.tudelft.nl>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
Reply-To: "Jaldhar H. Vyas" <jaldhar@debian.org>
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Sat, 17 May 2003 15:25:04 -0000
X-UID: 759                                                  
Status: O

On Fri, 16 May 2003, Ruud de Jong wrote:

> Hi,
>
> I'm running a stable debian version and had the same problem after
> installing the debian package.
> When I downloaded the latest version of openssl (openssl-0.9.7b), compiled
> dovecot and linked it with this openssl version the problem was solved.
>

Yeah I've been noticing that.  The Debian package is compiled with gnutls
which appears to be somewhat broken (at least on stable.)  I'm going to do
a new version today compiled against openssl.


-- 
Jaldhar H. Vyas <jaldhar@debian.org>
La Salle Debain - http://www.braincells.com/debian/
From tss@iki.fi  Sat May 17 20:46:15 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 2003D238C5; Sat, 17 May 2003 20:46:15 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 2A35C2387F
	for <dovecot@procontrol.fi>; Sat, 17 May 2003 20:46:13 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 5C9F75C896C6; Sat, 17 May 2003 20:46:11 +0300 (EEST)
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1053193571.1214.86.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 17 May 2003 20:46:11 +0300
Subject: [Dovecot] Maildir synchronization
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Sat, 17 May 2003 17:46:15 -0000
X-UID: 760                                                  
Status: O
Content-Length: 6770

I thought I'd send this here too, since I spent so much time writing it
as comment to maildir-sync.c :) Now only thing left to do is to write
the code to match it.

/*
   Here's a description of how we handle Maildir synchronization and
   it's problems:

   We want to be as efficient as we can. The most efficient way to
   check if changes have occured is to stat() the new/ and cur/
   directories and uidlist file - if their mtimes hasn't changed,
   there's no changes and we don't need to do anything.

   Problem 1: Multiple changes can happen within a single second -
   nothing guarantees that once we synced it, someone else didn't just
   then make a modification. Such modifications wouldn't get noticed
   until a new modification occured later.

   Problem 2: Syncing cur/ directory is much more costly than syncing
   new/. Moving mails from new/ to cur/ will always change mtime of
   cur/ causing us to sync it as well.

   Problem 3: We may not be able to move mail from new/ to cur/
   because we're out of quota, or simply because we're accessing a
   read-only mailbox.


   MAILDIR_SYNC_SECS
   -----------------

   Several checks below use MAILDIR_SYNC_SECS, which should be maximum
   clock drift between all computers accessing the maildir (eg. via
   NFS), rounded up to next second. Our default is 1 second, since
   everyone should be using NTP.

   Note that setting it to 0 works only if there's only one computer
   accessing the maildir. It's practically impossible to make two
   clocks _exactly_ synchronized.

   cur directory
   -------------

   We have maildir_cur_dirty variable which is set to cur/ directory's
   mtime when it's >= time() - MAILDIR_SYNC_SECS and we _think_ we have
   synchronized the directory.

   When maildir_cur_dirty is non-zero, we don't synchronize the cur/
   directory until

      a) cur/'s mtime changes
      b) opening a mail fails with ENOENT
      c) time() > maildir_cur_dirty + MAILDIR_SYNC_SECS

   This allows us to modify the maildir multiple times without having
   to sync it at every change. The sync will eventually be done to
   make sure we didn't miss any external changes.

   The maildir_cur_dirty is set when:

      - we change message flags
      - we expunge messages
      - we move mail from new/ to cur/
      - we sync cur/ directory and it's mtime is
        >= time() - MAILDIR_SYNC_SECS

   It's unset when we do the final syncing, ie. when mtime is
   older than time() - MAILDIR_SYNC_SECS.

   new directory
   -------------

   If new/'s mtime is >= time() - MAILDIR_SYNC_SECS, always synchronize
   it. maildir_cur_dirty-like feature might save us a few syncs, but
   that might break a client which saves a mail in one connection and
   tries to fetch it in another one. new/ directory is almost always
   empty, so syncing it should be very fast anyway.

   Normally we move all mails from new/ to cur/ whenever we sync it. If
   it's not possible for some reason, we set maildir_have_new flag on
   which instructs synchronization to check files in new/ directory as
   well. maildir_keep_new flag is also set which instructs syncing to
   not even try to move mails to cur/ anymore.

   If client tries to change a flag for message in new/, we try to
   rename() it into cur/. If it's successful, we clear the
   maildir_keep_new flag so at next sync we'll try to move all of them
   to cur/. When all of them have been moved, maildir_have_new flag is
   cleared as well. Expunges will also clear maildir_keep_new flag.

   If rename() still fails because of ENOSPC or EDQUOT, we still save
   the flag changes in index with dirty-flag on. When moving the mail
   to cur/ directory, or when we notice it's already moved there, we
   apply the flag changes to the filename, rename it and remove the
   dirty flag. If there's dirty flags, this should be tried every time
   after expunge or when closing the mailbox.

   broken clients
   --------------

   Originally the middle identifier in Maildir filename was specified
   only as <process id>_<delivery counter>. That however created a
   problem with randomized PIDs which made it possible that the same
   PID was reused within one second.

   So if within one second a mail was delivered, MUA moved it to cur/
   and another mail was delivered by a new process using same PID as
   the first one, we likely ended up overwriting the first mail when
   the second mail was moved over it.

   Nowadays everyone should be giving a bit more specific identifier,
   for example include microseconds in it which Dovecot does.

   There's a simple way to prevent this from happening in some cases:
   Don't move the mail from new/ to cur/ if it's mtime is >= time() -
   MAILDIR_SYNC_SECS. The second delivery's link() call then fails
   because the file is already in new/, and it will then use a
   different filename. There's a few problems with this however:

      - it requires extra stat() call which is unneeded extra I/O
      - another MUA might still move the mail to cur/
      - if first file's flags are modified by either Dovecot or another
        MUA, it's moved to cur/ (you _could_ just do the dirty-flagging
	but that'd be ugly)

   Because this is useful only for very few people and it requires
   extra I/O, I decided not to implement this. It should be however
   quite easy to do since we need to be able to deal with files in new/
   in any case.

   It's also possible to never accidentally overwrite a mail by using
   link() + unlink() rather than rename(). This however isn't very
   good idea as it introduces potential race conditions when multiple
   clients are accessing the mailbox:

   Trying to move the same mail from new/ to cur/ at the same time:

      a) Client 1 uses slightly different filename than client 2,
         for example one sets read-flag on but the other doesn't.
	 You have the same mail duplicated now.

      b) Client 3 sees the mail between Client 1's and 2's link() calls
         and changes it's flag. You have the same mail duplicated now.

   And it gets worse when they're unlink()ing in cur/ directory:

      c) Client 1 changes mails's flag and client 2 changes it back
         between 1's link() and unlink(). The mail is now expunged.

      d) If you try to deal with the duplicates by unlink()ing another
         one of them, you might end up unlinking both of them.

   So, what should we do then if we notice a duplicate? First of all,
   it might not be a duplicate at all, readdir() might have just
   returned it twice because it was just renamed. What we should do is
   create a completely new base name for it and rename() it to that.
   If the call fails with ENOENT, it only means that it wasn't a
   duplicate after all.
*/

From tss@iki.fi  Sun May 18 16:09:41 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 1524D23996; Sun, 18 May 2003 16:09:41 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 848BB238D4
	for <dovecot@procontrol.fi>; Sun, 18 May 2003 16:09:38 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 4B9615C896C6; Sun, 18 May 2003 16:09:38 +0300 (EEST)
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1053263378.1214.151.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 18 May 2003 16:09:38 +0300
Subject: [Dovecot] 0.99.10-test1
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Sun, 18 May 2003 13:09:41 -0000
X-UID: 761                                                  
Status: O
Content-Length: 1095

http://dovecot.procontrol.fi/test/

Maildir syncing now works pretty much as described in my earlier mail.
It was quite a large change, so please test this :)

So the new and great features:

- It's faster.

- If someone renames maildir file just before we try to use it, we now
resync the maildir and try to find it again. Before we just failed. It's
also possible that the filename changed again while we resynced, so we
try max. 10 times before failing (yes, we know if we should try
resyncing so we don't always scan it 10 times).

- Read-only maildirs work now. If we don't have write access to
dovecot-uidlist, we'll show only those mails which are already there.

- Out of quota/disk space failures are handled well now. All except
updating dovecot-uidlist file which is a bit tricky.

- :CONTROL=dir in default_mail_env can specify where to save
dovecot-uidlist and .customflags files. Useful for above problems.

I think maildir support is getting near perfect now. Only thing left is
to deal with failure to write dovecot-uidlist when out of quota. Oh, and
NFS safe .customflags file.

From tss@iki.fi  Sun May 18 20:07:15 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 75C4E2387F; Sun, 18 May 2003 20:07:15 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id E3D3A2387A
	for <dovecot@procontrol.fi>; Sun, 18 May 2003 20:07:12 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id A7F1B5C896C6; Sun, 18 May 2003 20:07:12 +0300 (EEST)
Subject: Re: [Dovecot] DRAC support?
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030517063125.GA23270@lazy.spodder.com>
References: <20030514085227.GA7325@lazy.spodder.com>
	 <20030515011306.GA3731@lazy.spodder.com>
	 <20030515043029.GA18617@lazy.spodder.com>
	 <200305142137.11186.jryden@thebox.our-own.net>
	 <20030516191335.GA196@dust.uchicago.edu>
	 <20030517063125.GA23270@lazy.spodder.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1053277632.1215.154.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 18 May 2003 20:07:12 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Sun, 18 May 2003 17:07:15 -0000
X-UID: 762                                                  
Status: O

On Sat, 2003-05-17 at 09:31, Charlie Allom wrote:
> has anyone else tried this patch ? with Timo's modifications to his
> original patch I got it updating the DRAC db, but only able to use the
> local interfaces.

Install Dovecot 0.99.10-test2 and
http://dovecot.procontrol.fi/patches/drac-imap.c

Set "imap_use_modules = yes" in config file and that should hopefully do
it.

From tss@iki.fi  Sun May 18 20:11:19 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 4A4C22387F; Sun, 18 May 2003 20:11:19 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id D8DEC2387A
	for <dovecot@procontrol.fi>; Sun, 18 May 2003 20:11:17 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id A94945C896C6; Sun, 18 May 2003 20:11:17 +0300 (EEST)
Subject: Re: [Dovecot] DRAC support?
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <1053277632.1215.154.camel@hurina>
References: <20030514085227.GA7325@lazy.spodder.com>
	 <20030515011306.GA3731@lazy.spodder.com>
	 <20030515043029.GA18617@lazy.spodder.com>
	 <200305142137.11186.jryden@thebox.our-own.net>
	 <20030516191335.GA196@dust.uchicago.edu>
	 <20030517063125.GA23270@lazy.spodder.com>
	 <1053277632.1215.154.camel@hurina>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1053277877.1212.157.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 18 May 2003 20:11:17 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Sun, 18 May 2003 17:11:19 -0000
X-UID: 763                                                  
Status: O

On Sun, 2003-05-18 at 20:07, Timo Sirainen wrote:
> http://dovecot.procontrol.fi/patches/drac-imap.c

Actually :) This has nothing IMAP-specific. The same thing works for
both IMAP and POP3 servers. Changed the filename to drac.c

From charlie@rubberduck.com  Mon May 19 04:48:03 2003
Return-Path: <charlie@rubberduck.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id A97C123993; Mon, 19 May 2003 04:48:03 +0300 (EEST)
Received: from lazy.spodder.com (lazy.spodder.com [203.18.242.30])
	by danu.procontrol.fi (Postfix) with ESMTP id C6302238D6
	for <dovecot@procontrol.fi>; Mon, 19 May 2003 04:47:59 +0300 (EEST)
Received: by lazy.spodder.com (Postfix, from userid 501)
	id 233B29006; Mon, 19 May 2003 11:48:49 +1000 (EST)
Date: Mon, 19 May 2003 11:48:49 +1000
From: Charlie Allom <charlie@rubberduck.com>
To: Timo Sirainen <tss@iki.fi>
Subject: Re: [Dovecot] DRAC support?
Message-ID: <20030519014849.GJ23270@lazy.spodder.com>
References: <20030514085227.GA7325@lazy.spodder.com>
	<20030515011306.GA3731@lazy.spodder.com>
	<20030515043029.GA18617@lazy.spodder.com>
	<200305142137.11186.jryden@thebox.our-own.net>
	<20030516191335.GA196@dust.uchicago.edu>
	<20030517063125.GA23270@lazy.spodder.com> <1053277632.1215.154.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1053277632.1215.154.camel@hurina>
User-Agent: Mutt/1.5.4i
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 19 May 2003 01:48:03 -0000
X-UID: 764                                                  
Status: O
Content-Length: 1625

On Sun, May 18, 2003 at 08:07:12PM +0300, Timo Sirainen wrote:
> On Sat, 2003-05-17 at 09:31, Charlie Allom wrote:
> > has anyone else tried this patch ? with Timo's modifications to his
> > original patch I got it updating the DRAC db, but only able to use the
> > local interfaces.
> 
> Install Dovecot 0.99.10-test2 and
> http://dovecot.procontrol.fi/patches/drac-imap.c

The instructions specify:

	gcc -Wall -W -shared -fPIC -DHAVE_CONFIG_H -I$dovecot -I$dovecot/src/lib \
	drac.c -o drac.so -ldrac

and the C defines common.h - which one?  "-I$dovecot/src/master" ?

11:19 root@lazy:/usr/src/dovecot# find . -name common.h
./src/auth/common.h
./src/imap/common.h
./src/imap-login/common.h
./src/login-common/common.h
./src/master/common.h
./src/pop3/common.h
./src/pop3-login/common.h

11:29 root@lazy:/usr/src/dovecot# export dovecot=/usr/src/dovecot/
11:46 root@lazy:/usr/src/dovecot# gcc -Wall -W -shared -fPIC -DHAVE_CONFIG_H -I$dovecot -I$dovecot/src/lib -I$dovecot/src/master drac.c -o drac.so -ldrac
In file included from /usr/src/dovecot/src/master/common.h:6,
                 from drac.c:14:
/usr/src/dovecot/src/lib/lib.h:6: ../../config.h: No such file or directory
In file included from /usr/src/dovecot/src/lib/lib.h:20,
                 from /usr/src/dovecot/src/master/common.h:6,
                 from drac.c:14:
/usr/src/dovecot/src/lib/compat.h:17: #error uoff_t size not set


Regards,
  C.

-- 
 charlie@rubberduck.com - Melbourne, Australia
 http://rubberduck.com/~yeled/
 PGP: 0x14AA7941 || finger yeled@lazy.spodder.com
 > http://groups.google.com/groups?selm=3266D499.342E%40student.uq.edu.au <
From maikel@ladot.com  Mon May 19 09:18:37 2003
Return-Path: <maikel@ladot.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id E8867238E1; Mon, 19 May 2003 09:18:37 +0300 (EEST)
Received: from zeus.ladot.com (office.ladot.com [217.22.64.134])
	by danu.procontrol.fi (Postfix) with ESMTP id 3087B238D6
	for <dovecot@procontrol.fi>; Mon, 19 May 2003 09:18:34 +0300 (EEST)
Received: from nlladot05.freehosting (nlladot05.intern.ladot.com
	[172.31.2.13])
	by zeus.ladot.com (8.12.9/8.12.9) with ESMTP id h4J6UJVg060226;
	Mon, 19 May 2003 08:30:19 +0200 (CEST)
	(envelope-from maikel@ladot.com)
Received: by nlladot05.intern.ladot.com with Internet Mail Service
	(5.5.2653.19)	id <JMLTK3DL>; Mon, 19 May 2003 08:02:13 +0200
Message-ID: <410777FC7A66D511911500B0D078345501F2233A@nlladot05.intern.ladot.com>
From: Maikel Verheijen <maikel@ladot.com>
To: "'Timo Sirainen'" <tss@iki.fi>,
	"'dovecot@procontrol.fi'" <dovecot@procontrol.fi>
Subject: RE: [Dovecot] 0.99.10-test1
Date: Mon, 19 May 2003 08:02:12 +0200
MIME-Version: 1.0
X-Mailer: Internet Mail Service (5.5.2653.19)
Content-Type: multipart/alternative;
	boundary="----_=_NextPart_001_01C31DCC.309FAA90"
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 19 May 2003 06:18:38 -0000
X-UID: 765                                                  
Status: O
Content-Length: 1409

This message is in MIME format. Since your mail reader does not understand
this format, some or all of this message may not be legible.

------_=_NextPart_001_01C31DCC.309FAA90
Content-Type: text/plain

Hi Timo,

> I think maildir support is getting near perfect now. Only 
> thing left is to deal with failure to write dovecot-uidlist 
> when out of quota. Oh, and NFS safe .customflags file.

Does this mean you made the .subscriptions nfs-safe already in this version?


Kind regards,


Maikel Verheijen.

------_=_NextPart_001_01C31DCC.309FAA90
Content-Type: text/html

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="Generator" CONTENT="MS Exchange Server version 5.5.2653.12">
<TITLE>RE: [Dovecot] 0.99.10-test1</TITLE>
</HEAD>
<BODY>

<P><FONT SIZE=2>Hi Timo,</FONT>
</P>

<P><FONT SIZE=2>&gt; I think maildir support is getting near perfect now. Only </FONT>
<BR><FONT SIZE=2>&gt; thing left is to deal with failure to write dovecot-uidlist </FONT>
<BR><FONT SIZE=2>&gt; when out of quota. Oh, and NFS safe .customflags file.</FONT>
</P>

<P><FONT SIZE=2>Does this mean you made the .subscriptions nfs-safe already in this version?</FONT>
</P>
<BR>

<P><FONT SIZE=2>Kind regards,</FONT>
</P>
<BR>

<P><FONT SIZE=2>Maikel Verheijen.</FONT>
</P>

</BODY>
</HTML>
------_=_NextPart_001_01C31DCC.309FAA90--
From tss@iki.fi  Mon May 19 09:27:38 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id E877D23994; Mon, 19 May 2003 09:27:38 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 63615238E1
	for <dovecot@procontrol.fi>; Mon, 19 May 2003 09:27:37 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 1E6335C896C6; Mon, 19 May 2003 09:27:37 +0300 (EEST)
Subject: Re: [Dovecot] DRAC support?
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030519014849.GJ23270@lazy.spodder.com>
References: <20030514085227.GA7325@lazy.spodder.com>
	 <20030515011306.GA3731@lazy.spodder.com>
	 <20030515043029.GA18617@lazy.spodder.com>
	 <200305142137.11186.jryden@thebox.our-own.net>
	 <20030516191335.GA196@dust.uchicago.edu>
	 <20030517063125.GA23270@lazy.spodder.com>
	 <1053277632.1215.154.camel@hurina>
	 <20030519014849.GJ23270@lazy.spodder.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1053325656.1218.162.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 19 May 2003 09:27:36 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 19 May 2003 06:27:39 -0000
X-UID: 766                                                  
Status: O

On Mon, 2003-05-19 at 04:48, Charlie Allom wrote:
> The instructions specify:
> 
> 	gcc -Wall -W -shared -fPIC -DHAVE_CONFIG_H -I$dovecot -I$dovecot/src/lib \
> 	drac.c -o drac.so -ldrac
> 
> and the C defines common.h - which one?  "-I$dovecot/src/master" ?

Oh, change it to lib.h instead.

From tss@iki.fi  Mon May 19 09:28:44 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 02370239AF; Mon, 19 May 2003 09:28:44 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id D305423994
	for <dovecot@procontrol.fi>; Mon, 19 May 2003 09:28:39 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id B29E95C896C6; Mon, 19 May 2003 09:28:39 +0300 (EEST)
Subject: RE: [Dovecot] 0.99.10-test1
From: Timo Sirainen <tss@iki.fi>
To: "'dovecot@procontrol.fi'" <dovecot@procontrol.fi>
In-Reply-To: <410777FC7A66D511911500B0D078345501F2233A@nlladot05.intern.ladot.com>
References: 
	 <410777FC7A66D511911500B0D078345501F2233A@nlladot05.intern.ladot.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1053325719.1215.164.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 19 May 2003 09:28:39 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 19 May 2003 06:28:44 -0000
X-UID: 767                                                  
Status: O

On Mon, 2003-05-19 at 09:02, Maikel Verheijen wrote:
> Hi Timo,
> 
> > I think maildir support is getting near perfect now. Only 
> > thing left is to deal with failure to write dovecot-uidlist 
> > when out of quota. Oh, and NFS safe .customflags file.
> 
> Does this mean you made the .subscriptions nfs-safe already in this
> version?

Well, no, but that's not maildir-specific code :)

From charlie@rubberduck.com  Mon May 19 09:47:54 2003
Return-Path: <charlie@rubberduck.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 044E3239B2; Mon, 19 May 2003 09:47:54 +0300 (EEST)
Received: from lazy.spodder.com (lazy.spodder.com [203.18.242.30])
	by danu.procontrol.fi (Postfix) with ESMTP id 05BD9239AF
	for <dovecot@procontrol.fi>; Mon, 19 May 2003 09:47:50 +0300 (EEST)
Received: by lazy.spodder.com (Postfix, from userid 501)
	id B8EFD900B; Mon, 19 May 2003 16:48:40 +1000 (EST)
Date: Mon, 19 May 2003 16:48:40 +1000
From: Charlie Allom <charlie@rubberduck.com>
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] DRAC support?
Message-ID: <20030519064840.GB1644@lazy.spodder.com>
References: <20030514085227.GA7325@lazy.spodder.com>
	<20030515011306.GA3731@lazy.spodder.com>
	<20030515043029.GA18617@lazy.spodder.com>
	<200305142137.11186.jryden@thebox.our-own.net>
	<20030516191335.GA196@dust.uchicago.edu>
	<20030517063125.GA23270@lazy.spodder.com> <1053277632.1215.154.camel@hurina>
	<20030519014849.GJ23270@lazy.spodder.com> <1053325656.1218.162.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1053325656.1218.162.camel@hurina>
User-Agent: Mutt/1.5.4i
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 19 May 2003 06:47:54 -0000
X-UID: 768                                                  
Status: O

On Mon, May 19, 2003 at 09:27:36AM +0300, Timo Sirainen wrote:
> On Mon, 2003-05-19 at 04:48, Charlie Allom wrote:
> > The instructions specify:
> > 
> > 	gcc -Wall -W -shared -fPIC -DHAVE_CONFIG_H -I$dovecot -I$dovecot/src/lib \
> > 	drac.c -o drac.so -ldrac
> > 
> > and the C defines common.h - which one?  "-I$dovecot/src/master" ?
> 
> Oh, change it to lib.h instead.
> 

Done, and:

16:46 yeled@lazy:/usr/src/dovecot$ gcc -Wall -W -shared -fPIC -DHAVE_CONFIG_H -I$dovecot -I$dovecot/src/lib drac.c -o drac.so -ldrac
In file included from drac.c:14:
/usr/src/dovecot/src/lib/lib.h:6: ../../config.h: No such file or directory
In file included from /usr/src/dovecot/src/lib/lib.h:20,
                 from drac.c:14:
/usr/src/dovecot/src/lib/compat.h:17: #error uoff_t size not set

um..

  C.
-- 
 charlie@rubberduck.com - Melbourne, Australia
 http://rubberduck.com/~yeled/
 PGP: 0x14AA7941 || finger yeled@lazy.spodder.com
 > http://groups.google.com/groups?selm=3266D499.342E%40student.uq.edu.au <
From tss@iki.fi  Mon May 19 10:07:44 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id C4B6B239B3; Mon, 19 May 2003 10:07:44 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 58154239B2
	for <dovecot@procontrol.fi>; Mon, 19 May 2003 10:07:43 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 203FC5C896C6; Mon, 19 May 2003 10:07:43 +0300 (EEST)
Subject: Re: [Dovecot] DRAC support?
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030519064840.GB1644@lazy.spodder.com>
References: <20030514085227.GA7325@lazy.spodder.com>
	<20030515011306.GA3731@lazy.spodder.com>
	<20030515043029.GA18617@lazy.spodder.com>
	<200305142137.11186.jryden@thebox.our-own.net>
	<20030516191335.GA196@dust.uchicago.edu>
	<20030517063125.GA23270@lazy.spodder.com>
	<1053277632.1215.154.camel@hurina>
	<20030519014849.GJ23270@lazy.spodder.com>
	<20030519064840.GB1644@lazy.spodder.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1053328062.1218.167.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 19 May 2003 10:07:43 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 19 May 2003 07:07:44 -0000
X-UID: 769                                                  
Status: O

On Mon, 2003-05-19 at 09:48, Charlie Allom wrote:
> 16:46 yeled@lazy:/usr/src/dovecot$ gcc -Wall -W -shared -fPIC -DHAVE_CONFIG_H -I$dovecot -I$dovecot/src/lib drac.c -o drac.so -ldrac
> In file included from drac.c:14:
> /usr/src/dovecot/src/lib/lib.h:6: ../../config.h: No such file or directory
> In file included from /usr/src/dovecot/src/lib/lib.h:20,
>                  from drac.c:14:
> /usr/src/dovecot/src/lib/compat.h:17: #error uoff_t size not set
> 
> um..

Well .. worked with me :) But since it wants ../../config.h, compile it
in eg. src/imap/ directory.

From charlie@rubberduck.com  Mon May 19 10:21:49 2003
Return-Path: <charlie@rubberduck.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 3CA4B239B3; Mon, 19 May 2003 10:21:49 +0300 (EEST)
Received: from lazy.spodder.com (lazy.spodder.com [203.18.242.30])
	by danu.procontrol.fi (Postfix) with ESMTP id DDB73239AD
	for <dovecot@procontrol.fi>; Mon, 19 May 2003 10:21:46 +0300 (EEST)
Received: by lazy.spodder.com (Postfix, from userid 501)
	id 4A9D0900B; Mon, 19 May 2003 17:22:37 +1000 (EST)
Date: Mon, 19 May 2003 17:22:37 +1000
From: Charlie Allom <charlie@rubberduck.com>
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] DRAC support?
Message-ID: <20030519072237.GC1644@lazy.spodder.com>
References: <20030514085227.GA7325@lazy.spodder.com>
	<20030515011306.GA3731@lazy.spodder.com>
	<20030515043029.GA18617@lazy.spodder.com>
	<200305142137.11186.jryden@thebox.our-own.net>
	<20030516191335.GA196@dust.uchicago.edu>
	<20030517063125.GA23270@lazy.spodder.com> <1053277632.1215.154.camel@hurina>
	<20030519014849.GJ23270@lazy.spodder.com>
	<20030519064840.GB1644@lazy.spodder.com> <1053328062.1218.167.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1053328062.1218.167.camel@hurina>
User-Agent: Mutt/1.5.4i
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 19 May 2003 07:21:49 -0000
X-UID: 770                                                  
Status: O

On Mon, May 19, 2003 at 10:07:43AM +0300, Timo Sirainen wrote:
> On Mon, 2003-05-19 at 09:48, Charlie Allom wrote:
> > 16:46 yeled@lazy:/usr/src/dovecot$ gcc -Wall -W -shared -fPIC -DHAVE_CONFIG_H -I$dovecot -I$dovecot/src/lib drac.c -o drac.so -ldrac
> > In file included from drac.c:14:
> > /usr/src/dovecot/src/lib/lib.h:6: ../../config.h: No such file or directory
> > In file included from /usr/src/dovecot/src/lib/lib.h:20,
> >                  from drac.c:14:
> > /usr/src/dovecot/src/lib/compat.h:17: #error uoff_t size not set
> > 
> > um..
> 
> Well .. worked with me :) But since it wants ../../config.h, compile it
> in eg. src/imap/ directory.
> 

Are you sure?

17:22 yeled@lazy:/usr/src/dovecot$ find . -name config.h
17:22 yeled@lazy:/usr/src/dovecot$

-- 
 charlie@rubberduck.com - Melbourne, Australia
 http://rubberduck.com/~yeled/
 PGP: 0x14AA7941 || finger yeled@lazy.spodder.com
 > http://groups.google.com/groups?selm=3266D499.342E%40student.uq.edu.au <
From tss@iki.fi  Mon May 19 10:37:23 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 96EFC23A0F; Mon, 19 May 2003 10:37:23 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 062F1239B3
	for <dovecot@procontrol.fi>; Mon, 19 May 2003 10:37:19 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 9DEC25C896C6; Mon, 19 May 2003 10:37:17 +0300 (EEST)
Subject: Re: [Dovecot] DRAC support?
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030519072237.GC1644@lazy.spodder.com>
References: <20030514085227.GA7325@lazy.spodder.com>
	<20030515011306.GA3731@lazy.spodder.com>
	<20030515043029.GA18617@lazy.spodder.com>
	<200305142137.11186.jryden@thebox.our-own.net>
	<20030516191335.GA196@dust.uchicago.edu>
	<20030517063125.GA23270@lazy.spodder.com>
	<1053277632.1215.154.camel@hurina>
	<20030519014849.GJ23270@lazy.spodder.com>
	<1053328062.1218.167.camel@hurina>
	<20030519072237.GC1644@lazy.spodder.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1053329837.1218.169.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 19 May 2003 10:37:17 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 19 May 2003 07:37:23 -0000
X-UID: 771                                                  
Status: O

On Mon, 2003-05-19 at 10:22, Charlie Allom wrote:
> > Well .. worked with me :) But since it wants ../../config.h, compile it
> > in eg. src/imap/ directory.
> > 
> 
> Are you sure?
> 
> 17:22 yeled@lazy:/usr/src/dovecot$ find . -name config.h
> 17:22 yeled@lazy:/usr/src/dovecot$

Oh, you haven't compiled Dovecot in that tree? You'll have to run at
least configure there which generates config.h


From seba@iq.pl  Mon May 19 13:25:23 2003
Return-Path: <seba@iq.pl>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id EB81A239B2; Mon, 19 May 2003 13:25:23 +0300 (EEST)
Received: from serv.iq.pl (serv.iq.pl [213.76.165.9])
	by danu.procontrol.fi (Postfix) with ESMTP id 239662399D
	for <dovecot@procontrol.fi>; Mon, 19 May 2003 13:25:20 +0300 (EEST)
Received: by serv.iq.pl (Postfix, from userid 1390)
	id F3D6B6BD52; Mon, 19 May 2003 12:26:48 +0200 (CEST)
Date: Mon, 19 May 2003 12:26:48 +0200
From: Sebastian Pachuta <seba@iq.pl>
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] 0.99.10-test3
Message-ID: <20030519102648.GA17452@iq.pl>
References: <1053263378.1214.151.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1053263378.1214.151.camel@hurina>
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 19 May 2003 10:25:24 -0000
X-UID: 772                                                  
Status: O

On Sun, May 18, 2003 at 16:09:38 +0300, Timo Sirainen wrote:
> 
> - Out of quota/disk space failures are handled well now. All except
> updating dovecot-uidlist file which is a bit tricky.
> 
> - :CONTROL=dir in default_mail_env can specify where to save
> dovecot-uidlist and .customflags files. Useful for above problems.

works great
From tss@iki.fi  Mon May 19 15:50:59 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 2F62123993; Mon, 19 May 2003 15:50:59 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 7410F238D6
	for <dovecot@procontrol.fi>; Mon, 19 May 2003 15:50:56 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 351115C896C6; Mon, 19 May 2003 15:50:56 +0300 (EEST)
Subject: Re: [Dovecot] ssl still not working
From: Timo Sirainen <tss@iki.fi>
To: Dovecot List <dovecot@procontrol.fi>
In-Reply-To: <3EC3790D.2090602@bnap.hu>
References: <3EC3790D.2090602@bnap.hu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1053348655.1218.188.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 19 May 2003 15:50:56 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 19 May 2003 12:50:59 -0000
X-UID: 773                                                  
Status: O
Content-Length: 1482

On Thu, 2003-05-15 at 14:25, Farkas Levente wrote:
> hi,
> I'm just download the latest cvs and try to use imaps. in mozilla I've 
> got the following message window:
> -----------------------------
> mail.int.bppiac.hu received a message with incorrect Message 
> Authentication Code. If the error occurs frequently, contact the website 
> administrator.
> -----------------------------
> and there is only one OK button:-)
> and this happens always. what can be the reason and what can I do?
> thanks.

If you set verbose_ssl = yes, I guess you'll see something like this in
log file:

imap-login: SSL_accept() failed: error:1408F455:SSL routines:SSL3_GET_RECORD:decryption failed or bad record mac

I'm beginning to think that this has something to do with RSA keys ..
because I don't provide it large enough RSA key and I don't create any
temporary RSA keys. Or maybe the same with DH keys.

I wish someone with more understanding on SSL protocol wrote the SSL
stuff to Dovecot :) I can only guess how they probably work.

My guess is that I should either generate a new temporary RSA key when
it's asked (which I think would be very slow since every session might
create new one) or that I pregenerated a few keys with specific sizes
(512 and 1024bits?) and used only them, or let login process signal
master process that we need a new key with bit size xyz, then wait for
master process to create it and let all the new processes use it. I
think the last one would work best.

From maikel@ladot.com  Mon May 19 16:54:35 2003
Return-Path: <maikel@ladot.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id D3DF323993; Mon, 19 May 2003 16:54:35 +0300 (EEST)
Received: from zeus.ladot.com (office.ladot.com [217.22.64.134])
	by danu.procontrol.fi (Postfix) with ESMTP id 3FC7F238E1
	for <dovecot@procontrol.fi>; Mon, 19 May 2003 16:54:34 +0300 (EEST)
Received: from nlladot05.freehosting (nlladot05.intern.ladot.com
	[172.31.2.13])
	by zeus.ladot.com (8.12.9/8.12.9) with ESMTP id h4JE6JVg064212;
	Mon, 19 May 2003 16:06:19 +0200 (CEST)
	(envelope-from maikel@ladot.com)
Received: by nlladot05.intern.ladot.com with Internet Mail Service
	(5.5.2653.19)	id <JMLTKPJ5>; Mon, 19 May 2003 15:38:11 +0200
Message-ID: <410777FC7A66D511911500B0D078345501F22352@nlladot05.intern.ladot.com>
From: Maikel Verheijen <maikel@ladot.com>
To: "'Timo Sirainen'" <tss@iki.fi>,
	"'dovecot@procontrol.fi'" <dovecot@procontrol.fi>
Subject: RE: [Dovecot] 0.99.10-test1
Date: Mon, 19 May 2003 15:38:10 +0200
MIME-Version: 1.0
X-Mailer: Internet Mail Service (5.5.2653.19)
Content-Type: multipart/alternative;
	boundary="----_=_NextPart_001_01C31E0B.E3695330"
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 19 May 2003 13:54:36 -0000
X-UID: 774                                                  
Status: O
Content-Length: 1143

This message is in MIME format. Since your mail reader does not understand
this format, some or all of this message may not be legible.

------_=_NextPart_001_01C31E0B.E3695330
Content-Type: text/plain

> > Does this mean you made the .subscriptions nfs-safe already in this 
> > version?
> Well, no, but that's not maildir-specific code :)

Ah, ok, My mistake! :)


Regards,


Maikel.

------_=_NextPart_001_01C31E0B.E3695330
Content-Type: text/html

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="Generator" CONTENT="MS Exchange Server version 5.5.2653.12">
<TITLE>RE: [Dovecot] 0.99.10-test1</TITLE>
</HEAD>
<BODY>

<P><FONT SIZE=2>&gt; &gt; Does this mean you made the .subscriptions nfs-safe already in this </FONT>
<BR><FONT SIZE=2>&gt; &gt; version?</FONT>
<BR><FONT SIZE=2>&gt; Well, no, but that's not maildir-specific code :)</FONT>
</P>

<P><FONT SIZE=2>Ah, ok, My mistake! :)</FONT>
</P>
<BR>

<P><FONT SIZE=2>Regards,</FONT>
</P>
<BR>

<P><FONT SIZE=2>Maikel.</FONT>
</P>

</BODY>
</HTML>
------_=_NextPart_001_01C31E0B.E3695330--
From charlie@rubberduck.com  Tue May 20 04:12:23 2003
Return-Path: <charlie@rubberduck.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 0B0E523999; Tue, 20 May 2003 04:12:23 +0300 (EEST)
Received: from lazy.spodder.com (lazy.spodder.com [203.18.242.30])
	by danu.procontrol.fi (Postfix) with ESMTP id D6B73238D6
	for <dovecot@procontrol.fi>; Tue, 20 May 2003 04:12:18 +0300 (EEST)
Received: by lazy.spodder.com (Postfix, from userid 501)
	id CFCD7901A; Tue, 20 May 2003 11:13:01 +1000 (EST)
Date: Tue, 20 May 2003 11:13:01 +1000
From: Charlie Allom <charlie@rubberduck.com>
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] DRAC support?
Message-ID: <20030520011301.GB2615@lazy.spodder.com>
References: <20030514085227.GA7325@lazy.spodder.com>
	<20030515011306.GA3731@lazy.spodder.com>
	<20030515043029.GA18617@lazy.spodder.com>
	<200305142137.11186.jryden@thebox.our-own.net>
	<20030516191335.GA196@dust.uchicago.edu>
	<20030517063125.GA23270@lazy.spodder.com> <1053277632.1215.154.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1053277632.1215.154.camel@hurina>
User-Agent: Mutt/1.5.4i
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Tue, 20 May 2003 01:12:23 -0000
X-UID: 775                                                  
Status: O

On Sun, May 18, 2003 at 08:07:12PM +0300, Timo Sirainen wrote:
> On Sat, 2003-05-17 at 09:31, Charlie Allom wrote:
> > has anyone else tried this patch ? with Timo's modifications to his
> > original patch I got it updating the DRAC db, but only able to use the
> > local interfaces.
> 
> Install Dovecot 0.99.10-test2 and
> http://dovecot.procontrol.fi/patches/drac-imap.c
> 
> Set "imap_use_modules = yes" in config file and that should hopefully do
> it.
> 

Hi,

this does less than the original patch.

can I strace/ktruss something for you?

  C.

-- 
 charlie@rubberduck.com - Melbourne, Australia
 http://rubberduck.com/~yeled/
 PGP: 0x14AA7941 || finger yeled@lazy.spodder.com
 > http://groups.google.com/groups?selm=3266D499.342E%40student.uq.edu.au <
From ebpeele2@pams.ncsu.edu  Tue May 20 08:50:34 2003
Return-Path: <ebpeele2@pams.ncsu.edu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id F2E64238D3; Tue, 20 May 2003 08:50:33 +0300 (EEST)
Received: from localhost.localdomain (rdu168-171-174.nc.rr.com
	[24.168.171.174])
	by danu.procontrol.fi (Postfix) with ESMTP id 80376238B6
	for <dovecot@procontrol.fi>; Tue, 20 May 2003 08:50:30 +0300 (EEST)
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by localhost.localdomain (8.12.8/8.12.8) with ESMTP id h4K5nZ7F020972
	for <dovecot@procontrol.fi>; Tue, 20 May 2003 01:50:16 -0400
Received: (from elliot@localhost)
	by localhost.localdomain (8.12.8/8.12.8/Submit) id h4K5nZci020970
	for dovecot@procontrol.fi; Tue, 20 May 2003 01:49:35 -0400
X-Authentication-Warning: localhost.localdomain: elliot set sender to
	ebpeele2@pams.ncsu.edu using -f
From: Elliot Peele <ebpeele2@pams.ncsu.edu>
To: dovecot@procontrol.fi
Content-Type: multipart/signed; micalg=pgp-sha1;
	protocol="application/pgp-signature"; boundary="=-WvdjNRklqBBPu0sCBNww"
Message-Id: <1053409775.20836.8.camel@localhost.localdomain>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.3.3 (1.3.3-2) (Preview Release)
Date: 20 May 2003 01:49:35 -0400
Subject: [Dovecot] dovecot with ssl on rhl9
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Tue, 20 May 2003 05:50:34 -0000
X-UID: 776                                                  
Status: O
Content-Length: 1462


--=-WvdjNRklqBBPu0sCBNww
Content-Type: text/plain
Content-Transfer-Encoding: quoted-printable

Has anyone gotten dovecot to work on Red Hat Linux 9 with ssl support?
It seems to work just fine on Red Hat Linux 8.0, but doesn't seem to
work Red Hat Linux 9. When I try to use openssl to connect to the server
i get:

[elliot@localhost elliot]$ openssl s_client -connect
rktest.physics.ncsu.edu:993
CONNECTED(00000003)
depth=3D0 /OU=3DIMAP
server/CN=3Dimap.example.com/emailAddress=3Dpostmaster@example.com
verify error:num=3D18:self signed certificate
verify return:1
depth=3D0 /OU=3DIMAP
server/CN=3Dimap.example.com/emailAddress=3Dpostmaster@example.com
verify return:1
20949:error:140943FC:SSL routines:SSL3_READ_BYTES:sslv3 alert bad record
mac:s3_pkt.c:1052:SSL alert number 20
20949:error:140790E5:SSL routines:SSL23_WRITE:ssl handshake
failure:s23_lib.c:226:

I'm trying to use evolution 1.3.3 to connect via imaps. Whenever I click
on the mail folder it just says 'Scanning folders in "IMAP server
imap.example.com" (100%)' and then nothing happens.

Anyone have any ideas?

Thanks

Elliot

--=-WvdjNRklqBBPu0sCBNww
Content-Type: application/pgp-signature; name=signature.asc
Content-Description: This is a digitally signed message part

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.1 (GNU/Linux)

iD8DBQA+ycHvmSqoIAXFTXMRAkPCAJwIjRqmBVIWmuTmozPlvgEJz/CRlwCggqtb
B0WIbn/JCRpKYQ+VkokokLg=
=Hmjf
-----END PGP SIGNATURE-----

--=-WvdjNRklqBBPu0sCBNww--
From tss@iki.fi  Tue May 20 21:27:36 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id C93D7238C7; Tue, 20 May 2003 21:27:36 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 4BA5F23887
	for <dovecot@procontrol.fi>; Tue, 20 May 2003 21:27:35 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 045CA5C896C6; Tue, 20 May 2003 21:27:35 +0300 (EEST)
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: multipart/mixed; boundary="=-cwKswavA2QX6zIuq/8RB"
Organization: 
Message-Id: <1053455254.1212.265.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 20 May 2003 21:27:34 +0300
Subject: [Dovecot] SSL problems
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Tue, 20 May 2003 18:27:36 -0000
X-UID: 777                                                  
Status: O
Content-Length: 1555


--=-cwKswavA2QX6zIuq/8RB
Content-Type: text/plain
Content-Transfer-Encoding: 7bit

Anyone with SSL problems, please try 0.99.10-test4 or included patch. If
it fixes it, I'll make it faster by caching the generated keys.

http://dovecot.procontrol.fi/test/


--=-cwKswavA2QX6zIuq/8RB
Content-Disposition: attachment; filename=ssl.diff
Content-Type: text/x-patch; name=ssl.diff; charset=ISO-8859-15
Content-Transfer-Encoding: quoted-printable

Index: ssl-proxy-openssl.c
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
RCS file: /home/cvs/dovecot/src/login-common/ssl-proxy-openssl.c,v
retrieving revision 1.14
retrieving revision 1.15
diff -u -r1.14 -r1.15
--- ssl-proxy-openssl.c	19 May 2003 09:57:02 -0000	1.14
+++ ssl-proxy-openssl.c	20 May 2003 18:22:04 -0000	1.15
@@ -392,6 +392,12 @@
 	}
 }
=20
+static RSA *ssl_gen_rsa_key(SSL *ssl __attr_unused__,
+			    int is_export __attr_unused__, int keylength)
+{
+	return RSA_generate_key(keylength, RSA_F4, NULL, NULL);
+}
+
 void ssl_proxy_init(void)
 {
 	const char *certfile, *keyfile, *paramfile;
@@ -423,6 +429,9 @@
 		i_fatal("Can't load private key file %s: %s",
 			keyfile, ssl_last_error());
 	}
+
+	if (SSL_CTX_need_tmp_RSA(ssl_ctx))
+		SSL_CTX_set_tmp_rsa_callback(ssl_ctx, ssl_gen_rsa_key);
=20
         ssl_proxies =3D hash_create(default_pool, default_pool, 0, NULL, N=
ULL);
 	ssl_initialized =3D TRUE;

--=-cwKswavA2QX6zIuq/8RB--
From tss@iki.fi  Tue May 20 21:40:38 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 03E5E238D3; Tue, 20 May 2003 21:40:38 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 7BA69238C7
	for <dovecot@procontrol.fi>; Tue, 20 May 2003 21:40:36 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 33F1B5C896C6; Tue, 20 May 2003 21:40:36 +0300 (EEST)
Subject: Re: [Dovecot] DRAC support?
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030520011301.GB2615@lazy.spodder.com>
References: <20030514085227.GA7325@lazy.spodder.com>
	<20030515011306.GA3731@lazy.spodder.com>
	<20030515043029.GA18617@lazy.spodder.com>
	<200305142137.11186.jryden@thebox.our-own.net>
	<20030516191335.GA196@dust.uchicago.edu>
	<20030517063125.GA23270@lazy.spodder.com>
	<20030520011301.GB2615@lazy.spodder.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1053456035.1218.277.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 20 May 2003 21:40:36 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Tue, 20 May 2003 18:40:38 -0000
X-UID: 778                                                  
Status: O

On Tue, 2003-05-20 at 04:13, Charlie Allom wrote:
> > http://dovecot.procontrol.fi/patches/drac-imap.c
> > 
> > Set "imap_use_modules = yes" in config file and that should hopefully do
> > it.
> this does less than the original patch.

Sounds like it's not even trying to use the module. Are you sure you put
it in the correct directory?

> can I strace/ktruss something for you?

"strace -f dovecot" would work. You should see something like this after
logging in:

[pid 10271] open("/usr/local/lib/dovecot/imap", O_RDONLY|O_NONBLOCK|O_LARGEFILE|O_DIRECTORY) = 4
..
[pid 10271] open("/usr/local/lib/dovecot/imap/drac.so", O_RDONLY) = 5

From charlie@rubberduck.com  Wed May 21 07:32:42 2003
Return-Path: <charlie@rubberduck.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id BF48C23997; Wed, 21 May 2003 07:32:42 +0300 (EEST)
Received: from lazy.spodder.com (lazy.spodder.com [203.18.242.30])
	by danu.procontrol.fi (Postfix) with ESMTP id 42953238D3
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 07:32:18 +0300 (EEST)
Received: by lazy.spodder.com (Postfix, from userid 501)
	id 89320901D; Wed, 21 May 2003 14:33:13 +1000 (EST)
Date: Wed, 21 May 2003 14:33:13 +1000
From: Charlie Allom <charlie@rubberduck.com>
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] DRAC support?
Message-ID: <20030521043313.GA1659@lazy.spodder.com>
References: <20030514085227.GA7325@lazy.spodder.com>
	<20030515011306.GA3731@lazy.spodder.com>
	<20030515043029.GA18617@lazy.spodder.com>
	<200305142137.11186.jryden@thebox.our-own.net>
	<20030516191335.GA196@dust.uchicago.edu>
	<20030517063125.GA23270@lazy.spodder.com>
	<20030520011301.GB2615@lazy.spodder.com> <1053456035.1218.277.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1053456035.1218.277.camel@hurina>
User-Agent: Mutt/1.5.4i
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 21 May 2003 04:32:42 -0000
X-UID: 779                                                  
Status: O
Content-Length: 1600

On Tue, May 20, 2003 at 09:40:36PM +0300, Timo Sirainen wrote:
> On Tue, 2003-05-20 at 04:13, Charlie Allom wrote:
> > > http://dovecot.procontrol.fi/patches/drac-imap.c
> > > 
> > > Set "imap_use_modules = yes" in config file and that should hopefully do
> > > it.
> > this does less than the original patch.
> 
> Sounds like it's not even trying to use the module. Are you sure you put
> it in the correct directory?

#imap_use_modules = no
#imap_modules = /usr/lib/dovecot/imap
imap_use_modules = no
imap_modules = /usr/pkg/lib/dovecot/imap

# Support for dynamically loadable modules.
#pop3_use_modules = no
#pop3_modules = /usr/lib/dovecot/pop3
pop3_use_modules = no
pop3_modules = /usr/pkg/lib/dovecot/pop3

14:32 yeled@lazy:~$ ls -Rl /usr/pkg/lib/dovecot
total 4
drwxr-xr-x  2 root  wheel  512 May 20 11:07 imap/
drwxr-xr-x  2 root  wheel  512 May 20 11:07 pop3/

/usr/pkg/lib/dovecot/imap:
total 12
-rwxr-xr-x  1 root  wheel  6031 May 20 21:51 drac.so*

/usr/pkg/lib/dovecot/pop3:
total 12
-rwxr-xr-x  1 root  wheel  6031 May 20 21:51 drac.so*


> 
> > can I strace/ktruss something for you?
> 
> "strace -f dovecot" would work. You should see something like this after
> logging in:
> 
> [pid 10271] open("/usr/local/lib/dovecot/imap", O_RDONLY|O_NONBLOCK|O_LARGEFILE|O_DIRECTORY) = 4
> ..
> [pid 10271] open("/usr/local/lib/dovecot/imap/drac.so", O_RDONLY) = 5
> 

gah nothing mentioning drac.so there... I am using ktruss -ip o nthe
first dovecot PID.

  C.
-- 
 charlie@rubberduck.com - Melbourne, Australia
 http://rubberduck.com/~yeled/
 PGP: 0x14AA7941 || finger yeled@lazy.spodder.com
From charlie@rubberduck.com  Wed May 21 07:43:28 2003
Return-Path: <charlie@rubberduck.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 753AD2399A; Wed, 21 May 2003 07:43:28 +0300 (EEST)
Received: from lazy.spodder.com (lazy.spodder.com [203.18.242.30])
	by danu.procontrol.fi (Postfix) with ESMTP id 7BEE1238D3
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 07:43:04 +0300 (EEST)
Received: by lazy.spodder.com (Postfix, from userid 501)
	id A434E901D; Wed, 21 May 2003 14:44:01 +1000 (EST)
Date: Wed, 21 May 2003 14:44:01 +1000
From: Charlie Allom <charlie@rubberduck.com>
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] DRAC support?
Message-ID: <20030521044401.GD1659@lazy.spodder.com>
References: <20030514085227.GA7325@lazy.spodder.com>
	<20030515011306.GA3731@lazy.spodder.com>
	<20030515043029.GA18617@lazy.spodder.com>
	<200305142137.11186.jryden@thebox.our-own.net>
	<20030516191335.GA196@dust.uchicago.edu>
	<20030517063125.GA23270@lazy.spodder.com>
	<20030520011301.GB2615@lazy.spodder.com> <1053456035.1218.277.camel@hurina>
	<20030521043313.GA1659@lazy.spodder.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20030521043313.GA1659@lazy.spodder.com>
User-Agent: Mutt/1.5.4i
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 21 May 2003 04:43:28 -0000
X-UID: 780                                                  
Status: O

On Wed, May 21, 2003 at 02:33:13PM +1000, Charlie Allom wrote:
> 
> 14:32 yeled@lazy:~$ ls -Rl /usr/pkg/lib/dovecot
> total 4
> drwxr-xr-x  2 root  wheel  512 May 20 11:07 imap/
> drwxr-xr-x  2 root  wheel  512 May 20 11:07 pop3/
> 
> /usr/pkg/lib/dovecot/imap:
> total 12
> -rwxr-xr-x  1 root  wheel  6031 May 20 21:51 drac.so*
> 
> /usr/pkg/lib/dovecot/pop3:
> total 12
> -rwxr-xr-x  1 root  wheel  6031 May 20 21:51 drac.so*
> 

PS. Instead of -ldrac when compilling drac.so I used
-I/usr/pkg/lib/libdrac.a 

Don't know what the difference is.

I agree it doesn't look like the modules are being loaded.

  C.
-- 
 charlie@rubberduck.com - Melbourne, Australia
 http://rubberduck.com/~yeled/
 PGP: 0x14AA7941 || finger yeled@lazy.spodder.com
From warren@togami.com  Wed May 21 07:56:54 2003
Return-Path: <warren@togami.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id B9BDB23997; Wed, 21 May 2003 07:56:54 +0300 (EEST)
Received: from pan.mplug.org (unknown [66.139.75.105])
	by danu.procontrol.fi (Postfix) with ESMTP id 5D825238D3
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 07:56:30 +0300 (EEST)
Received: from localhost.127.in-addr.arpa (unknown [127.0.0.1])
	by pan.mplug.org (Postfix) with ESMTP id 9EC305D805F
	for <dovecot@procontrol.fi>; Tue, 20 May 2003 19:00:42 -1000 (HST)
Subject: Re: [Dovecot] SSL problems
From: Warren Togami <warren@togami.com>
To: dovecot@procontrol.fi
In-Reply-To: <1053455254.1212.265.camel@hurina>
References: <1053455254.1212.265.camel@hurina>
Content-Type: text/plain
Message-Id: <1053492983.461.2.camel@laptop>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.3.3 (1.3.3-2) (Preview Release)
Date: 20 May 2003 18:56:23 -1000
Content-Transfer-Encoding: 7bit
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 21 May 2003 04:56:54 -0000
X-UID: 781                                                  
Status: O

On Tue, 2003-05-20 at 08:27, Timo Sirainen wrote:
> Anyone with SSL problems, please try 0.99.10-test4 or included patch. If
> it fixes it, I'll make it faster by caching the generated keys.
> 
> http://dovecot.procontrol.fi/test/
> 

Upgraded to 0.99.10-test4 on RH9.  I tried with a newly generated
dovecot.pem and my Apache SSL keys.  Evolution 1.3.3 and Mozilla 1.4a
still unable to use SSL.

https://bugzilla.fedora.us/show_bug.cgi?id=160
My latest SRPM is here.

Warren Togami
warren@togami.com


From tss@iki.fi  Wed May 21 10:09:41 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id E348A238D3; Wed, 21 May 2003 10:09:41 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 34A1A238C8
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 10:09:18 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 0FDFD5C896C6; Wed, 21 May 2003 10:09:16 +0300 (EEST)
Subject: Re: [Dovecot] DRAC support?
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030521043313.GA1659@lazy.spodder.com>
References: <20030514085227.GA7325@lazy.spodder.com>
	<20030515011306.GA3731@lazy.spodder.com>
	<20030515043029.GA18617@lazy.spodder.com>
	<200305142137.11186.jryden@thebox.our-own.net>
	<20030516191335.GA196@dust.uchicago.edu>
	<20030517063125.GA23270@lazy.spodder.com>
	<1053456035.1218.277.camel@hurina>
	<20030521043313.GA1659@lazy.spodder.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1053500955.1214.330.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 21 May 2003 10:09:15 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 21 May 2003 07:09:42 -0000
X-UID: 782                                                  
Status: O

On Wed, 2003-05-21 at 07:33, Charlie Allom wrote:
> > > > Set "imap_use_modules = yes" in config file and that should hopefully do
> > > > it.
> imap_use_modules = no
> pop3_use_modules = no

"no"?

From charlie@rubberduck.com  Wed May 21 10:15:33 2003
Return-Path: <charlie@rubberduck.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 7CC3723997; Wed, 21 May 2003 10:15:33 +0300 (EEST)
Received: from lazy.spodder.com (unknown [203.18.242.30])
	by danu.procontrol.fi (Postfix) with ESMTP id E6479238C8
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 10:15:03 +0300 (EEST)
Received: by lazy.spodder.com (Postfix, from userid 501)
	id 05FF6901C; Wed, 21 May 2003 17:15:51 +1000 (EST)
Date: Wed, 21 May 2003 17:15:50 +1000
From: Charlie Allom <charlie@rubberduck.com>
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] DRAC support?
Message-ID: <20030521071550.GI1659@lazy.spodder.com>
References: <20030514085227.GA7325@lazy.spodder.com>
	<20030515011306.GA3731@lazy.spodder.com>
	<20030515043029.GA18617@lazy.spodder.com>
	<200305142137.11186.jryden@thebox.our-own.net>
	<20030516191335.GA196@dust.uchicago.edu>
	<20030517063125.GA23270@lazy.spodder.com> <1053456035.1218.277.camel@hurina>
	<20030521043313.GA1659@lazy.spodder.com> <1053500955.1214.330.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1053500955.1214.330.camel@hurina>
User-Agent: Mutt/1.5.4i
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 21 May 2003 07:15:34 -0000
X-UID: 783                                                  
Status: O

On Wed, May 21, 2003 at 10:09:15AM +0300, Timo Sirainen wrote:
> On Wed, 2003-05-21 at 07:33, Charlie Allom wrote:
> > > > > Set "imap_use_modules = yes" in config file and that should hopefully do
> > > > > it.
> > imap_use_modules = no
> > pop3_use_modules = no
> 
> "no"?
> 

I may just die.

-- 
 charlie@rubberduck.com - Melbourne, Australia
 http://rubberduck.com/~yeled/
 PGP: 0x14AA7941 || finger yeled@lazy.spodder.com
From charlie@rubberduck.com  Wed May 21 10:20:19 2003
Return-Path: <charlie@rubberduck.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 3461D23997; Wed, 21 May 2003 10:20:19 +0300 (EEST)
Received: from lazy.spodder.com (lazy.spodder.com [203.18.242.30])
	by danu.procontrol.fi (Postfix) with ESMTP id 211A723887
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 10:19:55 +0300 (EEST)
Received: by lazy.spodder.com (Postfix, from userid 501)
	id A4523901C; Wed, 21 May 2003 17:20:45 +1000 (EST)
Date: Wed, 21 May 2003 17:20:45 +1000
From: Charlie Allom <charlie@rubberduck.com>
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] DRAC support?
Message-ID: <20030521072045.GJ1659@lazy.spodder.com>
References: <20030514085227.GA7325@lazy.spodder.com>
	<20030515011306.GA3731@lazy.spodder.com>
	<20030515043029.GA18617@lazy.spodder.com>
	<200305142137.11186.jryden@thebox.our-own.net>
	<20030516191335.GA196@dust.uchicago.edu>
	<20030517063125.GA23270@lazy.spodder.com> <1053456035.1218.277.camel@hurina>
	<20030521043313.GA1659@lazy.spodder.com> <1053500955.1214.330.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1053500955.1214.330.camel@hurina>
User-Agent: Mutt/1.5.4i
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 21 May 2003 07:20:19 -0000
X-UID: 784                                                  
Status: O

OK.

finally.

http://rubberduck.com/~yeled/NetBSD/dovecot.ktruss.1.txt

and in syslog:

May 21 17:18:57 lazy imap-login: Login: thom [203.31.232.2]
May 21 17:18:57 lazy imap(thom):
dlopen(/usr/pkg/lib/dovecot/imap/drac.so) failed:
/usr/pkg/lib/dovecot/imap/drac.so: Undefined PLT symbol "net_addr2ip"
(symnum = 21)

-- 
 charlie@rubberduck.com - Melbourne, Australia
 http://rubberduck.com/~yeled/
 PGP: 0x14AA7941 || finger yeled@lazy.spodder.com
From tss@iki.fi  Wed May 21 10:30:42 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 3D4D323997; Wed, 21 May 2003 10:30:42 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 98BA823887
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 10:30:16 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 36DE95C896C6; Wed, 21 May 2003 10:30:16 +0300 (EEST)
Subject: Re: [Dovecot] DRAC support?
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030521072045.GJ1659@lazy.spodder.com>
References: <20030514085227.GA7325@lazy.spodder.com>
	<20030515011306.GA3731@lazy.spodder.com>
	<20030515043029.GA18617@lazy.spodder.com>
	<200305142137.11186.jryden@thebox.our-own.net>
	<20030516191335.GA196@dust.uchicago.edu>
	<20030517063125.GA23270@lazy.spodder.com>
	<20030521043313.GA1659@lazy.spodder.com>
	<20030521072045.GJ1659@lazy.spodder.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1053502215.1214.337.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 21 May 2003 10:30:16 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 21 May 2003 07:30:42 -0000
X-UID: 785                                                  
Status: O

On Wed, 2003-05-21 at 10:20, Charlie Allom wrote:
> /usr/pkg/lib/dovecot/imap/drac.so: Undefined PLT symbol "net_addr2ip"
> (symnum = 21)

Are you really running 0.99.10-test2 or newer? I changed that function's
name recently.

From charlie@rubberduck.com  Wed May 21 10:39:26 2003
Return-Path: <charlie@rubberduck.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 105D9238C9; Wed, 21 May 2003 10:39:26 +0300 (EEST)
Received: from lazy.spodder.com (lazy.spodder.com [203.18.242.30])
	by danu.procontrol.fi (Postfix) with ESMTP id 060FA23887
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 10:39:02 +0300 (EEST)
Received: by lazy.spodder.com (Postfix, from userid 501)
	id 434389020; Wed, 21 May 2003 17:39:59 +1000 (EST)
Date: Wed, 21 May 2003 17:39:59 +1000
From: Charlie Allom <charlie@rubberduck.com>
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] DRAC support?
Message-ID: <20030521073959.GD27088@lazy.spodder.com>
References: <20030514085227.GA7325@lazy.spodder.com>
	<20030515011306.GA3731@lazy.spodder.com>
	<20030515043029.GA18617@lazy.spodder.com>
	<200305142137.11186.jryden@thebox.our-own.net>
	<20030516191335.GA196@dust.uchicago.edu>
	<20030517063125.GA23270@lazy.spodder.com>
	<20030521043313.GA1659@lazy.spodder.com>
	<20030521072045.GJ1659@lazy.spodder.com> <1053502215.1214.337.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1053502215.1214.337.camel@hurina>
User-Agent: Mutt/1.5.4i
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 21 May 2003 07:39:26 -0000
X-UID: 786                                                  
Status: O

On Wed, May 21, 2003 at 10:30:16AM +0300, Timo Sirainen wrote:
> On Wed, 2003-05-21 at 10:20, Charlie Allom wrote:
> > /usr/pkg/lib/dovecot/imap/drac.so: Undefined PLT symbol "net_addr2ip"
> > (symnum = 21)
> 
> Are you really running 0.99.10-test2 or newer? I changed that function's
> name recently.
> 

Yes I really am. 

Check your latest commits to network.h and network.c

17:35 yeled@lazy:~$ grep -ir net_addr2ip
/usr/src/pkgsrc/mail/dovecot/work.i386//usr/src/pkgsrc/mail/dovecot/work.i386/dovecot-0.99.10-test2/src/lib/network.c:int
net_addr2ip(const char *addr, struct ip_addr *ip)
/usr/src/pkgsrc/mail/dovecot/work.i386/dovecot-0.99.10-test2/src/lib/network.h:int
net_addr2ip(const char *addr, struct ip_addr *ip);
/usr/src/pkgsrc/mail/dovecot/work.i386/dovecot-0.99.10-test2/drac.c:
else if (net_addr2ip(ip_str, &ip) < 0)

  C.
-- 
 charlie@rubberduck.com - Melbourne, Australia
 http://rubberduck.com/~yeled/
 PGP: 0x14AA7941 || finger yeled@lazy.spodder.com
From lfarkas@bnap.hu  Wed May 21 11:41:12 2003
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 40AAE238C8; Wed, 21 May 2003 11:41:12 +0300 (EEST)
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 209A2238C9
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 11:40:48 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id 87BA875400F
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 10:40:28 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id F29BC3EB1
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 10:40:44 +0200 (CEST)
Received: from bnap.hu (garfield.int.bppiac.hu [192.168.0.50])
	by mail2.bppiac.hu (Postfix) with ESMTP id D11E93EB0
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 10:40:44 +0200 (CEST)
Message-ID: <3ECB3B8C.2060301@bnap.hu>
Date: Wed, 21 May 2003 10:40:44 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: Re: [Dovecot] ssl still not working
References: <3EC3790D.2090602@bnap.hu> <1053348655.1218.188.camel@hurina>
In-Reply-To: <1053348655.1218.188.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 21 May 2003 08:41:12 -0000
X-UID: 787                                                  
Status: O
Content-Length: 3029

Timo Sirainen wrote:
> On Thu, 2003-05-15 at 14:25, Farkas Levente wrote:
> 
>>hi,
>>I'm just download the latest cvs and try to use imaps. in mozilla I've 
>>got the following message window:
>>-----------------------------
>>mail.int.bppiac.hu received a message with incorrect Message 
>>Authentication Code. If the error occurs frequently, contact the website 
>>administrator.
>>-----------------------------
>>and there is only one OK button:-)
>>and this happens always. what can be the reason and what can I do?
>>thanks.
> 
> 
> If you set verbose_ssl = yes, I guess you'll see something like this in
> log file:
> 
> imap-login: SSL_accept() failed: error:1408F455:SSL routines:SSL3_GET_RECORD:decryption failed or bad record mac
> 
> I'm beginning to think that this has something to do with RSA keys ..
> because I don't provide it large enough RSA key and I don't create any
> temporary RSA keys. Or maybe the same with DH keys.
> 
> I wish someone with more understanding on SSL protocol wrote the SSL
> stuff to Dovecot :) I can only guess how they probably work.
> 
> My guess is that I should either generate a new temporary RSA key when
> it's asked (which I think would be very slow since every session might
> create new one) or that I pregenerated a few keys with specific sizes
> (512 and 1024bits?) and used only them, or let login process signal
> master process that we need a new key with bit size xyz, then wait for
> master process to create it and let all the new processes use it. I
> think the last one would work best.

here is the result:
-------------------
imap-login: May 21 10:35:39 Warning: SSL_accept() failed: 
error:1408F455:SSL routines:SSL3_GET_RECORD:decryption failed or bad 
record mac [192.168.0.50]
imap-login: May 21 10:35:39 Info: Disconnected [192.168.0.50]
imap-login: May 21 10:35:39 Warning: SSL_accept() failed: 
error:1408F455:SSL routines:SSL3_GET_RECORD:decryption failed or bad 
record mac [192.168.0.50]
imap-login: May 21 10:35:39 Info: Disconnected [192.168.0.50]
imap-login: May 21 10:35:39 Warning: SSL_accept() failed: 
error:1408F455:SSL routines:SSL3_GET_RECORD:decryption failed or bad 
record mac [192.168.0.50]
imap-login: May 21 10:35:39 Info: Disconnected [192.168.0.50]
imap-login: May 21 10:35:43 Warning: SSL_accept() failed: 
error:1408F455:SSL routines:SSL3_GET_RECORD:decryption failed or bad 
record mac [192.168.0.50]
imap-login: May 21 10:35:43 Info: Disconnected [192.168.0.50]
imap-login: May 21 10:35:43 Warning: SSL_accept() failed: 
error:1408F455:SSL routines:SSL3_GET_RECORD:decryption failed or bad 
record mac [192.168.0.50]
imap-login: May 21 10:35:43 Info: Disconnected [192.168.0.50]
-------------------
this is with the latest patch (it's actualy the today cvs version).
I don't use dovecot's generated certs, I manualy generate certificate 
for all of our services https, imaps, vpn... with one common global CA 
for the whole company. ssl still not working.

-- 
   Levente                               "Si vis pacem para bellum!"


From lfarkas@bnap.hu  Wed May 21 11:58:51 2003
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id AD52D238C9; Wed, 21 May 2003 11:58:51 +0300 (EEST)
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id CA51F238C8
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 11:58:27 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id 063F875401C
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 10:58:10 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id E37403ECC
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 10:58:25 +0200 (CEST)
Received: from bnap.hu (garfield.int.bppiac.hu [192.168.0.50])
	by mail2.bppiac.hu (Postfix) with ESMTP id B7CE13EB7
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 10:58:25 +0200 (CEST)
Message-ID: <3ECB3FB1.9040602@bnap.hu>
Date: Wed, 21 May 2003 10:58:25 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
Subject: [Dovecot] still problem with load
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 21 May 2003 08:58:51 -0000
X-UID: 788                                                  
Status: O
Content-Length: 2360

hi,
we've got (and getting more) serious problem with load. I'm just 
calculate that ther is about 300 mailbox with 20Gb mails. and the whole 
system is _very_ slow and just getting slower and slower. it's a fast 
lan every client has 100Mb connection to the server with gigabit crad 
and gigabit switches. when I push the delete button in a mail I usualy 
have to wait 10,20 or 30 seconds (!!!) to deleted and show me the next 
one. dovecot eat so much io to the hard disk, that we can't do too much.
currently at the same time about 100 clients are connected mostly with 
OE6. the server is a P4 server with 1GB ram and about 1TB hard disk. 
there is only one samba and dovecot on the server. and the load use to 
be something like this:
----------------------------------------
  10:47:38  up 3 days, 15:48,  2 users,  load average: 4.64, 3.58, 3.43
230 processes: 225 sleeping, 5 running, 0 zombie, 0 stopped
CPU states:   6.3% user   8.9% system   0.0% nice   0.0% iowait  84.6% idle
Mem:  1022840k av, 1013588k used,    9252k free,       0k shrd,   80320k 
buff
                     826372k actv,   47324k in_d,   16904k in_c
Swap: 4193608k av,   80612k used, 4112996k free                  783088k 
cached
----------------------------------------
as you can see it use almost all ram (as the 2.4 kernmel used to do) but 
no cache. so the ram is enough. the more interesting part is the load 
while the idle usualy between 80-90% the whole system doesn't use any 
cpu (or just minimal). BUT at the same time the load is around 3,4,5 
(!!!) which is too much, and more than acceptable. what's worse the 
reason is the io load on the hard disks. every process are waiting for 
io. in this case I usualy
service dovecot stop
killall imap
<wait about one minutes>
service dovecot start
and the load goes back to 0.3-0.6. after an hour the same happend and I 
have to do the same.:-((( what's more in this case samba case that all 
(!!!) clients stops for a few seconds. since everybody use OE6 they 
always download all messages with huge mailboxes what's more dovecot 
index the whole system all the time. I assume this cause the load. IMHO 
300 mailbox and 100 concurrent user is not such a big thing.
is there any way to restrict dovecot not to use so much io?
thanks in advance.

-- 
   Levente                               "Si vis pacem para bellum!"


From tss@iki.fi  Wed May 21 12:14:36 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 9DBC8238C9; Wed, 21 May 2003 12:14:36 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 3E5AB238C8
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 12:14:11 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id EAB745C896C6; Wed, 21 May 2003 12:14:09 +0300 (EEST)
Subject: Re: [Dovecot] DRAC support?
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030521073959.GD27088@lazy.spodder.com>
References: <20030514085227.GA7325@lazy.spodder.com>
	<20030515011306.GA3731@lazy.spodder.com>
	<20030515043029.GA18617@lazy.spodder.com>
	<200305142137.11186.jryden@thebox.our-own.net>
	<20030516191335.GA196@dust.uchicago.edu>
	<20030517063125.GA23270@lazy.spodder.com>
	<20030521043313.GA1659@lazy.spodder.com>
	<1053502215.1214.337.camel@hurina>
	<20030521073959.GD27088@lazy.spodder.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1053508449.1218.348.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 21 May 2003 12:14:09 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 21 May 2003 09:14:36 -0000
X-UID: 789                                                  
Status: O

On Wed, 2003-05-21 at 10:39, Charlie Allom wrote:
> On Wed, May 21, 2003 at 10:30:16AM +0300, Timo Sirainen wrote:
> > On Wed, 2003-05-21 at 10:20, Charlie Allom wrote:
> > > /usr/pkg/lib/dovecot/imap/drac.so: Undefined PLT symbol "net_addr2ip"
> > > (symnum = 21)
> > 
> > Are you really running 0.99.10-test2 or newer? I changed that function's
> > name recently.
> > 
> 
> Yes I really am. 
> 
> Check your latest commits to network.h and network.c

Oh! I got it :) The linker optimizes that function away since it's not
used elsewhere. Well, I'll include that function into the drac.c.
Updated http://dovecot.procontrol.fi/patches/drac.c

From tss@iki.fi  Wed May 21 12:22:51 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id D7AA9238C9; Wed, 21 May 2003 12:22:51 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id D524B23887
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 12:22:27 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 8E5545C896C6; Wed, 21 May 2003 12:22:27 +0300 (EEST)
Subject: Re: [Dovecot] still problem with load
From: Timo Sirainen <tss@iki.fi>
To: Dovecot List <dovecot@procontrol.fi>
In-Reply-To: <3ECB3FB1.9040602@bnap.hu>
References: <3ECB3FB1.9040602@bnap.hu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1053508947.1214.358.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 21 May 2003 12:22:27 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 21 May 2003 09:22:52 -0000
X-UID: 790                                                  
Status: O

On Wed, 2003-05-21 at 11:58, Farkas Levente wrote:
> since everybody use OE6 they 
> always download all messages with huge mailboxes

OE6 shouldn't do that, unless UIDVALIDITY changes. And it shouldn't
change.

> what's more dovecot index the whole system all the time.

Dovecot should neither do that unless it thinks there's something wrong
with the indexes. Don't you get any error messages in logs?

If it really is rebuilding the indexes all the time without errors, try 
what happens if you use in-memory indexes? ie. add :INDEX=MEMORY to
default_mail_env setting. Although that pretty much requires
0.99.10-test releases since there was some bugs in it before.

And if OE6 reloads everything, check if the UIDVALIDITY keeps changing
in dovecot-uidlist. It's in the first line, middle number.

> IMHO 300 mailbox and 100 concurrent user is not such a big thing.

No, it shouldn't be.

From charlie@rubberduck.com  Wed May 21 12:26:18 2003
Return-Path: <charlie@rubberduck.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 8300A238C9; Wed, 21 May 2003 12:26:18 +0300 (EEST)
Received: from lazy.spodder.com (lazy.spodder.com [203.18.242.30])
	by danu.procontrol.fi (Postfix) with ESMTP id 1A65723887
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 12:25:54 +0300 (EEST)
Received: by lazy.spodder.com (Postfix, from userid 501)
	id AA5A1901C; Wed, 21 May 2003 19:26:51 +1000 (EST)
Date: Wed, 21 May 2003 19:26:51 +1000
From: Charlie Allom <charlie@rubberduck.com>
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] DRAC support?
Message-ID: <20030521092651.GG27088@lazy.spodder.com>
References: <20030514085227.GA7325@lazy.spodder.com>
	<20030515011306.GA3731@lazy.spodder.com>
	<20030515043029.GA18617@lazy.spodder.com>
	<200305142137.11186.jryden@thebox.our-own.net>
	<20030516191335.GA196@dust.uchicago.edu>
	<20030517063125.GA23270@lazy.spodder.com>
	<20030521043313.GA1659@lazy.spodder.com> <1053502215.1214.337.camel@hurina>
	<20030521073959.GD27088@lazy.spodder.com> <1053508449.1218.348.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1053508449.1218.348.camel@hurina>
User-Agent: Mutt/1.5.4i
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 21 May 2003 09:26:18 -0000
X-UID: 791                                                  
Status: O
Content-Length: 1180

On Wed, May 21, 2003 at 12:14:09PM +0300, Timo Sirainen wrote:
> On Wed, 2003-05-21 at 10:39, Charlie Allom wrote:
> > On Wed, May 21, 2003 at 10:30:16AM +0300, Timo Sirainen wrote:
> > > On Wed, 2003-05-21 at 10:20, Charlie Allom wrote:
> > > > /usr/pkg/lib/dovecot/imap/drac.so: Undefined PLT symbol "net_addr2ip"
> > > > (symnum = 21)
> > > 
> > > Are you really running 0.99.10-test2 or newer? I changed that function's
> > > name recently.
> > > 
> > 
> > Yes I really am. 
> > 
> > Check your latest commits to network.h and network.c
> 
> Oh! I got it :) The linker optimizes that function away since it's not
> used elsewhere. Well, I'll include that function into the drac.c.
> Updated http://dovecot.procontrol.fi/patches/drac.c
> 

Thanks!

May 21 19:23:26 lazy imap-login: Login: thom [203.31.232.2]
May 21 19:23:26 lazy imap(thom):
dlopen(/usr/pkg/lib/dovecot/imap/drac.so) failed:
/usr/pkg/lib/dovecot/imap/drac.so: Undefined PLT symbol "i_error"
(symnum = 22)

Oops.

ktruss:
http://rubberduck.com/~yeled/NetBSD/dovecot.ktruss.2.txt

-- 
 charlie@rubberduck.com - Melbourne, Australia
 http://rubberduck.com/~yeled/
 PGP: 0x14AA7941 || finger yeled@lazy.spodder.com
From tss@iki.fi  Wed May 21 12:36:23 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 15EBA238C9; Wed, 21 May 2003 12:36:23 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 3AD5923887
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 12:35:50 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id D16C95C896C6; Wed, 21 May 2003 12:35:49 +0300 (EEST)
Subject: Re: [Dovecot] DRAC support?
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030521092651.GG27088@lazy.spodder.com>
References: <20030514085227.GA7325@lazy.spodder.com>
	<20030515011306.GA3731@lazy.spodder.com>
	<20030515043029.GA18617@lazy.spodder.com>
	<200305142137.11186.jryden@thebox.our-own.net>
	<20030516191335.GA196@dust.uchicago.edu>
	<20030517063125.GA23270@lazy.spodder.com>
	<1053502215.1214.337.camel@hurina>
	<20030521073959.GD27088@lazy.spodder.com>
	<1053508449.1218.348.camel@hurina>
	<20030521092651.GG27088@lazy.spodder.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1053509749.1212.366.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 21 May 2003 12:35:49 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 21 May 2003 09:36:23 -0000
X-UID: 792                                                  
Status: O
Content-Length: 1225

On Wed, 2003-05-21 at 12:26, Charlie Allom wrote:
> > Oh! I got it :) The linker optimizes that function away since it's not
> > used elsewhere. Well, I'll include that function into the drac.c.
> > Updated http://dovecot.procontrol.fi/patches/drac.c

> dlopen(/usr/pkg/lib/dovecot/imap/drac.so) failed:
> /usr/pkg/lib/dovecot/imap/drac.so: Undefined PLT symbol "i_error"
> (symnum = 22)

Well, I think the module stuff is somehow broken with your system then.
And I think I'll revert the net_addr2ip() change too since it's probably
the same reason :)

When linking imap binary, does it include -Wl,--export-dynamic option
somewhere in the gcc line?

Or you could just built it in by modifying src/imap/main.c:

diff -u -r1.33 main.c
--- main.c      14 May 2003 18:23:04 -0000      1.33
+++ main.c      21 May 2003 09:35:06 -0000
@@ -10,6 +10,7 @@
 #include "module-dir.h"
 #include "mail-storage.h"
 #include "commands.h"
+#include "drac.c"
 
 #include <stdlib.h>
 #include <unistd.h>
@@ -92,6 +93,7 @@
        mail_storage_register_all();
        clients_init();
        commands_init();
+       drac_init();
 
        modules = getenv("MODULE_DIR") == NULL ? NULL :
                module_dir_load(getenv("MODULE_DIR"));

From lfarkas@bnap.hu  Wed May 21 13:19:39 2003
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 79D9C238C9; Wed, 21 May 2003 13:19:39 +0300 (EEST)
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 717B2238C8
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 13:19:15 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id 6570F75401D
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 12:18:55 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id 3879F3EB7
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 12:19:09 +0200 (CEST)
Received: from bnap.hu (garfield.int.bppiac.hu [192.168.0.50])
	by mail2.bppiac.hu (Postfix) with ESMTP id 1EBAF3EB0
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 12:19:09 +0200 (CEST)
Message-ID: <3ECB529C.8050201@bnap.hu>
Date: Wed, 21 May 2003 12:19:08 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: Re: [Dovecot] still problem with load
References: <3ECB3FB1.9040602@bnap.hu> <1053508947.1214.358.camel@hurina>
In-Reply-To: <1053508947.1214.358.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 21 May 2003 10:19:39 -0000
X-UID: 793                                                  
Status: O
Content-Length: 1594

Timo Sirainen wrote:
> On Wed, 2003-05-21 at 11:58, Farkas Levente wrote:
> 
>>since everybody use OE6 they 
>>always download all messages with huge mailboxes
> 
> 
> OE6 shouldn't do that, unless UIDVALIDITY changes. And it shouldn't
> change.
> 
> 
>>what's more dovecot index the whole system all the time.
> 
> 
> Dovecot should neither do that unless it thinks there's something wrong
> with the indexes. Don't you get any error messages in logs?
> 
> If it really is rebuilding the indexes all the time without errors, try 
> what happens if you use in-memory indexes? ie. add :INDEX=MEMORY to
> default_mail_env setting. Although that pretty much requires
> 0.99.10-test releases since there was some bugs in it before.
> 
> And if OE6 reloads everything, check if the UIDVALIDITY keeps changing
> in dovecot-uidlist. It's in the first line, middle number.

no it doesn't changing:-(

>>IMHO 300 mailbox and 100 concurrent user is not such a big thing.
> 
> 
> No, it shouldn't be.

ok so what can be the reason?
if I stop dovecot, the load fall down to about 0.3. if I start dovecot 
and about 50 people connect to it it goes up to 3.x-4.x. which actualy 
irritate me and the samba server stops for a few seconds for every 10-20 
minutes and it took about 20-30 second to delete a mail in mozilla an 
show me the next (simple text) messages.
any tip?
how can I test it or help to you to find out the reason?
it there any way to measure the total amount of read and write issued by 
all dovecot process? or...?

-- 
   Levente                               "Si vis pacem para bellum!"


From lfarkas@bnap.hu  Wed May 21 13:26:28 2003
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 3B486238C9; Wed, 21 May 2003 13:26:28 +0300 (EEST)
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 641C3238C8
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 13:26:04 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id 0FFE175400E
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 12:25:46 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id AF41E3EB1
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 12:26:02 +0200 (CEST)
Received: from bnap.hu (garfield.int.bppiac.hu [192.168.0.50])
	by mail2.bppiac.hu (Postfix) with ESMTP id 9DDE13EB0
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 12:26:02 +0200 (CEST)
Message-ID: <3ECB543A.1070502@bnap.hu>
Date: Wed, 21 May 2003 12:26:02 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: Re: [Dovecot] still problem with load
References: <3ECB3FB1.9040602@bnap.hu> <1053508947.1214.358.camel@hurina>
In-Reply-To: <1053508947.1214.358.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 21 May 2003 10:26:28 -0000
X-UID: 794                                                  
Status: O
Content-Length: 1487

Timo Sirainen wrote:
> On Wed, 2003-05-21 at 11:58, Farkas Levente wrote:
> 
>>since everybody use OE6 they 
>>always download all messages with huge mailboxes
> 
> 
> OE6 shouldn't do that, unless UIDVALIDITY changes. And it shouldn't
> change.
> 
> 
>>what's more dovecot index the whole system all the time.
> 
> 
> Dovecot should neither do that unless it thinks there's something wrong
> with the indexes. Don't you get any error messages in logs?
> 
> If it really is rebuilding the indexes all the time without errors, try 
> what happens if you use in-memory indexes? ie. add :INDEX=MEMORY to
> default_mail_env setting. Although that pretty much requires
> 0.99.10-test releases since there was some bugs in it before.
> 
> And if OE6 reloads everything, check if the UIDVALIDITY keeps changing
> in dovecot-uidlist. It's in the first line, middle number.
> 
> 
>>IMHO 300 mailbox and 100 concurrent user is not such a big thing.
> 
> 
> No, it shouldn't be.

hops when I delete you next message (about drac), I've got an error 
message that my server disconnected and the following error message in 
the log file:
-----------------------------
imap(lfarkas): May 21 12:20:01 Error: Corrupted index file 
/home/lfarkas/Maildir/.INBOX/.imap.index: index.next_uid (64) > 
uidlist.next_uid (63)
-----------------------------
there is only on connection to the server and just only me who read my 
mailbox.

-- 
   Levente                               "Si vis pacem para bellum!"


From lfarkas@bnap.hu  Wed May 21 14:11:30 2003
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 88C61238C9; Wed, 21 May 2003 14:11:30 +0300 (EEST)
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 5BF03238C8
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 14:10:58 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id 5BBBC75400F
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 13:10:40 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id E298F3EB7
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 13:10:55 +0200 (CEST)
Received: from bnap.hu (garfield.int.bppiac.hu [192.168.0.50])
	by mail2.bppiac.hu (Postfix) with ESMTP id C3FF73EB1
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 13:10:55 +0200 (CEST)
Message-ID: <3ECB5EBF.80403@bnap.hu>
Date: Wed, 21 May 2003 13:10:55 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: Re: [Dovecot] still problem with load
References: <3ECB3FB1.9040602@bnap.hu> <1053508947.1214.358.camel@hurina>
	<3ECB543A.1070502@bnap.hu>
In-Reply-To: <3ECB543A.1070502@bnap.hu>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 21 May 2003 11:11:30 -0000
X-UID: 795                                                  
Status: O
Content-Length: 2709

Farkas Levente wrote:
> Timo Sirainen wrote:
> 
>> On Wed, 2003-05-21 at 11:58, Farkas Levente wrote:
>>
>>> since everybody use OE6 they always download all messages with huge 
>>> mailboxes
>>
>>
>>
>> OE6 shouldn't do that, unless UIDVALIDITY changes. And it shouldn't
>> change.
>>
>>
>>> what's more dovecot index the whole system all the time.
>>
>>
>>
>> Dovecot should neither do that unless it thinks there's something wrong
>> with the indexes. Don't you get any error messages in logs?
>>
>> If it really is rebuilding the indexes all the time without errors, 
>> try what happens if you use in-memory indexes? ie. add :INDEX=MEMORY to
>> default_mail_env setting. Although that pretty much requires
>> 0.99.10-test releases since there was some bugs in it before.
>>
>> And if OE6 reloads everything, check if the UIDVALIDITY keeps changing
>> in dovecot-uidlist. It's in the first line, middle number.
>>
>>
>>> IMHO 300 mailbox and 100 concurrent user is not such a big thing.
>>
>>
>>
>> No, it shouldn't be.
> 
> 
> hops when I delete you next message (about drac), I've got an error 
> message that my server disconnected and the following error message in 
> the log file:
> -----------------------------
> imap(lfarkas): May 21 12:20:01 Error: Corrupted index file 
> /home/lfarkas/Maildir/.INBOX/.imap.index: index.next_uid (64) > 
> uidlist.next_uid (63)
> -----------------------------
> there is only on connection to the server and just only me who read my 
> mailbox.

and a few more error log:
----------------------imap(pbalkanyi): May 21 13:04:17 Error: Corrupted 
index file /home/pbalkanyi/Maildir/.INBOX/.imap.index: index.next_uid 
(287) > uidlist.next_uid (286)
imap(pbalkanyi): May 21 13:04:17 Error: Couldn't lock created modify log 
file /home/pbalkanyi/Maildir/.INBOX/.imap.index.log
imap-login: May 21 13:04:33 Info: Login: pbalkanyi [192.168.1.164]
imap(pbalkanyi): May 21 13:04:33 Error: IndexID mismatch for modify log 
file /home/pbalkanyi/Maildir/.INBOX/.imap.index.log
imap(zkempf): May 21 13:05:17 Error: Corrupted index file 
/home/zkempf/Maildir/.INBOX/.imap.index: index.next_uid (180) > 
uidlist.next_uid (179)
imap(zkempf): May 21 13:05:17 Error: Couldn't lock created modify log 
file /home/zkempf/Maildir/.INBOX/.imap.index.log
imap-login: May 21 13:05:25 Info: Login: zkempf [192.168.0.134]
imap(zkempf): May 21 13:05:25 Error: IndexID mismatch for modify log 
file /home/zkempf/Maildir/.INBOX/.imap.index.log
imap(pbalkanyi): May 21 13:05:48 Error: Warning: Inconsistency - Index 
/home/pbalkanyi/Maildir/.INBOX/.imap.index was rebuilt while we had it open
----------------------

-- 
   Levente                               "Si vis pacem para bellum!"


From tss@iki.fi  Wed May 21 14:12:52 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id AADB5239BC; Wed, 21 May 2003 14:12:52 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id C5BAE239BA
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 14:12:28 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 91CB95C896C6; Wed, 21 May 2003 14:12:28 +0300 (EEST)
Subject: Re: [Dovecot] still problem with load
From: Timo Sirainen <tss@iki.fi>
To: Dovecot List <dovecot@procontrol.fi>
In-Reply-To: <3ECB529C.8050201@bnap.hu>
References: <3ECB3FB1.9040602@bnap.hu> <1053508947.1214.358.camel@hurina>
	 <3ECB529C.8050201@bnap.hu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1053515548.1218.383.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 21 May 2003 14:12:28 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 21 May 2003 11:12:52 -0000
X-UID: 796                                                  
Status: O
Content-Length: 1191

On Wed, 2003-05-21 at 13:19, Farkas Levente wrote:
> >>IMHO 300 mailbox and 100 concurrent user is not such a big thing.
> > No, it shouldn't be.
> 
> ok so what can be the reason?

Well, check what OE6 is talking to Dovecot. Is it fetching headers or
bodies for all messages? It should do that to only new messages.

Rawlog or some network sniffers could tell what exactly is happening.
http://dovecot.procontrol.fi/bugreport.html#sniffing

Also is Dovecot really rebuilding the indexes all the time? How do you
know? Try the in-memory indexes, at least then it's not rebuilding any
indexes to disk.

> it there any way to measure the total amount of read and write issued by 
> all dovecot process? or...?

Dovecot doesn't count them, but your OS might. I don't know really.

> imap(lfarkas): May 21 12:20:01 Error: Corrupted index file 
> /home/lfarkas/Maildir/.INBOX/.imap.index: index.next_uid (64) > 
> uidlist.next_uid (63)

Hmm.. I was going to suggest trying 0.99.10-test, but I guess you're
using it now? Looks like I have similiar error messages in my log :)
Have to fix those.

You didn't say how long this load problem has been going on, was it only
recently or for longer now?

From lfarkas@bnap.hu  Wed May 21 14:41:59 2003
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 92535239BA; Wed, 21 May 2003 14:41:59 +0300 (EEST)
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id B5F2F23887
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 14:41:35 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id 6126C75400B
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 13:41:15 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id 31A503EB1
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 13:41:32 +0200 (CEST)
Received: from bnap.hu (garfield.int.bppiac.hu [192.168.0.50])
	by mail2.bppiac.hu (Postfix) with ESMTP id 0553D3EB0
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 13:41:32 +0200 (CEST)
Message-ID: <3ECB65EB.7030605@bnap.hu>
Date: Wed, 21 May 2003 13:41:31 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: Re: [Dovecot] still problem with load
References: <3ECB3FB1.9040602@bnap.hu> <1053508947.1214.358.camel@hurina>
	<3ECB529C.8050201@bnap.hu> <1053515548.1218.383.camel@hurina>
In-Reply-To: <1053515548.1218.383.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 21 May 2003 11:41:59 -0000
X-UID: 797                                                  
Status: O
Content-Length: 1174

Timo Sirainen wrote:
> Well, check what OE6 is talking to Dovecot. Is it fetching headers or
> bodies for all messages? It should do that to only new messages.
> 
> Rawlog or some network sniffers could tell what exactly is happening.
> http://dovecot.procontrol.fi/bugreport.html#sniffing
> 
> Also is Dovecot really rebuilding the indexes all the time? How do you
> know? Try the in-memory indexes, at least then it's not rebuilding any
> indexes to disk.

actually it was just a tip. what is sure, if I stop dovecot the load
fall down and there is no cpu load at all.

>>imap(lfarkas): May 21 12:20:01 Error: Corrupted index file 
>>/home/lfarkas/Maildir/.INBOX/.imap.index: index.next_uid (64) > 
>>uidlist.next_uid (63)
> 
> 
> Hmm.. I was going to suggest trying 0.99.10-test, but I guess you're
> using it now? Looks like I have similiar error messages in my log :)
> Have to fix those.

this is the today morning cvs.

> You didn't say how long this load problem has been going on, was it only
> recently or for longer now?

recently one or two week, but eg todays I see load around 8-9...


-- 
   Levente                               "Si vis pacem para bellum!"


From tss@iki.fi  Wed May 21 14:45:10 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id A8269239BC; Wed, 21 May 2003 14:45:10 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 5893023887
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 14:44:46 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 3C3245C896C6; Wed, 21 May 2003 14:44:45 +0300 (EEST)
Subject: Re: [Dovecot] still problem with load
From: Timo Sirainen <tss@iki.fi>
To: Dovecot List <dovecot@procontrol.fi>
In-Reply-To: <3ECB543A.1070502@bnap.hu>
References: <3ECB3FB1.9040602@bnap.hu> <1053508947.1214.358.camel@hurina>
	 <3ECB543A.1070502@bnap.hu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1053517484.1215.386.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 21 May 2003 14:44:45 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 21 May 2003 11:45:10 -0000
X-UID: 798                                                  
Status: O

On Wed, 2003-05-21 at 13:26, Farkas Levente wrote:
> imap(lfarkas): May 21 12:20:01 Error: Corrupted index file 
> /home/lfarkas/Maildir/.INBOX/.imap.index: index.next_uid (64) > 
> uidlist.next_uid (63)

Fixed in 0.99.10-test5.

From charlie@rubberduck.com  Wed May 21 14:58:08 2003
Return-Path: <charlie@rubberduck.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id CDF54239BC; Wed, 21 May 2003 14:58:08 +0300 (EEST)
Received: from lazy.spodder.com (lazy.spodder.com [203.18.242.30])
	by danu.procontrol.fi (Postfix) with ESMTP id 6C3C123887
	for <dovecot@procontrol.fi>; Wed, 21 May 2003 14:57:44 +0300 (EEST)
Received: by lazy.spodder.com (Postfix, from userid 501)
	id 5B859901C; Wed, 21 May 2003 21:58:42 +1000 (EST)
Date: Wed, 21 May 2003 21:58:42 +1000
From: Charlie Allom <charlie@rubberduck.com>
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] DRAC support?
Message-ID: <20030521115842.GI27088@lazy.spodder.com>
References: <20030515011306.GA3731@lazy.spodder.com>
	<20030515043029.GA18617@lazy.spodder.com>
	<200305142137.11186.jryden@thebox.our-own.net>
	<20030516191335.GA196@dust.uchicago.edu>
	<20030517063125.GA23270@lazy.spodder.com> <1053502215.1214.337.camel@hurina>
	<20030521073959.GD27088@lazy.spodder.com> <1053508449.1218.348.camel@hurina>
	<20030521092651.GG27088@lazy.spodder.com> <1053509749.1212.366.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1053509749.1212.366.camel@hurina>
User-Agent: Mutt/1.5.4i
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 21 May 2003 11:58:08 -0000
X-UID: 799                                                  
Status: O
Content-Length: 1137

On Wed, May 21, 2003 at 12:35:49PM +0300, Timo Sirainen wrote:
> On Wed, 2003-05-21 at 12:26, Charlie Allom wrote:
> > > Oh! I got it :) The linker optimizes that function away since it's not
> > > used elsewhere. Well, I'll include that function into the drac.c.
> > > Updated http://dovecot.procontrol.fi/patches/drac.c
> 
> > dlopen(/usr/pkg/lib/dovecot/imap/drac.so) failed:
> > /usr/pkg/lib/dovecot/imap/drac.so: Undefined PLT symbol "i_error"
> > (symnum = 22)
> 
> Well, I think the module stuff is somehow broken with your system then.
> And I think I'll revert the net_addr2ip() change too since it's probably
> the same reason :)
> 
> When linking imap binary, does it include -Wl,--export-dynamic option
> somewhere in the gcc line?

no.

> diff -u -r1.33 main.c
> --- main.c      14 May 2003 18:23:04 -0000      1.33
> +++ main.c      21 May 2003 09:35:06 -0000
> @@ -10,6 +10,7 @@
>  #include "module-dir.h"
>  #include "mail-storage.h"
>  #include "commands.h"
> +#include "drac.c"

Cheers.

-- 
 charlie@rubberduck.com - Melbourne, Australia
 http://rubberduck.com/~yeled/
 PGP: 0x14AA7941 || finger yeled@lazy.spodder.com
From mem@mv.mv.com  Thu May 22 18:25:27 2003
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id BF27F238C6; Thu, 22 May 2003 18:25:27 +0300 (EEST)
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id 6605A23887
	for <dovecot@procontrol.fi>; Thu, 22 May 2003 18:24:53 +0300 (EEST)
Received: (qmail 3886 invoked by uid 101); 22 May 2003 11:24:31 -0400
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Thu, 22 May 2003 11:24:30 -0400
To: dovecot@procontrol.fi
Message-ID: <20030522152430.GP23209@iridium.mv.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.4.1i
Subject: [Dovecot] possible dovecot problem (fwd)
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Thu, 22 May 2003 15:25:28 -0000
X-UID: 800                                                  
Status: O
Content-Length: 6649

I'm just forwarding this verbatim from somebody who works here.
Comments ?

mm

----- Forwarded message from Dave Chamberlain <davec@mv.mv.com> -----

> Subject: possible dovecot problem
> From: "Dave Chamberlain" <davec@mv.mv.com>
> Date: Tue, 20 May 2003 21:29:48 -0400 (EDT)
> To: mem@mv.mv.com (Mark E. Mallett)
> 
> Ok, I'm kind of confused at what dovecot's imap implementation is doing.
> 
> I seem to be spending more time than I need to correctly decipher the headers of
> email messages.
> 
> I have included here the text from 7.4.2 as it explains the response from a
> fetch of an ENVELOPE.  The last paragraph specifies that the FROM, SENDER
> and REPLYTO fields cannot be nil because some of them must be present per
> RFC822 and the IMAP spec will default values.  I have many examples where
> this is not the case, where the fetch of the envelope is returning NIL for
> some of these values.
> 
> In the example below, the message shows that the from, replyto and sender
> are all set to jaentc@aukware.com (ok, a spelling error, but that was her
> typing it in wrong).  The next field after those three is NIL, that is the
> TO line (more of my text after the IMAP conversation)
> 
>   a uid fetch 902 ENVELOPE
>   * 113 EXISTS
>   * 1 RECENT
>   * 104 FETCH (UID 902 ENVELOPE ("Tue, 20 May 2003 16:05:04 -0500" "From A Friend:
>   'TheWMURChannel.com  - News - Law Raises Age Children Must Be In Seat Restraints'"
>   (("Janet" NIL "jaentc" "aukware.com")) 
>   (("Janet" NIL "jaentc" "aukware.com")) 
>   (("Janet" NIL "jaentc" "aukware.com")) NIL NIL NIL NIL 
>   "<200305202105.h4KL5xo20860@qbert.ibsys.com>"))
> 
> Following is the complete header from the message.  There is a valid To address
> supplied, and it is in one of the allowed formats.  I would have thought that
> possibly it was the format that was causing the problem.  I first theorized that
> it didn't understand the emailaddress (personalname) format.  However, the 
> From field is in that format, and was correctly picked up (notice that "Janet"
> exists above as the Personal name, so it did understand that format).
> 
> I have found multple cases where the FROM was NIL, the SUBJECT was NIL and
> the TO is NIL, yet when looking at the header they are visible.  
> 
> This is causing problems with more than just my things, OE is having a problem
> with it as well.
> 
> 
> 
> 
> >From jaentc@aukware.com Tue May 20 21:26:43 2003 UTC
> Received: (qmail 24772 invoked from network); 20 May 2003 17:52:17 -0400
> Received: from iridium.mv.net (HELO mv.mv.com) (qmailr@199.125.85.17)
>   by mercury.mv.net with SMTP; 20 May 2003 17:52:17 -0400
> X-Peer-Info: remote-ip 199.125.85.17 local-ip 199.125.85.40
>   local-name mercury.mv.net
> Received: (qmail 21564 invoked by uid 134); 20 May 2003 17:26:53 -0400
> Delivered-To: davec@mv.com
> Received: (qmail 3533 invoked from network); 20 May 2003 17:06:26 -0400
> Received: from qbert.ibsys.com (66.187.197.24)
>   by iridium.mv.net with SMTP; 20 May 2003 17:06:26 -0400
> X-Peer-Info: remote-ip 66.187.197.24 local-ip 199.125.85.17
>   local-name iridium.mv.net
> Received: from 10.0.0.24 (cfusion3.ibsys.com [10.3.0.53])
> 	by qbert.ibsys.com (Switch-2.1.0/Switch-2.1.0) with ESMTP id h4KL5xo20860
> 	for <davec@mv.com (Dave)> Tue, 20 May 2003 16:05:59 -0500 (CDT)
> Message-Id: <200305202105.h4KL5xo20860@qbert.ibsys.com>
> Content-type: text/plain
> Date: Tue, 20 May 2003 16:05:04 -0500
> From: jaentc@aukware.com (Janet)
> Subject: From A Friend: 'TheWMURChannel.com  - News - Law Raises Age Children Must Be
> In Seat Restraints'
> To: davec@mv.com (Dave)
> 
> 
> Section 7.4.2
> 
>       ENVELOPE
>          A parenthesized list that describes the envelope structure of a
>          message.  This is computed by the server by parsing the
>          [RFC-2822] header into the component parts, defaulting various
>          fields as necessary.
> 
>          The fields of the envelope structure are in the following
>          order: date, subject, from, sender, reply-to, to, cc, bcc,
>          in-reply-to, and message-id.  The date, subject, in-reply-to,
>          and message-id fields are strings.  The from, sender, reply-to,
>          to, cc, and bcc fields are parenthesized lists of address
>          structures.
> 
>          An address structure is a parenthesized list that describes an
>          electronic mail address.  The fields of an address structure
>          are in the following order: personal name, [SMTP]
>          at-domain-list (source route), mailbox name, and host name.
> 
>          [RFC-2822] group syntax is indicated by a special form of
>          address structure in which the host name field is NIL.  If the
>          mailbox name field is also NIL, this is an end of group marker
>          (semi-colon in RFC 822 syntax).  If the mailbox name field is
>          non-NIL, this is a start of group marker, and the mailbox name
>          field holds the group name phrase.
> 
>          If the Date, Subject, In-Reply-To, and Message-ID header lines
>          are absent in the [RFC-2822] header, the corresponding member
>          of the envelope is NIL; if these header lines are present but
>          empty the corresponding member of the envelope is the empty
>          string.
> 
>             Note: some servers may return a NIL envelope member in the
>             "present but empty" case.  Clients SHOULD treat NIL and
>             empty string as identical.
> 
>             Note: [RFC-2822] requires that all messages have a valid
>             Date header.  Therefore, the date member in the envelope can
>             not be NIL or the empty string.
> 
>             Note: [RFC-2822] requires that the In-Reply-To and
>             Message-ID headers, if present, have non-empty content.
>             Therefore, the in-reply-to and message-id members in the
>             envelope can not be the empty string.
> 
>          If the From, To, cc, and bcc header lines are absent in the
>          [RFC-2822] header, or are present but empty, the corresponding
>          member of the envelope is NIL.
> 
>          If the Sender or Reply-To lines are absent in the [RFC-2822]
>          header, or are present but empty, the server sets the
>          corresponding member of the envelope to be the same value as
>          the from member (the client is not expected to know to do
>          this).
> 
>             Note: [RFC-2822] requires that all messages have a valid
>             From header.  Therefore, the from, sender, and reply-to
>             members in the envelope can not be NIL.

----- End forwarded message -----
From kaw@wilberforce.ac.uk  Thu May 22 23:01:17 2003
Return-Path: <kaw@wilberforce.ac.uk>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 8D64423865; Thu, 22 May 2003 23:01:17 +0300 (EEST)
Received: from descartes.wilberforce.ac.uk (unknown [195.195.239.232])
	by danu.procontrol.fi (Postfix) with ESMTP id BE0862384C
	for <dovecot@procontrol.fi>; Thu, 22 May 2003 23:00:44 +0300 (EEST)
Received: from wilberforce.ac.uk (descartes.wilberforce.ac.uk [192.168.100.3])
	h4MK0OpZ012018
	for <dovecot@procontrol.fi>; Thu, 22 May 2003 21:00:25 +0100
Received: from 213.249.172.93
        (SquirrelMail authenticated user kaw)
        by descartes.wilberforce.ac.uk with HTTP;
        Thu, 22 May 2003 21:00:25 +0100 (BST)
Message-ID: <4608.213.249.172.93.1053633625.squirrel@descartes.wilberforce.ac.uk>
Date: Thu, 22 May 2003 21:00:25 +0100 (BST)
From: "Ken Wilson" <kaw@wilberforce.ac.uk>
To: <dovecot@procontrol.fi>
X-Priority: 3
Importance: Normal
X-Mailer: SquirrelMail (version 1.2.9)
MIME-Version: 1.0
Content-Type: text/; charset=iso-8859-1
Content-Transfer-Encoding: 8bit
X-MailScanner: Found to be clean
X-MailScanner-SpamScore: s
X-Mailman-Approved-At: Thu, 22 May 2003 23:31:07 +0300
Subject: [Dovecot] Dovecot and SquirrelMail
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Thu, 22 May 2003 20:01:17 -0000
X-UID: 801                                                  
Status: O

Hello,

Does anyone know how to get dovecot working with squirrelmail v1.4? We
have an existing uw-imap setup, with mail stored in ~/mail and inboxes in
/var/spool/mail/user. I've tried setting $imap_server_type = other in
squirrelmail, but I do not see any mail in my inbox.

This is my setting in dovecot.conf

default_mail_env = maildir:~/mail/:INBOX=/var/spool/mail/%n

Any help would be grealty appreciated, as I want to leave uw-imap and get
the speed increases that dovecot offers.

Thanks

Ken


All e-mail from Wilberforce College is governed by our legal disclaimer
which is available at http://webmail.wilberforce.ac.uk/disclaimer.txt


From lfarkas@bnap.hu  Thu May 22 23:42:25 2003
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 9C315238C5; Thu, 22 May 2003 23:42:25 +0300 (EEST)
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 37E6123865
	for <dovecot@procontrol.fi>; Thu, 22 May 2003 23:41:53 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id 2E4EE754014
	for <dovecot@procontrol.fi>; Thu, 22 May 2003 22:41:30 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id E5EB33EB1
	for <dovecot@procontrol.fi>; Thu, 22 May 2003 22:41:50 +0200 (CEST)
Received: from bnap.hu (eagle.int.bppiac.hu [192.168.255.2])
	by mail2.bppiac.hu (Postfix) with ESMTP id 2F1313EB0
	for <dovecot@procontrol.fi>; Thu, 22 May 2003 22:41:50 +0200 (CEST)
Message-ID: <3ECD360D.8090604@bnap.hu>
Date: Thu, 22 May 2003 22:41:49 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20021218
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: Re: [Dovecot] Dovecot and SquirrelMail problems...
References: <4608.213.249.172.93.1053633625.squirrel@descartes.wilberforce.ac.uk>
In-Reply-To: <4608.213.249.172.93.1053633625.squirrel@descartes.wilberforce.ac.uk>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Thu, 22 May 2003 20:42:25 -0000
X-UID: 802                                                  
Status: O

Ken Wilson wrote:
> Hello,
> 
> Does anyone know how to get dovecot working with squirrelmail v1.4? We
> have an existing uw-imap setup, with mail stored in ~/mail and inboxes in
> /var/spool/mail/user. I've tried setting $imap_server_type = other in
> squirrelmail, but I do not see any mail in my inbox.
> 
> This is my setting in dovecot.conf
> 
> default_mail_env = maildir:~/mail/:INBOX=/var/spool/mail/%n
> 
> Any help would be grealty appreciated, as I want to leave uw-imap and get
> the speed increases that dovecot offers.

actualy we use it for a while, BUT we've got an erro here too.
those message which has empty body (even if they has attachments), can 
be seen in a mailer, but it can't be seen in squirelmail (it's not even 
listed in the folder!!!). it's a dovecot or squirelmail bug?
and it's another serious problem since the user can't understand it.
any tipp?

-- 
   Levente                               "Si vis pacem para bellum!"


From tss@iki.fi  Thu May 22 23:42:29 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id B66C9238C9; Thu, 22 May 2003 23:42:29 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id E21E323866
	for <dovecot@procontrol.fi>; Thu, 22 May 2003 23:41:57 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id C1D885C896C6; Thu, 22 May 2003 23:41:57 +0300 (EEST)
Subject: Re: [Dovecot] Dovecot and SquirrelMail
From: Timo Sirainen <tss@iki.fi>
To: Ken Wilson <kaw@wilberforce.ac.uk>
In-Reply-To: <4608.213.249.172.93.1053633625.squirrel@descartes.wilberforce.ac.uk>
References: 
	 <4608.213.249.172.93.1053633625.squirrel@descartes.wilberforce.ac.uk>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1053636117.10909.64.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 22 May 2003 23:41:57 +0300
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Thu, 22 May 2003 20:42:30 -0000
X-UID: 803                                                  
Status: O

On Thu, 2003-05-22 at 23:00, Ken Wilson wrote:
> Does anyone know how to get dovecot working with squirrelmail v1.4? We
> have an existing uw-imap setup, with mail stored in ~/mail and inboxes in
> /var/spool/mail/user. I've tried setting $imap_server_type = other in
> squirrelmail, but I do not see any mail in my inbox.
> 
> This is my setting in dovecot.conf
> 
> default_mail_env = maildir:~/mail/:INBOX=/var/spool/mail/%n

If you were using uw-imap, you'll probably have your mails in mbox
format, not maildir? If you want mixed mode mbox-INBOX / maildir-others
it's not possible yet.

From tss@iki.fi  Fri May 23 00:12:34 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 04FB923866; Fri, 23 May 2003 00:12:34 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 3758F23865
	for <dovecot@procontrol.fi>; Fri, 23 May 2003 00:12:01 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 10AA55C896C6; Fri, 23 May 2003 00:12:01 +0300 (EEST)
Subject: Re: [Dovecot] possible dovecot problem (fwd)
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030522152430.GP23209@iridium.mv.net>
References: <20030522152430.GP23209@iridium.mv.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1053637920.10917.76.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 23 May 2003 00:12:00 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Thu, 22 May 2003 21:12:34 -0000
X-UID: 804                                                  
Status: O

On Thu, 2003-05-22 at 18:24, Mark E. Mallett wrote:
> I'm just forwarding this verbatim from somebody who works here.
> Comments ?

I can't reproduce this. I tested with the headers in your mail and it
gave correct result. I also compared Dovecot's and uw-imap's output for
mailbox with 4600 mails, and output was pretty much the same.

Maybe Dovecot is parsing the headers wrong in some conditions. Can you
reproduce this in some way? The invalid envelope headers are probably
cached in index file, deleting that should probably fix this for at
least the old messages?

From mem@mv.mv.com  Fri May 23 00:33:01 2003
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id AA0C023866; Fri, 23 May 2003 00:33:01 +0300 (EEST)
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id 544C22384C
	for <dovecot@procontrol.fi>; Fri, 23 May 2003 00:32:29 +0300 (EEST)
Received: (qmail 24767 invoked by uid 101); 22 May 2003 17:31:40 -0400
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Thu, 22 May 2003 17:31:40 -0400
To: Timo Sirainen <tss@iki.fi>
Subject: Re: [Dovecot] possible dovecot problem (fwd)
Message-ID: <20030522213140.GI677@iridium.mv.net>
References: <20030522152430.GP23209@iridium.mv.net>
	<1053637920.10917.76.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1053637920.10917.76.camel@hurina>
User-Agent: Mutt/1.4.1i
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Thu, 22 May 2003 21:33:01 -0000
X-UID: 805                                                  
Status: O

On Fri, May 23, 2003 at 12:12:00AM +0300, Timo Sirainen wrote:
> On Thu, 2003-05-22 at 18:24, Mark E. Mallett wrote:
> > I'm just forwarding this verbatim from somebody who works here.
> > Comments ?
> 
> I can't reproduce this. I tested with the headers in your mail and it
> gave correct result. I also compared Dovecot's and uw-imap's output for
> mailbox with 4600 mails, and output was pretty much the same.
> 
> Maybe Dovecot is parsing the headers wrong in some conditions. Can you
> reproduce this in some way? The invalid envelope headers are probably
> cached in index file, deleting that should probably fix this for at
> least the old messages?

Deleting the index files was the first thing I tried.

Strange.

mm
From mem@mv.mv.com  Fri May 23 01:21:14 2003
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 7AF08238C5; Fri, 23 May 2003 01:21:14 +0300 (EEST)
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id D61D023865
	for <dovecot@procontrol.fi>; Fri, 23 May 2003 01:20:41 +0300 (EEST)
Received: (qmail 20317 invoked by uid 101); 22 May 2003 18:06:25 -0400
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Thu, 22 May 2003 18:06:25 -0400
To: Timo Sirainen <tss@iki.fi>
Subject: Re: [Dovecot] possible dovecot problem (fwd)
Message-ID: <20030522220625.GL677@iridium.mv.net>
References: <20030522152430.GP23209@iridium.mv.net>
	<1053637920.10917.76.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1053637920.10917.76.camel@hurina>
User-Agent: Mutt/1.4.1i
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Thu, 22 May 2003 22:21:14 -0000
X-UID: 806                                                  
Status: O
Content-Length: 2699

On Fri, May 23, 2003 at 12:12:00AM +0300, Timo Sirainen wrote:
> On Thu, 2003-05-22 at 18:24, Mark E. Mallett wrote:
> > I'm just forwarding this verbatim from somebody who works here.
> > Comments ?
> 
> I can't reproduce this. I tested with the headers in your mail and it
> gave correct result. I also compared Dovecot's and uw-imap's output for
> mailbox with 4600 mails, and output was pretty much the same.
> 
> Maybe Dovecot is parsing the headers wrong in some conditions. Can you
> reproduce this in some way? The invalid envelope headers are probably
> cached in index file, deleting that should probably fix this for at
> least the old messages?

I was able to reproduce it without any effort. 

First let me ask the obvious thing.. when you filed the sample message
from my original note, did you spot the fact that the "Subject" line
was split into two lines?  You have to recombine the two lines into
one.  (Sorry about that).  Also, remove the "> " characters and,
I guess, save the "From " line at the beginning (although I just
tested it and it doesn't matter if it's there or not).

Here's what I did to reproduce it:

On the target system:

  % rm -rf Maildir
  % maildirmake Maildir
  % cp bad.tmp Maildir/cur/0000.1111.2222.bad

"bad.tmp" is a copy of that message that I forwarded, starting with the
"From" line, or with the first Received line, doesn't matter.  Body of
the message doesn't matter either; I kept all the RFC stuff as the
body.

Now from the source system (and here is a cut and paste of what I just
did, except that I changed the username/password):

  % telnet target-system imap
  Connected to target-system
  Escape character is '^]'.
  * OK dovecot ready.
  1 login user password
  1 OK Logged in.
  2 select "INBOX"
  * FLAGS (\Answered \Flagged \Deleted \Seen \Draft)
  * OK [PERMANENTFLAGS (\Answered \Flagged \Deleted \Seen \Draft \*)] Flags permitted.
  * 1 EXISTS
  * 0 RECENT
  * OK [UNSEEN 1] First unseen.
  * OK [UIDVALIDITY 1053640171] UIDs valid
  * OK [UIDNEXT 2] Predicted next UID
  2 OK [READ-WRITE] Select completed.
  3 fetch 1 ENVELOPE
  * 1 FETCH (ENVELOPE ("Tue, 20 May 2003 16:05:04 -0500" "From A Friend: 'TheWMURCh
  annel.com  - News - Law Raises Age Children Must Be In Seat Restraints'" (("Janet
  " NIL "jaentc" "aukware.com")) (("Janet" NIL "jaentc" "aukware.com")) (("Janet" N
  IL "jaentc" "aukware.com")) NIL NIL NIL NIL "<200305202105.h4KL5xo20860@qbert.ibs
  ys.com>"))
  3 OK Fetch completed.
  4 logout
  * BYE Logging out
  4 OK Logout completed.
  Connection closed by foreign host.

This seems to exactly duplicate the report..

Note: the FETCH response above is wrapped.

Is there something I have got set wrong?

mm
From tss@iki.fi  Fri May 23 02:04:04 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id A5909238C5; Fri, 23 May 2003 02:04:04 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id D480923865
	for <dovecot@procontrol.fi>; Fri, 23 May 2003 02:03:32 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id A521C5C896C6; Fri, 23 May 2003 02:03:32 +0300 (EEST)
Subject: Re: [Dovecot] possible dovecot problem (fwd)
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030522220625.GL677@iridium.mv.net>
References: <20030522152430.GP23209@iridium.mv.net>
	<20030522220625.GL677@iridium.mv.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1053644612.10918.99.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 23 May 2003 02:03:32 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Thu, 22 May 2003 23:04:04 -0000
X-UID: 807                                                  
Status: O
Content-Length: 1397

On Fri, 2003-05-23 at 01:06, Mark E. Mallett wrote:
> > Maybe Dovecot is parsing the headers wrong in some conditions. Can you
> > reproduce this in some way? The invalid envelope headers are probably
> > cached in index file, deleting that should probably fix this for at
> > least the old messages?
> 
> I was able to reproduce it without any effort. 

Ah, yes. The "end of header" was treated as duplicate of last header
except with empty value.

Hmm. Maybe I should also handle differently the cases when same header
occurs multiple times.. Or maybe not, RFC2822 doesn't allow them more
than once anyway..

Index: message-parser.c
===================================================================
RCS file: /home/cvs/dovecot/src/lib-mail/message-parser.c,v
retrieving revision 1.39
diff -u -r1.39 message-parser.c
--- message-parser.c    3 May 2003 17:28:20 -0000       1.39
+++ message-parser.c    22 May 2003 23:00:04 -0000
@@ -680,7 +680,8 @@
        if (size == 0 || (size == 1 && msg[0] == '\r')) {
                /* end of headers */
                line->eoh = TRUE;
-               line->name_len = line->value_len = 0;
+               line->name_len = line->value_len = line->full_value_len = 0;
+               line->name = ""; line->value = line->full_value = NULL;
        } else if (line->continued) {
                line->value = msg;
                line->value_len = size;

From mem@mv.mv.com  Fri May 23 04:31:10 2003
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 49BB7238C5; Fri, 23 May 2003 04:31:10 +0300 (EEST)
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id 340EF23866
	for <dovecot@procontrol.fi>; Fri, 23 May 2003 04:30:33 +0300 (EEST)
Received: (qmail 8124 invoked by uid 101); 22 May 2003 21:30:32 -0400
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Thu, 22 May 2003 21:30:32 -0400
To: Timo Sirainen <tss@iki.fi>
Subject: Re: [Dovecot] possible dovecot problem (fwd)
Message-ID: <20030523013032.GA5162@iridium.mv.net>
References: <20030522152430.GP23209@iridium.mv.net>
	<20030522220625.GL677@iridium.mv.net> <1053644612.10918.99.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1053644612.10918.99.camel@hurina>
User-Agent: Mutt/1.4.1i
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 23 May 2003 01:31:10 -0000
X-UID: 808                                                  
Status: O

On Fri, May 23, 2003 at 02:03:32AM +0300, Timo Sirainen wrote:
> On Fri, 2003-05-23 at 01:06, Mark E. Mallett wrote:
> > > Maybe Dovecot is parsing the headers wrong in some conditions. Can you
> > > reproduce this in some way? The invalid envelope headers are probably
> > > cached in index file, deleting that should probably fix this for at
> > > least the old messages?
> > 
> > I was able to reproduce it without any effort. 
> 
> Ah, yes. The "end of header" was treated as duplicate of last header
> except with empty value.
> 
> Hmm. Maybe I should also handle differently the cases when same header
> occurs multiple times.. Or maybe not, RFC2822 doesn't allow them more
> than once anyway..

I don't follow- what duplicates?  It looks like a perfectly ordinary
header to me, what am I missing?

mm
From tss@iki.fi  Fri May 23 12:20:00 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 3AE2B238CB; Fri, 23 May 2003 12:20:00 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id A259223866
	for <dovecot@procontrol.fi>; Fri, 23 May 2003 12:19:56 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 6CFFD5C896C6; Fri, 23 May 2003 12:19:56 +0300 (EEST)
Subject: Re: [Dovecot] possible dovecot problem (fwd)
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030523013032.GA5162@iridium.mv.net>
References: <20030522152430.GP23209@iridium.mv.net>
	<1053644612.10918.99.camel@hurina>
	<20030523013032.GA5162@iridium.mv.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1053681595.10918.120.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 23 May 2003 12:19:56 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 23 May 2003 09:20:00 -0000
X-UID: 809                                                  
Status: O

On Fri, 2003-05-23 at 04:30, Mark E. Mallett wrote:
> > Ah, yes. The "end of header" was treated as duplicate of last header
> > except with empty value.
> I don't follow- what duplicates?  It looks like a perfectly ordinary
> header to me, what am I missing?

Not real duplicate. But Dovecot was treating like the last header always
appeared twice, but second time without value. Like:

.. headers ..
To: foo@bar
To:

.. body ..
From bob@cemetery.homeunix.org  Fri May 23 17:23:20 2003
Return-Path: <bob@cemetery.homeunix.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 8BD2C238CB; Fri, 23 May 2003 17:23:20 +0300 (EEST)
Received: from cemetery.homeunix.org (joeldriver.plus.com [212.159.87.165])
	by danu.procontrol.fi (Postfix) with ESMTP id 3911723865
	for <dovecot@procontrol.fi>; Fri, 23 May 2003 17:23:16 +0300 (EEST)
Received: from snot (snot.flatnet [192.168.0.8])
	by cemetery.homeunix.org (8.12.9/8.12.6) with SMTP id h4NEN7r4019999
	for <dovecot@procontrol.fi>; Fri, 23 May 2003 15:23:07 +0100 (BST)
Date: Fri, 23 May 2003 15:23:03 +0100
From: Andrew Basterfield <bob@cemetery.homeunix.org>
To: dovecot@procontrol.fi
Message-Id: <20030523152303.5644f895.bob@cemetery.homeunix.org>
X-Mailer: Sylpheed version 0.8.11claws (GTK+ 1.2.10; i586-pc-linux-gnu)
Mime-Version: 1.0
Content-Type: multipart/signed; protocol="application/pgp-signature";
 micalg="pgp-sha1"; boundary="=.TgS9Hcr3I3?Yl)"
Subject: [Dovecot] Dovecot in OpenBSD ports system
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 23 May 2003 14:23:20 -0000
X-UID: 810                                                  
Status: O

--=.TgS9Hcr3I3?Yl)
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

Hi

I have put together dovecot port for the OpenBSD ports system. The port
has yet to be submitted, but is finished awaiting testing from a wider
audience. I have been using dovecot successfully on OpenBSD/sparc64
-current for months now with no problems.

Would you recommend including the CR+LF patch?

http://cemetery.homeunix.org/OpenBSD/dovecot.tar.gz

-- 
http://cemetery.homeunix.org

--=.TgS9Hcr3I3?Yl)
Content-Type: application/pgp-signature

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.1 (GNU/Linux)

iD8DBQE+zi7Lj3ZMDwYLJGARAt/PAJ4+Of5NNHUVsCVpxBD1SxNBvD70mgCfeml8
X626asWtidWLSWokMexzepw=
=yK6L
-----END PGP SIGNATURE-----

--=.TgS9Hcr3I3?Yl)--
From mem@mv.mv.com  Fri May 23 18:20:56 2003
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id A470F238CB; Fri, 23 May 2003 18:20:56 +0300 (EEST)
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id DFF3F23866
	for <dovecot@procontrol.fi>; Fri, 23 May 2003 18:20:48 +0300 (EEST)
Received: (qmail 17954 invoked by uid 101); 23 May 2003 11:20:44 -0400
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Fri, 23 May 2003 11:20:44 -0400
To: Timo Sirainen <tss@iki.fi>
Subject: Re: [Dovecot] possible dovecot problem (fwd)
Message-ID: <20030523152044.GD8005@iridium.mv.net>
References: <20030522152430.GP23209@iridium.mv.net>
	<1053644612.10918.99.camel@hurina> <20030523013032.GA5162@iridium.mv.net>
	<1053681595.10918.120.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1053681595.10918.120.camel@hurina>
User-Agent: Mutt/1.4.1i
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 23 May 2003 15:20:57 -0000
X-UID: 811                                                  
Status: O

On Fri, May 23, 2003 at 12:19:56PM +0300, Timo Sirainen wrote:
> On Fri, 2003-05-23 at 04:30, Mark E. Mallett wrote:
> > > Ah, yes. The "end of header" was treated as duplicate of last header
> > > except with empty value.
> > I don't follow- what duplicates?  It looks like a perfectly ordinary
> > header to me, what am I missing?
> 
> Not real duplicate. But Dovecot was treating like the last header always
> appeared twice, but second time without value. Like:
> 
> .. headers ..
> To: foo@bar
> To:
> 
> .. body ..

Oh, I see what you mean.  So if it happened that "To" came last, there
was a problem- but if something innocuous was last, there was not?

Interesting.  The patch does appear to fix the reported issue.

BTW when I first applied the patch, the imap server hung trying to fetch
the body.  Cleared the .imap* files and this did not happen again.

mm
From mike@skew.org  Mon May 26 08:33:04 2003
Return-Path: <mike@skew.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 8F8D923896; Mon, 26 May 2003 08:33:04 +0300 (EEST)
Received: from chilled.skew.org (skew.org [65.101.207.237])
	by danu.procontrol.fi (Postfix) with ESMTP id B157B2387F
	for <dovecot@procontrol.fi>; Mon, 26 May 2003 08:33:01 +0300 (EEST)
Received: from chilled.skew.org (localhost.skew.org [127.0.0.1])
	by chilled.skew.org (8.12.6p2/8.12.7) with ESMTP id h4Q5X2CZ035304
	for <dovecot@procontrol.fi>; Sun, 25 May 2003 23:33:02 -0600 (MDT)
	(envelope-from mike@chilled.skew.org)
Received: (from mike@localhost)
	by chilled.skew.org (8.12.6p2/8.12.7/Submit) id h4Q5X2Po035303
	for dovecot@procontrol.fi; Sun, 25 May 2003 23:33:02 -0600 (MDT)
From: Mike Brown <mike@skew.org>
Message-Id: <200305260533.h4Q5X2Po035303@chilled.skew.org>
To: dovecot@procontrol.fi
Date: Sun, 25 May 2003 23:33:02 -0600 (MDT)
X-Whoa: whoa.
X-Mailer: ELM [version 2.4ME+ PL90 (25)]
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Content-Type: text/plain; charset=US-ASCII
X-Spam-Status: No, hits=0.8 required=5.0
	tests=SPAM_PHRASE_00_01
	version=2.43
Subject: [Dovecot] pop3 timeout when sending first message
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 26 May 2003 05:33:04 -0000
X-UID: 812                                                  
Status: O
Content-Length: 1085

I'm using FreeBSD 4.8 with dovecot from the ports collection.

First I am first trying to fetch mail via POP3. Clients are both OE6 and
Mozilla. Both exhibit the same behavior: the client says it is receiving
message 1 of (however many), but nothing happens; no message data is
transferred. Mozilla seems to keep waiting forever, but OE6 times out after 60
seconds and lets me stop waiting.

I tried both with and without SSL. Authentication works fine in either case,
but the mail xfer just doesn't work.

There's nothing of interest in the logs. By the way, there seems to be no
mention of what syslog facility is used by dovecot. What is it? I'm avoiding
syslog for now and writing to specific files.

In the info log I get this when the client logs in:

  pop3-login: May 25 23:10:44 Info: Login: mike [my.IP.addr.here]

In the other log I get this when OE6 disconnects, following the timeout and
prompting me to wait or stop:

  pop3-login: May 25 23:11:53 Warning: SSL_read() syscall failed: EOF [216.241.45.45]

I'm not sure what else to do to try to debug this...

Help?

-Mike
From jens.laas@data.slu.se  Mon May 26 11:46:57 2003
Return-Path: <jens.laas@data.slu.se>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id DAD6F23896; Mon, 26 May 2003 11:46:57 +0300 (EEST)
Received: from mail1.slu.se (mail1.slu.se [130.238.96.11])
	by danu.procontrol.fi (Postfix) with ESMTP id 47EF323865
	for <dovecot@procontrol.fi>; Mon, 26 May 2003 11:46:55 +0300 (EEST)
Received: from jlaas2.data.slu.se (jlaas2.data.slu.se [130.238.98.68])
	by mail1.slu.se (8.9.3p2/8.9.3) with ESMTP id KAA10859
	for <dovecot@procontrol.fi>; Mon, 26 May 2003 10:46:50 +0200
Date: Mon, 26 May 2003 10:46:55 +0200 (CEST)
From: Jens Laas <jens.laas@data.slu.se>
X-X-Sender: jensl@jlaas2.data.slu.se
To: dovecot@procontrol.fi
Message-ID: <Pine.LNX.4.55.0305261015540.5124@jlaas2.data.slu.se>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=ISO-8859-1
Content-Transfer-Encoding: 8BIT
X-Mailman-Approved-At: Mon, 26 May 2003 13:19:21 +0300
Subject: [Dovecot] logging in POP3
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 26 May 2003 08:46:58 -0000
X-UID: 813                                                  
Status: O
Content-Length: 2165


I have begun testing dovecot as (primarly) a POP replacement.

So far the only lacking bit is the logging.

It would be great if pop3 could log a line at client exit with the
following info: (wishlist follows :)

o nr deleted mails + total bytes deletes
o nr mails left in spool + bytes left
o time spent
o indication if TLS was used or not

If you would lika generic logging API I have one you can use:
(Only tested under Linux. It is GPL)

http://robur.slu.se/jensl/jellog.tar.gz

Excerpt from headerfile:

/*
  Functions for setting the destination of logger_facilities.
  - filename is the file to append log entries to. If file does not exist
it
    is created with umask 0666 (modified as usual by open() call).
  - filestream is the FILE stream to use.
  - fd is the filedescriptor to use.
  - priority is the syslog priority to use as used in the syslog() call.
  - timestamp is used as a boolean. True means begin line with a
timestamp.
*/
int logger_set_file(logger_facility facility, char *filename, int
timestamp);
int logger_set_iostream(logger_facility facility,
			FILE *filestream, int timestamp);
int logger_set_fd(logger_facility facility, int fd, int timestamp);
int logger_set_syslog(logger_facility facility, int priority, int
timestamp);

/*
  fmt = [sdt]+
  s = string
  d = integer
  t = time-string

  Example: logger( LOGGER_ERROR, "sds", "Errorcode: ", -1234, ".
Aborting!");
  See end of logger.c for more examples.
*/
int logger(logger_facility facility, char *fmt, ...);


Dovecot looks great!
Just thought I'd send you this wishlist.

If you could point me to the right places in the code I am willing to help
adding this myself.

Cheers,
Jens Låås

-----------------------------------------------------------------------
    'This mail automatically becomes portable when carried.'
-----------------------------------------------------------------------
    Jens Låås                              Email: jens.laas@data.slu.se
    Department of Computer Services, SLU   Phone: +46 18 67 35 15
    Vindbrovägen 1
    P.O. Box 7079
    S-750 07 Uppsala
    SWEDEN
-----------------------------------------------------------------------
From rao231@tid.es  Mon May 26 21:01:24 2003
Return-Path: <rao231@tid.es>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 3BFF023896; Mon, 26 May 2003 21:01:24 +0300 (EEST)
Received: from localhost.localdomain (25.Red-80-34-244.pooles.rima-tde.net
	[80.34.244.25])
	by danu.procontrol.fi (Postfix) with ESMTP id EC8A62387F
	for <dovecot@procontrol.fi>; Mon, 26 May 2003 21:01:19 +0300 (EEST)
Received: from tid.es (unknown [127.0.0.1])
	by localhost.localdomain (Postfix) with ESMTP id A1C06F6BFF
	for <dovecot@procontrol.fi>; Mon, 26 May 2003 14:09:00 -0400 (EDT)
Message-ID: <3ED25809.9000109@tid.es>
Date: Mon, 26 May 2003 20:08:09 +0200
From: Ruben Alvarez <rao231@tid.es>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.0.1) Gecko/20020830
X-Accept-Language: en-us, en, es-es
MIME-Version: 1.0
To: dovecot@procontrol.fi
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 8bit
Subject: [Dovecot] Why dovecot is not multi-threaded?
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 26 May 2003 18:01:24 -0000
X-UID: 814                                                  
Status: O

Hi,

I'm looking for the most efficient OpenSource IMAP server
and I am told that Dovecot Server is a good solution.

Anyway, I have inspected the source code and I think Dovecot is not a
multi-threaded server, but a forked server. I am surprised about this
issue, because threads perfomance should be higher than creating a new
process for each connection....I suppose.

So, Could anybody tell me why Dovecot was not designed with
multi-threaded support?.
Perhaps, threads are not a good solution for Dovecot but I am very
interested in which are the reasons for this.

By the other hand, ¿do anybody know any multi-threaded OpenSource IMAP
server?. I would like test performance of Dovecot  server versus a
multi-threaded one.

Very thanks.



From tss@iki.fi  Mon May 26 21:14:19 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id CD575238B6; Mon, 26 May 2003 21:14:19 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 9E7AE23896
	for <dovecot@procontrol.fi>; Mon, 26 May 2003 21:14:14 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 5AFEF5C896C6; Mon, 26 May 2003 21:14:14 +0300 (EEST)
Subject: Re: [Dovecot] Dovecot in OpenBSD ports system
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030523152303.5644f895.bob@cemetery.homeunix.org>
References: <20030523152303.5644f895.bob@cemetery.homeunix.org>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1053972854.2849.37.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 26 May 2003 21:14:14 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 26 May 2003 18:14:20 -0000
X-UID: 815                                                  
Status: O

On Fri, 2003-05-23 at 17:23, Andrew Basterfield wrote:
> Hi
> 
> I have put together dovecot port for the OpenBSD ports system. The port
> has yet to be submitted, but is finished awaiting testing from a wider
> audience. I have been using dovecot successfully on OpenBSD/sparc64
> -current for months now with no problems.
> 
> Would you recommend including the CR+LF patch?

Actually I'd recommend 0.99.10 if I just could get it released.. :)
There's -test6 now at http://dovecot.procontrol.fi/test/ which looks
like it's working fine. Maybe just a few last changes and that'd be it.

From tss@iki.fi  Mon May 26 21:15:53 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 97017238C7; Mon, 26 May 2003 21:15:53 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 53B1D238B6
	for <dovecot@procontrol.fi>; Mon, 26 May 2003 21:15:50 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 2DD995C896C6; Mon, 26 May 2003 21:15:50 +0300 (EEST)
Subject: Re: [Dovecot] pop3 timeout when sending first message
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <200305260533.h4Q5X2Po035303@chilled.skew.org>
References: <200305260533.h4Q5X2Po035303@chilled.skew.org>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1053972949.3131.40.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 26 May 2003 21:15:50 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 26 May 2003 18:15:53 -0000
X-UID: 816                                                  
Status: O

On Mon, 2003-05-26 at 08:33, Mike Brown wrote:
> I'm using FreeBSD 4.8 with dovecot from the ports collection.
> 
> First I am first trying to fetch mail via POP3. Clients are both OE6 and
> Mozilla. Both exhibit the same behavior: the client says it is receiving
> message 1 of (however many), but nothing happens; no message data is
> transferred. Mozilla seems to keep waiting forever, but OE6 times out after 60
> seconds and lets me stop waiting.

Check the POP3 traffic that they're talking. That would tell at least
something. http://dovecot.procontrol.fi/bugreport.html#sniffing

> There's nothing of interest in the logs. By the way, there seems to be no
> mention of what syslog facility is used by dovecot. What is it? I'm avoiding
> syslog for now and writing to specific files.

It's mail.

From tss@iki.fi  Mon May 26 21:29:25 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 3AF4D238D6; Mon, 26 May 2003 21:29:25 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 89E8D23865
	for <dovecot@procontrol.fi>; Mon, 26 May 2003 21:29:23 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 18B975C896C6; Mon, 26 May 2003 21:29:23 +0300 (EEST)
Subject: Re: [Dovecot] logging in POP3
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.55.0305261015540.5124@jlaas2.data.slu.se>
References: <Pine.LNX.4.55.0305261015540.5124@jlaas2.data.slu.se>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1053973762.2849.55.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 26 May 2003 21:29:22 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 26 May 2003 18:29:25 -0000
X-UID: 817                                                  
Status: O

On Mon, 2003-05-26 at 11:46, Jens Laas wrote:
> So far the only lacking bit is the logging.

It's kind of in TODO list.

> It would be great if pop3 could log a line at client exit with the
> following info: (wishlist follows :)
> 
> o nr deleted mails + total bytes deletes
> o nr mails left in spool + bytes left
> o time spent

These could be done with small modifications to src/pop3/*.c. cmd_quit()
deletes the mails so you could calculate the deleted/left mails there.
For time spent you'd just add some variable which gets set to current
time at startup.

Hmm. It would be nice if this all was possible with plugins. I'd rather
not add all kinds of logging hooks all over.. Have to think about this.

> o indication if TLS was used or not

This isn't known by pop3 process at all currently.. It could be
transferred from pop3-login, but that'd require changes to quite a lot
of places.

> If you would lika generic logging API I have one you can use:

I think I have good enough logging API for now :)

From tss@iki.fi  Mon May 26 21:49:48 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 7969723993; Mon, 26 May 2003 21:49:48 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id E077F23865
	for <dovecot@procontrol.fi>; Mon, 26 May 2003 21:49:46 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id A184F5C896C6; Mon, 26 May 2003 21:49:46 +0300 (EEST)
Subject: Re: [Dovecot] Why dovecot is not multi-threaded?
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <3ED25809.9000109@tid.es>
References: <3ED25809.9000109@tid.es>
Content-Type: text/plain; charset=ISO-8859-15
Content-Transfer-Encoding: quoted-printable
Organization: 
Message-Id: <1053974986.3131.76.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 26 May 2003 21:49:46 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 26 May 2003 18:49:48 -0000
X-UID: 818                                                  
Status: O
Content-Length: 1954

On Mon, 2003-05-26 at 21:08, Ruben Alvarez wrote:
> I'm looking for the most efficient OpenSource IMAP server
> and I am told that Dovecot Server is a good solution.
>=20
> Anyway, I have inspected the source code and I think Dovecot is not a
> multi-threaded server, but a forked server. I am surprised about this
> issue, because threads perfomance should be higher than creating a new
> process for each connection....I suppose.

Well, I actually already replied privately to this when it was sent to
imap-list, but here's a more complete answer for everyone:

Threads are useful when you have a lot of data to share across the
threads. For anything else they're not worth the trouble and can
actually be even slower than processes in some cases because of extra
locking it needs. In UNIX that is. In Windows processes are a lot
heavier than threads.

Pretty much the only case in IMAP server when you want to share data is
when a mailbox is opened multiple times by different connections.
Dovecot already shares the data in that case because it's all in the
index files that are mmap()ed.

Processes also provide safety. You can't accidentally read someone
else's mails because of a bug in the server. Or if you happen to learn
how to crash the server, you can kill only your own connection. With
threaded server you would have killed everyone's connections.

> By the other hand, =BFdo anybody know any multi-threaded OpenSource IMAP
> server?. I would like test performance of Dovecot  server versus a
> multi-threaded one.

Biggest performance differences between IMAP servers is how smartly they
store the message data and how smartly they're able to read it in a way
that IMAP clients want them.

CPU usage is pretty irrelevant in IMAP servers. It's I/O that is going
to be your bottleneck. I optimize CPU usage only when it's clearly
showing somewhere (SEARCH BODY is a lot slower than grepping the files,
I'd have to figure out why some day).

From bob@cemetery.homeunix.org  Tue May 27 04:56:17 2003
Return-Path: <bob@cemetery.homeunix.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id A49F823993; Tue, 27 May 2003 04:56:17 +0300 (EEST)
Received: from cemetery.homeunix.org (joeldriver.plus.com [212.159.87.165])
	by danu.procontrol.fi (Postfix) with ESMTP id 53B74238C7
	for <dovecot@procontrol.fi>; Tue, 27 May 2003 04:56:12 +0300 (EEST)
Received: from [192.168.0.8] (snot.flatnet [192.168.0.8])
	by cemetery.homeunix.org (8.12.9/8.12.6) with ESMTP id h4R1u2g6025882
	for <dovecot@procontrol.fi>; Tue, 27 May 2003 02:56:02 +0100 (BST)
Date: Tue, 27 May 2003 02:56:02 +0100
From: Andrew Basterfield <bob@cemetery.homeunix.org>
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] Dovecot in OpenBSD ports system
Message-ID: <27400000.1054000562@[192.168.0.8]>
In-Reply-To: <1053972854.2849.37.camel@hurina>
References: <20030523152303.5644f895.bob@cemetery.homeunix.org>
 <1053972854.2849.37.camel@hurina>
X-Mailer: Mulberry/3.0.3 (Linux/x86)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
Content-Disposition: inline
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Tue, 27 May 2003 01:56:17 -0000
X-UID: 819                                                  
Status: O
Content-Length: 1168



--On Monday, May 26, 2003 21:14:14 +0300 Timo Sirainen <tss@iki.fi> wrote:

> On Fri, 2003-05-23 at 17:23, Andrew Basterfield wrote:
>> Hi
>>
>> I have put together dovecot port for the OpenBSD ports system. The port
>> has yet to be submitted, but is finished awaiting testing from a wider
>> audience. I have been using dovecot successfully on OpenBSD/sparc64
>> -current for months now with no problems.
>>
>> Would you recommend including the CR+LF patch?
>
> Actually I'd recommend 0.99.10 if I just could get it released.. :)
> There's -test6 now at http://dovecot.procontrol.fi/test/ which looks
> like it's working fine. Maybe just a few last changes and that'd be it.

I've run into some probelms with maildirs. I have been testing by dumping
my email archives into the server and I have come across 'Warning:
Inconsistency - Index <index> was rebuilt while we had it open' leading to
the the wrong body being returned when the header is selected. Eventually
the child server process dies.

I have had no problems with mboxes

Should I wait for the next release and try again? Is this problem limited
to my plaform?

The client was sylpheed-claws.

--Andrew
From mike@skew.org  Tue May 27 05:03:47 2003
Return-Path: <mike@skew.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 029DD23998; Tue, 27 May 2003 05:03:47 +0300 (EEST)
Received: from chilled.skew.org (skew.org [65.101.207.237])
	by danu.procontrol.fi (Postfix) with ESMTP id B5D15238C7
	for <dovecot@procontrol.fi>; Tue, 27 May 2003 05:03:42 +0300 (EEST)
Received: from chilled.skew.org (localhost.skew.org [127.0.0.1])
	by chilled.skew.org (8.12.6p2/8.12.7) with ESMTP id h4R23fCZ040123;
	Mon, 26 May 2003 20:03:41 -0600 (MDT)
	(envelope-from mike@chilled.skew.org)
Received: (from mike@localhost)
	by chilled.skew.org (8.12.6p2/8.12.7/Submit) id h4R23fQH040122;
	Mon, 26 May 2003 20:03:41 -0600 (MDT)
From: Mike Brown <mike@skew.org>
Message-Id: <200305270203.h4R23fQH040122@chilled.skew.org>
Subject: Re: [Dovecot] pop3 timeout when sending first message
In-Reply-To: <1053972949.3131.40.camel@hurina> "from Timo Sirainen at May 26,
 2003 09:15:50 pm"
To: Timo Sirainen <tss@iki.fi>
Date: Mon, 26 May 2003 20:03:41 -0600 (MDT)
X-Whoa: whoa.
X-Mailer: ELM [version 2.4ME+ PL90 (25)]
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Content-Type: text/plain; charset=US-ASCII
X-Spam-Status: No, hits=-0.8 required=5.0
	tests=IN_REP_TO,QUOTED_EMAIL_TEXT,SPAM_PHRASE_00_01
	version=2.43
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Tue, 27 May 2003 02:03:47 -0000
X-UID: 820                                                  
Status: O
Content-Length: 1200

Timo Sirainen wrote:
> On Mon, 2003-05-26 at 08:33, Mike Brown wrote:
> > I'm using FreeBSD 4.8 with dovecot from the ports collection.
> > 
> > First I am first trying to fetch mail via POP3. Clients are both OE6 and
> > Mozilla. Both exhibit the same behavior: the client says it is receiving
> > message 1 of (however many), but nothing happens; no message data is
> > transferred. Mozilla seems to keep waiting forever, but OE6 times out after 60
> > seconds and lets me stop waiting.
> 
> Check the POP3 traffic that they're talking. That would tell at least
> something. http://dovecot.procontrol.fi/bugreport.html#sniffing

tcpdump reveals that the first message does get sent.

You can examine the tcpdump output here (I edited out my password):

  http://skew.org/~mike/pop3-moz-tcpdump
  http://skew.org/~mike/pop3-oe6-tcpdump

Is this helpful?

> > There's nothing of interest in the logs. By the way, there seems to be no
> > mention of what syslog facility is used by dovecot. What is it? I'm avoiding
> > syslog for now and writing to specific files.
> 
> It's mail.
> 

Hmm, OK. I'd rather keep my dovecot log separate from my MTA log, so I'll
continue with my current setup.

Thanks!

From tss@iki.fi  Tue May 27 10:11:55 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 04CC3238D6; Tue, 27 May 2003 10:11:55 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 30F1023865
	for <dovecot@procontrol.fi>; Tue, 27 May 2003 10:11:52 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id A79B65C896C6; Tue, 27 May 2003 10:11:48 +0300 (EEST)
Subject: Re: [Dovecot] pop3 timeout when sending first message
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <200305270203.h4R23fQH040122@chilled.skew.org>
References: <200305270203.h4R23fQH040122@chilled.skew.org>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1054019508.2849.166.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 27 May 2003 10:11:48 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Tue, 27 May 2003 07:11:55 -0000
X-UID: 821                                                  
Status: O

On Tue, 2003-05-27 at 05:03, Mike Brown wrote:
> You can examine the tcpdump output here (I edited out my password):
> 
>   http://skew.org/~mike/pop3-moz-tcpdump
>   http://skew.org/~mike/pop3-oe6-tcpdump
> 
> Is this helpful?

Well, I think you broke them while editing :) But I think it's because
your message doesn't end with line feed. Try this patch:

Index: commands.c
===================================================================
RCS file: /home/cvs/dovecot/src/pop3/commands.c,v
retrieving revision 1.7
diff -u -r1.7 commands.c
--- commands.c  1 Feb 2003 11:44:40 -0000       1.7
+++ commands.c  27 May 2003 07:10:27 -0000
@@ -264,6 +264,11 @@
 
                i_stream_skip(input, i);
        }
+
+       if (last != '\n') {
+               /* didn't end with CRLF */
+               (void)o_stream_send(output, "\r\n", 2);
+       }
 }
 
 static void fetch(struct client *client, unsigned int msgnum,

From mike@skew.org  Tue May 27 10:22:16 2003
Return-Path: <mike@skew.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 431AA238D6; Tue, 27 May 2003 10:22:16 +0300 (EEST)
Received: from chilled.skew.org (skew.org [65.101.207.237])
	by danu.procontrol.fi (Postfix) with ESMTP id 3C16F238C7
	for <dovecot@procontrol.fi>; Tue, 27 May 2003 10:22:12 +0300 (EEST)
Received: from chilled.skew.org (localhost.skew.org [127.0.0.1])
	by chilled.skew.org (8.12.6p2/8.12.7) with ESMTP id h4R7MBCZ042199;
	Tue, 27 May 2003 01:22:11 -0600 (MDT)
	(envelope-from mike@chilled.skew.org)
Received: (from mike@localhost)
	by chilled.skew.org (8.12.6p2/8.12.7/Submit) id h4R7MBNB042198;
	Tue, 27 May 2003 01:22:11 -0600 (MDT)
From: Mike Brown <mike@skew.org>
Message-Id: <200305270722.h4R7MBNB042198@chilled.skew.org>
Subject: Re: [Dovecot] pop3 timeout when sending first message
In-Reply-To: <1054019508.2849.166.camel@hurina> "from Timo Sirainen at May 27,
 2003 10:11:48 am"
To: Timo Sirainen <tss@iki.fi>
Date: Tue, 27 May 2003 01:22:11 -0600 (MDT)
X-Whoa: whoa.
X-Mailer: ELM [version 2.4ME+ PL90 (25)]
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Content-Type: text/plain; charset=US-ASCII
X-Spam-Status: No, hits=-0.8 required=5.0
	tests=IN_REP_TO,QUOTED_EMAIL_TEXT,SPAM_PHRASE_00_01
	version=2.43
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Tue, 27 May 2003 07:22:16 -0000
X-UID: 822                                                  
Status: O

Timo Sirainen wrote:
> Well, I think you broke them while editing :) But I think it's because
> your message doesn't end with line feed. Try this patch:
> 
> Index: commands.c
> ===================================================================
> RCS file: /home/cvs/dovecot/src/pop3/commands.c,v
> retrieving revision 1.7
> diff -u -r1.7 commands.c
> --- commands.c  1 Feb 2003 11:44:40 -0000       1.7
> +++ commands.c  27 May 2003 07:10:27 -0000
> @@ -264,6 +264,11 @@
>  
>                 i_stream_skip(input, i);
>         }
> +
> +       if (last != '\n') {
> +               /* didn't end with CRLF */
> +               (void)o_stream_send(output, "\r\n", 2);
> +       }
>  }
>  
>  static void fetch(struct client *client, unsigned int msgnum,

That worked! The problem is solved!

Thanks!!

-Mike
From maikel@ladot.com  Tue May 27 10:43:22 2003
Return-Path: <maikel@ladot.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id E58A323896; Tue, 27 May 2003 10:43:22 +0300 (EEST)
Received: from zeus.ladot.com (office.ladot.com [217.22.64.134])
	by danu.procontrol.fi (Postfix) with ESMTP id 3235E23865
	for <dovecot@procontrol.fi>; Tue, 27 May 2003 10:43:20 +0300 (EEST)
Received: from nlladot05.freehosting (nlladot05.intern.ladot.com
	[172.31.2.13])
	by zeus.ladot.com (8.12.9/8.12.9) with ESMTP id h4R7t5MN079963
	for <dovecot@procontrol.fi>; Tue, 27 May 2003 09:55:05 +0200 (CEST)
	(envelope-from maikel@ladot.com)
Received: by nlladot05.intern.ladot.com with Internet Mail Service
	(5.5.2653.19)	id <LP1BV0WV>; Tue, 27 May 2003 09:43:05 +0200
Message-ID: <410777FC7A66D511911500B0D078345501F2240A@nlladot05.intern.ladot.com>
From: Maikel Verheijen <maikel@ladot.com>
To: "'Dovecot (E-mail)'" <dovecot@procontrol.fi>
Date: Tue, 27 May 2003 09:43:04 +0200
MIME-Version: 1.0
X-Mailer: Internet Mail Service (5.5.2653.19)
Content-Type: multipart/alternative;
	boundary="----_=_NextPart_001_01C32423.9B247960"
X-Spam-Status: No, hits=1.3 required=5.0
	tests=HTML_20_30,HTML_MESSAGE
	version=2.55
X-Spam-Level: *
X-Spam-Checker-Version: SpamAssassin 2.55 (1.174.2.19-2003-05-19-exp)
Subject: [Dovecot] Postgres "issue"
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Tue, 27 May 2003 07:43:23 -0000
X-UID: 823                                                  
Status: O
Content-Length: 2694

This message is in MIME format. Since your mail reader does not understand
this format, some or all of this message may not be legible.

------_=_NextPart_001_01C32423.9B247960
Content-Type: text/plain

Dear list,


I have a small issue with dovecot talking to a postgresql server:

If my postgres server get restarted, dovecot fails to reconnect to the
postgres server.

I run dovecot 0.99.9.1 (which is actually a cvs version of dovecot, of may 9
2003)

I have the same postgres version for the server as I use for the libraries.

Is it hard to get auto-reconnect to work?


Kind regards,


Maikel Verheijen


Ps: the log message I get is this:

May 22 17:33:01 testlfw3 dovecot-auth: PGSQL: Query "SELECT password FROM
aliases WHERE alias = 'maikel@test.com' AND password != ''" failed: FATAL 1:
This connection has been terminated by the administrator. server closed the
connection unexpectedly ^IThis probably means the server terminated
abnormally ^Ibefore or while processing the request. 

Which probably describes it all :)

------_=_NextPart_001_01C32423.9B247960
Content-Type: text/html
Content-Transfer-Encoding: quoted-printable

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV=3D"Content-Type" CONTENT=3D"text/html; =
charset=3Dus-ascii">
<META NAME=3D"Generator" CONTENT=3D"MS Exchange Server version =
5.5.2653.12">
<TITLE>Postgres &quot;issue&quot;</TITLE>
</HEAD>
<BODY>

<P><FONT SIZE=3D2>Dear list,</FONT>
</P>
<BR>

<P><FONT SIZE=3D2>I have a small issue with dovecot talking to a =
postgresql server:</FONT>
</P>

<P><FONT SIZE=3D2>If my postgres server get restarted, dovecot fails to =
reconnect to the postgres server.</FONT>
</P>

<P><FONT SIZE=3D2>I run dovecot 0.99.9.1 (which is actually a cvs =
version of dovecot, of may 9 2003)</FONT>
</P>

<P><FONT SIZE=3D2>I have the same postgres version for the server as I =
use for the libraries.</FONT>
</P>

<P><FONT SIZE=3D2>Is it hard to get auto-reconnect to work?</FONT>
</P>
<BR>

<P><FONT SIZE=3D2>Kind regards,</FONT>
</P>
<BR>

<P><FONT SIZE=3D2>Maikel Verheijen</FONT>
</P>
<BR>

<P><FONT SIZE=3D2>Ps: the log message I get is this:</FONT>
</P>

<P><FONT SIZE=3D2>May 22 17:33:01 testlfw3 dovecot-auth: PGSQL: Query =
&quot;SELECT password FROM aliases WHERE alias =3D 'maikel@test.com' =
AND password !=3D ''&quot; failed: FATAL 1:&nbsp; This connection has =
been terminated by the administrator. server closed the connection =
unexpectedly ^IThis probably means the server terminated abnormally =
^Ibefore or while processing the request. </FONT></P>

<P><FONT SIZE=3D2>Which probably describes it all :)</FONT>
</P>

</BODY>
</HTML>
------_=_NextPart_001_01C32423.9B247960--
From seba@iq.pl  Tue May 27 11:59:49 2003
Return-Path: <seba@iq.pl>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id A87E3238C7; Tue, 27 May 2003 11:59:49 +0300 (EEST)
Received: from serv.iq.pl (serv.iq.pl [213.76.165.9])
	by danu.procontrol.fi (Postfix) with ESMTP id 05A8423896
	for <dovecot@procontrol.fi>; Tue, 27 May 2003 11:59:47 +0300 (EEST)
Received: by serv.iq.pl (Postfix, from userid 1390)
	id 812546BCB8; Tue, 27 May 2003 11:01:33 +0200 (CEST)
Date: Tue, 27 May 2003 11:01:33 +0200
From: Sebastian Pachuta <seba@iq.pl>
To: Dovecot List <dovecot@procontrol.fi>
Subject: Re: [Dovecot] still problem with load
Message-ID: <20030527090132.GH21324@iq.pl>
References: <3ECB3FB1.9040602@bnap.hu> <1053508947.1214.358.camel@hurina>
	<3ECB543A.1070502@bnap.hu> <1053517484.1215.386.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1053517484.1215.386.camel@hurina>
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Tue, 27 May 2003 08:59:49 -0000
X-UID: 824                                                  
Status: O

On Wed, May 21, 2003 at 14:44:45 +0300, Timo Sirainen wrote:
> On Wed, 2003-05-21 at 13:26, Farkas Levente wrote:
> > imap(lfarkas): May 21 12:20:01 Error: Corrupted index file 
> > /home/lfarkas/Maildir/.INBOX/.imap.index: index.next_uid (64) > 
> > uidlist.next_uid (63)
> 
> Fixed in 0.99.10-test5.

It was bug, not feature? :)

Confirmed - got rid of these error messages.
From maikel@ladot.com  Tue May 27 12:50:27 2003
Return-Path: <maikel@ladot.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 94F4D238C7; Tue, 27 May 2003 12:50:27 +0300 (EEST)
Received: from zeus.ladot.com (office.ladot.com [217.22.64.134])
	by danu.procontrol.fi (Postfix) with ESMTP id 2BC8923865
	for <dovecot@procontrol.fi>; Tue, 27 May 2003 12:50:25 +0300 (EEST)
Received: from nlladot05.freehosting (nlladot05.intern.ladot.com
	[172.31.2.13])
	by zeus.ladot.com (8.12.9/8.12.9) with ESMTP id h4RA2LMN081502
	for <dovecot@procontrol.fi>; Tue, 27 May 2003 12:02:21 +0200 (CEST)
	(envelope-from maikel@ladot.com)
Received: by nlladot05.intern.ladot.com with Internet Mail Service
	(5.5.2653.19)	id <LP1BV00X>; Tue, 27 May 2003 11:50:20 +0200
Message-ID: <410777FC7A66D511911500B0D078345501F2241E@nlladot05.intern.ladot.com>
From: Maikel Verheijen <maikel@ladot.com>
To: "'Dovecot (E-mail)'" <dovecot@procontrol.fi>
Subject: RE: [Dovecot] Postgres "issue"
Date: Tue, 27 May 2003 11:50:20 +0200
MIME-Version: 1.0
X-Mailer: Internet Mail Service (5.5.2653.19)
Content-Type: multipart/alternative;
	boundary="----_=_NextPart_001_01C32435.62781790"
X-Spam-Status: No, hits=0.3 required=5.0
	tests=HTML_40_50,HTML_FONT_COLOR_BLUE,HTML_MESSAGE,
	      ORIGINAL_MESSAGE,PATCH_UNIFIED_DIFF
	version=2.55
X-Spam-Checker-Version: SpamAssassin 2.55 (1.174.2.19-2003-05-19-exp)
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Tue, 27 May 2003 09:50:27 -0000
X-UID: 825                                                  
Status: O
Content-Length: 9145

This message is in MIME format. Since your mail reader does not understand
this format, some or all of this message may not be legible.

------_=_NextPart_001_01C32435.62781790
Content-Type: text/plain

Ok: a little lame to answer my own question, but I created a CRUDE patch.
 
It does NOT check why a connection failed, it just does a PQreset, and it
SEEMS to work.
 
 
Kind regards,
 
Maikel Verheijen.
 
Ps: Timo, can something with reconnect be implemented permanently?
 
 
--8<--
 
--- src/auth/db-pgsql.c.ORIG    Tue May 27 10:06:39 2003
+++ src/auth/db-pgsql.c Tue May 27 11:16:38 2003
@@ -53,9 +53,16 @@
        res = PQexec(conn->pg, query);
 
        if (PQresultStatus(res) != PGRES_TUPLES_OK) {
-               i_error("PGSQL: Query \"%s\" failed: %s",
-                       query, PQresultErrorMessage(res));
-               failed = TRUE;
+               PQreset(conn->pg);
+               res = PQexec(conn->pg, query);
+               if (PQresultStatus(res) != PGRES_TUPLES_OK) {
+                       i_error("PGSQL: Query \"%s\" failed: %s",
+                               query, PQresultErrorMessage(res));
+                       failed = TRUE;
+               } else {
+                       i_error("PGSQL: Reconnected because of failure!");
+                       failed = FALSE;
+               }
        } else {
                failed = FALSE;
        }
 
--8<--

-----Original Message-----
From: Maikel Verheijen [mailto:maikel@ladot.com] 
Sent: Tuesday, May 27, 2003 9:43 AM
To: 'Dovecot (E-mail)'
Subject: [Dovecot] Postgres "issue"



Dear list, 


I have a small issue with dovecot talking to a postgresql server: 

If my postgres server get restarted, dovecot fails to reconnect to the
postgres server. 

I run dovecot 0.99.9.1 (which is actually a cvs version of dovecot, of may 9
2003) 

I have the same postgres version for the server as I use for the libraries. 

Is it hard to get auto-reconnect to work? 


Kind regards, 


Maikel Verheijen 


Ps: the log message I get is this: 

May 22 17:33:01 testlfw3 dovecot-auth: PGSQL: Query "SELECT password FROM
aliases WHERE alias = 'maikel@test.com' AND password != ''" failed: FATAL 1:
This connection has been terminated by the administrator. server closed the
connection unexpectedly ^IThis probably means the server terminated
abnormally ^Ibefore or while processing the request. 

Which probably describes it all :) 


------_=_NextPart_001_01C32435.62781790
Content-Type: text/html
Content-Transfer-Encoding: quoted-printable

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML><HEAD>
<META HTTP-EQUIV=3D"Content-Type" CONTENT=3D"text/html; =
charset=3Dus-ascii">
<TITLE>Message</TITLE>

<META content=3D"MSHTML 6.00.2800.1170" name=3DGENERATOR></HEAD>
<BODY>
<DIV><FONT face=3DArial color=3D#0000ff size=3D2><SPAN =
class=3D323253709-27052003>Ok: a=20
little lame to answer my own question, but I created a CRUDE=20
patch.</SPAN></FONT></DIV>
<DIV><FONT face=3DArial color=3D#0000ff size=3D2><SPAN=20
class=3D323253709-27052003></SPAN></FONT>&nbsp;</DIV>
<DIV><FONT face=3DArial color=3D#0000ff size=3D2><SPAN =
class=3D323253709-27052003>It=20
does NOT check why a connection failed, it just does a PQreset, and it =
SEEMS to=20
work.</SPAN></FONT></DIV>
<DIV><FONT face=3DArial color=3D#0000ff size=3D2><SPAN=20
class=3D323253709-27052003></SPAN></FONT>&nbsp;</DIV>
<DIV><FONT face=3DArial color=3D#0000ff size=3D2><SPAN=20
class=3D323253709-27052003></SPAN></FONT>&nbsp;</DIV>
<DIV><FONT face=3DArial color=3D#0000ff size=3D2><SPAN =
class=3D323253709-27052003>Kind=20
regards,</SPAN></FONT></DIV>
<DIV><FONT face=3DArial color=3D#0000ff size=3D2><SPAN=20
class=3D323253709-27052003></SPAN></FONT>&nbsp;</DIV>
<DIV><FONT face=3DArial color=3D#0000ff size=3D2><SPAN =
class=3D323253709-27052003>Maikel=20
Verheijen.</SPAN></FONT></DIV>
<DIV><FONT face=3DArial color=3D#0000ff size=3D2><SPAN=20
class=3D323253709-27052003></SPAN></FONT>&nbsp;</DIV>
<DIV><FONT face=3DArial color=3D#0000ff size=3D2><SPAN =
class=3D323253709-27052003>Ps:=20
Timo, can something with reconnect be implemented=20
permanently?</SPAN></FONT></DIV>
<DIV><FONT face=3DArial color=3D#0000ff size=3D2><SPAN=20
class=3D323253709-27052003></SPAN></FONT>&nbsp;</DIV>
<DIV><FONT face=3DArial color=3D#0000ff size=3D2><SPAN=20
class=3D323253709-27052003></SPAN></FONT>&nbsp;</DIV>
<DIV><FONT face=3DArial color=3D#0000ff size=3D2><SPAN=20
class=3D323253709-27052003>--8&lt;--</SPAN></FONT></DIV>
<DIV><FONT face=3DArial size=3D2></FONT>&nbsp;</DIV>
<DIV><FONT face=3DArial size=3D2>--- =
src/auth/db-pgsql.c.ORIG&nbsp;&nbsp;&nbsp; Tue=20
May 27 10:06:39 2003<BR>+++ src/auth/db-pgsql.c Tue May 27 11:16:38 =
2003<BR>@@=20
-53,9 +53,16 @@<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; res =3D=20
PQexec(conn-&gt;pg,=20
query);<BR>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if=20
(PQresultStatus(res) !=3D PGRES_TUPLES_OK)=20
{<BR>-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp;&nbsp;=20
i_error("PGSQL: Query \"%s\" failed:=20
%s",<BR>-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=20
query,=20
PQresultErrorMessage(res));<BR>-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=20
failed =3D=20
TRUE;<BR>+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;&nbsp;=20
PQreset(conn-&gt;pg);<BR>+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=20
res =3D PQexec(conn-&gt;pg,=20
query);<BR>+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp;&nbsp;&nbsp;=20
if (PQresultStatus(res) !=3D PGRES_TUPLES_OK)=20
{<BR>+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=20
i_error("PGSQL: Query \"%s\" failed:=20
%s",<BR>+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=20
query,=20
PQresultErrorMessage(res));<BR>+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;=20
failed =3D=20
TRUE;<BR>+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;&nbsp;=20
} else=20
{<BR>+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=20
i_error("PGSQL: Reconnected because of=20
failure!");<BR>+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;=20
failed =3D=20
FALSE;<BR>+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;=20
}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else=20
{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;=20
failed =3D FALSE;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =
}</FONT></DIV>
<DIV><FONT face=3DArial color=3D#0000ff size=3D2></FONT>&nbsp;</DIV>
<DIV><SPAN class=3D323253709-27052003><FONT face=3DArial =
color=3D#0000ff=20
size=3D2>--8&lt;--</FONT></SPAN></DIV>
<BLOCKQUOTE dir=3Dltr=20
style=3D"PADDING-LEFT: 5px; MARGIN-LEFT: 5px; BORDER-LEFT: #0000ff 2px =
solid; MARGIN-RIGHT: 0px">
  <DIV></DIV>
  <DIV class=3DOutlookMessageHeader lang=3Den-us dir=3Dltr =
align=3Dleft><FONT=20
  face=3DTahoma size=3D2>-----Original Message-----<BR><B>From:</B> =
Maikel Verheijen=20
  [mailto:maikel@ladot.com] <BR><B>Sent:</B> Tuesday, May 27, 2003 9:43 =

  AM<BR><B>To:</B> 'Dovecot (E-mail)'<BR><B>Subject:</B> [Dovecot] =
Postgres=20
  "issue"<BR><BR></FONT></DIV>
  <P><FONT size=3D2>Dear list,</FONT> </P><BR>
  <P><FONT size=3D2>I have a small issue with dovecot talking to a =
postgresql=20
  server:</FONT> </P>
  <P><FONT size=3D2>If my postgres server get restarted, dovecot fails =
to=20
  reconnect to the postgres server.</FONT> </P>
  <P><FONT size=3D2>I run dovecot 0.99.9.1 (which is actually a cvs =
version of=20
  dovecot, of may 9 2003)</FONT> </P>
  <P><FONT size=3D2>I have the same postgres version for the server as =
I use for=20
  the libraries.</FONT> </P>
  <P><FONT size=3D2>Is it hard to get auto-reconnect to work?</FONT> =
</P><BR>
  <P><FONT size=3D2>Kind regards,</FONT> </P><BR>
  <P><FONT size=3D2>Maikel Verheijen</FONT> </P><BR>
  <P><FONT size=3D2>Ps: the log message I get is this:</FONT> </P>
  <P><FONT size=3D2>May 22 17:33:01 testlfw3 dovecot-auth: PGSQL: Query =
"SELECT=20
  password FROM aliases WHERE alias =3D 'maikel@test.com' AND password =
!=3D ''"=20
  failed: FATAL 1:&nbsp; This connection has been terminated by the=20
  administrator. server closed the connection unexpectedly ^IThis =
probably means=20
  the server terminated abnormally ^Ibefore or while processing the =
request.=20
  </FONT></P>
  <P><FONT size=3D2>Which probably describes it all :)</FONT>=20
</P></BLOCKQUOTE></BODY></HTML>

------_=_NextPart_001_01C32435.62781790--
From tss@iki.fi  Tue May 27 14:48:50 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 1C7AA238C7; Tue, 27 May 2003 14:48:50 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 4EF9F23865
	for <dovecot@procontrol.fi>; Tue, 27 May 2003 14:48:46 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 0BB2A5C896C6; Tue, 27 May 2003 14:48:46 +0300 (EEST)
Subject: Re: [Dovecot] Dovecot in OpenBSD ports system
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <27400000.1054000562@[192.168.0.8]>
References: <20030523152303.5644f895.bob@cemetery.homeunix.org>
	<27400000.1054000562@[192.168.0.8]>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1054036125.19156.175.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 27 May 2003 14:48:45 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Tue, 27 May 2003 11:48:50 -0000
X-UID: 826                                                  
Status: O

On Tue, 2003-05-27 at 04:56, Andrew Basterfield wrote:
> I've run into some probelms with maildirs. I have been testing by dumping
> my email archives into the server and I have come across 'Warning:
> Inconsistency - Index <index> was rebuilt while we had it open' leading to
> the the wrong body being returned when the header is selected. Eventually
> the child server process dies.
> 
> I have had no problems with mboxes
> 
> Should I wait for the next release and try again? Is this problem limited
> to my plaform?

What version of Dovecot was this with? OpenBSD had similiar problem
which I've fixed in -test releases. The problem with it was that I was
write()ing to file that was mmaped, and OpenBSD didn't update the mmap
when it was done.

From bob@cemetery.homeunix.org  Tue May 27 19:05:13 2003
Return-Path: <bob@cemetery.homeunix.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 135E6238C7; Tue, 27 May 2003 19:05:13 +0300 (EEST)
Received: from cemetery.homeunix.org (joeldriver.plus.com [212.159.87.165])
	by danu.procontrol.fi (Postfix) with ESMTP id 780A623865
	for <dovecot@procontrol.fi>; Tue, 27 May 2003 19:05:09 +0300 (EEST)
Received: from [192.168.0.8] (snot.flatnet [192.168.0.8])
	by cemetery.homeunix.org (8.12.9/8.12.6) with ESMTP id h4RG51g6027390
	for <dovecot@procontrol.fi>; Tue, 27 May 2003 17:05:01 +0100 (BST)
Date: Tue, 27 May 2003 17:05:00 +0100
From: Andrew Basterfield <bob@cemetery.homeunix.org>
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] Dovecot in OpenBSD ports system
Message-ID: <695540000.1054051500@[192.168.0.8]>
In-Reply-To: <1054036125.19156.175.camel@hurina>
References: <20030523152303.5644f895.bob@cemetery.homeunix.org>
	<1054036125.19156.175.camel@hurina>
X-Mailer: Mulberry/3.0.3 (Linux/x86)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
Content-Disposition: inline
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Tue, 27 May 2003 16:05:13 -0000
X-UID: 827                                                  
Status: O
Content-Length: 1110



--On Tuesday, May 27, 2003 14:48:45 +0300 Timo Sirainen <tss@iki.fi> wrote:

> On Tue, 2003-05-27 at 04:56, Andrew Basterfield wrote:
>> I've run into some probelms with maildirs. I have been testing by dumping
>> my email archives into the server and I have come across 'Warning:
>> Inconsistency - Index <index> was rebuilt while we had it open' leading
>> to the the wrong body being returned when the header is selected.
>> Eventually the child server process dies.

>> Should I wait for the next release and try again? Is this problem limited
>> to my plaform?
>
> What version of Dovecot was this with? OpenBSD had similiar problem
> which I've fixed in -test releases. The problem with it was that I was
> write()ing to file that was mmaped, and OpenBSD didn't update the mmap
> when it was done.

Yes, I found the error message in mail_index_lock_change() in mail-index.c
and mmap_update() in mail_index_data.c, I changed one of the strings so I
could differentiate them and it was mmap_update() where the error was
detected.

I had the problems with 0.99.8.1 and 0.99.9.1

I will try -test

--Andrew
From bob@cemetery.homeunix.org  Tue May 27 19:29:08 2003
Return-Path: <bob@cemetery.homeunix.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id F34F6238C7; Tue, 27 May 2003 19:29:07 +0300 (EEST)
Received: from cemetery.homeunix.org (joeldriver.plus.com [212.159.87.165])
	by danu.procontrol.fi (Postfix) with ESMTP id 28AA723896
	for <dovecot@procontrol.fi>; Tue, 27 May 2003 19:29:05 +0300 (EEST)
Received: from snot (snot.flatnet [192.168.0.8])
	by cemetery.homeunix.org (8.12.9/8.12.6) with SMTP id h4RGT2g6008011
	for <dovecot@procontrol.fi>; Tue, 27 May 2003 17:29:02 +0100 (BST)
Date: Tue, 27 May 2003 17:28:57 +0100
From: Andrew Basterfield <bob@cemetery.homeunix.org>
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] Dovecot in OpenBSD ports system
Message-Id: <20030527172857.0d4c257b.bob@cemetery.homeunix.org>
In-Reply-To: <695540000.1054051500@[192.168.0.8]>
References: <20030523152303.5644f895.bob@cemetery.homeunix.org>
	<1054036125.19156.175.camel@hurina>
	<695540000.1054051500@[192.168.0.8]>
X-Mailer: Sylpheed version 0.8.11claws (GTK+ 1.2.10; i586-pc-linux-gnu)
Mime-Version: 1.0
Content-Type: multipart/signed; protocol="application/pgp-signature";
 micalg="pgp-sha1"; boundary="oU=.=ndL)/)D4KXw"
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Tue, 27 May 2003 16:29:08 -0000
X-UID: 828                                                  
Status: O

--oU=.=ndL)/)D4KXw
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

On Tue, 27 May 2003 17:05:00 +0100,
Andrew Basterfield <bob@cemetery.homeunix.org> wrote:
 
> I had the problems with 0.99.8.1 and 0.99.9.1
> 
> I will try -test

PS to you have URLs for -test tarballs (as they are not linked to on
the website) or must I check the source out with CVS?

--Andrew

-- 
http://cemetery.homeunix.org

--oU=.=ndL)/)D4KXw
Content-Type: application/pgp-signature

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.1 (GNU/Linux)

iD8DBQE+05JNj3ZMDwYLJGARAqcwAJ4lEL4mMMyWy26nthSZ5q0Cm2+aTwCfTFOW
oeyLEMrqe8WSp4HI1Dqz6Yc=
=wLt6
-----END PGP SIGNATURE-----

--oU=.=ndL)/)D4KXw--
From bob@cemetery.homeunix.org  Tue May 27 20:52:17 2003
Return-Path: <bob@cemetery.homeunix.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 9BF7423896; Tue, 27 May 2003 20:52:17 +0300 (EEST)
Received: from cemetery.homeunix.org (joeldriver.plus.com [212.159.87.165])
	by danu.procontrol.fi (Postfix) with ESMTP id 031BD23865
	for <dovecot@procontrol.fi>; Tue, 27 May 2003 20:52:06 +0300 (EEST)
Received: from snot (snot.flatnet [192.168.0.8])
	by cemetery.homeunix.org (8.12.9/8.12.6) with SMTP id h4RHpxg6004420
	for <dovecot@procontrol.fi>; Tue, 27 May 2003 18:51:59 +0100 (BST)
Date: Tue, 27 May 2003 18:51:55 +0100
From: Andrew Basterfield <bob@cemetery.homeunix.org>
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] Dovecot in OpenBSD ports system
Message-Id: <20030527185155.4549a895.bob@cemetery.homeunix.org>
In-Reply-To: <20030527172857.0d4c257b.bob@cemetery.homeunix.org>
References: <20030523152303.5644f895.bob@cemetery.homeunix.org>
	<1054036125.19156.175.camel@hurina>
	<695540000.1054051500@[192.168.0.8]>
	<20030527172857.0d4c257b.bob@cemetery.homeunix.org>
X-Mailer: Sylpheed version 0.8.11claws (GTK+ 1.2.10; i586-pc-linux-gnu)
Mime-Version: 1.0
Content-Type: multipart/signed; protocol="application/pgp-signature";
 micalg="pgp-sha1"; boundary="=.on,YNVJBSF5slg"
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Tue, 27 May 2003 17:52:17 -0000
X-UID: 829                                                  
Status: O
Content-Length: 1126

--=.on,YNVJBSF5slg
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

On Tue, 27 May 2003 17:28:57 +0100,
Andrew Basterfield <bob@cemetery.homeunix.org> wrote:
> On Tue, 27 May 2003 17:05:00 +0100,
> Andrew Basterfield <bob@cemetery.homeunix.org> wrote:
>  
> > I had the problems with 0.99.8.1 and 0.99.9.1
> > 
> > I will try -test
> 
> PS to you have URLs for -test tarballs (as they are not linked to on
> the website) or must I check the source out with CVS?

Sorry, found the test tarballs.

0.99.10-test6 is looking very good, no problems with OpenBSD so far and
much much faster than cyrus-imapd importing my messages.

When 0.99.10 comes out I will aim to get it in OpenBSD ports tree. In
the meanwhile I will continue to beat on the -test releases to see if I
can break them.

--Andrew

-- 
http://cemetery.homeunix.org

--=.on,YNVJBSF5slg
Content-Type: application/pgp-signature

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.1 (GNU/Linux)

iD8DBQE+06W/j3ZMDwYLJGARAgvyAJ97RqPyeQhkD99RGJbDAzSWvO8aKACcCo7s
GkD9vzEsYIXIlA9uLz8vbhs=
=bcQX
-----END PGP SIGNATURE-----

--=.on,YNVJBSF5slg--
From rw@firstpr.com.au  Wed May 28 07:32:34 2003
Return-Path: <rw@firstpr.com.au>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 013F523896; Wed, 28 May 2003 07:32:33 +0300 (EEST)
Received: from gair.firstpr.com.au (first1.lnk.telstra.net [139.130.48.118])
	by danu.procontrol.fi (Postfix) with ESMTP id 6D5902384C
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 07:32:29 +0300 (EEST)
Received: from firstpr.com.au (zita.firstpr.com.au [203.36.57.217])
	by gair.firstpr.com.au (Postfix) with ESMTP
	id 2A22F2C845; Wed, 28 May 2003 14:32:20 +1000 (EST)
Message-ID: <3ED43BC4.6010209@firstpr.com.au>
Date: Wed, 28 May 2003 14:32:04 +1000
From: Robin Whittle <rw@firstpr.com.au>
Organization: First Principles
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.0; en-US;
	rv:1.0.2) Gecko/20030208 Netscape/7.02
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: dovecot@procontrol.fi
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Subject: [Dovecot] Dovecot 0.99.9.1 and openssl-0.9.7a-5
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 28 May 2003 04:32:34 -0000
X-UID: 830                                                  
Status: O
Content-Length: 1537

Hi Timo and others,

Thanks for Dovecot! I just got it running under Red Hat 9.0 after
spending many hours unsuccessfully trying to get Courier IMAP to run,
although I have done it in the past.  Here is a compilation glitch which
may already be well known:

I compiled dovecot-0.99.9.1 on my newly installed and recently updated
(via Red Hat Network) system and the compilation stopped due to a
missing file in the SSL headers:

  In file included from /usr/include/openssl/ssl.h:179,
                 from ssl-proxy-openssl.c:14:
  /usr/include/openssl/kssl.h:72:18: krb5.h: No such file or directory
  In file included from /usr/include/openssl/ssl.h:179,
                 from ssl-proxy-openssl.c:14:


The currently installed OpenSSL RPM was openssl-0.9.7a-5.   This lacks
the file  /usr/include/openssl/krb5.h .  I understand that
openssl-0.9.7b is OK, but I wasn't sure about whether installing this as
a tarball from http://www.openssl.org would upset any other programs on
this machine, or confuse the RHN update system.

I didn't really need SSL and I couldn't see a specific option for
disabling it, other than a general instruction about disabling modules
with a ./configure option.  So I tried ./configure --help and compiled
it with:

   ./configure --without-ssl

This worked fine.  I really like the report at the end of the
./configure stage saying how the program will be compiled!

  - Robin


//  Robin Whittle                   http://www.firstpr.com.au
//  Melbourne, Australia            http://fondlyandfirmly.com

From charlie@rubberduck.com  Wed May 28 08:08:40 2003
Return-Path: <charlie@rubberduck.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 97822238C5; Wed, 28 May 2003 08:08:40 +0300 (EEST)
Received: from lazy.spodder.com (lazy.spodder.com [203.18.242.30])
	by danu.procontrol.fi (Postfix) with ESMTP id DA17023896
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 08:08:36 +0300 (EEST)
Received: by lazy.spodder.com (Postfix, from userid 501)
	id D56C58FE6; Wed, 28 May 2003 15:08:25 +1000 (EST)
Date: Wed, 28 May 2003 15:08:25 +1000
From: Charlie Allom <charlie@rubberduck.com>
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] DRAC support?
Message-ID: <20030528050825.GA10934@lazy.spodder.com>
References: <20030514085227.GA7325@lazy.spodder.com>
	<20030515011306.GA3731@lazy.spodder.com>
	<20030515043029.GA18617@lazy.spodder.com>
	<200305142137.11186.jryden@thebox.our-own.net>
	<20030516191335.GA196@dust.uchicago.edu>
	<20030517063125.GA23270@lazy.spodder.com>
	<20030521043313.GA1659@lazy.spodder.com> <1053502215.1214.337.camel@hurina>
	<20030521073959.GD27088@lazy.spodder.com> <1053508449.1218.348.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1053508449.1218.348.camel@hurina>
User-Agent: Mutt/1.5.4i
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 28 May 2003 05:08:40 -0000
X-UID: 831                                                  
Status: O
Content-Length: 1607

On Wed, May 21, 2003 at 12:14:09PM +0300, Timo Sirainen wrote:
> On Wed, 2003-05-21 at 10:39, Charlie Allom wrote:
> > On Wed, May 21, 2003 at 10:30:16AM +0300, Timo Sirainen wrote:
> > > On Wed, 2003-05-21 at 10:20, Charlie Allom wrote:
> > > > /usr/pkg/lib/dovecot/imap/drac.so: Undefined PLT symbol "net_addr2ip"
> > > > (symnum = 21)
> > > 
> > > Are you really running 0.99.10-test2 or newer? I changed that function's
> > > name recently.
> > > 
> > 
> > Yes I really am. 
> > 
> > Check your latest commits to network.h and network.c
> 
> Oh! I got it :) The linker optimizes that function away since it's not
> used elsewhere. Well, I'll include that function into the drac.c.
> Updated http://dovecot.procontrol.fi/patches/drac.c
> 

Sorry Timo,

still going here .. I have test2 and last drac.c

it all compiled much more cleanly this time.

NB you have to hand edit and #define HAVE_MODULES in config.h

and I still get this error:

May 28 15:03:35 lazy imap-login: Login: jen [203.31.232.2]
May 28 15:03:35 lazy imap(jen):
dlopen(/usr/local/lib/dovecot/imap/drac.so) failed:
/usr/local/lib/dovecot/imap/drac.so: Undefined PLT symbol
"net_addr2ip" (symnum = 21)


even when there is this in drac.c:

    ip_str = getenv("IP");
    if (ip_str == NULL)
        i_error("DRAC: IP environment not given");
    else if (net_addr2ip(ip_str, &ip) < 0)
        i_error("DRAC: net_ip2addr(%s) failed: %m", ip_str);

.. how did this happen .. shall I use a newer test?

  C.
-- 
 charlie@rubberduck.com - Melbourne, Australia
 http://rubberduck.com/~yeled/
 PGP: 0x14AA7941 || finger yeled@lazy.spodder.com
From rw@firstpr.com.au  Wed May 28 08:18:43 2003
Return-Path: <rw@firstpr.com.au>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 9C19D238C5; Wed, 28 May 2003 08:18:43 +0300 (EEST)
Received: from gair.firstpr.com.au (first1.lnk.telstra.net [139.130.48.118])
	by danu.procontrol.fi (Postfix) with ESMTP id 1F61F23896
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 08:18:40 +0300 (EEST)
Received: from firstpr.com.au (zita.firstpr.com.au [203.36.57.217])
	by gair.firstpr.com.au (Postfix) with ESMTP
	id 359162C845; Wed, 28 May 2003 15:18:38 +1000 (EST)
Message-ID: <3ED4469E.8040207@firstpr.com.au>
Date: Wed, 28 May 2003 15:18:22 +1000
From: Robin Whittle <rw@firstpr.com.au>
Organization: First Principles
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.0; en-US;
	rv:1.0.2) Gecko/20030208 Netscape/7.02
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: dovecot@procontrol.fi
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Subject: [Dovecot] Speed and memory probs writing large Maildir
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 28 May 2003 05:18:43 -0000
X-UID: 832                                                  
Status: O
Content-Length: 4782

I have Dovecot 0.99.9.1 compiled from the source, without SSL, running
on a Red Hat 9.0 system - EXT3 file system, Pentium Pro 233 MHz, Intel
motherboard, 128M RAM, IBM 40Gig 7200 RPM HD.   I find reading and
searching to be nice and fast, and comparing it with Courier IMAP on a
Celeron 824 MHz, I think Dovecot is generally not much slower, which
means it may well be faster than Courier in some or many ways if it was
running on the same machine.

My only problem is when writing mailboxes with large numbers of
messages.  I use Mailir - the same arrangement as Courier IMAP.  (I also
find that Netscape 4.77 can't use mailboxes which are subfolders of
others, but that is probably a Netscape config problem.)

I am using Netscape 4.77 (Windows 2000 1.3 GHz Celeron, via 100Mbps
switched Ethernet to the Linux machines) to do these tests since I find
Netscape 7.02 to be much slower.  Netscape 7.02 seems to want to resynch
its notion of the mailbox repeatedly as it is writing to it.  Without
looking at the IMAP traffic (I don't know how) I would say that Netscape
4.77 is not doing this at all.  Indeed, after the write, looking at the
mailbox causes Netscape 4.77 to read the headers from the IMAP server -
so I feel sure that its way of writing the messages is purely "write".


Writing a mailbox with a small number of large messages, such as 20 x
100k messages is fine. There is no obvious speed problem or excessive
memory use.

When writing 2000 x 1k messages, it is totally different.  Here are some
times for writing from a Netscape 4.77 local mailbox to Dovecot and to
Courier IMAP.


Message        Total    Time       CPU max     Memory RSS
size   number  size     Seconds    Approx      Megs - max

Dovecot

100k  100      10M        23       15%         ~2
100k   20       2M        ~5       ?            1.2
 10k  200       2M        20       15%          4    !
  1k 2000       2M       230       60          32    !!!!

Courier IMAP

100k  100      10M        14        5%         ~1
100k   20       2M        ~2        ?           ?
 10k  200       2M         9        5%         ~0.6
  1k 2000       2M        88        2%         ~0.6


This 2000 message test is small compared to some of the mailboxes I have.

I used a real-live mailbox, 6878 messages - 44 Megabytes in a single
Mbox for a more demanding test.  Using Netscape 4.77 to copy this to a
Dovecot Maildir took a very long time - over 30 minutes.  The process
was fast at first and got slower and slower.  As the number of messages
in the destination Maildir increased, the memory usage went up and the
speed reduced.  It seems that RSS memory usage (as reported by "top -d
0.3" hit some kind of limit at about 49 Megs after 4000 messages and
then went down a little to about 48 or less.  CPU usage was 30 to 82%,
fluctuating according to the moment top looked.  At the end, I think it
was only writing 1.5 messages a second.

RSS is the "total amount of physical memory used by the task".  The
"SIZE" was even bigger - "code plus data plus stack".  This got up to
114 Megs by the end of the writing process!

After the write had finished, I made Netscape 4.77 view the destination
mailbox.  This caused Dovecot to send it all the headers, and again
Dovecot had these huge memory usage figures.   It seemed to read the
mailbox at a decent speed - 20 seconds or so.

But if I made Dovecot look at another mailbox, and then again at this
big target mailbox (say with another client - Netscape 7), it would read
the big mailbox at Dovecot's usual high speed - without the high memory
usage and I think without high CPU usage as well.


Without knowing anything about how Dovecot works, I imagine that there
is some kind of caching algorithm for writes, and that this is retained
until Dovecot (or at least the instance serving this client) is asked to
look at another Maildir.  It seems that reading is not slowed by this
process much or at all - but writing gets progressively slower as the
cache gets bigger.

The memory usage - even 49 Megs for RSS - seems excessive.  It reached
that about halfway through writing the mailbox, so the entire message
contents at that state would have been about 22 Megs.  But the "SIZE"
memory usage is even larger - perhaps limited by the available RAM.


This slow speed for writing Maildirs with large numbers of messages is
currently a barrier to me using Dovecot.  I am about to go back and try
again to get Courier IMAP to do what I want . . .

The Courier IMAP documentation and what I regard as the difficult
"configure -> build -> install -> wonder why it doesn't run" process has
cost me so much time that I would be very happy to use something simpler
and easier (for me, at least) to install.

Thanks for developing this new IMAP server!


  - Robin

From rw@firstpr.com.au  Wed May 28 08:26:17 2003
Return-Path: <rw@firstpr.com.au>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 195FD238C5; Wed, 28 May 2003 08:26:17 +0300 (EEST)
Received: from gair.firstpr.com.au (first1.lnk.telstra.net [139.130.48.118])
	by danu.procontrol.fi (Postfix) with ESMTP id 02E3C23845
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 08:26:15 +0300 (EEST)
Received: from firstpr.com.au (zita.firstpr.com.au [203.36.57.217])
	by gair.firstpr.com.au (Postfix) with ESMTP
	id 168BF2C845; Wed, 28 May 2003 15:26:13 +1000 (EST)
Message-ID: <3ED44865.2070705@firstpr.com.au>
Date: Wed, 28 May 2003 15:25:57 +1000
From: Robin Whittle <rw@firstpr.com.au>
Organization: First Principles
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.0; en-US;
	rv:1.0.2) Gecko/20030208 Netscape/7.02
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] Speed and memory probs writing large Maildir
References: <3ED4469E.8040207@firstpr.com.au>
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 28 May 2003 05:26:17 -0000
X-UID: 833                                                  
Status: O

P.S. I have not altered the dovecot.conf file at all.  The only
deviation from standard is no SSL.  I find it remarkable that Dovecot
works out of the box and automagically finds the user's Maildirs!

  - Robin

From bob@cemetery.homeunix.org  Wed May 28 10:31:19 2003
Return-Path: <bob@cemetery.homeunix.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id EC057238D1; Wed, 28 May 2003 10:31:18 +0300 (EEST)
Received: from cemetery.homeunix.org (joeldriver.plus.com [212.159.87.165])
	by danu.procontrol.fi (Postfix) with ESMTP id AE27623845
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 10:31:15 +0300 (EEST)
Received: from snot (snot.flatnet [192.168.0.8])
	by cemetery.homeunix.org (8.12.9/8.12.6) with SMTP id h4S7VAg6020062
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 08:31:10 +0100 (BST)
Date: Wed, 28 May 2003 08:31:02 +0100
From: Andrew Basterfield <bob@cemetery.homeunix.org>
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] Speed and memory probs writing large Maildir
Message-Id: <20030528083102.52dc1f96.bob@cemetery.homeunix.org>
In-Reply-To: <3ED4469E.8040207@firstpr.com.au>
References: <3ED4469E.8040207@firstpr.com.au>
X-Mailer: Sylpheed version 0.8.11claws (GTK+ 1.2.10; i586-pc-linux-gnu)
Mime-Version: 1.0
Content-Type: multipart/signed; protocol="application/pgp-signature";
 micalg="pgp-sha1"; boundary="=.96UA?JjZGR)aJ1"
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 28 May 2003 07:31:19 -0000
X-UID: 834                                                  
Status: O
Content-Length: 1056

--=.96UA?JjZGR)aJ1
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

On Wed, 28 May 2003 15:18:22 +1000,
Robin Whittle <rw@firstpr.com.au> wrote:

> My only problem is when writing mailboxes with large numbers of
> messages.  I use Mailir - the same arrangement as Courier IMAP.  (I
> also find that Netscape 4.77 can't use mailboxes which are subfolders
> of others, but that is probably a Netscape config problem.)

> When writing 2000 x 1k messages, it is totally different.  Here are
> some times for writing from a Netscape 4.77 local mailbox to Dovecot
> and to Courier IMAP.

I had problems with big (2000+ messages) folders on OpenBSD. I updated
to 0.9.99.10-test6 and it is fine.

http://dovecot.procontrol.fi/test/

-- 
http://cemetery.homeunix.org

--=.96UA?JjZGR)aJ1
Content-Type: application/pgp-signature

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.1 (GNU/Linux)

iD8DBQE+1GW+j3ZMDwYLJGARAjl6AJ9EheeRY+DMthlKU8bQD/EmXChizQCfYqLF
HuERcSLoMIZizzIiCufietY=
=WlIZ
-----END PGP SIGNATURE-----

--=.96UA?JjZGR)aJ1--
From lfarkas@bnap.hu  Wed May 28 11:30:59 2003
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 27A53238D1; Wed, 28 May 2003 11:30:59 +0300 (EEST)
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 7CB0E238C8
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 11:30:56 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id BD1DF754003
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 10:30:17 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id 460643EC4
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 10:30:54 +0200 (CEST)
Received: from bnap.hu (garfield.int.bppiac.hu [192.168.0.50])
	by mail2.bppiac.hu (Postfix) with ESMTP id 30DA33EB8
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 10:30:54 +0200 (CEST)
Message-ID: <3ED473BA.2090609@bnap.hu>
Date: Wed, 28 May 2003 10:30:50 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
Subject: [Dovecot] serious problem
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 28 May 2003 08:30:59 -0000
X-UID: 835                                                  
Status: O

hi,
I've got dozen such errors:
----------------------------
imap-login: May 28 10:28:56 Info: Login: gpajlocz [192.168.1.182]
imap(gpajlocz): May 28 10:28:56 Panic: file maildir-sync.c: line 472 
(maildir_sync_uidlist): assertion failed: (ACTION(hash_rec) == 
MAILDIR_FILE_ACTION_NEW)
dovecot: May 28 10:28:56 Error: child 17207 (imap) killed with signal 6
----------------------------
and this users can't get into the system...

-- 
   Levente                               "Si vis pacem para bellum!"


From lfarkas@bnap.hu  Wed May 28 11:43:52 2003
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 42D192399E; Wed, 28 May 2003 11:43:52 +0300 (EEST)
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 974E8238C8
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 11:43:50 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id 5869675400C
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 10:43:13 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id C16773EB8
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 10:43:49 +0200 (CEST)
Received: from bnap.hu (garfield.int.bppiac.hu [192.168.0.50])
	by mail2.bppiac.hu (Postfix) with ESMTP id 9126B3EC4
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 10:43:49 +0200 (CEST)
Message-ID: <3ED476C2.3060201@bnap.hu>
Date: Wed, 28 May 2003 10:43:46 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
Subject: [Dovecot] a few more error
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 28 May 2003 08:43:52 -0000
X-UID: 836                                                  
Status: O

in the imap.log:

imap(arvays): May 28 10:39:32 Error: Timeout while waiting for release 
of fcntl() lock for index file /home/arvays/Maildir/.INBOX/.imap.index

imap(lfarkas): May 28 10:42:05 Panic: unreached

dovecot: May 28 10:42:07 Error: child 19933 (imap) killed with signal 6

-- 
   Levente                               "Si vis pacem para bellum!"


From lfarkas@bnap.hu  Wed May 28 12:16:06 2003
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 56082239A1; Wed, 28 May 2003 12:16:06 +0300 (EEST)
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 272162399F
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 12:16:03 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id CA431754003
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 11:15:25 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id 611FB3EC4
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 11:16:02 +0200 (CEST)
Received: from bnap.hu (garfield.int.bppiac.hu [192.168.0.50])
	by mail2.bppiac.hu (Postfix) with ESMTP id 4229B3EB8
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 11:16:02 +0200 (CEST)
Message-ID: <3ED47E4F.1000005@bnap.hu>
Date: Wed, 28 May 2003 11:15:59 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
Subject: [Dovecot] new problems
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 28 May 2003 09:16:06 -0000
X-UID: 837                                                  
Status: O
Content-Length: 1523

hi,
so yesterday I move the whole mail system to a better machine. the only 
thing which is running on this system is dovect and:
--------------------------------------------------
  10:44am  up 6 days, 25 min,  3 users,  load average: 28.03, 17.96, 9.05
233 processes: 231 sleeping, 2 running, 0 zombie, 0 stopped
CPU0 states:  3.1% user, 29.4% system,  0.0% nice, 66.4% idle
CPU1 states:  7.1% user, 63.2% system,  0.0% nice, 29.1% idle
CPU2 states:  1.3% user,  3.1% system,  0.0% nice, 94.4% idle
CPU3 states:  1.1% user,  7.4% system,  0.0% nice, 90.3% idle
Mem:  1030496K av, 1021836K used,    8660K free,       0K shrd,  104064K 
buff
Swap: 2040244K av,   55544K used, 1984700K free                  776180K 
cached
--------------------------------------------------
so the problem here is again with the load 28 (!!!).....

in the imap.log:
--------------------------------------------------
imap(arvays): May 28 10:39:32 Error: Timeout while waiting for release 
of fcntl() lock for index file /home/arvays/Maildir/.INBOX/.imap.index

imap(lfarkas): May 28 10:42:05 Panic: unreached
dovecot: May 28 10:42:07 Error: child 19933 (imap) killed with signal 6

imap(ahegedus): May 28 11:05:57 Panic: file maildir-sync.c: line 472 
(maildir_sync_uidlist): assertion failed: (ACTION(hash_rec) == 
MAILDIR_FILE_ACTION_NEW)
dovecot: May 28 11:05:58 Error: child 29103 (imap) killed with signal 6
--------------------------------------------------


-- 
   Levente                               "Si vis pacem para bellum!"


From tss@iki.fi  Wed May 28 14:09:15 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 425B2238D5; Wed, 28 May 2003 14:09:15 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 7F8FF238D1
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 14:09:12 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 7BDC95C896C6; Wed, 28 May 2003 14:09:11 +0300 (EEST)
Subject: Re: [Dovecot] Speed and memory probs writing large Maildir
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <3ED4469E.8040207@firstpr.com.au>
References: <3ED4469E.8040207@firstpr.com.au>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1054120151.19156.250.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 28 May 2003 14:09:11 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 28 May 2003 11:09:15 -0000
X-UID: 838                                                  
Status: O
Content-Length: 1158

On Wed, 2003-05-28 at 08:18, Robin Whittle wrote:
> When writing 2000 x 1k messages, it is totally different.  Here are some
> times for writing from a Netscape 4.77 local mailbox to Dovecot and to
> Courier IMAP.

Thanks, this test helped to find several problems.

First problem was a memory leak with APPEND command. This caused the
huge memory usage. Here's a fix:

--- cmd-append.c        14 Feb 2003 08:00:52 -0000      1.24
+++ cmd-append.c        28 May 2003 11:01:03 -0000
@@ -197,6 +197,7 @@
 
                count++;
        }
+        imap_parser_destroy(save_parser);
 
        if (!box->save_deinit(ctx, failed)) {
                failed = TRUE;

Then I noticed that each APPEND command has to reopen and resync the
mailbox every time which gets just slower and slower. I think I'll make
it leave the mailbox open for a few seconds just in case another APPEND
comes. That should speed it up quite a lot.

Actually APPEND wouldn't even need the mailbox to be synced. I should
try fixing that too..

And finally there's a nasty bug in 0.99.10-test's new maildir syncing
code. I think I'll have to rewrite it a bit more to avoid wasting
memory..

From tss@iki.fi  Wed May 28 14:16:44 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 543D4238D5; Wed, 28 May 2003 14:16:44 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 6DA8D238D1
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 14:16:40 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 410935C896C6; Wed, 28 May 2003 14:16:40 +0300 (EEST)
Subject: Re: [Dovecot] new problems
From: Timo Sirainen <tss@iki.fi>
To: Dovecot List <dovecot@procontrol.fi>
In-Reply-To: <3ED47E4F.1000005@bnap.hu>
References: <3ED47E4F.1000005@bnap.hu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1054120600.23632.259.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 28 May 2003 14:16:40 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 28 May 2003 11:16:44 -0000
X-UID: 839                                                  
Status: O

On Wed, 2003-05-28 at 12:15, Farkas Levente wrote:
> so the problem here is again with the load 28 (!!!).....

Did you try with default_mail_env = maildir:~/Maildir:INDEX=MEMORY? Does
that effect the load at all?

> imap(arvays): May 28 10:39:32 Error: Timeout while waiting for release 
> of fcntl() lock for index file /home/arvays/Maildir/.INBOX/.imap.index

CVS was somewhat broken in 2003-05-23 14:40 .. 2003-05-26 13:07. If
you're running such version that would explain this error.

> imap(lfarkas): May 28 10:42:05 Panic: unreached

Hmm. Related to below I think.

> imap(ahegedus): May 28 11:05:57 Panic: file maildir-sync.c: line 472 
> (maildir_sync_uidlist): assertion failed: (ACTION(hash_rec) == 
> MAILDIR_FILE_ACTION_NEW)

Still hmm. But it could be related to the bug I found which was mostly
just crashing or causing some other errors with me. Try if cvs update
fixes.

From tss@iki.fi  Wed May 28 14:19:47 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 0F148238C9; Wed, 28 May 2003 14:19:47 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 9A48323845
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 14:19:45 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 74BDE5C896C6; Wed, 28 May 2003 14:19:45 +0300 (EEST)
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1054120785.3131.263.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 28 May 2003 14:19:45 +0300
Subject: [Dovecot] 0.99.10-test7
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 28 May 2003 11:19:47 -0000
X-UID: 840                                                  
Status: O

- APPEND memory leak fixed
- maildir syncing crash / some other errors fixed
- pop3 mail fetching fixed
- pop3 didn't advertise STLS in capabilities before

http://dovecot.procontrol.fi/test/

From tss@iki.fi  Wed May 28 14:30:28 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 7D479238D1; Wed, 28 May 2003 14:30:28 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 43F9523845
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 14:30:26 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 0AC1B5C896C6; Wed, 28 May 2003 14:30:20 +0300 (EEST)
Subject: Re: [Dovecot] DRAC support?
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030528050825.GA10934@lazy.spodder.com>
References: <20030514085227.GA7325@lazy.spodder.com>
	<20030515011306.GA3731@lazy.spodder.com>
	<20030515043029.GA18617@lazy.spodder.com>
	<200305142137.11186.jryden@thebox.our-own.net>
	<20030516191335.GA196@dust.uchicago.edu>
	<20030517063125.GA23270@lazy.spodder.com>
	<1053502215.1214.337.camel@hurina>
	<20030521073959.GD27088@lazy.spodder.com>
	<1053508449.1218.348.camel@hurina>
	<20030528050825.GA10934@lazy.spodder.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1054121419.3131.275.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 28 May 2003 14:30:19 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 28 May 2003 11:30:28 -0000
X-UID: 841                                                  
Status: O

On Wed, 2003-05-28 at 08:08, Charlie Allom wrote:
> still going here .. I have test2 and last drac.c
> 
> it all compiled much more cleanly this time.
> 
> NB you have to hand edit and #define HAVE_MODULES in config.h

That's not enough. If configure doesn't detect that you have modules,
it's not setting the linker flags correctly and it won't work.

Looks like BSDs don't have libdl which is why configure's test fails.

Try -test7, I just updated it so that the check should work.

From lfarkas@bnap.hu  Wed May 28 14:32:10 2003
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id F2998238D1; Wed, 28 May 2003 14:32:09 +0300 (EEST)
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 600AD23845
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 14:32:08 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP
	id 8F33375400C; Wed, 28 May 2003 13:31:30 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP
	id 63BD33EC4; Wed, 28 May 2003 13:32:07 +0200 (CEST)
Received: from bnap.hu (garfield.int.bppiac.hu [192.168.0.50])
	by mail2.bppiac.hu (Postfix) with ESMTP
	id 510D53EB8; Wed, 28 May 2003 13:32:07 +0200 (CEST)
Message-ID: <3ED49E33.5080300@bnap.hu>
Date: Wed, 28 May 2003 13:32:03 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Timo Sirainen <tss@iki.fi>
Subject: Re: [Dovecot] new problems
References: <3ED47E4F.1000005@bnap.hu> <1054120600.23632.259.camel@hurina>
In-Reply-To: <1054120600.23632.259.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
cc: Dovecot List <dovecot@procontrol.fi>
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 28 May 2003 11:32:10 -0000
X-UID: 842                                                  
Status: O
Content-Length: 1178

Timo Sirainen wrote:
> On Wed, 2003-05-28 at 12:15, Farkas Levente wrote:
> 
>>so the problem here is again with the load 28 (!!!).....
> 
> 
> Did you try with default_mail_env = maildir:~/Maildir:INDEX=MEMORY? Does
> that effect the load at all?

yes I try. first it drop the load but today I can't do anything, since 
the load was above 20 in both case.

>>imap(arvays): May 28 10:39:32 Error: Timeout while waiting for release 
>>of fcntl() lock for index file /home/arvays/Maildir/.INBOX/.imap.index
> 
> 
> CVS was somewhat broken in 2003-05-23 14:40 .. 2003-05-26 13:07. If
> you're running such version that would explain this error.

the current is ok?

>>imap(lfarkas): May 28 10:42:05 Panic: unreached
> 
> 
> Hmm. Related to below I think.
> 
> 
>>imap(ahegedus): May 28 11:05:57 Panic: file maildir-sync.c: line 472 
>>(maildir_sync_uidlist): assertion failed: (ACTION(hash_rec) == 
>>MAILDIR_FILE_ACTION_NEW)
> 
> 
> Still hmm. But it could be related to the bug I found which was mostly
> just crashing or causing some other errors with me. Try if cvs update
> fixes.

the current is ok?

-- 
   Levente                               "Si vis pacem para bellum!"


From tss@iki.fi  Wed May 28 14:39:14 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 03BB4238C6; Wed, 28 May 2003 14:39:14 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 3C23023845
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 14:39:12 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 0345C5C896C6; Wed, 28 May 2003 14:39:12 +0300 (EEST)
Subject: Re: [Dovecot] new problems
From: Timo Sirainen <tss@iki.fi>
To: Dovecot List <dovecot@procontrol.fi>
In-Reply-To: <3ED49E33.5080300@bnap.hu>
References: <3ED47E4F.1000005@bnap.hu> <1054120600.23632.259.camel@hurina>
	 <3ED49E33.5080300@bnap.hu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1054121951.19156.282.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 28 May 2003 14:39:11 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 28 May 2003 11:39:14 -0000
X-UID: 843                                                  
Status: O

On Wed, 2003-05-28 at 14:32, Farkas Levente wrote:
> > Did you try with default_mail_env = maildir:~/Maildir:INDEX=MEMORY? Does
> > that effect the load at all?
> 
> yes I try. first it drop the load but today I can't do anything, since 
> the load was above 20 in both case.

Did it drop the load much? Because it shouldn't, except because of these
bugs that required rebuilding indexes. I'd like to know what causes
these loads, but I can't really even guess without at least knowing what
area is doing that (index building, clients downloading too many mails,
..?). Maybe I should write some kind of statistics gathering code which
could be used to find that out..

> > CVS was somewhat broken in 2003-05-23 14:40 .. 2003-05-26 13:07. If
> > you're running such version that would explain this error.
> 
> the current is ok?

Yes.

From lfarkas@bnap.hu  Wed May 28 14:46:43 2003
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id C39E3238C6; Wed, 28 May 2003 14:46:43 +0300 (EEST)
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 3C5B123845
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 14:46:41 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id B713F75400F
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 13:46:02 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id 753CD3ECA
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 13:46:36 +0200 (CEST)
Received: from bnap.hu (garfield.int.bppiac.hu [192.168.0.50])
	by mail2.bppiac.hu (Postfix) with ESMTP id 5B9FC3EB8
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 13:46:36 +0200 (CEST)
Message-ID: <3ED4A199.9090501@bnap.hu>
Date: Wed, 28 May 2003 13:46:33 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
Subject: [Dovecot] the most serius problems [part 1]
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 28 May 2003 11:46:43 -0000
X-UID: 844                                                  
Status: O
Content-Length: 1507

hi,
I try to collect out most serious problem with dovecot. so I write a 
series of mails:-)
the first on is the load.
has anybody else use dovecot in a real enviromnt with at least hundreds 
of users and at least 50 concurrent user at the same time?
it seems to me no one else just me.
the weekend I move the whole mail system to a quad P4 with 1Gb ram and 
this server do nothing just imap. yesterday evening I have to delete all 
.imap.index and other dovecot specific files. and as I wrote today 
morning the load was about 20-30 !!!. but even in an average day the 
load is over 2-3 white the cpu load is 1-2% in each of the 4 processor.
the system is totaly unusable. what more today I've got other errors. of 
course all the time when I can't find the colution I try to escape to 
the latest cvs. today finally I compile a new courier install it to 
another port and those clients which can't connect to dovecot 
reconfigure to courier. but they are not compatible!!! I have to set 
root directory to INBOX in courier while not for dovecot and this is a 
real big problem. is there any way to compile dovecot to use INBOX as a 
root directory? since in this case at least there is a chance to switch 
to courier without reconfigure 300 OE6.
I try to help to find out the reason for the load in any way, but it 
seems to me than it's better to change to courier or cyrus since our 
users getting angry not to mention my boss.

-- 
   Levente                               "Si vis pacem para bellum!"


From lfarkas@bnap.hu  Wed May 28 14:51:38 2003
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 75756238C6; Wed, 28 May 2003 14:51:38 +0300 (EEST)
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id DEE7D23845
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 14:51:36 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id 4FC4D75400C
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 13:50:59 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id 342D73EC4
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 13:51:36 +0200 (CEST)
Received: from bnap.hu (garfield.int.bppiac.hu [192.168.0.50])
	by mail2.bppiac.hu (Postfix) with ESMTP id 22AE43EB8
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 13:51:36 +0200 (CEST)
Message-ID: <3ED4A2C4.6060104@bnap.hu>
Date: Wed, 28 May 2003 13:51:32 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
Subject: [Dovecot] still has error
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 28 May 2003 11:51:38 -0000
X-UID: 845                                                  
Status: O

hi,
after download the current cvs recompile, start I still has these errors:
-------------------------------------
imap-login: May 28 13:49:02 Info: Login: jcsinalos [192.168.0.106]
imap(jcsinalos): May 28 13:49:02 Panic: unreached
dovecot: May 28 13:49:02 Error: child 31683 (imap) killed with signal 6
imap-login: May 28 13:49:03 Info: Login: jcsinalos [192.168.0.106]
imap-login: May 28 13:49:03 Info: Login: jcsinalos [192.168.0.106]
imap(jcsinalos): May 28 13:49:03 Panic: unreached
dovecot: May 28 13:49:03 Error: child 31687 (imap) killed with signal 6
-------------------------------------

-- 
   Levente                               "Si vis pacem para bellum!"


From lfarkas@bnap.hu  Wed May 28 14:54:43 2003
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 757DB238CE; Wed, 28 May 2003 14:54:43 +0300 (EEST)
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id DA37D238C6
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 14:54:41 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP
	id 3EA5975400C; Wed, 28 May 2003 13:54:04 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP
	id 2D65D3EC4; Wed, 28 May 2003 13:54:41 +0200 (CEST)
Received: from bnap.hu (garfield.int.bppiac.hu [192.168.0.50])
	by mail2.bppiac.hu (Postfix) with ESMTP
	id 0B3B13EB8; Wed, 28 May 2003 13:54:41 +0200 (CEST)
Message-ID: <3ED4A37D.2000309@bnap.hu>
Date: Wed, 28 May 2003 13:54:37 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Timo Sirainen <tss@iki.fi>
Subject: Re: [Dovecot] new problems
References: <3ED47E4F.1000005@bnap.hu> <1054120600.23632.259.camel@hurina>
	<3ED49E33.5080300@bnap.hu> <1054121951.19156.282.camel@hurina>
In-Reply-To: <1054121951.19156.282.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
cc: Dovecot List <dovecot@procontrol.fi>
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 28 May 2003 11:54:43 -0000
X-UID: 846                                                  
Status: O
Content-Length: 1034

Timo Sirainen wrote:
> On Wed, 2003-05-28 at 14:32, Farkas Levente wrote:
> 
>>>Did you try with default_mail_env = maildir:~/Maildir:INDEX=MEMORY? Does
>>>that effect the load at all?
>>
>>yes I try. first it drop the load but today I can't do anything, since 
>>the load was above 20 in both case.
> 
> 
> Did it drop the load much? Because it shouldn't, except because of these
> bugs that required rebuilding indexes. I'd like to know what causes
> these loads, but I can't really even guess without at least knowing what
> area is doing that (index building, clients downloading too many mails,
> ..?). Maybe I should write some kind of statistics gathering code which
> could be used to find that out..

do anything you like, but I can't told you more than there is almost 
nothing on this server just dovecot. if you give me any kind of tool 
I'll try it.
actualy there is a named, dhcp, etc... but the load before dovecot was 
about 0.05 maximum 0.2!

-- 
   Levente                               "Si vis pacem para bellum!"


From tss@iki.fi  Wed May 28 14:56:02 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id F1547238CE; Wed, 28 May 2003 14:56:02 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 8E92F238C6
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 14:56:00 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 69DCE5C896C6; Wed, 28 May 2003 14:56:00 +0300 (EEST)
Subject: Re: [Dovecot] still has error
From: Timo Sirainen <tss@iki.fi>
To: Dovecot List <dovecot@procontrol.fi>
In-Reply-To: <3ED4A2C4.6060104@bnap.hu>
References: <3ED4A2C4.6060104@bnap.hu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1054122960.2849.285.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 28 May 2003 14:56:00 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 28 May 2003 11:56:03 -0000
X-UID: 847                                                  
Status: O

On Wed, 2003-05-28 at 14:51, Farkas Levente wrote:
> imap(jcsinalos): May 28 13:49:02 Panic: unreached

Setting "mail_drop_priv_before_exec = yes" should create core dump in
their home directory.

gdb /usr/local/libexec/dovecot/imap /home/.../core
bt

would show where this happened.

From lfarkas@bnap.hu  Wed May 28 14:57:53 2003
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 46A97238CE; Wed, 28 May 2003 14:57:53 +0300 (EEST)
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 9BA86238C6
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 14:57:50 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id 0499475400C
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 13:57:13 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id DCDC63EC4
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 13:57:49 +0200 (CEST)
Received: from bnap.hu (garfield.int.bppiac.hu [192.168.0.50])
	by mail2.bppiac.hu (Postfix) with ESMTP id C78173EB8
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 13:57:49 +0200 (CEST)
Message-ID: <3ED4A43A.90608@bnap.hu>
Date: Wed, 28 May 2003 13:57:46 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: Re: [Dovecot] new problems
References: <3ED47E4F.1000005@bnap.hu> <1054120600.23632.259.camel@hurina>
	<3ED49E33.5080300@bnap.hu> <1054121951.19156.282.camel@hurina>
	<3ED4A37D.2000309@bnap.hu>
In-Reply-To: <3ED4A37D.2000309@bnap.hu>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 28 May 2003 11:57:53 -0000
X-UID: 848                                                  
Status: O
Content-Length: 1393

Farkas Levente wrote:
> Timo Sirainen wrote:
> 
>> On Wed, 2003-05-28 at 14:32, Farkas Levente wrote:
>>
>>>> Did you try with default_mail_env = maildir:~/Maildir:INDEX=MEMORY? 
>>>> Does
>>>> that effect the load at all?
>>>
>>>
>>> yes I try. first it drop the load but today I can't do anything, 
>>> since the load was above 20 in both case.
>>
>>
>>
>> Did it drop the load much? Because it shouldn't, except because of these
>> bugs that required rebuilding indexes. I'd like to know what causes
>> these loads, but I can't really even guess without at least knowing what
>> area is doing that (index building, clients downloading too many mails,
>> ..?). Maybe I should write some kind of statistics gathering code which
>> could be used to find that out..
> 
> 
> do anything you like, but I can't told you more than there is almost 
> nothing on this server just dovecot. if you give me any kind of tool 
> I'll try it.
> actualy there is a named, dhcp, etc... but the load before dovecot was 
> about 0.05 maximum 0.2!

I switch my own mailbox from dovecot to courier (on the same server both 
are running now) and it a LOT faster!
the simplist test to delete a mail and mozilla just jump to the next 
one. it took about 5-10 sec with dovecot!!! while it almost nothing 
(less than 1 sec) with courier.....

-- 
   Levente                               "Si vis pacem para bellum!"


From tss@iki.fi  Wed May 28 15:01:45 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 3C142238D3; Wed, 28 May 2003 15:01:45 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 9E863238CE
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 15:01:43 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 70FCD5C896C6; Wed, 28 May 2003 15:01:43 +0300 (EEST)
Subject: Re: [Dovecot] the most serius problems [part 1]
From: Timo Sirainen <tss@iki.fi>
To: Dovecot List <dovecot@procontrol.fi>
In-Reply-To: <3ED4A199.9090501@bnap.hu>
References: <3ED4A199.9090501@bnap.hu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1054123303.3131.292.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 28 May 2003 15:01:43 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 28 May 2003 12:01:45 -0000
X-UID: 849                                                  
Status: O

On Wed, 2003-05-28 at 14:46, Farkas Levente wrote:
> has anybody else use dovecot in a real enviromnt with at least hundreds 
> of users and at least 50 concurrent user at the same time?

Well, I know 0.99.9 has been in use with some 40 concurrent users (asked
two people). Didn't 0.99.9 actually work with you too without high load?

> I have to set 
> root directory to INBOX in courier while not for dovecot and this is a 
> real big problem. is there any way to compile dovecot to use INBOX as a 
> root directory? since in this case at least there is a chance to switch 
> to courier without reconfigure 300 OE6.

Haven't you configured them now to non-INBOX?

You could kludge Dovecot to use INBOX. prefix, or Courier to not use it,
but there's no pretty way to do it really.

..but i'm late now, have to look these again later today.

From lfarkas@bnap.hu  Wed May 28 15:06:15 2003
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id E8382238D3; Wed, 28 May 2003 15:06:15 +0300 (EEST)
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id ACD1E238CE
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 15:06:13 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id 1E7A0754013
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 14:05:32 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id EE1BD3EC4
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 14:06:08 +0200 (CEST)
Received: from bnap.hu (garfield.int.bppiac.hu [192.168.0.50])
	by mail2.bppiac.hu (Postfix) with ESMTP id CC43E3EB8
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 14:06:08 +0200 (CEST)
Message-ID: <3ED4A62D.9060506@bnap.hu>
Date: Wed, 28 May 2003 14:06:05 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
Cc: Dovecot List <dovecot@procontrol.fi>
Subject: Re: [Dovecot] still has error
References: <3ED4A2C4.6060104@bnap.hu> <1054122960.2849.285.camel@hurina>
In-Reply-To: <1054122960.2849.285.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 28 May 2003 12:06:16 -0000
X-UID: 850                                                  
Status: O

Timo Sirainen wrote:
> On Wed, 2003-05-28 at 14:51, Farkas Levente wrote:
> 
>>imap(jcsinalos): May 28 13:49:02 Panic: unreached
> 
> 
> Setting "mail_drop_priv_before_exec = yes" should create core dump in
> their home directory.
> 
> gdb /usr/local/libexec/dovecot/imap /home/.../core
> bt
> 
> would show where this happened.

there is no core file created, the only differene that OE stop and such 
error logs:

dovecot: May 28 14:00:11 Error: child 1086 (imap) returned error 80 
(Can't open log file)

-- 
   Levente                               "Si vis pacem para bellum!"


From lfarkas@bnap.hu  Wed May 28 15:27:53 2003
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 233DE2387F; Wed, 28 May 2003 15:27:53 +0300 (EEST)
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 4B08723865
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 15:27:49 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id A7E8F75400C
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 14:27:11 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id 8F5BC3EC4
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 14:27:48 +0200 (CEST)
Received: from bnap.hu (garfield.int.bppiac.hu [192.168.0.50])
	by mail2.bppiac.hu (Postfix) with ESMTP id 7CE863EB8
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 14:27:48 +0200 (CEST)
Message-ID: <3ED4AB41.3080401@bnap.hu>
Date: Wed, 28 May 2003 14:27:45 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: Re: [Dovecot] still has error
References: <3ED4A2C4.6060104@bnap.hu> <1054122960.2849.285.camel@hurina>
	<3ED4A62D.9060506@bnap.hu>
In-Reply-To: <3ED4A62D.9060506@bnap.hu>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 28 May 2003 12:27:53 -0000
X-UID: 851                                                  
Status: O

Farkas Levente wrote:
> Timo Sirainen wrote:
> 
>> On Wed, 2003-05-28 at 14:51, Farkas Levente wrote:
>>
>>> imap(jcsinalos): May 28 13:49:02 Panic: unreached
>>

just a comment for this bug. eg I've got about 20 folders. most of the 
working with dovecot. but eg. .IN.dovecot (which is for dovecot list) is 
not working (when I select that folder) netscape hang.


-- 
   Levente                               "Si vis pacem para bellum!"


From cras@irccrew.org  Wed May 28 15:33:09 2003
Return-Path: <cras@irccrew.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id B4F49238B6; Wed, 28 May 2003 15:33:09 +0300 (EEST)
Received: from shodan.irccrew.org (shodan [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id 3271F2387F
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 15:33:05 +0300 (EEST)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id 145412E003; Wed, 28 May 2003 15:33:05 +0300 (EEST)
Date: Wed, 28 May 2003 15:33:05 +0300
From: Timo Sirainen <tss@iki.fi>
To: Dovecot List <dovecot@procontrol.fi>
Subject: Re: [Dovecot] new problems
Message-ID: <20030528123304.GA148@irccrew.org>
References: <3ED47E4F.1000005@bnap.hu> <1054120600.23632.259.camel@hurina>
	<3ED49E33.5080300@bnap.hu> <1054121951.19156.282.camel@hurina>
	<3ED4A37D.2000309@bnap.hu> <3ED4A43A.90608@bnap.hu>
Mime-Version: 1.0
Content-Disposition: inline
In-Reply-To: <3ED4A43A.90608@bnap.hu>
User-Agent: Mutt/1.4i
Content-Type: text/plain; charset=us-ascii
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 28 May 2003 12:33:09 -0000
X-UID: 852                                                  
Status: O

On Wed, May 28, 2003 at 01:57:46PM +0200, Farkas Levente wrote:
> I switch my own mailbox from dovecot to courier (on the same server both 
> are running now) and it a LOT faster!
> the simplist test to delete a mail and mozilla just jump to the next 
> one. it took about 5-10 sec with dovecot!!! while it almost nothing 
> (less than 1 sec) with courier.....

So Courier works fine even while the load is high? strace's output could
show what Dovecot is doing wrong then. ie. just before expunge:

strace -p your_dovecot_imap_pid > /tmp/dove.log 2>&1

And stop it after expunge has completed.

I'm anyway guessing that it has something to do with the new syncing code..
What filesystem do you use?

From lfarkas@bnap.hu  Thu May 29 00:27:29 2003
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id D8E6023866; Thu, 29 May 2003 00:27:29 +0300 (EEST)
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 4606423865
	for <dovecot@procontrol.fi>; Thu, 29 May 2003 00:27:27 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id 7E94075400D
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 23:26:47 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id 80A6F3EB7
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 23:27:25 +0200 (CEST)
Received: from bnap.hu (eagle.int.bppiac.hu [192.168.255.2])
	by mail2.bppiac.hu (Postfix) with ESMTP id C734D3EB1
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 23:27:24 +0200 (CEST)
Message-ID: <3ED529BC.1040904@bnap.hu>
Date: Wed, 28 May 2003 23:27:24 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20021218
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: Re: [Dovecot] the most serius problems [part 1]
References: <3ED4A199.9090501@bnap.hu> <1054123303.3131.292.camel@hurina>
In-Reply-To: <1054123303.3131.292.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 28 May 2003 21:27:30 -0000
X-UID: 853                                                  
Status: O
Content-Length: 2035

Timo Sirainen wrote:
> On Wed, 2003-05-28 at 14:46, Farkas Levente wrote:
> 
>>has anybody else use dovecot in a real enviromnt with at least hundreds 
>>of users and at least 50 concurrent user at the same time?
> 
> 
> Well, I know 0.99.9 has been in use with some 40 concurrent users (asked
> two people). Didn't 0.99.9 actually work with you too without high load?

unfortunately not.

>>I have to set 
>>root directory to INBOX in courier while not for dovecot and this is a 
>>real big problem. is there any way to compile dovecot to use INBOX as a 
>>root directory? since in this case at least there is a chance to switch 
>>to courier without reconfigure 300 OE6.
> 
> 
> Haven't you configured them now to non-INBOX?
 >
 > You could kludge Dovecot to use INBOX. prefix, or Courier to not use it,
 > but there's no pretty way to do it really.
 >

how can I do that?
do you mean there is a way to configure courier not to use INBOX as a 
prefix?
or is there any way to configure dovecot to use INBOX as a prefix?
I would be very happy if you tel me!
I'd prefer the first one. since in that case I always has a chance to 
simple stop dovecot and start courier in any serious situation.
as I said this's our production server and I can play with it a bit, but 
it's not acceptable to stop the whole mail system for a day. and without 
the above solution it's not possible, since currently if we sould have 
to reconfigure about 300 clients settings (unfortunately this can't be 
automatized since OE6 keep this setting in a registry key which is 
depend on the users mailbox number:-() so if I decide to switch to 
courier than probably we won't shitch back soon.

ps. actualy I'm the head of the it dep. and in normal circumstances 
there are sysadms for the linux systems and for the windows system I 
don't use to login to the servers as root. but since dovecot was my 
decision I try to protect it, but it seems to me problems are getting 
too fast.

-- 
   Levente                               "Si vis pacem para bellum!"


From lfarkas@bnap.hu  Thu May 29 00:56:10 2003
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 2986323866; Thu, 29 May 2003 00:56:10 +0300 (EEST)
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 7607E23865
	for <dovecot@procontrol.fi>; Thu, 29 May 2003 00:56:07 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id 91FEB75400E
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 23:55:28 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id A92A73EB7
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 23:56:06 +0200 (CEST)
Received: from bnap.hu (eagle.int.bppiac.hu [192.168.255.2])
	by mail2.bppiac.hu (Postfix) with ESMTP id 28C8F3EB1
	for <dovecot@procontrol.fi>; Wed, 28 May 2003 23:56:06 +0200 (CEST)
Message-ID: <3ED53075.1010305@bnap.hu>
Date: Wed, 28 May 2003 23:56:05 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20021218
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: Re: [Dovecot] new problems
References: <3ED47E4F.1000005@bnap.hu> <1054120600.23632.259.camel@hurina>
	<3ED49E33.5080300@bnap.hu> <1054121951.19156.282.camel@hurina>
	<3ED4A37D.2000309@bnap.hu> <3ED4A43A.90608@bnap.hu>
	<20030528123304.GA148@irccrew.org>
In-Reply-To: <20030528123304.GA148@irccrew.org>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 28 May 2003 21:56:10 -0000
X-UID: 854                                                  
Status: O
Content-Length: 1381

Timo Sirainen wrote:
> On Wed, May 28, 2003 at 01:57:46PM +0200, Farkas Levente wrote:
> 
>>I switch my own mailbox from dovecot to courier (on the same server both 
>>are running now) and it a LOT faster!
>>the simplist test to delete a mail and mozilla just jump to the next 
>>one. it took about 5-10 sec with dovecot!!! while it almost nothing 
>>(less than 1 sec) with courier.....
> 
> 
> So Courier works fine even while the load is high? strace's output could

no we used to stop dovecot and killall imap what for the low load and
restart dovecot manually. after we do it for an hour the load goes back
to "just" 2-3 and in this case yes courier is much faster that dovecot.

> show what Dovecot is doing wrong then. ie. just before expunge:
> 
> strace -p your_dovecot_imap_pid > /tmp/dove.log 2>&1

which imap process? since even if I set the maximum imap connection in 
mozilla to 1 logout and login again the mozilla (or dovecot) change it 
back to at least 2:-(
anyway I try all of them, both as root and as the user itself, the only 
result is:
trace: ptrace(PTRACE_SYSCALL, ...): Operation not permitted

> And stop it after expunge has completed.

any other logging mode?

> I'm anyway guessing that it has something to do with the new syncing code..
> What filesystem do you use?

ext3


-- 
    Levente                               "Si vis pacem para bellum!"



From lfarkas@bnap.hu  Thu May 29 01:58:20 2003
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id D23AA23866; Thu, 29 May 2003 01:58:20 +0300 (EEST)
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 3F72623845
	for <dovecot@procontrol.fi>; Thu, 29 May 2003 01:58:18 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id BF58675401D
	for <dovecot@procontrol.fi>; Thu, 29 May 2003 00:57:38 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id 0AD1A3EB7
	for <dovecot@procontrol.fi>; Thu, 29 May 2003 00:58:17 +0200 (CEST)
Received: from bnap.hu (eagle.int.bppiac.hu [192.168.255.2])
	by mail2.bppiac.hu (Postfix) with ESMTP id B17E53EB1
	for <dovecot@procontrol.fi>; Thu, 29 May 2003 00:58:16 +0200 (CEST)
Message-ID: <3ED53F08.3000709@bnap.hu>
Date: Thu, 29 May 2003 00:58:16 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20021218
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
Subject: [Dovecot] the most serius problems [part 2]
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 28 May 2003 22:58:21 -0000
X-UID: 855                                                  
Status: O

hi,
the second thing is the webmail. we use squirrelmail. actualy I don't 
know whose fault is, but they told that them imap server's:-)
first problems is that those mails which has empty body (even if they 
has an attachments) simple not shown in the mail list (as they even not 
exists). it'd be nice to check this and find the reason of the problem. 
this happend with more people.


-- 
   Levente                               "Si vis pacem para bellum!"


From lfarkas@bnap.hu  Thu May 29 02:00:31 2003
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 23865238B6; Thu, 29 May 2003 02:00:31 +0300 (EEST)
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 9AA8B23866
	for <dovecot@procontrol.fi>; Thu, 29 May 2003 02:00:28 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id 6318875401D
	for <dovecot@procontrol.fi>; Thu, 29 May 2003 00:59:49 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id A42C13EB7
	for <dovecot@procontrol.fi>; Thu, 29 May 2003 01:00:27 +0200 (CEST)
Received: from bnap.hu (eagle.int.bppiac.hu [192.168.255.2])
	by mail2.bppiac.hu (Postfix) with ESMTP id 5B6853EB1
	for <dovecot@procontrol.fi>; Thu, 29 May 2003 01:00:27 +0200 (CEST)
Message-ID: <3ED53F8B.6080200@bnap.hu>
Date: Thu, 29 May 2003 01:00:27 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20021218
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
Subject: [Dovecot] the most serius problems [part 3]
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 28 May 2003 23:00:31 -0000
X-UID: 856                                                  
Status: O

hi,
so the third problem is ssl. the imaps is still not working (and I 
assume the same apply to pop3s too).
I already send the log file which was generated when verbose ssl is set.

-- 
   Levente                               "Si vis pacem para bellum!"


From charlie@rubberduck.com  Thu May 29 04:09:30 2003
Return-Path: <charlie@rubberduck.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id A26772387F; Thu, 29 May 2003 04:09:30 +0300 (EEST)
Received: from lazy.spodder.com (lazy.spodder.com [203.18.242.30])
	by danu.procontrol.fi (Postfix) with ESMTP id 315CF23866
	for <dovecot@procontrol.fi>; Thu, 29 May 2003 04:09:27 +0300 (EEST)
Received: by lazy.spodder.com (Postfix, from userid 501)
	id 05E738FE9; Thu, 29 May 2003 11:09:12 +1000 (EST)
Date: Thu, 29 May 2003 11:09:11 +1000
From: Charlie Allom <charlie@rubberduck.com>
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] DRAC support?
Message-ID: <20030529010911.GA19139@lazy.spodder.com>
References: <20030515011306.GA3731@lazy.spodder.com>
	<20030515043029.GA18617@lazy.spodder.com>
	<200305142137.11186.jryden@thebox.our-own.net>
	<20030516191335.GA196@dust.uchicago.edu>
	<20030517063125.GA23270@lazy.spodder.com> <1053502215.1214.337.camel@hurina>
	<20030521073959.GD27088@lazy.spodder.com> <1053508449.1218.348.camel@hurina>
	<20030528050825.GA10934@lazy.spodder.com> <1054121419.3131.275.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1054121419.3131.275.camel@hurina>
User-Agent: Mutt/1.5.4i
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Thu, 29 May 2003 01:09:30 -0000
X-UID: 857                                                  
Status: O
Content-Length: 2411

On Wed, May 28, 2003 at 02:30:19PM +0300, Timo Sirainen wrote:
> On Wed, 2003-05-28 at 08:08, Charlie Allom wrote:
> > still going here .. I have test2 and last drac.c
> > 
> > it all compiled much more cleanly this time.
> > 
> > NB you have to hand edit and #define HAVE_MODULES in config.h
> 
> That's not enough. If configure doesn't detect that you have modules,
> it's not setting the linker flags correctly and it won't work.
> 
> Looks like BSDs don't have libdl which is why configure's test fails.
> 
> Try -test7, I just updated it so that the check should work.
> 

Thanks, but drac.so will not compile with this anymore.

test2 does it cleanly, I will paste in my findings:
10:58 yeled@lazy:~/dovecot-0.99.10-test2$ export dovecot=~/dovecot-0.99.10-test2
10:58 yeled@lazy:~/dovecot-0.99.10-test2$ gcc -Wall -W -shared -fPIC -DHAVE_CONFIG_H -I$dovecot -I$dovecot/src/lib drac.c -o drac.so -I/usr/pkg/lib/libdrac.a
10:59 yeled@lazy:~/dovecot-0.99.10-test2$ cd ../dovecot-0.99.10-test7/
10:59 yeled@lazy:~/dovecot-0.99.10-test7$ export dovecot=~/dovecot-0.99.10-test7
10:59 yeled@lazy:~/dovecot-0.99.10-test7$ gcc -Wall -W -shared -fPIC -DHAVE_CONFIG_H -I$dovecot -I$dovecot/src/lib drac.c -o drac.so -I/usr/pkg/lib/libdrac.a
In file included from drac.c:14:
/home/yeled/dovecot-0.99.10-test7/src/lib/lib.h:6: ../../config.h: No such file or directory
In file included from /home/yeled/dovecot-0.99.10-test7/src/lib/lib.h:20,            
                 from drac.c:14:
/home/yeled/dovecot-0.99.10-test7/src/lib/compat.h:17: #error uoff_t size not set
10:59 yeled@lazy:~/dovecot-0.99.10-test7$ 

weird? anyway test7 still does not fix these HAVE_MODULES issue.

<snip>
creating src/master/Makefile
creating src/pop3/Makefile
creating src/pop3-login/Makefile
creating stamp.h
creating dovecot.spec
creating config.h

Install prefix ...................... : /usr/local
File offsets ........................ : 64bit
Building with SSL support ........... : yes (OpenSSL)
Building with IPv6 support .......... : yes
Building with pop3 server ........... : yes
Building with user database modules . : static passwd passwd-file
Building with password lookup modules : passwd passwd-file
11:07 yeled@lazy:~/dovecot-0.99.10-test7$ grep MODU config.h
/* #undef HAVE_MODULES */


-- 
 charlie@rubberduck.com - Melbourne, Australia
 http://rubberduck.com/~yeled/
 PGP: 0x14AA7941 || finger yeled@lazy.spodder.com
From mem@mv.mv.com  Thu May 29 22:53:50 2003
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id DC6AB2387F; Thu, 29 May 2003 22:53:50 +0300 (EEST)
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id 75BEE23865
	for <dovecot@procontrol.fi>; Thu, 29 May 2003 22:53:46 +0300 (EEST)
Received: (qmail 3583 invoked by uid 101); 29 May 2003 15:53:41 -0400
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Thu, 29 May 2003 15:53:41 -0400
To: Farkas Levente <lfarkas@bnap.hu>
Subject: Re: [Dovecot] the most serius problems [part 1]
Message-ID: <20030529195340.GB24637@iridium.mv.net>
References: <3ED4A199.9090501@bnap.hu>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <3ED4A199.9090501@bnap.hu>
User-Agent: Mutt/1.4.1i
cc: Dovecot List <dovecot@procontrol.fi>
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Thu, 29 May 2003 19:53:51 -0000
X-UID: 858                                                  
Status: O
Content-Length: 1535

On Wed, May 28, 2003 at 01:46:33PM +0200, Farkas Levente wrote:
> the first on is the load.
> has anybody else use dovecot in a real enviromnt with at least hundreds 
> of users and at least 50 concurrent user at the same time?
> it seems to me no one else just me.

That seems like an awfully high percentage of users connecting- if I
assume "hundreds" might mean 300, 1 out of every 6 users is connected
at any given time?

One of the servers running dovecot here has thousands of users.  During
the middle of the day I typically see 17-20 users connected at any
given time.  This has been known to increase to 50+ especially during
prime time (evening).  Over a period of 24 hours dovecot logins occur
at the rate of around 2.5 logins per second.  Now- most of our users
are using POP rather than IMAP, but there is still a reasonable amount
of IMAP activity.  Plus I'm not sure that detail matters: POP logins
use resources too, perhaps repeated POP logins use more than
constantly-connected imap sessions.

The load on the server due to dovecot is negligable.  Most of the load
is due to handling incoming mail.  Obviously you are seeing something
different- perhaps you are using features that we are not.

I rather wish dovecot would log some more statistics, as I think has
been mentioned already- like a record for logout as well as one for
login, including number of messages scanned, left on server,
downloaded, and deleted, plus total bytes transferred).  These numbers
would give a better picture of what's going on.

-mm-
From lfarkas@bnap.hu  Thu May 29 23:22:23 2003
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id BDDA92387F; Thu, 29 May 2003 23:22:23 +0300 (EEST)
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 8DF6723866
	for <dovecot@procontrol.fi>; Thu, 29 May 2003 23:22:20 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id C456175400D
	for <dovecot@procontrol.fi>; Thu, 29 May 2003 22:21:37 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id 8EC783EB7
	for <dovecot@procontrol.fi>; Thu, 29 May 2003 22:22:18 +0200 (CEST)
Received: from bnap.hu (eagle.int.bppiac.hu [192.168.255.2])
	by mail2.bppiac.hu (Postfix) with ESMTP id A79713EB1
	for <dovecot@procontrol.fi>; Thu, 29 May 2003 22:22:17 +0200 (CEST)
Message-ID: <3ED66BF9.80004@bnap.hu>
Date: Thu, 29 May 2003 22:22:17 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20021218
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: Re: [Dovecot] the most serius problems [part 1]
References: <3ED4A199.9090501@bnap.hu> <20030529195340.GB24637@iridium.mv.net>
In-Reply-To: <20030529195340.GB24637@iridium.mv.net>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Thu, 29 May 2003 20:22:23 -0000
X-UID: 859                                                  
Status: O
Content-Length: 2627

Mark E. Mallett wrote:
> On Wed, May 28, 2003 at 01:46:33PM +0200, Farkas Levente wrote:
> 
>>the first on is the load.
>>has anybody else use dovecot in a real enviromnt with at least hundreds 
>>of users and at least 50 concurrent user at the same time?
>>it seems to me no one else just me.
> 
> 
> That seems like an awfully high percentage of users connecting- if I
> assume "hundreds" might mean 300, 1 out of every 6 users is connected
> at any given time?
> 
> One of the servers running dovecot here has thousands of users.  During
> the middle of the day I typically see 17-20 users connected at any
> given time.  This has been known to increase to 50+ especially during
> prime time (evening).  Over a period of 24 hours dovecot logins occur
> at the rate of around 2.5 logins per second.  Now- most of our users
> are using POP rather than IMAP, but there is still a reasonable amount
> of IMAP activity.  Plus I'm not sure that detail matters: POP logins
> use resources too, perhaps repeated POP logins use more than
> constantly-connected imap sessions.
> 
> The load on the server due to dovecot is negligable.  Most of the load
> is due to handling incoming mail.  Obviously you are seeing something
> different- perhaps you are using features that we are not.
> 
> I rather wish dovecot would log some more statistics, as I think has
> been mentioned already- like a record for logout as well as one for
> login, including number of messages scanned, left on server,
> downloaded, and deleted, plus total bytes transferred).  These numbers
> would give a better picture of what's going on.

the reason is simple there are about 300 users when they come in at the 
morning thay simple start OE6 and never exit from it just when they go 
home (why do they do so?). so in the prime I saw 126 imap connection at 
the same time. and most user has a real big mailboxes without any 
organization/folders (just inbox, sent and drafts). incoming mails are 
handled by postfix which is realy fast, reliable and almost no load at 
all. here everybody use imap since most people doesn't have an own desk 
(only 50 has) so everybody just sit down to the first free desk. in this 
case only the imap is the solution.
the real load comes when indexing or reindexing is running (eg. if we 
delete all index file for same reason). in this case even 10 imap 
connections are able to create a load about 10 (while the cpu are 95% 
idle). and there is something wrong with 0.99.9 series. since now when 
I've to switch back to 0.99.8 it's a lot faster.

-- 
   Levente                               "Si vis pacem para bellum!"


From lfarkas@bnap.hu  Thu May 29 23:24:06 2003
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id C6A302387F; Thu, 29 May 2003 23:24:06 +0300 (EEST)
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 0FF2B23866
	for <dovecot@procontrol.fi>; Thu, 29 May 2003 23:24:05 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id 8CBE675400D
	for <dovecot@procontrol.fi>; Thu, 29 May 2003 22:23:23 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id 5B2823EB7
	for <dovecot@procontrol.fi>; Thu, 29 May 2003 22:24:04 +0200 (CEST)
Received: from bnap.hu (eagle.int.bppiac.hu [192.168.255.2])
	by mail2.bppiac.hu (Postfix) with ESMTP id C3E973EB1
	for <dovecot@procontrol.fi>; Thu, 29 May 2003 22:24:03 +0200 (CEST)
Message-ID: <3ED66C63.6030307@bnap.hu>
Date: Thu, 29 May 2003 22:24:03 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20021218
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: Re: [Dovecot] the most serius problems [part 1]
References: <3ED4A199.9090501@bnap.hu> <20030529195340.GB24637@iridium.mv.net>
In-Reply-To: <20030529195340.GB24637@iridium.mv.net>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Thu, 29 May 2003 20:24:06 -0000
X-UID: 860                                                  
Status: O
Content-Length: 1876

what's more we plan to centralize two more companies mailbox (about 
50+200 mailbox) so we need a system which able to handle about 500 
mailbox and about 200 concurrent users.

Mark E. Mallett wrote:
> On Wed, May 28, 2003 at 01:46:33PM +0200, Farkas Levente wrote:
> 
>>the first on is the load.
>>has anybody else use dovecot in a real enviromnt with at least hundreds 
>>of users and at least 50 concurrent user at the same time?
>>it seems to me no one else just me.
> 
> 
> That seems like an awfully high percentage of users connecting- if I
> assume "hundreds" might mean 300, 1 out of every 6 users is connected
> at any given time?
> 
> One of the servers running dovecot here has thousands of users.  During
> the middle of the day I typically see 17-20 users connected at any
> given time.  This has been known to increase to 50+ especially during
> prime time (evening).  Over a period of 24 hours dovecot logins occur
> at the rate of around 2.5 logins per second.  Now- most of our users
> are using POP rather than IMAP, but there is still a reasonable amount
> of IMAP activity.  Plus I'm not sure that detail matters: POP logins
> use resources too, perhaps repeated POP logins use more than
> constantly-connected imap sessions.
> 
> The load on the server due to dovecot is negligable.  Most of the load
> is due to handling incoming mail.  Obviously you are seeing something
> different- perhaps you are using features that we are not.
> 
> I rather wish dovecot would log some more statistics, as I think has
> been mentioned already- like a record for logout as well as one for
> login, including number of messages scanned, left on server,
> downloaded, and deleted, plus total bytes transferred).  These numbers
> would give a better picture of what's going on.
> 
> -mm-
> 


-- 
   Levente                               "Si vis pacem para bellum!"


From tss@iki.fi  Fri May 30 02:17:22 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 75FD7238C6; Fri, 30 May 2003 02:17:22 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 9BD332387F
	for <dovecot@procontrol.fi>; Fri, 30 May 2003 02:17:19 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id D969A5C896C6; Fri, 30 May 2003 02:17:18 +0300 (EEST)
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1054250238.23632.343.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 30 May 2003 02:17:18 +0300
Subject: [Dovecot] 0.99.10-test8
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Thu, 29 May 2003 23:17:22 -0000
X-UID: 861                                                  
Status: O

http://dovecot.procontrol.fi/test/

Again major maildir syncing updates:
 - uidlist file is accessed and rewritten a lot less often now than
before
 - mail duplicates are detected and handled properly by renaming them to
new base name
 - message flag updates and expunging before did two full syncs for cur/
directory. now it does only one.
 - some fixes to syncing in read-only / out-of-quota conditions
 - before we did always a full sync in cur/ directory when mailbox was
opened. now it's done only when needed.
 - fixed some crash/index corruption cases

I think syncing should be now very close to having perfect possible
performance.

From tss@iki.fi  Fri May 30 02:51:47 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 7966F238C8; Fri, 30 May 2003 02:51:47 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id B04A223865
	for <dovecot@procontrol.fi>; Fri, 30 May 2003 02:51:45 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 6266D5C896C6; Fri, 30 May 2003 02:51:45 +0300 (EEST)
Subject: Re: [Dovecot] the most serius problems [part 1]
From: Timo Sirainen <tss@iki.fi>
To: Dovecot List <dovecot@procontrol.fi>
In-Reply-To: <3ED529BC.1040904@bnap.hu>
References: <3ED4A199.9090501@bnap.hu> <1054123303.3131.292.camel@hurina>
	 <3ED529BC.1040904@bnap.hu>
Content-Type: multipart/mixed; boundary="=-DPP3AhNVsdSqcRxuuQpx"
Organization: 
Message-Id: <1054252304.19156.379.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 30 May 2003 02:51:45 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Thu, 29 May 2003 23:51:47 -0000
X-UID: 862                                                  
Status: O
Content-Length: 3958


--=-DPP3AhNVsdSqcRxuuQpx
Content-Type: text/plain
Content-Transfer-Encoding: 7bit

On Thu, 2003-05-29 at 00:27, Farkas Levente wrote:
>  > You could kludge Dovecot to use INBOX. prefix, or Courier to not use it,
>  > but there's no pretty way to do it really.
>  >
> 
> how can I do that?
> do you mean there is a way to configure courier not to use INBOX as a 
> prefix?

No, I mean you can do it by messing enough with the sources. Hmm. I
don't think it would be too difficult. OK, here's patch against 1.7.0. I
tested a few commands manually and they seemed to work, but maybe I
missed something.

If you plan on switching between Courier <-> Dovecot, you should keep
courierimapuiddb and dovecot-uidlist files synchronized or clients will
download the whole mailbox again every time you do the switch. Easiest
way to do this would be to just change Dovecot to use courierimapuiddb
file directly, you can change that from
src/lib-index/maildir/maildir-uidlist.h

Subscription file would be also nice to keep synced. You set Dovecot to
use courierimapsubscribed from
src/lib-storage/subscription-file/subscription-file.c

> or is there any way to configure dovecot to use INBOX as a prefix?

Not yet, but it's in TODO along with other namespace configuration.



--=-DPP3AhNVsdSqcRxuuQpx
Content-Disposition: attachment; filename=courier-noinbox.diff
Content-Type: text/x-patch; name=courier-noinbox.diff; charset=ISO-8859-15
Content-Transfer-Encoding: quoted-printable

diff -ru courier-imap-1.7.0/imap/imapd.c courier-imap-1.7.0-new/imap/imapd.=
c
--- courier-imap-1.7.0/imap/imapd.c	2003-01-23 15:02:39.000000000 +0200
+++ courier-imap-1.7.0-new/imap/imapd.c	2003-05-30 02:36:59.000000000 +0300
@@ -334,24 +334,11 @@
 	else
 	{
 #if	HAVE_STRNCASECMP
-		if (strncasecmp(arg, INBOX, sizeof(INBOX)-1))
+		if (strncasecmp(arg, INBOX, sizeof(INBOX)-1) =3D=3D 0)
 #else
-		if (strnicmp(arg, INBOX, sizeof(INBOX)-1))
+		if (strnicmp(arg, INBOX, sizeof(INBOX)-1) =3D=3D 0)
 #endif
-		{
-			free(p);
-			return (0);
-		}
-
-		arg +=3D sizeof(INBOX)-1;
-
-		if (*arg =3D=3D 0)
 			arg=3Dmaildir_folderdir(0, 0);
-		else if (*arg++ !=3D '.')
-		{
-			free(p);
-			return (0);
-		}
 		else
 			arg=3Dmaildir_folderdir(0, arg);
 	}
@@ -2475,7 +2462,7 @@
 	{
 		if (nexttoken()->tokentype !=3D IT_EOL)
 			return (-1);
-		writes("* NAMESPACE ((\"INBOX.\" \".\")) NIL ((\""
+		writes("* NAMESPACE ((\"\" \".\")) NIL ((\""
 			SHARED ".\" \".\"))\r\n");
 		writes(tag);
 		writes(" OK NAMESPACE completed.\r\n");
diff -ru courier-imap-1.7.0/imap/mailboxlist.c courier-imap-1.7.0-new/imap/=
mailboxlist.c
--- courier-imap-1.7.0/imap/mailboxlist.c	2002-07-02 23:01:37.000000000 +03=
00
+++ courier-imap-1.7.0-new/imap/mailboxlist.c	2003-05-30 02:42:09.000000000=
 +0300
@@ -394,10 +394,11 @@
 			free(p);
 			continue;
 		}
-		strcpy(p, "INBOX");
=20
-		if (strcmp(de->d_name, "."))
-			strcat(p, de->d_name);
+		if (strcmp(de->d_name, ".") =3D=3D 0)
+			strcpy(p, "INBOX");
+		else
+			strcpy(p, de->d_name+1);
=20
 		if (bad_pattern)
 		{
@@ -572,22 +573,20 @@
=20
 static int match_mailbox(char *name, char *pattern)
 {
-size_t	i;
-
 	/* First component, INBOX, is case insensitive */
=20
-	for (i=3D0; name[i] && name[i] !=3D HIERCH; i++)
-		name[i]=3Dtoupper( (int)(unsigned char)name[i] );
+	if (strncasecmp(name, "INBOX", 5) =3D=3D 0)
+		memcpy(name, "INBOX", 5);
=20
-	for (i=3D0; pattern[i] && pattern[i] !=3D HIERCH; i++)
-		pattern[i]=3Dtoupper( (int)(unsigned char)pattern[i] );
+	if (strncasecmp(pattern, "INBOX", 5) =3D=3D 0)
+		memcpy(pattern, "INBOX", 5);
=20
 	/* ... except that "shared" should be lowercase ... */
=20
-	if (memcmp(name, "SHARED", 6) =3D=3D 0)
+	if (strncasecmp(name, "SHARED", 6) =3D=3D 0)
 		memcpy(name, "shared", 6);
=20
-	if (memcmp(pattern, "SHARED", 6) =3D=3D 0)
+	if (strncasecmp(pattern, "SHARED", 6) =3D=3D 0)
 		memcpy(pattern, "shared", 6);
=20
 	return (match_recursive(name, pattern, HIERCH));

--=-DPP3AhNVsdSqcRxuuQpx--
From tss@iki.fi  Fri May 30 02:53:01 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 33E74238C8; Fri, 30 May 2003 02:53:01 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id B1F2023865
	for <dovecot@procontrol.fi>; Fri, 30 May 2003 02:52:59 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 8A3AD5C896C6; Fri, 30 May 2003 02:52:59 +0300 (EEST)
Subject: Re: [Dovecot] DRAC support?
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030529010911.GA19139@lazy.spodder.com>
References: <20030515011306.GA3731@lazy.spodder.com>
	 <20030515043029.GA18617@lazy.spodder.com>
	 <200305142137.11186.jryden@thebox.our-own.net>
	 <20030516191335.GA196@dust.uchicago.edu>
	 <20030517063125.GA23270@lazy.spodder.com>
	 <1053502215.1214.337.camel@hurina>
	 <20030521073959.GD27088@lazy.spodder.com>
	 <1053508449.1218.348.camel@hurina>
	 <20030528050825.GA10934@lazy.spodder.com>
	 <1054121419.3131.275.camel@hurina>
	 <20030529010911.GA19139@lazy.spodder.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1054252379.23632.381.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 30 May 2003 02:52:59 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Thu, 29 May 2003 23:53:01 -0000
X-UID: 863                                                  
Status: O

On Thu, 2003-05-29 at 04:09, Charlie Allom wrote:
> Thanks, but drac.so will not compile with this anymore.
> 
> In file included from drac.c:14:
> /home/yeled/dovecot-0.99.10-test7/src/lib/lib.h:6: ../../config.h: No such file or directory

That looks again like unconfigured dovecot source tree.

> weird? anyway test7 still does not fix these HAVE_MODULES issue.

Right. I messed that up :) Get test8, that should do it.

From tss@iki.fi  Fri May 30 02:54:27 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 175A4238CE; Fri, 30 May 2003 02:54:27 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id A5A2923865
	for <dovecot@procontrol.fi>; Fri, 30 May 2003 02:54:25 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 8694E5C896C6; Fri, 30 May 2003 02:54:25 +0300 (EEST)
Subject: Re: [Dovecot] the most serius problems [part 3]
From: Timo Sirainen <tss@iki.fi>
To: Dovecot List <dovecot@procontrol.fi>
In-Reply-To: <3ED53F8B.6080200@bnap.hu>
References: <3ED53F8B.6080200@bnap.hu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1054252465.23632.383.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 30 May 2003 02:54:25 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Thu, 29 May 2003 23:54:27 -0000
X-UID: 864                                                  
Status: O

On Thu, 2003-05-29 at 02:00, Farkas Levente wrote:
> hi,
> so the third problem is ssl. the imaps is still not working (and I 
> assume the same apply to pop3s too).
> I already send the log file which was generated when verbose ssl is set.

BTW. OpenSSL problems can be fixed by using GNUTLS instead. I'll try to
figure out the openssl some day though.

From tss@iki.fi  Fri May 30 03:02:49 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 49B22238CE; Fri, 30 May 2003 03:02:49 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id C182D23865
	for <dovecot@procontrol.fi>; Fri, 30 May 2003 03:02:47 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 908DA5C896C6; Fri, 30 May 2003 03:02:47 +0300 (EEST)
Subject: Re: [Dovecot] the most serius problems [part 2]
From: Timo Sirainen <tss@iki.fi>
To: Dovecot List <dovecot@procontrol.fi>
In-Reply-To: <3ED53F08.3000709@bnap.hu>
References: <3ED53F08.3000709@bnap.hu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1054252967.19156.389.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 30 May 2003 03:02:47 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 30 May 2003 00:02:49 -0000
X-UID: 865                                                  
Status: O

On Thu, 2003-05-29 at 01:58, Farkas Levente wrote:
> hi,
> the second thing is the webmail. we use squirrelmail. actualy I don't 
> know whose fault is, but they told that them imap server's:-)
> first problems is that those mails which has empty body (even if they 
> has an attachments) simple not shown in the mail list (as they even not 
> exists). it'd be nice to check this and find the reason of the problem. 
> this happend with more people.

What squirrelmail version? Can you send one such mail?

I tested with 1.4.0 RC1 (or 1:1.3.2+1.4.0rc1-1 in Debian) and it seemed
to work just fine.

From bob@cemetery.homeunix.org  Fri May 30 03:33:50 2003
Return-Path: <bob@cemetery.homeunix.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id A3EDE238C8; Fri, 30 May 2003 03:33:50 +0300 (EEST)
Received: from cemetery.homeunix.org (joeldriver.plus.com [212.159.87.165])
	by danu.procontrol.fi (Postfix) with ESMTP id 6E68B238C6
	for <dovecot@procontrol.fi>; Fri, 30 May 2003 03:33:46 +0300 (EEST)
Received: from snot (snot.flatnet [192.168.0.8])
	by cemetery.homeunix.org (8.12.9/8.12.6) with SMTP id h4U0Xeg6021366
	for <dovecot@procontrol.fi>; Fri, 30 May 2003 01:33:40 +0100 (BST)
Date: Fri, 30 May 2003 01:33:36 +0100
From: Andrew Basterfield <bob@cemetery.homeunix.org>
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] 0.99.10-test8
Message-Id: <20030530013336.5d345c8e.bob@cemetery.homeunix.org>
In-Reply-To: <1054250238.23632.343.camel@hurina>
References: <1054250238.23632.343.camel@hurina>
X-Mailer: Sylpheed version 0.8.11claws (GTK+ 1.2.10; i586-pc-linux-gnu)
Mime-Version: 1.0
Content-Type: multipart/signed; protocol="application/pgp-signature";
 micalg="pgp-sha1"; boundary="B'fDWTIjAk=.)VfJ"
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 30 May 2003 00:33:50 -0000
X-UID: 866                                                  
Status: O
Content-Length: 1655

--B'fDWTIjAk=.)VfJ
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

On 30 May 2003 02:17:18 +0300,
Timo Sirainen <tss@iki.fi> wrote:
> http://dovecot.procontrol.fi/test/
> 
> Again major maildir syncing updates:
>  - uidlist file is accessed and rewritten a lot less often now than
> before
>  - mail duplicates are detected and handled properly by renaming them
>  to
> new base name
>  - message flag updates and expunging before did two full syncs for
>  cur/
> directory. now it does only one.
>  - some fixes to syncing in read-only / out-of-quota conditions
>  - before we did always a full sync in cur/ directory when mailbox was
> opened. now it's done only when needed.
>  - fixed some crash/index corruption cases
> 
> I think syncing should be now very close to having perfect possible
> performance.
> 

cc -DHAVE_CONFIG_H -I. -I. -I../..   -I/usr/local/include  -O2   -Wall
-W -Wmissing-prototypes -Wmissing-declarations -Wpointer-arith
-Wchar-subscripts -Wformat=2 -Wbad-function-cast -c module-dir.c
module-dir.c: In function `module_load': module-dir.c:36: `RTLD_GLOBAL'
undeclared (first use in this function) module-dir.c:36: (Each
undeclared identifier is reported only once module-dir.c:36: for each
function it appears in.) module-dir.c:36: `RTLD_NOW' undeclared (first
use in this function)

--Andrew

-- 
http://cemetery.homeunix.org

--B'fDWTIjAk=.)VfJ
Content-Type: application/pgp-signature

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.1 (GNU/Linux)

iD8DBQE+1qbkj3ZMDwYLJGARAj+XAJwLkPJxTH1Hly1l4cfKy42xBGTytgCfbMrs
uSHPYE16O977KgjQJKTZhns=
=iXiF
-----END PGP SIGNATURE-----

--B'fDWTIjAk=.)VfJ--
From tss@iki.fi  Fri May 30 04:04:55 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id D6B7D23866; Fri, 30 May 2003 04:04:55 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 2CA2523845
	for <dovecot@procontrol.fi>; Fri, 30 May 2003 04:04:53 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 01F065C896C6; Fri, 30 May 2003 04:04:52 +0300 (EEST)
Subject: Re: [Dovecot] 0.99.10-test8
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030530013336.5d345c8e.bob@cemetery.homeunix.org>
References: <1054250238.23632.343.camel@hurina>
	 <20030530013336.5d345c8e.bob@cemetery.homeunix.org>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1054256692.23632.393.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 30 May 2003 04:04:52 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 30 May 2003 01:04:56 -0000
X-UID: 867                                                  
Status: O

On Fri, 2003-05-30 at 03:33, Andrew Basterfield wrote:
> function it appears in.) module-dir.c:36: `RTLD_NOW' undeclared (first
> use in this function)

Hmph, BSDs. Fixed in 0.99.10-test9.

From tss@iki.fi  Fri May 30 04:08:42 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 312F823866; Fri, 30 May 2003 04:08:42 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id B4F0B23845
	for <dovecot@procontrol.fi>; Fri, 30 May 2003 04:08:40 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 8B17B5C896C6; Fri, 30 May 2003 04:08:40 +0300 (EEST)
Subject: Re: [Dovecot] 0.99.10-test8
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <1054256692.23632.393.camel@hurina>
References: <1054250238.23632.343.camel@hurina>
	 <20030530013336.5d345c8e.bob@cemetery.homeunix.org>
	 <1054256692.23632.393.camel@hurina>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1054256920.23632.395.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 30 May 2003 04:08:40 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 30 May 2003 01:08:42 -0000
X-UID: 868                                                  
Status: O

On Fri, 2003-05-30 at 04:04, Timo Sirainen wrote:
> On Fri, 2003-05-30 at 03:33, Andrew Basterfield wrote:
> > function it appears in.) module-dir.c:36: `RTLD_NOW' undeclared (first
> > use in this function)
> 
> Hmph, BSDs. Fixed in 0.99.10-test9.

And there's another one in auth/auth-module.c. test10 out soon..

From charlie@rubberduck.com  Fri May 30 04:28:00 2003
Return-Path: <charlie@rubberduck.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id CECD523866; Fri, 30 May 2003 04:28:00 +0300 (EEST)
Received: from lazy.spodder.com (lazy.spodder.com [203.18.242.30])
	by danu.procontrol.fi (Postfix) with ESMTP id 98D7E23865
	for <dovecot@procontrol.fi>; Fri, 30 May 2003 04:27:55 +0300 (EEST)
Received: by lazy.spodder.com (Postfix, from userid 501)
	id 4596B902E; Fri, 30 May 2003 10:25:37 +1000 (EST)
Date: Fri, 30 May 2003 10:25:37 +1000
From: Charlie Allom <charlie@rubberduck.com>
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] DRAC support?
Message-ID: <20030530002537.GA1552@lazy.spodder.com>
References: <200305142137.11186.jryden@thebox.our-own.net>
	<20030516191335.GA196@dust.uchicago.edu>
	<20030517063125.GA23270@lazy.spodder.com> <1053502215.1214.337.camel@hurina>
	<20030521073959.GD27088@lazy.spodder.com> <1053508449.1218.348.camel@hurina>
	<20030528050825.GA10934@lazy.spodder.com> <1054121419.3131.275.camel@hurina>
	<20030529010911.GA19139@lazy.spodder.com> <1054252379.23632.381.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1054252379.23632.381.camel@hurina>
User-Agent: Mutt/1.5.4i
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 30 May 2003 01:28:01 -0000
X-UID: 869                                                  
Status: O
Content-Length: 1106

On Fri, May 30, 2003 at 02:52:59AM +0300, Timo Sirainen wrote:
> On Thu, 2003-05-29 at 04:09, Charlie Allom wrote:
> > Thanks, but drac.so will not compile with this anymore.
> > 
> > In file included from drac.c:14:
> > /home/yeled/dovecot-0.99.10-test7/src/lib/lib.h:6: ../../config.h: No such file or directory
> 
> That looks again like unconfigured dovecot source tree.

yeah doesn't it. huh.

> > weird? anyway test7 still does not fix these HAVE_MODULES issue.
> 
> Right. I messed that up :) Get test8, that should do it.

You are so close.

May 30 10:20:46 lazy dovecot: Dovecot starting up
May 30 10:20:49 lazy imap-login: Login: pia [203.31.232.2]
May 30 10:20:49 lazy imap(pia):
dlopen(/usr/local/lib/dovecot/imap/drac.so) failed:
/usr/local/lib/dovecot/imap/drac.so: Undefined PLT symbol "dracauth"
(symnum = 28)

That look really weird. Remember instead of -ldrac I used
-I/usr/pkg/lib/libdrac.a

http://rubberduck.com/~yeled/NetBSD/dovecot.ktruss.3.txt

  C.

-- 
 charlie@rubberduck.com - Melbourne, Australia
 http://rubberduck.com/~yeled/
 PGP: 0x14AA7941 || finger yeled@lazy.spodder.com
From tss@iki.fi  Fri May 30 04:43:13 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 35BE723866; Fri, 30 May 2003 04:43:13 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id D08A323865
	for <dovecot@procontrol.fi>; Fri, 30 May 2003 04:43:09 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 9D36D5C896C6; Fri, 30 May 2003 04:43:09 +0300 (EEST)
Subject: Re: [Dovecot] DRAC support?
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030530002537.GA1552@lazy.spodder.com>
References: <200305142137.11186.jryden@thebox.our-own.net>
	 <20030516191335.GA196@dust.uchicago.edu>
	 <20030517063125.GA23270@lazy.spodder.com>
	 <1053502215.1214.337.camel@hurina>
	 <20030521073959.GD27088@lazy.spodder.com>
	 <1053508449.1218.348.camel@hurina>
	 <20030528050825.GA10934@lazy.spodder.com>
	 <1054121419.3131.275.camel@hurina>
	 <20030529010911.GA19139@lazy.spodder.com>
	 <1054252379.23632.381.camel@hurina>
	 <20030530002537.GA1552@lazy.spodder.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1054258989.23632.400.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 30 May 2003 04:43:09 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 30 May 2003 01:43:13 -0000
X-UID: 870                                                  
Status: O

On Fri, 2003-05-30 at 03:25, Charlie Allom wrote:
> dlopen(/usr/local/lib/dovecot/imap/drac.so) failed:
> /usr/local/lib/dovecot/imap/drac.so: Undefined PLT symbol "dracauth"
> (symnum = 28)
> 
> That look really weird. Remember instead of -ldrac I used
> -I/usr/pkg/lib/libdrac.a

-I? not -l? rather just give libdrac.a directly without either one.

But I'm not sure if that works. You may need to extract the libdrac.a
and give the extracted .o files to gcc. Something like:

mkdir dracobj
cd dracobj
ar x /usr/pkg/lib/libdrac.a
cd ..
gcc drac.c ..etc.. dracobj/*.o

From charlie@rubberduck.com  Fri May 30 05:08:18 2003
Return-Path: <charlie@rubberduck.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id C3EDC23866; Fri, 30 May 2003 05:08:18 +0300 (EEST)
Received: from lazy.spodder.com (lazy.spodder.com [203.18.242.30])
	by danu.procontrol.fi (Postfix) with ESMTP id 8C05723865
	for <dovecot@procontrol.fi>; Fri, 30 May 2003 05:08:16 +0300 (EEST)
Received: by lazy.spodder.com (Postfix, from userid 501)
	id 78CCA9011; Fri, 30 May 2003 12:08:05 +1000 (EST)
Date: Fri, 30 May 2003 12:08:05 +1000
From: Charlie Allom <charlie@rubberduck.com>
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] DRAC support?
Message-ID: <20030530020518.GG1552@lazy.spodder.com>
References: <20030517063125.GA23270@lazy.spodder.com>
	<1053502215.1214.337.camel@hurina> <20030521073959.GD27088@lazy.spodder.com>
	<1053508449.1218.348.camel@hurina> <20030528050825.GA10934@lazy.spodder.com>
	<1054121419.3131.275.camel@hurina> <20030529010911.GA19139@lazy.spodder.com>
	<1054252379.23632.381.camel@hurina> <20030530002537.GA1552@lazy.spodder.com>
	<1054258989.23632.400.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1054258989.23632.400.camel@hurina>
User-Agent: Mutt/1.5.4i
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 30 May 2003 02:08:18 -0000
X-UID: 871                                                  
Status: O
Content-Length: 1387

On Fri, May 30, 2003 at 04:43:09AM +0300, Timo Sirainen wrote:
> On Fri, 2003-05-30 at 03:25, Charlie Allom wrote:
> > dlopen(/usr/local/lib/dovecot/imap/drac.so) failed:
> > /usr/local/lib/dovecot/imap/drac.so: Undefined PLT symbol "dracauth"
> > (symnum = 28)
> > 
> > That look really weird. Remember instead of -ldrac I used
> > -I/usr/pkg/lib/libdrac.a
> 
> -I? not -l? rather just give libdrac.a directly without either one.
> 
> But I'm not sure if that works. You may need to extract the libdrac.a
> and give the extracted .o files to gcc. Something like:
> 
> mkdir dracobj
> cd dracobj
> ar x /usr/pkg/lib/libdrac.a
> cd ..
> gcc drac.c ..etc.. dracobj/*.o
> 

It works! I admire your stamina.

May 30 12:02:15 lazy pop3-login: Login: pia [66.93.191.111]

*** authlog ***
May 30 12:02:15 lazy rpcbind: connect from ::1 to getport/addr(900101)
May 30 12:02:15 lazy rpcbind: connect from 127.0.0.1 to
getport/addr(900101)

12:02 yeled@lazy:~$ db btree /usr/pkg/etc/dracd.db
203.31.232.2    1054261313
66.93.191.111   1054261335

I did exactly what you said above with test9.

Thanks Timo. Is it possible to get it to do this without using 'ar' ?
I will work on this being incorporated into NetBSD pkgsrc as soon as I
can make it a clean cut.

  C.
-- 
 charlie@rubberduck.com - Melbourne, Australia
 http://rubberduck.com/~yeled/
 PGP: 0x14AA7941 || finger yeled@lazy.spodder.com
From tss@iki.fi  Fri May 30 05:13:01 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id E5E9623866; Fri, 30 May 2003 05:13:01 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 658EB23865
	for <dovecot@procontrol.fi>; Fri, 30 May 2003 05:12:59 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 33ADD5C896C6; Fri, 30 May 2003 05:12:59 +0300 (EEST)
Subject: Re: [Dovecot] Speed and memory probs writing large Maildir
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <3ED4469E.8040207@firstpr.com.au>
References: <3ED4469E.8040207@firstpr.com.au>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1054260778.19156.408.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 30 May 2003 05:12:59 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 30 May 2003 02:13:02 -0000
X-UID: 872                                                  
Status: O

On Wed, 2003-05-28 at 08:18, Robin Whittle wrote:

> When writing 2000 x 1k messages, it is totally different.  Here are some
> times for writing from a Netscape 4.77 local mailbox to Dovecot and to
> Courier IMAP.

Want to try this with 0.99.10-test11? :) It now keeps the index file
opened for 10 seconds before really closing it, that should help with
the speed quite a lot. I just tested copying 4000 messages myself, I
didn't notice any actual increase in speed, but CPU usage dropped from a
few percent to 0.4%.

It still does a few unnecessary things every time mailbox is opened (ie.
at every APPEND command). I think I shouldn't try to mkdir() the cur,
new and tmp dirs immediately. Those could be more easily created if/when
stat() fails while syncing.

From tss@iki.fi  Fri May 30 05:17:56 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id DD9E023866; Fri, 30 May 2003 05:17:56 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 16B1023865
	for <dovecot@procontrol.fi>; Fri, 30 May 2003 05:17:55 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 3162C5C896C6; Fri, 30 May 2003 05:17:54 +0300 (EEST)
Subject: Re: [Dovecot] DRAC support?
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030530020518.GG1552@lazy.spodder.com>
References: <20030517063125.GA23270@lazy.spodder.com>
	 <1053502215.1214.337.camel@hurina>
	 <20030521073959.GD27088@lazy.spodder.com>
	 <1053508449.1218.348.camel@hurina>
	 <20030528050825.GA10934@lazy.spodder.com>
	 <1054121419.3131.275.camel@hurina>
	 <20030529010911.GA19139@lazy.spodder.com>
	 <1054252379.23632.381.camel@hurina>
	 <20030530002537.GA1552@lazy.spodder.com>
	 <1054258989.23632.400.camel@hurina>
	 <20030530020518.GG1552@lazy.spodder.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1054261073.19156.413.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 30 May 2003 05:17:54 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 30 May 2003 02:17:57 -0000
X-UID: 873                                                  
Status: O

On Fri, 2003-05-30 at 05:08, Charlie Allom wrote:
> It works! I admire your stamina.

Finally :)

> Thanks Timo. Is it possible to get it to do this without using 'ar' ?

Well, did you try just giving the /usr/pkg/lib/libdrac.a to gcc? :) I
remember there was some problems before with trying to give .a library
to libtool, but looks like my gcc handles that just fine at least now.

From bob@cemetery.homeunix.org  Fri May 30 05:28:22 2003
Return-Path: <bob@cemetery.homeunix.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id C173A23866; Fri, 30 May 2003 05:28:22 +0300 (EEST)
Received: from cemetery.homeunix.org (joeldriver.plus.com [212.159.87.165])
	by danu.procontrol.fi (Postfix) with ESMTP id B7CB923845
	for <dovecot@procontrol.fi>; Fri, 30 May 2003 05:28:16 +0300 (EEST)
Received: from snot (snot.flatnet [192.168.0.8])
	by cemetery.homeunix.org (8.12.9/8.12.6) with SMTP id h4U2Rkg6025347
	for <dovecot@procontrol.fi>; Fri, 30 May 2003 03:27:46 +0100 (BST)
Date: Fri, 30 May 2003 03:27:42 +0100
From: Andrew Basterfield <bob@cemetery.homeunix.org>
To: dovecot@procontrol.fi
Message-Id: <20030530032742.08e28964.bob@cemetery.homeunix.org>
X-Mailer: Sylpheed version 0.8.11claws (GTK+ 1.2.10; i586-pc-linux-gnu)
Mime-Version: 1.0
Content-Type: multipart/signed; protocol="application/pgp-signature";
 micalg="pgp-sha1"; boundary="=.Rjwv2s5T+KCBWF"
Subject: [Dovecot] dovecot 0.99.10-test10
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 30 May 2003 02:28:22 -0000
X-UID: 874                                                  
Status: O

--=.Rjwv2s5T+KCBWF
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit


Hiya

builds fine on BSD now (thanks)

Now I am getting index corruption again

May 30 03:11:53 snigger imap(bob): Corrupted binary tree file
/home/bob/Mail/.INBOX/.imap.index.tree: UID to be inserted isn't higher
than existing (1 <= 1)

and so on until the client hangs

test7 is stable here.

Also what are the correct permissions for /var/run/dovecot/login? I get
a message about correcting the permissions every time I start dovecot

--Andrew

-- 
http://cemetery.homeunix.org

--=.Rjwv2s5T+KCBWF
Content-Type: application/pgp-signature

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.1 (GNU/Linux)

iD8DBQE+1sGij3ZMDwYLJGARAhtBAJ9UvPDNRW/Vc1Z65iCMIOcwNMOxRgCfZOSe
o/ZOiqsIPsFsazrhdlFNcOo=
=nQXR
-----END PGP SIGNATURE-----

--=.Rjwv2s5T+KCBWF--
From rspier@pobox.com  Fri May 30 07:07:55 2003
Return-Path: <rspier@pobox.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 2143323866; Fri, 30 May 2003 07:07:55 +0300 (EEST)
Received: from pimout1-ext.prodigy.net (pimout1-ext.prodigy.net
	[207.115.63.77])
	by danu.procontrol.fi (Postfix) with ESMTP id 22DCD23865
	for <dovecot@procontrol.fi>; Fri, 30 May 2003 07:07:52 +0300 (EEST)
Received: from localhost.localdomain
	(adsl-64-161-172-111.dsl.lsan03.pacbell.net [64.161.172.111])
	h4U47nPg150296
	for <dovecot@procontrol.fi>; Fri, 30 May 2003 00:07:50 -0400
Received: from bear.rls.cx (bear [127.0.0.1])
	by localhost.localdomain (8.12.8/8.12.8) with ESMTP id h4U47lKf003668
	for <dovecot@procontrol.fi>; Thu, 29 May 2003 21:07:47 -0700
Date: Thu, 29 May 2003 21:07:47 -0700
Message-ID: <m3wug99iwc.wl_rspier@pobox.com>
From: Robert Spier <rspier@pobox.com>
To: Dovecot List <dovecot@procontrol.fi>
Subject: Re: [Dovecot] the most serius problems [part 3]
In-Reply-To: <1054252465.23632.383.camel@hurina>
References: <3ED53F8B.6080200@bnap.hu>
	<1054252465.23632.383.camel@hurina>
User-Agent: Wanderlust/2.10.0 (Venus) XEmacs/21.4 (Rational FORTRAN)
MIME-Version: 1.0 (generated by SEMI 1.14.5 - "Awara-Onsen")
Content-Type: text/plain; charset=US-ASCII
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 30 May 2003 04:07:55 -0000
X-UID: 875                                                  
Status: O


> BTW. OpenSSL problems can be fixed by using GNUTLS instead. I'll try to
> figure out the openssl some day though.

Or, if you don't need STARTTLS, you can use stunnel.

-R
From charlie@rubberduck.com  Fri May 30 07:11:33 2003
Return-Path: <charlie@rubberduck.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 3C6FE23866; Fri, 30 May 2003 07:11:33 +0300 (EEST)
Received: from lazy.spodder.com (lazy.spodder.com [203.18.242.30])
	by danu.procontrol.fi (Postfix) with ESMTP id 5EC4623865
	for <dovecot@procontrol.fi>; Fri, 30 May 2003 07:11:29 +0300 (EEST)
Received: by lazy.spodder.com (Postfix, from userid 501)
	id 9B2C98F0B; Fri, 30 May 2003 14:11:18 +1000 (EST)
Date: Fri, 30 May 2003 14:11:18 +1000
From: Charlie Allom <charlie@rubberduck.com>
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] DRAC support?
Message-ID: <20030530041118.GK1552@lazy.spodder.com>
References: <20030521073959.GD27088@lazy.spodder.com>
	<1053508449.1218.348.camel@hurina> <20030528050825.GA10934@lazy.spodder.com>
	<1054121419.3131.275.camel@hurina> <20030529010911.GA19139@lazy.spodder.com>
	<1054252379.23632.381.camel@hurina> <20030530002537.GA1552@lazy.spodder.com>
	<1054258989.23632.400.camel@hurina> <20030530020518.GG1552@lazy.spodder.com>
	<1054261073.19156.413.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1054261073.19156.413.camel@hurina>
User-Agent: Mutt/1.5.4i
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 30 May 2003 04:11:33 -0000
X-UID: 876                                                  
Status: O

On Fri, May 30, 2003 at 05:17:54AM +0300, Timo Sirainen wrote:
> On Fri, 2003-05-30 at 05:08, Charlie Allom wrote:
> > It works! I admire your stamina.
> 
> Finally :)
> 
> > Thanks Timo. Is it possible to get it to do this without using 'ar' ?
> 
> Well, did you try just giving the /usr/pkg/lib/libdrac.a to gcc? :) I
> remember there was some problems before with trying to give .a library
> to libtool, but looks like my gcc handles that just fine at least now.
> 

You're right.

gcc picks it up fine. I will submit this to pkgsrc once you give out
the next release .. as I have a feelign it is soon ?

Will you include drac.c ?

  C.
-- 
 charlie@rubberduck.com - Melbourne, Australia
 http://rubberduck.com/~yeled/
 PGP: 0x14AA7941 || finger yeled@lazy.spodder.com
From tss@iki.fi  Fri May 30 13:24:53 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 6D4D023866; Fri, 30 May 2003 13:24:53 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id B165423845
	for <dovecot@procontrol.fi>; Fri, 30 May 2003 13:24:51 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 6FD1E5C896C6; Fri, 30 May 2003 13:24:51 +0300 (EEST)
Subject: Re: [Dovecot] dovecot 0.99.10-test10
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030530032742.08e28964.bob@cemetery.homeunix.org>
References: <20030530032742.08e28964.bob@cemetery.homeunix.org>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1054290290.19156.426.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 30 May 2003 13:24:51 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 30 May 2003 10:24:53 -0000
X-UID: 877                                                  
Status: O

On Fri, 2003-05-30 at 05:27, Andrew Basterfield wrote:
> Now I am getting index corruption again
> 
> May 30 03:11:53 snigger imap(bob): Corrupted binary tree file
> /home/bob/Mail/.INBOX/.imap.index.tree: UID to be inserted isn't higher
> than existing (1 <= 1)

Weird. Is this easily reproduceable? I tried for a while with my OpenBSD
3.3/x86, worked fine. Also I can't really even think of when the above
error could happen unless something was totally messed up.

> Also what are the correct permissions for /var/run/dovecot/login? I get
> a message about correcting the permissions every time I start dovecot

0750 mode, owned by root (or it uses geteuid() actually), group for
login_user's primary group.

From lfarkas@bnap.hu  Fri May 30 13:28:02 2003
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 3404E23866; Fri, 30 May 2003 13:28:02 +0300 (EEST)
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 8A8AF23845
	for <dovecot@procontrol.fi>; Fri, 30 May 2003 13:27:59 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id 5ED8F754031
	for <dovecot@procontrol.fi>; Fri, 30 May 2003 12:27:15 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id 4E88C3EB8
	for <dovecot@procontrol.fi>; Fri, 30 May 2003 12:27:57 +0200 (CEST)
Received: from bnap.hu (garfield.int.bppiac.hu [192.168.0.50])
	by mail2.bppiac.hu (Postfix) with ESMTP id 33E083EB7
	for <dovecot@procontrol.fi>; Fri, 30 May 2003 12:27:57 +0200 (CEST)
Message-ID: <3ED7322D.2090206@bnap.hu>
Date: Fri, 30 May 2003 12:27:57 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: Re: [Dovecot] the most serius problems [part 1]
References: <3ED4A199.9090501@bnap.hu> <1054123303.3131.292.camel@hurina>
	<3ED529BC.1040904@bnap.hu> <1054252304.19156.379.camel@hurina>
In-Reply-To: <1054252304.19156.379.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 30 May 2003 10:28:02 -0000
X-UID: 878                                                  
Status: O

Timo Sirainen wrote:
> On Thu, 2003-05-29 at 00:27, Farkas Levente wrote:
> 
>> > You could kludge Dovecot to use INBOX. prefix, or Courier to not use it,
>> > but there's no pretty way to do it really.
>> >
>>
>>how can I do that?
>>do you mean there is a way to configure courier not to use INBOX as a 
>>prefix?
> 
> 
> No, I mean you can do it by messing enough with the sources. Hmm. I
> don't think it would be too difficult. OK, here's patch against 1.7.0. I
> tested a few commands manually and they seemed to work, but maybe I
> missed something.

thanks!!!

> If you plan on switching between Courier <-> Dovecot, you should keep
> courierimapuiddb and dovecot-uidlist files synchronized or clients will
> download the whole mailbox again every time you do the switch. Easiest

that's not a problem since I won't like to switch to often and it's 
automatic.


-- 
   Levente                               "Si vis pacem para bellum!"


From lfarkas@bnap.hu  Fri May 30 14:39:12 2003
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 4156623866; Fri, 30 May 2003 14:39:12 +0300 (EEST)
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 8195523865
	for <dovecot@procontrol.fi>; Fri, 30 May 2003 14:39:08 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id DE443754030
	for <dovecot@procontrol.fi>; Fri, 30 May 2003 13:38:22 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id 883633EB7
	for <dovecot@procontrol.fi>; Fri, 30 May 2003 13:39:05 +0200 (CEST)
Received: from bnap.hu (garfield.int.bppiac.hu [192.168.0.50])
	by mail2.bppiac.hu (Postfix) with ESMTP id 70DD53EB1
	for <dovecot@procontrol.fi>; Fri, 30 May 2003 13:39:05 +0200 (CEST)
Message-ID: <3ED742D9.30705@bnap.hu>
Date: Fri, 30 May 2003 13:39:05 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) Gecko/20030225
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: Re: [Dovecot] the most serius problems [part 2]
References: <3ED53F08.3000709@bnap.hu> <1054252967.19156.389.camel@hurina>
In-Reply-To: <1054252967.19156.389.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 30 May 2003 11:39:12 -0000
X-UID: 879                                                  
Status: O

Timo Sirainen wrote:
> On Thu, 2003-05-29 at 01:58, Farkas Levente wrote:
> 
>>hi,
>>the second thing is the webmail. we use squirrelmail. actualy I don't 
>>know whose fault is, but they told that them imap server's:-)
>>first problems is that those mails which has empty body (even if they 
>>has an attachments) simple not shown in the mail list (as they even not 
>>exists). it'd be nice to check this and find the reason of the problem. 
>>this happend with more people.
> 
> 
> What squirrelmail version? Can you send one such mail?
> 
> I tested with 1.4.0 RC1 (or 1:1.3.2+1.4.0rc1-1 in Debian) and it seemed
> to work just fine.

I send you the mailbox as I used to do...

-- 
   Levente                               "Si vis pacem para bellum!"


From tss@iki.fi  Fri May 30 14:59:07 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 0D52E23866; Fri, 30 May 2003 14:59:07 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 1C35923865
	for <dovecot@procontrol.fi>; Fri, 30 May 2003 14:59:02 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id E0EA35C896C6; Fri, 30 May 2003 14:59:01 +0300 (EEST)
Subject: Re: [Dovecot] DRAC support?
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030530041118.GK1552@lazy.spodder.com>
References: <20030521073959.GD27088@lazy.spodder.com>
	 <1053508449.1218.348.camel@hurina>
	 <20030528050825.GA10934@lazy.spodder.com>
	 <1054121419.3131.275.camel@hurina>
	 <20030529010911.GA19139@lazy.spodder.com>
	 <1054252379.23632.381.camel@hurina>
	 <20030530002537.GA1552@lazy.spodder.com>
	 <1054258989.23632.400.camel@hurina>
	 <20030530020518.GG1552@lazy.spodder.com>
	 <1054261073.19156.413.camel@hurina>
	 <20030530041118.GK1552@lazy.spodder.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1054295941.23632.447.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 30 May 2003 14:59:01 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 30 May 2003 11:59:07 -0000
X-UID: 880                                                  
Status: O

On Fri, 2003-05-30 at 07:11, Charlie Allom wrote:
> gcc picks it up fine. I will submit this to pkgsrc once you give out
> the next release .. as I have a feelign it is soon ?

Depends, it'll come when people stop having problems with it :)

> Will you include drac.c ?

No. I'll leave it to patches directory.

From dgc@uchicago.edu  Fri May 30 17:32:10 2003
Return-Path: <dgc@uchicago.edu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 7B16C23866; Fri, 30 May 2003 17:32:10 +0300 (EEST)
Received: from dust.uchicago.edu (dust.uchicago.edu [128.135.0.35])
	by danu.procontrol.fi (Postfix) with ESMTP id D5CB023845
	for <dovecot@procontrol.fi>; Fri, 30 May 2003 17:32:05 +0300 (EEST)
Received: (from dgc@localhost)
	by dust.uchicago.edu (8.11.6/8.11.6) id h4UEW1i11660;
	Fri, 30 May 2003 09:32:01 -0500 (CDT)
X-Authentication-Warning: dust.uchicago.edu: dgc set sender to
	dgc@uchicago.edu using -f
Date: Fri, 30 May 2003 09:32:01 -0500
From: David Champion <dgc@uchicago.edu>
To: Timo Sirainen <tss@iki.fi>
Message-ID: <20030530143201.GZ676@dust.uchicago.edu>
Mail-Followup-To: Timo Sirainen <tss@iki.fi>, dovecot@procontrol.fi
References: <20030528050825.GA10934@lazy.spodder.com>
	<1054121419.3131.275.camel@hurina> <20030529010911.GA19139@lazy.spodder.com>
	<1054252379.23632.381.camel@hurina> <20030530002537.GA1552@lazy.spodder.com>
	<1054258989.23632.400.camel@hurina> <20030530020518.GG1552@lazy.spodder.com>
	<1054261073.19156.413.camel@hurina> <20030530041118.GK1552@lazy.spodder.com>
	<1054295941.23632.447.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1054295941.23632.447.camel@hurina>
User-Agent: Mutt/1.5.2i
cc: dovecot@procontrol.fi
Subject: [Dovecot] Re: DRAC support?
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 30 May 2003 14:32:10 -0000
X-UID: 881                                                  
Status: O

* On 2003.05.30, in <1054295941.23632.447.camel@hurina>,
*	"Timo Sirainen" <tss@iki.fi> wrote:
> 
> > Will you include drac.c ?
> 
> No. I'll leave it to patches directory.

./configure --enable-drac ?

Shouldn't add any extra weight to the --disable-drac build.

-- 
 -D.    dgc@uchicago.edu        NSIT    University of Chicago
      When using any driving directions or map, it's a good idea to do a
      reality check and make sure the road still exists, watch out for
      construction, and follow all traffic safety precautions.
From charlieb-dovecot@e-smith.com  Fri May 30 23:23:32 2003
Return-Path: <charlieb-dovecot@e-smith.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 662FA23866; Fri, 30 May 2003 23:23:32 +0300 (EEST)
Received: from nssg.mitel.com (mail.e-smith.com [216.191.234.126])
	by danu.procontrol.fi (Postfix) with SMTP id 2C4B923845
	for <dovecot@procontrol.fi>; Fri, 30 May 2003 23:23:30 +0300 (EEST)
Received: (qmail 22029 invoked by uid 404); 30 May 2003 20:23:28 -0000
Received: from charlieb-dovecot@e-smith.com by tripe.nssg.mitel.com with
	qmail-scanner; 30 May 2003 16:23:27 -0000
Received: from allspice-core.nssg.mitel.com (HELO e-smith.com) (10.33.16.12)
  by tripe.nssg.mitel.com (10.33.17.11) with SMTP; 30 May 2003 20:23:25 -0000
Received: (qmail 29153 invoked from network); 30 May 2003 20:22:50 -0000
Received: from unknown (10.35.25.57)
  by allspice.nssg.mitel.com with QMQP; 30 May 2003 20:22:50 -0000
Received: from localhost (sendmail-bs@127.0.0.1)
  by localhost with SMTP; 30 May 2003 20:29:43 -0000
Date: Fri, 30 May 2003 16:29:43 -0400 (EDT)
From: Charlie Brady <charlieb-dovecot@e-smith.com>
X-X-Sender: charlieb@vegemite.nssg.mitel.com
To: Timo Sirainen <tss@iki.fi>
Subject: mkdir {cur,tmp,new}? (was Re: [Dovecot] Speed and memory probs
 writing large Maildir)
In-Reply-To: <1054260778.19156.408.camel@hurina>
Message-ID: <Pine.LNX.4.44.0305301623260.7269-100000@vegemite.nssg.mitel.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 30 May 2003 20:23:32 -0000
X-UID: 882                                                  
Status: O


On 30 May 2003, Timo Sirainen wrote:

> It still does a few unnecessary things every time mailbox is opened (ie.
> at every APPEND command). I think I shouldn't try to mkdir() the cur,
> new and tmp dirs immediately. Those could be more easily created if/when
> stat() fails while syncing.

Shouldn't the maildir only be created in response to a CREATE command. It 
certainly shouldn't be as the result of an APPEND:

   If the destination mailbox does not exist, a server MUST return an
   error, and MUST NOT automatically create the mailbox. 

I would interpret any of cur, new and tmp being missing as "mailbox does 
not exist".

--
Charlie Brady                         charlie_brady@mitel.com

From charlieb-dovecot@e-smith.com  Fri May 30 23:29:20 2003
Return-Path: <charlieb-dovecot@e-smith.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id A9C9823866; Fri, 30 May 2003 23:29:20 +0300 (EEST)
Received: from nssg.mitel.com (mail.e-smith.com [216.191.234.126])
	by danu.procontrol.fi (Postfix) with SMTP id A20E723845
	for <dovecot@procontrol.fi>; Fri, 30 May 2003 23:29:17 +0300 (EEST)
Received: (qmail 25569 invoked by uid 404); 30 May 2003 20:29:16 -0000
Received: from charlieb-dovecot@e-smith.com by tripe.nssg.mitel.com with
	qmail-scanner; 30 May 2003 16:29:16 -0000
Received: from allspice-core.nssg.mitel.com (HELO e-smith.com) (10.33.16.12)
  by tripe.nssg.mitel.com (10.33.17.11) with SMTP; 30 May 2003 20:29:16 -0000
Received: (qmail 31532 invoked from network); 30 May 2003 20:29:14 -0000
Received: from unknown (10.35.25.57)
  by allspice.nssg.mitel.com with QMQP; 30 May 2003 20:29:14 -0000
Received: from localhost (sendmail-bs@127.0.0.1)
  by localhost with SMTP; 30 May 2003 20:36:07 -0000
Date: Fri, 30 May 2003 16:36:07 -0400 (EDT)
From: Charlie Brady <charlieb-dovecot@e-smith.com>
X-X-Sender: charlieb@vegemite.nssg.mitel.com
To: Robert Spier <rspier@pobox.com>
Subject: Re: [Dovecot] the most serius problems [part 3]
In-Reply-To: <m3wug99iwc.wl_rspier@pobox.com>
Message-ID: <Pine.LNX.4.44.0305301631020.7269-100000@vegemite.nssg.mitel.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
cc: Dovecot List <dovecot@procontrol.fi>
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 30 May 2003 20:29:20 -0000
X-UID: 883                                                  
Status: O
Content-Length: 1292


On Thu, 29 May 2003, Robert Spier wrote:

> > BTW. OpenSSL problems can be fixed by using GNUTLS instead. I'll try to
> > figure out the openssl some day though.
> 
> Or, if you don't need STARTTLS, you can use stunnel.

Even if you do need STARTTLS, you can still use stunnel, albiet a slightly
modified one. Scott Gifford wrote the patches, which can be found here:

http://www.suspectclass.com/~sgifford/stunnel-tlsproxy/stunnel-tlsproxy.html

Here's my supervise run script:

#!/bin/sh

eval $(/usr/local/bin/envdir ./runenv /usr/bin/env)

exec 2>&1
# Ensure that PRNG is adequately seeded.
[ -s ./ssl/seed ] ||\
  /usr/local/bin/envuidgid stunnel \
    /bin/dd if=/dev/urandom of=./ssl/seed bs=1k count=1
exec \
  softlimit -m "${ulimitdata:-20000000}" \
    tcpserver -d \
      -H \
      -R \
      -v \
      -X \
      -c "${concurrency:-20}" \
      -x imap.tcprules.cdb \
      0 imap \
	makesock \
	  stunnel \
	    -/ ssl \
	    -s "$SSLUID" \
	    -g "$SSLGID" \
	    -N imap \
	    -i \
	    -R seed \
	    -p imapd.pem \
	    -n imap- \
	    -f \
	    -F 3 \
	    -makesock_connect_to \
	      /usr/local/bin/envdir ./imapfront.env \
		/usr/bin/imapfront-auth \
		  "${imapdpath:-/usr/libexec/dovecot/imap}"

--
Charlie Brady                         charlie_brady@mitel.com

From bob@cemetery.homeunix.org  Sat May 31 01:40:15 2003
Return-Path: <bob@cemetery.homeunix.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 76BAB23866; Sat, 31 May 2003 01:40:15 +0300 (EEST)
Received: from cemetery.homeunix.org (joeldriver.plus.com [212.159.87.165])
	by danu.procontrol.fi (Postfix) with ESMTP id 2C82723845
	for <dovecot@procontrol.fi>; Sat, 31 May 2003 01:40:06 +0300 (EEST)
Received: from snot (snot.flatnet [192.168.0.8])
	by cemetery.homeunix.org (8.12.9/8.12.6) with SMTP id h4UMdtg6022288
	for <dovecot@procontrol.fi>; Fri, 30 May 2003 23:39:55 +0100 (BST)
Date: Fri, 30 May 2003 23:39:50 +0100
From: Andrew Basterfield <bob@cemetery.homeunix.org>
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] dovecot 0.99.10-test10
Message-Id: <20030530233950.47c0da7f.bob@cemetery.homeunix.org>
In-Reply-To: <1054290290.19156.426.camel@hurina>
References: <20030530032742.08e28964.bob@cemetery.homeunix.org>
	<1054290290.19156.426.camel@hurina>
X-Mailer: Sylpheed version 0.8.11claws (GTK+ 1.2.10; i586-pc-linux-gnu)
Mime-Version: 1.0
Content-Type: multipart/signed; protocol="application/pgp-signature";
 micalg="pgp-sha1"; boundary="=.SWvsir/1suj24G"
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 30 May 2003 22:40:15 -0000
X-UID: 884                                                  
Status: O
Content-Length: 1354

--=.SWvsir/1suj24G
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

On 30 May 2003 13:24:51 +0300,
Timo Sirainen <tss@iki.fi> wrote:
> On Fri, 2003-05-30 at 05:27, Andrew Basterfield wrote:
> > Now I am getting index corruption again
> > 
> > May 30 03:11:53 snigger imap(bob): Corrupted binary tree file
> > /home/bob/Mail/.INBOX/.imap.index.tree: UID to be inserted isn't
> > higher than existing (1 <= 1)
> 
> Weird. Is this easily reproduceable? I tried for a while with my
> OpenBSD 3.3/x86, worked fine. Also I can't really even think of when
> the above error could happen unless something was totally messed up.

It happens when moving lots of messages between folders. Now I have my
mail where I want it I will set up a test account that isn't critical to
test with.

They copy OK but sylpheed can't delete them afterwards (sylpheed is on
lintel)

I have been using hard-linked move, but the problem still occurs without
it.

test7 DOES exhibit problems but test6 is rock solid and what I am
using now.

--Andrew

-- 
http://cemetery.homeunix.org

--=.SWvsir/1suj24G
Content-Type: application/pgp-signature

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.1 (GNU/Linux)

iD8DBQE+1927j3ZMDwYLJGARAsm+AJsGk6JMV2zi25boetmVnsE3dJeMewCfU4dU
k50RxQbUQneCY0LMH2HDf/w=
=6NR8
-----END PGP SIGNATURE-----

--=.SWvsir/1suj24G--
From bob@cemetery.homeunix.org  Sat May 31 05:30:41 2003
Return-Path: <bob@cemetery.homeunix.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 117E923866; Sat, 31 May 2003 05:30:41 +0300 (EEST)
Received: from cemetery.homeunix.org (joeldriver.plus.com [212.159.87.165])
	by danu.procontrol.fi (Postfix) with ESMTP id 29E7623845
	for <dovecot@procontrol.fi>; Sat, 31 May 2003 05:30:34 +0300 (EEST)
Received: from snigger.flatnet (bob@localhost.flatnet [127.0.0.1])
	by cemetery.homeunix.org (8.12.9/8.12.6) with ESMTP id h4V2URg6012484
	for <dovecot@procontrol.fi>; Sat, 31 May 2003 03:30:27 +0100 (BST)
Received: (from bob@localhost)
	by snigger.flatnet (8.12.9/8.12.6/Submit) id h4V2UPLc015269
	for dovecot@procontrol.fi; Sat, 31 May 2003 03:30:25 +0100 (BST)
Date: Sat, 31 May 2003 03:30:24 +0100
From: Andrew Basterfield <bob@cemetery.homeunix.org>
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] dovecot 0.99.10-test10
Message-ID: <20030531023024.GA26364@snigger.flatnet>
References: <20030530032742.08e28964.bob@cemetery.homeunix.org>
	<1054290290.19156.426.camel@hurina>
	<20030530233950.47c0da7f.bob@cemetery.homeunix.org>
Mime-Version: 1.0
Content-Type: multipart/signed; micalg=pgp-sha1;
	protocol="application/pgp-signature"; boundary="wRRV7LY7NUeQGEoC"
Content-Disposition: inline
In-Reply-To: <20030530233950.47c0da7f.bob@cemetery.homeunix.org>
User-Agent: Mutt/1.4.1i
X-Operating-System: OpenBSD snigger 3.3 sparc64 SUNW,UltraSPARC-IIi @ 269.842
	MHz, version 0 FPU
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Sat, 31 May 2003 02:30:41 -0000
X-UID: 885                                                  
Status: O
Content-Length: 2710


--wRRV7LY7NUeQGEoC
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable

On Fri, May 30, 2003 at 11:39:50PM +0100, Andrew Basterfield wrote:
> On 30 May 2003 13:24:51 +0300,
> Timo Sirainen <tss@iki.fi> wrote:
> > On Fri, 2003-05-30 at 05:27, Andrew Basterfield wrote:
> > > Now I am getting index corruption again
> > >=20
> > > May 30 03:11:53 snigger imap(bob): Corrupted binary tree file
> > > /home/bob/Mail/.INBOX/.imap.index.tree: UID to be inserted isn't
> > > higher than existing (1 <=3D 1)
> >=20
> > Weird. Is this easily reproduceable? I tried for a while with my
> > OpenBSD 3.3/x86, worked fine. Also I can't really even think of when
> > the above error could happen unless something was totally messed up.
>=20
> It happens when moving lots of messages between folders. Now I have my
> mail where I want it I will set up a test account that isn't critical to
> test with.
>=20
> They copy OK but sylpheed can't delete them afterwards (sylpheed is on
> lintel)
>=20
> I have been using hard-linked move, but the problem still occurs without
> it.
>=20
> test7 DOES exhibit problems but test6 is rock solid and what I am
> using now.

I think it is related to locking, I have been moving mail around with one
client and doing normal operations with another.

I tried to move 2700 messages from a folder on one account to another, I
think the problems started when I opened the same folder with another
client.

This occurs once in the maillog

May 31 02:20:39 snigger imap(list): Timeout while waiting for release of ex=
clusive fcntl() lock for index file /home/list/Mail/.INBOX/.imap.index
May 31 02:26:07 snigger imap-login: Login: bob [127.0.0.1] May 31 02:38:13 =
snigger imap(bob): Corrupted index file /home/bob/Mail/.Test/.imap.index: W=
rong messages_count in header (1247 !=3D 1248)

What happens when the lock times out? Does it carry on regardless or die?

sylpheed says:

** WARNING **: Socket IO timeout
** WARNING **: [03:07:13] Read from socket fd14 failed: Broken pipe
** WARNING **: [03:07:13] error while imap command: STORE 1562:1562 +FLAGS =
(\Deleted)
** WARNING **: [03:07:13] can't set deleted flags: 1562

and so on many many times

Now I am playing with a test account I can move mail around without
interference to see what happens.

--=20
If at first you don't succeed, destroy all evidence that you tried.

--wRRV7LY7NUeQGEoC
Content-Type: application/pgp-signature
Content-Disposition: inline

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.1 (OpenBSD)

iD8DBQE+2BO9j3ZMDwYLJGARAgp7AJ47BKKGVcXiQSeW580S9iTevFIRyQCffla9
HFpN4S3vksXQxrhnDgDEzuk=
=jQ1Q
-----END PGP SIGNATURE-----

--wRRV7LY7NUeQGEoC--
From cirvis@konts.lv  Mon Jun  2 17:21:09 2003
Return-Path: <cirvis@konts.lv>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 8162223866; Mon,  2 Jun 2003 17:21:09 +0300 (EEST)
Received: from card.konts.lv (card.konts.lv [159.148.139.17])
	by danu.procontrol.fi (Postfix) with ESMTP id 2ACF72384C
	for <dovecot@procontrol.fi>; Mon,  2 Jun 2003 17:21:05 +0300 (EEST)
Received: (from daemon@localhost)
	by card.konts.lv (8.11.6/8.11.6) id h52EJMm19899
	for <dovecot@procontrol.fi>; Mon, 2 Jun 2003 17:19:22 +0300
Received: from <cirvis@konts.lv> (mail1.konts.lv [10.10.1.4]) by card.konts.lv
	via smap (V2.1)	id xma019884; Mon, 2 Jun 03 17:19:16 +0300
Received: (qmail 4367 invoked from network); 2 Jun 2003 14:20:06 -0000
Received: from  (HELO konts.lv) ([]) (envelope-sender <cirvis@konts.lv>)
          by mail1.konts.lv (qmail-ldap-1.03) with SMTP
          for <dovecot@procontrol.fi>; 2 Jun 2003 14:20:06 -0000
Message-ID: <3EDB5D17.1050902@konts.lv>
Date: Mon, 02 Jun 2003 17:20:07 +0300
From: Gasha <cirvis@konts.lv>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US;
	rv:0.9.4.1) Gecko/20020508 Netscape6/6.2.3
X-Accept-Language: en-us
MIME-Version: 1.0
To: dovecot@procontrol.fi
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-Spam-Status: No, hits=-13.4 required=6.0
	tests=AWL,USER_AGENT_MOZILLA_UA
	autolearn=ham version=2.52
X-Spam-Level: 
X-Spam-Checker-Version: SpamAssassin 2.52 (1.174.2.8-2003-03-24-exp)
Subject: [Dovecot] squirrelmail setup
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 02 Jun 2003 14:21:09 -0000
X-UID: 886                                                  
Status: O

Hi all,

My setup:
INBOX -> /var/spool/mail/user
directories -> /home/user/Maildir

it works with Netscape, but squirrel mail shows only subfolder content.
nothing in INBOX.

any ideas?

Gasha

From mike@skew.org  Mon Jun  2 17:53:11 2003
Return-Path: <mike@skew.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 3CE6F23866; Mon,  2 Jun 2003 17:53:11 +0300 (EEST)
Received: from chilled.skew.org (skew.org [65.101.207.237])
	by danu.procontrol.fi (Postfix) with ESMTP id 5F3E12384C
	for <dovecot@procontrol.fi>; Mon,  2 Jun 2003 17:53:08 +0300 (EEST)
Received: from chilled.skew.org (localhost.skew.org [127.0.0.1])
	by chilled.skew.org (8.12.6p2/8.12.7) with ESMTP id h52Er5CZ078639;
	Mon, 2 Jun 2003 08:53:05 -0600 (MDT)
	(envelope-from mike@chilled.skew.org)
Received: (from mike@localhost)
	by chilled.skew.org (8.12.6p2/8.12.7/Submit) id h52Er45e078638;
	Mon, 2 Jun 2003 08:53:04 -0600 (MDT)
From: Mike Brown <mike@skew.org>
Message-Id: <200306021453.h52Er45e078638@chilled.skew.org>
Subject: Re: [Dovecot] DRAC support?
In-Reply-To: <1054121419.3131.275.camel@hurina> "from Timo Sirainen at May 28,
 2003 02:30:19 pm"
To: Timo Sirainen <tss@iki.fi>
Date: Mon, 2 Jun 2003 08:53:04 -0600 (MDT)
X-Whoa: whoa.
X-Mailer: ELM [version 2.4ME+ PL90 (25)]
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Content-Type: text/plain; charset=US-ASCII
X-Spam-Status: No, hits=-0.8 required=5.0
	tests=IN_REP_TO,QUOTED_EMAIL_TEXT,SPAM_PHRASE_00_01
	version=2.43
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 02 Jun 2003 14:53:11 -0000
X-UID: 887                                                  
Status: O

Timo Sirainen wrote:
> Looks like BSDs don't have libdl which is why configure's test fails.

Correct. On FreeBSD, many administrators install the linux compatibility
package, which results in libdl binaries being available under
/usr/compat/linux/lib. I am guessing these should be usable as long as the
system administrator has configured the kernel with linux support.

However, when building new software, one generally doesn't try pointing into
/usr/compat/linux/* unless it's absolutely necessary. It's probably safest to
just steer clear of the dependency.
From cirvis@konts.lv  Mon Jun  2 20:41:39 2003
Return-Path: <cirvis@konts.lv>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 0C03823866; Mon,  2 Jun 2003 20:41:39 +0300 (EEST)
Received: from card.konts.lv (card.konts.lv [159.148.139.17])
	by danu.procontrol.fi (Postfix) with ESMTP id 90AC123865
	for <dovecot@procontrol.fi>; Mon,  2 Jun 2003 20:41:33 +0300 (EEST)
Received: (from daemon@localhost)
	by card.konts.lv (8.11.6/8.11.6) id h52Hdms26933
	for <dovecot@procontrol.fi>; Mon, 2 Jun 2003 20:39:48 +0300
Received: from <cirvis@konts.lv> (mail1.konts.lv [10.10.1.4]) by card.konts.lv
	via smap (V2.1)	id xma026926; Mon, 2 Jun 03 20:39:40 +0300
Received: (qmail 18329 invoked from network); 2 Jun 2003 17:40:31 -0000
Received: from  (HELO konts.lv) ([]) (envelope-sender <cirvis@konts.lv>)
          by mail1.konts.lv (qmail-ldap-1.03) with SMTP
          for <dovecot@procontrol.fi>; 2 Jun 2003 17:40:31 -0000
Message-ID: <3EDB8C10.8010904@konts.lv>
Date: Mon, 02 Jun 2003 20:40:32 +0300
From: Gasha <cirvis@konts.lv>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US;
	rv:0.9.4.1) Gecko/20020508 Netscape6/6.2.3
X-Accept-Language: en-us
MIME-Version: 1.0
To: dovecot@procontrol.fi
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-Spam-Status: No, hits=-14.9 required=6.0
	tests=AWL,BAYES_20,USER_AGENT_MOZILLA_UA
	autolearn=ham version=2.52
X-Spam-Level: 
X-Spam-Checker-Version: SpamAssassin 2.52 (1.174.2.8-2003-03-24-exp)
Subject: [Dovecot] --enable-debug bug?
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 02 Jun 2003 17:41:39 -0000
X-UID: 888                                                  
Status: O

Hello all,

when i'm bulding rpm with --enable-debug get this:

I tried 2 different versions 0.99.8 and 0.99.9.


Jun  2 20:41:14 mezgls dovecot: Dovecot starting up
Jun  2 20:41:15 mezgls dovecot: child 9409 (login) killed with signal 11
Jun  2 20:41:15 mezgls dovecot: child 9408 (login) killed with signal 11
Jun  2 20:41:15 mezgls dovecot: child 9407 (login) killed with signal 11
Jun  2 20:41:15 mezgls dovecot: child 9406 (auth) killed with signal 11
Jun  2 20:41:15 mezgls dovecot: Login process died too early - shutting down

Gasha

From lfarkas@bnap.hu  Tue Jun  3 10:44:06 2003
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 60DE223866; Tue,  3 Jun 2003 10:44:06 +0300 (EEST)
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 9935F23865
	for <dovecot@procontrol.fi>; Tue,  3 Jun 2003 10:44:03 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id E9C5075400C
	for <dovecot@procontrol.fi>; Tue,  3 Jun 2003 09:43:06 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP id 90DDD3EB0
	for <dovecot@procontrol.fi>; Tue,  3 Jun 2003 09:44:00 +0200 (CEST)
Received: from bnap.hu (garfield.int.bppiac.hu [192.168.0.50])
	by mail2.bppiac.hu (Postfix) with ESMTP id 77FFD3EAD
	for <dovecot@procontrol.fi>; Tue,  3 Jun 2003 09:44:00 +0200 (CEST)
Message-ID: <3EDC51BD.1010700@bnap.hu>
Date: Tue, 03 Jun 2003 09:43:57 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.3) Gecko/20030313
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
Subject: [Dovecot] error
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Tue, 03 Jun 2003 07:44:06 -0000
X-UID: 889                                                  
Status: O

hi,
I've got the following alert window in mozilla (with dovecot):
---------------------------------------
The current command did not succeed. The mail server responded: Error in 
IMAP command: Too long argument..
---------------------------------------
although there is not any messages in my imap.log file.

-- 
   Levente                               "Si vis pacem para bellum!"


From jens.laas@data.slu.se  Tue Jun  3 11:14:29 2003
Return-Path: <jens.laas@data.slu.se>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id C54F823866; Tue,  3 Jun 2003 11:14:29 +0300 (EEST)
Received: from mail1.slu.se (mail1.slu.se [130.238.96.11])
	by danu.procontrol.fi (Postfix) with ESMTP id 5034623865
	for <dovecot@procontrol.fi>; Tue,  3 Jun 2003 11:14:23 +0300 (EEST)
Received: from jlaas2.data.slu.se (jlaas2.data.slu.se [130.238.98.68])
	by mail1.slu.se (8.9.3p2/8.9.3) with ESMTP id KAA11894
	for <dovecot@procontrol.fi>; Tue, 3 Jun 2003 10:14:19 +0200
Date: Tue, 3 Jun 2003 10:14:22 +0200 (CEST)
From: Jens Laas <jens.laas@data.slu.se>
X-X-Sender: jensl@jlaas2.data.slu.se
To: Dovecot List <dovecot@procontrol.fi>
In-Reply-To: <3EDC51BD.1010700@bnap.hu>
Message-ID: <Pine.LNX.4.55.0306031010140.5124@jlaas2.data.slu.se>
References: <3EDC51BD.1010700@bnap.hu>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=ISO-8859-1
Content-Transfer-Encoding: 8BIT
Subject: [Dovecot] pop3 logging patches
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Tue, 03 Jun 2003 08:14:30 -0000
X-UID: 890                                                  
Status: O
Content-Length: 2603


Following patches will fulfill my need for pop3 logging.

It aint pretty, but it works!

Would you consider including this until you have made this more to your
liking ?

Cheers
Jens Låås

--- pop3/commands.c.orig	2003-05-30 10:34:33.000000000 +0200
+++ pop3/commands.c	2003-06-03 10:05:53.000000000 +0200
@@ -1,5 +1,6 @@
 /* Copyright (C) 2002 Timo Sirainen */

+#include <sys/stat.h>
 #include "common.h"
 #include "istream.h"
 #include "ostream.h"
@@ -139,14 +140,29 @@
 	return TRUE;
 }

+static uoff_t inbox_size(struct client *client)
+{
+  struct stat sb;
+  if(stat(client->mailbox->storage->inbox_file, &sb))
+    return 0;
+  return sb.st_size;
+}
+
 static int cmd_quit(struct client *client, const char *args __attr_unused__)
 {
 	unsigned int first, last, msgnum, max, i, j;
 	struct mail_full_flags flags;
 	string_t *set;
+	uoff_t orig_size;

+	orig_size = inbox_size(client);
+
 	if (!client->deleted) {
 		client_send_line(client, "+OK Logging out.");
+		/* FIXME uoff_t printing */
+		i_info("Logout: del 0/0 left %u/%llu",
+		       client->messages_count,
+		       orig_size);
 		client_disconnect(client);
 		return TRUE;
 	}
@@ -200,6 +216,22 @@
 	else
 		client_send_storage_error(client);

+	{
+	  uoff_t cur_size;
+	  struct mailbox_status status;
+
+	if (client->mailbox->get_status(client->mailbox,
+					 STATUS_MESSAGES | STATUS_UIDVALIDITY,
+					 &status))
+	  {
+	    cur_size = inbox_size(client);
+	    i_info("Logout: del %u/%llu left %u/%llu",
+		   client->messages_count - status.messages,
+		   orig_size - cur_size,
+		   status.messages,
+		   cur_size);
+	  }
+	}
 	client_disconnect(client);
 	return TRUE;
 }


--- pop3-login/client-authenticate.c.orig	2003-05-30 10:32:19.000000000 +0200
+++ pop3-login/client-authenticate.c	2003-05-30 10:33:26.000000000 +0200
@@ -91,7 +91,8 @@
 	const char *reason = NULL;

 	if (success) {
-		reason = t_strconcat("Login: ", client->common.virtual_user,
+		reason = t_strconcat(client->tls?"Login [TLS]:":"Login: ",
+				     client->common.virtual_user,
 				     NULL);
 	} else {
 		reason = t_strconcat("Internal login failure: ",


-----------------------------------------------------------------------
    'This mail automatically becomes portable when carried.'
-----------------------------------------------------------------------
    Jens Låås                              Email: jens.laas@data.slu.se
    Department of Computer Services, SLU   Phone: +46 18 67 35 15
    Vindbrovägen 1
    P.O. Box 7079
    S-750 07 Uppsala
    SWEDEN
-----------------------------------------------------------------------
From jake@lucidpark.net  Tue Jun  3 20:49:33 2003
Return-Path: <jake@lucidpark.net>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 123C523866; Tue,  3 Jun 2003 20:49:33 +0300 (EEST)
Received: from europa.capecodvacation.com (europa.capecodvacation.com
	[199.232.149.98])
	by danu.procontrol.fi (Postfix) with ESMTP id 14D0523865
	for <dovecot@procontrol.fi>; Tue,  3 Jun 2003 20:49:31 +0300 (EEST)
Received: from vger.rental.trec (vger.rental.trec [192.168.1.9])
	by europa.capecodvacation.com (Postfix) with ESMTP id EE6B430C14D
	for <dovecot@procontrol.fi>; Tue,  3 Jun 2003 13:49:26 -0400 (EDT)
Received: by vger.rental.trec (Postfix, from userid 1000)
	id 9221C6F9E7; Tue,  3 Jun 2003 13:49:20 -0400 (EDT)
Date: Tue, 3 Jun 2003 13:49:20 -0400
From: Jacob Elder <jake@lucidpark.net>
To: dovecot@procontrol.fi
Message-ID: <20030603174920.GA18515@vger.capecodvacation.com>
Mail-Followup-To: dovecot@procontrol.fi
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.5.4i
Subject: [Dovecot] gnutls_handshake problem
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Tue, 03 Jun 2003 17:49:33 -0000
X-UID: 891                                                  
Status: O

I'm trying to bring dovecot up on Debian/stable using Christof Meerwald's
unofficial packages (cmeerw.org/debian/). This package seems to work fine on
Debian/testing. There error I'm getting on the stable box is:

gnutls_handshake: A TLS fatal alert has been received.(Bad record MAC)

Any guesses?

-- 
Jacob Elder
From zach.bagnall@bulletinwireless.com  Wed Jun  4 08:00:57 2003
Return-Path: <zach.bagnall@bulletinwireless.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id C1B7C23866; Wed,  4 Jun 2003 08:00:57 +0300 (EEST)
Received: from piranha.intra.jungledrum.co.nz (ns1.jungledrum.co.nz
	[210.54.149.34])
	by danu.procontrol.fi (Postfix) with ESMTP id 672962384C
	for <dovecot@procontrol.fi>; Wed,  4 Jun 2003 08:00:54 +0300 (EEST)
Received: from piranha (localhost.localdomain [127.0.0.1])
	by piranha.intra.jungledrum.co.nz (Postfix) with SMTP
	id 89F1415005; Wed,  4 Jun 2003 17:00:44 +1200 (NZST)
Date: Wed, 4 Jun 2003 17:00:41 +1200
From: Zach Bagnall <zach.bagnall@bulletinwireless.com>
To: dovecot@procontrol.fi
Message-Id: <20030604170041.25b60670.zach.bagnall@bulletinwireless.com>
Organization: Bulletin Wireless
X-Mailer: Sylpheed version 0.8.9 (GTK+ 1.2.10; i686-pc-linux-gnu)
Mime-Version: 1.0
Content-Type: multipart/signed; protocol="application/pgp-signature";
 micalg="pgp-sha1"; boundary="=.'wFdksiE(anQ8g"
Subject: [Dovecot] Dovecot for Gentoo portage
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 04 Jun 2003 05:00:58 -0000
X-UID: 892                                                  
Status: O

--=.'wFdksiE(anQ8g
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

Hi all -

I've added an ebuild for 0.99.9.1 to bugzilla:

http://bugs.gentoo.org/show_bug.cgi?id=22080

It includes the CR+LF patch. Should be trivial to update for .10 when
it makes an appearance :-).

Feel free to fix/improve this ebuild - I'm fairly new at them.

Zach.

-- 
Services & Support
Bulletin Wireless | www.bulletinwireless.com
This email is digitally signed | Key ID 0x3F9AA9A2

--=.'wFdksiE(anQ8g
Content-Type: application/pgp-signature

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.1 (GNU/Linux)

iD8DBQE+3Xz84jDFYT+aqaIRApRfAKCxuZmJk811Jv0Sy3iDFSnstrMSsgCgmZty
OsB18rsu+zv1nraG+oAtILo=
=qHrQ
-----END PGP SIGNATURE-----

--=.'wFdksiE(anQ8g--
From jens.laas@data.slu.se  Wed Jun  4 08:52:28 2003
Return-Path: <jens.laas@data.slu.se>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 0B23923866; Wed,  4 Jun 2003 08:52:28 +0300 (EEST)
Received: from mail1.slu.se (mail1.slu.se [130.238.96.11])
	by danu.procontrol.fi (Postfix) with ESMTP id 4806B23865
	for <dovecot@procontrol.fi>; Wed,  4 Jun 2003 08:52:25 +0300 (EEST)
Received: from jlaas2.data.slu.se (jlaas2.data.slu.se [130.238.98.68])
	by mail1.slu.se (8.9.3p2/8.9.3) with ESMTP id HAA22899;
	Wed, 4 Jun 2003 07:52:16 +0200
Date: Wed, 4 Jun 2003 07:52:19 +0200 (CEST)
From: Jens Laas <jens.laas@data.slu.se>
X-X-Sender: jensl@jlaas2.data.slu.se
To: Jacob Elder <jake@lucidpark.net>
Subject: Re: [Dovecot] gnutls_handshake problem
In-Reply-To: <20030603174920.GA18515@vger.capecodvacation.com>
Message-ID: <Pine.LNX.4.55.0306040745010.5124@jlaas2.data.slu.se>
References: <20030603174920.GA18515@vger.capecodvacation.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=ISO-8859-1
Content-Transfer-Encoding: 8BIT
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 04 Jun 2003 05:52:28 -0000
X-UID: 893                                                  
Status: O
Content-Length: 1140

(03.06.03 kl.13:49) Jacob Elder skrev följande till dovecot@procontrol.fi:

> I'm trying to bring dovecot up on Debian/stable using Christof Meerwald's
> unofficial packages (cmeerw.org/debian/). This package seems to work fine on
> Debian/testing. There error I'm getting on the stable box is:
>
> gnutls_handshake: A TLS fatal alert has been received.(Bad record MAC)
>
> Any guesses?

Check versions of libgcrypt and gnutls.

I would recommend compiling libgcrypt, gnutls and dovecot by hand.

The actual error message doesnt tell me more than that the handshake
failed. Either server or client (or both) is in error.

Jens Låås

>
> --
> Jacob Elder
>

-----------------------------------------------------------------------
    'This mail automatically becomes portable when carried.'
-----------------------------------------------------------------------
    Jens Låås                              Email: jens.laas@data.slu.se
    Department of Computer Services, SLU   Phone: +46 18 67 35 15
    Vindbrovägen 1
    P.O. Box 7079
    S-750 07 Uppsala
    SWEDEN
-----------------------------------------------------------------------
From tss@iki.fi  Wed Jun  4 19:41:05 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id E06762387A; Wed,  4 Jun 2003 19:41:05 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 436AC2384C
	for <dovecot@procontrol.fi>; Wed,  4 Jun 2003 19:41:04 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id E7DF95C896A0; Wed,  4 Jun 2003 19:41:03 +0300 (EEST)
Subject: Re: [Dovecot] squirrelmail setup
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <3EDB5D17.1050902@konts.lv>
References: <3EDB5D17.1050902@konts.lv>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1054744863.8869.7.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 04 Jun 2003 19:41:03 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 04 Jun 2003 16:41:06 -0000
X-UID: 894                                                  
Status: O

On Mon, 2003-06-02 at 17:20, Gasha wrote:
> My setup:
> INBOX -> /var/spool/mail/user
> directories -> /home/user/Maildir
> 
> it works with Netscape, but squirrel mail shows only subfolder content.
> nothing in INBOX.

How did you do this? You couldn't have configured Dovecot to directly do
that with Maildir. Separate INBOX location works only with mbox. Your
Netscape is maybe reading the INBOX directly?

From tss@iki.fi  Wed Jun  4 19:45:54 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 0E7A82387A; Wed,  4 Jun 2003 19:45:54 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 78D792384C
	for <dovecot@procontrol.fi>; Wed,  4 Jun 2003 19:45:52 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 38A2A5C896A0; Wed,  4 Jun 2003 19:45:52 +0300 (EEST)
Subject: Re: mkdir {cur,tmp,new}? (was Re: [Dovecot] Speed and memory probs
	writing large Maildir)
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.44.0305301623260.7269-100000@vegemite.nssg.mitel.com>
References: 
	 <Pine.LNX.4.44.0305301623260.7269-100000@vegemite.nssg.mitel.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1054745152.8867.13.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 04 Jun 2003 19:45:52 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 04 Jun 2003 16:45:54 -0000
X-UID: 895                                                  
Status: O
Content-Length: 1108

On Fri, 2003-05-30 at 23:29, Charlie Brady wrote:
> On 30 May 2003, Timo Sirainen wrote:
> 
> > It still does a few unnecessary things every time mailbox is opened (ie.
> > at every APPEND command). I think I shouldn't try to mkdir() the cur,
> > new and tmp dirs immediately. Those could be more easily created if/when
> > stat() fails while syncing.
> 
> Shouldn't the maildir only be created in response to a CREATE command. It 
> certainly shouldn't be as the result of an APPEND:
> 
>    If the destination mailbox does not exist, a server MUST return an
>    error, and MUST NOT automatically create the mailbox. 
> 
> I would interpret any of cur, new and tmp being missing as "mailbox does 
> not exist".

Well, maybe. I was just thinking cases when a DELETE died in the middle
of it, and left only some of the dirs there. In that case you couldn't
then SELECT/APPEND the mailbox, but I guess you could DELETE it again..

Or maybe rather Dovecot should just create those dirs when it notices
they don't exist while trying to use them. I like to be able to create
new mailboxes with "mkdir .boxname".

From tss@iki.fi  Wed Jun  4 19:51:02 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 103812387A; Wed,  4 Jun 2003 19:51:02 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 8B8B72384C
	for <dovecot@procontrol.fi>; Wed,  4 Jun 2003 19:51:00 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 6242B5C896A0; Wed,  4 Jun 2003 19:51:00 +0300 (EEST)
Subject: Re: [Dovecot] Re: DRAC support?
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030530143201.GZ676@dust.uchicago.edu>
References: <20030528050825.GA10934@lazy.spodder.com>
	 <1054121419.3131.275.camel@hurina>
	 <20030529010911.GA19139@lazy.spodder.com>
	 <1054252379.23632.381.camel@hurina>
	 <20030530002537.GA1552@lazy.spodder.com>
	 <1054258989.23632.400.camel@hurina>
	 <20030530020518.GG1552@lazy.spodder.com>
	 <1054261073.19156.413.camel@hurina>
	 <20030530041118.GK1552@lazy.spodder.com>
	 <1054295941.23632.447.camel@hurina>
	 <20030530143201.GZ676@dust.uchicago.edu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1054745460.8867.20.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 04 Jun 2003 19:51:00 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 04 Jun 2003 16:51:02 -0000
X-UID: 896                                                  
Status: O

On Fri, 2003-05-30 at 17:32, David Champion wrote:
> > > Will you include drac.c ?
> > No. I'll leave it to patches directory.
> 
> ./configure --enable-drac ?
> 
> Shouldn't add any extra weight to the --disable-drac build.

It's still extra bloat for most people. That's why I made it a plugin :)
I don't think it really matters how it's distributed, and you most
likely don't ever have to reinstall it when upgrading Dovecot.

From charlieb-dovecot@e-smith.com  Wed Jun  4 21:01:01 2003
Return-Path: <charlieb-dovecot@e-smith.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 4372C2387A; Wed,  4 Jun 2003 21:01:01 +0300 (EEST)
Received: from nssg.mitel.com (mail.e-smith.com [216.191.234.126])
	by danu.procontrol.fi (Postfix) with SMTP id 147B623865
	for <dovecot@procontrol.fi>; Wed,  4 Jun 2003 21:00:56 +0300 (EEST)
Received: (qmail 21742 invoked by uid 404); 4 Jun 2003 18:00:48 -0000
Received: from charlieb-dovecot@e-smith.com by tripe.nssg.mitel.com with
	qmail-scanner; 04 Jun 2003 14:00:48 -0000
Received: from allspice-core.nssg.mitel.com (HELO e-smith.com) (10.33.16.12)
  by tripe.nssg.mitel.com (10.33.17.11) with SMTP; 04 Jun 2003 18:00:48 -0000
Received: (qmail 31433 invoked from network); 4 Jun 2003 18:00:48 -0000
Received: from unknown (10.35.25.57)
  by allspice.nssg.mitel.com with QMQP; 4 Jun 2003 18:00:48 -0000
Received: from localhost (sendmail-bs@127.0.0.1)
  by localhost with SMTP; 4 Jun 2003 18:07:33 -0000
Date: Wed, 4 Jun 2003 14:07:33 -0400 (EDT)
From: Charlie Brady <charlieb-dovecot@e-smith.com>
X-X-Sender: charlieb@vegemite.nssg.mitel.com
To: Timo Sirainen <tss@iki.fi>
In-Reply-To: <1054745152.8867.13.camel@hurina>
Message-ID: <Pine.LNX.4.44.0306041402550.23276-100000@vegemite.nssg.mitel.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
cc: dovecot@procontrol.fi
Subject: [Dovecot] Re: mkdir {cur,tmp,new}?
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 04 Jun 2003 18:01:01 -0000
X-UID: 897                                                  
Status: O
Content-Length: 1095


On 4 Jun 2003, Timo Sirainen wrote:

> On Fri, 2003-05-30 at 23:29, Charlie Brady wrote:
> > 
> > I would interpret any of cur, new and tmp being missing as "mailbox does 
> > not exist".
> 
> Well, maybe. I was just thinking cases when a DELETE died in the middle
> of it, and left only some of the dirs there. In that case you couldn't
> then SELECT/APPEND the mailbox, but I guess you could DELETE it again..

Can you DELETE a mailbox which doesn't exist?

If a DELETE dies in the middle, and the maildir isn't complete, then by my
definition (and I'd claim, logically) the mailbox does not exist. If a
mailbox doesn't exist, you can SELECT/APPEND or DELETE. But it shouldn't
appear in a LIST, and you must be able to CREATE.

> Or maybe rather Dovecot should just create those dirs when it notices
> they don't exist while trying to use them.

I think a maildir must be complete to exist. Hence it's wrong to "by 
stealth" convert a partial maildir to a complete one.

> I like to be able to create new mailboxes with "mkdir .boxname".

Shouldn't that be "CREATE boxname"? :-)

--
Charlie


From cirvis@konts.lv  Wed Jun  4 22:19:51 2003
Return-Path: <cirvis@konts.lv>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 8A6552387A; Wed,  4 Jun 2003 22:19:51 +0300 (EEST)
Received: from card.konts.lv (card.konts.lv [159.148.139.17])
	by danu.procontrol.fi (Postfix) with ESMTP id 7445623865
	for <dovecot@procontrol.fi>; Wed,  4 Jun 2003 22:19:46 +0300 (EEST)
Received: (from daemon@localhost)
	by card.konts.lv (8.11.6/8.11.6) id h54JHak10216
	for <dovecot@procontrol.fi>; Wed, 4 Jun 2003 22:17:36 +0300
Received: from <cirvis@konts.lv> (gugu.konts.lv [10.10.1.171]) by
	card.konts.lv via smap (V2.1)
	id xma010207; Wed, 4 Jun 03 22:17:24 +0300
Message-ID: <3EDE460C.40700@konts.lv>
Date: Wed, 04 Jun 2003 22:18:36 +0300
From: Gasha <cirvis@konts.lv>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US;
	rv:0.9.4.1) Gecko/20020508 Netscape6/6.2.3
X-Accept-Language: en-us
MIME-Version: 1.0
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] squirrelmail setup
References: <3EDB5D17.1050902@konts.lv> <1054744863.8869.7.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-Spam-Status: No, hits=-28.1 required=6.0
	tests=AWL,BAYES_01,EMAIL_ATTRIBUTION,QUOTED_EMAIL_TEXT,
	      REFERENCES,REPLY_WITH_QUOTES,USER_AGENT_MOZILLA_UA
	autolearn=ham version=2.52
X-Spam-Level: 
X-Spam-Checker-Version: SpamAssassin 2.52 (1.174.2.8-2003-03-24-exp)
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 04 Jun 2003 19:19:51 -0000
X-UID: 898                                                  
Status: O

Strange, but it worked that way. At least with netscape.
In the beginning i set up INBOX + mbox.
then renamed mail/ to oldmail/
and did "mkdir Maildir".

But other IMAP mail clients didnt understand...
So i decided to left "mbox" format as default.
I'm using "sendmail" and "pine" a lot.

P.S. just installed 0.99.10-test11.
I did some performance tests. IMAP message download is FAST!!!
PIII-667 Mhz box with Corier is slower than Cyrix 120 Mhz Dovecot.
MS Exchange 5.5 is somewhere far behind...

Gasha

Timo Sirainen wrote:

> On Mon, 2003-06-02 at 17:20, Gasha wrote:
> 
>>My setup:
>>INBOX -> /var/spool/mail/user
>>directories -> /home/user/Maildir
>>
>>it works with Netscape, but squirrel mail shows only subfolder content.
>>nothing in INBOX.
>>
> 
> How did you do this? You couldn't have configured Dovecot to directly do
> that with Maildir. Separate INBOX location works only with mbox. Your
> Netscape is maybe reading the INBOX directly?
> 
> 


From dgc@uchicago.edu  Thu Jun  5 03:52:09 2003
Return-Path: <dgc@uchicago.edu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id E2F732387A; Thu,  5 Jun 2003 03:52:09 +0300 (EEST)
Received: from dust.uchicago.edu (dust.uchicago.edu [128.135.0.35])
	by danu.procontrol.fi (Postfix) with ESMTP id D35E423865
	for <dovecot@procontrol.fi>; Thu,  5 Jun 2003 03:52:07 +0300 (EEST)
Received: (from dgc@localhost)
	by dust.uchicago.edu (8.11.6/8.11.6) id h550q3M29172;
	Wed, 4 Jun 2003 19:52:03 -0500 (CDT)
X-Authentication-Warning: dust.uchicago.edu: dgc set sender to
	dgc@uchicago.edu using -f
Date: Wed, 4 Jun 2003 19:52:03 -0500
From: David Champion <dgc@uchicago.edu>
To: Timo Sirainen <tss@iki.fi>
Message-ID: <20030605005203.GA3437@dust.uchicago.edu>
Mail-Followup-To: Timo Sirainen <tss@iki.fi>, dovecot@procontrol.fi
References: <20030529010911.GA19139@lazy.spodder.com>
	<1054252379.23632.381.camel@hurina> <20030530002537.GA1552@lazy.spodder.com>
	<1054258989.23632.400.camel@hurina> <20030530020518.GG1552@lazy.spodder.com>
	<1054261073.19156.413.camel@hurina> <20030530041118.GK1552@lazy.spodder.com>
	<1054295941.23632.447.camel@hurina> <20030530143201.GZ676@dust.uchicago.edu>
	<1054745460.8867.20.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1054745460.8867.20.camel@hurina>
User-Agent: Mutt/1.5.2i
cc: dovecot@procontrol.fi
Subject: [Dovecot] Re: DRAC support?
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Thu, 05 Jun 2003 00:52:10 -0000
X-UID: 899                                                  
Status: O
Content-Length: 1404

* On 2003.06.04, in <1054745460.8867.20.camel@hurina>,
*	"Timo Sirainen" <tss@iki.fi> wrote:
> On Fri, 2003-05-30 at 17:32, David Champion wrote:
> > > > Will you include drac.c ?
> > > No. I'll leave it to patches directory.
> > 
> > ./configure --enable-drac ?
> > 
> > Shouldn't add any extra weight to the --disable-drac build.
> 
> It's still extra bloat for most people. That's why I made it a plugin :)
> I don't think it really matters how it's distributed, and you most
> likely don't ever have to reinstall it when upgrading Dovecot.

Oh, I don't care whether it's a plugin, I'm just looking for a way to
add the compilation and installation of the plugin to the same command
sequence as the rest of the build, so it can be automated somewhat more
instead of having to read the drac.c file and figure out what commands
to run based on your acquired knowledge of the build environment for the
rest of the package, and type/paste those in manually.

I'm really, honestly, truly talking about a no-added-bloat approach. I'm
just asking for configure to add a cc/ld for drac.so to the Makefile, if
you specify --enable-drac.

-- 
 -D.    dgc@uchicago.edu        NSIT    University of Chicago
      When using any driving directions or map, it's a good idea to do a
      reality check and make sure the road still exists, watch out for
      construction, and follow all traffic safety precautions.
From cmeerw@web.de  Sat Jun  7 09:37:28 2003
Return-Path: <cmeerw@web.de>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 1B7722387A; Sat,  7 Jun 2003 09:37:28 +0300 (EEST)
Received: from octopussy.utanet.at (octopussy.utanet.at [213.90.36.45])
	by danu.procontrol.fi (Postfix) with ESMTP id 214CD23845
	for <dovecot@procontrol.fi>; Sat,  7 Jun 2003 09:37:25 +0300 (EEST)
Received: from paris.utanet.at ([213.90.36.7])
	by octopussy.utanet.at with esmtp (Exim 4.12)
	id 19OXKJ-0006Ju-00; Sat, 07 Jun 2003 08:37:19 +0200
Received: from [62.218.247.51] (helo=hacking.cmeerw.net)
	by paris.utanet.at with esmtp (TLSv1:DES-CBC3-SHA:168)
	(Exim 4.12)
	id 19OXKJ-0007E4-00; Sat, 07 Jun 2003 08:37:19 +0200
Received: from cmeerw by hacking.cmeerw.net with local (Exim 4.20)
	id 19OXKA-0000JA-Km; Sat, 07 Jun 2003 08:37:10 +0200
Date: Sat, 7 Jun 2003 08:37:10 +0200
From: Christof Meerwald <cmeerw@web.de>
To: Jacob Elder <jake@lucidpark.net>
Message-ID: <20030607063710.GA1174@hacking.cmeerw.net>
References: <20030603174920.GA18515@vger.capecodvacation.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20030603174920.GA18515@vger.capecodvacation.com>
User-Agent: Mutt/1.3.28i
X-PGP-Key: 1024D/2B10BE68, 1998-06-29
X-PGP-Fingerprint: 0289 5466 C1F5 B03C DBA7  6304 8CAF 9782 2B10 BE68
X-Mailman-Approved-At: Sat, 07 Jun 2003 14:04:57 +0300
cc: dovecot@procontrol.fi
Subject: [Dovecot] Re: gnutls_handshake problem
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Sat, 07 Jun 2003 06:37:28 -0000
X-UID: 900                                                  
Status: O

On Tue, 3 Jun 2003 13:49:20 -0400, Jacob Elder wrote:
> I'm trying to bring dovecot up on Debian/stable using Christof Meerwald's
> unofficial packages (cmeerw.org/debian/). This package seems to work fine on
> Debian/testing. There error I'm getting on the stable box is:
> 
> gnutls_handshake: A TLS fatal alert has been received.(Bad record MAC)
> 
> Any guesses?

I guess you get this error message from your mail client (because my dovecot
packages are linked against openssl). Does it work if you connect from
Debian testing to dovecot running on Debian stable?

IMO, Debian woody's guntls package is too old and shouldn't be considered
stable.


bye, Christof

-- 
http://cmeerw.org                                 JID: cmeerw@jabber.at
mailto cmeerw at web.de
From jaldhar@debian.org  Sat Jun  7 20:12:09 2003
Return-Path: <jaldhar@debian.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 383312387A; Sat,  7 Jun 2003 20:12:09 +0300 (EEST)
Received: from mail.braincells.com (samadhi.braincells.com [216.162.42.100])
	by danu.procontrol.fi (Postfix) with ESMTP id 3EC9B2384C
	for <dovecot@procontrol.fi>; Sat,  7 Jun 2003 20:12:07 +0300 (EEST)
Received: from localhost (localhost [127.0.0.1])
	by mail.braincells.com (Postfix) with ESMTP
	id 4EAA07F80; Sat,  7 Jun 2003 13:12:02 -0400 (EDT)
Date: Sat, 7 Jun 2003 13:12:02 -0400 (EDT)
From: "Jaldhar H. Vyas" <jaldhar@debian.org>
X-X-Sender: jaldhar@samadhi.braincells.com
To: Christof Meerwald <cmeerw@web.de>
Subject: Re: [Dovecot] Re: gnutls_handshake problem
In-Reply-To: <20030607063710.GA1174@hacking.cmeerw.net>
Message-ID: <Pine.LNX.4.56.0306071307360.22075@samadhi.braincells.com>
References: <20030603174920.GA18515@vger.capecodvacation.com>
 <20030607063710.GA1174@hacking.cmeerw.net>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
Reply-To: "Jaldhar H. Vyas" <jaldhar@debian.org>
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Sat, 07 Jun 2003 17:12:09 -0000
X-UID: 901                                                  
Status: O
Content-Length: 1205

On Sat, 7 Jun 2003, Christof Meerwald wrote:

> On Tue, 3 Jun 2003 13:49:20 -0400, Jacob Elder wrote:
> > I'm trying to bring dovecot up on Debian/stable using Christof
> > Meerwald's unofficial packages (cmeerw.org/debian/). This package
> > seems to work fine on Debian/testing. There error I'm getting on the
> > stable box is:
> >
> > gnutls_handshake: A TLS fatal alert has been received.(Bad record MAC)
> >
> > Any guesses?
>
> I guess you get this error message from your mail client (because my dovecot
> packages are linked against openssl). Does it work if you connect from
> Debian testing to dovecot running on Debian stable?
>
> IMO, Debian woody's guntls package is too old and shouldn't be considered
> stable.
>

Btw, did you know I already provide a backport to woody at
http://www.braincells.com/open/ ?  I keep it in sync with my official
packages.

Anyway I've noticed this too, and I have a feeling it might be something
to do with the way we're generating a self-signed certificate.  I haven't
had much time to do an exhaustive investigation but I hope I might have
soe time this weekend.

-- 
Jaldhar H. Vyas <jaldhar@debian.org>
La Salle Debain - http://www.braincells.com/debian/
From mike@pixor.net  Tue Jun 10 23:27:07 2003
Return-Path: <mike@pixor.net>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id E3D1823866; Tue, 10 Jun 2003 23:27:06 +0300 (EEST)
Received: from pixor.net (unknown [12.106.77.136])
	by danu.procontrol.fi (Postfix) with ESMTP id 849BB2384C
	for <dovecot@procontrol.fi>; Tue, 10 Jun 2003 23:27:00 +0300 (EEST)
Received: from localhost (mike@localhost)
	by pixor.net (8.11.6/8.11.6) with ESMTP id h5AKQwF25773
	for <dovecot@procontrol.fi>; Tue, 10 Jun 2003 16:26:58 -0400
Date: Tue, 10 Jun 2003 13:26:58 -0700 (PDT)
From: Mike Matz <mike@pixor.net>
To: dovecot@procontrol.fi
Message-ID: <Pine.LNX.4.44.0306101314540.25554-100000@pixor.net>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
Subject: [Dovecot] Help setting up SSL?
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Tue, 10 Jun 2003 20:27:07 -0000
X-UID: 902                                                  
Status: O
Content-Length: 1442

Hi,

Sorry to bother, I don't know if this mailing list is the right place to 
look for help setting up dovecot..  Anyway I've got standard IMAP working 
fine, and I used mkcert.sh after editing the openssl config, and it seemed 
to work properly (I had to change some directories, I am using the FreeBSD 
5.1-CURRENT port)..

Anyway, when I try to connect using Outlook, here is what the log shows:
(without the exact ip address shown, dont hax0r my windows machine!)

imap-login: Jun 10 13:13:14 Warning: SSL_accept() failed: 
error:1408F455:SSL routines:SSL3_GET_RECORD:decryption failed or bad 
record mac [12.106.77.x]
imap-login: Jun 10 13:13:14 Warning: SSL_accept() syscall failed: EOF 
[12.106.77.x]
imap-login: Jun 10 13:13:14 Panic: key not found from hash
dovecot: Jun 10 13:13:14 Error: child 32935 (login) killed with signal 6
imap-login: Jun 10 13:13:14 Warning: SSL_accept() failed: 
error:1408F455:SSL routines:SSL3_GET_RECORD:decryption failed or bad 
record mac [12.106.77.x]
imap-login: Jun 10 13:13:14 Warning: SSL_accept() syscall failed: EOF 
[12.106.77.x]
imap-login: Jun 10 13:13:14 Panic: key not found from hash
dovecot: Jun 10 13:13:14 Error: child 32937 (login) killed with signal 6


so it says "decryption failed or bad record mac".. Does this mean I don't 
have my .pem files set up correctly?  Or is there a problem with the 
OpenSSL libraries?

I'd sure appreciate any help you could give me.

Thanks,

Mike

From mem@mv.mv.com  Wed Jun 11 22:30:37 2003
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 3424223866; Wed, 11 Jun 2003 22:30:37 +0300 (EEST)
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id BD87E23845
	for <dovecot@procontrol.fi>; Wed, 11 Jun 2003 22:30:29 +0300 (EEST)
Received: (qmail 18419 invoked by uid 101); 11 Jun 2003 15:30:27 -0400
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Wed, 11 Jun 2003 15:30:27 -0400
To: dovecot@procontrol.fi
Message-ID: <20030611193027.GL17004@iridium.mv.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.4.1i
Subject: [Dovecot] bug in search?  (fwd)
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 11 Jun 2003 19:30:37 -0000
X-UID: 903                                                  
Status: O

I received this report and am passing it along..

mm


> If all messages are marked for deletion, the following command returns
> an empty list:
>   SEARCH DELETED
> If all messages BUT one are marked for deletion the same command returns
> a list of every message but one.
> 
> If parens are used it works fine.
>   SEARCH (DELETED)

From mem@mv.mv.com  Wed Jun 11 22:50:38 2003
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id D720323896; Wed, 11 Jun 2003 22:50:38 +0300 (EEST)
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id 94F7523860
	for <dovecot@procontrol.fi>; Wed, 11 Jun 2003 22:50:34 +0300 (EEST)
Received: (qmail 2447 invoked by uid 101); 11 Jun 2003 15:50:33 -0400
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Wed, 11 Jun 2003 15:50:33 -0400
To: dovecot@procontrol.fi
Message-ID: <20030611195033.GP17004@iridium.mv.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.4.1i
Subject: [Dovecot] Folder creation errors
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 11 Jun 2003 19:50:39 -0000
X-UID: 904                                                  
Status: O


Hi-

In a mbox environment:

1 login username password
1 OK Logged in.
2 create "slar"
2 NO Internal error [2003-06-11 15:44:56]
3 create "/slar"
3 NO Invalid mailbox name: /slar
4 create "Mail/slar"
4 OK Create completed.
5 create "./slar"
5 OK Create completed.
6 create "blar"
6 NO Internal error [2003-06-11 15:46:54]
7 logout
* BYE Logging out
7 OK Logout completed.

i.e. I get "internal error" if there is no path component in the
folder name.  Is this a problem?  I would guess that "internal error"
is always a problem :-)

mm
From cce@cauchy.axista.com  Wed Jun 11 23:00:57 2003
Return-Path: <cce@cauchy.axista.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id E19EA23896; Wed, 11 Jun 2003 23:00:57 +0300 (EEST)
Received: from cauchy.axista.com (cauchy.axista.com [209.61.216.58])
	by danu.procontrol.fi (Postfix) with ESMTP id 1A04723860
	for <dovecot@procontrol.fi>; Wed, 11 Jun 2003 23:00:53 +0300 (EEST)
Received: by cauchy.axista.com (Postfix, from userid 1000)
	id AC6696CEA1; Wed, 11 Jun 2003 20:17:14 +0000 (GMT)
Date: Wed, 11 Jun 2003 20:17:14 +0000
From: "Clark C. Evans" <cce@clarkevans.com>
To: Mike Matz <mike@pixor.net>
Subject: Re: [Dovecot] Help setting up SSL?
Message-ID: <20030611201714.GA17446@doublegemini.com>
References: <Pine.LNX.4.44.0306101314540.25554-100000@pixor.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <Pine.LNX.4.44.0306101314540.25554-100000@pixor.net>
User-Agent: Mutt/1.4i
Sender: cce+pub@clarkevans.com
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 11 Jun 2003 20:00:58 -0000
X-UID: 905                                                  
Status: O
Content-Length: 2215

Mike,

I am also experiencing a similar error message; only using Mozilla
and "mutt" clients against FreeBSD 4.8 (using the install from ports);
I get the same "decryption failed or bad record mac" error, but I 
don't get the remaining messages you have.

Anyway, it seems there is a similar issue on the modssl list,
http://www.mail-archive.com/modssl-users@modssl.org/msg16180.html
and it looks like it may be related to a newer version of OpenSSL
which perhaps changed a few interfaces without broadcasting it
loudly enough?  

I'm must a simple user here... so I don't even know where to begin
tracking this bugger down.

Best,

Clark

On Tue, Jun 10, 2003 at 01:26:58PM -0700, Mike Matz wrote:
| Hi,
| 
| Sorry to bother, I don't know if this mailing list is the right place to 
| look for help setting up dovecot..  Anyway I've got standard IMAP working 
| fine, and I used mkcert.sh after editing the openssl config, and it seemed 
| to work properly (I had to change some directories, I am using the FreeBSD 
| 5.1-CURRENT port)..
| 
| Anyway, when I try to connect using Outlook, here is what the log shows:
| (without the exact ip address shown, dont hax0r my windows machine!)
| 
| imap-login: Jun 10 13:13:14 Warning: SSL_accept() failed: 
| error:1408F455:SSL routines:SSL3_GET_RECORD:decryption failed or bad 
| record mac [12.106.77.x]
| imap-login: Jun 10 13:13:14 Warning: SSL_accept() syscall failed: EOF 
| [12.106.77.x]
| imap-login: Jun 10 13:13:14 Panic: key not found from hash
| dovecot: Jun 10 13:13:14 Error: child 32935 (login) killed with signal 6
| imap-login: Jun 10 13:13:14 Warning: SSL_accept() failed: 
| error:1408F455:SSL routines:SSL3_GET_RECORD:decryption failed or bad 
| record mac [12.106.77.x]
| imap-login: Jun 10 13:13:14 Warning: SSL_accept() syscall failed: EOF 
| [12.106.77.x]
| imap-login: Jun 10 13:13:14 Panic: key not found from hash
| dovecot: Jun 10 13:13:14 Error: child 32937 (login) killed with signal 6
| 
| 
| so it says "decryption failed or bad record mac".. Does this mean I don't 
| have my .pem files set up correctly?  Or is there a problem with the 
| OpenSSL libraries?
| 
| I'd sure appreciate any help you could give me.
| 
| Thanks,
| 
| Mike
| 
From mike@skew.org  Thu Jun 12 00:03:05 2003
Return-Path: <mike@skew.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 973FB23887; Thu, 12 Jun 2003 00:03:05 +0300 (EEST)
Received: from chilled.skew.org (skew.org [65.101.207.237])
	by danu.procontrol.fi (Postfix) with ESMTP id 4978B2384C
	for <dovecot@procontrol.fi>; Thu, 12 Jun 2003 00:03:02 +0300 (EEST)
Received: from chilled.skew.org (localhost.skew.org [127.0.0.1])
	by chilled.skew.org (8.12.6p2/8.12.7) with ESMTP id h5BL32aB016970
	for <dovecot@procontrol.fi>; Wed, 11 Jun 2003 15:03:02 -0600 (MDT)
	(envelope-from mike@chilled.skew.org)
Received: (from mike@localhost)
	by chilled.skew.org (8.12.6p2/8.12.7/Submit) id h5BL31NG016969
	for dovecot@procontrol.fi; Wed, 11 Jun 2003 15:03:01 -0600 (MDT)
From: Mike Brown <mike@skew.org>
Message-Id: <200306112103.h5BL31NG016969@chilled.skew.org>
To: dovecot@procontrol.fi
Date: Wed, 11 Jun 2003 15:03:01 -0600 (MDT)
X-Whoa: whoa.
X-Mailer: ELM [version 2.4ME+ PL90 (25)]
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Content-Type: text/plain; charset=US-ASCII
X-Spam-Status: No, hits=0.8 required=5.0
	tests=SPAM_PHRASE_00_01
	version=2.43
Subject: [Dovecot] when/where to set MAIL env variable?
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 11 Jun 2003 21:03:05 -0000
X-UID: 906                                                  
Status: O
Content-Length: 1316

I am trying to get dovecot to work on a system that uses qmail as its MTA. As
is typical on such systems, the user's primary inbox is an mbox file called
Mailbox, in their home directory. Global shell config files /etc/csh.cshrc and
/etc/profile set the MAIL environment variable to ~/Mailbox for the users,
which is enough to satisfy their interactive mail clients such as pine, mutt,
and elm.

The mail-storages.txt file in the dovecot docs seems to say that dovecot will
not have a problem with this kind of setup. However, I can't figure out how to
make it work. The MAIL variable is only set for users who are using shells
like tcsh, bash, etc. The server apparently does not operate in a shell, so it
is looking in some other location, perhaps /var/mail/$USER, so everyone's
INBOX appears to be empty.

It would help if mail-storages.txt, when referring to environment variables
such as MAIL, would clarify *whose* environment variables are being referred
to. Is it the environment of the user who built dovecot? Is it the environment
of the user running the main dovecot process? Is it the environment of the
user who is checking their mail / the user that dovecot runs setuid as? When
and where do I set the MAIL variable so that dovecot will see it? Or is there
some other problem?

Any help appreciated...

From spectron@coqui.net  Thu Jun 12 16:42:58 2003
Return-Path: <spectron@coqui.net>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 479E623865; Thu, 12 Jun 2003 16:42:58 +0300 (EEST)
Received: from mail.coqui.net (emailgw.coqui.net [196.28.61.10])
	by danu.procontrol.fi (Postfix) with SMTP id 26B6E23860
	for <dovecot@procontrol.fi>; Thu, 12 Jun 2003 16:42:55 +0300 (EEST)
Received: from unknown(66.50.168.166) by mail.coqui.net via csmap 
	 id 23780; Thu, 12 Jun 2003 09:24:59 -0400 (AST)
Message-ID: <001e01c330e8$86eb2850$080aa8c0@PAVILION>
From: "Spectron International, Inc." <spectron@coqui.net>
To: <dovecot@procontrol.fi>
Date: Thu, 12 Jun 2003 09:42:54 -0400
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: 7bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2720.3000
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2600.0000
Subject: [Dovecot] Debian and dovecot
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Thu, 12 Jun 2003 13:42:58 -0000
X-UID: 907                                                  
Status: O
Content-Length: 1344

I have Debian 3.0 (woody) and installed the dovecot packages and it works ok
with the default configuration. I want to change the default configuration,
is any of this possible?

a) I don't want to create accounts for each user, can I have a mailboxes
directory with the mailboxes of all the users? They are not many (10-15).

b) The authentication right now is done through PAM, the pam.d/dovecot file
is:

    auth           required    pam_unix_auth.so
    account     required    pam_unix_acct.so
    password  required    pam_unix_passwd.so
    session      required    pam_unix_session.so

I want to authenticate against an SMB server, I added the following
/etc/pam_smb.conf:

    SPECTRON-MSIM
    MAIN
    MAIN    # documentation says I need 2 servers (only have one, is this
ok)

and changed the pam.d/dovecot to:

    auth           required    pam_smb_auth.so
    account     required    pam_smb_auth.so # there is no pam_smb_acct
    password  required    pam_smb_auth.so # there is no pam_smb_passwd
    session      required    pam_smb_auth.so # there is no pam_smb_session

and it doesn't work. I obviously did something wrong, but don't know what,
and I found nothing that could help me on google. I have samba installed and
it works so It's PAM that I'm configuring incorrectly.

Hope someone here can help me.

Fawzib Rojas


From mike@skew.org  Thu Jun 12 20:40:41 2003
Return-Path: <mike@skew.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 3145223865; Thu, 12 Jun 2003 20:40:41 +0300 (EEST)
Received: from chilled.skew.org (skew.org [65.101.207.237])
	by danu.procontrol.fi (Postfix) with ESMTP id CFEA723860
	for <dovecot@procontrol.fi>; Thu, 12 Jun 2003 20:40:37 +0300 (EEST)
Received: from chilled.skew.org (localhost.skew.org [127.0.0.1])
	by chilled.skew.org (8.12.6p2/8.12.7) with ESMTP id h5CHegaB019980
	for <dovecot@procontrol.fi>; Thu, 12 Jun 2003 11:40:42 -0600 (MDT)
	(envelope-from mike@chilled.skew.org)
Received: (from mike@localhost)
	by chilled.skew.org (8.12.6p2/8.12.7/Submit) id h5CHefN5019979
	for dovecot@procontrol.fi; Thu, 12 Jun 2003 11:40:41 -0600 (MDT)
From: Mike Brown <mike@skew.org>
Message-Id: <200306121740.h5CHefN5019979@chilled.skew.org>
Subject: Re: [Dovecot] when/where to set MAIL env variable?
In-Reply-To: <20030611215333.GB9810@snigger.flatnet>
To: dovecot@procontrol.fi
Date: Thu, 12 Jun 2003 11:40:41 -0600 (MDT)
X-Whoa: whoa.
X-Mailer: ELM [version 2.4ME+ PL90 (25)]
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Content-Type: text/plain; charset=US-ASCII
X-Spam-Status: No, hits=0.0 required=5.0
	tests=IN_REP_TO,SPAM_PHRASE_00_01
	version=2.43
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Thu, 12 Jun 2003 17:40:41 -0000
X-UID: 908                                                  
Status: O

Andrew Basterfield wrote (in a msg I don't think made it to the list):
> In dovecot.conf
> 
> default_mail_env = maildir:~/Maildir

Ah, silly me...

default_mail_env = mbox:~/Mailbox

works wonderfully, and is easier than trying to figure out
where the MAIL environment variable actually comes into play.

Thanks...
From ehrhardt@mathematik.uni-ulm.de  Thu Jun 12 15:34:13 2003
Return-Path: <ehrhardt@mathematik.uni-ulm.de>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 87CD623865; Thu, 12 Jun 2003 15:34:13 +0300 (EEST)
Received: from thales.mathematik.uni-ulm.de (thales.mathematik.uni-ulm.de
	[134.60.66.5])
	by danu.procontrol.fi (Postfix) with SMTP id 508842384C
	for <dovecot@procontrol.fi>; Thu, 12 Jun 2003 15:34:11 +0300 (EEST)
Received: (qmail 14104 invoked by uid 642); 12 Jun 2003 12:34:10 -0000
Message-ID: <20030612123410.14103.qmail@thales.mathematik.uni-ulm.de>
From: "Christian Ehrhardt" <ehrhardt@mathematik.uni-ulm.de>
Date: Thu, 12 Jun 2003 14:34:10 +0200
To: dovecot@procontrol.fi
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.5.4i
X-Mailman-Approved-At: Thu, 12 Jun 2003 23:00:14 +0300
Subject: [Dovecot] Deleting NFS-mounted Maildir subfolders fails
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Thu, 12 Jun 2003 12:34:13 -0000
X-UID: 909                                                  
Status: O
Content-Length: 1415


Hi,

[ please CC me on replies, I'm not subscribed to the list ]

I'm using dovecot-99.9.1 with a little hack to get authentication to
work the way we want it. The server is running on a Solaris 9 host
and user homes are mounted via NFS from a Solaris 8 server (Version doesn't
seem to matter).

Almost everything's fine but I can't delete maildir subfolders if these
reside on a non local NFS-directory. The reason given is that the directory
isn't empty and hence can't be deleted.

Most likely the following happens: dovecot has the index file and
other stuff in the maildir subfolder opened via NFS. When the delete request
comes in dovecot deletes these files but doesn't close them. On normal
unix file systems this is no Problem but with Solaris NFS these file's aren't
actually deleted until they are (explicitly or implicitly) closed.
Instead they are renamed to .nfs.<some digits>. These files will automatically
vanish once they are closed. However, as long as they exist it is impossible
to delete the directory where these files reside and rmdir fails.

This is not a big deal and one may argue that dovecot is fine and the
NFS implementation is in error. However, it would be cool if dovecot
could atttempt to close all administrative files before it deletes them
(or at least before it tries to delete the directory where these files
reside).

    regards   Christian Ehrhardt

-- 
THAT'S ALL FOLKS!
From mike@innercite.com  Fri Jun 13 03:09:57 2003
Return-Path: <mike@innercite.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id C7A6F23865; Fri, 13 Jun 2003 03:09:57 +0300 (EEST)
Received: from knight.innercite.com (knight.innercite.com [158.222.3.8])
	by danu.procontrol.fi (Postfix) with ESMTP id 3CB9523860
	for <dovecot@procontrol.fi>; Fri, 13 Jun 2003 03:09:54 +0300 (EEST)
Received: from rocket.innercite.com (rocket.innercite.com [158.222.7.10])
	h5CNxOpB030841
	for <dovecot@procontrol.fi>; Thu, 12 Jun 2003 16:59:25 -0700
From: Mike Machado <mike@innercite.com>
To: dovecot@procontrol.fi
Content-Type: text/plain
Organization: 
Message-Id: <1055462990.19999.51.camel@rocket.innercite.com>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 12 Jun 2003 17:09:51 -0700
Content-Transfer-Encoding: 7bit
Subject: [Dovecot] Quotas once again
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 13 Jun 2003 00:09:58 -0000
X-UID: 910                                                  
Status: O
Content-Length: 1588

Its been a while since I tried dovecot on my mail server where I have
quota issues. I am using mbox file format. There still seems to be a
quota problem. I have only /var with quotas and basedir is under /usr
(not quotaed). default_mail_env =  mbox:~/mail/:INBOX=/var/mail/%u.

I tried with mbox_locks = dotlock fcntl (1st set of logs below) and with
mbox_locks = fcntl (2nd set of logs)


dotlock:

Jun 12 17:02:49 newrook pop3(mike): open(/var/mail/mike.lock) failed:
Disk quota exceeded
Jun 12 17:02:49 newrook pop3(mike): file_lock_dotlock() failed with mbox
file /var/mail/mike: Disk quota exceeded
Jun 12 17:02:49 newrook pop3(mike): open(/var/mail/mike.lock) failed:
Disk quota exceeded
Jun 12 17:02:49 newrook pop3(mike): file_lock_dotlock() failed with mbox
file /var/mail/mike: Disk quota exceeded
Jun 12 17:02:49 newrook pop3: I/O leak: 0x8050930 (0)
Jun 12 17:02:49 newrook pop3: I/O leak: 0x807baac (1)



fcntl:

Jun 12 16:45:32 newrook pop3-login: Login: mike [127.0.0.1]
Jun 12 16:45:33 newrook pop3(mike): file_set_size() failed with mbox
file /var/mail/mike: Disk quota exceeded
Jun 12 16:45:33 newrook pop3(mike): file_set_size() failed with mbox
file /var/mail/mike: Disk quota exceeded
Jun 12 16:45:33 newrook pop3: I/O leak: 0x8073a2c (1)
Jun 12 16:45:33 newrook pop3: I/O leak: 0x804a470 (0)


I am using the latest CVS (as of 5 minutes ago). Wasn't this supposed to
be working? Have I missed something? My sole goal is to allow people to
delete mail when they are out of disk space.



-- 
Mike Machado
mike@innercite.com
InnerCite Inc.
Engineering Director / CTO

From tom@replic8.net  Fri Jun 13 11:56:09 2003
Return-Path: <tom@replic8.net>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 7408123865; Fri, 13 Jun 2003 11:56:09 +0300 (EEST)
Received: from moutng.kundenserver.de (moutng.kundenserver.de
	[212.227.126.187])
	by danu.procontrol.fi (Postfix) with ESMTP id CDABD2384C
	for <dovecot@procontrol.fi>; Fri, 13 Jun 2003 11:56:06 +0300 (EEST)
Received: from [212.227.126.162] (helo=mrelayng.kundenserver.de)
	by moutng.kundenserver.de with esmtp (Exim 3.35 #1)
	id 19QkLu-0006OS-00
	for dovecot@procontrol.fi; Fri, 13 Jun 2003 10:56:06 +0200
Received: from [80.134.9.183] (helo=server.rpdnet.com)
	by mrelayng.kundenserver.de with asmtp (Exim 3.35 #1)
	id 19QkLu-0000fg-00
	for dovecot@procontrol.fi; Fri, 13 Jun 2003 10:56:06 +0200
Received: by server.rpdnet.com (Postfix, from userid 8000)
	id 2DC3050B87; Fri, 13 Jun 2003 08:56:05 +0000 (GMT)
Received: from aural (sat [192.168.100.88])
	by server.rpdnet.com (Postfix) with SMTP id 5A9D150B84
	for <dovecot@procontrol.fi>; Fri, 13 Jun 2003 08:55:58 +0000 (GMT)
Date: Fri, 13 Jun 2003 10:56:55 +0200
From: tom hensel <tom@replic8.net>
To: dovecot@procontrol.fi
Message-Id: <20030613105655.59fa385b.tom@replic8.net>
X-Mailer: Sylpheed version 0.8.11claws (GTK+ 1.2.10; i386--netbsdelf)
Mime-Version: 1.0
Content-Type: multipart/signed; protocol="application/pgp-signature";
 micalg="pgp-sha1"; boundary="=.onBV:zQDa09pEZ"
X-Spam-Status: No, hits=-6.3 required=6.5
	tests=PGP_SIGNATURE_2
	version=2.53
X-Spam-Level: 
X-Spam-Checker-Version: SpamAssassin 2.53 (1.174.2.15-2003-03-30-exp)
Subject: [Dovecot] trouble with ssl
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 13 Jun 2003 08:56:09 -0000
X-UID: 911                                                  
Status: O

--=.onBV:zQDa09pEZ
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

hi list,

first of all, many thanks to the developers of dovecot for
this great piece of software!

i'm running dovecot 0.99.9.1 on netbsd-current - runs very fine
until i try to use sylpheed from my client to connect via ssl:

--snip--
Jun 13 08:48:32 devbox imap-login: SSL_accept() failed: error:1408F455:SSL routines:SSL3_GET_RECORD:decryption failed or bad record mac [192.168.100.88]
Jun 13 08:48:32 devbox imap-login: Disconnected [192.168.100.8
--snip--

doesn't say much to me...

thanks for any help,
TOM

--=.onBV:zQDa09pEZ
Content-Type: application/pgp-signature

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.2 (NetBSD)

iD8DBQE+6ZHaZj9fGW5yU88RAlclAJsFA7xPKsQGh3FouAY/muwhwJOf1gCgm54G
ju7G9rynQOEuCPmrISaDaGM=
=9z7K
-----END PGP SIGNATURE-----

--=.onBV:zQDa09pEZ--
From mike@pixor.net  Fri Jun 13 18:43:56 2003
Return-Path: <mike@pixor.net>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id D6DB523865; Fri, 13 Jun 2003 18:43:56 +0300 (EEST)
Received: from pixor.net (unknown [12.106.77.136])
	by danu.procontrol.fi (Postfix) with ESMTP id 1676723860
	for <dovecot@procontrol.fi>; Fri, 13 Jun 2003 18:43:53 +0300 (EEST)
Received: from localhost (mike@localhost)
	by pixor.net (8.11.6/8.11.6) with ESMTP id h5DFhlh05389;
	Fri, 13 Jun 2003 11:43:47 -0400
Date: Fri, 13 Jun 2003 08:43:47 -0700 (PDT)
From: Mike Matz <mike@pixor.net>
To: tom hensel <tom@replic8.net>
Subject: Re: [Dovecot] trouble with ssl
In-Reply-To: <20030613105655.59fa385b.tom@replic8.net>
Message-ID: <Pine.LNX.4.44.0306130840350.5217-100000@pixor.net>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 13 Jun 2003 15:43:57 -0000
X-UID: 912                                                  
Status: O
Content-Length: 1039

Tom,

I had the same problem on FreeBSD 5.1-current.  If you search usenet, 
you'll see that lots of people had problems with OpenSSL 0.9.7a.  I've 
upgraded my OpenSSL on FreeBSD compiling the latest port (0.9.7b), and 
recompiling Dovecot.  Everything works fine now.  I've also heard that 
there is a similar problem with some of the 0.9.6 releases, but I think 
that should also be fixed with the latest 0.9.6 sources.

Hope this helps

Mike

On Fri, 13 Jun 2003, tom hensel wrote:

> hi list,
> 
> first of all, many thanks to the developers of dovecot for
> this great piece of software!
> 
> i'm running dovecot 0.99.9.1 on netbsd-current - runs very fine
> until i try to use sylpheed from my client to connect via ssl:
> 
> --snip--
> Jun 13 08:48:32 devbox imap-login: SSL_accept() failed: error:1408F455:SSL routines:SSL3_GET_RECORD:decryption failed or bad record mac [192.168.100.88]
> Jun 13 08:48:32 devbox imap-login: Disconnected [192.168.100.8
> --snip--
> 
> doesn't say much to me...
> 
> thanks for any help,
> TOM
> 

From spectron@coqui.net  Fri Jun 13 21:00:41 2003
Return-Path: <spectron@coqui.net>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id EB2CB23865; Fri, 13 Jun 2003 21:00:41 +0300 (EEST)
Received: from mail.coqui.net (emailgw.coqui.net [196.28.61.10])
	by danu.procontrol.fi (Postfix) with SMTP id A0A1823860
	for <dovecot@procontrol.fi>; Fri, 13 Jun 2003 21:00:38 +0300 (EEST)
Received: from unknown(66.50.169.10) by mail.coqui.net via csmap 
	 id 24088; Fri, 13 Jun 2003 13:42:45 -0400 (AST)
Message-ID: <001501c331d5$b15f8c50$080aa8c0@PAVILION>
From: "Spectron International, Inc." <spectron@coqui.net>
To: <dovecot@procontrol.fi>
Date: Fri, 13 Jun 2003 14:00:30 -0400
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: 7bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2720.3000
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2600.0000
Subject: [Dovecot] Dovecot configuration with passwd-file
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 13 Jun 2003 18:00:42 -0000
X-UID: 913                                                  
Status: O

I have tried to configure dovecot to use passwd-file authentication and I
havent been able to. I changed the following in the dovecot.conf file (I
want to have all the mailboxes in one directory):

default_mail_env = maildir:/opt/mail/%u
auth_userdb = passwd-file /etc/passwd.imap
auth_passdb = passwd-file /etc/passwd.imap
auth_verbose = yes

It gives me the following error (I hoped it would be more verbose than
this):

Internal login failure: f_rojas [192.168.10.4].

passwd.imap exists, the user and password are ok What am I missing?

Fawzib Rojas





From mike@pixor.net  Fri Jun 13 22:07:06 2003
Return-Path: <mike@pixor.net>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id C39FC2387A; Fri, 13 Jun 2003 22:07:06 +0300 (EEST)
Received: from pixor.net (unknown [12.106.77.136])
	by danu.procontrol.fi (Postfix) with ESMTP id 635572384C
	for <dovecot@procontrol.fi>; Fri, 13 Jun 2003 22:07:03 +0300 (EEST)
Received: from localhost (mike@localhost)
	by pixor.net (8.11.6/8.11.6) with ESMTP id h5DJ6xM09730;
	Fri, 13 Jun 2003 15:06:59 -0400
Date: Fri, 13 Jun 2003 12:06:59 -0700 (PDT)
From: Mike Matz <mike@pixor.net>
To: tom hensel <tom@rpdnet.de>
Subject: Re: [Dovecot] trouble with ssl
In-Reply-To: <20030613185303.2f050b84.tom@rpdnet.com>
Message-ID: <Pine.LNX.4.44.0306131204580.9702-100000@pixor.net>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 13 Jun 2003 19:07:07 -0000
X-UID: 914                                                  
Status: O
Content-Length: 1612

Tom,

I had to overwrite the OpenSSL installation in the base.  In FreeBSD, you 
could use -DOPENSSL_OVERWRITE_BASE with your make commands.  Dovecot 
always used the base openssl package, which was the older version, which 
sounds like the same problem you're having.. Again I don't know anything 
about NetBSD =\

Mike

On Fri, 13 Jun 2003, tom hensel wrote:

> mike,
> 
> > I had the same problem on FreeBSD 5.1-current.  If you search usenet, 
> > you'll see that lots of people had problems with OpenSSL 0.9.7a.  I've 
> > upgraded my OpenSSL on FreeBSD compiling the latest port (0.9.7b), and 
> > recompiling Dovecot.  Everything works fine now.  I've also heard that 
> > there is a similar problem with some of the 0.9.6 releases, but I think 
> > that should also be fixed with the latest 0.9.6 sources.
> 
> nebtsd has a pkgsrc for openssl-0.9.6g -  it compiled just fine.
> recompiling dovecot did not change anything, same error as before.
> i'm ccing this mail to the maintainter of the pkgsrc, i wonder how
> dovecot's configure decides wether to use the openssl-libs included
> with netbsd's or the ones form pkgsrc...
>  
> > Hope this helps
> 
> yeah, thanks a lot ;)
> 
> > > i'm running dovecot 0.99.9.1 on netbsd-current - runs very fine
> > > until i try to use sylpheed from my client to connect via ssl:
> > > 
> > > --snip--
> > > Jun 13 08:48:32 devbox imap-login: SSL_accept() failed: error:1408F455:SSL routines:SSL3_GET_RECORD:decryption failed or bad record mac [192.168.100.88]
> > > Jun 13 08:48:32 devbox imap-login: Disconnected [192.168.100.8
> > > --snip--
> 
> bye,
> TOM
> 

From mem@mv.mv.com  Fri Jun 13 23:21:37 2003
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 580DD2387A; Fri, 13 Jun 2003 23:21:37 +0300 (EEST)
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id D1D052384C
	for <dovecot@procontrol.fi>; Fri, 13 Jun 2003 23:21:33 +0300 (EEST)
Received: (qmail 13868 invoked by uid 101); 13 Jun 2003 16:21:32 -0400
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Fri, 13 Jun 2003 16:21:32 -0400
To: Mike Machado <mike@innercite.com>
Subject: Re: [Dovecot] Quotas once again
Message-ID: <20030613202132.GT18940@iridium.mv.net>
References: <1055462990.19999.51.camel@rocket.innercite.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1055462990.19999.51.camel@rocket.innercite.com>
User-Agent: Mutt/1.4.1i
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 13 Jun 2003 20:21:37 -0000
X-UID: 915                                                  
Status: O

On Thu, Jun 12, 2003 at 05:09:51PM -0700, Mike Machado wrote:
> Its been a while since I tried dovecot on my mail server where I have
> quota issues. I am using mbox file format. There still seems to be a
> quota problem. I have only /var with quotas and basedir is under /usr
> (not quotaed). default_mail_env =  mbox:~/mail/:INBOX=/var/mail/%u.
> 
> I tried with mbox_locks = dotlock fcntl (1st set of logs below) and with
> mbox_locks = fcntl (2nd set of logs)

We still see quota issues using Maildir as well.  If a user goes
over quota, they can no longer access their Maildir mailbox.
We have to go in and either change their quota or delete some files.

Somehow I thought this has been fixed at one point, but I guess not..

mm
From seba@iq.pl  Sat Jun 14 11:28:58 2003
Return-Path: <seba@iq.pl>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 898F32387A; Sat, 14 Jun 2003 11:28:58 +0300 (EEST)
Received: from serv.iq.pl (serv.iq.pl [213.76.165.9])
	by danu.procontrol.fi (Postfix) with ESMTP id EEB872384C
	for <dovecot@procontrol.fi>; Sat, 14 Jun 2003 11:28:52 +0300 (EEST)
Received: by serv.iq.pl (Postfix, from userid 1390)
	id E78AD6BD92; Sat, 14 Jun 2003 10:28:48 +0200 (CEST)
Date: Sat, 14 Jun 2003 10:28:48 +0200
From: Sebastian Pachuta <seba@iq.pl>
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] Quotas once again
Message-ID: <20030614082848.GC25593@iq.pl>
References: <1055462990.19999.51.camel@rocket.innercite.com>
	<20030613202132.GT18940@iridium.mv.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20030613202132.GT18940@iridium.mv.net>
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Sat, 14 Jun 2003 08:28:58 -0000
X-UID: 916                                                  
Status: O

On Fri, Jun 13, 2003 at 16:21:32 -0400, Mark E. Mallett wrote:
> 
> We still see quota issues using Maildir as well.  If a user goes
> over quota, they can no longer access their Maildir mailbox.
> We have to go in and either change their quota or delete some files.
> 
> Somehow I thought this has been fixed at one point, but I guess not..

Do You use 'CONTROL=' in 'default_mail_env' ?
From tom@rpdnet.de  Fri Jun 13 19:52:26 2003
Return-Path: <tom@rpdnet.de>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id CB31C23865; Fri, 13 Jun 2003 19:52:26 +0300 (EEST)
Received: from moutng.kundenserver.de (moutng.kundenserver.de
	[212.227.126.177])
	by danu.procontrol.fi (Postfix) with ESMTP id BA7D92384C
	for <dovecot@procontrol.fi>; Fri, 13 Jun 2003 19:52:19 +0300 (EEST)
Received: from [212.227.126.161] (helo=mrelayng.kundenserver.de)
	by moutng.kundenserver.de with esmtp (Exim 3.35 #1)
	id 19Qrmi-00030u-00; Fri, 13 Jun 2003 18:52:16 +0200
Received: from [80.134.14.197] (helo=server.rpdnet.com)
	by mrelayng.kundenserver.de with asmtp (Exim 3.35 #1)
	id 19Qrmi-0000cZ-00; Fri, 13 Jun 2003 18:52:16 +0200
Received: by server.rpdnet.com (Postfix, from userid 8000)
	id 6C2BC50B84; Fri, 13 Jun 2003 16:52:13 +0000 (GMT)
Received: from aural (sat [192.168.100.88])
	by server.rpdnet.com (Postfix) with SMTP
	id 4A61D50B83; Fri, 13 Jun 2003 16:52:06 +0000 (GMT)
Date: Fri, 13 Jun 2003 18:53:03 +0200
From: tom hensel <tom@rpdnet.de>
To: Mike Matz <mike@pixor.net>
Subject: Re: [Dovecot] trouble with ssl
Message-Id: <20030613185303.2f050b84.tom@rpdnet.com>
In-Reply-To: <Pine.LNX.4.44.0306130840350.5217-100000@pixor.net>
References: <20030613105655.59fa385b.tom@replic8.net>
	<Pine.LNX.4.44.0306130840350.5217-100000@pixor.net>
X-Mailer: Sylpheed version 0.9.2 (GTK+ 1.2.10; i386--netbsdelf)
Mime-Version: 1.0
Content-Type: multipart/signed; protocol="application/pgp-signature";
 micalg="pgp-sha1"; boundary="=.1_Jd_pCF7Vq0pR"
X-Spam-Status: No, hits=-26.5 required=6.5
	tests=IN_REP_TO,PGP_SIGNATURE_2,QUOTED_EMAIL_TEXT,QUOTE_TWICE_1,
	      REFERENCES,REPLY_WITH_QUOTES
	version=2.53
X-Spam-Level: 
X-Spam-Checker-Version: SpamAssassin 2.53 (1.174.2.15-2003-03-30-exp)
X-Mailman-Approved-At: Sat, 14 Jun 2003 18:15:09 +0300
cc: tech-pkg@netbsd.org
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 13 Jun 2003 16:52:27 -0000
X-UID: 917                                                  
Status: O
Content-Length: 1552

--=.1_Jd_pCF7Vq0pR
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

mike,

> I had the same problem on FreeBSD 5.1-current.  If you search usenet, 
> you'll see that lots of people had problems with OpenSSL 0.9.7a.  I've 
> upgraded my OpenSSL on FreeBSD compiling the latest port (0.9.7b), and 
> recompiling Dovecot.  Everything works fine now.  I've also heard that 
> there is a similar problem with some of the 0.9.6 releases, but I think 
> that should also be fixed with the latest 0.9.6 sources.

nebtsd has a pkgsrc for openssl-0.9.6g -  it compiled just fine.
recompiling dovecot did not change anything, same error as before.
i'm ccing this mail to the maintainter of the pkgsrc, i wonder how
dovecot's configure decides wether to use the openssl-libs included
with netbsd's or the ones form pkgsrc...
 
> Hope this helps

yeah, thanks a lot ;)

> > i'm running dovecot 0.99.9.1 on netbsd-current - runs very fine
> > until i try to use sylpheed from my client to connect via ssl:
> > 
> > --snip--
> > Jun 13 08:48:32 devbox imap-login: SSL_accept() failed: error:1408F455:SSL routines:SSL3_GET_RECORD:decryption failed or bad record mac [192.168.100.88]
> > Jun 13 08:48:32 devbox imap-login: Disconnected [192.168.100.8
> > --snip--

bye,
TOM

--=.1_Jd_pCF7Vq0pR
Content-Type: application/pgp-signature

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.2 (NetBSD)

iD8DBQE+6gFyZj9fGW5yU88RAjVPAJ9VjIv3PsbmQd7tUJiVbxtaIrl5dQCeKnwz
nfTgbtHM85/aJVa9Z5J+vJA=
=Bf2/
-----END PGP SIGNATURE-----

--=.1_Jd_pCF7Vq0pR--
From tss@iki.fi  Sat Jun 14 18:19:14 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 67D3723865; Sat, 14 Jun 2003 18:19:14 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id A0CC12384C
	for <dovecot@procontrol.fi>; Sat, 14 Jun 2003 18:19:12 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id AB7565C896D9; Sat, 14 Jun 2003 18:19:08 +0300 (EEST)
Subject: Re: [Dovecot] Quotas once again
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <1055462990.19999.51.camel@rocket.innercite.com>
References: <1055462990.19999.51.camel@rocket.innercite.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1055603948.2371.36.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 14 Jun 2003 18:19:08 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Sat, 14 Jun 2003 15:19:14 -0000
X-UID: 918                                                  
Status: O

On Fri, 2003-06-13 at 03:09, Mike Machado wrote:
> Jun 12 17:02:49 newrook pop3(mike): open(/var/mail/mike.lock) failed:
> Disk quota exceeded

Can't really do much about this.

> Jun 12 17:02:49 newrook pop3: I/O leak: 0x8050930 (0)
> Jun 12 17:02:49 newrook pop3: I/O leak: 0x807baac (1)

Hmm. These shouldn't happen..

> Jun 12 16:45:33 newrook pop3(mike): file_set_size() failed with mbox
> file /var/mail/mike: Disk quota exceeded

This is because it tries to write message UIDs to the mbox file. This is
similiar problem to not being able to update maildir's dovecot-uidlist
file. I think I know how to fix it right, it just requires writing the
code..

From tss@iki.fi  Sat Jun 14 18:27:29 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 9090723860; Sat, 14 Jun 2003 18:27:29 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 9BAF32384C
	for <dovecot@procontrol.fi>; Sat, 14 Jun 2003 18:27:27 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 61E9C5C896D9; Sat, 14 Jun 2003 18:27:27 +0300 (EEST)
Subject: Re: [Dovecot] Debian and dovecot
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <001e01c330e8$86eb2850$080aa8c0@PAVILION>
References: <001e01c330e8$86eb2850$080aa8c0@PAVILION>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1055604446.2371.44.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 14 Jun 2003 18:27:27 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Sat, 14 Jun 2003 15:27:29 -0000
X-UID: 919                                                  
Status: O

On Thu, 2003-06-12 at 16:42, Spectron International, Inc. wrote:
> a) I don't want to create accounts for each user, can I have a mailboxes
> directory with the mailboxes of all the users? They are not many (10-15).

You'd need a directory for each user. Something like this should work:

auth_userdb = static uid=123 gid=123 home=/home/mail/%u

>     auth           required    pam_smb_auth.so
>     account     required    pam_smb_auth.so # there is no pam_smb_acct
>     password  required    pam_smb_auth.so # there is no pam_smb_passwd
>     session      required    pam_smb_auth.so # there is no pam_smb_session

I don't think you need password or session there. And maybe you could
have used pam_unix.so in account too. But I don't really remember what
all those PAM things did.

From tss@iki.fi  Sat Jun 14 18:29:13 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id CFCB82387A; Sat, 14 Jun 2003 18:29:13 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 5805E23860
	for <dovecot@procontrol.fi>; Sat, 14 Jun 2003 18:29:12 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 2DE665C896D9; Sat, 14 Jun 2003 18:29:12 +0300 (EEST)
Subject: Re: [Dovecot] Folder creation errors
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030611195033.GP17004@iridium.mv.net>
References: <20030611195033.GP17004@iridium.mv.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1055604551.2371.47.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 14 Jun 2003 18:29:11 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Sat, 14 Jun 2003 15:29:14 -0000
X-UID: 920                                                  
Status: O

On Wed, 2003-06-11 at 22:50, Mark E. Mallett wrote:
> i.e. I get "internal error" if there is no path component in the
> folder name.  Is this a problem?  I would guess that "internal error"
> is always a problem :-)

Yes .. And log file should show exactly what the error message is. I
guess you've some weird settings. :)

From tss@iki.fi  Sat Jun 14 18:33:30 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 4C7DA2387A; Sat, 14 Jun 2003 18:33:30 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 8D96923860
	for <dovecot@procontrol.fi>; Sat, 14 Jun 2003 18:33:28 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 541E25C896D9; Sat, 14 Jun 2003 18:33:28 +0300 (EEST)
Subject: Re: [Dovecot] Dovecot configuration with passwd-file
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <001501c331d5$b15f8c50$080aa8c0@PAVILION>
References: <001501c331d5$b15f8c50$080aa8c0@PAVILION>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1055604808.2371.51.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 14 Jun 2003 18:33:28 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Sat, 14 Jun 2003 15:33:30 -0000
X-UID: 921                                                  
Status: O

On Fri, 2003-06-13 at 21:00, Spectron International, Inc. wrote:
> default_mail_env = maildir:/opt/mail/%u
> auth_userdb = passwd-file /etc/passwd.imap
> auth_passdb = passwd-file /etc/passwd.imap
> auth_verbose = yes
> 
> It gives me the following error (I hoped it would be more verbose than
> this):
> 
> Internal login failure: f_rojas [192.168.10.4].

Hmm. It should have been more verbose. "Internal login failure" anyway
means that the password check went ok, but IMAP process couldn't be
started for some reason.

> passwd.imap exists, the user and password are ok What am I missing?

Did you also add UID, GID and home directories there? UID and GID are a
must there, I'm not sure if home directory was.

From tss@iki.fi  Sat Jun 14 18:35:52 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 505342387A; Sat, 14 Jun 2003 18:35:52 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id C31B623860
	for <dovecot@procontrol.fi>; Sat, 14 Jun 2003 18:35:49 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 96AD95C896D9; Sat, 14 Jun 2003 18:35:49 +0300 (EEST)
Subject: Re: [Dovecot] squirrelmail setup
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <3EDE460C.40700@konts.lv>
References: <3EDB5D17.1050902@konts.lv> <1054744863.8869.7.camel@hurina>
	 <3EDE460C.40700@konts.lv>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1055604949.2373.55.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 14 Jun 2003 18:35:49 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Sat, 14 Jun 2003 15:35:52 -0000
X-UID: 922                                                  
Status: O

On Wed, 2003-06-04 at 22:18, Gasha wrote:
> Strange, but it worked that way. At least with netscape.
> In the beginning i set up INBOX + mbox.
> then renamed mail/ to oldmail/
> and did "mkdir Maildir".

Netscape was probably just caching the old INBOX contents locally.

From tss@iki.fi  Sat Jun 14 18:44:50 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id E50322387A; Sat, 14 Jun 2003 18:44:50 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 524B123860
	for <dovecot@procontrol.fi>; Sat, 14 Jun 2003 18:44:49 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 3B17A5C896D9; Sat, 14 Jun 2003 18:44:45 +0300 (EEST)
Subject: Re: [Dovecot] --enable-debug bug?
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <3EDB8C10.8010904@konts.lv>
References: <3EDB8C10.8010904@konts.lv>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1055605484.2363.64.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 14 Jun 2003 18:44:45 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Sat, 14 Jun 2003 15:44:51 -0000
X-UID: 923                                                  
Status: O

On Mon, 2003-06-02 at 20:40, Gasha wrote:
> Hello all,
> 
> when i'm bulding rpm with --enable-debug get this:

Well, you probably shouldn't really :) It only enables some extra checks
which slows it down.

> Jun  2 20:41:15 mezgls dovecot: child 9409 (login) killed with signal 11

Strange though, I'm using debug myself all the time.

Login processes are annoying to debug anyway. Pretty much the only way
to do so is to run dovecot under one user, eg. foo which requires at
least following settings: 

login_user = foo
login_chroot = no
imap_listen = *:12345

Then start "dovecot" as user foo and you should get a core dump which
can be gdb'd.

From tss@iki.fi  Sat Jun 14 18:50:43 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id A4B0223860; Sat, 14 Jun 2003 18:50:43 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 0D4132384C
	for <dovecot@procontrol.fi>; Sat, 14 Jun 2003 18:50:42 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id BFFF25C896D9; Sat, 14 Jun 2003 18:50:41 +0300 (EEST)
Subject: Re: [Dovecot] Re: DRAC support?
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030605005203.GA3437@dust.uchicago.edu>
References: <20030529010911.GA19139@lazy.spodder.com>
	<1054252379.23632.381.camel@hurina>
	<20030530002537.GA1552@lazy.spodder.com>
	<1054258989.23632.400.camel@hurina>
	<20030530020518.GG1552@lazy.spodder.com>
	<1054261073.19156.413.camel@hurina>
	<20030530041118.GK1552@lazy.spodder.com>
	<1054295941.23632.447.camel@hurina><1054745460.8867.20.camel@hurina>
	<20030605005203.GA3437@dust.uchicago.edu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1055605841.2364.70.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 14 Jun 2003 18:50:41 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Sat, 14 Jun 2003 15:50:43 -0000
X-UID: 924                                                  
Status: O

On Thu, 2003-06-05 at 03:52, David Champion wrote:
> I'm really, honestly, truly talking about a no-added-bloat approach. I'm
> just asking for configure to add a cc/ld for drac.so to the Makefile, if
> you specify --enable-drac.

Well, for plugins in general I guess it could be good idea to be able to
compile them easily. But I don't want to include the actual plugins, or
anything specific to one plugin with the main dovecot package. Maybe
something like --with-plugins=drac and it could find it from somewhere..
But it's not really important yet. DRAC plugin is special in the case
that you don't have to compile it more than once. It uses only few
dovecot functions which are unlikely to ever change, so you don't have
to recompile it when building a new version of dovecot.

From tss@iki.fi  Sat Jun 14 19:03:31 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id A118923860; Sat, 14 Jun 2003 19:03:31 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id F33FD2384C
	for <dovecot@procontrol.fi>; Sat, 14 Jun 2003 19:03:29 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id B44D05C896D9; Sat, 14 Jun 2003 19:03:29 +0300 (EEST)
Subject: Re: [Dovecot] Re: mkdir {cur,tmp,new}?
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.44.0306041402550.23276-100000@vegemite.nssg.mitel.com>
References: 
	 <Pine.LNX.4.44.0306041402550.23276-100000@vegemite.nssg.mitel.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1055606609.2371.84.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 14 Jun 2003 19:03:29 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Sat, 14 Jun 2003 16:03:31 -0000
X-UID: 925                                                  
Status: O
Content-Length: 1422

On Wed, 2003-06-04 at 21:07, Charlie Brady wrote:
> > > I would interpret any of cur, new and tmp being missing as "mailbox does 
> > > not exist".
> > 
> > Well, maybe. I was just thinking cases when a DELETE died in the middle
> > of it, and left only some of the dirs there. In that case you couldn't
> > then SELECT/APPEND the mailbox, but I guess you could DELETE it again..

Actually, this can't happen. Dovecot does atomic maildir deletion by
renaming the ".mailbox" into "..mailbox" which is then deleted.

> Can you DELETE a mailbox which doesn't exist?
> 
> If a DELETE dies in the middle, and the maildir isn't complete, then by my
> definition (and I'd claim, logically) the mailbox does not exist. If a
> mailbox doesn't exist, you can SELECT/APPEND or DELETE. But it shouldn't
> appear in a LIST, and you must be able to CREATE.

That'd be pretty broken. If mailbox doesn't exist, you can't select or
delete it. Most clients wouldn't even let you try.

> > Or maybe rather Dovecot should just create those dirs when it notices
> > they don't exist while trying to use them.
> 
> I think a maildir must be complete to exist. Hence it's wrong to "by 
> stealth" convert a partial maildir to a complete one.

Well, what harm could it cause?

> > I like to be able to create new mailboxes with "mkdir .boxname".
> 
> Shouldn't that be "CREATE boxname"? :-)

Easier to play with filesystem directly when testing.

From mem@mv.mv.com  Sat Jun 14 19:43:44 2003
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id CAB6A23865; Sat, 14 Jun 2003 19:43:44 +0300 (EEST)
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id 8464D23860
	for <dovecot@procontrol.fi>; Sat, 14 Jun 2003 19:43:41 +0300 (EEST)
Received: (qmail 22624 invoked by uid 101); 14 Jun 2003 12:43:28 -0400
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Sat, 14 Jun 2003 12:43:28 -0400
To: Timo Sirainen <tss@iki.fi>
Subject: Re: [Dovecot] Folder creation errors
Message-ID: <20030614164328.GA3063@iridium.mv.net>
References: <20030611195033.GP17004@iridium.mv.net>
	<1055604551.2371.47.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1055604551.2371.47.camel@hurina>
User-Agent: Mutt/1.4.1i
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Sat, 14 Jun 2003 16:43:45 -0000
X-UID: 926                                                  
Status: O

On Sat, Jun 14, 2003 at 06:29:11PM +0300, Timo Sirainen wrote:
> On Wed, 2003-06-11 at 22:50, Mark E. Mallett wrote:
> > i.e. I get "internal error" if there is no path component in the
> > folder name.  Is this a problem?  I would guess that "internal error"
> > is always a problem :-)
> 
> Yes .. And log file should show exactly what the error message is. I
> guess you've some weird settings. :)

Jun 14 12:21:09 iridium mem[118]: imap(dummydummy): mkdir_parents(/usr2/users/username/) failed: Is a directory

dovecot.conf has:

default_mail_env = mbox:~/:INBOX=%h/Mailbox

Probably not so much a weird setting as a weird artifact in BSD/OS:

    mkdir x
    mkdir x
       returns EEXIST
    mkdir x/
       returns EISDIR

This is a long-standing thorn..

if I change mkdir-parents.c to check for EISDIR as well as EEXIST it
fixes the problem.  Can you add that to the official version?

Sorry for not checking that myself.

-mm-
From tss@iki.fi  Sat Jun 14 20:21:30 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id D936823860; Sat, 14 Jun 2003 20:21:30 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 27FE02384C
	for <dovecot@procontrol.fi>; Sat, 14 Jun 2003 20:21:29 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id F22525C896D9; Sat, 14 Jun 2003 20:21:28 +0300 (EEST)
Subject: Re: [Dovecot] Folder creation errors
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030614164328.GA3063@iridium.mv.net>
References: <20030611195033.GP17004@iridium.mv.net>
	<20030614164328.GA3063@iridium.mv.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1055611288.2363.89.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 14 Jun 2003 20:21:28 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Sat, 14 Jun 2003 17:21:31 -0000
X-UID: 927                                                  
Status: O

On Sat, 2003-06-14 at 19:43, Mark E. Mallett wrote:
>     mkdir x
>        returns EEXIST
>     mkdir x/
>        returns EISDIR
> 
> This is a long-standing thorn..
> 
> if I change mkdir-parents.c to check for EISDIR as well as EEXIST it
> fixes the problem.  Can you add that to the official version?

Actually it shouldn't be adding the extra '/' at the end, that seems to
be fixed in CVS already. But I'll add the EISDIR check there anyway.

From tss@iki.fi  Sat Jun 14 20:40:18 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id EA9F023887; Sat, 14 Jun 2003 20:40:18 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 5A02323860
	for <dovecot@procontrol.fi>; Sat, 14 Jun 2003 20:40:15 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 14E7B5C896D9; Sat, 14 Jun 2003 20:40:15 +0300 (EEST)
Subject: Re: [Dovecot] Deleting NFS-mounted Maildir subfolders fails
From: Timo Sirainen <tss@iki.fi>
To: Christian Ehrhardt <ehrhardt@mathematik.uni-ulm.de>
In-Reply-To: <20030612123410.14103.qmail@thales.mathematik.uni-ulm.de>
References: <20030612123410.14103.qmail@thales.mathematik.uni-ulm.de>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1055612414.2371.91.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 14 Jun 2003 20:40:14 +0300
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Sat, 14 Jun 2003 17:40:19 -0000
X-UID: 928                                                  
Status: O

On Thu, 2003-06-12 at 15:34, Christian Ehrhardt wrote:
> Almost everything's fine but I can't delete maildir subfolders if these
> reside on a non local NFS-directory. The reason given is that the directory
> isn't empty and hence can't be deleted.

I think it's fixed now in CVS.

From tss@iki.fi  Sat Jun 14 20:44:37 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id BA2AD23887; Sat, 14 Jun 2003 20:44:37 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 4F01B23860
	for <dovecot@procontrol.fi>; Sat, 14 Jun 2003 20:44:36 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 286215C896D9; Sat, 14 Jun 2003 20:44:36 +0300 (EEST)
Subject: Re: [Dovecot] bug in search?  (fwd)
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030611193027.GL17004@iridium.mv.net>
References: <20030611193027.GL17004@iridium.mv.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1055612675.2371.94.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 14 Jun 2003 20:44:36 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Sat, 14 Jun 2003 17:44:37 -0000
X-UID: 929                                                  
Status: O

On Wed, 2003-06-11 at 22:30, Mark E. Mallett wrote:
> > If all messages are marked for deletion, the following command returns
> > an empty list:
> >   SEARCH DELETED

Right, small optimization bug :)

From tss@iki.fi  Sun Jun 15 06:58:09 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 1451D23865; Sun, 15 Jun 2003 06:58:09 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id D41CA2384C
	for <dovecot@procontrol.fi>; Sun, 15 Jun 2003 06:58:04 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 3BAEA5C2BB8D; Sun, 15 Jun 2003 06:58:04 +0300 (EEST)
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1055649482.10262.17.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 15 Jun 2003 06:58:03 +0300
Subject: [Dovecot] 0.99.10-test12
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Sun, 15 Jun 2003 03:58:09 -0000
X-UID: 930                                                  
Status: O
Content-Length: 1235

http://dovecot.procontrol.fi/test/

I should have released 0.99.10 already I think.. There's just two
annoying problems that I think should be fixed first:

- PAM: If user gives a wrong password, dovecot-auth process sleeps for
two seconds, blocking everyone else who are trying to authenticate at
the time. So using PAM isn't very good idea at the moment.

- OpenSSL problems. Are they really my fault? I have no idea what I
could be doing wrong. Maybe some compile option is wrong? Also I should
try to use pkg-config to get compile flags if it exists in configure.

The new things in -test12 then:

- We sync mailbox less often. Only NOOP and CHECK will force a mailbox
sync now. Other commands do it also but only if mailbox hasn't been
synced in last 5 seconds. Maybe this reduces some I/O. At least a bit
less stat() calls :)

- Dirty maildir flag flushing work now. Meaning that if you change
message flags but rename() fails because you're out of quota, the flags
are changed in index file and dirty-flag is set. Once in a while it
tries to flush the dirty flags by rename()ing the file again.

- IMAP RFC requires that NUL characters are never sent to client. We do
now the same as UW-IMAP by sending ascii 128 chars instead.

From lfarkas@bnap.hu  Sun Jun 15 12:58:33 2003
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 5039923865; Sun, 15 Jun 2003 12:58:33 +0300 (EEST)
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 8398D2384C
	for <dovecot@procontrol.fi>; Sun, 15 Jun 2003 12:58:30 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id BC4E975402B
	for <dovecot@procontrol.fi>; Sun, 15 Jun 2003 11:58:10 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP
	id B2B2C3EB4; Sun, 15 Jun 2003 11:58:27 +0200 (CEST)
Received: from bnap.hu (garfield.int.bppiac.hu [192.168.0.50])
	by mail2.bppiac.hu (Postfix) with ESMTP id 978553EB0
	for <dovecot@procontrol.fi>; Sun, 15 Jun 2003 11:58:27 +0200 (CEST)
Message-ID: <3EEC4343.8050702@bnap.hu>
Date: Sun, 15 Jun 2003 11:58:27 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.3) Gecko/20030313
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
Subject: [Dovecot] a new error message
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Sun, 15 Jun 2003 09:58:33 -0000
X-UID: 931                                                  
Status: O

hi,
we've got the following error:
---------
The current command did not succeed. The mail server responded: Error in 
IMAP command UID: Too long argument.."
---------

-- 
   Levente                               "Si vis pacem para bellum!"


From mem@mv.mv.com  Sun Jun 15 13:54:30 2003
Return-Path: <mem@mv.mv.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 51CF12387A; Sun, 15 Jun 2003 13:54:30 +0300 (EEST)
Received: from mv.mv.com (iridium.mv.net [199.125.85.17])
	by danu.procontrol.fi (Postfix) with SMTP id 743D423860
	for <dovecot@procontrol.fi>; Sun, 15 Jun 2003 13:54:26 +0300 (EEST)
Received: (qmail 17477 invoked by uid 101); 15 Jun 2003 06:54:25 -0400
From: "Mark E. Mallett" <mem@mv.mv.com>
Date: Sun, 15 Jun 2003 06:54:25 -0400
To: Timo Sirainen <tss@iki.fi>
Subject: Re: [Dovecot] 0.99.10-test12
Message-ID: <20030615105425.GA9332@iridium.mv.net>
References: <1055649482.10262.17.camel@hurina>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <1055649482.10262.17.camel@hurina>
User-Agent: Mutt/1.4.1i
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Sun, 15 Jun 2003 10:54:30 -0000
X-UID: 932                                                  
Status: O


src/lib/ioloop-select.c accesses a variable io_p that is not defined
or declared.  I assume you need to add **io_p to the struct io
defines in that routine.

mm
From ola@garstad.net  Sun Jun 15 15:56:13 2003
Return-Path: <ola@garstad.net>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id A3AA323865; Sun, 15 Jun 2003 15:56:13 +0300 (EEST)
Received: from mail44.fg.online.no (mail44-s.fg.online.no [148.122.161.44])
	by danu.procontrol.fi (Postfix) with ESMTP id BAD942384C
	for <dovecot@procontrol.fi>; Sun, 15 Jun 2003 15:56:10 +0300 (EEST)
Received: from pilt.home.garstad.net (ti221110a080-3586.bb.online.no
	[80.213.14.2])
	by mail44.fg.online.no (8.9.3p2/8.9.3) with ESMTP id OAA06244
	for <dovecot@procontrol.fi>; Sun, 15 Jun 2003 14:56:09 +0200 (MEST)
Received: from gorgon (gorgon.home.garstad.net [192.168.1.22])
	by pilt.home.garstad.net (Postfix) with SMTP id 3FF079077A
	for <dovecot@procontrol.fi>; Sun, 15 Jun 2003 14:56:07 +0200 (CEST)
Message-ID: <003401c3333d$79334290$1601a8c0@gorgon>
From: "Ola Garstad" <ola@garstad.net>
To: <dovecot@procontrol.fi>
Date: Sun, 15 Jun 2003 14:55:55 +0200
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2800.1158
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2800.1165
Subject: [Dovecot] Dovecot will not run on secure kernel.
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Sun, 15 Jun 2003 12:56:13 -0000
X-UID: 933                                                  
Status: O

I am trying to run Dovecot on RH 7.3 with Linux kernel 2.4.20 + =
GrSecurity patch.
I downloaded the RPM yesterday and installed it.

When I start Dovecot the kernel reports: kernel: grsec: From =
192.168.1.22: attempt to overstep process limit by (dovecot:14491) =
UID(0) EUID(0), parent (dovecot:23872) UID(0) EUID(0)

I have never seen this problem in the 3 years I have used GrSecurity =
together with a lot of programs.

GrSecurity explains: "Enforce RLIMIT_NPROC on execs. Users with a =
resource limit on processes will have the value checked during execve() =
calls. The current system only checks the system limit during fork() =
calls."

Any ideas why Dovecot causes this problem?

--
Ola


From jello@waste.org  Sun Jun 15 20:12:01 2003
Return-Path: <jello@waste.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 2DB6223865; Sun, 15 Jun 2003 20:12:01 +0300 (EEST)
Received: from waste.org (waste.org [209.173.204.2])
	by danu.procontrol.fi (Postfix) with ESMTP id B1A0E2384C
	for <dovecot@procontrol.fi>; Sun, 15 Jun 2003 20:11:58 +0300 (EEST)
Received: from localhost (pppdslc114.mpls.uswest.net [216.160.21.114])
	by waste.org (8.12.3/8.12.3/Debian-6.4) with ESMTP id h5FHBpCE009488;
	Sun, 15 Jun 2003 12:11:53 -0500
Received: by localhost (Postfix, from userid 1001)
	id AD37C51C01F; Sun, 15 Jun 2003 12:11:50 -0500 (CDT)
Date: Sun, 15 Jun 2003 12:11:50 -0500
From: John Ello <jello@waste.org>
To: Farkas Levente <lfarkas@bnap.hu>
Subject: Re: [Dovecot] a new error message
Message-ID: <20030615171150.GB696@waste.org>
References: <3EEC4343.8050702@bnap.hu>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <3EEC4343.8050702@bnap.hu>
User-Agent: Mutt/1.5.4i
cc: Dovecot List <dovecot@procontrol.fi>
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Sun, 15 Jun 2003 17:12:01 -0000
X-UID: 934                                                  
Status: O

On Sun, Jun 15, 2003 at 11:58:27AM +0200, Farkas Levente wrote:
> The current command did not succeed. The mail server responded: Error in 
> IMAP command UID: Too long argument.."

I used to get the same thing (some of my users have rather large
mailboxes), and I found you can get around it by editing the line that
begins '#define MAX_INBUF_SIZE ' in src/imap/client.c to a bigger
number and recompiling. I'm not sure the purpose of the limit, or the
complete effects of changing it, but it worked for me.
From wouter@pair.com  Mon Jun 16 05:28:32 2003
Return-Path: <wouter@pair.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 2887323865; Mon, 16 Jun 2003 05:28:32 +0300 (EEST)
Received: from amsfep16-int.chello.nl (amsfep16-int.chello.nl [213.46.243.26])
	by danu.procontrol.fi (Postfix) with ESMTP id 229782384C
	for <dovecot@procontrol.fi>; Mon, 16 Jun 2003 05:28:29 +0300 (EEST)
Received: from hibernate.cryolabs.net ([213.132.150.78])
	by amsfep16-int.chello.nlSMTP
	<20030616022828.TOBI28742.amsfep16-int.chello.nl@hibernate.cryolabs.net>
	for <dovecot@procontrol.fi>; Mon, 16 Jun 2003 04:28:28 +0200
Received: (qmail 25629 invoked from network); 16 Jun 2003 04:28:26 +0200
Received: from unknown (HELO cocaine.cryolabs.net) (192.168.196.5)
  by hibernate.cryolabs.net with SMTP; 16 Jun 2003 04:28:26 +0200
Date: Mon, 16 Jun 2003 04:28:36 +0200 (CEST)
From: Wouter Van Hemel <wouter@pair.com>
Sender: Wouter Van Hemel <wouter@pair.com>
To: dovecot@procontrol.fi
Message-ID: <Pine.LNX.4.56.0306160000150.541@cocaine.cryolabs.net>
PGP: 0B B4 BC 28 53 62 FE 94  6A 57 EE B8 A6 E2 1B E4  (0xAA5412F0)
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
Subject: [Dovecot] crash on LIST command
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 16 Jun 2003 02:28:32 -0000
X-UID: 935                                                  
Status: O
Content-Length: 3221


Hello,

I'm experiencing a reproducable crash in the imap daemon of dovecot
0.99.9.1 when running the next commands (sniffed from a sylpheed session):

[cocaine:~] telnet ice 143
Trying 192.168.196.1...
Connected to ice.
Escape character is '^]'.
* OK dovecot ready.
1 NOOP
1 OK NOOP completed.
2 LOGIN wouter password
2 OK Logged in.
3 NAMESPACE
3 BAD Error in IMAP command: Unknown command 'NAMESPACE'
4 LIST "" ""
* LIST (\Noselect) "/" ""
4 OK List completed.
5 LIST "" "%"
Connection closed by foreign host.
[cocaine:~] _

The log shows this:

Jun 16 02:48:09 ice imap-login: Login: wouter [192.168.196.5]
Jun 16 02:48:19 ice dovecot: child 1870 (imap) killed with signal 11

Looks like a segfault.

[...]
Core was generated by `imap'.
Program terminated with signal 11, Segmentation fault.
Reading symbols from /usr/lib/libc.so.4...done.
Reading symbols from /usr/libexec/ld-elf.so.1...done.
#0  0x8058469 in mbox_list_inbox (ctx=0x8098080) at mbox-list.c:333
333		if (ctx->dir->virtual_path != NULL)
(gdb) bt
#0  0x8058469 in mbox_list_inbox (ctx=0x8098080) at mbox-list.c:333
#1  0x805809e in mbox_list_mailbox_next (ctx=0x8098080) at mbox-list.c:193
#2  0x804b75a in list_unsorted (client=0x8096080, ctx=0x8098080,
reply=0x807ed06 "LIST", sep=0xbfbffac4 "/", listext=0) at cmd-list.c:234
#3  0x804b9fa in _cmd_list_full (client=0x8096080, lsub=0) at
cmd-list.c:341
#4  0x804ba8b in cmd_list (client=0x8096080) at cmd-list.c:365
#5  0x804d39e in client_handle_input (client=0x8096080) at client.c:306
#6  0x804d43d in _client_input (context=0x8096080) at client.c:342
#7  0x8078c87 in io_loop_handler_run (ioloop=0x808d060) at
ioloop-poll.c:210
#8  0x8078745 in io_loop_run (ioloop=0x808d060) at ioloop.c:295
#9  0x80524a9 in main (argc=1, argv=0xbfbffc2c, envp=0xbfbffc34) at
main.c:166
#10 0x8049eb5 in _start ()
(gdb) _

This crash happens when adding an imap account to the sylpheed mailer.


I also noticed other problematic log entries, which might or might not be
related:

Jun 16 00:28:36 ice imap-login: Login: wouter [192.168.196.5]
Jun 16 00:28:36 ice imap(wouter): open() failed with file /usr/home/wouter/.mail/.imap/INBOX/.customflags: No such file or directory
Jun 16 00:28:36 ice imap(wouter): Can't create temp index /usr/home/wouter/.mail/.imap/INBOX/.temp.hostname.domainname.tld.1728: No such file or directory

... this happens when an imap user connects and opens his/her INBOX for
the first time, and the /usr/home/username/.mail/ directory doesn't exist yet.

My DEFAULT_MAIL_ENV settings:

#default_mail_env = mbox:~/.mail:INBOX=/var/mail/%u
default_mail_env = mbox:/usr/home/%u/.mail:INBOX=/var/mail/%u

(tried both)

Manually adding the ~/.mail directory with mkdir takes care of the
problem, but shouldn't this directory be created automatically when it
doesn't exist? I can't expect every user to log in and first make this
mail directory before they can use their mail account.

Dovecot also refuses to show any folders at all, such as the INBOX, when
it can't find it's mail(folders) directory. Is this intentional?

Dovecot is running on a pretty standard (i386) FreeBSD 4.4 test machine
with postfix and normal mbox-formatted inbox files.


Thanks for any suggestions,

  wouter

From mike@skew.org  Mon Jun 16 08:11:33 2003
Return-Path: <mike@skew.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id ACEC323865; Mon, 16 Jun 2003 08:11:33 +0300 (EEST)
Received: from chilled.skew.org (skew.org [65.101.207.237])
	by danu.procontrol.fi (Postfix) with ESMTP id 8A0802384C
	for <dovecot@procontrol.fi>; Mon, 16 Jun 2003 08:11:29 +0300 (EEST)
Received: from chilled.skew.org (localhost.skew.org [127.0.0.1])
	by chilled.skew.org (8.12.6p2/8.12.7) with ESMTP id h5G5BSaB034666
	for <dovecot@procontrol.fi>; Sun, 15 Jun 2003 23:11:28 -0600 (MDT)
	(envelope-from mike@chilled.skew.org)
Received: (from mike@localhost)
	by chilled.skew.org (8.12.6p2/8.12.7/Submit) id h5G5BSJs034665
	for dovecot@procontrol.fi; Sun, 15 Jun 2003 23:11:28 -0600 (MDT)
From: Mike Brown <mike@skew.org>
Message-Id: <200306160511.h5G5BSJs034665@chilled.skew.org>
To: dovecot@procontrol.fi
Date: Sun, 15 Jun 2003 23:11:28 -0600 (MDT)
X-Whoa: whoa.
X-Mailer: ELM [version 2.4ME+ PL90 (25)]
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Content-Type: text/plain; charset=US-ASCII
X-Spam-Status: No, hits=0.8 required=5.0
	tests=SPAM_PHRASE_00_01
	version=2.43
Subject: [Dovecot] more newline related errors
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 16 Jun 2003 05:11:33 -0000
X-UID: 936                                                  
Status: O
Content-Length: 1859

Should I be concerned about these errors?

imap(msun): Jun 13 13:21:38 Error: Error indexing mbox file /home/msun/mail/Deleted Messages: LF not found where expected
imap(msun): Jun 13 13:39:08 Error: Corrupted binary tree for index /home/msun/mail/.imap/INBOX/.imap.index: lookup returned index outside range (1 >= 0)
imap(msun): Jun 13 13:44:07 Error: IndexID mismatch for binary tree file /home/msun/mail/.imap/INBOX/.imap.index.tree
imap(msun): Jun 13 13:44:07 Error: IndexID mismatch for binary tree file /home/msun/mail/.imap/INBOX/.imap.index.tree
imap(msun): Jun 13 13:44:07 Error: IndexID mismatch for modify log file /home/msun/mail/.imap/INBOX/.imap.index.log
imap(msun): Jun 14 12:07:42 Error: Error indexing mbox file /home/msun/Mailbox: LF not found where expected
imap(msun): Jun 14 12:08:27 Error: Corrupted index file /home/msun/mail/.imap/INBOX/.imap.index: Sequence 1 not found from binary tree (1 msgs says header)
imap(msun): Jun 14 12:08:27 Error: Corrupted index file /home/msun/mail/.imap/INBOX/.imap.index: Sequence 1 not found from binary tree (1 msgs says header)
imap(msun): Jun 14 12:08:27 Error: Corrupted index file /home/msun/mail/.imap/INBOX/.imap.index: Sequence 1 not found from binary tree (1 msgs says header)
imap(msun): Jun 14 12:14:23 Error: IndexID mismatch for binary tree file /home/msun/mail/.imap/INBOX/.imap.index.tree
imap(msun): Jun 14 12:14:23 Error: IndexID mismatch for binary tree file /home/msun/mail/.imap/INBOX/.imap.index.tree
imap(msun): Jun 14 12:14:23 Error: IndexID mismatch for modify log file /home/msun/mail/.imap/INBOX/.imap.index.log
imap(msun): Jun 15 11:34:58 Error: Error indexing mbox file /home/msun/Mailbox: LF not found where expected

There was a patch required for the POP3 server to read mbox files that did not
precede "From " lines with a blank line. Perhaps this is related?

Thanks
From cirvis@konts.lv  Mon Jun 16 09:45:49 2003
Return-Path: <cirvis@konts.lv>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id AA86223865; Mon, 16 Jun 2003 09:45:49 +0300 (EEST)
Received: from card.konts.lv (card.konts.lv [159.148.139.17])
	by danu.procontrol.fi (Postfix) with ESMTP id 3129F2384C
	for <dovecot@procontrol.fi>; Mon, 16 Jun 2003 09:45:46 +0300 (EEST)
Received: (from daemon@localhost)
	by card.konts.lv (8.11.6/8.11.6) id h5G6fbf25302
	for <dovecot@procontrol.fi>; Mon, 16 Jun 2003 09:41:37 +0300
Received: from <cirvis@konts.lv> (gugu.konts.lv [10.10.1.171]) by
	card.konts.lv via smap (V2.1)
	id xma024910; Mon, 16 Jun 03 09:41:21 +0300
Message-ID: <3EED674B.4080800@konts.lv>
Date: Mon, 16 Jun 2003 09:44:27 +0300
From: Gasha <cirvis@konts.lv>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US;
	rv:0.9.4.1) Gecko/20020508 Netscape6/6.2.3
X-Accept-Language: en-us
MIME-Version: 1.0
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] more newline related errors
References: <200306160511.h5G5BSJs034665@chilled.skew.org>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-Spam-Status: No, hits=-28.4 required=6.0
	tests=AWL,BAYES_01,EMAIL_ATTRIBUTION,QUOTED_EMAIL_TEXT,
	      REFERENCES,REPLY_WITH_QUOTES,USER_AGENT_MOZILLA_UA
	autolearn=ham version=2.52
X-Spam-Level: 
X-Spam-Checker-Version: SpamAssassin 2.52 (1.174.2.8-2003-03-24-exp)
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 16 Jun 2003 06:45:49 -0000
X-UID: 937                                                  
Status: O
Content-Length: 1994

Try to delete index files.
Or maybe it is corrupted mail file?

Gasha

Mike Brown wrote:

> Should I be concerned about these errors?
> 
> imap(msun): Jun 13 13:21:38 Error: Error indexing mbox file /home/msun/mail/Deleted Messages: LF not found where expected
> imap(msun): Jun 13 13:39:08 Error: Corrupted binary tree for index /home/msun/mail/.imap/INBOX/.imap.index: lookup returned index outside range (1 >= 0)
> imap(msun): Jun 13 13:44:07 Error: IndexID mismatch for binary tree file /home/msun/mail/.imap/INBOX/.imap.index.tree
> imap(msun): Jun 13 13:44:07 Error: IndexID mismatch for binary tree file /home/msun/mail/.imap/INBOX/.imap.index.tree
> imap(msun): Jun 13 13:44:07 Error: IndexID mismatch for modify log file /home/msun/mail/.imap/INBOX/.imap.index.log
> imap(msun): Jun 14 12:07:42 Error: Error indexing mbox file /home/msun/Mailbox: LF not found where expected
> imap(msun): Jun 14 12:08:27 Error: Corrupted index file /home/msun/mail/.imap/INBOX/.imap.index: Sequence 1 not found from binary tree (1 msgs says header)
> imap(msun): Jun 14 12:08:27 Error: Corrupted index file /home/msun/mail/.imap/INBOX/.imap.index: Sequence 1 not found from binary tree (1 msgs says header)
> imap(msun): Jun 14 12:08:27 Error: Corrupted index file /home/msun/mail/.imap/INBOX/.imap.index: Sequence 1 not found from binary tree (1 msgs says header)
> imap(msun): Jun 14 12:14:23 Error: IndexID mismatch for binary tree file /home/msun/mail/.imap/INBOX/.imap.index.tree
> imap(msun): Jun 14 12:14:23 Error: IndexID mismatch for binary tree file /home/msun/mail/.imap/INBOX/.imap.index.tree
> imap(msun): Jun 14 12:14:23 Error: IndexID mismatch for modify log file /home/msun/mail/.imap/INBOX/.imap.index.log
> imap(msun): Jun 15 11:34:58 Error: Error indexing mbox file /home/msun/Mailbox: LF not found where expected
> 
> There was a patch required for the POP3 server to read mbox files that did not
> precede "From " lines with a blank line. Perhaps this is related?
> 
> Thanks
> 


From bob@snigger.bogus  Mon Jun 16 09:56:18 2003
Return-Path: <bob@snigger.bogus>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id CAD8523865; Mon, 16 Jun 2003 09:56:18 +0300 (EEST)
Received: from cemetery.homeunix.org
	(host217-44-114-6.range217-44.btcentralplus.com [217.44.114.6])
	by danu.procontrol.fi (Postfix) with ESMTP id F20462384C
	for <dovecot@procontrol.fi>; Mon, 16 Jun 2003 09:56:16 +0300 (EEST)
Received: from snigger.bogus (bob@localhost.bogus [127.0.0.1])
	by cemetery.homeunix.org (8.12.9/8.12.9) with ESMTP id h5G6uRjr003813;
	Mon, 16 Jun 2003 07:56:27 +0100 (BST)
Received: (from bob@localhost)
	by snigger.bogus (8.12.9/8.12.6/Submit) id h5G6uQh8001847;
	Mon, 16 Jun 2003 07:56:26 +0100 (BST)
Date: Mon, 16 Jun 2003 07:56:26 +0100
From: Andrew Basterfield <bob@cemetery.homeunix.org>
To: Wouter Van Hemel <wouter@pair.com>
Subject: Re: [Dovecot] crash on LIST command
Message-ID: <20030616065625.GA25522@snigger.flatnet>
References: <Pine.LNX.4.56.0306160000150.541@cocaine.cryolabs.net>
Mime-Version: 1.0
Content-Type: multipart/signed; micalg=pgp-sha1;
	protocol="application/pgp-signature"; boundary="8t9RHnE3ZwKMSgU+"
Content-Disposition: inline
In-Reply-To: <Pine.LNX.4.56.0306160000150.541@cocaine.cryolabs.net>
User-Agent: Mutt/1.4.1i
X-Operating-System: OpenBSD snigger 3.3 sparc64 SUNW,UltraSPARC-IIi @ 269.842
	MHz, version 0 FPU
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 16 Jun 2003 06:56:19 -0000
X-UID: 938                                                  
Status: O
Content-Length: 1066


--8t9RHnE3ZwKMSgU+
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable

On Mon, Jun 16, 2003 at 04:28:36AM +0200, Wouter Van Hemel wrote:
>=20
> Hello,
>=20
> Manually adding the ~/.mail directory with mkdir takes care of the
> problem, but shouldn't this directory be created automatically when it
> doesn't exist? I can't expect every user to log in and first make this
> mail directory before they can use their mail account.

I use procmail to create the directory on delivery of first item of mail

DROPPRIVS=3Dyes
MAILDIR=3D$HOME/Mail
DEFAULT=3D$MAILDIR/./

DUMMY=3D`if [ ! -d $MAILDIR ]; then mkdir $MAILDIR; fi`

--Andrew

--=20
If at first you don't succeed, destroy all evidence that you tried.

--8t9RHnE3ZwKMSgU+
Content-Type: application/pgp-signature
Content-Disposition: inline

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.1 (OpenBSD)

iD8DBQE+7WoXj3ZMDwYLJGARAhcIAJ9nGjnzYAQUP4lCeqrZGvXKrSNB+gCfblO2
nZWgnQlNag1Og1XRUIZfzJ0=
=F1fh
-----END PGP SIGNATURE-----

--8t9RHnE3ZwKMSgU+--
From tss@iki.fi  Mon Jun 16 11:28:46 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 0A10223865; Mon, 16 Jun 2003 11:28:46 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 708E02384C
	for <dovecot@procontrol.fi>; Mon, 16 Jun 2003 11:28:43 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 3FE005EC1410; Mon, 16 Jun 2003 11:28:43 +0300 (EEST)
Subject: Re: [Dovecot] crash on LIST command
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.56.0306160000150.541@cocaine.cryolabs.net>
References: <Pine.LNX.4.56.0306160000150.541@cocaine.cryolabs.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1055752123.10241.28.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 16 Jun 2003 11:28:43 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 16 Jun 2003 08:28:46 -0000
X-UID: 939                                                  
Status: O

On Mon, 2003-06-16 at 05:28, Wouter Van Hemel wrote:
> Hello,
> 
> I'm experiencing a reproducable crash in the imap daemon of dovecot
> 0.99.9.1 when running the next commands (sniffed from a sylpheed session):

I'm pretty sure this is fixed in the -test releases.
http://dovecot.procontrol.fi/test/

From tss@iki.fi  Mon Jun 16 11:30:39 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id BE6D32387A; Mon, 16 Jun 2003 11:30:39 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 3B41B23865
	for <dovecot@procontrol.fi>; Mon, 16 Jun 2003 11:30:38 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 113D75EC1410; Mon, 16 Jun 2003 11:30:38 +0300 (EEST)
Subject: Re: [Dovecot] more newline related errors
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <200306160511.h5G5BSJs034665@chilled.skew.org>
References: <200306160511.h5G5BSJs034665@chilled.skew.org>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1055752237.10262.31.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 16 Jun 2003 11:30:37 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 16 Jun 2003 08:30:39 -0000
X-UID: 940                                                  
Status: O

On Mon, 2003-06-16 at 08:11, Mike Brown wrote:
> Should I be concerned about these errors?
> 
> imap(msun): Jun 13 13:21:38 Error: Error indexing mbox file /home/msun/mail/Deleted Messages: LF not found where expected

Probably means that you have two adjacent From-line. ie.:

>From a@b
>From b@c

Dovecot can't handle those currently. I should fix it some day.

> imap(msun): Jun 13 13:39:08 Error: Corrupted binary tree for index /home/msun/mail/.imap/INBOX/.imap.index: lookup returned index outside range (1 >= 0)
> imap(msun): Jun 14 12:08:27 Error: Corrupted index file /home/msun/mail/.imap/INBOX/.imap.index: Sequence 1 not found from binary tree (1 msgs says header)

Probably because of the above problem.

From tss@iki.fi  Mon Jun 16 11:32:22 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id E28262387F; Mon, 16 Jun 2003 11:32:22 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 66BBE23865
	for <dovecot@procontrol.fi>; Mon, 16 Jun 2003 11:32:21 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 414975EC1410; Mon, 16 Jun 2003 11:32:21 +0300 (EEST)
Subject: Re: [Dovecot] 0.99.10-test12
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030615105425.GA9332@iridium.mv.net>
References: <1055649482.10262.17.camel@hurina>
	 <20030615105425.GA9332@iridium.mv.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1055752341.10241.33.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 16 Jun 2003 11:32:21 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 16 Jun 2003 08:32:23 -0000
X-UID: 941                                                  
Status: O

On Sun, 2003-06-15 at 13:54, Mark E. Mallett wrote:
> src/lib/ioloop-select.c accesses a variable io_p that is not defined
> or declared.  I assume you need to add **io_p to the struct io
> defines in that routine.

Yes. And change io_destroy() to use io_p. Looks like I tested only the
poll() version when I did the changes..

From tss@iki.fi  Mon Jun 16 11:39:22 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 72FA72387A; Mon, 16 Jun 2003 11:39:22 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id D91622384C
	for <dovecot@procontrol.fi>; Mon, 16 Jun 2003 11:39:20 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 1D4035EC1410; Mon, 16 Jun 2003 11:39:16 +0300 (EEST)
Subject: Re: [Dovecot] Dovecot will not run on secure kernel.
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <003401c3333d$79334290$1601a8c0@gorgon>
References: <003401c3333d$79334290$1601a8c0@gorgon>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1055752755.10241.42.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 16 Jun 2003 11:39:15 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 16 Jun 2003 08:39:22 -0000
X-UID: 942                                                  
Status: O

On Sun, 2003-06-15 at 15:55, Ola Garstad wrote:
> I am trying to run Dovecot on RH 7.3 with Linux kernel 2.4.20 + GrSecurity patch.
> I downloaded the RPM yesterday and installed it.
> 
> When I start Dovecot the kernel reports: kernel: grsec: From 192.168.1.22: attempt to overstep process limit by (dovecot:14491) UID(0) EUID(0), parent (dovecot:23872) UID(0) EUID(0)

I thought v0.99.9 fixed this.. Unless grsec checks it now while trying
to set the limit. See if this helps:


diff -u -r1.10 main.c
--- src/login-common/main.c     27 Apr 2003 01:21:50 -0000      1.10
+++ src/login-common/main.c     16 Jun 2003 08:38:10 -0000
@@ -131,7 +131,7 @@
 static void drop_privileges(const char *name)
 {
        /* make sure we can't fork() */
-       restrict_process_size((unsigned int)-1, 0);
+       restrict_process_size((unsigned int)-1, 1);
 
        /* Log file or syslog opening probably requires roots */
        open_logfile(name);

From tss@iki.fi  Mon Jun 16 11:42:40 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 19F7B2387F; Mon, 16 Jun 2003 11:42:40 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 8CF012387A
	for <dovecot@procontrol.fi>; Mon, 16 Jun 2003 11:42:38 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 567C15EC1410; Mon, 16 Jun 2003 11:42:38 +0300 (EEST)
Subject: Re: [Dovecot] a new error message
From: Timo Sirainen <tss@iki.fi>
To: Dovecot List <dovecot@procontrol.fi>
In-Reply-To: <20030615171150.GB696@waste.org>
References: <3EEC4343.8050702@bnap.hu>  <20030615171150.GB696@waste.org>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1055752958.10262.47.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 16 Jun 2003 11:42:38 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 16 Jun 2003 08:42:40 -0000
X-UID: 943                                                  
Status: O

On Sun, 2003-06-15 at 20:11, John Ello wrote:
> On Sun, Jun 15, 2003 at 11:58:27AM +0200, Farkas Levente wrote:
> > The current command did not succeed. The mail server responded: Error in 
> > IMAP command UID: Too long argument.."
> 
> I used to get the same thing (some of my users have rather large
> mailboxes), and I found you can get around it by editing the line that
> begins '#define MAX_INBUF_SIZE ' in src/imap/client.c to a bigger
> number and recompiling. I'm not sure the purpose of the limit, or the
> complete effects of changing it, but it worked for me.

For now that's the only fix. I'm thinking of changing it so that you can
give a total command line limit. Default could be set to 100kB or so
then. RFC-2683 recommends 8000 chars though, so this could be considered
a client bug..

From tss@iki.fi  Mon Jun 16 11:47:24 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 3A30F2387A; Mon, 16 Jun 2003 11:47:24 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id ACFAD2384C
	for <dovecot@procontrol.fi>; Mon, 16 Jun 2003 11:47:20 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id DF82C5EC1410; Mon, 16 Jun 2003 11:47:16 +0300 (EEST)
Subject: Re: [Dovecot] crash on LIST command
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.56.0306160000150.541@cocaine.cryolabs.net>
References: <Pine.LNX.4.56.0306160000150.541@cocaine.cryolabs.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1055753236.10262.51.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 16 Jun 2003 11:47:16 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 16 Jun 2003 08:47:24 -0000
X-UID: 944                                                  
Status: O

On Mon, 2003-06-16 at 05:28, Wouter Van Hemel wrote:
> Manually adding the ~/.mail directory with mkdir takes care of the
> problem, but shouldn't this directory be created automatically when it
> doesn't exist? I can't expect every user to log in and first make this
> mail directory before they can use their mail account.

Oh, and this is already fixed too.

> Dovecot also refuses to show any folders at all, such as the INBOX, when
> it can't find it's mail(folders) directory. Is this intentional?

You mean if you have only INBOX in /var/mail/ but eg. no ~/mail? I don't
think it even allows logging in without? And that is intentional.

From lfarkas@bnap.hu  Mon Jun 16 12:06:13 2003
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 03D482387A; Mon, 16 Jun 2003 12:06:13 +0300 (EEST)
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 50D572384C
	for <dovecot@procontrol.fi>; Mon, 16 Jun 2003 12:06:10 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id B4EE9754012
	for <dovecot@procontrol.fi>; Mon, 16 Jun 2003 11:05:47 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP
	id 6855A3EB8; Mon, 16 Jun 2003 11:06:07 +0200 (CEST)
Received: from bnap.hu (garfield.int.bppiac.hu [192.168.0.50])
	by mail2.bppiac.hu (Postfix) with ESMTP id 494063EB0
	for <dovecot@procontrol.fi>; Mon, 16 Jun 2003 11:06:07 +0200 (CEST)
Message-ID: <3EED887E.7070502@bnap.hu>
Date: Mon, 16 Jun 2003 11:06:06 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.3) Gecko/20030313
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Subject: Re: [Dovecot] a new error message
References: <3EEC4343.8050702@bnap.hu>  <20030615171150.GB696@waste.org>
	<1055752958.10262.47.camel@hurina>
In-Reply-To: <1055752958.10262.47.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 16 Jun 2003 09:06:13 -0000
X-UID: 945                                                  
Status: O
Content-Length: 1046

Timo Sirainen wrote:
> On Sun, 2003-06-15 at 20:11, John Ello wrote:
> 
>>On Sun, Jun 15, 2003 at 11:58:27AM +0200, Farkas Levente wrote:
>>
>>>The current command did not succeed. The mail server responded: Error in 
>>>IMAP command UID: Too long argument.."
>>
>>I used to get the same thing (some of my users have rather large
>>mailboxes), and I found you can get around it by editing the line that
>>begins '#define MAX_INBUF_SIZE ' in src/imap/client.c to a bigger
>>number and recompiling. I'm not sure the purpose of the limit, or the
>>complete effects of changing it, but it worked for me.
> 
> 
> For now that's the only fix. I'm thinking of changing it so that you can
> give a total command line limit. Default could be set to 100kB or so

I not realy like to patch it myself since the next update will beark it. 
so I'll rather wait for your fix:-)

> then. RFC-2683 recommends 8000 chars though, so this could be considered
> a client bug..

mozilla 1.3.


-- 
   Levente                               "Si vis pacem para bellum!"


From wouter@pair.com  Mon Jun 16 16:48:58 2003
Return-Path: <wouter@pair.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 60C1B23865; Mon, 16 Jun 2003 16:48:58 +0300 (EEST)
Received: from amsfep16-int.chello.nl (amsfep16-int.chello.nl [213.46.243.26])
	by danu.procontrol.fi (Postfix) with ESMTP id 4149F2384C
	for <dovecot@procontrol.fi>; Mon, 16 Jun 2003 16:48:54 +0300 (EEST)
Received: from hibernate.cryolabs.net ([213.132.150.78])
	by amsfep16-int.chello.nlSMTP
	<20030616134853.FOWO28742.amsfep16-int.chello.nl@hibernate.cryolabs.net>
	for <dovecot@procontrol.fi>; Mon, 16 Jun 2003 15:48:53 +0200
Received: (qmail 17081 invoked from network); 16 Jun 2003 15:48:51 +0200
Received: from unknown (HELO cocaine.cryolabs.net) (192.168.196.5)
  by hibernate.cryolabs.net with SMTP; 16 Jun 2003 15:48:51 +0200
Date: Mon, 16 Jun 2003 15:49:01 +0200 (CEST)
From: Wouter Van Hemel <wouter@pair.com>
To: Timo Sirainen <tss@iki.fi>
Subject: Re: [Dovecot] crash on LIST command
In-Reply-To: <1055752123.10241.28.camel@hurina>
Message-ID: <Pine.LNX.4.56.0306161548030.212@cocaine.cryolabs.net>
References: <Pine.LNX.4.56.0306160000150.541@cocaine.cryolabs.net>
 <1055752123.10241.28.camel@hurina>
PGP: 0B B4 BC 28 53 62 FE 94  6A 57 EE B8 A6 E2 1B E4  (0xAA5412F0)
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 16 Jun 2003 13:48:58 -0000
X-UID: 946                                                  
Status: O

On Mon, 16 Jun 2003, Timo Sirainen wrote:

> On Mon, 2003-06-16 at 05:28, Wouter Van Hemel wrote:
> > Hello,
> >
> > I'm experiencing a reproducable crash in the imap daemon of dovecot
> > 0.99.9.1 when running the next commands (sniffed from a sylpheed session):
>
> I'm pretty sure this is fixed in the -test releases.
> http://dovecot.procontrol.fi/test/
>

It is, I just tested with -test12. Thanks!

  wouter

From wouter@pair.com  Mon Jun 16 17:14:46 2003
Return-Path: <wouter@pair.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 1942323865; Mon, 16 Jun 2003 17:14:46 +0300 (EEST)
Received: from amsfep11-int.chello.nl (amsfep11-int.chello.nl [213.46.243.20])
	by danu.procontrol.fi (Postfix) with ESMTP id 5EA752384C
	for <dovecot@procontrol.fi>; Mon, 16 Jun 2003 17:14:40 +0300 (EEST)
Received: from hibernate.cryolabs.net ([213.132.150.78])
	by amsfep11-int.chello.nlSMTP
	<20030616141439.QVMJ7516.amsfep11-int.chello.nl@hibernate.cryolabs.net>
	for <dovecot@procontrol.fi>; Mon, 16 Jun 2003 16:14:39 +0200
Received: (qmail 13123 invoked from network); 16 Jun 2003 16:14:34 +0200
Received: from unknown (HELO cocaine.cryolabs.net) (192.168.196.5)
  by hibernate.cryolabs.net with SMTP; 16 Jun 2003 16:14:34 +0200
Date: Mon, 16 Jun 2003 16:14:45 +0200 (CEST)
From: Wouter Van Hemel <wouter@pair.com>
To: Timo Sirainen <tss@iki.fi>
Subject: Re: [Dovecot] crash on LIST command
In-Reply-To: <1055753236.10262.51.camel@hurina>
Message-ID: <Pine.LNX.4.56.0306161549100.212@cocaine.cryolabs.net>
References: <Pine.LNX.4.56.0306160000150.541@cocaine.cryolabs.net>
 <1055753236.10262.51.camel@hurina>
PGP: 0B B4 BC 28 53 62 FE 94  6A 57 EE B8 A6 E2 1B E4  (0xAA5412F0)
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 16 Jun 2003 14:14:46 -0000
X-UID: 947                                                  
Status: O
Content-Length: 1454

On Mon, 16 Jun 2003, Timo Sirainen wrote:

> On Mon, 2003-06-16 at 05:28, Wouter Van Hemel wrote:
> > Manually adding the ~/.mail directory with mkdir takes care of the
> > problem, but shouldn't this directory be created automatically when it
> > doesn't exist? I can't expect every user to log in and first make this
> > mail directory before they can use their mail account.
>
> Oh, and this is already fixed too.
>

So it is, too. Thanks. :)

> > Dovecot also refuses to show any folders at all, such as the INBOX, when
> > it can't find it's mail(folders) directory. Is this intentional?
>
> You mean if you have only INBOX in /var/mail/ but eg. no ~/mail? I don't
> think it even allows logging in without? And that is intentional.
>

In that case, no problem. :)

I discovered two small errors (at least I think they are):

Fatal: Can't create directory /usr/local/var/run/dovecot: No such file or
directory

... when I undefine "base_dir = /var/run/dovecot/". So that path really
isn't the default dovecot uses, for some reason it prepends '/usr/local'
(that being the install prefix). This could be a feature, too - it just
confused me because I thought the comments showed the default settings.

And I also get an error when I uncomment "max_logging_users = 256":

Fatal: Error in configuration file /usr/local/etc/dovecot.conf line 125:
Unknown setting: max_logging_users

That should probably be login_max_logging_users?


Regards,

  wouter

From tss@iki.fi  Mon Jun 16 17:39:17 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id B0B4523865; Mon, 16 Jun 2003 17:39:17 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 1CFB223860
	for <dovecot@procontrol.fi>; Mon, 16 Jun 2003 17:39:15 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id D3BF65EC1410; Mon, 16 Jun 2003 17:39:14 +0300 (EEST)
Subject: Re: [Dovecot] crash on LIST command
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <Pine.LNX.4.56.0306161549100.212@cocaine.cryolabs.net>
References: <Pine.LNX.4.56.0306160000150.541@cocaine.cryolabs.net>
	 <1055753236.10262.51.camel@hurina>
	 <Pine.LNX.4.56.0306161549100.212@cocaine.cryolabs.net>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1055774354.10241.72.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 16 Jun 2003 17:39:14 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 16 Jun 2003 14:39:17 -0000
X-UID: 948                                                  
Status: O

On Mon, 2003-06-16 at 17:14, Wouter Van Hemel wrote:
> Fatal: Can't create directory /usr/local/var/run/dovecot: No such file or
> directory
> 
> ... when I undefine "base_dir = /var/run/dovecot/". So that path really
> isn't the default dovecot uses, for some reason it prepends '/usr/local'
> (that being the install prefix). This could be a feature, too - it just
> confused me because I thought the comments showed the default settings.

>From beginning of config file:

# Default values are shown after each value, it's not required to uncomment
# any of the lines. Exception to this are paths, they're just examples
# with real defaults being based on configure options.

I use those values that are the preferred locations that binary package
builders should use.

> Fatal: Error in configuration file /usr/local/etc/dovecot.conf line 125:
> Unknown setting: max_logging_users
> 
> That should probably be login_max_logging_users?

Right.

From ken.crain@dotcomadvisors.com  Mon Jun 16 19:02:55 2003
Return-Path: <ken.crain@dotcomadvisors.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 8AD2B23865; Mon, 16 Jun 2003 19:02:55 +0300 (EEST)
Received: from s5a.dotcomadvisors.com (s5a.dotcomadvisors.com
	[209.123.168.233])
	by danu.procontrol.fi (Postfix) with ESMTP id 763252384C
	for <dovecot@procontrol.fi>; Mon, 16 Jun 2003 19:02:53 +0300 (EEST)
Received: from dell800 (24-193-183-82.nyc.rr.com [24.193.183.82])
	(authenticated)
	by s5a.dotcomadvisors.com (8.11.6/8.11.2) with ESMTP id h5GG2qP14727
	for <dovecot@procontrol.fi>; Mon, 16 Jun 2003 12:02:52 -0400
Message-ID: <010601c33420$bdadfd00$6401a8c0@nyc.rr.com>
From: "Ken Crain" <ken.crain@dotcomadvisors.com>
To: <dovecot@procontrol.fi>
Date: Mon, 16 Jun 2003 12:02:52 -0400
MIME-Version: 1.0
Content-Type: multipart/alternative;
	boundary="----=_NextPart_000_0103_01C333FF.367ACB40"
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2800.1106
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2800.1106
Subject: [Dovecot] SASL Support
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 16 Jun 2003 16:02:55 -0000
X-UID: 949                                                  
Status: O
Content-Length: 1479

This is a multi-part message in MIME format.

------=_NextPart_000_0103_01C333FF.367ACB40
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable

I need to support Outlook/Outlook Express users of Sendmail with SMTP =
Authorization.  From what I can see, the LOGIN method available in =
Outlook/Outlook Express is the only applicable way to go at this time.  =
It appears it is not supported in Dovecot right now.  Is this correct =
and, if so, how would I go about adding this support?
------=_NextPart_000_0103_01C333FF.367ACB40
Content-Type: text/html;
	charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML><HEAD>
<META http-equiv=3DContent-Type content=3D"text/html; =
charset=3Diso-8859-1">
<META content=3D"MSHTML 6.00.2800.1106" name=3DGENERATOR>
<STYLE></STYLE>
</HEAD>
<BODY bgColor=3D#ffffff>
<DIV><FONT face=3DArial size=3D2>
<DIV><FONT face=3DArial size=3D2>I need&nbsp;to support Outlook/Outlook =
Express=20
users of Sendmail with SMTP Authorization.&nbsp; From what I can see, =
the LOGIN=20
method&nbsp;available in&nbsp;Outlook/Outlook Express is the only =
applicable way=20
to go&nbsp;at this time.&nbsp; It appears it is not&nbsp;supported in =
Dovecot=20
right now.&nbsp; Is this correct and, if so, how would I go =
about&nbsp;adding=20
this support?</FONT></DIV></FONT></DIV></BODY></HTML>

------=_NextPart_000_0103_01C333FF.367ACB40--

From jryden@thebox.our-own.net  Mon Jun 16 20:22:26 2003
Return-Path: <jryden@thebox.our-own.net>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 07EB223865; Mon, 16 Jun 2003 20:22:26 +0300 (EEST)
Received: from thebox.our-own.net (thebox.our-own.net [64.81.83.87])
	by danu.procontrol.fi (Postfix) with ESMTP id 106912384C
	for <dovecot@procontrol.fi>; Mon, 16 Jun 2003 20:22:23 +0300 (EEST)
Received: from redtop.our-own.net (redtop.our-own.net [10.0.0.19])
	by localhost (Postfix) with ESMTP
	id D3C15D1F89; Mon, 16 Jun 2003 10:22:20 -0700 (PDT)
Subject: Re: [Dovecot] SASL Support
From: Joakim Ryden <jryden@thebox.our-own.net>
To: Ken Crain <ken.crain@dotcomadvisors.com>
In-Reply-To: <010601c33420$bdadfd00$6401a8c0@nyc.rr.com>
References: <010601c33420$bdadfd00$6401a8c0@nyc.rr.com>
Content-Type: text/plain
Message-Id: <1055784140.8098.31.camel@redtop>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.4.0 
Date: 16 Jun 2003 10:22:20 -0700
Content-Transfer-Encoding: 7bit
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 16 Jun 2003 17:22:26 -0000
X-UID: 950                                                  
Status: O
Content-Length: 1077

On Mon, 2003-06-16 at 09:02, Ken Crain wrote:
> I need to support Outlook/Outlook Express users of Sendmail with SMTP
> Authorization.  From what I can see, the LOGIN method available in
> Outlook/Outlook Express is the only applicable way to go at this
> time.  It appears it is not supported in Dovecot right now.  Is this
> correct and, if so, how would I go about adding this support?

Hi Ken -

I think you may be confusing the IMAP/POP server (Dovecot) function with
the SMTP server (Sendmail) function. You need SASL support in the SMTP
server, which has nothing to do with the IMAP/POP server. 

Unless you're talking about authenticating the SMTP users and the
IMAP/POP users against the same database and you are using sasldb for
the SMTP authentication in which case I think you are out of luck right
now. You can configure the SASL library to use password/shadow, SQL,
LDAP or PAM though in which case Dovecot and Sendmail could use the same
source for authentication.

http://www.sendmail.org/~ca/email/auth.html
http://dovecot.procontrol.fi/doc/auth.txt

HTH,
Jo

From ohp@pyrenet.fr  Tue Jun 17 21:13:38 2003
Return-Path: <ohp@pyrenet.fr>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id A7A4E2387A; Tue, 17 Jun 2003 21:13:38 +0300 (EEST)
Received: from server.pyrenet.fr (server.pyrenet.fr [194.250.190.1])
	by danu.procontrol.fi (Postfix) with ESMTP id 9103B2384C
	for <dovecot@procontrol.fi>; Tue, 17 Jun 2003 21:13:33 +0300 (EEST)
Received: from localhost (localhost [127.0.0.1])
	by localhost.pyrenet.fr (Postfix) with ESMTP id 19600285A3
	for <dovecot@procontrol.fi>; Tue, 17 Jun 2003 20:13:33 +0200 (MET DST)
Received: from server.pyrenet.fr ([127.0.0.1])
 by localhost (server [127.0.0.1]) (amavisd-new, port 10024) with ESMTP
 id 12075-01 for <dovecot@procontrol.fi>;
 Tue, 17 Jun 2003 20:13:31 +0200 (MET DST)
Received: from server.pyrenet.fr (server.pyrenet.fr [194.250.190.1])
	by server.pyrenet.fr (Postfix) with ESMTP id 93591285A0
	for <dovecot@procontrol.fi>; Tue, 17 Jun 2003 20:13:31 +0200 (MET DST)
Date: Tue, 17 Jun 2003 20:13:25 +0200 (MET DST)
From: ohp@pyrenet.fr
To: dovecot@procontrol.fi
Message-ID: <Pine.UW2.4.53.0306172009300.12039@server.pyrenet.fr>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-Virus-Scanned: by amavisd-new
Subject: [Dovecot] Multiple auth howto
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
Reply-To: ohp@pyrenet.fr
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Tue, 17 Jun 2003 18:13:39 -0000
X-UID: 951                                                  
Status: O

Howdi.

I'm new to dovcot (just succeded in compiling on unixware 713 today)
I'm noww configuring for tests on other port. The sample configuration
file is pretty well documented, however, I don't understand how I can
firstt authenticate against passwd/shadow if not found against pgsql.

What's the syntax?

Please cc responses as I'm subscribed to digest

TIA
Reghards

-- 
Olivier PRENANT         	Tel:	+33-5-61-50-97-00 (Work)
Quartier d'Harraud Turrou           +33-5-61-50-97-01 (Fax)
31190 AUTERIVE                      +33-6-07-63-80-64 (GSM)
FRANCE                      Email: ohp@pyrenet.fr
------------------------------------------------------------------------------
Make your life a dream, make your dream a reality. (St Exupery)
From tss@iki.fi  Tue Jun 17 21:30:47 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 11F0B2387A; Tue, 17 Jun 2003 21:30:47 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 3869523865
	for <dovecot@procontrol.fi>; Tue, 17 Jun 2003 21:30:44 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id F375A5EC1410; Tue, 17 Jun 2003 21:30:43 +0300 (EEST)
Subject: Re: [Dovecot] Multiple auth howto
From: Timo Sirainen <tss@iki.fi>
To: ohp@pyrenet.fr
In-Reply-To: <Pine.UW2.4.53.0306172009300.12039@server.pyrenet.fr>
References: <Pine.UW2.4.53.0306172009300.12039@server.pyrenet.fr>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1055874643.10262.115.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 17 Jun 2003 21:30:43 +0300
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Tue, 17 Jun 2003 18:30:47 -0000
X-UID: 952                                                  
Status: O

On Tue, 2003-06-17 at 21:13, ohp@pyrenet.fr wrote:
> Howdi.
> 
> I'm new to dovcot (just succeded in compiling on unixware 713 today)
> I'm noww configuring for tests on other port. The sample configuration
> file is pretty well documented, however, I don't understand how I can
> firstt authenticate against passwd/shadow if not found against pgsql.
> 
> What's the syntax?

Well, short answer: You can't. Put them all to one place (eg. pgsql),
maybe using some automated scripts. I don't know if I should even
consider about supporting fallbacking..

From katzj@redhat.com  Wed Jun 18 01:27:28 2003
Return-Path: <katzj@redhat.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 778032387A; Wed, 18 Jun 2003 01:27:28 +0300 (EEST)
Received: from devserv.devel.redhat.com (nat-pool-rdu.redhat.com
	[66.187.233.200])
	by danu.procontrol.fi (Postfix) with ESMTP id B6B4123865
	for <dovecot@procontrol.fi>; Wed, 18 Jun 2003 01:27:21 +0300 (EEST)
Received: from mirkwood.devel.redhat.com (mirkwood.devel.redhat.com
	[172.16.57.122])h5HMRIx23719;	Tue, 17 Jun 2003 18:27:18 -0400
Subject: Re: [Dovecot] 0.99.10-test12
From: Jeremy Katz <katzj@redhat.com>
To: Timo Sirainen <tss@iki.fi>
In-Reply-To: <1055649482.10262.17.camel@hurina>
References: <1055649482.10262.17.camel@hurina>
Content-Type: text/plain
Message-Id: <1055888838.22969.27.camel@mirkwood.devel.redhat.com>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.3.92 (cvs 20030602) (Preview Release)
Date: 17 Jun 2003 18:27:18 -0400
Content-Transfer-Encoding: 7bit
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Tue, 17 Jun 2003 22:27:28 -0000
X-UID: 953                                                  
Status: O

On Sat, 2003-06-14 at 23:58, Timo Sirainen wrote:
> - OpenSSL problems. Are they really my fault? I have no idea what I
> could be doing wrong. Maybe some compile option is wrong? 

Sorry, found out the answer to this on Friday afternoon (from our local
ssl guru) and haven't had a chance to sit down and send the reasoning.

Basically, if you're using OpenSSL with the RSA blinding patch as
supplied by the OpenSSL folks, then the blinding ends up not having
entropy.  This is because /dev/urandom won't exist in your chroot and so
the SSL entropy isn't able to be setup.

Probably the best fix would be initializing SSL bits before the chroot
(similar to the way timezone setup has to happen).  That or making sure
you have /dev/urandom in your chroot.  I was going to look more at the
former but just haven't had the cycles yet :/

> Also I should
> try to use pkg-config to get compile flags if it exists in configure.

Would be nice, but won't help this :)

Cheers,

Jeremy

From jens@freebsdforum.de  Wed Jun 18 02:13:37 2003
Return-Path: <jens@freebsdforum.de>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id DB546238B6; Wed, 18 Jun 2003 02:13:37 +0300 (EEST)
Received: from lieber-annanas-als-annatrocken.de
	(lieber-annanas-als-annatrocken.de [213.133.103.207])
	by danu.procontrol.fi (Postfix) with ESMTP id 050A72387A
	for <dovecot@procontrol.fi>; Wed, 18 Jun 2003 02:13:33 +0300 (EEST)
Received: from jensemann.lan.saturn (pD95400AD.dip.t-dialin.net
	[217.84.0.173])
	(using TLSv1 with cipher EDH-RSA-DES-CBC3-SHA (168/168 bits))
	(No client certificate requested)085031141C2
	for <dovecot@procontrol.fi>; Wed, 18 Jun 2003 01:13:31 +0200 (CEST)
Date: Wed, 18 Jun 2003 01:18:53 +0200
From: Jens Gutzeit <jens@freebsdforum.de>
To: dovecot@procontrol.fi
Message-Id: <20030618011853.37be0e08.jens@freebsdforum.de>
X-Mailer: Sylpheed version 0.9.1 (GTK+ 1.2.10; i586-pc-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Subject: [Dovecot] starting with daemontools
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Tue, 17 Jun 2003 23:13:38 -0000
X-UID: 954                                                  
Status: O

Hi all,

I want to start dovecot through DJBs Daemontools-supervise, is there a
configuration option that lets dovecot stay in foreground?

best regards,
Jens
From bradf@mailgate.tpi.com  Wed Jun 18 03:50:04 2003
Return-Path: <bradf@mailgate.tpi.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 48941238C6; Wed, 18 Jun 2003 03:50:04 +0300 (EEST)
Received: from mailgate.tpi.com (unknown [198.107.51.136])
	by danu.procontrol.fi (Postfix) with ESMTP id 0546D238B6
	for <dovecot@procontrol.fi>; Wed, 18 Jun 2003 03:49:58 +0300 (EEST)
Received: from triplepoint.com ([10.0.5.2]) by mailgate.tpi.com
          (Post.Office MTA v3.5.3 release 223 ID# 0-60229U100L100S0V35)
          with ESMTP id com; Tue, 17 Jun 2003 17:49:56 -0700
Message-ID: <3EEFB6DF.3020606@triplepoint.com>
Date: Tue, 17 Jun 2003 17:48:31 -0700
From: Brad Figg <brad@triplepoint.com>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.4a) Gecko/20030401
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Timo Sirainen <tss@iki.fi>
Subject: Re: [Dovecot] 0.99.10-test12
References: <1055649482.10262.17.camel@hurina>
In-Reply-To: <1055649482.10262.17.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-Mailman-Approved-At: Wed, 18 Jun 2003 03:53:56 +0300
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 18 Jun 2003 00:50:04 -0000
X-UID: 955                                                  
Status: O
Content-Length: 1614

I just upgraded from 0.99.6 to 0.99.10-test12
and I can no longer delete messages or move
messages between folders from Mozilla. What
information can I provide to you to help debug
this?

Brad

Timo Sirainen wrote:
> http://dovecot.procontrol.fi/test/
> 
> I should have released 0.99.10 already I think.. There's just two
> annoying problems that I think should be fixed first:
> 
> - PAM: If user gives a wrong password, dovecot-auth process sleeps for
> two seconds, blocking everyone else who are trying to authenticate at
> the time. So using PAM isn't very good idea at the moment.
> 
> - OpenSSL problems. Are they really my fault? I have no idea what I
> could be doing wrong. Maybe some compile option is wrong? Also I should
> try to use pkg-config to get compile flags if it exists in configure.
> 
> The new things in -test12 then:
> 
> - We sync mailbox less often. Only NOOP and CHECK will force a mailbox
> sync now. Other commands do it also but only if mailbox hasn't been
> synced in last 5 seconds. Maybe this reduces some I/O. At least a bit
> less stat() calls :)
> 
> - Dirty maildir flag flushing work now. Meaning that if you change
> message flags but rename() fails because you're out of quota, the flags
> are changed in index file and dirty-flag is set. Once in a while it
> tries to flush the dirty flags by rename()ing the file again.
> 
> - IMAP RFC requires that NUL characters are never sent to client. We do
> now the same as UW-IMAP by sending ascii 128 chars instead.
> 

-- 
Brad Figg - brad@triplepoint.com 503.601.0235 ext. 105
TriplePoint, Inc. - http://www.triplepoint.com

From tss@iki.fi  Wed Jun 18 03:57:31 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id BA30F238C7; Wed, 18 Jun 2003 03:57:31 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id C7274238C6
	for <dovecot@procontrol.fi>; Wed, 18 Jun 2003 03:57:28 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 96FDF5EC1410; Wed, 18 Jun 2003 03:57:27 +0300 (EEST)
Subject: Re: [Dovecot] 0.99.10-test12
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <3EEFB6DF.3020606@triplepoint.com>
References: <1055649482.10262.17.camel@hurina>
	 <3EEFB6DF.3020606@triplepoint.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1055897847.10262.120.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 18 Jun 2003 03:57:27 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 18 Jun 2003 00:57:31 -0000
X-UID: 956                                                  
Status: O

On Wed, 2003-06-18 at 03:48, Brad Figg wrote:
> I just upgraded from 0.99.6 to 0.99.10-test12
> and I can no longer delete messages or move
> messages between folders from Mozilla. What
> information can I provide to you to help debug
> this?

Anything in log file? There could be some index file incompatibilities
though, so you could try deleting them (.imap.index*).

From tss@iki.fi  Wed Jun 18 03:58:06 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 89811238CB; Wed, 18 Jun 2003 03:58:06 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id D4897238C7
	for <dovecot@procontrol.fi>; Wed, 18 Jun 2003 03:58:04 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id AEFD55EC1410; Wed, 18 Jun 2003 03:58:04 +0300 (EEST)
Subject: Re: [Dovecot] starting with daemontools
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <20030618011853.37be0e08.jens@freebsdforum.de>
References: <20030618011853.37be0e08.jens@freebsdforum.de>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1055897884.10241.122.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 18 Jun 2003 03:58:04 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 18 Jun 2003 00:58:06 -0000
X-UID: 957                                                  
Status: O

On Wed, 2003-06-18 at 02:18, Jens Gutzeit wrote:
> I want to start dovecot through DJBs Daemontools-supervise, is there a
> configuration option that lets dovecot stay in foreground?

dovecot -F

From jens@freebsdforum.de  Wed Jun 18 04:09:20 2003
Return-Path: <jens@freebsdforum.de>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 77254238C8; Wed, 18 Jun 2003 04:09:20 +0300 (EEST)
Received: from lieber-annanas-als-annatrocken.de
	(lieber-annanas-als-annatrocken.de [213.133.103.207])
	by danu.procontrol.fi (Postfix) with ESMTP id E8FE4238C7
	for <dovecot@procontrol.fi>; Wed, 18 Jun 2003 04:09:17 +0300 (EEST)
Received: from jensemann.lan.saturn (pD95400AD.dip.t-dialin.net
	[217.84.0.173])
	(using TLSv1 with cipher EDH-RSA-DES-CBC3-SHA (168/168 bits))
	(No client certificate requested)528EB1141C2
	for <dovecot@procontrol.fi>; Wed, 18 Jun 2003 03:09:17 +0200 (CEST)
Date: Wed, 18 Jun 2003 03:14:43 +0200
From: Jens Gutzeit <jens@freebsdforum.de>
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] starting with daemontools
Message-Id: <20030618031443.5448f4a1.jens@freebsdforum.de>
In-Reply-To: <1055897884.10241.122.camel@hurina>
References: <20030618011853.37be0e08.jens@freebsdforum.de>
	<1055897884.10241.122.camel@hurina>
X-Mailer: Sylpheed version 0.9.1 (GTK+ 1.2.10; i586-pc-linux-gnu)
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 18 Jun 2003 01:09:20 -0000
X-UID: 958                                                  
Status: O

Am 18 Jun 2003 03:58:04 +0300
Timo Sirainen <tss@iki.fi> schrieb:

> On Wed, 2003-06-18 at 02:18, Jens Gutzeit wrote:
> > I want to start dovecot through DJBs Daemontools-supervise, is there
> > a configuration option that lets dovecot stay in foreground?
> 
> dovecot -F
> 

Thanks. Seems that it isn't documented :)

Jens
From tss@iki.fi  Wed Jun 18 04:10:52 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 55E2B238D4; Wed, 18 Jun 2003 04:10:52 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id B58F4238CB
	for <dovecot@procontrol.fi>; Wed, 18 Jun 2003 04:10:50 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 7BE565EC1410; Wed, 18 Jun 2003 04:10:50 +0300 (EEST)
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <1055888838.22969.27.camel@mirkwood.devel.redhat.com>
References: <1055649482.10262.17.camel@hurina>
	 <1055888838.22969.27.camel@mirkwood.devel.redhat.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1055898650.10241.126.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 18 Jun 2003 04:10:50 +0300
Subject: [Dovecot] OpenSSL fix
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 18 Jun 2003 01:10:52 -0000
X-UID: 959                                                  
Status: O
Content-Length: 2037

On Wed, 2003-06-18 at 01:27, Jeremy Katz wrote:
> On Sat, 2003-06-14 at 23:58, Timo Sirainen wrote:
> > - OpenSSL problems. Are they really my fault? I have no idea what I
> > could be doing wrong. Maybe some compile option is wrong? 
> 
> Sorry, found out the answer to this on Friday afternoon (from our local
> ssl guru) and haven't had a chance to sit down and send the reasoning.
> 
> Basically, if you're using OpenSSL with the RSA blinding patch as
> supplied by the OpenSSL folks, then the blinding ends up not having
> entropy.  This is because /dev/urandom won't exist in your chroot and so
> the SSL entropy isn't able to be setup.

I thought it would have required that in any case..

> Probably the best fix would be initializing SSL bits before the chroot
> (similar to the way timezone setup has to happen).  That or making sure
> you have /dev/urandom in your chroot.  I was going to look more at the
> former but just haven't had the cycles yet :/

I just looked at OpenSSL sources how it work, I think this would fix it:

diff -u -r1.16 ssl-proxy-openssl.c
--- ssl-proxy-openssl.c 11 Jun 2003 23:26:13 -0000      1.16
+++ ssl-proxy-openssl.c 18 Jun 2003 01:08:07 -0000
@@ -13,6 +13,7 @@
 #include <openssl/pem.h>
 #include <openssl/ssl.h>
 #include <openssl/err.h>
+#include <openssl/rand.h>
 
 #define SSL_CIPHER_LIST "ALL:!LOW"
 
@@ -403,6 +404,7 @@
 void ssl_proxy_init(void)
 {
        const char *certfile, *keyfile, *paramfile;
+       char buf;
 
        certfile = getenv("SSL_CERT_FILE");
        keyfile = getenv("SSL_KEY_FILE");
@@ -439,6 +441,11 @@
 
        if (SSL_CTX_need_tmp_RSA(ssl_ctx))
                SSL_CTX_set_tmp_rsa_callback(ssl_ctx, ssl_gen_rsa_key);
+
+       /* PRNG initialization might want to use /dev/urandom, make sure it
+          does it before chrooting. */
+       if (RAND_bytes(&buf, 1) != 1)
+               i_fatal("RAND_bytes() failed: %s\n", ssl_last_error());
 
         ssl_proxies = hash_create(default_pool, default_pool, 0, NULL, NULL);
        ssl_initialized = TRUE;

From tss@iki.fi  Wed Jun 18 04:42:03 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 65419238CE; Wed, 18 Jun 2003 04:42:03 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id E61D92384C
	for <dovecot@procontrol.fi>; Wed, 18 Jun 2003 04:42:01 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id B29425C47B20; Wed, 18 Jun 2003 04:42:01 +0300 (EEST)
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1055900521.10241.147.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 18 Jun 2003 04:42:01 +0300
Subject: [Dovecot] 0.99.10-test13
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 18 Jun 2003 01:42:03 -0000
X-UID: 960                                                  
Status: O

http://dovecot.procontrol.fi/test/

- Hopefully OpenSSL is fixed :)
- We sometimes produced invalid ENVELOPE with 8bit headers. That could
really have broken things (broke it in test12).

So, what's left is to make PAM work well..

From zach.bagnall@bulletinwireless.com  Wed Jun 18 07:38:16 2003
Return-Path: <zach.bagnall@bulletinwireless.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 6ECD7238D6; Wed, 18 Jun 2003 07:38:16 +0300 (EEST)
Received: from piranha.intra.jungledrum.co.nz (ns1.jungledrum.co.nz
	[210.54.149.34])
	by danu.procontrol.fi (Postfix) with ESMTP id 60A6F238CB
	for <dovecot@procontrol.fi>; Wed, 18 Jun 2003 07:38:11 +0300 (EEST)
Received: from piranha (localhost.localdomain [127.0.0.1])
	by piranha.intra.jungledrum.co.nz (Postfix) with SMTP id 7FC4C15005
	for <dovecot@procontrol.fi>; Wed, 18 Jun 2003 16:38:00 +1200 (NZST)
Date: Wed, 18 Jun 2003 16:38:00 +1200
From: Zach Bagnall <zach.bagnall@bulletinwireless.com>
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] 0.99.10-test13
Message-Id: <20030618163800.5c0afa4f.zach.bagnall@bulletinwireless.com>
In-Reply-To: <1055900521.10241.147.camel@hurina>
References: <1055900521.10241.147.camel@hurina>
Organization: Bulletin Wireless
X-Mailer: Sylpheed version 0.8.9 (GTK+ 1.2.10; i686-pc-linux-gnu)
Mime-Version: 1.0
Content-Type: multipart/signed; protocol="application/pgp-signature";
 micalg="pgp-sha1"; boundary="=.jXVThpZj(PWf+Y"
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 18 Jun 2003 04:38:16 -0000
X-UID: 961                                                  
Status: O
Content-Length: 1168

--=.jXVThpZj(PWf+Y
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

Can anyone pinpoint exactly when SSL began to have problems?

I'm using 0.9.99.1 on two servers:
- Redhat 7.3 with openssl-0.9.6b-30.7
- Gentoo with openssl-0.9.6i

The Redhat server serves about 30 users, some POP3, some IMAP. At least
half use SSL (because they're ouside the LAN).

I haven't had any problem, so I'm just wondering when these errors began.

Zach.

On 18 Jun 2003 04:42:01 +0300, Timo Sirainen <tss@iki.fi> wrote:

> http://dovecot.procontrol.fi/test/
> 
> - Hopefully OpenSSL is fixed :)
> - We sometimes produced invalid ENVELOPE with 8bit headers. That could
> really have broken things (broke it in test12).
> 
> So, what's left is to make PAM work well..
> 


-- 
Services & Support
Bulletin Wireless | www.bulletinwireless.com
This email is digitally signed | Key ID 0x3F9AA9A2

--=.jXVThpZj(PWf+Y
Content-Type: application/pgp-signature

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.1 (GNU/Linux)

iD8DBQE+7+yo4jDFYT+aqaIRAgcfAJ92m6F+Wq3hGl2CXJqxay9PuXiqYQCgh+yK
Q/vHIrQahpQYKhB8r5cdfZY=
=M2Nn
-----END PGP SIGNATURE-----

--=.jXVThpZj(PWf+Y--
From warren@togami.com  Wed Jun 18 10:20:54 2003
Return-Path: <warren@togami.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 9A8CB238CE; Wed, 18 Jun 2003 10:20:54 +0300 (EEST)
Received: from pan.mplug.org (unknown [66.139.75.105])
	by danu.procontrol.fi (Postfix) with ESMTP id 40ED32384C
	for <dovecot@procontrol.fi>; Wed, 18 Jun 2003 10:20:51 +0300 (EEST)
Received: from localhost.127.in-addr.arpa (unknown [127.0.0.1])
	by pan.mplug.org (Postfix) with ESMTP
	id 460B35D803F; Tue, 17 Jun 2003 21:24:04 -1000 (HST)
Subject: Re: [Dovecot] 0.99.10-test13
From: Warren Togami <warren@togami.com>
To: Timo Sirainen <tss@iki.fi>, katzj@redhat.com
In-Reply-To: <1055900521.10241.147.camel@hurina>
References: <1055900521.10241.147.camel@hurina>
Content-Type: text/plain
Message-Id: <1055920846.2331.2.camel@laptop>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.4.0 (1.4.0-2) 
Date: 17 Jun 2003 21:20:47 -1000
Content-Transfer-Encoding: 7bit
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 18 Jun 2003 07:20:54 -0000
X-UID: 962                                                  
Status: O

On Tue, 2003-06-17 at 15:42, Timo Sirainen wrote:
> http://dovecot.procontrol.fi/test/
> 
> - Hopefully OpenSSL is fixed :)
> - We sometimes produced invalid ENVELOPE with 8bit headers. That could
> really have broken things (broke it in test12).
> 
> So, what's left is to make PAM work well..

openssl suddenly works on RH9 with dovecot.  It seems to be stable, but
speed seems to be extremely slow.  Using less than 2% CPU on the Athlon
2100+ server, loading the directory indexes in Evolution feels like 5
times as long as previously with unencrypted IMAP going through a SSH
tunnel.  Any ideas?

Warren Togami
warren@togami.com


From ohp@pyrenet.fr  Wed Jun 18 14:05:21 2003
Return-Path: <ohp@pyrenet.fr>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 3DCE223865; Wed, 18 Jun 2003 14:05:21 +0300 (EEST)
Received: from server.pyrenet.fr (server.pyrenet.fr [194.250.190.1])
	by danu.procontrol.fi (Postfix) with ESMTP id 78D1523860
	for <dovecot@procontrol.fi>; Wed, 18 Jun 2003 14:05:19 +0300 (EEST)
Received: from localhost (localhost [127.0.0.1])
	by localhost.pyrenet.fr (Postfix) with ESMTP
	id C973C262DD; Wed, 18 Jun 2003 13:05:18 +0200 (MET DST)
Received: from server.pyrenet.fr ([127.0.0.1])
 by localhost (server [127.0.0.1]) (amavisd-new, port 10024) with ESMTP
 id 10766-04; Wed, 18 Jun 2003 13:05:17 +0200 (MET DST)
Received: from server.pyrenet.fr (server.pyrenet.fr [194.250.190.1])
	by server.pyrenet.fr (Postfix) with ESMTP
	id 1C2A4267E2; Wed, 18 Jun 2003 13:05:17 +0200 (MET DST)
Date: Wed, 18 Jun 2003 13:05:17 +0200 (MET DST)
From: ohp@pyrenet.fr
To: Timo Sirainen <tss@iki.fi>
Subject: Re: [Dovecot] Multiple auth howto
In-Reply-To: <1055874643.10262.115.camel@hurina>
Message-ID: <Pine.UW2.4.53.0306181301380.10798@server.pyrenet.fr>
References: <Pine.UW2.4.53.0306172009300.12039@server.pyrenet.fr>
 <1055874643.10262.115.camel@hurina>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-Virus-Scanned: by amavisd-new
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
Reply-To: ohp@pyrenet.fr
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 18 Jun 2003 11:05:21 -0000
X-UID: 963                                                  
Status: O
Content-Length: 1452

On Tue, 17 Jun 2003, Timo Sirainen wrote:

> Date: 17 Jun 2003 21:30:43 +0300
> From: Timo Sirainen <tss@iki.fi>
> To: ohp@pyrenet.fr
> Cc: dovecot@procontrol.fi
> Subject: Re: [Dovecot] Multiple auth howto
>
> On Tue, 2003-06-17 at 21:13, ohp@pyrenet.fr wrote:
> > Howdi.
> >
> > I'm new to dovcot (just succeded in compiling on unixware 713 today)
> > I'm noww configuring for tests on other port. The sample configuration
> > file is pretty well documented, however, I don't understand how I can
> > firstt authenticate against passwd/shadow if not found against pgsql.
> >
> > What's the syntax?
>
> Well, short answer: You can't. Put them all to one place (eg. pgsql),
> maybe using some automated scripts. I don't know if I should even
> consider about supporting fallbacking..
>
>
Hi Timo,  Thanks for your answer.
The reason I came to dovcot is that I thought it was possible. I've benn
researching this for weeks now. First thought that cyrus would do that, it
does but though SASL and pam whitch I don't have.

How difficult would it be to implement a fallback?

Regards
 --
Olivier PRENANT         	Tel:	+33-5-61-50-97-00 (Work)
Quartier d'Harraud Turrou           +33-5-61-50-97-01 (Fax)
31190 AUTERIVE                      +33-6-07-63-80-64 (GSM)
FRANCE                      Email: ohp@pyrenet.fr
------------------------------------------------------------------------------
Make your life a dream, make your dream a reality. (St Exupery)
From dovecot@andreas.hanssen.name  Wed Jun 18 14:21:17 2003
Return-Path: <dovecot@andreas.hanssen.name>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 5CB5423865; Wed, 18 Jun 2003 14:21:17 +0300 (EEST)
Received: from lexx.infeline.org (unknown [217.144.230.27])
	by danu.procontrol.fi (Postfix) with SMTP id 5113F2384C
	for <dovecot@procontrol.fi>; Wed, 18 Jun 2003 14:21:12 +0300 (EEST)
Received: (qmail 10000 invoked from network); 18 Jun 2003 11:21:09 -0000
Received: from localhost (HELO shusaku.troll.no) (andreaha@127.0.0.1)
  by localhost with SMTP; 18 Jun 2003 11:21:09 -0000
Date: Wed, 18 Jun 2003 13:21:08 +0200 (CEST)
From: Andreas Aardal Hanssen <dovecot@andreas.hanssen.name>
Sender: ahanssen@shusaku.troll.no
To: Dovecot mailing list <dovecot@procontrol.fi>
Subject: Re: [Dovecot] Multiple auth howto
In-Reply-To: <Pine.UW2.4.53.0306181301380.10798@server.pyrenet.fr>
Message-ID: <Pine.LNX.4.44.0306181319060.29812-100000@shusaku.troll.no>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 18 Jun 2003 11:21:17 -0000
X-UID: 964                                                  
Status: O

On Wed, 18 Jun 2003 ohp@pyrenet.fr wrote:
>> Well, short answer: You can't. Put them all to one place (eg. pgsql),
>> maybe using some automated scripts. I don't know if I should even
>> consider about supporting fallbacking..
>Hi Timo,  Thanks for your answer.
>The reason I came to dovcot is that I thought it was possible. I've benn
>researching this for weeks now. First thought that cyrus would do that, it
>does but though SASL and pam whitch I don't have.
>How difficult would it be to implement a fallback?

Does this tool do what you want? (checkpassword only though, but I bet you 
will find checkpassword compatible authenticators that suit your needs):

http://www.andreas.hanssen.name/software/multichkpwds.c

-- 
Andreas Aardal Hanssen


From lfarkas@bnap.hu  Wed Jun 18 14:35:52 2003
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id A43C823865; Wed, 18 Jun 2003 14:35:52 +0300 (EEST)
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 1A7FC2384C
	for <dovecot@procontrol.fi>; Wed, 18 Jun 2003 14:35:47 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id B5558754010
	for <dovecot@procontrol.fi>; Wed, 18 Jun 2003 13:35:17 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP
	id B77AC3ECF; Wed, 18 Jun 2003 13:35:42 +0200 (CEST)
Received: from bnap.hu (garfield.int.bppiac.hu [192.168.0.50])
	by mail2.bppiac.hu (Postfix) with ESMTP id 9DA493EC5
	for <dovecot@procontrol.fi>; Wed, 18 Jun 2003 13:35:42 +0200 (CEST)
Message-ID: <3EF04E8C.4060703@bnap.hu>
Date: Wed, 18 Jun 2003 13:35:40 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.3) Gecko/20030313
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
Subject: [Dovecot] imaps now works!
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 18 Jun 2003 11:35:52 -0000
X-UID: 965                                                  
Status: O

thanks!
-- 
   Levente                               "Si vis pacem para bellum!"


From tss@iki.fi  Wed Jun 18 15:31:39 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id F0C5D238B6; Wed, 18 Jun 2003 15:31:38 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 0344D23860
	for <dovecot@procontrol.fi>; Wed, 18 Jun 2003 15:31:37 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id C10D765EA9E0; Wed, 18 Jun 2003 15:31:36 +0300 (EEST)
Subject: Re: [Dovecot] Multiple auth howto
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <Pine.UW2.4.53.0306181301380.10798@server.pyrenet.fr>
References: <Pine.UW2.4.53.0306172009300.12039@server.pyrenet.fr>
	 <1055874643.10262.115.camel@hurina>
	 <Pine.UW2.4.53.0306181301380.10798@server.pyrenet.fr>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1055939496.10262.163.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 18 Jun 2003 15:31:36 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 18 Jun 2003 12:31:39 -0000
X-UID: 966                                                  
Status: O

On Wed, 2003-06-18 at 14:05, ohp@pyrenet.fr wrote:
> > Well, short answer: You can't. Put them all to one place (eg. pgsql),
> > maybe using some automated scripts. I don't know if I should even
> > consider about supporting fallbacking..
> >
> >
> Hi Timo,  Thanks for your answer.
> The reason I came to dovcot is that I thought it was possible. I've benn
> researching this for weeks now. First thought that cyrus would do that, it
> does but though SASL and pam whitch I don't have.
> 
> How difficult would it be to implement a fallback?

Not very. I'm mostly concerned about what happens if the user exists in
both authenticators. I guess normally this shouldn't happen, but you
can't really guarantee that and mistakes happen..

If fallbacking happened only when user isn't found from first
authenticator, that could work a bit more safely, but I'm not sure if I
can know with PAM if check failed because user wasn't found or because
password didn't match.

From bradf@mailgate.tpi.com  Wed Jun 18 08:28:31 2003
Return-Path: <bradf@mailgate.tpi.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id E07BD23993; Wed, 18 Jun 2003 08:28:31 +0300 (EEST)
Received: from mailgate.tpi.com (ftp.tpi.com [198.107.51.136])
	by danu.procontrol.fi (Postfix) with ESMTP id 612BE2384C
	for <dovecot@procontrol.fi>; Wed, 18 Jun 2003 08:28:28 +0300 (EEST)
Received: from triplepoint.com ([10.0.5.2]) by mailgate.tpi.com
          (Post.Office MTA v3.5.3 release 223 ID# 0-60229U100L100S0V35)
          with ESMTP id com for <dovecot@procontrol.fi>;
          Tue, 17 Jun 2003 22:28:26 -0700
Message-ID: <3EEFF80C.2050200@triplepoint.com>
Date: Tue, 17 Jun 2003 22:26:36 -0700
From: Brad Figg <brad@triplepoint.com>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.4a) Gecko/20030401
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] 0.99.10-test12
References: <1055649482.10262.17.camel@hurina>
	<3EEFB6DF.3020606@triplepoint.com> <1055897847.10262.120.camel@hurina>
In-Reply-To: <1055897847.10262.120.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
X-Mailman-Approved-At: Wed, 18 Jun 2003 15:32:00 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 18 Jun 2003 05:28:32 -0000
X-UID: 967                                                  
Status: O

The log file contains:

dovecot: Jun 17 11:27:39 Error: child 3492 (imap) killed with signal 11
dovecot: Jun 17 17:44:56 Error: child 5906 (imap) killed with signal 11
dovecot: Jun 17 17:45:11 Error: child 5950 (imap) killed with signal 11

for each attempted delete or move. I deleted all
index files and still have the same problem.

Brad


Timo Sirainen wrote:
> On Wed, 2003-06-18 at 03:48, Brad Figg wrote:
> 
>>I just upgraded from 0.99.6 to 0.99.10-test12
>>and I can no longer delete messages or move
>>messages between folders from Mozilla. What
>>information can I provide to you to help debug
>>this?
> 
> 
> Anything in log file? There could be some index file incompatibilities
> though, so you could try deleting them (.imap.index*).
> 

-- 
Brad Figg - brad@triplepoint.com 503.601.0235 ext. 105
TriplePoint, Inc. - http://www.triplepoint.com

From tss@iki.fi  Wed Jun 18 15:35:41 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id A7CCC238CB; Wed, 18 Jun 2003 15:35:41 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 23016238B6
	for <dovecot@procontrol.fi>; Wed, 18 Jun 2003 15:35:40 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id EA12365EA9E0; Wed, 18 Jun 2003 15:35:39 +0300 (EEST)
Subject: Re: [Dovecot] 0.99.10-test12
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <3EEFF80C.2050200@triplepoint.com>
References: <1055649482.10262.17.camel@hurina>
	<1055897847.10262.120.camel@hurina>
	<3EEFF80C.2050200@triplepoint.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1055939739.10241.167.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 18 Jun 2003 15:35:39 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 18 Jun 2003 12:35:41 -0000
X-UID: 968                                                  
Status: O

On Wed, 2003-06-18 at 08:26, Brad Figg wrote:
> The log file contains:
> 
> dovecot: Jun 17 11:27:39 Error: child 3492 (imap) killed with signal 11
> dovecot: Jun 17 17:44:56 Error: child 5906 (imap) killed with signal 11
> dovecot: Jun 17 17:45:11 Error: child 5950 (imap) killed with signal 11
> 
> for each attempted delete or move. I deleted all
> index files and still have the same problem.

See "debugging crashes" in:

http://dovecot.procontrol.fi/bugreport.html

That should tell why it's crashing.

From tom@replic8.net  Wed Jun 18 18:02:40 2003
Return-Path: <tom@replic8.net>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 619BA238C5; Wed, 18 Jun 2003 18:02:40 +0300 (EEST)
Received: from rpunkt.kicks-ass.net (p50860B4B.dip0.t-ipconnect.de
	[80.134.11.75])
	by danu.procontrol.fi (Postfix) with ESMTP id 11B7B238B6
	for <dovecot@procontrol.fi>; Wed, 18 Jun 2003 18:02:32 +0300 (EEST)
Received: from localhost (localhost [127.0.0.1])
	by rpunkt.kicks-ass.net (Postfix) with ESMTP
	id 83A36416F4; Wed, 18 Jun 2003 15:02:24 +0000 (GMT)
Received: from rpunkt.kicks-ass.net ([127.0.0.1])
 by localhost (commbox [127.0.0.1]) (amavisd-new, port 10024) with LMTP
 id 07659-03; Wed, 18 Jun 2003 15:02:23 +0000 (GMT)
Received: from aural (unknown [192.168.100.88])
	(using TLSv1 with cipher EDH-RSA-DES-CBC3-SHA (168/168 bits))
	(No client certificate requested)
	by rpunkt.kicks-ass.net (Postfix) with ESMTP
	id 3B099416E4; Wed, 18 Jun 2003 15:02:22 +0000 (GMT)
Date: Wed, 18 Jun 2003 17:01:25 +0200
From: tom hensel <tom@replic8.net>
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] 0.99.10-test13
Message-Id: <20030618170125.462bb97c.tom@replic8.net>
In-Reply-To: <1055900521.10241.147.camel@hurina>
References: <1055900521.10241.147.camel@hurina>
X-Mailer: Sylpheed version 0.9.2 (GTK+ 1.2.10; i386--netbsdelf)
Mime-Version: 1.0
Content-Type: multipart/signed; protocol="application/pgp-signature";
 micalg="pgp-sha1"; boundary="=.Be5dKFWzhEq.X3"
X-Virus-Scanned: by amavisd-new at rpdnet.com
cc: tech-pkg@netbsd.org
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 18 Jun 2003 15:02:40 -0000
X-UID: 969                                                  
Status: O
Content-Length: 5521

--=.Be5dKFWzhEq.X3
Content-Type: multipart/mixed;
 boundary="Multipart_Wed__18_Jun_2003_17:01:25_+0200_09295400"


--Multipart_Wed__18_Jun_2003_17:01:25_+0200_09295400
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

hi,

> - Hopefully OpenSSL is fixed :)

you did it. works like a charm now on NetBSD, thanks a lot!

pkgsrc for 0.99.10-test13 attached and cced to the maintainer.

bye,
TOM

--Multipart_Wed__18_Jun_2003_17:01:25_+0200_09295400
Content-Type: application/octet-stream;
 name="pkgsrc_dovecot-0.99.10-test13.tar.gz"
Content-Disposition: attachment;
 filename="pkgsrc_dovecot-0.99.10-test13.tar.gz"
Content-Transfer-Encoding: base64

H4sIACd+8D4AA+0ca3faxrJf0a/Y2j5tUge9BTb30toxxOEW2xRw2p62h7NIC6gWkqoVjmmO//ud
XT3M05Bcm96T7CTByu7s7Oy8tDvewQluiR3EXz0nqKqpli0LfnJY/Jk8l0tlUy1phmFAu6bp5dJX
1rNylcKExjhC6KsoeFwK70eEeLtgaLfgJPpXzt51nm2ObfVvGFbJMk2u/7JpCP3vAGb0r7Q3iOBT
QdVUtcT1ukb/JYPrXzWNsmGxdk0HQ/hKfQ5mFuEL138lpCS6JVEF+4Fv39KTYYTDEMsT370r4iH7
WbzxZIdUFOhlQpL+aZYFPCHM+T8JA+rGQTR92jk2+r9uLvq/qamW8P8dQHgzpJGtjLHrKaktCAf/
gmDW/+t+HLmEPvkcm/zfUEuL+z941IX/7wCUWr1z1lY0mf9RfiYOusBTpJlINStauWJoSAcNKYqk
tJqNTncrTMelsesPgm2Qa8rA9QhVFP4c4tgepf9TLvANYZ1ARlcuAh/9Z+IjrYQ0q6IeVXQ1JyEi
1idD5v+ZrJ9jjg3+b6pGKTv/q6aV+L+qq8L/dwD76OCSxK87tQrKTODVLQKHS5xLLSmqjlStoh1V
zCP0J7VHeDLGqH4XogNpX5JqEBMuTy/q1UJqSUVVPj6WNbUYExprhnR22q2fX7Ub9U61wHYZ0sVp
p1tv9zqNLmsaxXFYUbKthxxGgR3Aayjw5IGrMBKKJLVOu2dvswEHH2YJ3Ev7vPdNo8k6BxEhferI
PIygAYHP5FmCaRuXXfhXb1cLMbFHRdj5nPgkZuhBNJTeXl3UW6fn9Q0sSWdXFxf1y2610CH2JCKo
cXHaQth3UOuqZaDkMCVJ15167/V1o1lrNi5/1KuFX+sd3tZsvO5eXTUfGlo/njcuO93TZrOKWNv5
5XXv7OryTeP8ul1P0KR0UO/qXb3dbtTqTAg/t3/stM/uFc/tx0HgSVI+qHfaPu8cVgvFIp1S4Hzg
uFH14ANM1Ov82mFotUb7fhW+F9jYA3eICRui3OJoFdZ7Nx4VKfU4DkhYCULiw//BFoDBs6tuj60L
1tFtdn6oFi6vJEl2B+hrMg7j6YtlnMrFb79O//itTv74rUP/eLlqSuLjvkfYpNWhP4k9ChR925s4
BO3JsgJ/KVOGG0+VpF/pT1zP8Vz/RpfHN3uSTDxKliijFOYmyFazdoYUYXkK33EH80Jo1k5bj4uA
YWwhAC5zz8HhElsOjnEfU3hlMr4YyjaMtc47PzUf54yjbMtaOKR/edJZq/WmeXoOflgoNg4+5Pbf
YwanpIwrCe76dcAZNB5GBJCKYNzrVsO4diBc+cR5wdgFx+6WXqJvvsnWkjcuroGz1avV3zD+Czna
I3bnhrelfOL2Wa0HO6ZGq9vJY96ccNs/PLRnzeftq+vWTDtzRt7GA9oc1j3vZHTm+ljDfWURt1Kp
JRR//50HIoUFIXieUBaE6ucgeFgjOH+7/qbxy71CRzgiCrnD45DtuTJ22NJ7aQg9+MCH3efxj4UQ
GUSNJ16MluLIHJokMeUV2aM7hOBYkQontoPyaAXqKXD4XSq8KBTyZxbU392j7A2S8sdJrmyEgO0O
/5WO7NRr9zAFZ7/XuX7d6fZ409qB6Hs+srAK4V8pRy/Tpbg+xEPPg4UcfEjjdK922j3lJo0yWS32
3j8sWVk1S8r5I4J+nKKdU/1uJQ+JfS6OGd/YJIplOnoYs+SG4xuFvz9vhtzb/undiYDnhmz/z4+B
zzTHxvO/obP9f0k1TM1Kfv+na4Ym9v87gPT9gVyKMKLJlpbtZu1gHGI7fnirpFtb9H7kwtYa0F0f
xSOCCI68KQIhDgmVAvZSviUe7EXGxI9lhBoxopMwDKKYwgHDZbtGyicY94M7NAiiMY7ThgnQBQKM
KJtVujUR7L1j2H17KAlTrj9EnU5TgV0jI926LWXEOf8eDVJE4sgidm0Fmf9nKZvnmGOT/5ul/Pyv
qaUyP/9rekn4/w4gP/1nBsBP//xPmgGwlNmsHcVekJ7+pc7bUw29WH3ul0Gq8vDvl6iKsKWpA404
jq7ivqoO9CPdPNK0I1w2tWNi4gHua7qpY6nj/k22oFfWjy2rjPpT6El54Gf8Isasm1hOGZtl0zkq
w4fhlCydaH1LIxZRtdKRpZaObB0PjuaH9tlQvYTNozIZ6I52fFS2jwdAgAxgNlNXDfWYWXFpUHas
zyi2ZP7Pk7vPNMcG/wdnt5bf/yXh/7uAE3jRs1f1QxqQW8L2UYBlgCJbdvLDJBzayR3Jjyj5UQVP
4tFSpzvGYdELhq6/smupMQxCYw0+65Jo3/VzTpLT7sxxSWE8yPHdqq7s0IpjN/DX4DiEusN1na7v
kLs1fSzxWaRxELFd0jocOPa52LYJXYfhD2Z7Fk/xq8+Rj+PynFJydN+AmGa9ZHszKk/wPEo0P4lK
J7AfjMZoTV5irndGElnHggl8RmF5Z5CphP8S7pnm2Pb+3+z9L1PVxf2/HcCc/p/pFugn6N9QDUvo
fwewpP9nuAX6Cfc/jbIl9n+7AHH/88uGFf7/5LdAN/p/kv+d9X9LV4X/7wJW3P9MbEG4+RcBy/7/
9LdAN7//taX736Yp7n/uAvKsAR1tdVtThIXPC+b9/8EYnnIO5v+Pnf9MS13M/5qmZQj/3wHsf30y
c6Op13lbbzZPpH1p5l7og1FsnxXel4BCq331rlGr5xSgqV3/6brRhqbaaf3i6hI1r84bl5IkIyXN
I9NJP5IkH49JdS8dtidF9i2OqgesVWL5auw71b2T5FLTicJzvgcfWO894JK/Jm5EnB63aIY2d2Hp
ROFkeHpyT5K8ADu9yO4l2V+UTBFN/KSNz4T2DrTP9yZMnj1PLt4/yxwfU/8NJ3+e/yvrZZH/2QEs
6P9ZMoCfkv8zSiL/uwtYof8nzwB+Qv7PNFTx/t8FiPzflw0r/f+JM4Cb839L9d+WZYj6713Aqvxf
agvC0b8AWOX/T50B3OT/2rL/m+WyqP/cBSjZ1cmtCruzy5IiVfi5wKL/Zxp+yjk2+L9l6Svyf2L/
vxPIs3yZ4j/i/nexWFxfZVdgo4uqCX8hOrDRuiXnOz50qEK/dHh4uJJCOtgqagZSSxVVrWilpcEn
J6iovdLK6BA+LXRyIqH9fZQVtGiyiubudCKWEJQQIKFaWs14i70JoQhHBNFR8N5HeBCTCBFsj5K+
V8iNv6XIB3pZXhHFAZr46a1ZqbiPsD/NylY81ydUBvHYJORTAm48cpMZQMAj+orhTb+F//4Jhoey
G4+MDiukhVmwh9K7mxT1Cat4YWWxDgJqeV0lCjh5mKo7SgnD3DQGtBGJCOcKsAZBNDOmWAwjMnDv
qsqERmiuOpwlX9HK+m+gtKLim9VHHz7NyvmyGbGPXHmiyNeAgIAtYrPTCnrPVs+mZldtCYomfuyO
AQHHGAbsM3I9wEZVxBanQH++503otdJ6I2CLoPfYjxmxPuG1T8BQheEgdjGZf1DE7hzzD6bBMB9c
ncGRDpfa+U1lPl+jhUBHowAEgh0nIpQ+rIEr1GdlVqkefVhlovVGZpT2JIrADL0pIwaHNur2vUQA
IbHdwRTxS8Ug54w8U9Led3spcV7EhT2PlVKZ8AzGP8A24HDf0suvwLd0Cz65b/F19lK2qih1JZey
GumsLCurx5JBHmAlIO2kuwrsSofzLVOw+0Tq9QtEwKUcUPYvsqUe59TYNWF34NpgkrxGLIzcW/Z8
Q6bc9rk9savJMLJPQE6E0XOiIAyZ/bCYzseA5w8JmCANYCgJuckCDR4SwJvB9hzOVH/KjDrw4WkS
cyEcaUwI5eNUCPzqearHhPn6HbEnMR/N/IffHofFc8QeeegEmwO/Ux65AH+4alD+W45HBnI+rsFG
eWyiieNzr+Tcsi+wYJfKebBgleFgFWBwfeIFICMYgtEwCiZhYnqMVuB7U4h8aITBgfmN9DQQTmgS
ANMvxEg7+Xzsaj2YopuIIJs0CdJ6iQlR080FKT44wlzgwH1YI3gvUwiPA7zO8H+T80zhwMfJeWYg
43Sfv2RYJWO2RJIs0tBUtkhDPcr8ZX+tgQDfTH1bmgcwvIz9qF0kE3dIjMb4Ts4YRZTVV4Hgx2SI
efWUjC5Y6Elj+JiMWRAdBhCVQQtjIPTiJYif0eK/TOP+A2YB78qJ5/jfMgOJxknhJrllsWqQBH3P
Hbu8JJMS5n8kjqdo5A5HSVwxdO5Thna8laSYArZUMEhqGftRzf6fS6psvtJgu2OUdfaTywohdAuc
s4RNJX9a8L4EjdV2oH+nv9lk7+DvK4h93wgwR+ClOPMtAg9VIHwgL+BYHIlRK/lijs5PTZR9W8cy
qZniD17x0wsxpU6fOTseS4eLTZS+dx5TPsffrPy5GqPDFaPWGsHcyG2NAdCShSQYPY5RRbpVEmde
AQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIE/GPwX2LR1Y0AeAAA

--Multipart_Wed__18_Jun_2003_17:01:25_+0200_09295400--

--=.Be5dKFWzhEq.X3
Content-Type: application/pgp-signature

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.2 (NetBSD)

iD8DBQE+8H7FZj9fGW5yU88RAgVuAJ0aV5rW/US9b+p4/ShjCN7wxZdkZwCcDlF+
aqD0s4MipHR0MiofFQ5HVuw=
=Fe/j
-----END PGP SIGNATURE-----

--=.Be5dKFWzhEq.X3--
From bradf@mailgate.tpi.com  Thu Jun 19 01:11:31 2003
Return-Path: <bradf@mailgate.tpi.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id A9CE423865; Thu, 19 Jun 2003 01:11:31 +0300 (EEST)
Received: from mailgate.tpi.com (ftp.tpi.com [198.107.51.136])
	by danu.procontrol.fi (Postfix) with ESMTP id 4968D2384C
	for <dovecot@procontrol.fi>; Thu, 19 Jun 2003 01:11:27 +0300 (EEST)
Received: from tpi.com ([10.0.5.66]) by mailgate.tpi.com
          (Post.Office MTA v3.5.3 release 223 ID# 0-60229U100L100S0V35)
          with ESMTP id com; Wed, 18 Jun 2003 15:11:20 -0700
Message-ID: <3EF0E3A4.3070605@tpi.com>
Date: Wed, 18 Jun 2003 15:11:48 -0700
From: Brad Figg <brad@tpi.com>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.4a) Gecko/20030401
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Timo Sirainen <tss@iki.fi>
Subject: Re: [Dovecot] 0.99.10-test12
References: <1055649482.10262.17.camel@hurina>
	<1055897847.10262.120.camel@hurina>	<3EEFF80C.2050200@triplepoint.com>
	<1055939739.10241.167.camel@hurina>
In-Reply-To: <1055939739.10241.167.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 18 Jun 2003 22:11:31 -0000
X-UID: 970                                                  
Status: O
Content-Length: 2136

 From the core file backtrace:

#0  _vstrconcat (str1=0x17 <Address 0x17 out of bounds>, args=0xbffffaec "", ret_len=0x809922f)
     at strfuncs.c:262
262                     while (*str != '\0' && p != temp_end)
(gdb) bt
#0  _vstrconcat (str1=0x17 <Address 0x17 out of bounds>, args=0xbffffaec "", ret_len=0x809922f)
     at strfuncs.c:262
#1  0x0808ce88 in t_strconcat (str1=0x80a7518 "/home/brad/Maildir") at strfuncs.c:354
#2  0x0805bbf3 in hardlink_messageset (ctx=0x80a8f80, src=0x80a7580, dest=0x80a8c48)
     at maildir-copy.c:97
#3  0x0805bdb1 in copy_with_hardlinks (src=0x80a7580, dest=0x80a8c48, messageset=0x80a2048 "60",
     uidset=1) at maildir-copy.c:158
#4  0x0805bed3 in maildir_storage_copy (box=0x80a7580, destbox=0x80a8c48,
     messageset=0x80a2048 "60", uidset=1) at maildir-copy.c:192
#5  0x080516e1 in cmd_copy (client=0x80a1d80) at cmd-copy.c:31
#6  0x0805414a in cmd_uid (client=0x80a1d80) at cmd-uid.c:19
#7  0x08054878 in client_handle_input (client=0x80a1d80) at client.c:314
#8  0x08054999 in _client_input (context=0x80a1d80) at client.c:350
#9  0x08087b89 in io_loop_handler_run (ioloop=0x80a1400) at ioloop-poll.c:214
#10 0x08087529 in io_loop_run (ioloop=0x80a1400) at ioloop.c:258
#11 0x0805a6d5 in main (argc=1, argv=0xbffffce4, envp=0xbffffcec) at main.c:179
#12 0x4003e857 in __libc_start_main () from /lib/libc.so.6
(gdb) p p
$1 = 0x809922f ""
(gdb) p temp_end
$2 = 0x8099417 "itted."
(gdb) p str
$3 = 0x1 <Address 0x1 out of bounds>


Timo Sirainen wrote:
> On Wed, 2003-06-18 at 08:26, Brad Figg wrote:
> 
>>The log file contains:
>>
>>dovecot: Jun 17 11:27:39 Error: child 3492 (imap) killed with signal 11
>>dovecot: Jun 17 17:44:56 Error: child 5906 (imap) killed with signal 11
>>dovecot: Jun 17 17:45:11 Error: child 5950 (imap) killed with signal 11
>>
>>for each attempted delete or move. I deleted all
>>index files and still have the same problem.
> 
> 
> See "debugging crashes" in:
> 
> http://dovecot.procontrol.fi/bugreport.html
> 
> That should tell why it's crashing.
> 

-- 
Brad Figg - brad@triplepoint.com 503.601.0235 ext. 105
TriplePoint, Inc. - http://www.triplepoint.com

From tss@iki.fi  Thu Jun 19 01:24:23 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 225502387A; Thu, 19 Jun 2003 01:24:23 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 3763023860
	for <dovecot@procontrol.fi>; Thu, 19 Jun 2003 01:24:20 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 5AAE9651139F; Thu, 19 Jun 2003 01:24:09 +0300 (EEST)
Subject: Re: [Dovecot] 0.99.10-test12
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <3EF0E3A4.3070605@tpi.com>
References: <1055649482.10262.17.camel@hurina>
	<3EEFF80C.2050200@triplepoint.com>
	<1055939739.10241.167.camel@hurina>  <3EF0E3A4.3070605@tpi.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1055975049.880.25.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 19 Jun 2003 01:24:09 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 18 Jun 2003 22:24:23 -0000
X-UID: 971                                                  
Status: O

On Thu, 2003-06-19 at 01:11, Brad Figg wrote:
>  From the core file backtrace:
> 
> #2  0x0805bbf3 in hardlink_messageset (ctx=0x80a8f80, src=0x80a7580, dest=0x80a8c48)
>      at maildir-copy.c:97

Thanks. Hardlink-copying crashed. Fixed in test14 now.

From bradf@mailgate.tpi.com  Thu Jun 19 01:36:16 2003
Return-Path: <bradf@mailgate.tpi.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 9B53623860; Thu, 19 Jun 2003 01:36:16 +0300 (EEST)
Received: from mailgate.tpi.com (ftp.tpi.com [198.107.51.136])
	by danu.procontrol.fi (Postfix) with ESMTP id 7D2072384C
	for <dovecot@procontrol.fi>; Thu, 19 Jun 2003 01:36:14 +0300 (EEST)
Received: from tpi.com ([10.0.5.66]) by mailgate.tpi.com
          (Post.Office MTA v3.5.3 release 223 ID# 0-60229U100L100S0V35)
          with ESMTP id com; Wed, 18 Jun 2003 15:36:13 -0700
Message-ID: <3EF0E976.9090002@tpi.com>
Date: Wed, 18 Jun 2003 15:36:38 -0700
From: Brad Figg <brad@tpi.com>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.4a) Gecko/20030401
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Timo Sirainen <tss@iki.fi>
Subject: Re: [Dovecot] 0.99.10-test12
References: <1055649482.10262.17.camel@hurina>
	<3EEFF80C.2050200@triplepoint.com>	<1055939739.10241.167.camel@hurina>
	<3EF0E3A4.3070605@tpi.com> <1055975049.880.25.camel@hurina>
In-Reply-To: <1055975049.880.25.camel@hurina>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Wed, 18 Jun 2003 22:36:16 -0000
X-UID: 972                                                  
Status: O

Thanks, that fixed my problems.

Brad

Timo Sirainen wrote:
> On Thu, 2003-06-19 at 01:11, Brad Figg wrote:
> 
>> From the core file backtrace:
>>
>>#2  0x0805bbf3 in hardlink_messageset (ctx=0x80a8f80, src=0x80a7580, dest=0x80a8c48)
>>     at maildir-copy.c:97
> 
> 
> Thanks. Hardlink-copying crashed. Fixed in test14 now.
> 

-- 
Brad Figg - brad@triplepoint.com 503.601.0235 ext. 105
TriplePoint, Inc. - http://www.triplepoint.com

From mg@munge.com  Thu Jun 19 03:00:31 2003
Return-Path: <mg@munge.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id F22BD23865; Thu, 19 Jun 2003 03:00:30 +0300 (EEST)
Received: from bcs-mail.internal.cacheflow.com (unknown [216.52.23.69])
	by danu.procontrol.fi (Postfix) with ESMTP id ADA4623860
	for <dovecot@procontrol.fi>; Thu, 19 Jun 2003 03:00:26 +0300 (EEST)
Received: from webmail.bluecoat.com ([216.52.23.20]) by
	bcs-mail.internal.cacheflow.com with Microsoft SMTPSVC(5.0.2195.5329);
	Wed, 18 Jun 2003 17:00:23 -0700
Received: from tomahawk ([10.9.44.70]) by webmail.bluecoat.com with Microsoft
	SMTPSVC(5.0.2195.5329);	 Wed, 18 Jun 2003 17:00:22 -0700
Message-ID: <00fd01c335f5$c77c2f10$462c090a@internal.cacheflow.com>
From: "Mike Grupenhoff" <mg@munge.com>
To: <dovecot@procontrol.fi>
Date: Wed, 18 Jun 2003 17:00:22 -0700
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: 7bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2800.1158
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2800.1165
X-OriginalArrivalTime: 19 Jun 2003 00:00:22.0719 (UTC)
	FILETIME=[C785A4F0:01C335F5]
Subject: [Dovecot] \0\n at end of lines
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Thu, 19 Jun 2003 00:00:31 -0000
X-UID: 973                                                  
Status: O

Since upgrading to -test11, mail fetched from imap has every line terminated
with a nul and a newline ("\0\n").  This also happens with -test12.  It
seems to happen with both mbox and maildir.

I'm running on NetBSD/sparc (NetBSD-current as of April 1, 1.6Q).

If it matters, I have "mail_save_crlf" set to "no" and "mail_read_mmaped"
also set to "no".  I can't find any other options that look like they could
be relevant.

Any ideas?

Thanks,

mike

From tss@iki.fi  Thu Jun 19 03:45:43 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 5537323865; Thu, 19 Jun 2003 03:45:43 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 23A712384C
	for <dovecot@procontrol.fi>; Thu, 19 Jun 2003 03:45:39 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 23DCA5C62AEF; Thu, 19 Jun 2003 03:45:38 +0300 (EEST)
Subject: Re: [Dovecot] \0\n at end of lines
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <00fd01c335f5$c77c2f10$462c090a@internal.cacheflow.com>
References: <00fd01c335f5$c77c2f10$462c090a@internal.cacheflow.com>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1055983537.880.33.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 19 Jun 2003 03:45:37 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Thu, 19 Jun 2003 00:45:43 -0000
X-UID: 974                                                  
Status: O

On Thu, 2003-06-19 at 03:00, Mike Grupenhoff wrote:
> Since upgrading to -test11, mail fetched from imap has every line terminated
> with a nul and a newline ("\0\n").  This also happens with -test12.  It
> seems to happen with both mbox and maildir.
> 
> I'm running on NetBSD/sparc (NetBSD-current as of April 1, 1.6Q).

Whops. It was broken with big endian systems. Here's a fix:

diff -u -r1.18 message-send.c
--- src/lib-mail/message-send.c 4 Jun 2003 15:57:58 -0000       1.18
+++ src/lib-mail/message-send.c 19 Jun 2003 00:44:39 -0000
@@ -16,7 +16,8 @@
        uoff_t old_limit, limit;
        size_t i, size;
        off_t ret;
-       int cr_skipped, add;
+       int cr_skipped;
+       unsigned char add;
 
        if (last_cr != NULL)
                *last_cr = -1;

From ohp@pyrenet.fr  Thu Jun 19 17:26:44 2003
Return-Path: <ohp@pyrenet.fr>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 90F3A23865; Thu, 19 Jun 2003 17:26:44 +0300 (EEST)
Received: from server.pyrenet.fr (server.pyrenet.fr [194.250.190.1])
	by danu.procontrol.fi (Postfix) with ESMTP id CBA4A23860
	for <dovecot@procontrol.fi>; Thu, 19 Jun 2003 17:26:39 +0300 (EEST)
Received: from localhost (localhost [127.0.0.1])
	by localhost.pyrenet.fr (Postfix) with ESMTP id 1129927131
	for <dovecot@procontrol.fi>; Thu, 19 Jun 2003 16:26:36 +0200 (MET DST)
Received: from server.pyrenet.fr ([127.0.0.1])
 by localhost (server [127.0.0.1]) (amavisd-new, port 10024) with ESMTP
 id 10890-01 for <dovecot@procontrol.fi>;
 Thu, 19 Jun 2003 16:26:34 +0200 (MET DST)
Received: from server.pyrenet.fr (server.pyrenet.fr [194.250.190.1])
	by server.pyrenet.fr (Postfix) with ESMTP id 4A68A27130
	for <dovecot@procontrol.fi>; Thu, 19 Jun 2003 16:26:34 +0200 (MET DST)
Date: Thu, 19 Jun 2003 16:26:34 +0200 (MET DST)
From: ohp@pyrenet.fr
To: dovecot@procontrol.fi
In-Reply-To: <20030618223624.7832A23887@danu.procontrol.fi>
Message-ID: <Pine.UW2.4.53.0306191626230.9034@server.pyrenet.fr>
References: <20030618223624.7832A23887@danu.procontrol.fi>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-Virus-Scanned: by amavisd-new
Subject: [Dovecot] Re: dovecot Digest, Vol 2, Issue 15
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
Reply-To: ohp@pyrenet.fr
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Thu, 19 Jun 2003 14:26:44 -0000
X-UID: 975                                                  
Status: O
Content-Length: 3189

>
>Message: 2
>Date: Wed, 18 Jun 2003 13:21:08 +0200 (CEST)
>From: Andreas Aardal Hanssen <dovecot@andreas.hanssen.name>
>Subject: Re: [Dovecot] Multiple auth howto
>To: Dovecot mailing list <dovecot@procontrol.fi>
>Message-ID:
>	<Pine.LNX.4.44.0306181319060.29812-100000@shusaku.troll.no>
>Content-Type: TEXT/PLAIN; charset=US-ASCII
>
>On Wed, 18 Jun 2003 ohp@pyrenet.fr wrote:
>>> Well, short answer: You can't. Put them all to one place (eg. pgsql),
>>> maybe using some automated scripts. I don't know if I should even
>>> consider about supporting fallbacking..
>>Hi Timo,  Thanks for your answer.
>>The reason I came to dovcot is that I thought it was possible. I've benn
>>researching this for weeks now. First thought that cyrus would do that, it
>>does but though SASL and pam whitch I don't have.
>>How difficult would it be to implement a fallback?
>
>Does this tool do what you want? (checkpassword only though, but I bet you
>will find checkpassword compatible authenticators that suit your needs):
>
>http://www.andreas.hanssen.name/software/multichkpwds.c
It surely is interesting bu I'd rather see modules inside the server,
see below
>
>--
>Andreas Aardal Hanssen
>
>
>
>------------------------------
>Message: 4
>Date: 18 Jun 2003 15:31:36 +0300
>From: Timo Sirainen <tss@iki.fi>
>Subject: Re: [Dovecot] Multiple auth howto
>To: dovecot@procontrol.fi
>Message-ID: <1055939496.10262.163.camel@hurina>
>Content-Type: text/plain
>
>On Wed, 2003-06-18 at 14:05, ohp@pyrenet.fr wrote:
>> > Well, short answer: You can't. Put them all to one place (eg. pgsql),
>> > maybe using some automated scripts. I don't know if I should even
>> > consider about supporting fallbacking..
>> >
>> >
>> Hi Timo,  Thanks for your answer.
>> The reason I came to dovcot is that I thought it was possible. I've benn
>> researching this for weeks now. First thought that cyrus would do that, it
>> does but though SASL and pam whitch I don't have.
>>
>> How difficult would it be to implement a fallback?
>
>Not very. I'm mostly concerned about what happens if the user exists in
>both authenticators. I guess normally this shouldn't happen, but you
>can't really guarantee that and mistakes happen..
Yes mistakes happen. Why could'nt you (we?) do like proftpd that has a
parameter that give the order of authenticators first one wins.

That way you could even have the same user as a real and virtual account
with differents passwords
>
>If fallbacking happened only when user isn't found from first
>authenticator, that could work a bit more safely, but I'm not sure if I
>can know with PAM if check failed because user wasn't found or because
>password didn't match.
I don't know either. My idea is to get rid of PAM for that's although
fantastic on the paper is a Linux thing that I can't even compile here.

Regards

-- 
Olivier PRENANT         	Tel:	+33-5-61-50-97-00 (Work)
Quartier d'Harraud Turrou           +33-5-61-50-97-01 (Fax)
31190 AUTERIVE                      +33-6-07-63-80-64 (GSM)
FRANCE                      Email: ohp@pyrenet.fr
------------------------------------------------------------------------------
Make your life a dream, make your dream a reality. (St Exupery)
From tom@replic8.net  Thu Jun 19 19:06:25 2003
Return-Path: <tom@replic8.net>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 20A9723865; Thu, 19 Jun 2003 19:06:25 +0300 (EEST)
Received: from rpunkt.kicks-ass.net (p50860E82.dip0.t-ipconnect.de
	[80.134.14.130])
	by danu.procontrol.fi (Postfix) with ESMTP id 94AB22384C
	for <dovecot@procontrol.fi>; Thu, 19 Jun 2003 19:06:17 +0300 (EEST)
Received: from localhost (localhost [127.0.0.1])
	by rpunkt.kicks-ass.net (Postfix) with ESMTP id D2F98416F5
	for <dovecot@procontrol.fi>; Thu, 19 Jun 2003 16:06:08 +0000 (GMT)
Received: from rpunkt.kicks-ass.net ([127.0.0.1])
 by localhost (commbox [127.0.0.1]) (amavisd-new, port 10024) with LMTP
 id 23451-09 for <dovecot@procontrol.fi>;
 Thu, 19 Jun 2003 16:06:08 +0000 (GMT)
Received: from aural (unknown [192.168.100.88])
	(using TLSv1 with cipher EDH-RSA-DES-CBC3-SHA (168/168 bits))
	(No client certificate requested)
	by rpunkt.kicks-ass.net (Postfix) with ESMTP id 892BE416D5
	for <dovecot@procontrol.fi>; Thu, 19 Jun 2003 16:06:07 +0000 (GMT)
Date: Thu, 19 Jun 2003 18:06:14 +0200
From: tom hensel <tom@replic8.net>
To: dovecot@procontrol.fi
Message-Id: <20030619180614.50593244.tom@replic8.net>
X-Mailer: Sylpheed version 0.9.2 (GTK+ 1.2.10; i386--netbsdelf)
Mime-Version: 1.0
Content-Type: multipart/signed; protocol="application/pgp-signature";
 micalg="pgp-sha1"; boundary="=.x.zMTYr),grX?/"
X-Virus-Scanned: by amavisd-new at rpdnet.com
Subject: [Dovecot] NetBSD pkgsrc maintanance
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Thu, 19 Jun 2003 16:06:25 -0000
X-UID: 976                                                  
Status: O

--=.x.zMTYr),grX?/
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

hi all,

i've taken over the maintainership of dovecot's pkgsrc on NetBSD -
please send me your ideas, questions and comments related to dovecot
on NetBSD.

FreeBSD's port has currently some more 'features' than the pkgsrc,
i'm going to add some of them - any feedback is appreciated.

bye,
TOM

--=.x.zMTYr),grX?/
Content-Type: application/pgp-signature

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.2 (NetBSD)

iD8DBQE+8d92Zj9fGW5yU88RAgqFAKCKQYsrdns9fYAwWyGcVnvy5MwRBwCgy0fn
KAWj4XuEA2DWzHduSl4xS5o=
=aIMt
-----END PGP SIGNATURE-----

--=.x.zMTYr),grX?/--
From spectron@coqui.net  Thu Jun 19 22:04:20 2003
Return-Path: <spectron@coqui.net>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id AEAEB23865; Thu, 19 Jun 2003 22:04:20 +0300 (EEST)
Received: from mail.coqui.net (emailgw.coqui.net [196.28.61.10])
	by danu.procontrol.fi (Postfix) with SMTP id DC8C723860
	for <dovecot@procontrol.fi>; Thu, 19 Jun 2003 22:04:14 +0300 (EEST)
Received: from unknown(66.50.169.121) by mail.coqui.net via csmap 
	 id 23443; Thu, 19 Jun 2003 14:46:37 -0400 (AST)
Message-ID: <004201c33695$93bed510$080aa8c0@PAVILION>
From: "Spectron International, Inc." <spectron@coqui.net>
To: "Dovecot List" <dovecot@procontrol.fi>
Date: Thu, 19 Jun 2003 15:04:14 -0400
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: 7bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2720.3000
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2600.0000
Subject: [Dovecot] Dovecot and LDAP problems
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Thu, 19 Jun 2003 19:04:20 -0000
X-UID: 977                                                  
Status: O

I'm having problems with dovecot and OpenLDAP. I installed both, and
configured both. /etc/dovecot-ldap.conf exists and I modified dovecot.conf
to have...

auth_userdb = ldap /etc/dovecot-ldap.conf
auth_passdb = ldap /etc/dovecot-ldap.conf

...but the log displays the following:

Jun 19 13:59:15 backup dovecot-auth: Unknown userdb type 'ldap'
Jun 19 13:59:15 backup dovecot: Auth process died too early - shutting down
Jun 19 13:59:15 backup dovecot: child 4187 (auth) returned error 89

the auth_userdb and auth_passdb seem to be ok, so what am I missing?

Faw


From dom@cus.org.uk  Fri Jun 20 03:24:38 2003
Return-Path: <dom@cus.org.uk>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 3EB712387A; Fri, 20 Jun 2003 03:24:38 +0300 (EEST)
Received: from cus.org.uk (host213-106-240-81.no-dns-yet.ntli.net
	[213.106.240.81])
	by danu.procontrol.fi (Postfix) with ESMTP id 32CFB23860
	for <dovecot@procontrol.fi>; Fri, 20 Jun 2003 03:24:35 +0300 (EEST)
Received: from cus.org.uk (localhost.cus.org.uk [127.0.0.1])
	by cus.org.uk (8.12.6/8.12.6) with ESMTP id h5K0OX5h047707;
	Fri, 20 Jun 2003 01:24:33 +0100 (BST)
	(envelope-from dom@cus.org.uk)
Received: (from dom@localhost)
	by cus.org.uk (8.12.6/8.12.6/Submit) id h5K0OXSu047706;
	Fri, 20 Jun 2003 01:24:33 +0100 (BST)
Date: Fri, 20 Jun 2003 01:24:33 +0100
From: Dominic Marks <dom@cus.org.uk>
To: tom hensel <tom@replic8.net>
Subject: Re: [Dovecot] NetBSD pkgsrc maintanance
Message-ID: <20030620002433.GA47623@cus.org.uk>
References: <20030619180614.50593244.tom@replic8.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20030619180614.50593244.tom@replic8.net>
User-Agent: Mutt/1.4i
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 20 Jun 2003 00:24:38 -0000
X-UID: 978                                                  
Status: O

On 19/06/2003 18:06, tom hensel wrote:
> hi all,
> 
> i've taken over the maintainership of dovecot's pkgsrc on NetBSD -
> please send me your ideas, questions and comments related to dovecot
> on NetBSD.
> 
> FreeBSD's port has currently some more 'features' than the pkgsrc,
> i'm going to add some of them - any feedback is appreciated.

Good luck :-)

> bye,
> TOM

While I'm here a tbz of a pre-commit FreeBSD port for
dovecot-0.99.10-test14 will be available to download from
http://cus.org.uk/~dom/dovecot-0.99.10-test14.tar.bz2 soon. Extract
into your home directory, change to the dovecot directory and make
install as usual. This assumes an installed ports tree.

Thanks,
--
Dominic
 <dom at cus.org.uk> <dominic.marks at npl.co.uk>
From charlie@rubberduck.com  Fri Jun 20 05:59:28 2003
Return-Path: <charlie@rubberduck.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 5F8AE2387F; Fri, 20 Jun 2003 05:59:28 +0300 (EEST)
Received: from lazy.spodder.com (unknown [203.18.243.123])
	by danu.procontrol.fi (Postfix) with ESMTP id 4E28F23860
	for <dovecot@procontrol.fi>; Fri, 20 Jun 2003 05:59:22 +0300 (EEST)
Received: by lazy.spodder.com (Postfix, from userid 501)
	id 194328FC0; Fri, 20 Jun 2003 12:59:16 +1000 (EST)
Date: Fri, 20 Jun 2003 12:59:15 +1000
From: Charlie Allom <charlie@rubberduck.com>
To: tom hensel <tom@replic8.net>
Subject: Re: [Dovecot] NetBSD pkgsrc maintanance
Message-ID: <20030620025915.GA22305@lazy.spodder.com>
References: <20030619180614.50593244.tom@replic8.net>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20030619180614.50593244.tom@replic8.net>
User-Agent: Mutt/1.5.4i
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 20 Jun 2003 02:59:28 -0000
X-UID: 979                                                  
Status: O

On Thu, Jun 19, 2003 at 06:06:14PM +0200, tom hensel wrote:
> hi all,
> 
> i've taken over the maintainership of dovecot's pkgsrc on NetBSD -
> please send me your ideas, questions and comments related to dovecot
> on NetBSD.

Hey, uh, how about a DOVECOT_WITH_DRAC ? :)

Sorry for the obvious. If you need a hand with pkgsrc give me a bell.

  C.
-- 
 charlie@rubberduck.com - Melbourne, Australia
 http://rubberduck.com/~yeled/
 PGP: 0x14AA7941 || finger yeled@lazy.spodder.com
From admin@xantara.co.uk  Fri Jun 20 18:08:39 2003
Return-Path: <admin@xantara.co.uk>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 2B0FE2387A; Fri, 20 Jun 2003 18:08:39 +0300 (EEST)
Received: from neuron.xantara.co.uk (neuron.xantara.co.uk [212.135.164.120])
	by danu.procontrol.fi (Postfix) with ESMTP id 51B8723860
	for <dovecot@procontrol.fi>; Fri, 20 Jun 2003 18:08:36 +0300 (EEST)
Received: from nitro.xantara.co.uk ([212.135.164.121] helo=xantara.co.uk)
	by neuron.xantara.co.uk with esmtp (Exim 4.20)
	id 19TNLV-0001hN-UU
	for dovecot@procontrol.fi; Fri, 20 Jun 2003 15:58:33 +0100
Date: Fri, 20 Jun 2003 16:08:35 +0100
Mime-Version: 1.0 (Apple Message framework v552)
Content-Type: text/plain; charset=US-ASCII; format=flowed
From: Steve Gare <admin@xantara.co.uk>
To: dovecot@procontrol.fi
Content-Transfer-Encoding: 7bit
Message-Id: <10625615-A331-11D7-B549-000A957D61B0@xantara.co.uk>
X-Mailer: Apple Mail (2.552)
Subject: [Dovecot] Bug?
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 20 Jun 2003 15:08:39 -0000
X-UID: 980                                                  
Status: O
Content-Length: 1733

Hi,

Been using Dovecot for a few weeks now, must say it's very good.. I've 
been looking for a 'drop in' replacement for UWImap for ages! :)

but just recently It's been giving me a few problem, I haven't tracked 
down exactly what causes the problem yet (I'm using Apple Mail on OS X 
10.2.6) but after a good mail session it keep trying to log in over and 
over again.. Looking the the log file I find this...


Jun 20 15:38:02 neuron imap-login: Login: sgare [IP REMOVED]
Jun 20 15:38:02 neuron imap(sgare): file imap-bodystructure.c: line 263 
(part_parse_headers): assertion failed: (part->physical_pos >= 
input->v_offset - start_offset)
Jun 20 15:38:02 neuron dovecot: child 6329 (imap) killed with signal 6
Jun 20 15:38:02 neuron imap-login: Login: sgare [IP REMOVED]
Jun 20 15:38:02 neuron imap(sgare): file imap-bodystructure.c: line 263 
(part_parse_headers): assertion failed: (part->physical_pos >= 
input->v_offset - start_offset)
Jun 20 15:38:02 neuron dovecot: child 6331 (imap) killed with signal 6
Jun 20 15:38:02 neuron imap-login: Login: sgare [IP REMOVED]
Jun 20 15:38:03 neuron imap(sgare): file imap-bodystructure.c: line 263 
(part_parse_headers): assertion failed: (part->physical_pos >= 
input->v_offset - start_offset)
Jun 20 15:38:03 neuron dovecot: child 6332 (imap) killed with signal 6
Jun 20 15:38:03 neuron imap-login: Login: sgare [IP REMOVED]
Jun 20 15:38:03 neuron imap(sgare): file imap-bodystructure.c: line 263 
(part_parse_headers): assertion failed: (part->physical_pos >= 
input->v_offset - start_offset)
Jun 20 15:38:03 neuron dovecot: child 6333 (imap) killed with signal 6
Jun 20 15:38:03 neuron imap-login: Login: sgare [IP REMOVED]


Cheers,

Steve Gare
- Xantara.Net
-- 0845 123 5707

From cras@irccrew.org  Fri Jun 20 21:22:58 2003
Return-Path: <cras@irccrew.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 219682387A; Fri, 20 Jun 2003 21:22:58 +0300 (EEST)
Received: from shodan.irccrew.org (shodan [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id 85E3C23860
	for <dovecot@procontrol.fi>; Fri, 20 Jun 2003 21:22:53 +0300 (EEST)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id 3115B2E003; Fri, 20 Jun 2003 21:22:53 +0300 (EEST)
Date: Fri, 20 Jun 2003 21:22:53 +0300
From: Timo Sirainen <tss@iki.fi>
To: Dovecot List <dovecot@procontrol.fi>
Subject: Re: [Dovecot] Dovecot and LDAP problems
Message-ID: <20030620182253.GA20209@irccrew.org>
References: <004201c33695$93bed510$080aa8c0@PAVILION>
Mime-Version: 1.0
Content-Disposition: inline
In-Reply-To: <004201c33695$93bed510$080aa8c0@PAVILION>
User-Agent: Mutt/1.4i
Content-Type: text/plain; charset=us-ascii
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 20 Jun 2003 18:22:58 -0000
X-UID: 981                                                  
Status: O

On Thu, Jun 19, 2003 at 03:04:14PM -0400, Spectron International, Inc. wrote:
> I'm having problems with dovecot and OpenLDAP. I installed both, and
> configured both. /etc/dovecot-ldap.conf exists and I modified dovecot.conf
> to have...
> 
> Jun 19 13:59:15 backup dovecot-auth: Unknown userdb type 'ldap'

It means LDAP support isn't compiled in. It should show that at the end of
configure. If it doesn't, it didn't find it for some reason. Maybe you're
missing openldap-dev or similiar? Or they're installed to location where
configure can't find them?

From cras@irccrew.org  Fri Jun 20 21:25:29 2003
Return-Path: <cras@irccrew.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 222A82387A; Fri, 20 Jun 2003 21:25:29 +0300 (EEST)
Received: from shodan.irccrew.org (shodan [80.83.4.2])
	by danu.procontrol.fi (Postfix) with ESMTP id 7142023860
	for <dovecot@procontrol.fi>; Fri, 20 Jun 2003 21:25:27 +0300 (EEST)
Received: by shodan.irccrew.org (Postfix, from userid 6976)
	id 4EBD42E003; Fri, 20 Jun 2003 21:25:27 +0300 (EEST)
Date: Fri, 20 Jun 2003 21:25:27 +0300
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Subject: Re: [Dovecot] Bug?
Message-ID: <20030620182527.GB20209@irccrew.org>
References: <10625615-A331-11D7-B549-000A957D61B0@xantara.co.uk>
Mime-Version: 1.0
Content-Disposition: inline
In-Reply-To: <10625615-A331-11D7-B549-000A957D61B0@xantara.co.uk>
User-Agent: Mutt/1.4i
Content-Type: text/plain; charset=us-ascii
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 20 Jun 2003 18:25:29 -0000
X-UID: 982                                                  
Status: O

On Fri, Jun 20, 2003 at 04:08:35PM +0100, Steve Gare wrote:
> but just recently It's been giving me a few problem, I haven't tracked 
> down exactly what causes the problem yet (I'm using Apple Mail on OS X 
> 10.2.6) but after a good mail session it keep trying to log in over and 
> over again.. Looking the the log file I find this...
> 
> Jun 20 15:38:02 neuron imap(sgare): file imap-bodystructure.c: line 263 
> (part_parse_headers): assertion failed: (part->physical_pos >= 
> input->v_offset - start_offset)

Is this 0.99.9.1? What OS? I'd suggest trying the -test releases. They have
quite a lot of fixes. And they're very near to being 0.99.10. I'd just have
to fix OpenSSL detection with redhat..

http://dovecot.procontrol.fi/test/

From spectron@coqui.net  Fri Jun 20 21:42:19 2003
Return-Path: <spectron@coqui.net>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id D26182387A; Fri, 20 Jun 2003 21:42:19 +0300 (EEST)
Received: from mail.coqui.net (emailgw.coqui.net [196.28.61.10])
	by danu.procontrol.fi (Postfix) with SMTP id A943E23860
	for <dovecot@procontrol.fi>; Fri, 20 Jun 2003 21:42:15 +0300 (EEST)
Received: from unknown(66.50.169.121) by mail.coqui.net via csmap 
	 id 10391; Fri, 20 Jun 2003 14:24:42 -0400 (AST)
Message-ID: <002601c3375b$adced1f0$080aa8c0@PAVILION>
From: "Spectron International, Inc." <spectron@coqui.net>
To: "Dovecot List" <dovecot@procontrol.fi>
References: <004201c33695$93bed510$080aa8c0@PAVILION>
	<20030620182253.GA20209@irccrew.org>
Subject: Re: [Dovecot] Dovecot and LDAP problems
Date: Fri, 20 Jun 2003 14:42:13 -0400
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: 7bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2720.3000
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2600.0000
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 20 Jun 2003 18:42:20 -0000
X-UID: 983                                                  
Status: O

> On Thu, Jun 19, 2003 at 03:04:14PM -0400, Spectron International, Inc.
wrote:
> > I'm having problems with dovecot and OpenLDAP. I installed both, and
> > configured both. /etc/dovecot-ldap.conf exists and I modified
dovecot.conf
> > to have...
> >
> > Jun 19 13:59:15 backup dovecot-auth: Unknown userdb type 'ldap'
>
> It means LDAP support isn't compiled in. It should show that at the end of
> configure. If it doesn't, it didn't find it for some reason. Maybe you're
> missing openldap-dev or similiar? Or they're installed to location where
> configure can't find them?

I installed the debian packages at
http://src.braincells.com/debian/woody/dovecot/. I thought the packages had
it compiled in. I guess not.

Faw


From admin@xantara.co.uk  Fri Jun 20 21:47:28 2003
Return-Path: <admin@xantara.co.uk>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 251972387A; Fri, 20 Jun 2003 21:47:28 +0300 (EEST)
Received: from neuron.xantara.co.uk (neuron.xantara.co.uk [212.135.164.120])
	by danu.procontrol.fi (Postfix) with ESMTP id 8989B23860
	for <dovecot@procontrol.fi>; Fri, 20 Jun 2003 21:47:25 +0300 (EEST)
Received: from nitro.xantara.co.uk ([212.135.164.121] helo=xantara.co.uk)
	by neuron.xantara.co.uk with esmtp (Exim 4.20)
	id 19TQlE-0001ps-Bz; Fri, 20 Jun 2003 19:37:20 +0100
Date: Fri, 20 Jun 2003 19:47:24 +0100
Subject: Re: [Dovecot] Bug?
Content-Type: text/plain; charset=US-ASCII; format=flowed
Mime-Version: 1.0 (Apple Message framework v552)
To: Timo Sirainen <tss@iki.fi>
From: Steve Gare <admin@xantara.co.uk>
In-Reply-To: <20030620182527.GB20209@irccrew.org>
Message-Id: <A2140164-A34F-11D7-B549-000A957D61B0@xantara.co.uk>
Content-Transfer-Encoding: 7bit
X-Mailer: Apple Mail (2.552)
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Fri, 20 Jun 2003 18:47:28 -0000
X-UID: 984                                                  
Status: O


On Friday, Jun 20, 2003, at 19:25 Europe/London, Timo Sirainen wrote:

> Is this 0.99.9.1? What OS? I'd suggest trying the -test releases. They 
> have
> quite a lot of fixes. And they're very near to being 0.99.10. I'd just 
> have
> to fix OpenSSL detection with redhat..

Yup, 99.9.1 under Linux (Redhat 9) I'll give that test one a go, (Don't 
need SSL atm)


Cheers,

Steve Gare
- Xantara.Net
-- 0845 123 5707

From cmeerw@web.de  Sat Jun 21 08:44:46 2003
Return-Path: <cmeerw@web.de>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id DD5152387A; Sat, 21 Jun 2003 08:44:46 +0300 (EEST)
Received: from octopussy.utanet.at (octopussy.utanet.at [213.90.36.45])
	by danu.procontrol.fi (Postfix) with ESMTP id 4BC8923865
	for <dovecot@procontrol.fi>; Sat, 21 Jun 2003 08:44:39 +0300 (EEST)
Received: from plenty.utanet.at ([213.90.36.9])
	by octopussy.utanet.at with esmtp (Exim 4.12)
	id 19TbAv-0002Ze-00; Sat, 21 Jun 2003 07:44:33 +0200
Received: from [62.218.247.51] (helo=hacking.cmeerw.net)
	by plenty.utanet.at with esmtp (TLSv1:DES-CBC3-SHA:168)
	(Exim 4.12)
	id 19TbAv-0003ki-00; Sat, 21 Jun 2003 07:44:33 +0200
Received: from cmeerw by hacking.cmeerw.net with local (Exim 4.20)
	id 19TbAu-0000IF-4G; Sat, 21 Jun 2003 07:44:32 +0200
Date: Sat, 21 Jun 2003 07:44:32 +0200
From: Christof Meerwald <cmeerw@web.de>
To: "Spectron International, Inc." <spectron@coqui.net>
Message-ID: <20030621054432.GA1116@hacking.cmeerw.net>
References: <002601c3375b$adced1f0$080aa8c0@PAVILION>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <002601c3375b$adced1f0$080aa8c0@PAVILION>
User-Agent: Mutt/1.3.28i
X-PGP-Key: 1024D/2B10BE68, 1998-06-29
X-PGP-Fingerprint: 0289 5466 C1F5 B03C DBA7  6304 8CAF 9782 2B10 BE68
cc: dovecot@procontrol.fi
Subject: [Dovecot] Re: Dovecot and LDAP problems
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Sat, 21 Jun 2003 05:44:47 -0000
X-UID: 985                                                  
Status: O

On Fri, 20 Jun 2003 14:42:13 -0400, Spectron International, Inc. wrote:
> I installed the debian packages at
> http://src.braincells.com/debian/woody/dovecot/. I thought the packages had
> it compiled in. I guess not.

You can give my Debian woody packages (see http://cmeerw.org/debian/) a try
which have LDAP support compiled in.


bye, Christof

-- 
http://cmeerw.org                                 JID: cmeerw@jabber.at
mailto cmeerw at web.de
From jaldhar@debian.org  Sun Jun 22 17:09:36 2003
Return-Path: <jaldhar@debian.org>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id F0FFD2387A; Sun, 22 Jun 2003 17:09:35 +0300 (EEST)
Received: from mail.braincells.com (samadhi.braincells.com [216.162.42.100])
	by danu.procontrol.fi (Postfix) with ESMTP id B790223865
	for <dovecot@procontrol.fi>; Sun, 22 Jun 2003 17:09:28 +0300 (EEST)
Received: from jyoti.intranet.braincells.com
	(bgp384497bgs.jersyc01.nj.comcast.net [68.36.31.111])
	(using TLSv1 with cipher EDH-RSA-DES-CBC3-SHA (168/168 bits))
	(No client certificate requested)
	by mail.braincells.com (Postfix) with ESMTP
	id B0C02867B; Sun, 22 Jun 2003 10:09:24 -0400 (EDT)
Date: Sun, 22 Jun 2003 10:09:16 -0400 (EDT)
From: "Jaldhar H. Vyas" <jaldhar@debian.org>
X-X-Sender: jaldhar@jyoti.intranet.braincells.com
To: Christof Meerwald <cmeerw@web.de>
Subject: Re: [Dovecot] Re: Dovecot and LDAP problems
In-Reply-To: <20030621054432.GA1116@hacking.cmeerw.net>
Message-ID: <Pine.LNX.4.56.0306220939440.445@jyoti.intranet.braincells.com>
References: <002601c3375b$adced1f0$080aa8c0@PAVILION>
	<20030621054432.GA1116@hacking.cmeerw.net>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
cc: "Spectron International, Inc." <spectron@coqui.net>
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
Reply-To: "Jaldhar H. Vyas" <jaldhar@debian.org>
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Sun, 22 Jun 2003 14:09:36 -0000
X-UID: 986                                                  
Status: O
Content-Length: 1627

On Sat, 21 Jun 2003, Christof Meerwald wrote:

> On Fri, 20 Jun 2003 14:42:13 -0400, Spectron International, Inc. wrote:
> > I installed the debian packages at
> > http://src.braincells.com/debian/woody/dovecot/. I thought the packages had
> > it compiled in. I guess not.
>

They do.  I pass --with-ldap to configure, config.log shows it is being
detected properly and
$ ldd /usr/lib/dovecot/dovecot-auth
        libpam.so.0 => /lib/libpam.so.0 (0x40019000)
        libldap.so.2 => /usr/lib/libldap.so.2 (0x40021000)
        liblber.so.2 => /usr/lib/liblber.so.2 (0x40047000)
        libnsl.so.1 => /lib/libnsl.so.1 (0x40051000)
        libresolv.so.2 => /lib/libresolv.so.2 (0x40065000)
        libsasl.so.7 => /usr/lib/libsasl.so.7 (0x40075000)
        libcrypt.so.1 => /lib/libcrypt.so.1 (0x40080000)
        libdl.so.2 => /lib/libdl.so.2 (0x400ad000)
        libc.so.6 => /lib/libc.so.6 (0x400b0000)
        libdb2.so.2 => /lib/libdb2.so.2 (0x401cd000)
        /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x40000000)


Do you get the same thing if you do an ldd?

Timo, are there any other circumstnces in which that error could come up?

> You can give my Debian woody packages (see http://c
meerw.org/debian/) a try
> which have LDAP support compiled in.
>

Christof, you never replied to me about coordinating our work.  It looks
like there is some unnecessary duplication of effort going on here.

Anyway seeing as you've just used the debianization from my sid packages I
don't think it will make any difference in this case.

-- 
Jaldhar H. Vyas <jaldhar@debian.org>
La Salle Debain - http://www.braincells.com/debian/
From cmeerw@web.de  Sun Jun 22 17:32:16 2003
Return-Path: <cmeerw@web.de>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 3E3C52387A; Sun, 22 Jun 2003 17:32:16 +0300 (EEST)
Received: from octopussy.utanet.at (octopussy.utanet.at [213.90.36.45])
	by danu.procontrol.fi (Postfix) with ESMTP id 1E09723860
	for <dovecot@procontrol.fi>; Sun, 22 Jun 2003 17:32:12 +0300 (EEST)
Received: from pam.utanet.at ([213.90.36.6])
	by octopussy.utanet.at with esmtp (Exim 4.12)
	id 19U5t1-0006ZX-00; Sun, 22 Jun 2003 16:32:07 +0200
Received: from [62.218.247.51] (helo=hacking.cmeerw.net)
	by pam.utanet.at with esmtp (TLSv1:DES-CBC3-SHA:168)
	(Exim 4.12)
	id 19U5t0-00018k-00; Sun, 22 Jun 2003 16:32:06 +0200
Received: from cmeerw by hacking.cmeerw.net with local (Exim 4.20)
	id 19U5sz-0003mx-JD; Sun, 22 Jun 2003 16:32:05 +0200
Date: Sun, 22 Jun 2003 16:32:05 +0200
From: Christof Meerwald <cmeerw@web.de>
To: "Jaldhar H. Vyas" <jaldhar@debian.org>
Subject: Re: [Dovecot] Re: Dovecot and LDAP problems
Message-ID: <20030622143205.GA14496@hacking.cmeerw.net>
References: <002601c3375b$adced1f0$080aa8c0@PAVILION>
	<20030621054432.GA1116@hacking.cmeerw.net>
	<Pine.LNX.4.56.0306220939440.445@jyoti.intranet.braincells.com>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <Pine.LNX.4.56.0306220939440.445@jyoti.intranet.braincells.com>
User-Agent: Mutt/1.3.28i
X-PGP-Key: 1024D/2B10BE68, 1998-06-29
X-PGP-Fingerprint: 0289 5466 C1F5 B03C DBA7  6304 8CAF 9782 2B10 BE68
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Sun, 22 Jun 2003 14:32:16 -0000
X-UID: 987                                                  
Status: O
Content-Length: 1591

On Sun, Jun 22, 2003 at 10:09:16AM -0400, Jaldhar H. Vyas wrote:
> On Sat, 21 Jun 2003, Christof Meerwald wrote:
> > On Fri, 20 Jun 2003 14:42:13 -0400, Spectron International, Inc. wrote:
> > > I installed the debian packages at
> > > http://src.braincells.com/debian/woody/dovecot/. I thought the packages had
> > > it compiled in. I guess not.
> They do.  I pass --with-ldap to configure, config.log shows it is being
> detected properly and

No, they don't (at least not your Debian woody packages).

$ ldd usr/lib/dovecot/dovecot-auth 
   libpam.so.0 => /lib/libpam.so.0 (0x40022000)
   libcrypt.so.1 => /lib/libcrypt.so.1 (0x4002a000)
   libdl.so.2 => /lib/libdl.so.2 (0x40058000)
   libc.so.6 => /lib/libc.so.6 (0x4005b000)
   /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x40000000)

Oh, I guess it's because of a typo in debian/rules:

        ./configure --with-ldap--host=$(DEB_HOST_GNU_TYPE) [...]

(there is a whitespace missing between "--with-ldap" and "--host")


> Christof, you never replied to me about coordinating our work.  It looks
> like there is some unnecessary duplication of effort going on here.
> Anyway seeing as you've just used the debianization from my sid packages I
> don't think it will make any difference in this case.

Sorry, but I am actually just compiling it on my machine (for personal use
and I make it available on my Web-site). I don't intend to put much effort
into building these packages (just enough to make them work for me).


bye, Christof

-- 
http://cmeerw.org                                 JID: cmeerw@jabber.at
mailto cmeerw at web.de
From tss@iki.fi  Mon Jun 23 02:40:58 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id E35DB2387A; Mon, 23 Jun 2003 02:40:58 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id BEE2923865
	for <dovecot@procontrol.fi>; Mon, 23 Jun 2003 02:40:54 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 30AFB5C62AEF; Mon, 23 Jun 2003 02:40:54 +0300 (EEST)
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1056325253.8749.38.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 23 Jun 2003 02:40:54 +0300
Subject: [Dovecot] 0.99.10-rc1
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Sun, 22 Jun 2003 23:40:59 -0000
X-UID: 988                                                  
Status: O

Home again.

Fixed SSL checking for Redhat 9, I hope. Could someone test if it
actually works now? Also fixed a few compiler warnings. If this thing
works, I'll just update the NEWS file and call it 0.99.10.

http://dovecot.procontrol.fi/rc/

Near future plans include rewriting parts of index handling. At least
.tree file will go, I've a _much_ better idea how to replace it. .data
file is also too bloaty and it's a bit difficult to add new fields into
it. I'd have to figure out some better API to access it.

I've also been worrying about locking.. If we want to share indexes
between many clients, lock contention will become a problem. For example
a "FETCH 1:* BODY[]" could take a long time and index can't be modified
while it's being done. I'm not really sure what to do about this..
Probably some more fine graned locking and maybe some kind of
transaction log where changes are written if you couldn't get exclusive
lock.

From warren@togami.com  Mon Jun 23 06:39:45 2003
Return-Path: <warren@togami.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 5C8B42387F; Mon, 23 Jun 2003 06:39:45 +0300 (EEST)
Received: from pan.mplug.org (unknown [66.139.75.105])
	by danu.procontrol.fi (Postfix) with ESMTP id 58C2223865
	for <dovecot@procontrol.fi>; Mon, 23 Jun 2003 06:39:40 +0300 (EEST)
Received: from localhost (unknown [127.0.0.1])
	by pan.mplug.org (Postfix) with ESMTP
	id 703405D803F; Sun, 22 Jun 2003 17:44:12 -1000 (HST)
Subject: Re: [Dovecot] 0.99.10-rc1
From: Warren Togami <warren@togami.com>
To: Timo Sirainen <tss@iki.fi>, dovecot@procontrol.fi
In-Reply-To: <1056325253.8749.38.camel@hurina>
References: <1056325253.8749.38.camel@hurina>
Content-Type: text/plain
Message-Id: <1056339575.22213.30.camel@laptop>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.4.0 (1.4.0-2) 
Date: 22 Jun 2003 17:39:35 -1000
Content-Transfer-Encoding: 7bit
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 23 Jun 2003 03:39:45 -0000
X-UID: 989                                                  
Status: O
Content-Length: 3135

On Sun, 2003-06-22 at 13:40, Timo Sirainen wrote:
> Home again.
> 
> Fixed SSL checking for Redhat 9, I hope. Could someone test if it
> actually works now? Also fixed a few compiler warnings. If this thing
> works, I'll just update the NEWS file and call it 0.99.10.
> 
> http://dovecot.procontrol.fi/rc/

http://videl.ics.hawaii.edu/~warren/fedora/dovecot-0.99.10-0.fdr.0.6.test13.src.rpm
Builds fine on RH9, using IMAPS on RH9 serverside for a while now

http://videl.ics.hawaii.edu/~warren/fedora/dovecot-0.99.10-0.fdr.0.7.rc1.src.rpm
Build fails on RH9

gcc -I/usr/kerberos/include -Wall -W -Wmissing-prototypes
-Wmissing-declarations -Wpointer-arith -Wchar-subscripts -Wformat=2
-Wbad-function-cast -I/usr/kerberos/include -o dovecot auth-process.o
login-process.o mail-process.o main.o master-settings.o ssl-init.o
ssl-init-gnutls.o ssl-init-openssl.o  ../lib/liblib.a
../lib-settings/libsettings.a -L/usr/kerberos/lib -lssl -lcrypto
-lresolv -lgssapi_krb5 -lkrb5 -lk5crypto -lcom_err -ldl -lz
/usr/bin/ld: cannot find -lz
collect2: ld returned 1 exit status
make[3]: *** [dovecot] Error 1

Compile failed here, nothing changed since my test13 SRPM other than
replacing the rc1 tarball.  Any idea why it wants zlib-devel now?

Previously I had these as build requirements:
openssl-devel openldap-devel pam-devel

Added zlib-devel... okay rebuild...

gcc -DHAVE_CONFIG_H -I. -I. -I../.. -I../../src/lib    
-I../../src/lib-settings        -DSYSCONFDIR=\""/etc"\"        
-DPKG_RUNDIR=\""/var/run/dovecot"\"
-DPKG_LIBEXECDIR=\""/usr/libexec/dovecot"\"     
-DPKG_LIBDIR=\""/usr/lib/dovecot"\"     -DSSLDIR=\""/usr/share/ssl\""   
-I/usr/kerberos/include   -Wall -W -Wmissing-prototypes
-Wmissing-declarations -Wpointer-arith -Wchar-subscripts -Wformat=2
-Wbad-function-cast -I/usr/kerberos/include    -c ssl-init-openssl.c
/bin/sh ../../libtool --mode=link gcc  -I/usr/kerberos/include   -Wall
-W -Wmissing-prototypes -Wmissing-declarations -Wpointer-arith
-Wchar-subscripts -Wformat=2 -Wbad-function-cast
-I/usr/kerberos/include     -o dovecot  auth-process.o login-process.o
mail-process.o main.o master-settings.o ssl-init.o ssl-init-gnutls.o
ssl-init-openssl.o ../lib/liblib.a     ../lib-settings/libsettings.a  
-L/usr/kerberos/lib -lssl -lcrypto -lresolv -lgssapi_krb5 -lkrb5
-lk5crypto -lcom_err -ldl -lz
mkdir .libs
gcc -I/usr/kerberos/include -Wall -W -Wmissing-prototypes
-Wmissing-declarations -Wpointer-arith -Wchar-subscripts -Wformat=2
-Wbad-function-cast -I/usr/kerberos/include -o dovecot auth-process.o
login-process.o mail-process.o main.o master-settings.o ssl-init.o
ssl-init-gnutls.o ssl-init-openssl.o  ../lib/liblib.a
../lib-settings/libsettings.a -L/usr/kerberos/lib -lssl -lcrypto
-lresolv -lgssapi_krb5 -lkrb5 -lk5crypto -lcom_err -ldl -lz
ssl-init.o(.text+0x67): In function `generate_parameters_file':
: undefined reference to `_ssl_generate_parameters'
collect2: ld returned 1 exit status
make[3]: *** [dovecot] Error 1

Out of curiosity I compiled this rc1 tarball on RH8, and it compiled
successfully without zlib-devel.  No RH8 server to test functionality
though.

Warren Togami
warren@togami.com

From katzj@redhat.com  Mon Jun 23 07:53:56 2003
Return-Path: <katzj@redhat.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 5000D23896; Mon, 23 Jun 2003 07:53:56 +0300 (EEST)
Received: from devserv.devel.redhat.com (nat-pool-rdu.redhat.com
	[66.187.233.200])
	by danu.procontrol.fi (Postfix) with ESMTP id 4966623860
	for <dovecot@procontrol.fi>; Mon, 23 Jun 2003 07:53:53 +0300 (EEST)
Received: from wallace (katzj.cipe.redhat.com [10.0.2.78])
	h5N4rox30080;	Mon, 23 Jun 2003 00:53:51 -0400
Subject: Re: [Dovecot] 0.99.10-rc1
From: Jeremy Katz <katzj@redhat.com>
To: Warren Togami <warren@togami.com>
In-Reply-To: <1056339575.22213.30.camel@laptop>
References: <1056325253.8749.38.camel@hurina>
	 <1056339575.22213.30.camel@laptop>
Content-Type: multipart/mixed; boundary="=-QmjPQJ2zUVfPsFtIc1GM"
Message-Id: <1056344037.2074.24.camel@isengard>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.4.0 (1.4.0-1) 
Date: 23 Jun 2003 00:53:57 -0400
cc: Timo Sirainen <tss@iki.fi>
cc: dovecot@procontrol.fi
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 23 Jun 2003 04:53:56 -0000
X-UID: 990                                                  
Status: O
Content-Length: 2120


--=-QmjPQJ2zUVfPsFtIc1GM
Content-Type: text/plain
Content-Transfer-Encoding: 7bit

On Sun, 2003-06-22 at 23:39, Warren Togami wrote:
> Compile failed here, nothing changed since my test13 SRPM other than
> replacing the rc1 tarball.  Any idea why it wants zlib-devel now?

OpenSSL 0.9.7a requires zlib...  look at /usr/lib/pkgconfig/openssl.pc
and the required libraries line has -lz.  Since the configure script now
uses pkg-config, it picks that up (even though nothing dovecot is using
explicitly requires symbols from zlib)

> gcc -I/usr/kerberos/include -Wall -W -Wmissing-prototypes
> -Wmissing-declarations -Wpointer-arith -Wchar-subscripts -Wformat=2
> -Wbad-function-cast -I/usr/kerberos/include -o dovecot auth-process.o
> login-process.o mail-process.o main.o master-settings.o ssl-init.o
> ssl-init-gnutls.o ssl-init-openssl.o  ../lib/liblib.a
> ../lib-settings/libsettings.a -L/usr/kerberos/lib -lssl -lcrypto
> -lresolv -lgssapi_krb5 -lkrb5 -lk5crypto -lcom_err -ldl -lz
> ssl-init.o(.text+0x67): In function `generate_parameters_file':
> : undefined reference to `_ssl_generate_parameters'
> collect2: ld returned 1 exit status
> make[3]: *** [dovecot] Error 1

Patch attached to fix this.

> Out of curiosity I compiled this rc1 tarball on RH8, and it compiled
> successfully without zlib-devel.  No RH8 server to test functionality
> though.

Red Hat Linux 8 ships with a version of OpenSSL without the .pc file and
so doesn't exercise the new stuff.

Cheers,

Jeremy

--=-QmjPQJ2zUVfPsFtIc1GM
Content-Disposition: attachment; filename=dovecot-0.99.10-rc1-ssl.patch
Content-Type: text/plain; name=dovecot-0.99.10-rc1-ssl.patch; charset=UTF-8
Content-Transfer-Encoding: 7bit

--- dovecot-0.99.10-rc1/configure.in.ssl	2003-06-23 00:47:05.000000000 -0400
+++ dovecot-0.99.10-rc1/configure.in	2003-06-23 00:47:07.000000000 -0400
@@ -732,6 +732,7 @@
   if pkg-config --exists openssl; then
     PKG_CHECK_MODULES(SSL, openssl)
     CFLAGS="$CFLAGS $SSL_CFLAGS"
+    AC_DEFINE(HAVE_OPENSSL,, Build with OpenSSL support)
     have_ssl="yes (OpenSSL)"
     have_openssl=yes
   else

--=-QmjPQJ2zUVfPsFtIc1GM--

From tss@iki.fi  Mon Jun 23 08:53:24 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 1D09423896; Mon, 23 Jun 2003 08:53:24 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id 5EA7B2387F
	for <dovecot@procontrol.fi>; Mon, 23 Jun 2003 08:53:21 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 29D745C62AEF; Mon, 23 Jun 2003 08:53:19 +0300 (EEST)
Subject: Re: [Dovecot] 0.99.10-rc1
From: Timo Sirainen <tss@iki.fi>
To: dovecot@procontrol.fi
In-Reply-To: <1056344037.2074.24.camel@isengard>
References: <1056325253.8749.38.camel@hurina>
	<1056344037.2074.24.camel@isengard>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1056347597.8745.41.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 23 Jun 2003 08:53:19 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 23 Jun 2003 05:53:24 -0000
X-UID: 991                                                  
Status: O

On Mon, 2003-06-23 at 07:53, Jeremy Katz wrote:
> > : undefined reference to `_ssl_generate_parameters'
> > collect2: ld returned 1 exit status
> > make[3]: *** [dovecot] Error 1
> 
> Patch attached to fix this.

I fixed it a bit differently and put out 0.99.10-rc2. I hope that works?

From katzj@redhat.com  Mon Jun 23 09:16:37 2003
Return-Path: <katzj@redhat.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 9A8E32387F; Mon, 23 Jun 2003 09:16:37 +0300 (EEST)
Received: from devserv.devel.redhat.com (nat-pool-rdu.redhat.com
	[66.187.233.200])
	by danu.procontrol.fi (Postfix) with ESMTP id C3E692387A
	for <dovecot@procontrol.fi>; Mon, 23 Jun 2003 09:16:34 +0300 (EEST)
Received: from wallace (katzj.cipe.redhat.com [10.0.2.78])
	by devserv.devel.redhat.com (8.11.6/8.11.0) with ESMTP id h5N6GXx16233
	for <dovecot@procontrol.fi>; Mon, 23 Jun 2003 02:16:33 -0400
Subject: Re: [Dovecot] 0.99.10-rc1
From: Jeremy Katz <katzj@redhat.com>
To: dovecot@procontrol.fi
In-Reply-To: <1056347597.8745.41.camel@hurina>
References: <1056325253.8749.38.camel@hurina>
	<1056347597.8745.41.camel@hurina>
Content-Type: text/plain
Message-Id: <1056349000.2074.26.camel@isengard>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.4.0 (1.4.0-1) 
Date: 23 Jun 2003 02:16:40 -0400
Content-Transfer-Encoding: 7bit
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 23 Jun 2003 06:16:37 -0000
X-UID: 992                                                  
Status: O

On Mon, 2003-06-23 at 01:53, Timo Sirainen wrote:
> On Mon, 2003-06-23 at 07:53, Jeremy Katz wrote:
> > > : undefined reference to `_ssl_generate_parameters'
> > > collect2: ld returned 1 exit status
> > > make[3]: *** [dovecot] Error 1
> > 
> > Patch attached to fix this.
> 
> I fixed it a bit differently and put out 0.99.10-rc2. I hope that works?

Looks sane and builds for me.

Jeremy

From warren@togami.com  Mon Jun 23 11:09:42 2003
Return-Path: <warren@togami.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 7C2062387F; Mon, 23 Jun 2003 11:09:42 +0300 (EEST)
Received: from pan.mplug.org (unknown [66.139.75.105])
	by danu.procontrol.fi (Postfix) with ESMTP id 7D27D2387A
	for <dovecot@procontrol.fi>; Mon, 23 Jun 2003 11:09:37 +0300 (EEST)
Received: from localhost (unknown [127.0.0.1])
	by pan.mplug.org (Postfix) with ESMTP
	id F064F5D803F; Sun, 22 Jun 2003 22:14:13 -1000 (HST)
Subject: Re: [Dovecot] 0.99.10-rc1
From: Warren Togami <warren@togami.com>
To: Jeremy Katz <katzj@redhat.com>, dovecot@procontrol.fi
In-Reply-To: <1056349000.2074.26.camel@isengard>
References: <1056325253.8749.38.camel@hurina>
	<1056349000.2074.26.camel@isengard>
Content-Type: text/plain
Message-Id: <1056355774.22213.35.camel@laptop>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.4.0 (1.4.0-2) 
Date: 22 Jun 2003 22:09:34 -1000
Content-Transfer-Encoding: 7bit
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 23 Jun 2003 08:09:42 -0000
X-UID: 993                                                  
Status: O

On Sun, 2003-06-22 at 20:16, Jeremy Katz wrote:
> On Mon, 2003-06-23 at 01:53, Timo Sirainen wrote:
> > On Mon, 2003-06-23 at 07:53, Jeremy Katz wrote:
> > > > : undefined reference to `_ssl_generate_parameters'
> > > > collect2: ld returned 1 exit status
> > > > make[3]: *** [dovecot] Error 1
> > > 
> > > Patch attached to fix this.
> > 
> > I fixed it a bit differently and put out 0.99.10-rc2. I hope that works?
> 
> Looks sane and builds for me.
> 
> Jeremy

https://bugzilla.fedora.us/show_bug.cgi?id=160

So far so good in functionality.

Warren


From rsweeten@mac.com  Mon Jun 23 11:31:27 2003
Return-Path: <rsweeten@mac.com>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id A5EC423896; Mon, 23 Jun 2003 11:31:27 +0300 (EEST)
Received: from rick-firewall.vircio.com (cs666880-32.austin.rr.com
	[66.68.80.32])
	by danu.procontrol.fi (Postfix) with ESMTP id C8FFF23860
	for <dovecot@procontrol.fi>; Mon, 23 Jun 2003 11:31:25 +0300 (EEST)
Received: (qmail 22304 invoked by uid 106); 23 Jun 2003 08:31:18 -0000
Received: from rsweeten@mac.com by localhost.localdomain by uid 103 with
	qmail-scanner-1.15 
	(uvscan: v4.1.60/v4272. spamassassin: 2.43-cvs.  Clear:. 
	Processed in 4.523562 secs); 23 Jun 2003 08:31:18 -0000
Received: from unknown (HELO RockLobster) ([10.1.254.195])
          (envelope-sender <rsweeten@mac.com>)
          by 10.1.254.206 (qmail-ldap-1.03) with SMTP
          for <dovecot@procontrol.fi>; 23 Jun 2003 08:31:09 -0000
Date: Mon, 23 Jun 2003 03:30:08 -0500
Mime-Version: 1.0 (Apple Message framework v482)
Content-Type: text/plain; charset=US-ASCII; format=flowed
From: R.Charles Sweeten <rsweeten@mac.com>
To: dovecot@procontrol.fi
Content-Transfer-Encoding: 7bit
Message-Id: <E63FC825-A554-11D7-8FD0-000A279898BC@mac.com>
X-Mailer: Apple Mail (2.482)
Subject: [Dovecot] newbie question: alias addresses
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 23 Jun 2003 08:31:27 -0000
X-UID: 994                                                  
Status: O

Hello!

I looked through the mail archives but did not see how to set up alias 
addresses.  Could someone please put me on the right road.  How do I 
create/implement aliases?  and group aliases?

Thanks!
~rick...........


"There is no spoon.  .....<gun-shot>...."

From jgilmour@bigpond.net.au  Mon Jun 23 12:44:18 2003
Return-Path: <jgilmour@bigpond.net.au>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 7BDAE2387F; Mon, 23 Jun 2003 12:44:18 +0300 (EEST)
Received: from mta08bw.bigpond.com (mta08bw.bigpond.com [144.135.24.137])
	by danu.procontrol.fi (Postfix) with ESMTP id 0FDB12387A
	for <dovecot@procontrol.fi>; Mon, 23 Jun 2003 12:44:13 +0300 (EEST)
Received: from bigpond.net.au ([144.135.24.72]) by mta08bw.email.bigpond.com
 (iPlanet Messaging Server 5.2 HotFix 1.14 (built Mar 18 2003))
 with SMTP id <0HGX005LHHOIIU@mta08bw.email.bigpond.com> for
 dovecot@procontrol.fi; Mon, 23 Jun 2003 19:43:30 +1000 (EST)
Received: from cpe-144-132-121-21.vic.bigpond.net.au ([144.132.121.21])
 by bwmam02bpa.bigpond.com(MAM REL_3_3_2c 17/1945973); Mon,
 23 Jun 2003 19:43:32 +0000
Date: Mon, 23 Jun 2003 19:33:27 +1000
From: Joe Gilmour <jgilmour@bigpond.net.au>
Subject: Re: [Dovecot] newbie question: alias addresses
In-reply-to: <E63FC825-A554-11D7-8FD0-000A279898BC@mac.com>
To: dovecot@procontrol.fi
Message-id: <3EF6C967.1030104@bigpond.net.au>
MIME-version: 1.0
Content-type: text/plain; charset=ISO-8859-1; format=flowed
Content-transfer-encoding: 7BIT
X-Accept-Language: en-us, en
User-Agent: Mozilla/5.0 (Windows; U; Win98; en-US; rv:1.5a) Gecko/20030620
References: <E63FC825-A554-11D7-8FD0-000A279898BC@mac.com>
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 23 Jun 2003 09:44:18 -0000
X-UID: 995                                                  
Status: O

I'm not a guru but in my set up (exim and dovecot) I have aliases 
created in my exim config.  They're then delivered straight to the 
mailbox for the users.  So have a look at you MTA (smtp server like 
sendmail) config, that should be where you create your alias addresses.

Hope this helps,

Joe Gilmour

R.Charles Sweeten wrote:

> Hello!
>
> I looked through the mail archives but did not see how to set up alias 
> addresses.  Could someone please put me on the right road.  How do I 
> create/implement aliases?  and group aliases?
>
> Thanks!
> ~rick...........
>
>
> "There is no spoon.  .....<gun-shot>...."
>
>

From lfarkas@bnap.hu  Mon Jun 23 16:56:06 2003
Return-Path: <lfarkas@bnap.hu>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 785BB2387F; Mon, 23 Jun 2003 16:56:06 +0300 (EEST)
Received: from mail1.bppiac.hu (blue.bppiac.hu [212.108.197.67])
	by danu.procontrol.fi (Postfix) with ESMTP id 059FE2387A
	for <dovecot@procontrol.fi>; Mon, 23 Jun 2003 16:56:00 +0300 (EEST)
Received: from mail2.bppiac.hu (portal.bppiac.hu [194.143.224.170])
	by mail1.bppiac.hu (Postfix) with ESMTP id 95C33754004
	for <dovecot@procontrol.fi>; Mon, 23 Jun 2003 15:55:17 +0200 (CEST)
Received: from portal.bppiac.hu (localhost [127.0.0.1])
	by portal.bppiac.hu (Postfix) with SMTP
	id 861FE3F02; Mon, 23 Jun 2003 15:55:57 +0200 (CEST)
Received: from bnap.hu (garfield.int.bppiac.hu [192.168.0.50])
	by mail2.bppiac.hu (Postfix) with ESMTP id 5BE503EAD
	for <dovecot@procontrol.fi>; Mon, 23 Jun 2003 15:55:57 +0200 (CEST)
Message-ID: <3EF706E8.4090503@bnap.hu>
Date: Mon, 23 Jun 2003 15:55:52 +0200
From: Farkas Levente <lfarkas@bnap.hu>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.3) Gecko/20030313
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: Dovecot List <dovecot@procontrol.fi>
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit
Subject: [Dovecot] can't compile on redhat 9
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 23 Jun 2003 13:56:06 -0000
X-UID: 996                                                  
Status: O

hi,
while the current cvs compile on redhat 8.0 on redhat 9 gives the 
following error:
----------------------------
checking whether va_lists can be copied by value... yes
./configure: line 14217: syntax error near unexpected token `SSL,'
./configure: line 14217: `    PKG_CHECK_MODULES(SSL, openssl)'
error: Bad exit status from /var/tmp/rpm-tmp.84419 (%build)
----------------------------
any tip what can be the reason? thanks.
yours.

-- 
   Levente                               "Si vis pacem para bellum!"


From tss@iki.fi  Mon Jun 23 17:13:06 2003
Return-Path: <tss@iki.fi>
X-Original-To: dovecot@procontrol.fi
Delivered-To: dovecot@procontrol.fi
Received: by danu.procontrol.fi (Postfix, from userid 106)
	id 5A4D823896; Mon, 23 Jun 2003 17:13:06 +0300 (EEST)
Received: from oma.irssi.org (ip213-185-36-189.laajakaista.mtv3.fi
	[213.185.36.189])
	by danu.procontrol.fi (Postfix) with ESMTP id AD1D92387F
	for <dovecot@procontrol.fi>; Mon, 23 Jun 2003 17:13:02 +0300 (EEST)
Received: by oma.irssi.org (Postfix, from userid 1000)
	id 1A30A5C62AEF; Mon, 23 Jun 2003 17:13:02 +0300 (EEST)
Subject: Re: [Dovecot] can't compile on redhat 9
From: Timo Sirainen <tss@iki.fi>
To: Dovecot List <dovecot@procontrol.fi>
In-Reply-To: <3EF706E8.4090503@bnap.hu>
References: <3EF706E8.4090503@bnap.hu>
Content-Type: text/plain
Content-Transfer-Encoding: 7bit
Organization: 
Message-Id: <1056377581.8748.44.camel@hurina>
Mime-Version: 1.0
X-Mailer: Ximian Evolution 1.2.4 
Date: 23 Jun 2003 17:13:01 +0300
X-BeenThere: dovecot@procontrol.fi
X-Mailman-Version: 2.1.1
Precedence: list
List-Id: Dovecot Mailing List <dovecot.procontrol.fi>
List-Unsubscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=unsubscribe>
List-Archive: <http://procontrol.fi/pipermail/dovecot>
List-Post: <mailto:dovecot@procontrol.fi>
List-Help: <mailto:dovecot-request@procontrol.fi?subject=help>
List-Subscribe: <http://procontrol.fi/cgi-bin/mailman/listinfo/dovecot>,
	<mailto:dovecot-request@procontrol.fi?subject=subscribe>
X-List-Received-Date: Mon, 23 Jun 2003 14:13:06 -0000
X-UID: 997                                                  
Status: O

On Mon, 2003-06-23 at 16:55, Farkas Levente wrote:
> hi,
> while the current cvs compile on redhat 8.0 on redhat 9 gives the 
> following error:
> ----------------------------
> checking whether va_lists can be copied by value... yes
> ./configure: line 14217: syntax error near unexpected token `SSL,'
> ./configure: line 14217: `    PKG_CHECK_MODULES(SSL, openssl)'

You're missing /usr/share/aclocal/pkg.m4 which is probably in package
pkg-config or pkg-config-dev or something.

